import{r as a4,a as s4,g as si,b as ie,R as eC,c as He,X as l4,S as Us,A as O_,B as Ec,M as gd,W as nd,d as Zk,e as rP,f as c4,h as M_,T as u4,E as h4,i as v0,L as k7,D as Lu,j as Fx,k as nP,l as iP,m as id,Z as d4,C as f4,n as p4,o as N7,p as L7,F as tC,q as Ib,s as oP,t as j7,u as z7,v as F7,w as B7,x as U7,y as V7,N as Xk,z as aP,G as $7,P as m4,H as g4,I as q7,J as rC,U as G7,K as Cb,O as _4,Q as cp,V as B_,Y as Du,_ as Kk,$ as H7,a0 as W7,a1 as Z7,a2 as Yk,a3 as Jk,a4 as Bx,a5 as X7,a6 as K7,a7 as Y7,a8 as y4,a9 as v4}from"./vendor-B6sXyl9B.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const _ of d)if(_.type==="childList")for(const v of _.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function a(d){const _={};return d.integrity&&(_.integrity=d.integrity),d.referrerPolicy&&(_.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?_.credentials="include":d.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(d){if(d.ep)return;d.ep=!0;const _=a(d);fetch(d.href,_)}})();var NS={exports:{}},c_={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qk;function J7(){if(Qk)return c_;Qk=1;var e=a4(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,d=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_={key:!0,ref:!0,__self:!0,__source:!0};function v(i,P,I){var M,R={},F=null,q=null;I!==void 0&&(F=""+I),P.key!==void 0&&(F=""+P.key),P.ref!==void 0&&(q=P.ref);for(M in P)l.call(P,M)&&!_.hasOwnProperty(M)&&(R[M]=P[M]);if(i&&i.defaultProps)for(M in P=i.defaultProps,P)R[M]===void 0&&(R[M]=P[M]);return{$$typeof:t,type:i,key:F,ref:q,props:R,_owner:d.current}}return c_.Fragment=a,c_.jsx=v,c_.jsxs=v,c_}var eN;function Q7(){return eN||(eN=1,NS.exports=J7()),NS.exports}var T=Q7(),Ux={},tN;function eZ(){if(tN)return Ux;tN=1;var e=s4();return Ux.createRoot=e.createRoot,Ux.hydrateRoot=e.hydrateRoot,Ux}var tZ=eZ();const rZ=si(tZ);function nZ(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var a,l,d,_,v=[],i="",P=e.split("/");for(P[0]||P.shift();d=P.shift();)a=d[0],a==="*"?(v.push(a),i+=d[1]==="?"?"(?:/(.*))?":"/(.*)"):a===":"?(l=d.indexOf("?",1),_=d.indexOf(".",1),v.push(d.substring(1,~l?l:~_?_:d.length)),i+=~l&&!~_?"(?:/([^/]+?))?":"/([^/]+?)",~_&&(i+=(~l?"?":"")+"\\"+d.substring(_))):i+="/"+d;return{keys:v,pattern:new RegExp("^"+i+(t?"(?=$|/)":"/?$"),"i")}}var LS={exports:{}},jS={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rN;function iZ(){if(rN)return jS;rN=1;var e=a4();function t(R,F){return R===F&&(R!==0||1/R===1/F)||R!==R&&F!==F}var a=typeof Object.is=="function"?Object.is:t,l=e.useState,d=e.useEffect,_=e.useLayoutEffect,v=e.useDebugValue;function i(R,F){var q=F(),H=l({inst:{value:q,getSnapshot:F}}),j=H[0].inst,$=H[1];return _(function(){j.value=q,j.getSnapshot=F,P(j)&&$({inst:j})},[R,q,F]),d(function(){return P(j)&&$({inst:j}),R(function(){P(j)&&$({inst:j})})},[R]),v(q),q}function P(R){var F=R.getSnapshot;R=R.value;try{var q=F();return!a(R,q)}catch{return!0}}function I(R,F){return F()}var M=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?I:i;return jS.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:M,jS}var nN;function oZ(){return nN||(nN=1,LS.exports=iZ()),LS.exports}var aZ=oZ();const sZ=eC.useInsertionEffect,lZ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",cZ=lZ?ie.useLayoutEffect:ie.useEffect,uZ=sZ||cZ,x4=e=>{const t=ie.useRef([e,(...a)=>t[0](...a)]).current;return uZ(()=>{t[0]=e}),t[1]},hZ="popstate",nC="pushState",iC="replaceState",dZ="hashchange",iN=[hZ,nC,iC,dZ],fZ=e=>{for(const t of iN)addEventListener(t,e);return()=>{for(const t of iN)removeEventListener(t,e)}},b4=(e,t)=>aZ.useSyncExternalStore(fZ,e,t),pZ=()=>location.search,mZ=({ssrSearch:e=""}={})=>b4(pZ,()=>e),oN=()=>location.pathname,gZ=({ssrPath:e}={})=>b4(oN,e?()=>e:oN),_Z=(e,{replace:t=!1,state:a=null}={})=>history[t?iC:nC](a,"",e),yZ=(e={})=>[gZ(e),_Z],aN=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[aN]>"u"){for(const e of[nC,iC]){const t=history[e];history[e]=function(){const a=t.apply(this,arguments),l=new Event(e);return l.arguments=arguments,dispatchEvent(l),a}}Object.defineProperty(window,aN,{value:!0})}const vZ=(e,t)=>t.toLowerCase().indexOf(e.toLowerCase())?"~"+t:t.slice(e.length)||"/",w4=(e="")=>e==="/"?"":e,xZ=(e,t)=>e[0]==="~"?e.slice(1):w4(t)+e,bZ=(e="",t)=>vZ(sN(w4(e)),sN(t)),sN=e=>{try{return decodeURI(e)}catch{return e}},S4={hook:yZ,searchHook:mZ,parser:nZ,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:e=>e},T4=ie.createContext(S4),Iy=()=>ie.useContext(T4),A4={},E4=ie.createContext(A4),wZ=()=>ie.useContext(E4),Ob=e=>{const[t,a]=e.hook(e);return[bZ(e.base,t),x4((l,d)=>a(xZ(l,e.base),d))]},P4=()=>Ob(Iy()),I4=(e,t,a,l)=>{const{pattern:d,keys:_}=t instanceof RegExp?{keys:!1,pattern:t}:e(t||"*",l),v=d.exec(a)||[],[i,...P]=v;return i!==void 0?[!0,(()=>{const I=_!==!1?Object.fromEntries(_.map((R,F)=>[R,P[F]])):v.groups;let M={...P};return I&&Object.assign(M,I),M})(),...l?[i]:[]]:[!1,null]},SZ=({children:e,...t})=>{const a=Iy(),l=t.hook?S4:a;let d=l;const[_,v]=t.ssrPath?.split("?")??[];v&&(t.ssrSearch=v,t.ssrPath=_),t.hrefs=t.hrefs??t.hook?.hrefs;let i=ie.useRef({}),P=i.current,I=P;for(let M in l){const R=M==="base"?l[M]+(t[M]||""):t[M]||l[M];P===I&&R!==I[M]&&(i.current=I={...I}),I[M]=R,(R!==l[M]||R!==d[M])&&(d=I)}return ie.createElement(T4.Provider,{value:d,children:e})},lN=({children:e,component:t},a)=>t?ie.createElement(t,{params:a}):typeof e=="function"?e(a):e,TZ=e=>{let t=ie.useRef(A4);const a=t.current;return t.current=Object.keys(e).length!==Object.keys(a).length||Object.entries(e).some(([l,d])=>d!==a[l])?e:a},is=({path:e,nest:t,match:a,...l})=>{const d=Iy(),[_]=Ob(d),[v,i,P]=a??I4(d.parser,e,_,t),I=TZ({...wZ(),...i});if(!v)return null;const M=P?ie.createElement(SZ,{base:P},lN(l,I)):lN(l,I);return ie.createElement(E4.Provider,{value:I,children:M})},ka=ie.forwardRef((e,t)=>{const a=Iy(),[l,d]=Ob(a),{to:_="",href:v=_,onClick:i,asChild:P,children:I,className:M,replace:R,state:F,...q}=e,H=x4($=>{$.ctrlKey||$.metaKey||$.altKey||$.shiftKey||$.button!==0||(i?.($),$.defaultPrevented||($.preventDefault(),d(v,e)))}),j=a.hrefs(v[0]==="~"?v.slice(1):a.base+v,a);return P&&ie.isValidElement(I)?ie.cloneElement(I,{onClick:H,href:j}):ie.createElement("a",{...q,onClick:H,href:j,className:M?.call?M(l===v):M,children:I,ref:t})}),C4=e=>Array.isArray(e)?e.flatMap(t=>C4(t&&t.type===ie.Fragment?t.props.children:t)):[e],zS=({children:e,location:t})=>{const a=Iy(),[l]=Ob(a);for(const d of C4(e)){let _=0;if(ie.isValidElement(d)&&(_=I4(a.parser,d.props.path,t||l,d.props.nest))[0])return ie.cloneElement(d,{match:_})}return null};var Jp=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},AZ={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},EZ=class{#e=AZ;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}},Kh=new EZ;function PZ(e){setTimeout(e,0)}var od=typeof window>"u"||"Deno"in globalThis;function sa(){}function IZ(e,t){return typeof e=="function"?e(t):e}function sP(e){return typeof e=="number"&&e>=0&&e!==1/0}function O4(e,t){return Math.max(e+(t||0)-Date.now(),0)}function ju(e,t){return typeof e=="function"?e(t):e}function cs(e,t){return typeof e=="function"?e(t):e}function cN(e,t){const{type:a="all",exact:l,fetchStatus:d,predicate:_,queryKey:v,stale:i}=e;if(v){if(l){if(t.queryHash!==oC(v,t.options))return!1}else if(!U_(t.queryKey,v))return!1}if(a!=="all"){const P=t.isActive();if(a==="active"&&!P||a==="inactive"&&P)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||d&&d!==t.state.fetchStatus||_&&!_(t))}function uN(e,t){const{exact:a,status:l,predicate:d,mutationKey:_}=e;if(_){if(!t.options.mutationKey)return!1;if(a){if(ad(t.options.mutationKey)!==ad(_))return!1}else if(!U_(t.options.mutationKey,_))return!1}return!(l&&t.state.status!==l||d&&!d(t))}function oC(e,t){return(t?.queryKeyHashFn||ad)(e)}function ad(e){return JSON.stringify(e,(t,a)=>lP(a)?Object.keys(a).sort().reduce((l,d)=>(l[d]=a[d],l),{}):a)}function U_(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(a=>U_(e[a],t[a])):!1}var CZ=Object.prototype.hasOwnProperty;function M4(e,t){if(e===t)return e;const a=hN(e)&&hN(t);if(!a&&!(lP(e)&&lP(t)))return t;const d=(a?e:Object.keys(e)).length,_=a?t:Object.keys(t),v=_.length,i=a?new Array(v):{};let P=0;for(let I=0;I<v;I++){const M=a?I:_[I],R=e[M],F=t[M];if(R===F){i[M]=R,(a?I<d:CZ.call(e,M))&&P++;continue}if(R===null||F===null||typeof R!="object"||typeof F!="object"){i[M]=F;continue}const q=M4(R,F);i[M]=q,q===R&&P++}return d===v&&P===d?e:i}function x0(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const a in e)if(e[a]!==t[a])return!1;return!0}function hN(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function lP(e){if(!dN(e))return!1;const t=e.constructor;if(t===void 0)return!0;const a=t.prototype;return!(!dN(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function dN(e){return Object.prototype.toString.call(e)==="[object Object]"}function OZ(e){return new Promise(t=>{Kh.setTimeout(t,e)})}function cP(e,t,a){return typeof a.structuralSharing=="function"?a.structuralSharing(e,t):a.structuralSharing!==!1?M4(e,t):t}function MZ(e,t,a=0){const l=[...e,t];return a&&l.length>a?l.slice(1):l}function RZ(e,t,a=0){const l=[t,...e];return a&&l.length>a?l.slice(0,-1):l}var aC=Symbol();function R4(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===aC?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function D4(e,t){return typeof e=="function"?e(...t):!!e}var DZ=class extends Jp{#e;#t;#r;constructor(){super(),this.#r=e=>{if(!od&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#r=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},sC=new DZ;function uP(){let e,t;const a=new Promise((d,_)=>{e=d,t=_});a.status="pending",a.catch(()=>{});function l(d){Object.assign(a,d),delete a.resolve,delete a.reject}return a.resolve=d=>{l({status:"fulfilled",value:d}),e(d)},a.reject=d=>{l({status:"rejected",reason:d}),t(d)},a}var kZ=PZ;function NZ(){let e=[],t=0,a=i=>{i()},l=i=>{i()},d=kZ;const _=i=>{t?e.push(i):d(()=>{a(i)})},v=()=>{const i=e;e=[],i.length&&d(()=>{l(()=>{i.forEach(P=>{a(P)})})})};return{batch:i=>{let P;t++;try{P=i()}finally{t--,t||v()}return P},batchCalls:i=>(...P)=>{_(()=>{i(...P)})},schedule:_,setNotifyFunction:i=>{a=i},setBatchNotifyFunction:i=>{l=i},setScheduler:i=>{d=i}}}var fo=NZ(),LZ=class extends Jp{#e=!0;#t;#r;constructor(){super(),this.#r=e=>{if(!od&&window.addEventListener){const t=()=>e(!0),a=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",a)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#r=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(a=>{a(e)}))}isOnline(){return this.#e}},b0=new LZ;function jZ(e){return Math.min(1e3*2**e,3e4)}function k4(e){return(e??"online")==="online"?b0.isOnline():!0}var hP=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function N4(e){let t=!1,a=0,l;const d=uP(),_=()=>d.status!=="pending",v=j=>{if(!_()){const $=new hP(j);F($),e.onCancel?.($)}},i=()=>{t=!0},P=()=>{t=!1},I=()=>sC.isFocused()&&(e.networkMode==="always"||b0.isOnline())&&e.canRun(),M=()=>k4(e.networkMode)&&e.canRun(),R=j=>{_()||(l?.(),d.resolve(j))},F=j=>{_()||(l?.(),d.reject(j))},q=()=>new Promise(j=>{l=$=>{(_()||I())&&j($)},e.onPause?.()}).then(()=>{l=void 0,_()||e.onContinue?.()}),H=()=>{if(_())return;let j;const $=a===0?e.initialPromise:void 0;try{j=$??e.fn()}catch(Y){j=Promise.reject(Y)}Promise.resolve(j).then(R).catch(Y=>{if(_())return;const K=e.retry??(od?0:3),re=e.retryDelay??jZ,se=typeof re=="function"?re(a,Y):re,J=K===!0||typeof K=="number"&&a<K||typeof K=="function"&&K(a,Y);if(t||!J){F(Y);return}a++,e.onFail?.(a,Y),OZ(se).then(()=>I()?void 0:q()).then(()=>{t?F(Y):H()})})};return{promise:d,status:()=>d.status,cancel:v,continue:()=>(l?.(),d),cancelRetry:i,continueRetry:P,canStart:M,start:()=>(M()?H():q().then(H),d)}}var L4=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),sP(this.gcTime)&&(this.#e=Kh.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(od?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Kh.clearTimeout(this.#e),this.#e=void 0)}},zZ=class extends L4{#e;#t;#r;#i;#n;#a;#s;constructor(e){super(),this.#s=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#i=e.client,this.#r=this.#i.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=fN(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=fN(this.options);t.data!==void 0&&(this.setData(t.data,{updatedAt:t.dataUpdatedAt,manual:!0}),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(e,t){const a=cP(this.state.data,e,this.options);return this.#o({data:a,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),a}setState(e,t){this.#o({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#n?.promise;return this.#n?.cancel(e),t?t.then(sa).catch(sa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>cs(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===aC||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ju(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!O4(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#n&&(this.#s?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(e&&this.setOptions(e),!this.options.queryFn){const i=this.observers.find(P=>P.options.queryFn);i&&this.setOptions(i.options)}const a=new AbortController,l=i=>{Object.defineProperty(i,"signal",{enumerable:!0,get:()=>(this.#s=!0,a.signal)})},d=()=>{const i=R4(this.options,t),I=(()=>{const M={client:this.#i,queryKey:this.queryKey,meta:this.meta};return l(M),M})();return this.#s=!1,this.options.persister?this.options.persister(i,I,this):i(I)},v=(()=>{const i={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:d};return l(i),i})();this.options.behavior?.onFetch(v,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==v.fetchOptions?.meta)&&this.#o({type:"fetch",meta:v.fetchOptions?.meta}),this.#n=N4({initialPromise:t?.initialPromise,fn:v.fetchFn,onCancel:i=>{i instanceof hP&&i.revert&&this.setState({...this.#t,fetchStatus:"idle"}),a.abort()},onFail:(i,P)=>{this.#o({type:"failed",failureCount:i,error:P})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:v.options.retry,retryDelay:v.options.retryDelay,networkMode:v.options.networkMode,canRun:()=>!0});try{const i=await this.#n.start();if(i===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(i),this.#r.config.onSuccess?.(i,this),this.#r.config.onSettled?.(i,this.state.error,this),i}catch(i){if(i instanceof hP){if(i.silent)return this.#n.promise;if(i.revert){if(this.state.data===void 0)throw i;return this.state.data}}throw this.#o({type:"error",error:i}),this.#r.config.onError?.(i,this),this.#r.config.onSettled?.(this.state.data,i,this),i}finally{this.scheduleGc()}}#o(e){const t=a=>{switch(e.type){case"failed":return{...a,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...j4(a.data,this.options),fetchMeta:e.meta??null};case"success":const l={...a,data:e.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?l:void 0,l;case"error":const d=e.error;return{...a,error:d,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...e.state}}};this.state=t(this.state),fo.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:e})})}};function j4(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:k4(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function fN(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,a=t!==void 0,l=a?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:a?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var FZ=class extends Jp{constructor(e,t){super(),this.options=t,this.#e=e,this.#o=null,this.#s=uP(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#r=void 0;#i=void 0;#n;#a;#s;#o;#m;#d;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),pN(this.#t,this.options)?this.#h():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return dP(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return dP(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#x(),this.#b(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,a=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof cs(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),t._defaulted&&!x0(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const l=this.hasListeners();l&&mN(this.#t,a,this.options,t)&&this.#h(),this.updateResult(),l&&(this.#t!==a||cs(this.options.enabled,this.#t)!==cs(t.enabled,this.#t)||ju(this.options.staleTime,this.#t)!==ju(t.staleTime,this.#t))&&this.#g();const d=this.#_();l&&(this.#t!==a||cs(this.options.enabled,this.#t)!==cs(t.enabled,this.#t)||d!==this.#l)&&this.#y(d)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),a=this.createResult(t,e);return UZ(this,a)&&(this.#i=a,this.#a=this.options,this.#n=this.#t.state),a}getCurrentResult(){return this.#i}trackResult(e,t){return new Proxy(e,{get:(a,l)=>(this.trackProp(l),t?.(l),l==="promise"&&!this.options.experimental_prefetchInRender&&this.#s.status==="pending"&&this.#s.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(a,l))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),a=this.#e.getQueryCache().build(this.#e,t);return a.fetch().then(()=>this.createResult(a,t))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#h(e){this.#w();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(sa)),t}#g(){this.#x();const e=ju(this.options.staleTime,this.#t);if(od||this.#i.isStale||!sP(e))return;const a=O4(this.#i.dataUpdatedAt,e)+1;this.#c=Kh.setTimeout(()=>{this.#i.isStale||this.updateResult()},a)}#_(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(e){this.#b(),this.#l=e,!(od||cs(this.options.enabled,this.#t)===!1||!sP(this.#l)||this.#l===0)&&(this.#u=Kh.setInterval(()=>{(this.options.refetchIntervalInBackground||sC.isFocused())&&this.#h()},this.#l))}#v(){this.#g(),this.#y(this.#_())}#x(){this.#c&&(Kh.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(Kh.clearInterval(this.#u),this.#u=void 0)}createResult(e,t){const a=this.#t,l=this.options,d=this.#i,_=this.#n,v=this.#a,P=e!==a?e.state:this.#r,{state:I}=e;let M={...I},R=!1,F;if(t._optimisticResults){const Pe=this.hasListeners(),Ne=!Pe&&pN(e,t),rt=Pe&&mN(e,a,t,l);(Ne||rt)&&(M={...M,...j4(I.data,e.options)}),t._optimisticResults==="isRestoring"&&(M.fetchStatus="idle")}let{error:q,errorUpdatedAt:H,status:j}=M;F=M.data;let $=!1;if(t.placeholderData!==void 0&&F===void 0&&j==="pending"){let Pe;d?.isPlaceholderData&&t.placeholderData===v?.placeholderData?(Pe=d.data,$=!0):Pe=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,Pe!==void 0&&(j="success",F=cP(d?.data,Pe,t),R=!0)}if(t.select&&F!==void 0&&!$)if(d&&F===_?.data&&t.select===this.#m)F=this.#d;else try{this.#m=t.select,F=t.select(F),F=cP(d?.data,F,t),this.#d=F,this.#o=null}catch(Pe){this.#o=Pe}this.#o&&(q=this.#o,F=this.#d,H=Date.now(),j="error");const Y=M.fetchStatus==="fetching",K=j==="pending",re=j==="error",se=K&&Y,J=F!==void 0,de={status:j,fetchStatus:M.fetchStatus,isPending:K,isSuccess:j==="success",isError:re,isInitialLoading:se,isLoading:se,data:F,dataUpdatedAt:M.dataUpdatedAt,error:q,errorUpdatedAt:H,failureCount:M.fetchFailureCount,failureReason:M.fetchFailureReason,errorUpdateCount:M.errorUpdateCount,isFetched:M.dataUpdateCount>0||M.errorUpdateCount>0,isFetchedAfterMount:M.dataUpdateCount>P.dataUpdateCount||M.errorUpdateCount>P.errorUpdateCount,isFetching:Y,isRefetching:Y&&!K,isLoadingError:re&&!J,isPaused:M.fetchStatus==="paused",isPlaceholderData:R,isRefetchError:re&&J,isStale:lC(e,t),refetch:this.refetch,promise:this.#s,isEnabled:cs(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const Pe=ke=>{de.status==="error"?ke.reject(de.error):de.data!==void 0&&ke.resolve(de.data)},Ne=()=>{const ke=this.#s=de.promise=uP();Pe(ke)},rt=this.#s;switch(rt.status){case"pending":e.queryHash===a.queryHash&&Pe(rt);break;case"fulfilled":(de.status==="error"||de.data!==rt.value)&&Ne();break;case"rejected":(de.status!=="error"||de.error!==rt.reason)&&Ne();break}}return de}updateResult(){const e=this.#i,t=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#a=this.options,this.#n.data!==void 0&&(this.#f=this.#t),x0(t,e))return;this.#i=t;const a=()=>{if(!e)return!0;const{notifyOnChangeProps:l}=this.options,d=typeof l=="function"?l():l;if(d==="all"||!d&&!this.#p.size)return!0;const _=new Set(d??this.#p);return this.options.throwOnError&&_.add("error"),Object.keys(this.#i).some(v=>{const i=v;return this.#i[i]!==e[i]&&_.has(i)})};this.#S({listeners:a()})}#w(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#r=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#S(e){fo.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function BZ(e,t){return cs(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function pN(e,t){return BZ(e,t)||e.state.data!==void 0&&dP(e,t,t.refetchOnMount)}function dP(e,t,a){if(cs(t.enabled,e)!==!1&&ju(t.staleTime,e)!=="static"){const l=typeof a=="function"?a(e):a;return l==="always"||l!==!1&&lC(e,t)}return!1}function mN(e,t,a,l){return(e!==t||cs(l.enabled,e)===!1)&&(!a.suspense||e.state.status!=="error")&&lC(e,a)}function lC(e,t){return cs(t.enabled,e)!==!1&&e.isStaleByTime(ju(t.staleTime,e))}function UZ(e,t){return!x0(e.getCurrentResult(),t)}function gN(e){return{onFetch:(t,a)=>{const l=t.options,d=t.fetchOptions?.meta?.fetchMore?.direction,_=t.state.data?.pages||[],v=t.state.data?.pageParams||[];let i={pages:[],pageParams:[]},P=0;const I=async()=>{let M=!1;const R=H=>{Object.defineProperty(H,"signal",{enumerable:!0,get:()=>(t.signal.aborted?M=!0:t.signal.addEventListener("abort",()=>{M=!0}),t.signal)})},F=R4(t.options,t.fetchOptions),q=async(H,j,$)=>{if(M)return Promise.reject();if(j==null&&H.pages.length)return Promise.resolve(H);const K=(()=>{const ae={client:t.client,queryKey:t.queryKey,pageParam:j,direction:$?"backward":"forward",meta:t.options.meta};return R(ae),ae})(),re=await F(K),{maxPages:se}=t.options,J=$?RZ:MZ;return{pages:J(H.pages,re,se),pageParams:J(H.pageParams,j,se)}};if(d&&_.length){const H=d==="backward",j=H?VZ:_N,$={pages:_,pageParams:v},Y=j(l,$);i=await q($,Y,H)}else{const H=e??_.length;do{const j=P===0?v[0]??l.initialPageParam:_N(l,i);if(P>0&&j==null)break;i=await q(i,j),P++}while(P<H)}return i};t.options.persister?t.fetchFn=()=>t.options.persister?.(I,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},a):t.fetchFn=I}}}function _N(e,{pages:t,pageParams:a}){const l=t.length-1;return t.length>0?e.getNextPageParam(t[l],t,a[l],a):void 0}function VZ(e,{pages:t,pageParams:a}){return t.length>0?e.getPreviousPageParam?.(t[0],t,a[0],a):void 0}var $Z=class extends L4{#e;#t;#r;#i;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#r=e.mutationCache,this.#t=[],this.state=e.state||z4(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#r.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#n({type:"continue"})},a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=N4({fn:()=>this.options.mutationFn?this.options.mutationFn(e,a):Promise.reject(new Error("No mutationFn found")),onFail:(_,v)=>{this.#n({type:"failed",failureCount:_,error:v})},onPause:()=>{this.#n({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});const l=this.state.status==="pending",d=!this.#i.canStart();try{if(l)t();else{this.#n({type:"pending",variables:e,isPaused:d}),await this.#r.config.onMutate?.(e,this,a);const v=await this.options.onMutate?.(e,a);v!==this.state.context&&this.#n({type:"pending",context:v,variables:e,isPaused:d})}const _=await this.#i.start();return await this.#r.config.onSuccess?.(_,e,this.state.context,this,a),await this.options.onSuccess?.(_,e,this.state.context,a),await this.#r.config.onSettled?.(_,null,this.state.variables,this.state.context,this,a),await this.options.onSettled?.(_,null,e,this.state.context,a),this.#n({type:"success",data:_}),_}catch(_){try{throw await this.#r.config.onError?.(_,e,this.state.context,this,a),await this.options.onError?.(_,e,this.state.context,a),await this.#r.config.onSettled?.(void 0,_,this.state.variables,this.state.context,this,a),await this.options.onSettled?.(void 0,_,e,this.state.context,a),_}finally{this.#n({type:"error",error:_})}}finally{this.#r.runNext(this)}}#n(e){const t=a=>{switch(e.type){case"failed":return{...a,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...a,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:e.error,failureCount:a.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),fo.batch(()=>{this.#t.forEach(a=>{a.onMutationUpdate(e)}),this.#r.notify({mutation:this,type:"updated",action:e})})}};function z4(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var qZ=class extends Jp{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(e,t,a){const l=new $Z({client:e,mutationCache:this,mutationId:++this.#r,options:e.defaultMutationOptions(t),state:a});return this.add(l),l}add(e){this.#e.add(e);const t=Vx(e);if(typeof t=="string"){const a=this.#t.get(t);a?a.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=Vx(e);if(typeof t=="string"){const a=this.#t.get(t);if(a)if(a.length>1){const l=a.indexOf(e);l!==-1&&a.splice(l,1)}else a[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Vx(e);if(typeof t=="string"){const l=this.#t.get(t)?.find(d=>d.state.status==="pending");return!l||l===e}else return!0}runNext(e){const t=Vx(e);return typeof t=="string"?this.#t.get(t)?.find(l=>l!==e&&l.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){fo.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(a=>uN(t,a))}findAll(e={}){return this.getAll().filter(t=>uN(e,t))}notify(e){fo.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return fo.batch(()=>Promise.all(e.map(t=>t.continue().catch(sa))))}};function Vx(e){return e.options.scope?.id}var GZ=class extends Jp{#e;#t=void 0;#r;#i;constructor(t,a){super(),this.#e=t,this.setOptions(a),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const a=this.options;this.options=this.#e.defaultMutationOptions(t),x0(this.options,a)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),a?.mutationKey&&this.options.mutationKey&&ad(a.mutationKey)!==ad(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#n(),this.#a(t)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#a()}mutate(t,a){return this.#i=a,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(t)}#n(){const t=this.#r?.state??z4();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#a(t){fo.batch(()=>{if(this.#i&&this.hasListeners()){const a=this.#t.variables,l=this.#t.context,d={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#i.onSuccess?.(t.data,a,l,d),this.#i.onSettled?.(t.data,null,a,l,d)):t?.type==="error"&&(this.#i.onError?.(t.error,a,l,d),this.#i.onSettled?.(void 0,t.error,a,l,d))}this.listeners.forEach(a=>{a(this.#t)})})}},HZ=class extends Jp{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,a){const l=t.queryKey,d=t.queryHash??oC(l,t);let _=this.get(d);return _||(_=new zZ({client:e,queryKey:l,queryHash:d,options:e.defaultQueryOptions(t),state:a,defaultOptions:e.getQueryDefaults(l)}),this.add(_)),_}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){fo.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(a=>cN(t,a))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(a=>cN(e,a)):t}notify(e){fo.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){fo.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){fo.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},WZ=class{#e;#t;#r;#i;#n;#a;#s;#o;constructor(e={}){this.#e=e.queryCache||new HZ,this.#t=e.mutationCache||new qZ,this.#r=e.defaultOptions||{},this.#i=new Map,this.#n=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#s=sC.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=b0.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#s?.(),this.#s=void 0,this.#o?.(),this.#o=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),a=this.#e.build(this,t),l=a.state.data;return l===void 0?this.fetchQuery(e):(e.revalidateIfStale&&a.isStaleByTime(ju(t.staleTime,a))&&this.prefetchQuery(t),Promise.resolve(l))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:a})=>{const l=a.data;return[t,l]})}setQueryData(e,t,a){const l=this.defaultQueryOptions({queryKey:e}),_=this.#e.get(l.queryHash)?.state.data,v=IZ(t,_);if(v!==void 0)return this.#e.build(this,l).setData(v,{...a,manual:!0})}setQueriesData(e,t,a){return fo.batch(()=>this.#e.findAll(e).map(({queryKey:l})=>[l,this.setQueryData(l,t,a)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;fo.batch(()=>{t.findAll(e).forEach(a=>{t.remove(a)})})}resetQueries(e,t){const a=this.#e;return fo.batch(()=>(a.findAll(e).forEach(l=>{l.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const a={revert:!0,...t},l=fo.batch(()=>this.#e.findAll(e).map(d=>d.cancel(a)));return Promise.all(l).then(sa).catch(sa)}invalidateQueries(e,t={}){return fo.batch(()=>(this.#e.findAll(e).forEach(a=>{a.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const a={...t,cancelRefetch:t.cancelRefetch??!0},l=fo.batch(()=>this.#e.findAll(e).filter(d=>!d.isDisabled()&&!d.isStatic()).map(d=>{let _=d.fetch(void 0,a);return a.throwOnError||(_=_.catch(sa)),d.state.fetchStatus==="paused"?Promise.resolve():_}));return Promise.all(l).then(sa)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const a=this.#e.build(this,t);return a.isStaleByTime(ju(t.staleTime,a))?a.fetch(t):Promise.resolve(a.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(sa).catch(sa)}fetchInfiniteQuery(e){return e.behavior=gN(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(sa).catch(sa)}ensureInfiniteQueryData(e){return e.behavior=gN(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return b0.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(e){this.#r=e}setQueryDefaults(e,t){this.#i.set(ad(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#i.values()],a={};return t.forEach(l=>{U_(e,l.queryKey)&&Object.assign(a,l.defaultOptions)}),a}setMutationDefaults(e,t){this.#n.set(ad(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#n.values()],a={};return t.forEach(l=>{U_(e,l.mutationKey)&&Object.assign(a,l.defaultOptions)}),a}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#r.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=oC(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===aC&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#r.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},F4=ie.createContext(void 0),B4=e=>{const t=ie.useContext(F4);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},ZZ=({client:e,children:t})=>(ie.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),T.jsx(F4.Provider,{value:e,children:t})),U4=ie.createContext(!1),XZ=()=>ie.useContext(U4);U4.Provider;function KZ(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var YZ=ie.createContext(KZ()),JZ=()=>ie.useContext(YZ),QZ=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},eX=e=>{ie.useEffect(()=>{e.clearReset()},[e])},tX=({result:e,errorResetBoundary:t,throwOnError:a,query:l,suspense:d})=>e.isError&&!t.isReset()&&!e.isFetching&&l&&(d&&e.data===void 0||D4(a,[e.error,l])),rX=e=>{if(e.suspense){const a=d=>d==="static"?d:Math.max(d??1e3,1e3),l=e.staleTime;e.staleTime=typeof l=="function"?(...d)=>a(l(...d)):a(l),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},nX=(e,t)=>e.isLoading&&e.isFetching&&!t,iX=(e,t)=>e?.suspense&&t.isPending,yN=(e,t,a)=>t.fetchOptimistic(e).catch(()=>{a.clearReset()});function oX(e,t,a){const l=XZ(),d=JZ(),_=B4(),v=_.defaultQueryOptions(e);_.getDefaultOptions().queries?._experimental_beforeQuery?.(v),v._optimisticResults=l?"isRestoring":"optimistic",rX(v),QZ(v,d),eX(d);const i=!_.getQueryCache().get(v.queryHash),[P]=ie.useState(()=>new t(_,v)),I=P.getOptimisticResult(v),M=!l&&e.subscribed!==!1;if(ie.useSyncExternalStore(ie.useCallback(R=>{const F=M?P.subscribe(fo.batchCalls(R)):sa;return P.updateResult(),F},[P,M]),()=>P.getCurrentResult(),()=>P.getCurrentResult()),ie.useEffect(()=>{P.setOptions(v)},[v,P]),iX(v,I))throw yN(v,P,d);if(tX({result:I,errorResetBoundary:d,throwOnError:v.throwOnError,query:_.getQueryCache().get(v.queryHash),suspense:v.suspense}))throw I.error;return _.getDefaultOptions().queries?._experimental_afterQuery?.(v,I),v.experimental_prefetchInRender&&!od&&nX(I,l)&&(i?yN(v,P,d):_.getQueryCache().get(v.queryHash)?.promise)?.catch(sa).finally(()=>{P.updateResult()}),v.notifyOnChangeProps?I:P.trackResult(I)}function Po(e,t){return oX(e,FZ)}function V4(e,t){const a=B4(),[l]=ie.useState(()=>new GZ(a,e));ie.useEffect(()=>{l.setOptions(e)},[l,e]);const d=ie.useSyncExternalStore(ie.useCallback(v=>l.subscribe(fo.batchCalls(v)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),_=ie.useCallback((v,i)=>{l.mutate(v,i).catch(sa)},[l]);if(d.error&&D4(l.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:_,mutateAsync:d.mutate}}async function $4(e){if(!e.ok){const t=await e.text()||e.statusText;throw new Error(`${e.status}: ${t}`)}}async function os(e,t,a){const l=await fetch(t,{method:e,headers:{},body:void 0,credentials:"include"});return await $4(l),l}const aX=({on401:e})=>async({queryKey:t})=>{const a=await fetch(t.join("/"),{credentials:"include"});return await $4(a),await a.json()},sX=new WZ({defaultOptions:{queries:{queryFn:aX({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),lX=1,cX=1e6;let FS=0;function uX(){return FS=(FS+1)%Number.MAX_SAFE_INTEGER,FS.toString()}const BS=new Map,vN=e=>{if(BS.has(e))return;const t=setTimeout(()=>{BS.delete(e),R_({type:"REMOVE_TOAST",toastId:e})},cX);BS.set(e,t)},hX=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,lX)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?vN(a):e.toasts.forEach(l=>{vN(l.id)}),{...e,toasts:e.toasts.map(l=>l.id===a||a===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(a=>a.id!==t.toastId)}}},d0=[];let f0={toasts:[]};function R_(e){f0=hX(f0,e),d0.forEach(t=>{t(f0)})}function dX({...e}){const t=uX(),a=d=>R_({type:"UPDATE_TOAST",toast:{...d,id:t}}),l=()=>R_({type:"DISMISS_TOAST",toastId:t});return R_({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:d=>{d||l()}}}),{id:t,dismiss:l,update:a}}function Qp(){const[e,t]=ie.useState(f0);return ie.useEffect(()=>(d0.push(t),()=>{const a=d0.indexOf(t);a>-1&&d0.splice(a,1)}),[e]),{...e,toast:dX,dismiss:a=>R_({type:"DISMISS_TOAST",toastId:a})}}var em=s4();const fX=si(em);function Pr(e,t,{checkForDefaultPrevented:a=!0}={}){return function(d){if(e?.(d),a===!1||!d.defaultPrevented)return t?.(d)}}function xN(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Mb(...e){return t=>{let a=!1;const l=e.map(d=>{const _=xN(d,t);return!a&&typeof _=="function"&&(a=!0),_});if(a)return()=>{for(let d=0;d<l.length;d++){const _=l[d];typeof _=="function"?_():xN(e[d],null)}}}}function ui(...e){return ie.useCallback(Mb(...e),e)}function Gs(e,t=[]){let a=[];function l(_,v){const i=ie.createContext(v),P=a.length;a=[...a,v];const I=R=>{const{scope:F,children:q,...H}=R,j=F?.[e]?.[P]||i,$=ie.useMemo(()=>H,Object.values(H));return T.jsx(j.Provider,{value:$,children:q})};I.displayName=_+"Provider";function M(R,F){const q=F?.[e]?.[P]||i,H=ie.useContext(q);if(H)return H;if(v!==void 0)return v;throw new Error(`\`${R}\` must be used within \`${_}\``)}return[I,M]}const d=()=>{const _=a.map(v=>ie.createContext(v));return function(i){const P=i?.[e]||_;return ie.useMemo(()=>({[`__scope${e}`]:{...i,[e]:P}}),[i,P])}};return d.scopeName=e,[l,pX(d,...t)]}function pX(...e){const t=e[0];if(e.length===1)return t;const a=()=>{const l=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(_){const v=l.reduce((i,{useScope:P,scopeName:I})=>{const R=P(_)[`__scope${I}`];return{...i,...R}},{});return ie.useMemo(()=>({[`__scope${t.scopeName}`]:v}),[v])}};return a.scopeName=t.scopeName,a}function wp(e){const t=gX(e),a=ie.forwardRef((l,d)=>{const{children:_,...v}=l,i=ie.Children.toArray(_),P=i.find(yX);if(P){const I=P.props.children,M=i.map(R=>R===P?ie.Children.count(I)>1?ie.Children.only(null):ie.isValidElement(I)?I.props.children:null:R);return T.jsx(t,{...v,ref:d,children:ie.isValidElement(I)?ie.cloneElement(I,void 0,M):null})}return T.jsx(t,{...v,ref:d,children:_})});return a.displayName=`${e}.Slot`,a}var mX=wp("Slot");function gX(e){const t=ie.forwardRef((a,l)=>{const{children:d,..._}=a;if(ie.isValidElement(d)){const v=xX(d),i=vX(_,d.props);return d.type!==ie.Fragment&&(i.ref=l?Mb(l,v):v),ie.cloneElement(d,i)}return ie.Children.count(d)>1?ie.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var q4=Symbol("radix.slottable");function _X(e){const t=({children:a})=>T.jsx(T.Fragment,{children:a});return t.displayName=`${e}.Slottable`,t.__radixId=q4,t}function yX(e){return ie.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===q4}function vX(e,t){const a={...t};for(const l in t){const d=e[l],_=t[l];/^on[A-Z]/.test(l)?d&&_?a[l]=(...i)=>{const P=_(...i);return d(...i),P}:d&&(a[l]=d):l==="style"?a[l]={...d,..._}:l==="className"&&(a[l]=[d,_].filter(Boolean).join(" "))}return{...e,...a}}function xX(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?e.props.ref:e.props.ref||e.ref)}function Cy(e){const t=e+"CollectionProvider",[a,l]=Gs(t),[d,_]=a(t,{collectionRef:{current:null},itemMap:new Map}),v=j=>{const{scope:$,children:Y}=j,K=He.useRef(null),re=He.useRef(new Map).current;return T.jsx(d,{scope:$,itemMap:re,collectionRef:K,children:Y})};v.displayName=t;const i=e+"CollectionSlot",P=wp(i),I=He.forwardRef((j,$)=>{const{scope:Y,children:K}=j,re=_(i,Y),se=ui($,re.collectionRef);return T.jsx(P,{ref:se,children:K})});I.displayName=i;const M=e+"CollectionItemSlot",R="data-radix-collection-item",F=wp(M),q=He.forwardRef((j,$)=>{const{scope:Y,children:K,...re}=j,se=He.useRef(null),J=ui($,se),ae=_(M,Y);return He.useEffect(()=>(ae.itemMap.set(se,{ref:se,...re}),()=>void ae.itemMap.delete(se))),T.jsx(F,{[R]:"",ref:J,children:K})});q.displayName=M;function H(j){const $=_(e+"CollectionConsumer",j);return He.useCallback(()=>{const K=$.collectionRef.current;if(!K)return[];const re=Array.from(K.querySelectorAll(`[${R}]`));return Array.from($.itemMap.values()).sort((ae,de)=>re.indexOf(ae.ref.current)-re.indexOf(de.ref.current))},[$.collectionRef,$.itemMap])}return[{Provider:v,Slot:I,ItemSlot:q},H,l]}var bX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],yn=bX.reduce((e,t)=>{const a=wp(`Primitive.${t}`),l=ie.forwardRef((d,_)=>{const{asChild:v,...i}=d,P=v?a:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),T.jsx(P,{...i,ref:_})});return l.displayName=`Primitive.${t}`,{...e,[t]:l}},{});function cC(e,t){e&&em.flushSync(()=>e.dispatchEvent(t))}function ga(e){const t=ie.useRef(e);return ie.useEffect(()=>{t.current=e}),ie.useMemo(()=>(...a)=>t.current?.(...a),[])}function wX(e,t=globalThis?.document){const a=ga(e);ie.useEffect(()=>{const l=d=>{d.key==="Escape"&&a(d)};return t.addEventListener("keydown",l,{capture:!0}),()=>t.removeEventListener("keydown",l,{capture:!0})},[a,t])}var SX="DismissableLayer",fP="dismissableLayer.update",TX="dismissableLayer.pointerDownOutside",AX="dismissableLayer.focusOutside",bN,G4=ie.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Oy=ie.forwardRef((e,t)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:_,onInteractOutside:v,onDismiss:i,...P}=e,I=ie.useContext(G4),[M,R]=ie.useState(null),F=M?.ownerDocument??globalThis?.document,[,q]=ie.useState({}),H=ui(t,de=>R(de)),j=Array.from(I.layers),[$]=[...I.layersWithOutsidePointerEventsDisabled].slice(-1),Y=j.indexOf($),K=M?j.indexOf(M):-1,re=I.layersWithOutsidePointerEventsDisabled.size>0,se=K>=Y,J=PX(de=>{const Pe=de.target,Ne=[...I.branches].some(rt=>rt.contains(Pe));!se||Ne||(d?.(de),v?.(de),de.defaultPrevented||i?.())},F),ae=IX(de=>{const Pe=de.target;[...I.branches].some(rt=>rt.contains(Pe))||(_?.(de),v?.(de),de.defaultPrevented||i?.())},F);return wX(de=>{K===I.layers.size-1&&(l?.(de),!de.defaultPrevented&&i&&(de.preventDefault(),i()))},F),ie.useEffect(()=>{if(M)return a&&(I.layersWithOutsidePointerEventsDisabled.size===0&&(bN=F.body.style.pointerEvents,F.body.style.pointerEvents="none"),I.layersWithOutsidePointerEventsDisabled.add(M)),I.layers.add(M),wN(),()=>{a&&I.layersWithOutsidePointerEventsDisabled.size===1&&(F.body.style.pointerEvents=bN)}},[M,F,a,I]),ie.useEffect(()=>()=>{M&&(I.layers.delete(M),I.layersWithOutsidePointerEventsDisabled.delete(M),wN())},[M,I]),ie.useEffect(()=>{const de=()=>q({});return document.addEventListener(fP,de),()=>document.removeEventListener(fP,de)},[]),T.jsx(yn.div,{...P,ref:H,style:{pointerEvents:re?se?"auto":"none":void 0,...e.style},onFocusCapture:Pr(e.onFocusCapture,ae.onFocusCapture),onBlurCapture:Pr(e.onBlurCapture,ae.onBlurCapture),onPointerDownCapture:Pr(e.onPointerDownCapture,J.onPointerDownCapture)})});Oy.displayName=SX;var EX="DismissableLayerBranch",H4=ie.forwardRef((e,t)=>{const a=ie.useContext(G4),l=ie.useRef(null),d=ui(t,l);return ie.useEffect(()=>{const _=l.current;if(_)return a.branches.add(_),()=>{a.branches.delete(_)}},[a.branches]),T.jsx(yn.div,{...e,ref:d})});H4.displayName=EX;function PX(e,t=globalThis?.document){const a=ga(e),l=ie.useRef(!1),d=ie.useRef(()=>{});return ie.useEffect(()=>{const _=i=>{if(i.target&&!l.current){let P=function(){W4(TX,a,I,{discrete:!0})};const I={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",d.current),d.current=P,t.addEventListener("click",d.current,{once:!0})):P()}else t.removeEventListener("click",d.current);l.current=!1},v=window.setTimeout(()=>{t.addEventListener("pointerdown",_)},0);return()=>{window.clearTimeout(v),t.removeEventListener("pointerdown",_),t.removeEventListener("click",d.current)}},[t,a]),{onPointerDownCapture:()=>l.current=!0}}function IX(e,t=globalThis?.document){const a=ga(e),l=ie.useRef(!1);return ie.useEffect(()=>{const d=_=>{_.target&&!l.current&&W4(AX,a,{originalEvent:_},{discrete:!1})};return t.addEventListener("focusin",d),()=>t.removeEventListener("focusin",d)},[t,a]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function wN(){const e=new CustomEvent(fP);document.dispatchEvent(e)}function W4(e,t,a,{discrete:l}){const d=a.originalEvent.target,_=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:a});t&&d.addEventListener(e,t,{once:!0}),l?cC(d,_):d.dispatchEvent(_)}var CX=Oy,OX=H4,Co=globalThis?.document?ie.useLayoutEffect:()=>{},MX="Portal",Rb=ie.forwardRef((e,t)=>{const{container:a,...l}=e,[d,_]=ie.useState(!1);Co(()=>_(!0),[]);const v=a||d&&globalThis?.document?.body;return v?fX.createPortal(T.jsx(yn.div,{...l,ref:t}),v):null});Rb.displayName=MX;function RX(e,t){return ie.useReducer((a,l)=>t[a][l]??a,e)}var Rc=e=>{const{present:t,children:a}=e,l=DX(t),d=typeof a=="function"?a({present:l.isPresent}):ie.Children.only(a),_=ui(l.ref,kX(d));return typeof a=="function"||l.isPresent?ie.cloneElement(d,{ref:_}):null};Rc.displayName="Presence";function DX(e){const[t,a]=ie.useState(),l=ie.useRef(null),d=ie.useRef(e),_=ie.useRef("none"),v=e?"mounted":"unmounted",[i,P]=RX(v,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ie.useEffect(()=>{const I=$x(l.current);_.current=i==="mounted"?I:"none"},[i]),Co(()=>{const I=l.current,M=d.current;if(M!==e){const F=_.current,q=$x(I);e?P("MOUNT"):q==="none"||I?.display==="none"?P("UNMOUNT"):P(M&&F!==q?"ANIMATION_OUT":"UNMOUNT"),d.current=e}},[e,P]),Co(()=>{if(t){let I;const M=t.ownerDocument.defaultView??window,R=q=>{const j=$x(l.current).includes(CSS.escape(q.animationName));if(q.target===t&&j&&(P("ANIMATION_END"),!d.current)){const $=t.style.animationFillMode;t.style.animationFillMode="forwards",I=M.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=$)})}},F=q=>{q.target===t&&(_.current=$x(l.current))};return t.addEventListener("animationstart",F),t.addEventListener("animationcancel",R),t.addEventListener("animationend",R),()=>{M.clearTimeout(I),t.removeEventListener("animationstart",F),t.removeEventListener("animationcancel",R),t.removeEventListener("animationend",R)}}else P("ANIMATION_END")},[t,P]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:ie.useCallback(I=>{l.current=I?getComputedStyle(I):null,a(I)},[])}}function $x(e){return e?.animationName||"none"}function kX(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?e.props.ref:e.props.ref||e.ref)}var NX=eC[" useInsertionEffect ".trim().toString()]||Co;function Il({prop:e,defaultProp:t,onChange:a=()=>{},caller:l}){const[d,_,v]=LX({defaultProp:t,onChange:a}),i=e!==void 0,P=i?e:d;{const M=ie.useRef(e!==void 0);ie.useEffect(()=>{const R=M.current;R!==i&&console.warn(`${l} is changing from ${R?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),M.current=i},[i,l])}const I=ie.useCallback(M=>{if(i){const R=jX(M)?M(e):M;R!==e&&v.current?.(R)}else _(M)},[i,e,_,v]);return[P,I]}function LX({defaultProp:e,onChange:t}){const[a,l]=ie.useState(e),d=ie.useRef(a),_=ie.useRef(t);return NX(()=>{_.current=t},[t]),ie.useEffect(()=>{d.current!==a&&(_.current?.(a),d.current=a)},[a,d]),[a,l,_]}function jX(e){return typeof e=="function"}var Z4=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),zX="VisuallyHidden",Db=ie.forwardRef((e,t)=>T.jsx(yn.span,{...e,ref:t,style:{...Z4,...e.style}}));Db.displayName=zX;var FX=Db,uC="ToastProvider",[hC,BX,UX]=Cy("Toast"),[X4]=Gs("Toast",[UX]),[VX,kb]=X4(uC),K4=e=>{const{__scopeToast:t,label:a="Notification",duration:l=5e3,swipeDirection:d="right",swipeThreshold:_=50,children:v}=e,[i,P]=ie.useState(null),[I,M]=ie.useState(0),R=ie.useRef(!1),F=ie.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${uC}\`. Expected non-empty \`string\`.`),T.jsx(hC.Provider,{scope:t,children:T.jsx(VX,{scope:t,label:a,duration:l,swipeDirection:d,swipeThreshold:_,toastCount:I,viewport:i,onViewportChange:P,onToastAdd:ie.useCallback(()=>M(q=>q+1),[]),onToastRemove:ie.useCallback(()=>M(q=>q-1),[]),isFocusedToastEscapeKeyDownRef:R,isClosePausedRef:F,children:v})})};K4.displayName=uC;var Y4="ToastViewport",$X=["F8"],pP="toast.viewportPause",mP="toast.viewportResume",J4=ie.forwardRef((e,t)=>{const{__scopeToast:a,hotkey:l=$X,label:d="Notifications ({hotkey})",..._}=e,v=kb(Y4,a),i=BX(a),P=ie.useRef(null),I=ie.useRef(null),M=ie.useRef(null),R=ie.useRef(null),F=ui(t,R,v.onViewportChange),q=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),H=v.toastCount>0;ie.useEffect(()=>{const $=Y=>{l.length!==0&&l.every(re=>Y[re]||Y.code===re)&&R.current?.focus()};return document.addEventListener("keydown",$),()=>document.removeEventListener("keydown",$)},[l]),ie.useEffect(()=>{const $=P.current,Y=R.current;if(H&&$&&Y){const K=()=>{if(!v.isClosePausedRef.current){const ae=new CustomEvent(pP);Y.dispatchEvent(ae),v.isClosePausedRef.current=!0}},re=()=>{if(v.isClosePausedRef.current){const ae=new CustomEvent(mP);Y.dispatchEvent(ae),v.isClosePausedRef.current=!1}},se=ae=>{!$.contains(ae.relatedTarget)&&re()},J=()=>{$.contains(document.activeElement)||re()};return $.addEventListener("focusin",K),$.addEventListener("focusout",se),$.addEventListener("pointermove",K),$.addEventListener("pointerleave",J),window.addEventListener("blur",K),window.addEventListener("focus",re),()=>{$.removeEventListener("focusin",K),$.removeEventListener("focusout",se),$.removeEventListener("pointermove",K),$.removeEventListener("pointerleave",J),window.removeEventListener("blur",K),window.removeEventListener("focus",re)}}},[H,v.isClosePausedRef]);const j=ie.useCallback(({tabbingDirection:$})=>{const K=i().map(re=>{const se=re.ref.current,J=[se,...rK(se)];return $==="forwards"?J:J.reverse()});return($==="forwards"?K.reverse():K).flat()},[i]);return ie.useEffect(()=>{const $=R.current;if($){const Y=K=>{const re=K.altKey||K.ctrlKey||K.metaKey;if(K.key==="Tab"&&!re){const J=document.activeElement,ae=K.shiftKey;if(K.target===$&&ae){I.current?.focus();return}const Ne=j({tabbingDirection:ae?"backwards":"forwards"}),rt=Ne.findIndex(ke=>ke===J);US(Ne.slice(rt+1))?K.preventDefault():ae?I.current?.focus():M.current?.focus()}};return $.addEventListener("keydown",Y),()=>$.removeEventListener("keydown",Y)}},[i,j]),T.jsxs(OX,{ref:P,role:"region","aria-label":d.replace("{hotkey}",q),tabIndex:-1,style:{pointerEvents:H?void 0:"none"},children:[H&&T.jsx(gP,{ref:I,onFocusFromOutsideViewport:()=>{const $=j({tabbingDirection:"forwards"});US($)}}),T.jsx(hC.Slot,{scope:a,children:T.jsx(yn.ol,{tabIndex:-1,..._,ref:F})}),H&&T.jsx(gP,{ref:M,onFocusFromOutsideViewport:()=>{const $=j({tabbingDirection:"backwards"});US($)}})]})});J4.displayName=Y4;var Q4="ToastFocusProxy",gP=ie.forwardRef((e,t)=>{const{__scopeToast:a,onFocusFromOutsideViewport:l,...d}=e,_=kb(Q4,a);return T.jsx(Db,{tabIndex:0,...d,ref:t,style:{position:"fixed"},onFocus:v=>{const i=v.relatedTarget;!_.viewport?.contains(i)&&l()}})});gP.displayName=Q4;var My="Toast",qX="toast.swipeStart",GX="toast.swipeMove",HX="toast.swipeCancel",WX="toast.swipeEnd",eU=ie.forwardRef((e,t)=>{const{forceMount:a,open:l,defaultOpen:d,onOpenChange:_,...v}=e,[i,P]=Il({prop:l,defaultProp:d??!0,onChange:_,caller:My});return T.jsx(Rc,{present:a||i,children:T.jsx(KX,{open:i,...v,ref:t,onClose:()=>P(!1),onPause:ga(e.onPause),onResume:ga(e.onResume),onSwipeStart:Pr(e.onSwipeStart,I=>{I.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Pr(e.onSwipeMove,I=>{const{x:M,y:R}=I.detail.delta;I.currentTarget.setAttribute("data-swipe","move"),I.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${M}px`),I.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${R}px`)}),onSwipeCancel:Pr(e.onSwipeCancel,I=>{I.currentTarget.setAttribute("data-swipe","cancel"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),I.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),I.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Pr(e.onSwipeEnd,I=>{const{x:M,y:R}=I.detail.delta;I.currentTarget.setAttribute("data-swipe","end"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),I.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),I.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${M}px`),I.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${R}px`),P(!1)})})})});eU.displayName=My;var[ZX,XX]=X4(My,{onClose(){}}),KX=ie.forwardRef((e,t)=>{const{__scopeToast:a,type:l="foreground",duration:d,open:_,onClose:v,onEscapeKeyDown:i,onPause:P,onResume:I,onSwipeStart:M,onSwipeMove:R,onSwipeCancel:F,onSwipeEnd:q,...H}=e,j=kb(My,a),[$,Y]=ie.useState(null),K=ui(t,Je=>Y(Je)),re=ie.useRef(null),se=ie.useRef(null),J=d||j.duration,ae=ie.useRef(0),de=ie.useRef(J),Pe=ie.useRef(0),{onToastAdd:Ne,onToastRemove:rt}=j,ke=ga(()=>{$?.contains(document.activeElement)&&j.viewport?.focus(),v()}),Ze=ie.useCallback(Je=>{!Je||Je===1/0||(window.clearTimeout(Pe.current),ae.current=new Date().getTime(),Pe.current=window.setTimeout(ke,Je))},[ke]);ie.useEffect(()=>{const Je=j.viewport;if(Je){const ot=()=>{Ze(de.current),I?.()},it=()=>{const Pt=new Date().getTime()-ae.current;de.current=de.current-Pt,window.clearTimeout(Pe.current),P?.()};return Je.addEventListener(pP,it),Je.addEventListener(mP,ot),()=>{Je.removeEventListener(pP,it),Je.removeEventListener(mP,ot)}}},[j.viewport,J,P,I,Ze]),ie.useEffect(()=>{_&&!j.isClosePausedRef.current&&Ze(J)},[_,J,j.isClosePausedRef,Ze]),ie.useEffect(()=>(Ne(),()=>rt()),[Ne,rt]);const nt=ie.useMemo(()=>$?sU($):null,[$]);return j.viewport?T.jsxs(T.Fragment,{children:[nt&&T.jsx(YX,{__scopeToast:a,role:"status","aria-live":l==="foreground"?"assertive":"polite",children:nt}),T.jsx(ZX,{scope:a,onClose:ke,children:em.createPortal(T.jsx(hC.ItemSlot,{scope:a,children:T.jsx(CX,{asChild:!0,onEscapeKeyDown:Pr(i,()=>{j.isFocusedToastEscapeKeyDownRef.current||ke(),j.isFocusedToastEscapeKeyDownRef.current=!1}),children:T.jsx(yn.li,{tabIndex:0,"data-state":_?"open":"closed","data-swipe-direction":j.swipeDirection,...H,ref:K,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Pr(e.onKeyDown,Je=>{Je.key==="Escape"&&(i?.(Je.nativeEvent),Je.nativeEvent.defaultPrevented||(j.isFocusedToastEscapeKeyDownRef.current=!0,ke()))}),onPointerDown:Pr(e.onPointerDown,Je=>{Je.button===0&&(re.current={x:Je.clientX,y:Je.clientY})}),onPointerMove:Pr(e.onPointerMove,Je=>{if(!re.current)return;const ot=Je.clientX-re.current.x,it=Je.clientY-re.current.y,Pt=!!se.current,Ot=["left","right"].includes(j.swipeDirection),yt=["left","up"].includes(j.swipeDirection)?Math.min:Math.max,ar=Ot?yt(0,ot):0,qt=Ot?0:yt(0,it),rr=Je.pointerType==="touch"?10:2,Tr={x:ar,y:qt},an={originalEvent:Je,delta:Tr};Pt?(se.current=Tr,qx(GX,R,an,{discrete:!1})):SN(Tr,j.swipeDirection,rr)?(se.current=Tr,qx(qX,M,an,{discrete:!1}),Je.target.setPointerCapture(Je.pointerId)):(Math.abs(ot)>rr||Math.abs(it)>rr)&&(re.current=null)}),onPointerUp:Pr(e.onPointerUp,Je=>{const ot=se.current,it=Je.target;if(it.hasPointerCapture(Je.pointerId)&&it.releasePointerCapture(Je.pointerId),se.current=null,re.current=null,ot){const Pt=Je.currentTarget,Ot={originalEvent:Je,delta:ot};SN(ot,j.swipeDirection,j.swipeThreshold)?qx(WX,q,Ot,{discrete:!0}):qx(HX,F,Ot,{discrete:!0}),Pt.addEventListener("click",yt=>yt.preventDefault(),{once:!0})}})})})}),j.viewport)})]}):null}),YX=e=>{const{__scopeToast:t,children:a,...l}=e,d=kb(My,t),[_,v]=ie.useState(!1),[i,P]=ie.useState(!1);return eK(()=>v(!0)),ie.useEffect(()=>{const I=window.setTimeout(()=>P(!0),1e3);return()=>window.clearTimeout(I)},[]),i?null:T.jsx(Rb,{asChild:!0,children:T.jsx(Db,{...l,children:_&&T.jsxs(T.Fragment,{children:[d.label," ",a]})})})},JX="ToastTitle",tU=ie.forwardRef((e,t)=>{const{__scopeToast:a,...l}=e;return T.jsx(yn.div,{...l,ref:t})});tU.displayName=JX;var QX="ToastDescription",rU=ie.forwardRef((e,t)=>{const{__scopeToast:a,...l}=e;return T.jsx(yn.div,{...l,ref:t})});rU.displayName=QX;var nU="ToastAction",iU=ie.forwardRef((e,t)=>{const{altText:a,...l}=e;return a.trim()?T.jsx(aU,{altText:a,asChild:!0,children:T.jsx(dC,{...l,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${nU}\`. Expected non-empty \`string\`.`),null)});iU.displayName=nU;var oU="ToastClose",dC=ie.forwardRef((e,t)=>{const{__scopeToast:a,...l}=e,d=XX(oU,a);return T.jsx(aU,{asChild:!0,children:T.jsx(yn.button,{type:"button",...l,ref:t,onClick:Pr(e.onClick,d.onClose)})})});dC.displayName=oU;var aU=ie.forwardRef((e,t)=>{const{__scopeToast:a,altText:l,...d}=e;return T.jsx(yn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...d,ref:t})});function sU(e){const t=[];return Array.from(e.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&t.push(l.textContent),tK(l)){const d=l.ariaHidden||l.hidden||l.style.display==="none",_=l.dataset.radixToastAnnounceExclude==="";if(!d)if(_){const v=l.dataset.radixToastAnnounceAlt;v&&t.push(v)}else t.push(...sU(l))}}),t}function qx(e,t,a,{discrete:l}){const d=a.originalEvent.currentTarget,_=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:a});t&&d.addEventListener(e,t,{once:!0}),l?cC(d,_):d.dispatchEvent(_)}var SN=(e,t,a=0)=>{const l=Math.abs(e.x),d=Math.abs(e.y),_=l>d;return t==="left"||t==="right"?_&&l>a:!_&&d>a};function eK(e=()=>{}){const t=ga(e);Co(()=>{let a=0,l=0;return a=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(l)}},[t])}function tK(e){return e.nodeType===e.ELEMENT_NODE}function rK(e){const t=[],a=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const d=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||d?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)t.push(a.currentNode);return t}function US(e){const t=document.activeElement;return e.some(a=>a===t?!0:(a.focus(),document.activeElement!==t))}var nK=K4,lU=J4,cU=eU,uU=tU,hU=rU,dU=iU,fU=dC;function pU(e){var t,a,l="";if(typeof e=="string"||typeof e=="number")l+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(t=0;t<d;t++)e[t]&&(a=pU(e[t]))&&(l&&(l+=" "),l+=a)}else for(a in e)e[a]&&(l&&(l+=" "),l+=a);return l}function Sn(){for(var e,t,a=0,l="",d=arguments.length;a<d;a++)(e=arguments[a])&&(t=pU(e))&&(l&&(l+=" "),l+=t);return l}const TN=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,AN=Sn,fC=(e,t)=>a=>{var l;if(t?.variants==null)return AN(e,a?.class,a?.className);const{variants:d,defaultVariants:_}=t,v=Object.keys(d).map(I=>{const M=a?.[I],R=_?.[I];if(M===null)return null;const F=TN(M)||TN(R);return d[I][F]}),i=a&&Object.entries(a).reduce((I,M)=>{let[R,F]=M;return F===void 0||(I[R]=F),I},{}),P=t==null||(l=t.compoundVariants)===null||l===void 0?void 0:l.reduce((I,M)=>{let{class:R,className:F,...q}=M;return Object.entries(q).every(H=>{let[j,$]=H;return Array.isArray($)?$.includes({..._,...i}[j]):{..._,...i}[j]===$})?[...I,R,F]:I},[]);return AN(e,v,P,a?.class,a?.className)},pC="-",iK=e=>{const t=aK(e),{conflictingClassGroups:a,conflictingClassGroupModifiers:l}=e;return{getClassGroupId:v=>{const i=v.split(pC);return i[0]===""&&i.length!==1&&i.shift(),mU(i,t)||oK(v)},getConflictingClassGroupIds:(v,i)=>{const P=a[v]||[];return i&&l[v]?[...P,...l[v]]:P}}},mU=(e,t)=>{if(e.length===0)return t.classGroupId;const a=e[0],l=t.nextPart.get(a),d=l?mU(e.slice(1),l):void 0;if(d)return d;if(t.validators.length===0)return;const _=e.join(pC);return t.validators.find(({validator:v})=>v(_))?.classGroupId},EN=/^\[(.+)\]$/,oK=e=>{if(EN.test(e)){const t=EN.exec(e)[1],a=t?.substring(0,t.indexOf(":"));if(a)return"arbitrary.."+a}},aK=e=>{const{theme:t,prefix:a}=e,l={nextPart:new Map,validators:[]};return lK(Object.entries(e.classGroups),a).forEach(([_,v])=>{_P(v,l,_,t)}),l},_P=(e,t,a,l)=>{e.forEach(d=>{if(typeof d=="string"){const _=d===""?t:PN(t,d);_.classGroupId=a;return}if(typeof d=="function"){if(sK(d)){_P(d(l),t,a,l);return}t.validators.push({validator:d,classGroupId:a});return}Object.entries(d).forEach(([_,v])=>{_P(v,PN(t,_),a,l)})})},PN=(e,t)=>{let a=e;return t.split(pC).forEach(l=>{a.nextPart.has(l)||a.nextPart.set(l,{nextPart:new Map,validators:[]}),a=a.nextPart.get(l)}),a},sK=e=>e.isThemeGetter,lK=(e,t)=>t?e.map(([a,l])=>{const d=l.map(_=>typeof _=="string"?t+_:typeof _=="object"?Object.fromEntries(Object.entries(_).map(([v,i])=>[t+v,i])):_);return[a,d]}):e,cK=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,a=new Map,l=new Map;const d=(_,v)=>{a.set(_,v),t++,t>e&&(t=0,l=a,a=new Map)};return{get(_){let v=a.get(_);if(v!==void 0)return v;if((v=l.get(_))!==void 0)return d(_,v),v},set(_,v){a.has(_)?a.set(_,v):d(_,v)}}},gU="!",uK=e=>{const{separator:t,experimentalParseClassName:a}=e,l=t.length===1,d=t[0],_=t.length,v=i=>{const P=[];let I=0,M=0,R;for(let $=0;$<i.length;$++){let Y=i[$];if(I===0){if(Y===d&&(l||i.slice($,$+_)===t)){P.push(i.slice(M,$)),M=$+_;continue}if(Y==="/"){R=$;continue}}Y==="["?I++:Y==="]"&&I--}const F=P.length===0?i:i.substring(M),q=F.startsWith(gU),H=q?F.substring(1):F,j=R&&R>M?R-M:void 0;return{modifiers:P,hasImportantModifier:q,baseClassName:H,maybePostfixModifierPosition:j}};return a?i=>a({className:i,parseClassName:v}):v},hK=e=>{if(e.length<=1)return e;const t=[];let a=[];return e.forEach(l=>{l[0]==="["?(t.push(...a.sort(),l),a=[]):a.push(l)}),t.push(...a.sort()),t},dK=e=>({cache:cK(e.cacheSize),parseClassName:uK(e),...iK(e)}),fK=/\s+/,pK=(e,t)=>{const{parseClassName:a,getClassGroupId:l,getConflictingClassGroupIds:d}=t,_=[],v=e.trim().split(fK);let i="";for(let P=v.length-1;P>=0;P-=1){const I=v[P],{modifiers:M,hasImportantModifier:R,baseClassName:F,maybePostfixModifierPosition:q}=a(I);let H=!!q,j=l(H?F.substring(0,q):F);if(!j){if(!H){i=I+(i.length>0?" "+i:i);continue}if(j=l(F),!j){i=I+(i.length>0?" "+i:i);continue}H=!1}const $=hK(M).join(":"),Y=R?$+gU:$,K=Y+j;if(_.includes(K))continue;_.push(K);const re=d(j,H);for(let se=0;se<re.length;++se){const J=re[se];_.push(Y+J)}i=I+(i.length>0?" "+i:i)}return i};function mK(){let e=0,t,a,l="";for(;e<arguments.length;)(t=arguments[e++])&&(a=_U(t))&&(l&&(l+=" "),l+=a);return l}const _U=e=>{if(typeof e=="string")return e;let t,a="";for(let l=0;l<e.length;l++)e[l]&&(t=_U(e[l]))&&(a&&(a+=" "),a+=t);return a};function gK(e,...t){let a,l,d,_=v;function v(P){const I=t.reduce((M,R)=>R(M),e());return a=dK(I),l=a.cache.get,d=a.cache.set,_=i,i(P)}function i(P){const I=l(P);if(I)return I;const M=pK(P,a);return d(P,M),M}return function(){return _(mK.apply(null,arguments))}}const Ri=e=>{const t=a=>a[e]||[];return t.isThemeGetter=!0,t},yU=/^\[(?:([a-z-]+):)?(.+)\]$/i,_K=/^\d+\/\d+$/,yK=new Set(["px","full","screen"]),vK=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,xK=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,bK=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,wK=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,SK=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,fc=e=>mp(e)||yK.has(e)||_K.test(e),Pu=e=>tm(e,"length",MK),mp=e=>!!e&&!Number.isNaN(Number(e)),VS=e=>tm(e,"number",mp),u_=e=>!!e&&Number.isInteger(Number(e)),TK=e=>e.endsWith("%")&&mp(e.slice(0,-1)),In=e=>yU.test(e),Iu=e=>vK.test(e),AK=new Set(["length","size","percentage"]),EK=e=>tm(e,AK,vU),PK=e=>tm(e,"position",vU),IK=new Set(["image","url"]),CK=e=>tm(e,IK,DK),OK=e=>tm(e,"",RK),h_=()=>!0,tm=(e,t,a)=>{const l=yU.exec(e);return l?l[1]?typeof t=="string"?l[1]===t:t.has(l[1]):a(l[2]):!1},MK=e=>xK.test(e)&&!bK.test(e),vU=()=>!1,RK=e=>wK.test(e),DK=e=>SK.test(e),kK=()=>{const e=Ri("colors"),t=Ri("spacing"),a=Ri("blur"),l=Ri("brightness"),d=Ri("borderColor"),_=Ri("borderRadius"),v=Ri("borderSpacing"),i=Ri("borderWidth"),P=Ri("contrast"),I=Ri("grayscale"),M=Ri("hueRotate"),R=Ri("invert"),F=Ri("gap"),q=Ri("gradientColorStops"),H=Ri("gradientColorStopPositions"),j=Ri("inset"),$=Ri("margin"),Y=Ri("opacity"),K=Ri("padding"),re=Ri("saturate"),se=Ri("scale"),J=Ri("sepia"),ae=Ri("skew"),de=Ri("space"),Pe=Ri("translate"),Ne=()=>["auto","contain","none"],rt=()=>["auto","hidden","clip","visible","scroll"],ke=()=>["auto",In,t],Ze=()=>[In,t],nt=()=>["",fc,Pu],Je=()=>["auto",mp,In],ot=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],it=()=>["solid","dashed","dotted","double","none"],Pt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ot=()=>["start","end","center","between","around","evenly","stretch"],yt=()=>["","0",In],ar=()=>["auto","avoid","all","avoid-page","page","left","right","column"],qt=()=>[mp,In];return{cacheSize:500,separator:":",theme:{colors:[h_],spacing:[fc,Pu],blur:["none","",Iu,In],brightness:qt(),borderColor:[e],borderRadius:["none","","full",Iu,In],borderSpacing:Ze(),borderWidth:nt(),contrast:qt(),grayscale:yt(),hueRotate:qt(),invert:yt(),gap:Ze(),gradientColorStops:[e],gradientColorStopPositions:[TK,Pu],inset:ke(),margin:ke(),opacity:qt(),padding:Ze(),saturate:qt(),scale:qt(),sepia:yt(),skew:qt(),space:Ze(),translate:Ze()},classGroups:{aspect:[{aspect:["auto","square","video",In]}],container:["container"],columns:[{columns:[Iu]}],"break-after":[{"break-after":ar()}],"break-before":[{"break-before":ar()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ot(),In]}],overflow:[{overflow:rt()}],"overflow-x":[{"overflow-x":rt()}],"overflow-y":[{"overflow-y":rt()}],overscroll:[{overscroll:Ne()}],"overscroll-x":[{"overscroll-x":Ne()}],"overscroll-y":[{"overscroll-y":Ne()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[j]}],"inset-x":[{"inset-x":[j]}],"inset-y":[{"inset-y":[j]}],start:[{start:[j]}],end:[{end:[j]}],top:[{top:[j]}],right:[{right:[j]}],bottom:[{bottom:[j]}],left:[{left:[j]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",u_,In]}],basis:[{basis:ke()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",In]}],grow:[{grow:yt()}],shrink:[{shrink:yt()}],order:[{order:["first","last","none",u_,In]}],"grid-cols":[{"grid-cols":[h_]}],"col-start-end":[{col:["auto",{span:["full",u_,In]},In]}],"col-start":[{"col-start":Je()}],"col-end":[{"col-end":Je()}],"grid-rows":[{"grid-rows":[h_]}],"row-start-end":[{row:["auto",{span:[u_,In]},In]}],"row-start":[{"row-start":Je()}],"row-end":[{"row-end":Je()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",In]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",In]}],gap:[{gap:[F]}],"gap-x":[{"gap-x":[F]}],"gap-y":[{"gap-y":[F]}],"justify-content":[{justify:["normal",...Ot()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ot(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ot(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[K]}],px:[{px:[K]}],py:[{py:[K]}],ps:[{ps:[K]}],pe:[{pe:[K]}],pt:[{pt:[K]}],pr:[{pr:[K]}],pb:[{pb:[K]}],pl:[{pl:[K]}],m:[{m:[$]}],mx:[{mx:[$]}],my:[{my:[$]}],ms:[{ms:[$]}],me:[{me:[$]}],mt:[{mt:[$]}],mr:[{mr:[$]}],mb:[{mb:[$]}],ml:[{ml:[$]}],"space-x":[{"space-x":[de]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[de]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",In,t]}],"min-w":[{"min-w":[In,t,"min","max","fit"]}],"max-w":[{"max-w":[In,t,"none","full","min","max","fit","prose",{screen:[Iu]},Iu]}],h:[{h:[In,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[In,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[In,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[In,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Iu,Pu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",VS]}],"font-family":[{font:[h_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",In]}],"line-clamp":[{"line-clamp":["none",mp,VS]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",fc,In]}],"list-image":[{"list-image":["none",In]}],"list-style-type":[{list:["none","disc","decimal",In]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...it(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",fc,Pu]}],"underline-offset":[{"underline-offset":["auto",fc,In]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ze()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",In]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",In]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ot(),PK]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",EK]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},CK]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[H]}],"gradient-via-pos":[{via:[H]}],"gradient-to-pos":[{to:[H]}],"gradient-from":[{from:[q]}],"gradient-via":[{via:[q]}],"gradient-to":[{to:[q]}],rounded:[{rounded:[_]}],"rounded-s":[{"rounded-s":[_]}],"rounded-e":[{"rounded-e":[_]}],"rounded-t":[{"rounded-t":[_]}],"rounded-r":[{"rounded-r":[_]}],"rounded-b":[{"rounded-b":[_]}],"rounded-l":[{"rounded-l":[_]}],"rounded-ss":[{"rounded-ss":[_]}],"rounded-se":[{"rounded-se":[_]}],"rounded-ee":[{"rounded-ee":[_]}],"rounded-es":[{"rounded-es":[_]}],"rounded-tl":[{"rounded-tl":[_]}],"rounded-tr":[{"rounded-tr":[_]}],"rounded-br":[{"rounded-br":[_]}],"rounded-bl":[{"rounded-bl":[_]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[Y]}],"border-style":[{border:[...it(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Y]}],"divide-style":[{divide:it()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...it()]}],"outline-offset":[{"outline-offset":[fc,In]}],"outline-w":[{outline:[fc,Pu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:nt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Y]}],"ring-offset-w":[{"ring-offset":[fc,Pu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Iu,OK]}],"shadow-color":[{shadow:[h_]}],opacity:[{opacity:[Y]}],"mix-blend":[{"mix-blend":[...Pt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Pt()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[l]}],contrast:[{contrast:[P]}],"drop-shadow":[{"drop-shadow":["","none",Iu,In]}],grayscale:[{grayscale:[I]}],"hue-rotate":[{"hue-rotate":[M]}],invert:[{invert:[R]}],saturate:[{saturate:[re]}],sepia:[{sepia:[J]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[P]}],"backdrop-grayscale":[{"backdrop-grayscale":[I]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[M]}],"backdrop-invert":[{"backdrop-invert":[R]}],"backdrop-opacity":[{"backdrop-opacity":[Y]}],"backdrop-saturate":[{"backdrop-saturate":[re]}],"backdrop-sepia":[{"backdrop-sepia":[J]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[v]}],"border-spacing-x":[{"border-spacing-x":[v]}],"border-spacing-y":[{"border-spacing-y":[v]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",In]}],duration:[{duration:qt()}],ease:[{ease:["linear","in","out","in-out",In]}],delay:[{delay:qt()}],animate:[{animate:["none","spin","ping","pulse","bounce",In]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[se]}],"scale-x":[{"scale-x":[se]}],"scale-y":[{"scale-y":[se]}],rotate:[{rotate:[u_,In]}],"translate-x":[{"translate-x":[Pe]}],"translate-y":[{"translate-y":[Pe]}],"skew-x":[{"skew-x":[ae]}],"skew-y":[{"skew-y":[ae]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",In]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",In]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ze()}],"scroll-mx":[{"scroll-mx":Ze()}],"scroll-my":[{"scroll-my":Ze()}],"scroll-ms":[{"scroll-ms":Ze()}],"scroll-me":[{"scroll-me":Ze()}],"scroll-mt":[{"scroll-mt":Ze()}],"scroll-mr":[{"scroll-mr":Ze()}],"scroll-mb":[{"scroll-mb":Ze()}],"scroll-ml":[{"scroll-ml":Ze()}],"scroll-p":[{"scroll-p":Ze()}],"scroll-px":[{"scroll-px":Ze()}],"scroll-py":[{"scroll-py":Ze()}],"scroll-ps":[{"scroll-ps":Ze()}],"scroll-pe":[{"scroll-pe":Ze()}],"scroll-pt":[{"scroll-pt":Ze()}],"scroll-pr":[{"scroll-pr":Ze()}],"scroll-pb":[{"scroll-pb":Ze()}],"scroll-pl":[{"scroll-pl":Ze()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",In]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[fc,Pu,VS]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},NK=gK(kK);function Nn(...e){return NK(Sn(e))}const LK=nK,xU=ie.forwardRef(({className:e,...t},a)=>T.jsx(lU,{ref:a,className:Nn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));xU.displayName=lU.displayName;const jK=fC("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),bU=ie.forwardRef(({className:e,variant:t,...a},l)=>T.jsx(cU,{ref:l,className:Nn(jK({variant:t}),e),...a}));bU.displayName=cU.displayName;const zK=ie.forwardRef(({className:e,...t},a)=>T.jsx(dU,{ref:a,className:Nn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));zK.displayName=dU.displayName;const wU=ie.forwardRef(({className:e,...t},a)=>T.jsx(fU,{ref:a,className:Nn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:T.jsx(l4,{className:"h-4 w-4"})}));wU.displayName=fU.displayName;const SU=ie.forwardRef(({className:e,...t},a)=>T.jsx(uU,{ref:a,className:Nn("text-sm font-semibold",e),...t}));SU.displayName=uU.displayName;const TU=ie.forwardRef(({className:e,...t},a)=>T.jsx(hU,{ref:a,className:Nn("text-sm opacity-90",e),...t}));TU.displayName=hU.displayName;function FK(){const{toasts:e}=Qp();return T.jsxs(LK,{children:[e.map(function({id:t,title:a,description:l,action:d,..._}){return T.jsxs(bU,{..._,children:[T.jsxs("div",{className:"grid gap-1",children:[a&&T.jsx(SU,{children:a}),l&&T.jsx(TU,{children:l})]}),d,T.jsx(wU,{})]},t)}),T.jsx(xU,{})]})}var BK=eC[" useId ".trim().toString()]||(()=>{}),UK=0;function Cl(e){const[t,a]=ie.useState(BK());return Co(()=>{a(l=>l??String(UK++))},[e]),t?`radix-${t}`:""}const VK=["top","right","bottom","left"],Bu=Math.min,ja=Math.max,w0=Math.round,Gx=Math.floor,Al=e=>({x:e,y:e}),$K={left:"right",right:"left",bottom:"top",top:"bottom"},qK={start:"end",end:"start"};function yP(e,t,a){return ja(e,Bu(t,a))}function Pc(e,t){return typeof e=="function"?e(t):e}function Ic(e){return e.split("-")[0]}function rm(e){return e.split("-")[1]}function mC(e){return e==="x"?"y":"x"}function gC(e){return e==="y"?"height":"width"}const GK=new Set(["top","bottom"]);function Sl(e){return GK.has(Ic(e))?"y":"x"}function _C(e){return mC(Sl(e))}function HK(e,t,a){a===void 0&&(a=!1);const l=rm(e),d=_C(e),_=gC(d);let v=d==="x"?l===(a?"end":"start")?"right":"left":l==="start"?"bottom":"top";return t.reference[_]>t.floating[_]&&(v=S0(v)),[v,S0(v)]}function WK(e){const t=S0(e);return[vP(e),t,vP(t)]}function vP(e){return e.replace(/start|end/g,t=>qK[t])}const IN=["left","right"],CN=["right","left"],ZK=["top","bottom"],XK=["bottom","top"];function KK(e,t,a){switch(e){case"top":case"bottom":return a?t?CN:IN:t?IN:CN;case"left":case"right":return t?ZK:XK;default:return[]}}function YK(e,t,a,l){const d=rm(e);let _=KK(Ic(e),a==="start",l);return d&&(_=_.map(v=>v+"-"+d),t&&(_=_.concat(_.map(vP)))),_}function S0(e){return e.replace(/left|right|bottom|top/g,t=>$K[t])}function JK(e){return{top:0,right:0,bottom:0,left:0,...e}}function AU(e){return typeof e!="number"?JK(e):{top:e,right:e,bottom:e,left:e}}function T0(e){const{x:t,y:a,width:l,height:d}=e;return{width:l,height:d,top:a,left:t,right:t+l,bottom:a+d,x:t,y:a}}function ON(e,t,a){let{reference:l,floating:d}=e;const _=Sl(t),v=_C(t),i=gC(v),P=Ic(t),I=_==="y",M=l.x+l.width/2-d.width/2,R=l.y+l.height/2-d.height/2,F=l[i]/2-d[i]/2;let q;switch(P){case"top":q={x:M,y:l.y-d.height};break;case"bottom":q={x:M,y:l.y+l.height};break;case"right":q={x:l.x+l.width,y:R};break;case"left":q={x:l.x-d.width,y:R};break;default:q={x:l.x,y:l.y}}switch(rm(t)){case"start":q[v]-=F*(a&&I?-1:1);break;case"end":q[v]+=F*(a&&I?-1:1);break}return q}const QK=async(e,t,a)=>{const{placement:l="bottom",strategy:d="absolute",middleware:_=[],platform:v}=a,i=_.filter(Boolean),P=await(v.isRTL==null?void 0:v.isRTL(t));let I=await v.getElementRects({reference:e,floating:t,strategy:d}),{x:M,y:R}=ON(I,l,P),F=l,q={},H=0;for(let j=0;j<i.length;j++){const{name:$,fn:Y}=i[j],{x:K,y:re,data:se,reset:J}=await Y({x:M,y:R,initialPlacement:l,placement:F,strategy:d,middlewareData:q,rects:I,platform:v,elements:{reference:e,floating:t}});M=K??M,R=re??R,q={...q,[$]:{...q[$],...se}},J&&H<=50&&(H++,typeof J=="object"&&(J.placement&&(F=J.placement),J.rects&&(I=J.rects===!0?await v.getElementRects({reference:e,floating:t,strategy:d}):J.rects),{x:M,y:R}=ON(I,F,P)),j=-1)}return{x:M,y:R,placement:F,strategy:d,middlewareData:q}};async function V_(e,t){var a;t===void 0&&(t={});const{x:l,y:d,platform:_,rects:v,elements:i,strategy:P}=e,{boundary:I="clippingAncestors",rootBoundary:M="viewport",elementContext:R="floating",altBoundary:F=!1,padding:q=0}=Pc(t,e),H=AU(q),$=i[F?R==="floating"?"reference":"floating":R],Y=T0(await _.getClippingRect({element:(a=await(_.isElement==null?void 0:_.isElement($)))==null||a?$:$.contextElement||await(_.getDocumentElement==null?void 0:_.getDocumentElement(i.floating)),boundary:I,rootBoundary:M,strategy:P})),K=R==="floating"?{x:l,y:d,width:v.floating.width,height:v.floating.height}:v.reference,re=await(_.getOffsetParent==null?void 0:_.getOffsetParent(i.floating)),se=await(_.isElement==null?void 0:_.isElement(re))?await(_.getScale==null?void 0:_.getScale(re))||{x:1,y:1}:{x:1,y:1},J=T0(_.convertOffsetParentRelativeRectToViewportRelativeRect?await _.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:K,offsetParent:re,strategy:P}):K);return{top:(Y.top-J.top+H.top)/se.y,bottom:(J.bottom-Y.bottom+H.bottom)/se.y,left:(Y.left-J.left+H.left)/se.x,right:(J.right-Y.right+H.right)/se.x}}const eY=e=>({name:"arrow",options:e,async fn(t){const{x:a,y:l,placement:d,rects:_,platform:v,elements:i,middlewareData:P}=t,{element:I,padding:M=0}=Pc(e,t)||{};if(I==null)return{};const R=AU(M),F={x:a,y:l},q=_C(d),H=gC(q),j=await v.getDimensions(I),$=q==="y",Y=$?"top":"left",K=$?"bottom":"right",re=$?"clientHeight":"clientWidth",se=_.reference[H]+_.reference[q]-F[q]-_.floating[H],J=F[q]-_.reference[q],ae=await(v.getOffsetParent==null?void 0:v.getOffsetParent(I));let de=ae?ae[re]:0;(!de||!await(v.isElement==null?void 0:v.isElement(ae)))&&(de=i.floating[re]||_.floating[H]);const Pe=se/2-J/2,Ne=de/2-j[H]/2-1,rt=Bu(R[Y],Ne),ke=Bu(R[K],Ne),Ze=rt,nt=de-j[H]-ke,Je=de/2-j[H]/2+Pe,ot=yP(Ze,Je,nt),it=!P.arrow&&rm(d)!=null&&Je!==ot&&_.reference[H]/2-(Je<Ze?rt:ke)-j[H]/2<0,Pt=it?Je<Ze?Je-Ze:Je-nt:0;return{[q]:F[q]+Pt,data:{[q]:ot,centerOffset:Je-ot-Pt,...it&&{alignmentOffset:Pt}},reset:it}}}),tY=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var a,l;const{placement:d,middlewareData:_,rects:v,initialPlacement:i,platform:P,elements:I}=t,{mainAxis:M=!0,crossAxis:R=!0,fallbackPlacements:F,fallbackStrategy:q="bestFit",fallbackAxisSideDirection:H="none",flipAlignment:j=!0,...$}=Pc(e,t);if((a=_.arrow)!=null&&a.alignmentOffset)return{};const Y=Ic(d),K=Sl(i),re=Ic(i)===i,se=await(P.isRTL==null?void 0:P.isRTL(I.floating)),J=F||(re||!j?[S0(i)]:WK(i)),ae=H!=="none";!F&&ae&&J.push(...YK(i,j,H,se));const de=[i,...J],Pe=await V_(t,$),Ne=[];let rt=((l=_.flip)==null?void 0:l.overflows)||[];if(M&&Ne.push(Pe[Y]),R){const Je=HK(d,v,se);Ne.push(Pe[Je[0]],Pe[Je[1]])}if(rt=[...rt,{placement:d,overflows:Ne}],!Ne.every(Je=>Je<=0)){var ke,Ze;const Je=(((ke=_.flip)==null?void 0:ke.index)||0)+1,ot=de[Je];if(ot&&(!(R==="alignment"?K!==Sl(ot):!1)||rt.every(Ot=>Sl(Ot.placement)===K?Ot.overflows[0]>0:!0)))return{data:{index:Je,overflows:rt},reset:{placement:ot}};let it=(Ze=rt.filter(Pt=>Pt.overflows[0]<=0).sort((Pt,Ot)=>Pt.overflows[1]-Ot.overflows[1])[0])==null?void 0:Ze.placement;if(!it)switch(q){case"bestFit":{var nt;const Pt=(nt=rt.filter(Ot=>{if(ae){const yt=Sl(Ot.placement);return yt===K||yt==="y"}return!0}).map(Ot=>[Ot.placement,Ot.overflows.filter(yt=>yt>0).reduce((yt,ar)=>yt+ar,0)]).sort((Ot,yt)=>Ot[1]-yt[1])[0])==null?void 0:nt[0];Pt&&(it=Pt);break}case"initialPlacement":it=i;break}if(d!==it)return{reset:{placement:it}}}return{}}}};function MN(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function RN(e){return VK.some(t=>e[t]>=0)}const rY=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:a}=t,{strategy:l="referenceHidden",...d}=Pc(e,t);switch(l){case"referenceHidden":{const _=await V_(t,{...d,elementContext:"reference"}),v=MN(_,a.reference);return{data:{referenceHiddenOffsets:v,referenceHidden:RN(v)}}}case"escaped":{const _=await V_(t,{...d,altBoundary:!0}),v=MN(_,a.floating);return{data:{escapedOffsets:v,escaped:RN(v)}}}default:return{}}}}},EU=new Set(["left","top"]);async function nY(e,t){const{placement:a,platform:l,elements:d}=e,_=await(l.isRTL==null?void 0:l.isRTL(d.floating)),v=Ic(a),i=rm(a),P=Sl(a)==="y",I=EU.has(v)?-1:1,M=_&&P?-1:1,R=Pc(t,e);let{mainAxis:F,crossAxis:q,alignmentAxis:H}=typeof R=="number"?{mainAxis:R,crossAxis:0,alignmentAxis:null}:{mainAxis:R.mainAxis||0,crossAxis:R.crossAxis||0,alignmentAxis:R.alignmentAxis};return i&&typeof H=="number"&&(q=i==="end"?H*-1:H),P?{x:q*M,y:F*I}:{x:F*I,y:q*M}}const iY=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var a,l;const{x:d,y:_,placement:v,middlewareData:i}=t,P=await nY(t,e);return v===((a=i.offset)==null?void 0:a.placement)&&(l=i.arrow)!=null&&l.alignmentOffset?{}:{x:d+P.x,y:_+P.y,data:{...P,placement:v}}}}},oY=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:a,y:l,placement:d}=t,{mainAxis:_=!0,crossAxis:v=!1,limiter:i={fn:$=>{let{x:Y,y:K}=$;return{x:Y,y:K}}},...P}=Pc(e,t),I={x:a,y:l},M=await V_(t,P),R=Sl(Ic(d)),F=mC(R);let q=I[F],H=I[R];if(_){const $=F==="y"?"top":"left",Y=F==="y"?"bottom":"right",K=q+M[$],re=q-M[Y];q=yP(K,q,re)}if(v){const $=R==="y"?"top":"left",Y=R==="y"?"bottom":"right",K=H+M[$],re=H-M[Y];H=yP(K,H,re)}const j=i.fn({...t,[F]:q,[R]:H});return{...j,data:{x:j.x-a,y:j.y-l,enabled:{[F]:_,[R]:v}}}}}},aY=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:a,y:l,placement:d,rects:_,middlewareData:v}=t,{offset:i=0,mainAxis:P=!0,crossAxis:I=!0}=Pc(e,t),M={x:a,y:l},R=Sl(d),F=mC(R);let q=M[F],H=M[R];const j=Pc(i,t),$=typeof j=="number"?{mainAxis:j,crossAxis:0}:{mainAxis:0,crossAxis:0,...j};if(P){const re=F==="y"?"height":"width",se=_.reference[F]-_.floating[re]+$.mainAxis,J=_.reference[F]+_.reference[re]-$.mainAxis;q<se?q=se:q>J&&(q=J)}if(I){var Y,K;const re=F==="y"?"width":"height",se=EU.has(Ic(d)),J=_.reference[R]-_.floating[re]+(se&&((Y=v.offset)==null?void 0:Y[R])||0)+(se?0:$.crossAxis),ae=_.reference[R]+_.reference[re]+(se?0:((K=v.offset)==null?void 0:K[R])||0)-(se?$.crossAxis:0);H<J?H=J:H>ae&&(H=ae)}return{[F]:q,[R]:H}}}},sY=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var a,l;const{placement:d,rects:_,platform:v,elements:i}=t,{apply:P=()=>{},...I}=Pc(e,t),M=await V_(t,I),R=Ic(d),F=rm(d),q=Sl(d)==="y",{width:H,height:j}=_.floating;let $,Y;R==="top"||R==="bottom"?($=R,Y=F===(await(v.isRTL==null?void 0:v.isRTL(i.floating))?"start":"end")?"left":"right"):(Y=R,$=F==="end"?"top":"bottom");const K=j-M.top-M.bottom,re=H-M.left-M.right,se=Bu(j-M[$],K),J=Bu(H-M[Y],re),ae=!t.middlewareData.shift;let de=se,Pe=J;if((a=t.middlewareData.shift)!=null&&a.enabled.x&&(Pe=re),(l=t.middlewareData.shift)!=null&&l.enabled.y&&(de=K),ae&&!F){const rt=ja(M.left,0),ke=ja(M.right,0),Ze=ja(M.top,0),nt=ja(M.bottom,0);q?Pe=H-2*(rt!==0||ke!==0?rt+ke:ja(M.left,M.right)):de=j-2*(Ze!==0||nt!==0?Ze+nt:ja(M.top,M.bottom))}await P({...t,availableWidth:Pe,availableHeight:de});const Ne=await v.getDimensions(i.floating);return H!==Ne.width||j!==Ne.height?{reset:{rects:!0}}:{}}}};function Nb(){return typeof window<"u"}function nm(e){return PU(e)?(e.nodeName||"").toLowerCase():"#document"}function Ua(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function kl(e){var t;return(t=(PU(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function PU(e){return Nb()?e instanceof Node||e instanceof Ua(e).Node:!1}function $s(e){return Nb()?e instanceof Element||e instanceof Ua(e).Element:!1}function Ol(e){return Nb()?e instanceof HTMLElement||e instanceof Ua(e).HTMLElement:!1}function DN(e){return!Nb()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ua(e).ShadowRoot}const lY=new Set(["inline","contents"]);function Ry(e){const{overflow:t,overflowX:a,overflowY:l,display:d}=qs(e);return/auto|scroll|overlay|hidden|clip/.test(t+l+a)&&!lY.has(d)}const cY=new Set(["table","td","th"]);function uY(e){return cY.has(nm(e))}const hY=[":popover-open",":modal"];function Lb(e){return hY.some(t=>{try{return e.matches(t)}catch{return!1}})}const dY=["transform","translate","scale","rotate","perspective"],fY=["transform","translate","scale","rotate","perspective","filter"],pY=["paint","layout","strict","content"];function yC(e){const t=vC(),a=$s(e)?qs(e):e;return dY.some(l=>a[l]?a[l]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!t&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!t&&(a.filter?a.filter!=="none":!1)||fY.some(l=>(a.willChange||"").includes(l))||pY.some(l=>(a.contain||"").includes(l))}function mY(e){let t=Uu(e);for(;Ol(t)&&!Sp(t);){if(yC(t))return t;if(Lb(t))return null;t=Uu(t)}return null}function vC(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const gY=new Set(["html","body","#document"]);function Sp(e){return gY.has(nm(e))}function qs(e){return Ua(e).getComputedStyle(e)}function jb(e){return $s(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Uu(e){if(nm(e)==="html")return e;const t=e.assignedSlot||e.parentNode||DN(e)&&e.host||kl(e);return DN(t)?t.host:t}function IU(e){const t=Uu(e);return Sp(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ol(t)&&Ry(t)?t:IU(t)}function $_(e,t,a){var l;t===void 0&&(t=[]),a===void 0&&(a=!0);const d=IU(e),_=d===((l=e.ownerDocument)==null?void 0:l.body),v=Ua(d);if(_){const i=xP(v);return t.concat(v,v.visualViewport||[],Ry(d)?d:[],i&&a?$_(i):[])}return t.concat(d,$_(d,[],a))}function xP(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function CU(e){const t=qs(e);let a=parseFloat(t.width)||0,l=parseFloat(t.height)||0;const d=Ol(e),_=d?e.offsetWidth:a,v=d?e.offsetHeight:l,i=w0(a)!==_||w0(l)!==v;return i&&(a=_,l=v),{width:a,height:l,$:i}}function xC(e){return $s(e)?e:e.contextElement}function gp(e){const t=xC(e);if(!Ol(t))return Al(1);const a=t.getBoundingClientRect(),{width:l,height:d,$:_}=CU(t);let v=(_?w0(a.width):a.width)/l,i=(_?w0(a.height):a.height)/d;return(!v||!Number.isFinite(v))&&(v=1),(!i||!Number.isFinite(i))&&(i=1),{x:v,y:i}}const _Y=Al(0);function OU(e){const t=Ua(e);return!vC()||!t.visualViewport?_Y:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function yY(e,t,a){return t===void 0&&(t=!1),!a||t&&a!==Ua(e)?!1:t}function sd(e,t,a,l){t===void 0&&(t=!1),a===void 0&&(a=!1);const d=e.getBoundingClientRect(),_=xC(e);let v=Al(1);t&&(l?$s(l)&&(v=gp(l)):v=gp(e));const i=yY(_,a,l)?OU(_):Al(0);let P=(d.left+i.x)/v.x,I=(d.top+i.y)/v.y,M=d.width/v.x,R=d.height/v.y;if(_){const F=Ua(_),q=l&&$s(l)?Ua(l):l;let H=F,j=xP(H);for(;j&&l&&q!==H;){const $=gp(j),Y=j.getBoundingClientRect(),K=qs(j),re=Y.left+(j.clientLeft+parseFloat(K.paddingLeft))*$.x,se=Y.top+(j.clientTop+parseFloat(K.paddingTop))*$.y;P*=$.x,I*=$.y,M*=$.x,R*=$.y,P+=re,I+=se,H=Ua(j),j=xP(H)}}return T0({width:M,height:R,x:P,y:I})}function zb(e,t){const a=jb(e).scrollLeft;return t?t.left+a:sd(kl(e)).left+a}function MU(e,t){const a=e.getBoundingClientRect(),l=a.left+t.scrollLeft-zb(e,a),d=a.top+t.scrollTop;return{x:l,y:d}}function vY(e){let{elements:t,rect:a,offsetParent:l,strategy:d}=e;const _=d==="fixed",v=kl(l),i=t?Lb(t.floating):!1;if(l===v||i&&_)return a;let P={scrollLeft:0,scrollTop:0},I=Al(1);const M=Al(0),R=Ol(l);if((R||!R&&!_)&&((nm(l)!=="body"||Ry(v))&&(P=jb(l)),Ol(l))){const q=sd(l);I=gp(l),M.x=q.x+l.clientLeft,M.y=q.y+l.clientTop}const F=v&&!R&&!_?MU(v,P):Al(0);return{width:a.width*I.x,height:a.height*I.y,x:a.x*I.x-P.scrollLeft*I.x+M.x+F.x,y:a.y*I.y-P.scrollTop*I.y+M.y+F.y}}function xY(e){return Array.from(e.getClientRects())}function bY(e){const t=kl(e),a=jb(e),l=e.ownerDocument.body,d=ja(t.scrollWidth,t.clientWidth,l.scrollWidth,l.clientWidth),_=ja(t.scrollHeight,t.clientHeight,l.scrollHeight,l.clientHeight);let v=-a.scrollLeft+zb(e);const i=-a.scrollTop;return qs(l).direction==="rtl"&&(v+=ja(t.clientWidth,l.clientWidth)-d),{width:d,height:_,x:v,y:i}}const kN=25;function wY(e,t){const a=Ua(e),l=kl(e),d=a.visualViewport;let _=l.clientWidth,v=l.clientHeight,i=0,P=0;if(d){_=d.width,v=d.height;const M=vC();(!M||M&&t==="fixed")&&(i=d.offsetLeft,P=d.offsetTop)}const I=zb(l);if(I<=0){const M=l.ownerDocument,R=M.body,F=getComputedStyle(R),q=M.compatMode==="CSS1Compat"&&parseFloat(F.marginLeft)+parseFloat(F.marginRight)||0,H=Math.abs(l.clientWidth-R.clientWidth-q);H<=kN&&(_-=H)}else I<=kN&&(_+=I);return{width:_,height:v,x:i,y:P}}const SY=new Set(["absolute","fixed"]);function TY(e,t){const a=sd(e,!0,t==="fixed"),l=a.top+e.clientTop,d=a.left+e.clientLeft,_=Ol(e)?gp(e):Al(1),v=e.clientWidth*_.x,i=e.clientHeight*_.y,P=d*_.x,I=l*_.y;return{width:v,height:i,x:P,y:I}}function NN(e,t,a){let l;if(t==="viewport")l=wY(e,a);else if(t==="document")l=bY(kl(e));else if($s(t))l=TY(t,a);else{const d=OU(e);l={x:t.x-d.x,y:t.y-d.y,width:t.width,height:t.height}}return T0(l)}function RU(e,t){const a=Uu(e);return a===t||!$s(a)||Sp(a)?!1:qs(a).position==="fixed"||RU(a,t)}function AY(e,t){const a=t.get(e);if(a)return a;let l=$_(e,[],!1).filter(i=>$s(i)&&nm(i)!=="body"),d=null;const _=qs(e).position==="fixed";let v=_?Uu(e):e;for(;$s(v)&&!Sp(v);){const i=qs(v),P=yC(v);!P&&i.position==="fixed"&&(d=null),(_?!P&&!d:!P&&i.position==="static"&&!!d&&SY.has(d.position)||Ry(v)&&!P&&RU(e,v))?l=l.filter(M=>M!==v):d=i,v=Uu(v)}return t.set(e,l),l}function EY(e){let{element:t,boundary:a,rootBoundary:l,strategy:d}=e;const v=[...a==="clippingAncestors"?Lb(t)?[]:AY(t,this._c):[].concat(a),l],i=v[0],P=v.reduce((I,M)=>{const R=NN(t,M,d);return I.top=ja(R.top,I.top),I.right=Bu(R.right,I.right),I.bottom=Bu(R.bottom,I.bottom),I.left=ja(R.left,I.left),I},NN(t,i,d));return{width:P.right-P.left,height:P.bottom-P.top,x:P.left,y:P.top}}function PY(e){const{width:t,height:a}=CU(e);return{width:t,height:a}}function IY(e,t,a){const l=Ol(t),d=kl(t),_=a==="fixed",v=sd(e,!0,_,t);let i={scrollLeft:0,scrollTop:0};const P=Al(0);function I(){P.x=zb(d)}if(l||!l&&!_)if((nm(t)!=="body"||Ry(d))&&(i=jb(t)),l){const q=sd(t,!0,_,t);P.x=q.x+t.clientLeft,P.y=q.y+t.clientTop}else d&&I();_&&!l&&d&&I();const M=d&&!l&&!_?MU(d,i):Al(0),R=v.left+i.scrollLeft-P.x-M.x,F=v.top+i.scrollTop-P.y-M.y;return{x:R,y:F,width:v.width,height:v.height}}function $S(e){return qs(e).position==="static"}function LN(e,t){if(!Ol(e)||qs(e).position==="fixed")return null;if(t)return t(e);let a=e.offsetParent;return kl(e)===a&&(a=a.ownerDocument.body),a}function DU(e,t){const a=Ua(e);if(Lb(e))return a;if(!Ol(e)){let d=Uu(e);for(;d&&!Sp(d);){if($s(d)&&!$S(d))return d;d=Uu(d)}return a}let l=LN(e,t);for(;l&&uY(l)&&$S(l);)l=LN(l,t);return l&&Sp(l)&&$S(l)&&!yC(l)?a:l||mY(e)||a}const CY=async function(e){const t=this.getOffsetParent||DU,a=this.getDimensions,l=await a(e.floating);return{reference:IY(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function OY(e){return qs(e).direction==="rtl"}const MY={convertOffsetParentRelativeRectToViewportRelativeRect:vY,getDocumentElement:kl,getClippingRect:EY,getOffsetParent:DU,getElementRects:CY,getClientRects:xY,getDimensions:PY,getScale:gp,isElement:$s,isRTL:OY};function kU(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function RY(e,t){let a=null,l;const d=kl(e);function _(){var i;clearTimeout(l),(i=a)==null||i.disconnect(),a=null}function v(i,P){i===void 0&&(i=!1),P===void 0&&(P=1),_();const I=e.getBoundingClientRect(),{left:M,top:R,width:F,height:q}=I;if(i||t(),!F||!q)return;const H=Gx(R),j=Gx(d.clientWidth-(M+F)),$=Gx(d.clientHeight-(R+q)),Y=Gx(M),re={rootMargin:-H+"px "+-j+"px "+-$+"px "+-Y+"px",threshold:ja(0,Bu(1,P))||1};let se=!0;function J(ae){const de=ae[0].intersectionRatio;if(de!==P){if(!se)return v();de?v(!1,de):l=setTimeout(()=>{v(!1,1e-7)},1e3)}de===1&&!kU(I,e.getBoundingClientRect())&&v(),se=!1}try{a=new IntersectionObserver(J,{...re,root:d.ownerDocument})}catch{a=new IntersectionObserver(J,re)}a.observe(e)}return v(!0),_}function DY(e,t,a,l){l===void 0&&(l={});const{ancestorScroll:d=!0,ancestorResize:_=!0,elementResize:v=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:P=!1}=l,I=xC(e),M=d||_?[...I?$_(I):[],...$_(t)]:[];M.forEach(Y=>{d&&Y.addEventListener("scroll",a,{passive:!0}),_&&Y.addEventListener("resize",a)});const R=I&&i?RY(I,a):null;let F=-1,q=null;v&&(q=new ResizeObserver(Y=>{let[K]=Y;K&&K.target===I&&q&&(q.unobserve(t),cancelAnimationFrame(F),F=requestAnimationFrame(()=>{var re;(re=q)==null||re.observe(t)})),a()}),I&&!P&&q.observe(I),q.observe(t));let H,j=P?sd(e):null;P&&$();function $(){const Y=sd(e);j&&!kU(j,Y)&&a(),j=Y,H=requestAnimationFrame($)}return a(),()=>{var Y;M.forEach(K=>{d&&K.removeEventListener("scroll",a),_&&K.removeEventListener("resize",a)}),R?.(),(Y=q)==null||Y.disconnect(),q=null,P&&cancelAnimationFrame(H)}}const kY=iY,NY=oY,LY=tY,jY=sY,zY=rY,jN=eY,FY=aY,BY=(e,t,a)=>{const l=new Map,d={platform:MY,...a},_={...d.platform,_c:l};return QK(e,t,{...d,platform:_})};var UY=typeof document<"u",VY=function(){},p0=UY?ie.useLayoutEffect:VY;function A0(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let a,l,d;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(a=e.length,a!==t.length)return!1;for(l=a;l--!==0;)if(!A0(e[l],t[l]))return!1;return!0}if(d=Object.keys(e),a=d.length,a!==Object.keys(t).length)return!1;for(l=a;l--!==0;)if(!{}.hasOwnProperty.call(t,d[l]))return!1;for(l=a;l--!==0;){const _=d[l];if(!(_==="_owner"&&e.$$typeof)&&!A0(e[_],t[_]))return!1}return!0}return e!==e&&t!==t}function NU(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function zN(e,t){const a=NU(e);return Math.round(t*a)/a}function qS(e){const t=ie.useRef(e);return p0(()=>{t.current=e}),t}function $Y(e){e===void 0&&(e={});const{placement:t="bottom",strategy:a="absolute",middleware:l=[],platform:d,elements:{reference:_,floating:v}={},transform:i=!0,whileElementsMounted:P,open:I}=e,[M,R]=ie.useState({x:0,y:0,strategy:a,placement:t,middlewareData:{},isPositioned:!1}),[F,q]=ie.useState(l);A0(F,l)||q(l);const[H,j]=ie.useState(null),[$,Y]=ie.useState(null),K=ie.useCallback(Ot=>{Ot!==ae.current&&(ae.current=Ot,j(Ot))},[]),re=ie.useCallback(Ot=>{Ot!==de.current&&(de.current=Ot,Y(Ot))},[]),se=_||H,J=v||$,ae=ie.useRef(null),de=ie.useRef(null),Pe=ie.useRef(M),Ne=P!=null,rt=qS(P),ke=qS(d),Ze=qS(I),nt=ie.useCallback(()=>{if(!ae.current||!de.current)return;const Ot={placement:t,strategy:a,middleware:F};ke.current&&(Ot.platform=ke.current),BY(ae.current,de.current,Ot).then(yt=>{const ar={...yt,isPositioned:Ze.current!==!1};Je.current&&!A0(Pe.current,ar)&&(Pe.current=ar,em.flushSync(()=>{R(ar)}))})},[F,t,a,ke,Ze]);p0(()=>{I===!1&&Pe.current.isPositioned&&(Pe.current.isPositioned=!1,R(Ot=>({...Ot,isPositioned:!1})))},[I]);const Je=ie.useRef(!1);p0(()=>(Je.current=!0,()=>{Je.current=!1}),[]),p0(()=>{if(se&&(ae.current=se),J&&(de.current=J),se&&J){if(rt.current)return rt.current(se,J,nt);nt()}},[se,J,nt,rt,Ne]);const ot=ie.useMemo(()=>({reference:ae,floating:de,setReference:K,setFloating:re}),[K,re]),it=ie.useMemo(()=>({reference:se,floating:J}),[se,J]),Pt=ie.useMemo(()=>{const Ot={position:a,left:0,top:0};if(!it.floating)return Ot;const yt=zN(it.floating,M.x),ar=zN(it.floating,M.y);return i?{...Ot,transform:"translate("+yt+"px, "+ar+"px)",...NU(it.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:yt,top:ar}},[a,i,it.floating,M.x,M.y]);return ie.useMemo(()=>({...M,update:nt,refs:ot,elements:it,floatingStyles:Pt}),[M,nt,ot,it,Pt])}const qY=e=>{function t(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:e,fn(a){const{element:l,padding:d}=typeof e=="function"?e(a):e;return l&&t(l)?l.current!=null?jN({element:l.current,padding:d}).fn(a):{}:l?jN({element:l,padding:d}).fn(a):{}}}},GY=(e,t)=>({...kY(e),options:[e,t]}),HY=(e,t)=>({...NY(e),options:[e,t]}),WY=(e,t)=>({...FY(e),options:[e,t]}),ZY=(e,t)=>({...LY(e),options:[e,t]}),XY=(e,t)=>({...jY(e),options:[e,t]}),KY=(e,t)=>({...zY(e),options:[e,t]}),YY=(e,t)=>({...qY(e),options:[e,t]});var JY="Arrow",LU=ie.forwardRef((e,t)=>{const{children:a,width:l=10,height:d=5,..._}=e;return T.jsx(yn.svg,{..._,ref:t,width:l,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?a:T.jsx("polygon",{points:"0,0 30,0 15,10"})})});LU.displayName=JY;var QY=LU;function eJ(e){const[t,a]=ie.useState(void 0);return Co(()=>{if(e){a({width:e.offsetWidth,height:e.offsetHeight});const l=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const _=d[0];let v,i;if("borderBoxSize"in _){const P=_.borderBoxSize,I=Array.isArray(P)?P[0]:P;v=I.inlineSize,i=I.blockSize}else v=e.offsetWidth,i=e.offsetHeight;a({width:v,height:i})});return l.observe(e,{box:"border-box"}),()=>l.unobserve(e)}else a(void 0)},[e]),t}var bC="Popper",[jU,im]=Gs(bC),[tJ,zU]=jU(bC),FU=e=>{const{__scopePopper:t,children:a}=e,[l,d]=ie.useState(null);return T.jsx(tJ,{scope:t,anchor:l,onAnchorChange:d,children:a})};FU.displayName=bC;var BU="PopperAnchor",UU=ie.forwardRef((e,t)=>{const{__scopePopper:a,virtualRef:l,...d}=e,_=zU(BU,a),v=ie.useRef(null),i=ui(t,v),P=ie.useRef(null);return ie.useEffect(()=>{const I=P.current;P.current=l?.current||v.current,I!==P.current&&_.onAnchorChange(P.current)}),l?null:T.jsx(yn.div,{...d,ref:i})});UU.displayName=BU;var wC="PopperContent",[rJ,nJ]=jU(wC),VU=ie.forwardRef((e,t)=>{const{__scopePopper:a,side:l="bottom",sideOffset:d=0,align:_="center",alignOffset:v=0,arrowPadding:i=0,avoidCollisions:P=!0,collisionBoundary:I=[],collisionPadding:M=0,sticky:R="partial",hideWhenDetached:F=!1,updatePositionStrategy:q="optimized",onPlaced:H,...j}=e,$=zU(wC,a),[Y,K]=ie.useState(null),re=ui(t,nr=>K(nr)),[se,J]=ie.useState(null),ae=eJ(se),de=ae?.width??0,Pe=ae?.height??0,Ne=l+(_!=="center"?"-"+_:""),rt=typeof M=="number"?M:{top:0,right:0,bottom:0,left:0,...M},ke=Array.isArray(I)?I:[I],Ze=ke.length>0,nt={padding:rt,boundary:ke.filter(oJ),altBoundary:Ze},{refs:Je,floatingStyles:ot,placement:it,isPositioned:Pt,middlewareData:Ot}=$Y({strategy:"fixed",placement:Ne,whileElementsMounted:(...nr)=>DY(...nr,{animationFrame:q==="always"}),elements:{reference:$.anchor},middleware:[GY({mainAxis:d+Pe,alignmentAxis:v}),P&&HY({mainAxis:!0,crossAxis:!1,limiter:R==="partial"?WY():void 0,...nt}),P&&ZY({...nt}),XY({...nt,apply:({elements:nr,rects:Dr,availableWidth:er,availableHeight:or})=>{const{width:br,height:jt}=Dr.reference,bn=nr.floating.style;bn.setProperty("--radix-popper-available-width",`${er}px`),bn.setProperty("--radix-popper-available-height",`${or}px`),bn.setProperty("--radix-popper-anchor-width",`${br}px`),bn.setProperty("--radix-popper-anchor-height",`${jt}px`)}}),se&&YY({element:se,padding:i}),aJ({arrowWidth:de,arrowHeight:Pe}),F&&KY({strategy:"referenceHidden",...nt})]}),[yt,ar]=GU(it),qt=ga(H);Co(()=>{Pt&&qt?.()},[Pt,qt]);const rr=Ot.arrow?.x,Tr=Ot.arrow?.y,an=Ot.arrow?.centerOffset!==0,[An,Fr]=ie.useState();return Co(()=>{Y&&Fr(window.getComputedStyle(Y).zIndex)},[Y]),T.jsx("div",{ref:Je.setFloating,"data-radix-popper-content-wrapper":"",style:{...ot,transform:Pt?ot.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:An,"--radix-popper-transform-origin":[Ot.transformOrigin?.x,Ot.transformOrigin?.y].join(" "),...Ot.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:T.jsx(rJ,{scope:a,placedSide:yt,onArrowChange:J,arrowX:rr,arrowY:Tr,shouldHideArrow:an,children:T.jsx(yn.div,{"data-side":yt,"data-align":ar,...j,ref:re,style:{...j.style,animation:Pt?void 0:"none"}})})})});VU.displayName=wC;var $U="PopperArrow",iJ={top:"bottom",right:"left",bottom:"top",left:"right"},qU=ie.forwardRef(function(t,a){const{__scopePopper:l,...d}=t,_=nJ($U,l),v=iJ[_.placedSide];return T.jsx("span",{ref:_.onArrowChange,style:{position:"absolute",left:_.arrowX,top:_.arrowY,[v]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[_.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[_.placedSide],visibility:_.shouldHideArrow?"hidden":void 0},children:T.jsx(QY,{...d,ref:a,style:{...d.style,display:"block"}})})});qU.displayName=$U;function oJ(e){return e!==null}var aJ=e=>({name:"transformOrigin",options:e,fn(t){const{placement:a,rects:l,middlewareData:d}=t,v=d.arrow?.centerOffset!==0,i=v?0:e.arrowWidth,P=v?0:e.arrowHeight,[I,M]=GU(a),R={start:"0%",center:"50%",end:"100%"}[M],F=(d.arrow?.x??0)+i/2,q=(d.arrow?.y??0)+P/2;let H="",j="";return I==="bottom"?(H=v?R:`${F}px`,j=`${-P}px`):I==="top"?(H=v?R:`${F}px`,j=`${l.floating.height+P}px`):I==="right"?(H=`${-P}px`,j=v?R:`${q}px`):I==="left"&&(H=`${l.floating.width+P}px`,j=v?R:`${q}px`),{data:{x:H,y:j}}}});function GU(e){const[t,a="center"]=e.split("-");return[t,a]}var SC=FU,TC=UU,AC=VU,EC=qU,[Fb]=Gs("Tooltip",[im]),Bb=im(),HU="TooltipProvider",sJ=700,bP="tooltip.open",[lJ,PC]=Fb(HU),WU=e=>{const{__scopeTooltip:t,delayDuration:a=sJ,skipDelayDuration:l=300,disableHoverableContent:d=!1,children:_}=e,v=ie.useRef(!0),i=ie.useRef(!1),P=ie.useRef(0);return ie.useEffect(()=>{const I=P.current;return()=>window.clearTimeout(I)},[]),T.jsx(lJ,{scope:t,isOpenDelayedRef:v,delayDuration:a,onOpen:ie.useCallback(()=>{window.clearTimeout(P.current),v.current=!1},[]),onClose:ie.useCallback(()=>{window.clearTimeout(P.current),P.current=window.setTimeout(()=>v.current=!0,l)},[l]),isPointerInTransitRef:i,onPointerInTransitChange:ie.useCallback(I=>{i.current=I},[]),disableHoverableContent:d,children:_})};WU.displayName=HU;var q_="Tooltip",[cJ,Ub]=Fb(q_),ZU=e=>{const{__scopeTooltip:t,children:a,open:l,defaultOpen:d,onOpenChange:_,disableHoverableContent:v,delayDuration:i}=e,P=PC(q_,e.__scopeTooltip),I=Bb(t),[M,R]=ie.useState(null),F=Cl(),q=ie.useRef(0),H=v??P.disableHoverableContent,j=i??P.delayDuration,$=ie.useRef(!1),[Y,K]=Il({prop:l,defaultProp:d??!1,onChange:de=>{de?(P.onOpen(),document.dispatchEvent(new CustomEvent(bP))):P.onClose(),_?.(de)},caller:q_}),re=ie.useMemo(()=>Y?$.current?"delayed-open":"instant-open":"closed",[Y]),se=ie.useCallback(()=>{window.clearTimeout(q.current),q.current=0,$.current=!1,K(!0)},[K]),J=ie.useCallback(()=>{window.clearTimeout(q.current),q.current=0,K(!1)},[K]),ae=ie.useCallback(()=>{window.clearTimeout(q.current),q.current=window.setTimeout(()=>{$.current=!0,K(!0),q.current=0},j)},[j,K]);return ie.useEffect(()=>()=>{q.current&&(window.clearTimeout(q.current),q.current=0)},[]),T.jsx(SC,{...I,children:T.jsx(cJ,{scope:t,contentId:F,open:Y,stateAttribute:re,trigger:M,onTriggerChange:R,onTriggerEnter:ie.useCallback(()=>{P.isOpenDelayedRef.current?ae():se()},[P.isOpenDelayedRef,ae,se]),onTriggerLeave:ie.useCallback(()=>{H?J():(window.clearTimeout(q.current),q.current=0)},[J,H]),onOpen:se,onClose:J,disableHoverableContent:H,children:a})})};ZU.displayName=q_;var wP="TooltipTrigger",XU=ie.forwardRef((e,t)=>{const{__scopeTooltip:a,...l}=e,d=Ub(wP,a),_=PC(wP,a),v=Bb(a),i=ie.useRef(null),P=ui(t,i,d.onTriggerChange),I=ie.useRef(!1),M=ie.useRef(!1),R=ie.useCallback(()=>I.current=!1,[]);return ie.useEffect(()=>()=>document.removeEventListener("pointerup",R),[R]),T.jsx(TC,{asChild:!0,...v,children:T.jsx(yn.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...l,ref:P,onPointerMove:Pr(e.onPointerMove,F=>{F.pointerType!=="touch"&&!M.current&&!_.isPointerInTransitRef.current&&(d.onTriggerEnter(),M.current=!0)}),onPointerLeave:Pr(e.onPointerLeave,()=>{d.onTriggerLeave(),M.current=!1}),onPointerDown:Pr(e.onPointerDown,()=>{d.open&&d.onClose(),I.current=!0,document.addEventListener("pointerup",R,{once:!0})}),onFocus:Pr(e.onFocus,()=>{I.current||d.onOpen()}),onBlur:Pr(e.onBlur,d.onClose),onClick:Pr(e.onClick,d.onClose)})})});XU.displayName=wP;var uJ="TooltipPortal",[pxe,hJ]=Fb(uJ,{forceMount:void 0}),Tp="TooltipContent",KU=ie.forwardRef((e,t)=>{const a=hJ(Tp,e.__scopeTooltip),{forceMount:l=a.forceMount,side:d="top",..._}=e,v=Ub(Tp,e.__scopeTooltip);return T.jsx(Rc,{present:l||v.open,children:v.disableHoverableContent?T.jsx(YU,{side:d,..._,ref:t}):T.jsx(dJ,{side:d,..._,ref:t})})}),dJ=ie.forwardRef((e,t)=>{const a=Ub(Tp,e.__scopeTooltip),l=PC(Tp,e.__scopeTooltip),d=ie.useRef(null),_=ui(t,d),[v,i]=ie.useState(null),{trigger:P,onClose:I}=a,M=d.current,{onPointerInTransitChange:R}=l,F=ie.useCallback(()=>{i(null),R(!1)},[R]),q=ie.useCallback((H,j)=>{const $=H.currentTarget,Y={x:H.clientX,y:H.clientY},K=_J(Y,$.getBoundingClientRect()),re=yJ(Y,K),se=vJ(j.getBoundingClientRect()),J=bJ([...re,...se]);i(J),R(!0)},[R]);return ie.useEffect(()=>()=>F(),[F]),ie.useEffect(()=>{if(P&&M){const H=$=>q($,M),j=$=>q($,P);return P.addEventListener("pointerleave",H),M.addEventListener("pointerleave",j),()=>{P.removeEventListener("pointerleave",H),M.removeEventListener("pointerleave",j)}}},[P,M,q,F]),ie.useEffect(()=>{if(v){const H=j=>{const $=j.target,Y={x:j.clientX,y:j.clientY},K=P?.contains($)||M?.contains($),re=!xJ(Y,v);K?F():re&&(F(),I())};return document.addEventListener("pointermove",H),()=>document.removeEventListener("pointermove",H)}},[P,M,v,I,F]),T.jsx(YU,{...e,ref:_})}),[fJ,pJ]=Fb(q_,{isInside:!1}),mJ=_X("TooltipContent"),YU=ie.forwardRef((e,t)=>{const{__scopeTooltip:a,children:l,"aria-label":d,onEscapeKeyDown:_,onPointerDownOutside:v,...i}=e,P=Ub(Tp,a),I=Bb(a),{onClose:M}=P;return ie.useEffect(()=>(document.addEventListener(bP,M),()=>document.removeEventListener(bP,M)),[M]),ie.useEffect(()=>{if(P.trigger){const R=F=>{F.target?.contains(P.trigger)&&M()};return window.addEventListener("scroll",R,{capture:!0}),()=>window.removeEventListener("scroll",R,{capture:!0})}},[P.trigger,M]),T.jsx(Oy,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:_,onPointerDownOutside:v,onFocusOutside:R=>R.preventDefault(),onDismiss:M,children:T.jsxs(AC,{"data-state":P.stateAttribute,...I,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[T.jsx(mJ,{children:l}),T.jsx(fJ,{scope:a,isInside:!0,children:T.jsx(FX,{id:P.contentId,role:"tooltip",children:d||l})})]})})});KU.displayName=Tp;var JU="TooltipArrow",gJ=ie.forwardRef((e,t)=>{const{__scopeTooltip:a,...l}=e,d=Bb(a);return pJ(JU,a).isInside?null:T.jsx(EC,{...d,...l,ref:t})});gJ.displayName=JU;function _J(e,t){const a=Math.abs(t.top-e.y),l=Math.abs(t.bottom-e.y),d=Math.abs(t.right-e.x),_=Math.abs(t.left-e.x);switch(Math.min(a,l,d,_)){case _:return"left";case d:return"right";case a:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function yJ(e,t,a=5){const l=[];switch(t){case"top":l.push({x:e.x-a,y:e.y+a},{x:e.x+a,y:e.y+a});break;case"bottom":l.push({x:e.x-a,y:e.y-a},{x:e.x+a,y:e.y-a});break;case"left":l.push({x:e.x+a,y:e.y-a},{x:e.x+a,y:e.y+a});break;case"right":l.push({x:e.x-a,y:e.y-a},{x:e.x-a,y:e.y+a});break}return l}function vJ(e){const{top:t,right:a,bottom:l,left:d}=e;return[{x:d,y:t},{x:a,y:t},{x:a,y:l},{x:d,y:l}]}function xJ(e,t){const{x:a,y:l}=e;let d=!1;for(let _=0,v=t.length-1;_<t.length;v=_++){const i=t[_],P=t[v],I=i.x,M=i.y,R=P.x,F=P.y;M>l!=F>l&&a<(R-I)*(l-M)/(F-M)+I&&(d=!d)}return d}function bJ(e){const t=e.slice();return t.sort((a,l)=>a.x<l.x?-1:a.x>l.x?1:a.y<l.y?-1:a.y>l.y?1:0),wJ(t)}function wJ(e){if(e.length<=1)return e.slice();const t=[];for(let l=0;l<e.length;l++){const d=e[l];for(;t.length>=2;){const _=t[t.length-1],v=t[t.length-2];if((_.x-v.x)*(d.y-v.y)>=(_.y-v.y)*(d.x-v.x))t.pop();else break}t.push(d)}t.pop();const a=[];for(let l=e.length-1;l>=0;l--){const d=e[l];for(;a.length>=2;){const _=a[a.length-1],v=a[a.length-2];if((_.x-v.x)*(d.y-v.y)>=(_.y-v.y)*(d.x-v.x))a.pop();else break}a.push(d)}return a.pop(),t.length===1&&a.length===1&&t[0].x===a[0].x&&t[0].y===a[0].y?t:t.concat(a)}var SJ=WU,TJ=ZU,AJ=XU,QU=KU;const eV=SJ,EJ=TJ,PJ=AJ,tV=ie.forwardRef(({className:e,sideOffset:t=4,...a},l)=>T.jsx(QU,{ref:l,sideOffset:t,className:Nn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...a}));tV.displayName=QU.displayName;const zu=ie.forwardRef(({className:e,...t},a)=>T.jsx("div",{ref:a,className:Nn("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));zu.displayName="Card";const us=ie.forwardRef(({className:e,...t},a)=>T.jsx("div",{ref:a,className:Nn("flex flex-col space-y-1.5 p-6",e),...t}));us.displayName="CardHeader";const hs=ie.forwardRef(({className:e,...t},a)=>T.jsx("div",{ref:a,className:Nn("text-2xl font-semibold leading-none tracking-tight",e),...t}));hs.displayName="CardTitle";const gc=ie.forwardRef(({className:e,...t},a)=>T.jsx("div",{ref:a,className:Nn("text-sm text-muted-foreground",e),...t}));gc.displayName="CardDescription";const Hi=ie.forwardRef(({className:e,...t},a)=>T.jsx("div",{ref:a,className:Nn("p-6 pt-0",e),...t}));Hi.displayName="CardContent";const IJ=ie.forwardRef(({className:e,...t},a)=>T.jsx("div",{ref:a,className:Nn("flex items-center p-6 pt-0",e),...t}));IJ.displayName="CardFooter";function FN(){return T.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 grid-pattern",children:T.jsx("div",{className:"premium-card w-full max-w-md mx-4 hover:scale-105",children:T.jsxs(Hi,{className:"p-8 text-center",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(Us,{className:"h-8 w-8 text-slate-300"})}),T.jsxs("div",{className:"mb-6",children:[T.jsx("h1",{className:"text-2xl font-bold text-slate-200 mb-2",children:"ShadowCheck"}),T.jsx("p",{className:"text-xs text-slate-400 cyber-text tracking-wider mb-4",children:"SIGINT FORENSICS PLATFORM"})]}),T.jsx("div",{className:"silver-accent px-4 py-2 rounded-full mb-6 inline-block",children:T.jsxs("span",{className:"text-sm font-semibold text-slate-800 flex items-center gap-2",children:[T.jsx(O_,{className:"h-4 w-4"}),"404 - Page Not Found"]})}),T.jsx("p",{className:"text-sm text-slate-300 mb-6",children:"The requested intelligence resource could not be located in the system."}),T.jsx("div",{className:"space-y-2",children:T.jsx("a",{href:"/dashboard",className:"gold-accent px-4 py-2 rounded-full inline-block hover:scale-105 transition-all duration-300",children:T.jsx("span",{className:"text-sm font-semibold text-slate-800",children:"Return to Command Center"})})})]})})})}const CJ=fC("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ii=ie.forwardRef(({className:e,variant:t,size:a,asChild:l=!1,...d},_)=>{const v=l?mX:"button";return T.jsx(v,{className:Nn(CJ({variant:t,size:a,className:e})),ref:_,...d})});Ii.displayName="Button";const OJ=fC("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ji({className:e,variant:t,...a}){return T.jsx("div",{className:Nn(OJ({variant:t}),e),...a})}const MJ=[{icon:T.jsx(M_,{className:"h-6 w-6"}),title:"Real-time Signal Intelligence",description:"Advanced SIGINT collection and analysis of wireless communications and RF signatures.",accent:"text-blue-300"},{icon:T.jsx(gd,{className:"h-6 w-6"}),title:"Geospatial Intelligence",description:"Military-grade mapping with PostGIS spatial analysis for forensic investigations.",accent:"text-green-300"},{icon:T.jsx(u4,{className:"h-6 w-6"}),title:"Electronic Surveillance",description:"Multi-spectrum monitoring for cellular, WiFi, Bluetooth, and BLE device detection.",accent:"text-purple-300"},{icon:T.jsx(Lu,{className:"h-6 w-6"}),title:"Forensic Database",description:"Comprehensive intelligence database with advanced correlation and pattern analysis.",accent:"text-orange-300"}],RJ=["Law Enforcement","Security Research","Digital Forensics","SIGINT Operations","Cybersecurity Teams","Intelligence Agencies"];function DJ(){return T.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[T.jsx("nav",{className:"relative z-50 bg-slate-900/95 backdrop-blur-xl border-b border-slate-800/50",children:T.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-4",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 gold-accent",children:T.jsx(Us,{className:"h-7 w-7 text-white"})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent",children:"ShadowCheck"}),T.jsx("p",{className:"text-xs text-slate-400 cyber-text tracking-wider",children:"SIGINT FORENSICS PLATFORM"})]})]}),T.jsxs("div",{className:"flex items-center gap-4",children:[T.jsx(ka,{href:"/dashboard",children:T.jsxs(Ii,{variant:"ghost",className:"text-slate-300 hover:text-white hover:bg-slate-800","data-testid":"nav-dashboard",children:[T.jsx(Ec,{className:"h-4 w-4 mr-2"}),"Dashboard"]})}),T.jsx(ka,{href:"/visualization",children:T.jsxs(Ii,{variant:"ghost",className:"text-slate-300 hover:text-white hover:bg-slate-800","data-testid":"nav-visualization",children:[T.jsx(gd,{className:"h-4 w-4 mr-2"}),"Visualization"]})}),T.jsx(ka,{href:"/networks",children:T.jsxs(Ii,{variant:"ghost",className:"text-slate-300 hover:text-white hover:bg-slate-800","data-testid":"nav-networks",children:[T.jsx(nd,{className:"h-4 w-4 mr-2"}),"Networks"]})}),T.jsx(ka,{href:"/dashboard",children:T.jsx(Ii,{className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white","data-testid":"nav-launch",children:"Launch Platform"})})]})]})})}),T.jsxs("section",{className:"relative overflow-hidden",children:[T.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:"radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"50px 50px"}}),T.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-blue-500/10 rounded-full blur-3xl"}),T.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"}),T.jsx("div",{className:"relative max-w-7xl mx-auto px-6 py-24 lg:py-32",children:T.jsxs("div",{className:"text-center",children:[T.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-slate-800/50 border border-slate-700 mb-8 cyber-glow cyber-scan-line",children:[T.jsx(Ji,{variant:"secondary",className:"bg-blue-500/20 text-blue-300 border-blue-500/30 cyber-hexagon",children:"New"}),T.jsx("span",{className:"text-sm text-slate-300 cyber-text",children:"Advanced spatial queries now available"}),T.jsx(Zk,{className:"h-4 w-4 text-slate-400"})]}),T.jsxs("h1",{className:"text-4xl sm:text-5xl lg:text-7xl font-bold mb-8 leading-tight",children:[T.jsx("span",{className:"hero-gradient-text block mb-2",children:"Better Context."}),T.jsx("span",{className:"feature-gradient-text glitch-text block mb-2","data-text":"Better Intelligence.",children:"Better Intelligence."}),T.jsx("span",{className:"hero-gradient-text block",children:"Better Analysis."})]}),T.jsx("p",{className:"text-xl text-slate-400 max-w-3xl mx-auto mb-12 leading-relaxed",children:"The most powerful SIGINT forensics platform backed by the industry-leading spatial intelligence engine. Advanced wireless network analysis for security professionals."}),T.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-16",children:[T.jsx(ka,{href:"/dashboard",children:T.jsxs(Ii,{size:"lg",className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-8 py-6 text-lg rounded-xl shadow-lg hover:shadow-xl transition-all duration-300","data-testid":"button-dashboard",children:[T.jsx(rP,{className:"h-5 w-5 mr-2"}),"Launch Dashboard"]})}),T.jsx(ka,{href:"/visualization",children:T.jsxs(Ii,{variant:"outline",size:"lg",className:"border-slate-600 text-slate-300 hover:bg-slate-800 px-8 py-6 text-lg rounded-xl transition-all duration-300","data-testid":"button-visualization",children:[T.jsx(c4,{className:"h-5 w-5 mr-2"}),"Explore Intelligence"]})})]}),T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto px-4",children:[T.jsx("div",{className:"premium-card cyber-border data-stream hover:scale-105",children:T.jsxs(Hi,{className:"p-8 text-center",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(Ec,{className:"h-10 w-10 text-blue-300"})}),T.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-3",children:"SIGINT Analytics"}),T.jsx("p",{className:"text-slate-300 cyber-text",children:"Real-time signal intelligence metrics with advanced data correlation"}),T.jsx("div",{className:"mt-4 silver-accent px-4 py-2 rounded-full inline-block",children:T.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"CLASSIFIED"})})]})}),T.jsx("div",{className:"premium-card cyber-border data-stream hover:scale-105",children:T.jsxs(Hi,{className:"p-8 text-center",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(M_,{className:"h-10 w-10 text-green-300"})}),T.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-3",children:"Electronic Warfare"}),T.jsx("p",{className:"text-slate-300 cyber-text",children:"Multi-spectrum surveillance and RF signature analysis"}),T.jsx("div",{className:"mt-4 silver-accent px-4 py-2 rounded-full inline-block",children:T.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"TACTICAL"})})]})}),T.jsx("div",{className:"premium-card cyber-border data-stream hover:scale-105",children:T.jsxs(Hi,{className:"p-8 text-center",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(u4,{className:"h-10 w-10 text-orange-300"})}),T.jsx("h3",{className:"text-xl font-bold text-slate-100 mb-3",children:"Forensic Intelligence"}),T.jsx("p",{className:"text-slate-300 cyber-text",children:"Advanced pattern recognition and threat assessment"}),T.jsx("div",{className:"mt-4 gold-accent px-4 py-2 rounded-full inline-block",children:T.jsx("span",{className:"text-xs font-semibold text-slate-800",children:"PREMIUM"})})]})})]})]})})]}),T.jsx("section",{className:"py-16 border-t border-slate-800",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[T.jsx("p",{className:"text-center text-sm text-slate-500 mb-8",children:"Trusted by professionals at"}),T.jsx("div",{className:"flex flex-wrap justify-center items-center gap-8",children:RJ.map((e,t)=>T.jsx("div",{className:"text-slate-400 font-medium text-sm px-4 py-2 bg-slate-800/30 rounded-lg border border-slate-700",children:e},t))})]})}),T.jsx("section",{className:"py-24",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[T.jsxs("div",{className:"text-center mb-16",children:[T.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-white mb-6",children:"Industry Leading Quality"}),T.jsx("p",{className:"text-xl text-slate-400 max-w-3xl mx-auto",children:"Proprietary spatial analysis combined with cutting-edge forensics capabilities give you intelligence you can trust for critical operations."})]}),T.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16",children:MJ.map((e,t)=>T.jsxs("div",{className:"premium-card group cursor-pointer hover:scale-105",children:[T.jsx(us,{children:T.jsxs("div",{className:"flex items-center gap-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx("div",{className:`${e.accent}`,children:e.icon})}),T.jsx("div",{children:T.jsx(hs,{className:"text-slate-200 text-lg",children:e.title})})]})}),T.jsx(Hi,{children:T.jsx(gc,{className:"text-slate-300 text-base leading-relaxed",children:e.description})})]},t))}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[T.jsxs("div",{className:"premium-card text-center p-8 hover:scale-105",children:[T.jsx("div",{className:"text-4xl font-bold text-blue-300 mb-2",children:"2,510+"}),T.jsx("div",{className:"text-slate-300 silver-accent px-4 py-2 rounded-full inline-block",children:T.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Network Observations"})})]}),T.jsxs("div",{className:"premium-card text-center p-8 hover:scale-105",children:[T.jsx("div",{className:"text-4xl font-bold text-green-300 mb-2",children:"1,268+"}),T.jsx("div",{className:"text-slate-300 silver-accent px-4 py-2 rounded-full inline-block",children:T.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Distinct Networks"})})]}),T.jsxs("div",{className:"premium-card text-center p-8 hover:scale-105",children:[T.jsx("div",{className:"text-4xl font-bold text-purple-300 mb-2",children:"99.9%"}),T.jsx("div",{className:"text-slate-300 gold-accent px-4 py-2 rounded-full inline-block",children:T.jsx("span",{className:"text-xs font-semibold text-slate-800",children:"Platform Reliability"})})]})]})]})}),T.jsx("section",{className:"py-24 bg-slate-800/30",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[T.jsxs("div",{className:"text-center mb-16",children:[T.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-white mb-6",children:"Built for Security Professionals"}),T.jsx("p",{className:"text-xl text-slate-400 max-w-3xl mx-auto",children:"From real-time monitoring to deep forensics analysis, ShadowCheck provides comprehensive SIGINT capabilities for any intelligence operation."})]}),T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[T.jsx("div",{className:"text-center group",children:T.jsxs("div",{className:"premium-card hover:scale-105 p-8",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(h4,{className:"h-8 w-8 text-blue-300"})}),T.jsx("h3",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Real-time Monitoring"}),T.jsx("p",{className:"text-slate-300",children:"Monitor wireless networks and cellular signals in real-time with advanced filtering and alerting."})]})}),T.jsx("div",{className:"text-center group",children:T.jsxs("div",{className:"premium-card hover:scale-105 p-8",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(v0,{className:"h-8 w-8 text-green-300"})}),T.jsx("h3",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Signal Intelligence"}),T.jsx("p",{className:"text-slate-300",children:"Comprehensive SIGINT analysis including WiFi, Bluetooth, BLE, and cellular data collection."})]})}),T.jsx("div",{className:"text-center group",children:T.jsxs("div",{className:"premium-card hover:scale-105 p-8",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(k7,{className:"h-8 w-8 text-purple-300"})}),T.jsx("h3",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Security & Privacy"}),T.jsx("p",{className:"text-slate-300",children:"Your intelligence data is secure and private by default with enterprise-grade encryption."})]})})]})]})}),T.jsx("section",{className:"py-24",children:T.jsxs("div",{className:"max-w-4xl mx-auto px-6 text-center",children:[T.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-white mb-6",children:"Ready to enhance your intelligence capabilities?"}),T.jsx("p",{className:"text-xl text-slate-400 mb-12",children:"Join security professionals worldwide who trust ShadowCheck for their SIGINT operations."}),T.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[T.jsx(ka,{href:"/dashboard",children:T.jsxs(Ii,{size:"lg",className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-8 py-6 text-lg rounded-xl shadow-lg hover:shadow-xl transition-all duration-300","data-testid":"button-get-started",children:["Get Started Now",T.jsx(Zk,{className:"h-5 w-5 ml-2"})]})}),T.jsx(ka,{href:"/visualization",children:T.jsx(Ii,{variant:"outline",size:"lg",className:"border-slate-600 text-slate-300 hover:bg-slate-800 px-8 py-6 text-lg rounded-xl transition-all duration-300","data-testid":"button-live-demo",children:"View Live Demo"})})]})]})})]})}const po={async getHealth(){return(await os("GET","/api/v1/health")).json()},async getVersion(){return(await os("GET","/api/v1/version")).json()},async getConfig(){return(await os("GET","/api/v1/config")).json()},async getSystemStatus(){return(await os("GET","/api/v1/status")).json()},async getNetworks(e=50){return(await os("GET",`/api/v1/networks?limit=${e}`)).json()},async spatialQuery(e,t,a,l=50){return(await os("GET",`/api/v1/within?lat=${e}&lon=${t}&radius=${a}&limit=${l}`)).json()},async getVisualization(){return(await os("GET","/api/v1/visualize")).json()},async getAnalytics(){return(await os("GET","/api/v1/analytics")).json()},async getSignalStrengthDistribution(){return(await os("GET","/api/v1/signal-strength")).json()},async getSecurityAnalysis(){return(await os("GET","/api/v1/security-analysis")).json()},async getRadioStats(){return(await os("GET","/api/v1/radio-stats")).json()},async getTimelineData(){return(await os("GET","/api/v1/timeline")).json()}};function Mu({className:e,...t}){return T.jsx("div",{className:Nn("animate-pulse rounded-md bg-muted",e),...t})}var GS,BN;function _a(){if(BN)return GS;BN=1;var e=Array.isArray;return GS=e,GS}var HS,UN;function rV(){if(UN)return HS;UN=1;var e=typeof Fx=="object"&&Fx&&Fx.Object===Object&&Fx;return HS=e,HS}var WS,VN;function Nl(){if(VN)return WS;VN=1;var e=rV(),t=typeof self=="object"&&self&&self.Object===Object&&self,a=e||t||Function("return this")();return WS=a,WS}var ZS,$N;function Dy(){if($N)return ZS;$N=1;var e=Nl(),t=e.Symbol;return ZS=t,ZS}var XS,qN;function kJ(){if(qN)return XS;qN=1;var e=Dy(),t=Object.prototype,a=t.hasOwnProperty,l=t.toString,d=e?e.toStringTag:void 0;function _(v){var i=a.call(v,d),P=v[d];try{v[d]=void 0;var I=!0}catch{}var M=l.call(v);return I&&(i?v[d]=P:delete v[d]),M}return XS=_,XS}var KS,GN;function NJ(){if(GN)return KS;GN=1;var e=Object.prototype,t=e.toString;function a(l){return t.call(l)}return KS=a,KS}var YS,HN;function Dc(){if(HN)return YS;HN=1;var e=Dy(),t=kJ(),a=NJ(),l="[object Null]",d="[object Undefined]",_=e?e.toStringTag:void 0;function v(i){return i==null?i===void 0?d:l:_&&_ in Object(i)?t(i):a(i)}return YS=v,YS}var JS,WN;function kc(){if(WN)return JS;WN=1;function e(t){return t!=null&&typeof t=="object"}return JS=e,JS}var QS,ZN;function om(){if(ZN)return QS;ZN=1;var e=Dc(),t=kc(),a="[object Symbol]";function l(d){return typeof d=="symbol"||t(d)&&e(d)==a}return QS=l,QS}var eT,XN;function IC(){if(XN)return eT;XN=1;var e=_a(),t=om(),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,l=/^\w*$/;function d(_,v){if(e(_))return!1;var i=typeof _;return i=="number"||i=="symbol"||i=="boolean"||_==null||t(_)?!0:l.test(_)||!a.test(_)||v!=null&&_ in Object(v)}return eT=d,eT}var tT,KN;function Vu(){if(KN)return tT;KN=1;function e(t){var a=typeof t;return t!=null&&(a=="object"||a=="function")}return tT=e,tT}var rT,YN;function CC(){if(YN)return rT;YN=1;var e=Dc(),t=Vu(),a="[object AsyncFunction]",l="[object Function]",d="[object GeneratorFunction]",_="[object Proxy]";function v(i){if(!t(i))return!1;var P=e(i);return P==l||P==d||P==a||P==_}return rT=v,rT}var nT,JN;function LJ(){if(JN)return nT;JN=1;var e=Nl(),t=e["__core-js_shared__"];return nT=t,nT}var iT,QN;function jJ(){if(QN)return iT;QN=1;var e=LJ(),t=(function(){var l=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""})();function a(l){return!!t&&t in l}return iT=a,iT}var oT,eL;function nV(){if(eL)return oT;eL=1;var e=Function.prototype,t=e.toString;function a(l){if(l!=null){try{return t.call(l)}catch{}try{return l+""}catch{}}return""}return oT=a,oT}var aT,tL;function zJ(){if(tL)return aT;tL=1;var e=CC(),t=jJ(),a=Vu(),l=nV(),d=/[\\^$.*+?()[\]{}|]/g,_=/^\[object .+?Constructor\]$/,v=Function.prototype,i=Object.prototype,P=v.toString,I=i.hasOwnProperty,M=RegExp("^"+P.call(I).replace(d,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function R(F){if(!a(F)||t(F))return!1;var q=e(F)?M:_;return q.test(l(F))}return aT=R,aT}var sT,rL;function FJ(){if(rL)return sT;rL=1;function e(t,a){return t?.[a]}return sT=e,sT}var lT,nL;function _d(){if(nL)return lT;nL=1;var e=zJ(),t=FJ();function a(l,d){var _=t(l,d);return e(_)?_:void 0}return lT=a,lT}var cT,iL;function Vb(){if(iL)return cT;iL=1;var e=_d(),t=e(Object,"create");return cT=t,cT}var uT,oL;function BJ(){if(oL)return uT;oL=1;var e=Vb();function t(){this.__data__=e?e(null):{},this.size=0}return uT=t,uT}var hT,aL;function UJ(){if(aL)return hT;aL=1;function e(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a}return hT=e,hT}var dT,sL;function VJ(){if(sL)return dT;sL=1;var e=Vb(),t="__lodash_hash_undefined__",a=Object.prototype,l=a.hasOwnProperty;function d(_){var v=this.__data__;if(e){var i=v[_];return i===t?void 0:i}return l.call(v,_)?v[_]:void 0}return dT=d,dT}var fT,lL;function $J(){if(lL)return fT;lL=1;var e=Vb(),t=Object.prototype,a=t.hasOwnProperty;function l(d){var _=this.__data__;return e?_[d]!==void 0:a.call(_,d)}return fT=l,fT}var pT,cL;function qJ(){if(cL)return pT;cL=1;var e=Vb(),t="__lodash_hash_undefined__";function a(l,d){var _=this.__data__;return this.size+=this.has(l)?0:1,_[l]=e&&d===void 0?t:d,this}return pT=a,pT}var mT,uL;function GJ(){if(uL)return mT;uL=1;var e=BJ(),t=UJ(),a=VJ(),l=$J(),d=qJ();function _(v){var i=-1,P=v==null?0:v.length;for(this.clear();++i<P;){var I=v[i];this.set(I[0],I[1])}}return _.prototype.clear=e,_.prototype.delete=t,_.prototype.get=a,_.prototype.has=l,_.prototype.set=d,mT=_,mT}var gT,hL;function HJ(){if(hL)return gT;hL=1;function e(){this.__data__=[],this.size=0}return gT=e,gT}var _T,dL;function OC(){if(dL)return _T;dL=1;function e(t,a){return t===a||t!==t&&a!==a}return _T=e,_T}var yT,fL;function $b(){if(fL)return yT;fL=1;var e=OC();function t(a,l){for(var d=a.length;d--;)if(e(a[d][0],l))return d;return-1}return yT=t,yT}var vT,pL;function WJ(){if(pL)return vT;pL=1;var e=$b(),t=Array.prototype,a=t.splice;function l(d){var _=this.__data__,v=e(_,d);if(v<0)return!1;var i=_.length-1;return v==i?_.pop():a.call(_,v,1),--this.size,!0}return vT=l,vT}var xT,mL;function ZJ(){if(mL)return xT;mL=1;var e=$b();function t(a){var l=this.__data__,d=e(l,a);return d<0?void 0:l[d][1]}return xT=t,xT}var bT,gL;function XJ(){if(gL)return bT;gL=1;var e=$b();function t(a){return e(this.__data__,a)>-1}return bT=t,bT}var wT,_L;function KJ(){if(_L)return wT;_L=1;var e=$b();function t(a,l){var d=this.__data__,_=e(d,a);return _<0?(++this.size,d.push([a,l])):d[_][1]=l,this}return wT=t,wT}var ST,yL;function qb(){if(yL)return ST;yL=1;var e=HJ(),t=WJ(),a=ZJ(),l=XJ(),d=KJ();function _(v){var i=-1,P=v==null?0:v.length;for(this.clear();++i<P;){var I=v[i];this.set(I[0],I[1])}}return _.prototype.clear=e,_.prototype.delete=t,_.prototype.get=a,_.prototype.has=l,_.prototype.set=d,ST=_,ST}var TT,vL;function MC(){if(vL)return TT;vL=1;var e=_d(),t=Nl(),a=e(t,"Map");return TT=a,TT}var AT,xL;function YJ(){if(xL)return AT;xL=1;var e=GJ(),t=qb(),a=MC();function l(){this.size=0,this.__data__={hash:new e,map:new(a||t),string:new e}}return AT=l,AT}var ET,bL;function JJ(){if(bL)return ET;bL=1;function e(t){var a=typeof t;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?t!=="__proto__":t===null}return ET=e,ET}var PT,wL;function Gb(){if(wL)return PT;wL=1;var e=JJ();function t(a,l){var d=a.__data__;return e(l)?d[typeof l=="string"?"string":"hash"]:d.map}return PT=t,PT}var IT,SL;function QJ(){if(SL)return IT;SL=1;var e=Gb();function t(a){var l=e(this,a).delete(a);return this.size-=l?1:0,l}return IT=t,IT}var CT,TL;function eQ(){if(TL)return CT;TL=1;var e=Gb();function t(a){return e(this,a).get(a)}return CT=t,CT}var OT,AL;function tQ(){if(AL)return OT;AL=1;var e=Gb();function t(a){return e(this,a).has(a)}return OT=t,OT}var MT,EL;function rQ(){if(EL)return MT;EL=1;var e=Gb();function t(a,l){var d=e(this,a),_=d.size;return d.set(a,l),this.size+=d.size==_?0:1,this}return MT=t,MT}var RT,PL;function RC(){if(PL)return RT;PL=1;var e=YJ(),t=QJ(),a=eQ(),l=tQ(),d=rQ();function _(v){var i=-1,P=v==null?0:v.length;for(this.clear();++i<P;){var I=v[i];this.set(I[0],I[1])}}return _.prototype.clear=e,_.prototype.delete=t,_.prototype.get=a,_.prototype.has=l,_.prototype.set=d,RT=_,RT}var DT,IL;function iV(){if(IL)return DT;IL=1;var e=RC(),t="Expected a function";function a(l,d){if(typeof l!="function"||d!=null&&typeof d!="function")throw new TypeError(t);var _=function(){var v=arguments,i=d?d.apply(this,v):v[0],P=_.cache;if(P.has(i))return P.get(i);var I=l.apply(this,v);return _.cache=P.set(i,I)||P,I};return _.cache=new(a.Cache||e),_}return a.Cache=e,DT=a,DT}var kT,CL;function nQ(){if(CL)return kT;CL=1;var e=iV(),t=500;function a(l){var d=e(l,function(v){return _.size===t&&_.clear(),v}),_=d.cache;return d}return kT=a,kT}var NT,OL;function iQ(){if(OL)return NT;OL=1;var e=nQ(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,l=e(function(d){var _=[];return d.charCodeAt(0)===46&&_.push(""),d.replace(t,function(v,i,P,I){_.push(P?I.replace(a,"$1"):i||v)}),_});return NT=l,NT}var LT,ML;function DC(){if(ML)return LT;ML=1;function e(t,a){for(var l=-1,d=t==null?0:t.length,_=Array(d);++l<d;)_[l]=a(t[l],l,t);return _}return LT=e,LT}var jT,RL;function oQ(){if(RL)return jT;RL=1;var e=Dy(),t=DC(),a=_a(),l=om(),d=e?e.prototype:void 0,_=d?d.toString:void 0;function v(i){if(typeof i=="string")return i;if(a(i))return t(i,v)+"";if(l(i))return _?_.call(i):"";var P=i+"";return P=="0"&&1/i==-1/0?"-0":P}return jT=v,jT}var zT,DL;function oV(){if(DL)return zT;DL=1;var e=oQ();function t(a){return a==null?"":e(a)}return zT=t,zT}var FT,kL;function aV(){if(kL)return FT;kL=1;var e=_a(),t=IC(),a=iQ(),l=oV();function d(_,v){return e(_)?_:t(_,v)?[_]:a(l(_))}return FT=d,FT}var BT,NL;function Hb(){if(NL)return BT;NL=1;var e=om();function t(a){if(typeof a=="string"||e(a))return a;var l=a+"";return l=="0"&&1/a==-1/0?"-0":l}return BT=t,BT}var UT,LL;function kC(){if(LL)return UT;LL=1;var e=aV(),t=Hb();function a(l,d){d=e(d,l);for(var _=0,v=d.length;l!=null&&_<v;)l=l[t(d[_++])];return _&&_==v?l:void 0}return UT=a,UT}var VT,jL;function sV(){if(jL)return VT;jL=1;var e=kC();function t(a,l,d){var _=a==null?void 0:e(a,l);return _===void 0?d:_}return VT=t,VT}var aQ=sV();const Va=si(aQ);var $T,zL;function sQ(){if(zL)return $T;zL=1;function e(t){return t==null}return $T=e,$T}var lQ=sQ();const xn=si(lQ);var qT,FL;function cQ(){if(FL)return qT;FL=1;var e=Dc(),t=_a(),a=kc(),l="[object String]";function d(_){return typeof _=="string"||!t(_)&&a(_)&&e(_)==l}return qT=d,qT}var uQ=cQ();const ld=si(uQ);var hQ=CC();const pn=si(hQ);var dQ=Vu();const am=si(dQ);var GT={exports:{}},li={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BL;function fQ(){if(BL)return li;BL=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),v=Symbol.for("react.context"),i=Symbol.for("react.server_context"),P=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),q=Symbol.for("react.offscreen"),H;H=Symbol.for("react.module.reference");function j($){if(typeof $=="object"&&$!==null){var Y=$.$$typeof;switch(Y){case e:switch($=$.type,$){case a:case d:case l:case I:case M:return $;default:switch($=$&&$.$$typeof,$){case i:case v:case P:case F:case R:case _:return $;default:return Y}}case t:return Y}}}return li.ContextConsumer=v,li.ContextProvider=_,li.Element=e,li.ForwardRef=P,li.Fragment=a,li.Lazy=F,li.Memo=R,li.Portal=t,li.Profiler=d,li.StrictMode=l,li.Suspense=I,li.SuspenseList=M,li.isAsyncMode=function(){return!1},li.isConcurrentMode=function(){return!1},li.isContextConsumer=function($){return j($)===v},li.isContextProvider=function($){return j($)===_},li.isElement=function($){return typeof $=="object"&&$!==null&&$.$$typeof===e},li.isForwardRef=function($){return j($)===P},li.isFragment=function($){return j($)===a},li.isLazy=function($){return j($)===F},li.isMemo=function($){return j($)===R},li.isPortal=function($){return j($)===t},li.isProfiler=function($){return j($)===d},li.isStrictMode=function($){return j($)===l},li.isSuspense=function($){return j($)===I},li.isSuspenseList=function($){return j($)===M},li.isValidElementType=function($){return typeof $=="string"||typeof $=="function"||$===a||$===d||$===l||$===I||$===M||$===q||typeof $=="object"&&$!==null&&($.$$typeof===F||$.$$typeof===R||$.$$typeof===_||$.$$typeof===v||$.$$typeof===P||$.$$typeof===H||$.getModuleId!==void 0)},li.typeOf=j,li}var UL;function pQ(){return UL||(UL=1,GT.exports=fQ()),GT.exports}var mQ=pQ(),HT,VL;function lV(){if(VL)return HT;VL=1;var e=Dc(),t=kc(),a="[object Number]";function l(d){return typeof d=="number"||t(d)&&e(d)==a}return HT=l,HT}var WT,$L;function gQ(){if($L)return WT;$L=1;var e=lV();function t(a){return e(a)&&a!=+a}return WT=t,WT}var _Q=gQ();const ky=si(_Q);var yQ=lV();const vQ=si(yQ);var la=function(t){return t===0?0:t>0?1:-1},Yh=function(t){return ld(t)&&t.indexOf("%")===t.length-1},fr=function(t){return vQ(t)&&!ky(t)},xQ=function(t){return xn(t)},go=function(t){return fr(t)||ld(t)},bQ=0,sm=function(t){var a=++bQ;return"".concat(t||"").concat(a)},ca=function(t,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!fr(t)&&!ld(t))return l;var _;if(Yh(t)){var v=t.indexOf("%");_=a*parseFloat(t.slice(0,v))/100}else _=+t;return ky(_)&&(_=l),d&&_>a&&(_=a),_},Ru=function(t){if(!t)return null;var a=Object.keys(t);return a&&a.length?t[a[0]]:null},wQ=function(t){if(!Array.isArray(t))return!1;for(var a=t.length,l={},d=0;d<a;d++)if(!l[t[d]])l[t[d]]=!0;else return!0;return!1},za=function(t,a){return fr(t)&&fr(a)?function(l){return t+l*(a-t)}:function(){return a}};function E0(e,t,a){return!e||!e.length?null:e.find(function(l){return l&&(typeof t=="function"?t(l):Va(l,t))===a})}var SQ=function(t,a){return fr(t)&&fr(a)?t-a:ld(t)&&ld(a)?t.localeCompare(a):t instanceof Date&&a instanceof Date?t.getTime()-a.getTime():String(t).localeCompare(String(a))};function _p(e,t){for(var a in e)if({}.hasOwnProperty.call(e,a)&&(!{}.hasOwnProperty.call(t,a)||e[a]!==t[a]))return!1;for(var l in t)if({}.hasOwnProperty.call(t,l)&&!{}.hasOwnProperty.call(e,l))return!1;return!0}function SP(e){"@babel/helpers - typeof";return SP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SP(e)}var TQ=["viewBox","children"],AQ=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],qL=["points","pathLength"],ZT={svg:TQ,polygon:qL,polyline:qL},NC=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],P0=function(t,a){if(!t||typeof t=="function"||typeof t=="boolean")return null;var l=t;if(ie.isValidElement(t)&&(l=t.props),!am(l))return null;var d={};return Object.keys(l).forEach(function(_){NC.includes(_)&&(d[_]=a||function(v){return l[_](l,v)})}),d},EQ=function(t,a,l){return function(d){return t(a,l,d),null}},cd=function(t,a,l){if(!am(t)||SP(t)!=="object")return null;var d=null;return Object.keys(t).forEach(function(_){var v=t[_];NC.includes(_)&&typeof v=="function"&&(d||(d={}),d[_]=EQ(v,a,l))}),d},PQ=["children"],IQ=["children"];function GL(e,t){if(e==null)return{};var a=CQ(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function CQ(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function TP(e){"@babel/helpers - typeof";return TP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},TP(e)}var HL={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},wc=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},WL=null,XT=null,LC=function e(t){if(t===WL&&Array.isArray(XT))return XT;var a=[];return ie.Children.forEach(t,function(l){xn(l)||(mQ.isFragment(l)?a=a.concat(e(l.props.children)):a.push(l))}),XT=a,WL=t,a};function $a(e,t){var a=[],l=[];return Array.isArray(t)?l=t.map(function(d){return wc(d)}):l=[wc(t)],LC(e).forEach(function(d){var _=Va(d,"type.displayName")||Va(d,"type.name");l.indexOf(_)!==-1&&a.push(d)}),a}function Na(e,t){var a=$a(e,t);return a&&a[0]}var ZL=function(t){if(!t||!t.props)return!1;var a=t.props,l=a.width,d=a.height;return!(!fr(l)||l<=0||!fr(d)||d<=0)},OQ=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],MQ=function(t){return t&&t.type&&ld(t.type)&&OQ.indexOf(t.type)>=0},RQ=function(t){return t&&TP(t)==="object"&&"clipDot"in t},DQ=function(t,a,l,d){var _,v=(_=ZT?.[d])!==null&&_!==void 0?_:[];return a.startsWith("data-")||!pn(t)&&(d&&v.includes(a)||AQ.includes(a))||l&&NC.includes(a)},Jr=function(t,a,l){if(!t||typeof t=="function"||typeof t=="boolean")return null;var d=t;if(ie.isValidElement(t)&&(d=t.props),!am(d))return null;var _={};return Object.keys(d).forEach(function(v){var i;DQ((i=d)===null||i===void 0?void 0:i[v],v,a,l)&&(_[v]=d[v])}),_},AP=function e(t,a){if(t===a)return!0;var l=ie.Children.count(t);if(l!==ie.Children.count(a))return!1;if(l===0)return!0;if(l===1)return XL(Array.isArray(t)?t[0]:t,Array.isArray(a)?a[0]:a);for(var d=0;d<l;d++){var _=t[d],v=a[d];if(Array.isArray(_)||Array.isArray(v)){if(!e(_,v))return!1}else if(!XL(_,v))return!1}return!0},XL=function(t,a){if(xn(t)&&xn(a))return!0;if(!xn(t)&&!xn(a)){var l=t.props||{},d=l.children,_=GL(l,PQ),v=a.props||{},i=v.children,P=GL(v,IQ);return d&&i?_p(_,P)&&AP(d,i):!d&&!i?_p(_,P):!1}return!1},KL=function(t,a){var l=[],d={};return LC(t).forEach(function(_,v){if(MQ(_))l.push(_);else if(_){var i=wc(_.type),P=a[i]||{},I=P.handler,M=P.once;if(I&&(!M||!d[i])){var R=I(_,i,v);l.push(R),d[i]=!0}}}),l},kQ=function(t){var a=t&&t.type;return a&&HL[a]?HL[a]:null},NQ=function(t,a){return LC(a).indexOf(t)},LQ=["children","width","height","viewBox","className","style","title","desc"];function EP(){return EP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},EP.apply(this,arguments)}function jQ(e,t){if(e==null)return{};var a=zQ(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function zQ(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function PP(e){var t=e.children,a=e.width,l=e.height,d=e.viewBox,_=e.className,v=e.style,i=e.title,P=e.desc,I=jQ(e,LQ),M=d||{width:a,height:l,x:0,y:0},R=Sn("recharts-surface",_);return He.createElement("svg",EP({},Jr(I,!0,"svg"),{className:R,width:a,height:l,style:v,viewBox:"".concat(M.x," ").concat(M.y," ").concat(M.width," ").concat(M.height)}),He.createElement("title",null,i),He.createElement("desc",null,P),t)}var FQ=["children","className"];function IP(){return IP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},IP.apply(this,arguments)}function BQ(e,t){if(e==null)return{};var a=UQ(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function UQ(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}var ti=He.forwardRef(function(e,t){var a=e.children,l=e.className,d=BQ(e,FQ),_=Sn("recharts-layer",l);return He.createElement("g",IP({className:_},Jr(d,!0),{ref:t}),a)}),Vs=function(t,a){for(var l=arguments.length,d=new Array(l>2?l-2:0),_=2;_<l;_++)d[_-2]=arguments[_]},KT,YL;function VQ(){if(YL)return KT;YL=1;function e(t,a,l){var d=-1,_=t.length;a<0&&(a=-a>_?0:_+a),l=l>_?_:l,l<0&&(l+=_),_=a>l?0:l-a>>>0,a>>>=0;for(var v=Array(_);++d<_;)v[d]=t[d+a];return v}return KT=e,KT}var YT,JL;function $Q(){if(JL)return YT;JL=1;var e=VQ();function t(a,l,d){var _=a.length;return d=d===void 0?_:d,!l&&d>=_?a:e(a,l,d)}return YT=t,YT}var JT,QL;function cV(){if(QL)return JT;QL=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",a="\\ufe20-\\ufe2f",l="\\u20d0-\\u20ff",d=t+a+l,_="\\ufe0e\\ufe0f",v="\\u200d",i=RegExp("["+v+e+d+_+"]");function P(I){return i.test(I)}return JT=P,JT}var QT,ej;function qQ(){if(ej)return QT;ej=1;function e(t){return t.split("")}return QT=e,QT}var eA,tj;function GQ(){if(tj)return eA;tj=1;var e="\\ud800-\\udfff",t="\\u0300-\\u036f",a="\\ufe20-\\ufe2f",l="\\u20d0-\\u20ff",d=t+a+l,_="\\ufe0e\\ufe0f",v="["+e+"]",i="["+d+"]",P="\\ud83c[\\udffb-\\udfff]",I="(?:"+i+"|"+P+")",M="[^"+e+"]",R="(?:\\ud83c[\\udde6-\\uddff]){2}",F="[\\ud800-\\udbff][\\udc00-\\udfff]",q="\\u200d",H=I+"?",j="["+_+"]?",$="(?:"+q+"(?:"+[M,R,F].join("|")+")"+j+H+")*",Y=j+H+$,K="(?:"+[M+i+"?",i,R,F,v].join("|")+")",re=RegExp(P+"(?="+P+")|"+K+Y,"g");function se(J){return J.match(re)||[]}return eA=se,eA}var tA,rj;function HQ(){if(rj)return tA;rj=1;var e=qQ(),t=cV(),a=GQ();function l(d){return t(d)?a(d):e(d)}return tA=l,tA}var rA,nj;function WQ(){if(nj)return rA;nj=1;var e=$Q(),t=cV(),a=HQ(),l=oV();function d(_){return function(v){v=l(v);var i=t(v)?a(v):void 0,P=i?i[0]:v.charAt(0),I=i?e(i,1).join(""):v.slice(1);return P[_]()+I}}return rA=d,rA}var nA,ij;function ZQ(){if(ij)return nA;ij=1;var e=WQ(),t=e("toUpperCase");return nA=t,nA}var XQ=ZQ();const Wb=si(XQ);function Pi(e){return function(){return e}}const uV=Math.cos,I0=Math.sin,Hs=Math.sqrt,C0=Math.PI,Zb=2*C0,CP=Math.PI,OP=2*CP,Wh=1e-6,KQ=OP-Wh;function hV(e){this._+=e[0];for(let t=1,a=e.length;t<a;++t)this._+=arguments[t]+e[t]}function YQ(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return hV;const a=10**t;return function(l){this._+=l[0];for(let d=1,_=l.length;d<_;++d)this._+=Math.round(arguments[d]*a)/a+l[d]}}class JQ{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?hV:YQ(t)}moveTo(t,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,a){this._append`L${this._x1=+t},${this._y1=+a}`}quadraticCurveTo(t,a,l,d){this._append`Q${+t},${+a},${this._x1=+l},${this._y1=+d}`}bezierCurveTo(t,a,l,d,_,v){this._append`C${+t},${+a},${+l},${+d},${this._x1=+_},${this._y1=+v}`}arcTo(t,a,l,d,_){if(t=+t,a=+a,l=+l,d=+d,_=+_,_<0)throw new Error(`negative radius: ${_}`);let v=this._x1,i=this._y1,P=l-t,I=d-a,M=v-t,R=i-a,F=M*M+R*R;if(this._x1===null)this._append`M${this._x1=t},${this._y1=a}`;else if(F>Wh)if(!(Math.abs(R*P-I*M)>Wh)||!_)this._append`L${this._x1=t},${this._y1=a}`;else{let q=l-v,H=d-i,j=P*P+I*I,$=q*q+H*H,Y=Math.sqrt(j),K=Math.sqrt(F),re=_*Math.tan((CP-Math.acos((j+F-$)/(2*Y*K)))/2),se=re/K,J=re/Y;Math.abs(se-1)>Wh&&this._append`L${t+se*M},${a+se*R}`,this._append`A${_},${_},0,0,${+(R*q>M*H)},${this._x1=t+J*P},${this._y1=a+J*I}`}}arc(t,a,l,d,_,v){if(t=+t,a=+a,l=+l,v=!!v,l<0)throw new Error(`negative radius: ${l}`);let i=l*Math.cos(d),P=l*Math.sin(d),I=t+i,M=a+P,R=1^v,F=v?d-_:_-d;this._x1===null?this._append`M${I},${M}`:(Math.abs(this._x1-I)>Wh||Math.abs(this._y1-M)>Wh)&&this._append`L${I},${M}`,l&&(F<0&&(F=F%OP+OP),F>KQ?this._append`A${l},${l},0,1,${R},${t-i},${a-P}A${l},${l},0,1,${R},${this._x1=I},${this._y1=M}`:F>Wh&&this._append`A${l},${l},0,${+(F>=CP)},${R},${this._x1=t+l*Math.cos(_)},${this._y1=a+l*Math.sin(_)}`)}rect(t,a,l,d){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+a}h${l=+l}v${+d}h${-l}Z`}toString(){return this._}}function jC(e){let t=3;return e.digits=function(a){if(!arguments.length)return t;if(a==null)t=null;else{const l=Math.floor(a);if(!(l>=0))throw new RangeError(`invalid digits: ${a}`);t=l}return e},()=>new JQ(t)}function zC(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function dV(e){this._context=e}dV.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Xb(e){return new dV(e)}function fV(e){return e[0]}function pV(e){return e[1]}function mV(e,t){var a=Pi(!0),l=null,d=Xb,_=null,v=jC(i);e=typeof e=="function"?e:e===void 0?fV:Pi(e),t=typeof t=="function"?t:t===void 0?pV:Pi(t);function i(P){var I,M=(P=zC(P)).length,R,F=!1,q;for(l==null&&(_=d(q=v())),I=0;I<=M;++I)!(I<M&&a(R=P[I],I,P))===F&&((F=!F)?_.lineStart():_.lineEnd()),F&&_.point(+e(R,I,P),+t(R,I,P));if(q)return _=null,q+""||null}return i.x=function(P){return arguments.length?(e=typeof P=="function"?P:Pi(+P),i):e},i.y=function(P){return arguments.length?(t=typeof P=="function"?P:Pi(+P),i):t},i.defined=function(P){return arguments.length?(a=typeof P=="function"?P:Pi(!!P),i):a},i.curve=function(P){return arguments.length?(d=P,l!=null&&(_=d(l)),i):d},i.context=function(P){return arguments.length?(P==null?l=_=null:_=d(l=P),i):l},i}function Hx(e,t,a){var l=null,d=Pi(!0),_=null,v=Xb,i=null,P=jC(I);e=typeof e=="function"?e:e===void 0?fV:Pi(+e),t=typeof t=="function"?t:Pi(t===void 0?0:+t),a=typeof a=="function"?a:a===void 0?pV:Pi(+a);function I(R){var F,q,H,j=(R=zC(R)).length,$,Y=!1,K,re=new Array(j),se=new Array(j);for(_==null&&(i=v(K=P())),F=0;F<=j;++F){if(!(F<j&&d($=R[F],F,R))===Y)if(Y=!Y)q=F,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),H=F-1;H>=q;--H)i.point(re[H],se[H]);i.lineEnd(),i.areaEnd()}Y&&(re[F]=+e($,F,R),se[F]=+t($,F,R),i.point(l?+l($,F,R):re[F],a?+a($,F,R):se[F]))}if(K)return i=null,K+""||null}function M(){return mV().defined(d).curve(v).context(_)}return I.x=function(R){return arguments.length?(e=typeof R=="function"?R:Pi(+R),l=null,I):e},I.x0=function(R){return arguments.length?(e=typeof R=="function"?R:Pi(+R),I):e},I.x1=function(R){return arguments.length?(l=R==null?null:typeof R=="function"?R:Pi(+R),I):l},I.y=function(R){return arguments.length?(t=typeof R=="function"?R:Pi(+R),a=null,I):t},I.y0=function(R){return arguments.length?(t=typeof R=="function"?R:Pi(+R),I):t},I.y1=function(R){return arguments.length?(a=R==null?null:typeof R=="function"?R:Pi(+R),I):a},I.lineX0=I.lineY0=function(){return M().x(e).y(t)},I.lineY1=function(){return M().x(e).y(a)},I.lineX1=function(){return M().x(l).y(t)},I.defined=function(R){return arguments.length?(d=typeof R=="function"?R:Pi(!!R),I):d},I.curve=function(R){return arguments.length?(v=R,_!=null&&(i=v(_)),I):v},I.context=function(R){return arguments.length?(R==null?_=i=null:i=v(_=R),I):_},I}class gV{constructor(t,a){this._context=t,this._x=a}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,a){switch(t=+t,a=+a,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,a):this._context.moveTo(t,a);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,a,t,a):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+a)/2,t,this._y0,t,a);break}}this._x0=t,this._y0=a}}function QQ(e){return new gV(e,!0)}function eee(e){return new gV(e,!1)}const FC={draw(e,t){const a=Hs(t/C0);e.moveTo(a,0),e.arc(0,0,a,0,Zb)}},tee={draw(e,t){const a=Hs(t/5)/2;e.moveTo(-3*a,-a),e.lineTo(-a,-a),e.lineTo(-a,-3*a),e.lineTo(a,-3*a),e.lineTo(a,-a),e.lineTo(3*a,-a),e.lineTo(3*a,a),e.lineTo(a,a),e.lineTo(a,3*a),e.lineTo(-a,3*a),e.lineTo(-a,a),e.lineTo(-3*a,a),e.closePath()}},_V=Hs(1/3),ree=_V*2,nee={draw(e,t){const a=Hs(t/ree),l=a*_V;e.moveTo(0,-a),e.lineTo(l,0),e.lineTo(0,a),e.lineTo(-l,0),e.closePath()}},iee={draw(e,t){const a=Hs(t),l=-a/2;e.rect(l,l,a,a)}},oee=.8908130915292852,yV=I0(C0/10)/I0(7*C0/10),aee=I0(Zb/10)*yV,see=-uV(Zb/10)*yV,lee={draw(e,t){const a=Hs(t*oee),l=aee*a,d=see*a;e.moveTo(0,-a),e.lineTo(l,d);for(let _=1;_<5;++_){const v=Zb*_/5,i=uV(v),P=I0(v);e.lineTo(P*a,-i*a),e.lineTo(i*l-P*d,P*l+i*d)}e.closePath()}},iA=Hs(3),cee={draw(e,t){const a=-Hs(t/(iA*3));e.moveTo(0,a*2),e.lineTo(-iA*a,-a),e.lineTo(iA*a,-a),e.closePath()}},as=-.5,ss=Hs(3)/2,MP=1/Hs(12),uee=(MP/2+1)*3,hee={draw(e,t){const a=Hs(t/uee),l=a/2,d=a*MP,_=l,v=a*MP+a,i=-_,P=v;e.moveTo(l,d),e.lineTo(_,v),e.lineTo(i,P),e.lineTo(as*l-ss*d,ss*l+as*d),e.lineTo(as*_-ss*v,ss*_+as*v),e.lineTo(as*i-ss*P,ss*i+as*P),e.lineTo(as*l+ss*d,as*d-ss*l),e.lineTo(as*_+ss*v,as*v-ss*_),e.lineTo(as*i+ss*P,as*P-ss*i),e.closePath()}};function dee(e,t){let a=null,l=jC(d);e=typeof e=="function"?e:Pi(e||FC),t=typeof t=="function"?t:Pi(t===void 0?64:+t);function d(){let _;if(a||(a=_=l()),e.apply(this,arguments).draw(a,+t.apply(this,arguments)),_)return a=null,_+""||null}return d.type=function(_){return arguments.length?(e=typeof _=="function"?_:Pi(_),d):e},d.size=function(_){return arguments.length?(t=typeof _=="function"?_:Pi(+_),d):t},d.context=function(_){return arguments.length?(a=_??null,d):a},d}function O0(){}function M0(e,t,a){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+a)/6)}function vV(e){this._context=e}vV.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:M0(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:M0(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function fee(e){return new vV(e)}function xV(e){this._context=e}xV.prototype={areaStart:O0,areaEnd:O0,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:M0(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function pee(e){return new xV(e)}function bV(e){this._context=e}bV.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var a=(this._x0+4*this._x1+e)/6,l=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(a,l):this._context.moveTo(a,l);break;case 3:this._point=4;default:M0(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function mee(e){return new bV(e)}function wV(e){this._context=e}wV.prototype={areaStart:O0,areaEnd:O0,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function gee(e){return new wV(e)}function oj(e){return e<0?-1:1}function aj(e,t,a){var l=e._x1-e._x0,d=t-e._x1,_=(e._y1-e._y0)/(l||d<0&&-0),v=(a-e._y1)/(d||l<0&&-0),i=(_*d+v*l)/(l+d);return(oj(_)+oj(v))*Math.min(Math.abs(_),Math.abs(v),.5*Math.abs(i))||0}function sj(e,t){var a=e._x1-e._x0;return a?(3*(e._y1-e._y0)/a-t)/2:t}function oA(e,t,a){var l=e._x0,d=e._y0,_=e._x1,v=e._y1,i=(_-l)/3;e._context.bezierCurveTo(l+i,d+i*t,_-i,v-i*a,_,v)}function R0(e){this._context=e}R0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:oA(this,this._t0,sj(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var a=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,oA(this,sj(this,a=aj(this,e,t)),a);break;default:oA(this,this._t0,a=aj(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=a}}};function SV(e){this._context=new TV(e)}(SV.prototype=Object.create(R0.prototype)).point=function(e,t){R0.prototype.point.call(this,t,e)};function TV(e){this._context=e}TV.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,a,l,d,_){this._context.bezierCurveTo(t,e,l,a,_,d)}};function _ee(e){return new R0(e)}function yee(e){return new SV(e)}function AV(e){this._context=e}AV.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,a=e.length;if(a)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),a===2)this._context.lineTo(e[1],t[1]);else for(var l=lj(e),d=lj(t),_=0,v=1;v<a;++_,++v)this._context.bezierCurveTo(l[0][_],d[0][_],l[1][_],d[1][_],e[v],t[v]);(this._line||this._line!==0&&a===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function lj(e){var t,a=e.length-1,l,d=new Array(a),_=new Array(a),v=new Array(a);for(d[0]=0,_[0]=2,v[0]=e[0]+2*e[1],t=1;t<a-1;++t)d[t]=1,_[t]=4,v[t]=4*e[t]+2*e[t+1];for(d[a-1]=2,_[a-1]=7,v[a-1]=8*e[a-1]+e[a],t=1;t<a;++t)l=d[t]/_[t-1],_[t]-=l,v[t]-=l*v[t-1];for(d[a-1]=v[a-1]/_[a-1],t=a-2;t>=0;--t)d[t]=(v[t]-d[t+1])/_[t];for(_[a-1]=(e[a]+d[a-1])/2,t=0;t<a-1;++t)_[t]=2*e[t+1]-d[t+1];return[d,_]}function vee(e){return new AV(e)}function Kb(e,t){this._context=e,this._t=t}Kb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var a=this._x*(1-this._t)+e*this._t;this._context.lineTo(a,this._y),this._context.lineTo(a,t)}break}}this._x=e,this._y=t}};function xee(e){return new Kb(e,.5)}function bee(e){return new Kb(e,0)}function wee(e){return new Kb(e,1)}function Ap(e,t){if((v=e.length)>1)for(var a=1,l,d,_=e[t[0]],v,i=_.length;a<v;++a)for(d=_,_=e[t[a]],l=0;l<i;++l)_[l][1]+=_[l][0]=isNaN(d[l][1])?d[l][0]:d[l][1]}function RP(e){for(var t=e.length,a=new Array(t);--t>=0;)a[t]=t;return a}function See(e,t){return e[t]}function Tee(e){const t=[];return t.key=e,t}function Aee(){var e=Pi([]),t=RP,a=Ap,l=See;function d(_){var v=Array.from(e.apply(this,arguments),Tee),i,P=v.length,I=-1,M;for(const R of _)for(i=0,++I;i<P;++i)(v[i][I]=[0,+l(R,v[i].key,I,_)]).data=R;for(i=0,M=zC(t(v));i<P;++i)v[M[i]].index=i;return a(v,M),v}return d.keys=function(_){return arguments.length?(e=typeof _=="function"?_:Pi(Array.from(_)),d):e},d.value=function(_){return arguments.length?(l=typeof _=="function"?_:Pi(+_),d):l},d.order=function(_){return arguments.length?(t=_==null?RP:typeof _=="function"?_:Pi(Array.from(_)),d):t},d.offset=function(_){return arguments.length?(a=_??Ap,d):a},d}function Eee(e,t){if((l=e.length)>0){for(var a,l,d=0,_=e[0].length,v;d<_;++d){for(v=a=0;a<l;++a)v+=e[a][d][1]||0;if(v)for(a=0;a<l;++a)e[a][d][1]/=v}Ap(e,t)}}function Pee(e,t){if((d=e.length)>0){for(var a=0,l=e[t[0]],d,_=l.length;a<_;++a){for(var v=0,i=0;v<d;++v)i+=e[v][a][1]||0;l[a][1]+=l[a][0]=-i/2}Ap(e,t)}}function Iee(e,t){if(!(!((v=e.length)>0)||!((_=(d=e[t[0]]).length)>0))){for(var a=0,l=1,d,_,v;l<_;++l){for(var i=0,P=0,I=0;i<v;++i){for(var M=e[t[i]],R=M[l][1]||0,F=M[l-1][1]||0,q=(R-F)/2,H=0;H<i;++H){var j=e[t[H]],$=j[l][1]||0,Y=j[l-1][1]||0;q+=$-Y}P+=R,I+=q*R}d[l-1][1]+=d[l-1][0]=a,P&&(a-=I/P)}d[l-1][1]+=d[l-1][0]=a,Ap(e,t)}}function G_(e){"@babel/helpers - typeof";return G_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G_(e)}var Cee=["type","size","sizeType"];function DP(){return DP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},DP.apply(this,arguments)}function cj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function uj(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?cj(Object(a),!0).forEach(function(l){Oee(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cj(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Oee(e,t,a){return t=Mee(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Mee(e){var t=Ree(e,"string");return G_(t)=="symbol"?t:t+""}function Ree(e,t){if(G_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(G_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Dee(e,t){if(e==null)return{};var a=kee(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function kee(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}var EV={symbolCircle:FC,symbolCross:tee,symbolDiamond:nee,symbolSquare:iee,symbolStar:lee,symbolTriangle:cee,symbolWye:hee},Nee=Math.PI/180,Lee=function(t){var a="symbol".concat(Wb(t));return EV[a]||FC},jee=function(t,a,l){if(a==="area")return t;switch(l){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var d=18*Nee;return 1.25*t*t*(Math.tan(d)-Math.tan(d*2)*Math.pow(Math.tan(d),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},zee=function(t,a){EV["symbol".concat(Wb(t))]=a},BC=function(t){var a=t.type,l=a===void 0?"circle":a,d=t.size,_=d===void 0?64:d,v=t.sizeType,i=v===void 0?"area":v,P=Dee(t,Cee),I=uj(uj({},P),{},{type:l,size:_,sizeType:i}),M=function(){var $=Lee(l),Y=dee().type($).size(jee(_,i,l));return Y()},R=I.className,F=I.cx,q=I.cy,H=Jr(I,!0);return F===+F&&q===+q&&_===+_?He.createElement("path",DP({},H,{className:Sn("recharts-symbols",R),transform:"translate(".concat(F,", ").concat(q,")"),d:M()})):null};BC.registerSymbol=zee;function Ep(e){"@babel/helpers - typeof";return Ep=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ep(e)}function kP(){return kP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},kP.apply(this,arguments)}function hj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Fee(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?hj(Object(a),!0).forEach(function(l){H_(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hj(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Bee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Uee(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,IV(l.key),l)}}function Vee(e,t,a){return t&&Uee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $ee(e,t,a){return t=D0(t),qee(e,PV()?Reflect.construct(t,a||[],D0(e).constructor):t.apply(e,a))}function qee(e,t){if(t&&(Ep(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gee(e)}function Gee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function PV(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(PV=function(){return!!e})()}function D0(e){return D0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},D0(e)}function Hee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NP(e,t)}function NP(e,t){return NP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},NP(e,t)}function H_(e,t,a){return t=IV(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function IV(e){var t=Wee(e,"string");return Ep(t)=="symbol"?t:t+""}function Wee(e,t){if(Ep(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Ep(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ls=32,UC=(function(e){function t(){return Bee(this,t),$ee(this,t,arguments)}return Hee(t,e),Vee(t,[{key:"renderIcon",value:function(l){var d=this.props.inactiveColor,_=ls/2,v=ls/6,i=ls/3,P=l.inactive?d:l.color;if(l.type==="plainline")return He.createElement("line",{strokeWidth:4,fill:"none",stroke:P,strokeDasharray:l.payload.strokeDasharray,x1:0,y1:_,x2:ls,y2:_,className:"recharts-legend-icon"});if(l.type==="line")return He.createElement("path",{strokeWidth:4,fill:"none",stroke:P,d:"M0,".concat(_,"h").concat(i,`
            A`).concat(v,",").concat(v,",0,1,1,").concat(2*i,",").concat(_,`
            H`).concat(ls,"M").concat(2*i,",").concat(_,`
            A`).concat(v,",").concat(v,",0,1,1,").concat(i,",").concat(_),className:"recharts-legend-icon"});if(l.type==="rect")return He.createElement("path",{stroke:"none",fill:P,d:"M0,".concat(ls/8,"h").concat(ls,"v").concat(ls*3/4,"h").concat(-ls,"z"),className:"recharts-legend-icon"});if(He.isValidElement(l.legendIcon)){var I=Fee({},l);return delete I.legendIcon,He.cloneElement(l.legendIcon,I)}return He.createElement(BC,{fill:P,cx:_,cy:_,size:ls,sizeType:"diameter",type:l.type})}},{key:"renderItems",value:function(){var l=this,d=this.props,_=d.payload,v=d.iconSize,i=d.layout,P=d.formatter,I=d.inactiveColor,M={x:0,y:0,width:ls,height:ls},R={display:i==="horizontal"?"inline-block":"block",marginRight:10},F={display:"inline-block",verticalAlign:"middle",marginRight:4};return _.map(function(q,H){var j=q.formatter||P,$=Sn(H_(H_({"recharts-legend-item":!0},"legend-item-".concat(H),!0),"inactive",q.inactive));if(q.type==="none")return null;var Y=pn(q.value)?null:q.value;Vs(!pn(q.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var K=q.inactive?I:q.color;return He.createElement("li",kP({className:$,style:R,key:"legend-item-".concat(H)},cd(l.props,q,H)),He.createElement(PP,{width:v,height:v,viewBox:M,style:F},l.renderIcon(q)),He.createElement("span",{className:"recharts-legend-item-text",style:{color:K}},j?j(Y,q,H):Y))})}},{key:"render",value:function(){var l=this.props,d=l.payload,_=l.layout,v=l.align;if(!d||!d.length)return null;var i={padding:0,margin:0,textAlign:_==="horizontal"?v:"left"};return He.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])})(ie.PureComponent);H_(UC,"displayName","Legend");H_(UC,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var aA,dj;function Zee(){if(dj)return aA;dj=1;var e=qb();function t(){this.__data__=new e,this.size=0}return aA=t,aA}var sA,fj;function Xee(){if(fj)return sA;fj=1;function e(t){var a=this.__data__,l=a.delete(t);return this.size=a.size,l}return sA=e,sA}var lA,pj;function Kee(){if(pj)return lA;pj=1;function e(t){return this.__data__.get(t)}return lA=e,lA}var cA,mj;function Yee(){if(mj)return cA;mj=1;function e(t){return this.__data__.has(t)}return cA=e,cA}var uA,gj;function Jee(){if(gj)return uA;gj=1;var e=qb(),t=MC(),a=RC(),l=200;function d(_,v){var i=this.__data__;if(i instanceof e){var P=i.__data__;if(!t||P.length<l-1)return P.push([_,v]),this.size=++i.size,this;i=this.__data__=new a(P)}return i.set(_,v),this.size=i.size,this}return uA=d,uA}var hA,_j;function CV(){if(_j)return hA;_j=1;var e=qb(),t=Zee(),a=Xee(),l=Kee(),d=Yee(),_=Jee();function v(i){var P=this.__data__=new e(i);this.size=P.size}return v.prototype.clear=t,v.prototype.delete=a,v.prototype.get=l,v.prototype.has=d,v.prototype.set=_,hA=v,hA}var dA,yj;function Qee(){if(yj)return dA;yj=1;var e="__lodash_hash_undefined__";function t(a){return this.__data__.set(a,e),this}return dA=t,dA}var fA,vj;function ete(){if(vj)return fA;vj=1;function e(t){return this.__data__.has(t)}return fA=e,fA}var pA,xj;function OV(){if(xj)return pA;xj=1;var e=RC(),t=Qee(),a=ete();function l(d){var _=-1,v=d==null?0:d.length;for(this.__data__=new e;++_<v;)this.add(d[_])}return l.prototype.add=l.prototype.push=t,l.prototype.has=a,pA=l,pA}var mA,bj;function MV(){if(bj)return mA;bj=1;function e(t,a){for(var l=-1,d=t==null?0:t.length;++l<d;)if(a(t[l],l,t))return!0;return!1}return mA=e,mA}var gA,wj;function RV(){if(wj)return gA;wj=1;function e(t,a){return t.has(a)}return gA=e,gA}var _A,Sj;function DV(){if(Sj)return _A;Sj=1;var e=OV(),t=MV(),a=RV(),l=1,d=2;function _(v,i,P,I,M,R){var F=P&l,q=v.length,H=i.length;if(q!=H&&!(F&&H>q))return!1;var j=R.get(v),$=R.get(i);if(j&&$)return j==i&&$==v;var Y=-1,K=!0,re=P&d?new e:void 0;for(R.set(v,i),R.set(i,v);++Y<q;){var se=v[Y],J=i[Y];if(I)var ae=F?I(J,se,Y,i,v,R):I(se,J,Y,v,i,R);if(ae!==void 0){if(ae)continue;K=!1;break}if(re){if(!t(i,function(de,Pe){if(!a(re,Pe)&&(se===de||M(se,de,P,I,R)))return re.push(Pe)})){K=!1;break}}else if(!(se===J||M(se,J,P,I,R))){K=!1;break}}return R.delete(v),R.delete(i),K}return _A=_,_A}var yA,Tj;function tte(){if(Tj)return yA;Tj=1;var e=Nl(),t=e.Uint8Array;return yA=t,yA}var vA,Aj;function rte(){if(Aj)return vA;Aj=1;function e(t){var a=-1,l=Array(t.size);return t.forEach(function(d,_){l[++a]=[_,d]}),l}return vA=e,vA}var xA,Ej;function VC(){if(Ej)return xA;Ej=1;function e(t){var a=-1,l=Array(t.size);return t.forEach(function(d){l[++a]=d}),l}return xA=e,xA}var bA,Pj;function nte(){if(Pj)return bA;Pj=1;var e=Dy(),t=tte(),a=OC(),l=DV(),d=rte(),_=VC(),v=1,i=2,P="[object Boolean]",I="[object Date]",M="[object Error]",R="[object Map]",F="[object Number]",q="[object RegExp]",H="[object Set]",j="[object String]",$="[object Symbol]",Y="[object ArrayBuffer]",K="[object DataView]",re=e?e.prototype:void 0,se=re?re.valueOf:void 0;function J(ae,de,Pe,Ne,rt,ke,Ze){switch(Pe){case K:if(ae.byteLength!=de.byteLength||ae.byteOffset!=de.byteOffset)return!1;ae=ae.buffer,de=de.buffer;case Y:return!(ae.byteLength!=de.byteLength||!ke(new t(ae),new t(de)));case P:case I:case F:return a(+ae,+de);case M:return ae.name==de.name&&ae.message==de.message;case q:case j:return ae==de+"";case R:var nt=d;case H:var Je=Ne&v;if(nt||(nt=_),ae.size!=de.size&&!Je)return!1;var ot=Ze.get(ae);if(ot)return ot==de;Ne|=i,Ze.set(ae,de);var it=l(nt(ae),nt(de),Ne,rt,ke,Ze);return Ze.delete(ae),it;case $:if(se)return se.call(ae)==se.call(de)}return!1}return bA=J,bA}var wA,Ij;function kV(){if(Ij)return wA;Ij=1;function e(t,a){for(var l=-1,d=a.length,_=t.length;++l<d;)t[_+l]=a[l];return t}return wA=e,wA}var SA,Cj;function ite(){if(Cj)return SA;Cj=1;var e=kV(),t=_a();function a(l,d,_){var v=d(l);return t(l)?v:e(v,_(l))}return SA=a,SA}var TA,Oj;function ote(){if(Oj)return TA;Oj=1;function e(t,a){for(var l=-1,d=t==null?0:t.length,_=0,v=[];++l<d;){var i=t[l];a(i,l,t)&&(v[_++]=i)}return v}return TA=e,TA}var AA,Mj;function ate(){if(Mj)return AA;Mj=1;function e(){return[]}return AA=e,AA}var EA,Rj;function ste(){if(Rj)return EA;Rj=1;var e=ote(),t=ate(),a=Object.prototype,l=a.propertyIsEnumerable,d=Object.getOwnPropertySymbols,_=d?function(v){return v==null?[]:(v=Object(v),e(d(v),function(i){return l.call(v,i)}))}:t;return EA=_,EA}var PA,Dj;function lte(){if(Dj)return PA;Dj=1;function e(t,a){for(var l=-1,d=Array(t);++l<t;)d[l]=a(l);return d}return PA=e,PA}var IA,kj;function cte(){if(kj)return IA;kj=1;var e=Dc(),t=kc(),a="[object Arguments]";function l(d){return t(d)&&e(d)==a}return IA=l,IA}var CA,Nj;function $C(){if(Nj)return CA;Nj=1;var e=cte(),t=kc(),a=Object.prototype,l=a.hasOwnProperty,d=a.propertyIsEnumerable,_=e((function(){return arguments})())?e:function(v){return t(v)&&l.call(v,"callee")&&!d.call(v,"callee")};return CA=_,CA}var S_={exports:{}},OA,Lj;function ute(){if(Lj)return OA;Lj=1;function e(){return!1}return OA=e,OA}S_.exports;var jj;function NV(){return jj||(jj=1,(function(e,t){var a=Nl(),l=ute(),d=t&&!t.nodeType&&t,_=d&&!0&&e&&!e.nodeType&&e,v=_&&_.exports===d,i=v?a.Buffer:void 0,P=i?i.isBuffer:void 0,I=P||l;e.exports=I})(S_,S_.exports)),S_.exports}var MA,zj;function qC(){if(zj)return MA;zj=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function a(l,d){var _=typeof l;return d=d??e,!!d&&(_=="number"||_!="symbol"&&t.test(l))&&l>-1&&l%1==0&&l<d}return MA=a,MA}var RA,Fj;function GC(){if(Fj)return RA;Fj=1;var e=9007199254740991;function t(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=e}return RA=t,RA}var DA,Bj;function hte(){if(Bj)return DA;Bj=1;var e=Dc(),t=GC(),a=kc(),l="[object Arguments]",d="[object Array]",_="[object Boolean]",v="[object Date]",i="[object Error]",P="[object Function]",I="[object Map]",M="[object Number]",R="[object Object]",F="[object RegExp]",q="[object Set]",H="[object String]",j="[object WeakMap]",$="[object ArrayBuffer]",Y="[object DataView]",K="[object Float32Array]",re="[object Float64Array]",se="[object Int8Array]",J="[object Int16Array]",ae="[object Int32Array]",de="[object Uint8Array]",Pe="[object Uint8ClampedArray]",Ne="[object Uint16Array]",rt="[object Uint32Array]",ke={};ke[K]=ke[re]=ke[se]=ke[J]=ke[ae]=ke[de]=ke[Pe]=ke[Ne]=ke[rt]=!0,ke[l]=ke[d]=ke[$]=ke[_]=ke[Y]=ke[v]=ke[i]=ke[P]=ke[I]=ke[M]=ke[R]=ke[F]=ke[q]=ke[H]=ke[j]=!1;function Ze(nt){return a(nt)&&t(nt.length)&&!!ke[e(nt)]}return DA=Ze,DA}var kA,Uj;function LV(){if(Uj)return kA;Uj=1;function e(t){return function(a){return t(a)}}return kA=e,kA}var T_={exports:{}};T_.exports;var Vj;function dte(){return Vj||(Vj=1,(function(e,t){var a=rV(),l=t&&!t.nodeType&&t,d=l&&!0&&e&&!e.nodeType&&e,_=d&&d.exports===l,v=_&&a.process,i=(function(){try{var P=d&&d.require&&d.require("util").types;return P||v&&v.binding&&v.binding("util")}catch{}})();e.exports=i})(T_,T_.exports)),T_.exports}var NA,$j;function jV(){if($j)return NA;$j=1;var e=hte(),t=LV(),a=dte(),l=a&&a.isTypedArray,d=l?t(l):e;return NA=d,NA}var LA,qj;function fte(){if(qj)return LA;qj=1;var e=lte(),t=$C(),a=_a(),l=NV(),d=qC(),_=jV(),v=Object.prototype,i=v.hasOwnProperty;function P(I,M){var R=a(I),F=!R&&t(I),q=!R&&!F&&l(I),H=!R&&!F&&!q&&_(I),j=R||F||q||H,$=j?e(I.length,String):[],Y=$.length;for(var K in I)(M||i.call(I,K))&&!(j&&(K=="length"||q&&(K=="offset"||K=="parent")||H&&(K=="buffer"||K=="byteLength"||K=="byteOffset")||d(K,Y)))&&$.push(K);return $}return LA=P,LA}var jA,Gj;function pte(){if(Gj)return jA;Gj=1;var e=Object.prototype;function t(a){var l=a&&a.constructor,d=typeof l=="function"&&l.prototype||e;return a===d}return jA=t,jA}var zA,Hj;function zV(){if(Hj)return zA;Hj=1;function e(t,a){return function(l){return t(a(l))}}return zA=e,zA}var FA,Wj;function mte(){if(Wj)return FA;Wj=1;var e=zV(),t=e(Object.keys,Object);return FA=t,FA}var BA,Zj;function gte(){if(Zj)return BA;Zj=1;var e=pte(),t=mte(),a=Object.prototype,l=a.hasOwnProperty;function d(_){if(!e(_))return t(_);var v=[];for(var i in Object(_))l.call(_,i)&&i!="constructor"&&v.push(i);return v}return BA=d,BA}var UA,Xj;function Ny(){if(Xj)return UA;Xj=1;var e=CC(),t=GC();function a(l){return l!=null&&t(l.length)&&!e(l)}return UA=a,UA}var VA,Kj;function Yb(){if(Kj)return VA;Kj=1;var e=fte(),t=gte(),a=Ny();function l(d){return a(d)?e(d):t(d)}return VA=l,VA}var $A,Yj;function _te(){if(Yj)return $A;Yj=1;var e=ite(),t=ste(),a=Yb();function l(d){return e(d,a,t)}return $A=l,$A}var qA,Jj;function yte(){if(Jj)return qA;Jj=1;var e=_te(),t=1,a=Object.prototype,l=a.hasOwnProperty;function d(_,v,i,P,I,M){var R=i&t,F=e(_),q=F.length,H=e(v),j=H.length;if(q!=j&&!R)return!1;for(var $=q;$--;){var Y=F[$];if(!(R?Y in v:l.call(v,Y)))return!1}var K=M.get(_),re=M.get(v);if(K&&re)return K==v&&re==_;var se=!0;M.set(_,v),M.set(v,_);for(var J=R;++$<q;){Y=F[$];var ae=_[Y],de=v[Y];if(P)var Pe=R?P(de,ae,Y,v,_,M):P(ae,de,Y,_,v,M);if(!(Pe===void 0?ae===de||I(ae,de,i,P,M):Pe)){se=!1;break}J||(J=Y=="constructor")}if(se&&!J){var Ne=_.constructor,rt=v.constructor;Ne!=rt&&"constructor"in _&&"constructor"in v&&!(typeof Ne=="function"&&Ne instanceof Ne&&typeof rt=="function"&&rt instanceof rt)&&(se=!1)}return M.delete(_),M.delete(v),se}return qA=d,qA}var GA,Qj;function vte(){if(Qj)return GA;Qj=1;var e=_d(),t=Nl(),a=e(t,"DataView");return GA=a,GA}var HA,ez;function xte(){if(ez)return HA;ez=1;var e=_d(),t=Nl(),a=e(t,"Promise");return HA=a,HA}var WA,tz;function FV(){if(tz)return WA;tz=1;var e=_d(),t=Nl(),a=e(t,"Set");return WA=a,WA}var ZA,rz;function bte(){if(rz)return ZA;rz=1;var e=_d(),t=Nl(),a=e(t,"WeakMap");return ZA=a,ZA}var XA,nz;function wte(){if(nz)return XA;nz=1;var e=vte(),t=MC(),a=xte(),l=FV(),d=bte(),_=Dc(),v=nV(),i="[object Map]",P="[object Object]",I="[object Promise]",M="[object Set]",R="[object WeakMap]",F="[object DataView]",q=v(e),H=v(t),j=v(a),$=v(l),Y=v(d),K=_;return(e&&K(new e(new ArrayBuffer(1)))!=F||t&&K(new t)!=i||a&&K(a.resolve())!=I||l&&K(new l)!=M||d&&K(new d)!=R)&&(K=function(re){var se=_(re),J=se==P?re.constructor:void 0,ae=J?v(J):"";if(ae)switch(ae){case q:return F;case H:return i;case j:return I;case $:return M;case Y:return R}return se}),XA=K,XA}var KA,iz;function Ste(){if(iz)return KA;iz=1;var e=CV(),t=DV(),a=nte(),l=yte(),d=wte(),_=_a(),v=NV(),i=jV(),P=1,I="[object Arguments]",M="[object Array]",R="[object Object]",F=Object.prototype,q=F.hasOwnProperty;function H(j,$,Y,K,re,se){var J=_(j),ae=_($),de=J?M:d(j),Pe=ae?M:d($);de=de==I?R:de,Pe=Pe==I?R:Pe;var Ne=de==R,rt=Pe==R,ke=de==Pe;if(ke&&v(j)){if(!v($))return!1;J=!0,Ne=!1}if(ke&&!Ne)return se||(se=new e),J||i(j)?t(j,$,Y,K,re,se):a(j,$,de,Y,K,re,se);if(!(Y&P)){var Ze=Ne&&q.call(j,"__wrapped__"),nt=rt&&q.call($,"__wrapped__");if(Ze||nt){var Je=Ze?j.value():j,ot=nt?$.value():$;return se||(se=new e),re(Je,ot,Y,K,se)}}return ke?(se||(se=new e),l(j,$,Y,K,re,se)):!1}return KA=H,KA}var YA,oz;function HC(){if(oz)return YA;oz=1;var e=Ste(),t=kc();function a(l,d,_,v,i){return l===d?!0:l==null||d==null||!t(l)&&!t(d)?l!==l&&d!==d:e(l,d,_,v,a,i)}return YA=a,YA}var JA,az;function Tte(){if(az)return JA;az=1;var e=CV(),t=HC(),a=1,l=2;function d(_,v,i,P){var I=i.length,M=I,R=!P;if(_==null)return!M;for(_=Object(_);I--;){var F=i[I];if(R&&F[2]?F[1]!==_[F[0]]:!(F[0]in _))return!1}for(;++I<M;){F=i[I];var q=F[0],H=_[q],j=F[1];if(R&&F[2]){if(H===void 0&&!(q in _))return!1}else{var $=new e;if(P)var Y=P(H,j,q,_,v,$);if(!(Y===void 0?t(j,H,a|l,P,$):Y))return!1}}return!0}return JA=d,JA}var QA,sz;function BV(){if(sz)return QA;sz=1;var e=Vu();function t(a){return a===a&&!e(a)}return QA=t,QA}var eE,lz;function Ate(){if(lz)return eE;lz=1;var e=BV(),t=Yb();function a(l){for(var d=t(l),_=d.length;_--;){var v=d[_],i=l[v];d[_]=[v,i,e(i)]}return d}return eE=a,eE}var tE,cz;function UV(){if(cz)return tE;cz=1;function e(t,a){return function(l){return l==null?!1:l[t]===a&&(a!==void 0||t in Object(l))}}return tE=e,tE}var rE,uz;function Ete(){if(uz)return rE;uz=1;var e=Tte(),t=Ate(),a=UV();function l(d){var _=t(d);return _.length==1&&_[0][2]?a(_[0][0],_[0][1]):function(v){return v===d||e(v,d,_)}}return rE=l,rE}var nE,hz;function Pte(){if(hz)return nE;hz=1;function e(t,a){return t!=null&&a in Object(t)}return nE=e,nE}var iE,dz;function Ite(){if(dz)return iE;dz=1;var e=aV(),t=$C(),a=_a(),l=qC(),d=GC(),_=Hb();function v(i,P,I){P=e(P,i);for(var M=-1,R=P.length,F=!1;++M<R;){var q=_(P[M]);if(!(F=i!=null&&I(i,q)))break;i=i[q]}return F||++M!=R?F:(R=i==null?0:i.length,!!R&&d(R)&&l(q,R)&&(a(i)||t(i)))}return iE=v,iE}var oE,fz;function Cte(){if(fz)return oE;fz=1;var e=Pte(),t=Ite();function a(l,d){return l!=null&&t(l,d,e)}return oE=a,oE}var aE,pz;function Ote(){if(pz)return aE;pz=1;var e=HC(),t=sV(),a=Cte(),l=IC(),d=BV(),_=UV(),v=Hb(),i=1,P=2;function I(M,R){return l(M)&&d(R)?_(v(M),R):function(F){var q=t(F,M);return q===void 0&&q===R?a(F,M):e(R,q,i|P)}}return aE=I,aE}var sE,mz;function lm(){if(mz)return sE;mz=1;function e(t){return t}return sE=e,sE}var lE,gz;function Mte(){if(gz)return lE;gz=1;function e(t){return function(a){return a?.[t]}}return lE=e,lE}var cE,_z;function Rte(){if(_z)return cE;_z=1;var e=kC();function t(a){return function(l){return e(l,a)}}return cE=t,cE}var uE,yz;function Dte(){if(yz)return uE;yz=1;var e=Mte(),t=Rte(),a=IC(),l=Hb();function d(_){return a(_)?e(l(_)):t(_)}return uE=d,uE}var hE,vz;function Ll(){if(vz)return hE;vz=1;var e=Ete(),t=Ote(),a=lm(),l=_a(),d=Dte();function _(v){return typeof v=="function"?v:v==null?a:typeof v=="object"?l(v)?t(v[0],v[1]):e(v):d(v)}return hE=_,hE}var dE,xz;function VV(){if(xz)return dE;xz=1;function e(t,a,l,d){for(var _=t.length,v=l+(d?1:-1);d?v--:++v<_;)if(a(t[v],v,t))return v;return-1}return dE=e,dE}var fE,bz;function kte(){if(bz)return fE;bz=1;function e(t){return t!==t}return fE=e,fE}var pE,wz;function Nte(){if(wz)return pE;wz=1;function e(t,a,l){for(var d=l-1,_=t.length;++d<_;)if(t[d]===a)return d;return-1}return pE=e,pE}var mE,Sz;function Lte(){if(Sz)return mE;Sz=1;var e=VV(),t=kte(),a=Nte();function l(d,_,v){return _===_?a(d,_,v):e(d,t,v)}return mE=l,mE}var gE,Tz;function jte(){if(Tz)return gE;Tz=1;var e=Lte();function t(a,l){var d=a==null?0:a.length;return!!d&&e(a,l,0)>-1}return gE=t,gE}var _E,Az;function zte(){if(Az)return _E;Az=1;function e(t,a,l){for(var d=-1,_=t==null?0:t.length;++d<_;)if(l(a,t[d]))return!0;return!1}return _E=e,_E}var yE,Ez;function Fte(){if(Ez)return yE;Ez=1;function e(){}return yE=e,yE}var vE,Pz;function Bte(){if(Pz)return vE;Pz=1;var e=FV(),t=Fte(),a=VC(),l=1/0,d=e&&1/a(new e([,-0]))[1]==l?function(_){return new e(_)}:t;return vE=d,vE}var xE,Iz;function Ute(){if(Iz)return xE;Iz=1;var e=OV(),t=jte(),a=zte(),l=RV(),d=Bte(),_=VC(),v=200;function i(P,I,M){var R=-1,F=t,q=P.length,H=!0,j=[],$=j;if(M)H=!1,F=a;else if(q>=v){var Y=I?null:d(P);if(Y)return _(Y);H=!1,F=l,$=new e}else $=I?[]:j;e:for(;++R<q;){var K=P[R],re=I?I(K):K;if(K=M||K!==0?K:0,H&&re===re){for(var se=$.length;se--;)if($[se]===re)continue e;I&&$.push(re),j.push(K)}else F($,re,M)||($!==j&&$.push(re),j.push(K))}return j}return xE=i,xE}var bE,Cz;function Vte(){if(Cz)return bE;Cz=1;var e=Ll(),t=Ute();function a(l,d){return l&&l.length?t(l,e(d,2)):[]}return bE=a,bE}var $te=Vte();const Oz=si($te);function $V(e,t,a){return t===!0?Oz(e,a):pn(t)?Oz(e,t):e}function Pp(e){"@babel/helpers - typeof";return Pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pp(e)}var qte=["ref"];function Mz(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function pc(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?Mz(Object(a),!0).forEach(function(l){Jb(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mz(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Gte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rz(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,GV(l.key),l)}}function Hte(e,t,a){return t&&Rz(e.prototype,t),a&&Rz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wte(e,t,a){return t=k0(t),Zte(e,qV()?Reflect.construct(t,a||[],k0(e).constructor):t.apply(e,a))}function Zte(e,t){if(t&&(Pp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xte(e)}function Xte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qV(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qV=function(){return!!e})()}function k0(e){return k0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},k0(e)}function Kte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LP(e,t)}function LP(e,t){return LP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},LP(e,t)}function Jb(e,t,a){return t=GV(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function GV(e){var t=Yte(e,"string");return Pp(t)=="symbol"?t:t+""}function Yte(e,t){if(Pp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Pp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Jte(e,t){if(e==null)return{};var a=Qte(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function Qte(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function ere(e){return e.value}function tre(e,t){if(He.isValidElement(e))return He.cloneElement(e,t);if(typeof e=="function")return He.createElement(e,t);t.ref;var a=Jte(t,qte);return He.createElement(UC,a)}var Dz=1,Sc=(function(e){function t(){var a;Gte(this,t);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return a=Wte(this,t,[].concat(d)),Jb(a,"lastBoundingBox",{width:-1,height:-1}),a}return Kte(t,e),Hte(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var l=this.wrapperNode.getBoundingClientRect();return l.height=this.wrapperNode.offsetHeight,l.width=this.wrapperNode.offsetWidth,l}return null}},{key:"updateBBox",value:function(){var l=this.props.onBBoxUpdate,d=this.getBBox();d?(Math.abs(d.width-this.lastBoundingBox.width)>Dz||Math.abs(d.height-this.lastBoundingBox.height)>Dz)&&(this.lastBoundingBox.width=d.width,this.lastBoundingBox.height=d.height,l&&l(d)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,l&&l(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?pc({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(l){var d=this.props,_=d.layout,v=d.align,i=d.verticalAlign,P=d.margin,I=d.chartWidth,M=d.chartHeight,R,F;if(!l||(l.left===void 0||l.left===null)&&(l.right===void 0||l.right===null))if(v==="center"&&_==="vertical"){var q=this.getBBoxSnapshot();R={left:((I||0)-q.width)/2}}else R=v==="right"?{right:P&&P.right||0}:{left:P&&P.left||0};if(!l||(l.top===void 0||l.top===null)&&(l.bottom===void 0||l.bottom===null))if(i==="middle"){var H=this.getBBoxSnapshot();F={top:((M||0)-H.height)/2}}else F=i==="bottom"?{bottom:P&&P.bottom||0}:{top:P&&P.top||0};return pc(pc({},R),F)}},{key:"render",value:function(){var l=this,d=this.props,_=d.content,v=d.width,i=d.height,P=d.wrapperStyle,I=d.payloadUniqBy,M=d.payload,R=pc(pc({position:"absolute",width:v||"auto",height:i||"auto"},this.getDefaultPosition(P)),P);return He.createElement("div",{className:"recharts-legend-wrapper",style:R,ref:function(q){l.wrapperNode=q}},tre(_,pc(pc({},this.props),{},{payload:$V(M,I,ere)})))}}],[{key:"getWithHeight",value:function(l,d){var _=pc(pc({},this.defaultProps),l.props),v=_.layout;return v==="vertical"&&fr(l.props.height)?{height:l.props.height}:v==="horizontal"?{width:l.props.width||d}:null}}])})(ie.PureComponent);Jb(Sc,"displayName","Legend");Jb(Sc,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var wE,kz;function rre(){if(kz)return wE;kz=1;var e=Dy(),t=$C(),a=_a(),l=e?e.isConcatSpreadable:void 0;function d(_){return a(_)||t(_)||!!(l&&_&&_[l])}return wE=d,wE}var SE,Nz;function HV(){if(Nz)return SE;Nz=1;var e=kV(),t=rre();function a(l,d,_,v,i){var P=-1,I=l.length;for(_||(_=t),i||(i=[]);++P<I;){var M=l[P];d>0&&_(M)?d>1?a(M,d-1,_,v,i):e(i,M):v||(i[i.length]=M)}return i}return SE=a,SE}var TE,Lz;function nre(){if(Lz)return TE;Lz=1;function e(t){return function(a,l,d){for(var _=-1,v=Object(a),i=d(a),P=i.length;P--;){var I=i[t?P:++_];if(l(v[I],I,v)===!1)break}return a}}return TE=e,TE}var AE,jz;function ire(){if(jz)return AE;jz=1;var e=nre(),t=e();return AE=t,AE}var EE,zz;function WV(){if(zz)return EE;zz=1;var e=ire(),t=Yb();function a(l,d){return l&&e(l,d,t)}return EE=a,EE}var PE,Fz;function ore(){if(Fz)return PE;Fz=1;var e=Ny();function t(a,l){return function(d,_){if(d==null)return d;if(!e(d))return a(d,_);for(var v=d.length,i=l?v:-1,P=Object(d);(l?i--:++i<v)&&_(P[i],i,P)!==!1;);return d}}return PE=t,PE}var IE,Bz;function WC(){if(Bz)return IE;Bz=1;var e=WV(),t=ore(),a=t(e);return IE=a,IE}var CE,Uz;function ZV(){if(Uz)return CE;Uz=1;var e=WC(),t=Ny();function a(l,d){var _=-1,v=t(l)?Array(l.length):[];return e(l,function(i,P,I){v[++_]=d(i,P,I)}),v}return CE=a,CE}var OE,Vz;function are(){if(Vz)return OE;Vz=1;function e(t,a){var l=t.length;for(t.sort(a);l--;)t[l]=t[l].value;return t}return OE=e,OE}var ME,$z;function sre(){if($z)return ME;$z=1;var e=om();function t(a,l){if(a!==l){var d=a!==void 0,_=a===null,v=a===a,i=e(a),P=l!==void 0,I=l===null,M=l===l,R=e(l);if(!I&&!R&&!i&&a>l||i&&P&&M&&!I&&!R||_&&P&&M||!d&&M||!v)return 1;if(!_&&!i&&!R&&a<l||R&&d&&v&&!_&&!i||I&&d&&v||!P&&v||!M)return-1}return 0}return ME=t,ME}var RE,qz;function lre(){if(qz)return RE;qz=1;var e=sre();function t(a,l,d){for(var _=-1,v=a.criteria,i=l.criteria,P=v.length,I=d.length;++_<P;){var M=e(v[_],i[_]);if(M){if(_>=I)return M;var R=d[_];return M*(R=="desc"?-1:1)}}return a.index-l.index}return RE=t,RE}var DE,Gz;function cre(){if(Gz)return DE;Gz=1;var e=DC(),t=kC(),a=Ll(),l=ZV(),d=are(),_=LV(),v=lre(),i=lm(),P=_a();function I(M,R,F){R.length?R=e(R,function(j){return P(j)?function($){return t($,j.length===1?j[0]:j)}:j}):R=[i];var q=-1;R=e(R,_(a));var H=l(M,function(j,$,Y){var K=e(R,function(re){return re(j)});return{criteria:K,index:++q,value:j}});return d(H,function(j,$){return v(j,$,F)})}return DE=I,DE}var kE,Hz;function ure(){if(Hz)return kE;Hz=1;function e(t,a,l){switch(l.length){case 0:return t.call(a);case 1:return t.call(a,l[0]);case 2:return t.call(a,l[0],l[1]);case 3:return t.call(a,l[0],l[1],l[2])}return t.apply(a,l)}return kE=e,kE}var NE,Wz;function hre(){if(Wz)return NE;Wz=1;var e=ure(),t=Math.max;function a(l,d,_){return d=t(d===void 0?l.length-1:d,0),function(){for(var v=arguments,i=-1,P=t(v.length-d,0),I=Array(P);++i<P;)I[i]=v[d+i];i=-1;for(var M=Array(d+1);++i<d;)M[i]=v[i];return M[d]=_(I),e(l,this,M)}}return NE=a,NE}var LE,Zz;function dre(){if(Zz)return LE;Zz=1;function e(t){return function(){return t}}return LE=e,LE}var jE,Xz;function XV(){if(Xz)return jE;Xz=1;var e=_d(),t=(function(){try{var a=e(Object,"defineProperty");return a({},"",{}),a}catch{}})();return jE=t,jE}var zE,Kz;function fre(){if(Kz)return zE;Kz=1;var e=dre(),t=XV(),a=lm(),l=t?function(d,_){return t(d,"toString",{configurable:!0,enumerable:!1,value:e(_),writable:!0})}:a;return zE=l,zE}var FE,Yz;function pre(){if(Yz)return FE;Yz=1;var e=800,t=16,a=Date.now;function l(d){var _=0,v=0;return function(){var i=a(),P=t-(i-v);if(v=i,P>0){if(++_>=e)return arguments[0]}else _=0;return d.apply(void 0,arguments)}}return FE=l,FE}var BE,Jz;function mre(){if(Jz)return BE;Jz=1;var e=fre(),t=pre(),a=t(e);return BE=a,BE}var UE,Qz;function gre(){if(Qz)return UE;Qz=1;var e=lm(),t=hre(),a=mre();function l(d,_){return a(t(d,_,e),d+"")}return UE=l,UE}var VE,e3;function Qb(){if(e3)return VE;e3=1;var e=OC(),t=Ny(),a=qC(),l=Vu();function d(_,v,i){if(!l(i))return!1;var P=typeof v;return(P=="number"?t(i)&&a(v,i.length):P=="string"&&v in i)?e(i[v],_):!1}return VE=d,VE}var $E,t3;function _re(){if(t3)return $E;t3=1;var e=HV(),t=cre(),a=gre(),l=Qb(),d=a(function(_,v){if(_==null)return[];var i=v.length;return i>1&&l(_,v[0],v[1])?v=[]:i>2&&l(v[0],v[1],v[2])&&(v=[v[0]]),t(_,e(v,1),[])});return $E=d,$E}var yre=_re();const ZC=si(yre);function W_(e){"@babel/helpers - typeof";return W_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W_(e)}function jP(){return jP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},jP.apply(this,arguments)}function vre(e,t){return Sre(e)||wre(e,t)||bre(e,t)||xre()}function xre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bre(e,t){if(e){if(typeof e=="string")return r3(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r3(e,t)}}function r3(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function wre(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Sre(e){if(Array.isArray(e))return e}function n3(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function qE(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?n3(Object(a),!0).forEach(function(l){Tre(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n3(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Tre(e,t,a){return t=Are(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Are(e){var t=Ere(e,"string");return W_(t)=="symbol"?t:t+""}function Ere(e,t){if(W_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(W_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Pre(e){return Array.isArray(e)&&go(e[0])&&go(e[1])?e.join(" ~ "):e}var Ire=function(t){var a=t.separator,l=a===void 0?" : ":a,d=t.contentStyle,_=d===void 0?{}:d,v=t.itemStyle,i=v===void 0?{}:v,P=t.labelStyle,I=P===void 0?{}:P,M=t.payload,R=t.formatter,F=t.itemSorter,q=t.wrapperClassName,H=t.labelClassName,j=t.label,$=t.labelFormatter,Y=t.accessibilityLayer,K=Y===void 0?!1:Y,re=function(){if(M&&M.length){var Ze={padding:0,margin:0},nt=(F?ZC(M,F):M).map(function(Je,ot){if(Je.type==="none")return null;var it=qE({display:"block",paddingTop:4,paddingBottom:4,color:Je.color||"#000"},i),Pt=Je.formatter||R||Pre,Ot=Je.value,yt=Je.name,ar=Ot,qt=yt;if(Pt&&ar!=null&&qt!=null){var rr=Pt(Ot,yt,Je,ot,M);if(Array.isArray(rr)){var Tr=vre(rr,2);ar=Tr[0],qt=Tr[1]}else ar=rr}return He.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(ot),style:it},go(qt)?He.createElement("span",{className:"recharts-tooltip-item-name"},qt):null,go(qt)?He.createElement("span",{className:"recharts-tooltip-item-separator"},l):null,He.createElement("span",{className:"recharts-tooltip-item-value"},ar),He.createElement("span",{className:"recharts-tooltip-item-unit"},Je.unit||""))});return He.createElement("ul",{className:"recharts-tooltip-item-list",style:Ze},nt)}return null},se=qE({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},_),J=qE({margin:0},I),ae=!xn(j),de=ae?j:"",Pe=Sn("recharts-default-tooltip",q),Ne=Sn("recharts-tooltip-label",H);ae&&$&&M!==void 0&&M!==null&&(de=$(j,M));var rt=K?{role:"status","aria-live":"assertive"}:{};return He.createElement("div",jP({className:Pe,style:se},rt),He.createElement("p",{className:Ne,style:J},He.isValidElement(de)?de:"".concat(de)),re())};function Z_(e){"@babel/helpers - typeof";return Z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z_(e)}function Wx(e,t,a){return t=Cre(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Cre(e){var t=Ore(e,"string");return Z_(t)=="symbol"?t:t+""}function Ore(e,t){if(Z_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Z_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var d_="recharts-tooltip-wrapper",Mre={visibility:"hidden"};function Rre(e){var t=e.coordinate,a=e.translateX,l=e.translateY;return Sn(d_,Wx(Wx(Wx(Wx({},"".concat(d_,"-right"),fr(a)&&t&&fr(t.x)&&a>=t.x),"".concat(d_,"-left"),fr(a)&&t&&fr(t.x)&&a<t.x),"".concat(d_,"-bottom"),fr(l)&&t&&fr(t.y)&&l>=t.y),"".concat(d_,"-top"),fr(l)&&t&&fr(t.y)&&l<t.y))}function i3(e){var t=e.allowEscapeViewBox,a=e.coordinate,l=e.key,d=e.offsetTopLeft,_=e.position,v=e.reverseDirection,i=e.tooltipDimension,P=e.viewBox,I=e.viewBoxDimension;if(_&&fr(_[l]))return _[l];var M=a[l]-i-d,R=a[l]+d;if(t[l])return v[l]?M:R;if(v[l]){var F=M,q=P[l];return F<q?Math.max(R,P[l]):Math.max(M,P[l])}var H=R+i,j=P[l]+I;return H>j?Math.max(M,P[l]):Math.max(R,P[l])}function Dre(e){var t=e.translateX,a=e.translateY,l=e.useTranslate3d;return{transform:l?"translate3d(".concat(t,"px, ").concat(a,"px, 0)"):"translate(".concat(t,"px, ").concat(a,"px)")}}function kre(e){var t=e.allowEscapeViewBox,a=e.coordinate,l=e.offsetTopLeft,d=e.position,_=e.reverseDirection,v=e.tooltipBox,i=e.useTranslate3d,P=e.viewBox,I,M,R;return v.height>0&&v.width>0&&a?(M=i3({allowEscapeViewBox:t,coordinate:a,key:"x",offsetTopLeft:l,position:d,reverseDirection:_,tooltipDimension:v.width,viewBox:P,viewBoxDimension:P.width}),R=i3({allowEscapeViewBox:t,coordinate:a,key:"y",offsetTopLeft:l,position:d,reverseDirection:_,tooltipDimension:v.height,viewBox:P,viewBoxDimension:P.height}),I=Dre({translateX:M,translateY:R,useTranslate3d:i})):I=Mre,{cssProperties:I,cssClasses:Rre({translateX:M,translateY:R,coordinate:a})}}function Ip(e){"@babel/helpers - typeof";return Ip=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ip(e)}function o3(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function a3(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?o3(Object(a),!0).forEach(function(l){FP(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o3(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Nre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lre(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,YV(l.key),l)}}function jre(e,t,a){return t&&Lre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function zre(e,t,a){return t=N0(t),Fre(e,KV()?Reflect.construct(t,a||[],N0(e).constructor):t.apply(e,a))}function Fre(e,t){if(t&&(Ip(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Bre(e)}function Bre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KV(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KV=function(){return!!e})()}function N0(e){return N0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},N0(e)}function Ure(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zP(e,t)}function zP(e,t){return zP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},zP(e,t)}function FP(e,t,a){return t=YV(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function YV(e){var t=Vre(e,"string");return Ip(t)=="symbol"?t:t+""}function Vre(e,t){if(Ip(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Ip(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var s3=1,$re=(function(e){function t(){var a;Nre(this,t);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return a=zre(this,t,[].concat(d)),FP(a,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),FP(a,"handleKeyDown",function(v){if(v.key==="Escape"){var i,P,I,M;a.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(P=a.props.coordinate)===null||P===void 0?void 0:P.x)!==null&&i!==void 0?i:0,y:(I=(M=a.props.coordinate)===null||M===void 0?void 0:M.y)!==null&&I!==void 0?I:0}})}}),a}return Ure(t,e),jre(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var l=this.wrapperNode.getBoundingClientRect();(Math.abs(l.width-this.state.lastBoundingBox.width)>s3||Math.abs(l.height-this.state.lastBoundingBox.height)>s3)&&this.setState({lastBoundingBox:{width:l.width,height:l.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var l,d;this.props.active&&this.updateBBox(),this.state.dismissed&&(((l=this.props.coordinate)===null||l===void 0?void 0:l.x)!==this.state.dismissedAtCoordinate.x||((d=this.props.coordinate)===null||d===void 0?void 0:d.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var l=this,d=this.props,_=d.active,v=d.allowEscapeViewBox,i=d.animationDuration,P=d.animationEasing,I=d.children,M=d.coordinate,R=d.hasPayload,F=d.isAnimationActive,q=d.offset,H=d.position,j=d.reverseDirection,$=d.useTranslate3d,Y=d.viewBox,K=d.wrapperStyle,re=kre({allowEscapeViewBox:v,coordinate:M,offsetTopLeft:q,position:H,reverseDirection:j,tooltipBox:this.state.lastBoundingBox,useTranslate3d:$,viewBox:Y}),se=re.cssClasses,J=re.cssProperties,ae=a3(a3({transition:F&&_?"transform ".concat(i,"ms ").concat(P):void 0},J),{},{pointerEvents:"none",visibility:!this.state.dismissed&&_&&R?"visible":"hidden",position:"absolute",top:0,left:0},K);return He.createElement("div",{tabIndex:-1,className:se,style:ae,ref:function(Pe){l.wrapperNode=Pe}},I)}}])})(ie.PureComponent),qre=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},yd={isSsr:qre()};function Cp(e){"@babel/helpers - typeof";return Cp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cp(e)}function l3(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function c3(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?l3(Object(a),!0).forEach(function(l){XC(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l3(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Gre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hre(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,QV(l.key),l)}}function Wre(e,t,a){return t&&Hre(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zre(e,t,a){return t=L0(t),Xre(e,JV()?Reflect.construct(t,a||[],L0(e).constructor):t.apply(e,a))}function Xre(e,t){if(t&&(Cp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kre(e)}function Kre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JV(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(JV=function(){return!!e})()}function L0(e){return L0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},L0(e)}function Yre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BP(e,t)}function BP(e,t){return BP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},BP(e,t)}function XC(e,t,a){return t=QV(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function QV(e){var t=Jre(e,"string");return Cp(t)=="symbol"?t:t+""}function Jre(e,t){if(Cp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Cp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Qre(e){return e.dataKey}function ene(e,t){return He.isValidElement(e)?He.cloneElement(e,t):typeof e=="function"?He.createElement(e,t):He.createElement(Ire,t)}var La=(function(e){function t(){return Gre(this,t),Zre(this,t,arguments)}return Yre(t,e),Wre(t,[{key:"render",value:function(){var l=this,d=this.props,_=d.active,v=d.allowEscapeViewBox,i=d.animationDuration,P=d.animationEasing,I=d.content,M=d.coordinate,R=d.filterNull,F=d.isAnimationActive,q=d.offset,H=d.payload,j=d.payloadUniqBy,$=d.position,Y=d.reverseDirection,K=d.useTranslate3d,re=d.viewBox,se=d.wrapperStyle,J=H??[];R&&J.length&&(J=$V(H.filter(function(de){return de.value!=null&&(de.hide!==!0||l.props.includeHidden)}),j,Qre));var ae=J.length>0;return He.createElement($re,{allowEscapeViewBox:v,animationDuration:i,animationEasing:P,isAnimationActive:F,active:_,coordinate:M,hasPayload:ae,offset:q,position:$,reverseDirection:Y,useTranslate3d:K,viewBox:re,wrapperStyle:se},ene(I,c3(c3({},this.props),{},{payload:J})))}}])})(ie.PureComponent);XC(La,"displayName","Tooltip");XC(La,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!yd.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var GE,u3;function tne(){if(u3)return GE;u3=1;var e=Nl(),t=function(){return e.Date.now()};return GE=t,GE}var HE,h3;function rne(){if(h3)return HE;h3=1;var e=/\s/;function t(a){for(var l=a.length;l--&&e.test(a.charAt(l)););return l}return HE=t,HE}var WE,d3;function nne(){if(d3)return WE;d3=1;var e=rne(),t=/^\s+/;function a(l){return l&&l.slice(0,e(l)+1).replace(t,"")}return WE=a,WE}var ZE,f3;function e$(){if(f3)return ZE;f3=1;var e=nne(),t=Vu(),a=om(),l=NaN,d=/^[-+]0x[0-9a-f]+$/i,_=/^0b[01]+$/i,v=/^0o[0-7]+$/i,i=parseInt;function P(I){if(typeof I=="number")return I;if(a(I))return l;if(t(I)){var M=typeof I.valueOf=="function"?I.valueOf():I;I=t(M)?M+"":M}if(typeof I!="string")return I===0?I:+I;I=e(I);var R=_.test(I);return R||v.test(I)?i(I.slice(2),R?2:8):d.test(I)?l:+I}return ZE=P,ZE}var XE,p3;function ine(){if(p3)return XE;p3=1;var e=Vu(),t=tne(),a=e$(),l="Expected a function",d=Math.max,_=Math.min;function v(i,P,I){var M,R,F,q,H,j,$=0,Y=!1,K=!1,re=!0;if(typeof i!="function")throw new TypeError(l);P=a(P)||0,e(I)&&(Y=!!I.leading,K="maxWait"in I,F=K?d(a(I.maxWait)||0,P):F,re="trailing"in I?!!I.trailing:re);function se(nt){var Je=M,ot=R;return M=R=void 0,$=nt,q=i.apply(ot,Je),q}function J(nt){return $=nt,H=setTimeout(Pe,P),Y?se(nt):q}function ae(nt){var Je=nt-j,ot=nt-$,it=P-Je;return K?_(it,F-ot):it}function de(nt){var Je=nt-j,ot=nt-$;return j===void 0||Je>=P||Je<0||K&&ot>=F}function Pe(){var nt=t();if(de(nt))return Ne(nt);H=setTimeout(Pe,ae(nt))}function Ne(nt){return H=void 0,re&&M?se(nt):(M=R=void 0,q)}function rt(){H!==void 0&&clearTimeout(H),$=0,M=j=R=H=void 0}function ke(){return H===void 0?q:Ne(t())}function Ze(){var nt=t(),Je=de(nt);if(M=arguments,R=this,j=nt,Je){if(H===void 0)return J(j);if(K)return clearTimeout(H),H=setTimeout(Pe,P),se(j)}return H===void 0&&(H=setTimeout(Pe,P)),q}return Ze.cancel=rt,Ze.flush=ke,Ze}return XE=v,XE}var KE,m3;function one(){if(m3)return KE;m3=1;var e=ine(),t=Vu(),a="Expected a function";function l(d,_,v){var i=!0,P=!0;if(typeof d!="function")throw new TypeError(a);return t(v)&&(i="leading"in v?!!v.leading:i,P="trailing"in v?!!v.trailing:P),e(d,_,{leading:i,maxWait:_,trailing:P})}return KE=l,KE}var ane=one();const t$=si(ane);function X_(e){"@babel/helpers - typeof";return X_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X_(e)}function g3(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Zx(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?g3(Object(a),!0).forEach(function(l){sne(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g3(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function sne(e,t,a){return t=lne(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function lne(e){var t=cne(e,"string");return X_(t)=="symbol"?t:t+""}function cne(e,t){if(X_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(X_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function une(e,t){return pne(e)||fne(e,t)||dne(e,t)||hne()}function hne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dne(e,t){if(e){if(typeof e=="string")return _3(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _3(e,t)}}function _3(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function fne(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function pne(e){if(Array.isArray(e))return e}var Xx=ie.forwardRef(function(e,t){var a=e.aspect,l=e.initialDimension,d=l===void 0?{width:-1,height:-1}:l,_=e.width,v=_===void 0?"100%":_,i=e.height,P=i===void 0?"100%":i,I=e.minWidth,M=I===void 0?0:I,R=e.minHeight,F=e.maxHeight,q=e.children,H=e.debounce,j=H===void 0?0:H,$=e.id,Y=e.className,K=e.onResize,re=e.style,se=re===void 0?{}:re,J=ie.useRef(null),ae=ie.useRef();ae.current=K,ie.useImperativeHandle(t,function(){return Object.defineProperty(J.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),J.current},configurable:!0})});var de=ie.useState({containerWidth:d.width,containerHeight:d.height}),Pe=une(de,2),Ne=Pe[0],rt=Pe[1],ke=ie.useCallback(function(nt,Je){rt(function(ot){var it=Math.round(nt),Pt=Math.round(Je);return ot.containerWidth===it&&ot.containerHeight===Pt?ot:{containerWidth:it,containerHeight:Pt}})},[]);ie.useEffect(function(){var nt=function(yt){var ar,qt=yt[0].contentRect,rr=qt.width,Tr=qt.height;ke(rr,Tr),(ar=ae.current)===null||ar===void 0||ar.call(ae,rr,Tr)};j>0&&(nt=t$(nt,j,{trailing:!0,leading:!1}));var Je=new ResizeObserver(nt),ot=J.current.getBoundingClientRect(),it=ot.width,Pt=ot.height;return ke(it,Pt),Je.observe(J.current),function(){Je.disconnect()}},[ke,j]);var Ze=ie.useMemo(function(){var nt=Ne.containerWidth,Je=Ne.containerHeight;if(nt<0||Je<0)return null;Vs(Yh(v)||Yh(P),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,v,P),Vs(!a||a>0,"The aspect(%s) must be greater than zero.",a);var ot=Yh(v)?nt:v,it=Yh(P)?Je:P;a&&a>0&&(ot?it=ot/a:it&&(ot=it*a),F&&it>F&&(it=F)),Vs(ot>0||it>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,ot,it,v,P,M,R,a);var Pt=!Array.isArray(q)&&wc(q.type).endsWith("Chart");return He.Children.map(q,function(Ot){return He.isValidElement(Ot)?ie.cloneElement(Ot,Zx({width:ot,height:it},Pt?{style:Zx({height:"100%",width:"100%",maxHeight:it,maxWidth:ot},Ot.props.style)}:{})):Ot})},[a,q,P,F,R,M,Ne,v]);return He.createElement("div",{id:$?"".concat($):void 0,className:Sn("recharts-responsive-container",Y),style:Zx(Zx({},se),{},{width:v,height:P,minWidth:M,minHeight:R,maxHeight:F}),ref:J},Ze)}),yp=function(t){return null};yp.displayName="Cell";function K_(e){"@babel/helpers - typeof";return K_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K_(e)}function y3(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function UP(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?y3(Object(a),!0).forEach(function(l){mne(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y3(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function mne(e,t,a){return t=gne(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gne(e){var t=_ne(e,"string");return K_(t)=="symbol"?t:t+""}function _ne(e,t){if(K_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(K_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var rp={widthCache:{},cacheCount:0},yne=2e3,vne={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},v3="recharts_measurement_span";function xne(e){var t=UP({},e);return Object.keys(t).forEach(function(a){t[a]||delete t[a]}),t}var D_=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||yd.isSsr)return{width:0,height:0};var l=xne(a),d=JSON.stringify({text:t,copyStyle:l});if(rp.widthCache[d])return rp.widthCache[d];try{var _=document.getElementById(v3);_||(_=document.createElement("span"),_.setAttribute("id",v3),_.setAttribute("aria-hidden","true"),document.body.appendChild(_));var v=UP(UP({},vne),l);Object.assign(_.style,v),_.textContent="".concat(t);var i=_.getBoundingClientRect(),P={width:i.width,height:i.height};return rp.widthCache[d]=P,++rp.cacheCount>yne&&(rp.cacheCount=0,rp.widthCache={}),P}catch{return{width:0,height:0}}},bne=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Y_(e){"@babel/helpers - typeof";return Y_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y_(e)}function j0(e,t){return Ane(e)||Tne(e,t)||Sne(e,t)||wne()}function wne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sne(e,t){if(e){if(typeof e=="string")return x3(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return x3(e,t)}}function x3(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Tne(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t===0){if(Object(a)!==a)return;P=!1}else for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Ane(e){if(Array.isArray(e))return e}function Ene(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b3(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,Ine(l.key),l)}}function Pne(e,t,a){return t&&b3(e.prototype,t),a&&b3(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ine(e){var t=Cne(e,"string");return Y_(t)=="symbol"?t:t+""}function Cne(e,t){if(Y_(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Y_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var w3=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,S3=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,One=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,Mne=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,r$={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},Rne=Object.keys(r$),up="NaN";function Dne(e,t){return e*r$[t]}var Kx=(function(){function e(t,a){Ene(this,e),this.num=t,this.unit=a,this.num=t,this.unit=a,Number.isNaN(t)&&(this.unit=""),a!==""&&!One.test(a)&&(this.num=NaN,this.unit=""),Rne.includes(a)&&(this.num=Dne(t,a),this.unit="px")}return Pne(e,[{key:"add",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num+a.num,this.unit)}},{key:"subtract",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num-a.num,this.unit)}},{key:"multiply",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num*a.num,this.unit||a.unit)}},{key:"divide",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num/a.num,this.unit||a.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(a){var l,d=(l=Mne.exec(a))!==null&&l!==void 0?l:[],_=j0(d,3),v=_[1],i=_[2];return new e(parseFloat(v),i??"")}}])})();function n$(e){if(e.includes(up))return up;for(var t=e;t.includes("*")||t.includes("/");){var a,l=(a=w3.exec(t))!==null&&a!==void 0?a:[],d=j0(l,4),_=d[1],v=d[2],i=d[3],P=Kx.parse(_??""),I=Kx.parse(i??""),M=v==="*"?P.multiply(I):P.divide(I);if(M.isNaN())return up;t=t.replace(w3,M.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var R,F=(R=S3.exec(t))!==null&&R!==void 0?R:[],q=j0(F,4),H=q[1],j=q[2],$=q[3],Y=Kx.parse(H??""),K=Kx.parse($??""),re=j==="+"?Y.add(K):Y.subtract(K);if(re.isNaN())return up;t=t.replace(S3,re.toString())}return t}var T3=/\(([^()]*)\)/;function kne(e){for(var t=e;t.includes("(");){var a=T3.exec(t),l=j0(a,2),d=l[1];t=t.replace(T3,n$(d))}return t}function Nne(e){var t=e.replace(/\s+/g,"");return t=kne(t),t=n$(t),t}function Lne(e){try{return Nne(e)}catch{return up}}function YE(e){var t=Lne(e.slice(5,-1));return t===up?"":t}var jne=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],zne=["dx","dy","angle","className","breakAll"];function VP(){return VP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},VP.apply(this,arguments)}function A3(e,t){if(e==null)return{};var a=Fne(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function Fne(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function E3(e,t){return $ne(e)||Vne(e,t)||Une(e,t)||Bne()}function Bne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Une(e,t){if(e){if(typeof e=="string")return P3(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return P3(e,t)}}function P3(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Vne(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t===0){if(Object(a)!==a)return;P=!1}else for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function $ne(e){if(Array.isArray(e))return e}var i$=/[ \f\n\r\t\v\u2028\u2029]+/,o$=function(t){var a=t.children,l=t.breakAll,d=t.style;try{var _=[];xn(a)||(l?_=a.toString().split(""):_=a.toString().split(i$));var v=_.map(function(P){return{word:P,width:D_(P,d).width}}),i=l?0:D_("",d).width;return{wordsWithComputedWidth:v,spaceWidth:i}}catch{return null}},qne=function(t,a,l,d,_){var v=t.maxLines,i=t.children,P=t.style,I=t.breakAll,M=fr(v),R=i,F=function(){var ot=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ot.reduce(function(it,Pt){var Ot=Pt.word,yt=Pt.width,ar=it[it.length-1];if(ar&&(d==null||_||ar.width+yt+l<Number(d)))ar.words.push(Ot),ar.width+=yt+l;else{var qt={words:[Ot],width:yt};it.push(qt)}return it},[])},q=F(a),H=function(ot){return ot.reduce(function(it,Pt){return it.width>Pt.width?it:Pt})};if(!M)return q;for(var j="",$=function(ot){var it=R.slice(0,ot),Pt=o$({breakAll:I,style:P,children:it+j}).wordsWithComputedWidth,Ot=F(Pt),yt=Ot.length>v||H(Ot).width>Number(d);return[yt,Ot]},Y=0,K=R.length-1,re=0,se;Y<=K&&re<=R.length-1;){var J=Math.floor((Y+K)/2),ae=J-1,de=$(ae),Pe=E3(de,2),Ne=Pe[0],rt=Pe[1],ke=$(J),Ze=E3(ke,1),nt=Ze[0];if(!Ne&&!nt&&(Y=J+1),Ne&&nt&&(K=J-1),!Ne&&nt){se=rt;break}re++}return se||q},I3=function(t){var a=xn(t)?[]:t.toString().split(i$);return[{words:a}]},Gne=function(t){var a=t.width,l=t.scaleToFit,d=t.children,_=t.style,v=t.breakAll,i=t.maxLines;if((a||l)&&!yd.isSsr){var P,I,M=o$({breakAll:v,children:d,style:_});if(M){var R=M.wordsWithComputedWidth,F=M.spaceWidth;P=R,I=F}else return I3(d);return qne({breakAll:v,children:d,maxLines:i,style:_},P,I,a,l)}return I3(d)},C3="#808080",ud=function(t){var a=t.x,l=a===void 0?0:a,d=t.y,_=d===void 0?0:d,v=t.lineHeight,i=v===void 0?"1em":v,P=t.capHeight,I=P===void 0?"0.71em":P,M=t.scaleToFit,R=M===void 0?!1:M,F=t.textAnchor,q=F===void 0?"start":F,H=t.verticalAnchor,j=H===void 0?"end":H,$=t.fill,Y=$===void 0?C3:$,K=A3(t,jne),re=ie.useMemo(function(){return Gne({breakAll:K.breakAll,children:K.children,maxLines:K.maxLines,scaleToFit:R,style:K.style,width:K.width})},[K.breakAll,K.children,K.maxLines,R,K.style,K.width]),se=K.dx,J=K.dy,ae=K.angle,de=K.className,Pe=K.breakAll,Ne=A3(K,zne);if(!go(l)||!go(_))return null;var rt=l+(fr(se)?se:0),ke=_+(fr(J)?J:0),Ze;switch(j){case"start":Ze=YE("calc(".concat(I,")"));break;case"middle":Ze=YE("calc(".concat((re.length-1)/2," * -").concat(i," + (").concat(I," / 2))"));break;default:Ze=YE("calc(".concat(re.length-1," * -").concat(i,")"));break}var nt=[];if(R){var Je=re[0].width,ot=K.width;nt.push("scale(".concat((fr(ot)?ot/Je:1)/Je,")"))}return ae&&nt.push("rotate(".concat(ae,", ").concat(rt,", ").concat(ke,")")),nt.length&&(Ne.transform=nt.join(" ")),He.createElement("text",VP({},Jr(Ne,!0),{x:rt,y:ke,className:Sn("recharts-text",de),textAnchor:q,fill:Y.includes("url")?C3:Y}),re.map(function(it,Pt){var Ot=it.words.join(Pe?"":" ");return He.createElement("tspan",{x:rt,dy:Pt===0?Ze:i,key:"".concat(Ot,"-").concat(Pt)},Ot)}))};function Fu(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Hne(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function KC(e){let t,a,l;e.length!==2?(t=Fu,a=(i,P)=>Fu(e(i),P),l=(i,P)=>e(i)-P):(t=e===Fu||e===Hne?e:Wne,a=e,l=e);function d(i,P,I=0,M=i.length){if(I<M){if(t(P,P)!==0)return M;do{const R=I+M>>>1;a(i[R],P)<0?I=R+1:M=R}while(I<M)}return I}function _(i,P,I=0,M=i.length){if(I<M){if(t(P,P)!==0)return M;do{const R=I+M>>>1;a(i[R],P)<=0?I=R+1:M=R}while(I<M)}return I}function v(i,P,I=0,M=i.length){const R=d(i,P,I,M-1);return R>I&&l(i[R-1],P)>-l(i[R],P)?R-1:R}return{left:d,center:v,right:_}}function Wne(){return 0}function a$(e){return e===null?NaN:+e}function*Zne(e,t){for(let a of e)a!=null&&(a=+a)>=a&&(yield a)}const Xne=KC(Fu),Ly=Xne.right;KC(a$).center;class O3 extends Map{constructor(t,a=Jne){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:a}}),t!=null)for(const[l,d]of t)this.set(l,d)}get(t){return super.get(M3(this,t))}has(t){return super.has(M3(this,t))}set(t,a){return super.set(Kne(this,t),a)}delete(t){return super.delete(Yne(this,t))}}function M3({_intern:e,_key:t},a){const l=t(a);return e.has(l)?e.get(l):a}function Kne({_intern:e,_key:t},a){const l=t(a);return e.has(l)?e.get(l):(e.set(l,a),a)}function Yne({_intern:e,_key:t},a){const l=t(a);return e.has(l)&&(a=e.get(l),e.delete(l)),a}function Jne(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Qne(e=Fu){if(e===Fu)return s$;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,a)=>{const l=e(t,a);return l||l===0?l:(e(a,a)===0)-(e(t,t)===0)}}function s$(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const eie=Math.sqrt(50),tie=Math.sqrt(10),rie=Math.sqrt(2);function z0(e,t,a){const l=(t-e)/Math.max(0,a),d=Math.floor(Math.log10(l)),_=l/Math.pow(10,d),v=_>=eie?10:_>=tie?5:_>=rie?2:1;let i,P,I;return d<0?(I=Math.pow(10,-d)/v,i=Math.round(e*I),P=Math.round(t*I),i/I<e&&++i,P/I>t&&--P,I=-I):(I=Math.pow(10,d)*v,i=Math.round(e/I),P=Math.round(t/I),i*I<e&&++i,P*I>t&&--P),P<i&&.5<=a&&a<2?z0(e,t,a*2):[i,P,I]}function $P(e,t,a){if(t=+t,e=+e,a=+a,!(a>0))return[];if(e===t)return[e];const l=t<e,[d,_,v]=l?z0(t,e,a):z0(e,t,a);if(!(_>=d))return[];const i=_-d+1,P=new Array(i);if(l)if(v<0)for(let I=0;I<i;++I)P[I]=(_-I)/-v;else for(let I=0;I<i;++I)P[I]=(_-I)*v;else if(v<0)for(let I=0;I<i;++I)P[I]=(d+I)/-v;else for(let I=0;I<i;++I)P[I]=(d+I)*v;return P}function qP(e,t,a){return t=+t,e=+e,a=+a,z0(e,t,a)[2]}function GP(e,t,a){t=+t,e=+e,a=+a;const l=t<e,d=l?qP(t,e,a):qP(e,t,a);return(l?-1:1)*(d<0?1/-d:d)}function R3(e,t){let a;for(const l of e)l!=null&&(a<l||a===void 0&&l>=l)&&(a=l);return a}function D3(e,t){let a;for(const l of e)l!=null&&(a>l||a===void 0&&l>=l)&&(a=l);return a}function l$(e,t,a=0,l=1/0,d){if(t=Math.floor(t),a=Math.floor(Math.max(0,a)),l=Math.floor(Math.min(e.length-1,l)),!(a<=t&&t<=l))return e;for(d=d===void 0?s$:Qne(d);l>a;){if(l-a>600){const P=l-a+1,I=t-a+1,M=Math.log(P),R=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*R*(P-R)/P)*(I-P/2<0?-1:1),q=Math.max(a,Math.floor(t-I*R/P+F)),H=Math.min(l,Math.floor(t+(P-I)*R/P+F));l$(e,t,q,H,d)}const _=e[t];let v=a,i=l;for(f_(e,a,t),d(e[l],_)>0&&f_(e,a,l);v<i;){for(f_(e,v,i),++v,--i;d(e[v],_)<0;)++v;for(;d(e[i],_)>0;)--i}d(e[a],_)===0?f_(e,a,i):(++i,f_(e,i,l)),i<=t&&(a=i+1),t<=i&&(l=i-1)}return e}function f_(e,t,a){const l=e[t];e[t]=e[a],e[a]=l}function nie(e,t,a){if(e=Float64Array.from(Zne(e)),!(!(l=e.length)||isNaN(t=+t))){if(t<=0||l<2)return D3(e);if(t>=1)return R3(e);var l,d=(l-1)*t,_=Math.floor(d),v=R3(l$(e,_).subarray(0,_+1)),i=D3(e.subarray(_+1));return v+(i-v)*(d-_)}}function iie(e,t,a=a$){if(!(!(l=e.length)||isNaN(t=+t))){if(t<=0||l<2)return+a(e[0],0,e);if(t>=1)return+a(e[l-1],l-1,e);var l,d=(l-1)*t,_=Math.floor(d),v=+a(e[_],_,e),i=+a(e[_+1],_+1,e);return v+(i-v)*(d-_)}}function oie(e,t,a){e=+e,t=+t,a=(d=arguments.length)<2?(t=e,e=0,1):d<3?1:+a;for(var l=-1,d=Math.max(0,Math.ceil((t-e)/a))|0,_=new Array(d);++l<d;)_[l]=e+l*a;return _}function gs(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Nc(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const HP=Symbol("implicit");function YC(){var e=new O3,t=[],a=[],l=HP;function d(_){let v=e.get(_);if(v===void 0){if(l!==HP)return l;e.set(_,v=t.push(_)-1)}return a[v%a.length]}return d.domain=function(_){if(!arguments.length)return t.slice();t=[],e=new O3;for(const v of _)e.has(v)||e.set(v,t.push(v)-1);return d},d.range=function(_){return arguments.length?(a=Array.from(_),d):a.slice()},d.unknown=function(_){return arguments.length?(l=_,d):l},d.copy=function(){return YC(t,a).unknown(l)},gs.apply(d,arguments),d}function J_(){var e=YC().unknown(void 0),t=e.domain,a=e.range,l=0,d=1,_,v,i=!1,P=0,I=0,M=.5;delete e.unknown;function R(){var F=t().length,q=d<l,H=q?d:l,j=q?l:d;_=(j-H)/Math.max(1,F-P+I*2),i&&(_=Math.floor(_)),H+=(j-H-_*(F-P))*M,v=_*(1-P),i&&(H=Math.round(H),v=Math.round(v));var $=oie(F).map(function(Y){return H+_*Y});return a(q?$.reverse():$)}return e.domain=function(F){return arguments.length?(t(F),R()):t()},e.range=function(F){return arguments.length?([l,d]=F,l=+l,d=+d,R()):[l,d]},e.rangeRound=function(F){return[l,d]=F,l=+l,d=+d,i=!0,R()},e.bandwidth=function(){return v},e.step=function(){return _},e.round=function(F){return arguments.length?(i=!!F,R()):i},e.padding=function(F){return arguments.length?(P=Math.min(1,I=+F),R()):P},e.paddingInner=function(F){return arguments.length?(P=Math.min(1,F),R()):P},e.paddingOuter=function(F){return arguments.length?(I=+F,R()):I},e.align=function(F){return arguments.length?(M=Math.max(0,Math.min(1,F)),R()):M},e.copy=function(){return J_(t(),[l,d]).round(i).paddingInner(P).paddingOuter(I).align(M)},gs.apply(R(),arguments)}function c$(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return c$(t())},e}function k_(){return c$(J_.apply(null,arguments).paddingInner(1))}function JC(e,t,a){e.prototype=t.prototype=a,a.constructor=e}function u$(e,t){var a=Object.create(e.prototype);for(var l in t)a[l]=t[l];return a}function jy(){}var Q_=.7,F0=1/Q_,vp="\\s*([+-]?\\d+)\\s*",ey="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",El="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",aie=/^#([0-9a-f]{3,8})$/,sie=new RegExp(`^rgb\\(${vp},${vp},${vp}\\)$`),lie=new RegExp(`^rgb\\(${El},${El},${El}\\)$`),cie=new RegExp(`^rgba\\(${vp},${vp},${vp},${ey}\\)$`),uie=new RegExp(`^rgba\\(${El},${El},${El},${ey}\\)$`),hie=new RegExp(`^hsl\\(${ey},${El},${El}\\)$`),die=new RegExp(`^hsla\\(${ey},${El},${El},${ey}\\)$`),k3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};JC(jy,ty,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:N3,formatHex:N3,formatHex8:fie,formatHsl:pie,formatRgb:L3,toString:L3});function N3(){return this.rgb().formatHex()}function fie(){return this.rgb().formatHex8()}function pie(){return h$(this).formatHsl()}function L3(){return this.rgb().formatRgb()}function ty(e){var t,a;return e=(e+"").trim().toLowerCase(),(t=aie.exec(e))?(a=t[1].length,t=parseInt(t[1],16),a===6?j3(t):a===3?new ma(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):a===8?Yx(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):a===4?Yx(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=sie.exec(e))?new ma(t[1],t[2],t[3],1):(t=lie.exec(e))?new ma(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=cie.exec(e))?Yx(t[1],t[2],t[3],t[4]):(t=uie.exec(e))?Yx(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=hie.exec(e))?B3(t[1],t[2]/100,t[3]/100,1):(t=die.exec(e))?B3(t[1],t[2]/100,t[3]/100,t[4]):k3.hasOwnProperty(e)?j3(k3[e]):e==="transparent"?new ma(NaN,NaN,NaN,0):null}function j3(e){return new ma(e>>16&255,e>>8&255,e&255,1)}function Yx(e,t,a,l){return l<=0&&(e=t=a=NaN),new ma(e,t,a,l)}function mie(e){return e instanceof jy||(e=ty(e)),e?(e=e.rgb(),new ma(e.r,e.g,e.b,e.opacity)):new ma}function WP(e,t,a,l){return arguments.length===1?mie(e):new ma(e,t,a,l??1)}function ma(e,t,a,l){this.r=+e,this.g=+t,this.b=+a,this.opacity=+l}JC(ma,WP,u$(jy,{brighter(e){return e=e==null?F0:Math.pow(F0,e),new ma(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Q_:Math.pow(Q_,e),new ma(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ma(td(this.r),td(this.g),td(this.b),B0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:z3,formatHex:z3,formatHex8:gie,formatRgb:F3,toString:F3}));function z3(){return`#${Jh(this.r)}${Jh(this.g)}${Jh(this.b)}`}function gie(){return`#${Jh(this.r)}${Jh(this.g)}${Jh(this.b)}${Jh((isNaN(this.opacity)?1:this.opacity)*255)}`}function F3(){const e=B0(this.opacity);return`${e===1?"rgb(":"rgba("}${td(this.r)}, ${td(this.g)}, ${td(this.b)}${e===1?")":`, ${e})`}`}function B0(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function td(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Jh(e){return e=td(e),(e<16?"0":"")+e.toString(16)}function B3(e,t,a,l){return l<=0?e=t=a=NaN:a<=0||a>=1?e=t=NaN:t<=0&&(e=NaN),new Bs(e,t,a,l)}function h$(e){if(e instanceof Bs)return new Bs(e.h,e.s,e.l,e.opacity);if(e instanceof jy||(e=ty(e)),!e)return new Bs;if(e instanceof Bs)return e;e=e.rgb();var t=e.r/255,a=e.g/255,l=e.b/255,d=Math.min(t,a,l),_=Math.max(t,a,l),v=NaN,i=_-d,P=(_+d)/2;return i?(t===_?v=(a-l)/i+(a<l)*6:a===_?v=(l-t)/i+2:v=(t-a)/i+4,i/=P<.5?_+d:2-_-d,v*=60):i=P>0&&P<1?0:v,new Bs(v,i,P,e.opacity)}function _ie(e,t,a,l){return arguments.length===1?h$(e):new Bs(e,t,a,l??1)}function Bs(e,t,a,l){this.h=+e,this.s=+t,this.l=+a,this.opacity=+l}JC(Bs,_ie,u$(jy,{brighter(e){return e=e==null?F0:Math.pow(F0,e),new Bs(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Q_:Math.pow(Q_,e),new Bs(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,l=a+(a<.5?a:1-a)*t,d=2*a-l;return new ma(JE(e>=240?e-240:e+120,d,l),JE(e,d,l),JE(e<120?e+240:e-120,d,l),this.opacity)},clamp(){return new Bs(U3(this.h),Jx(this.s),Jx(this.l),B0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=B0(this.opacity);return`${e===1?"hsl(":"hsla("}${U3(this.h)}, ${Jx(this.s)*100}%, ${Jx(this.l)*100}%${e===1?")":`, ${e})`}`}}));function U3(e){return e=(e||0)%360,e<0?e+360:e}function Jx(e){return Math.max(0,Math.min(1,e||0))}function JE(e,t,a){return(e<60?t+(a-t)*e/60:e<180?a:e<240?t+(a-t)*(240-e)/60:t)*255}const QC=e=>()=>e;function yie(e,t){return function(a){return e+a*t}}function vie(e,t,a){return e=Math.pow(e,a),t=Math.pow(t,a)-e,a=1/a,function(l){return Math.pow(e+l*t,a)}}function xie(e){return(e=+e)==1?d$:function(t,a){return a-t?vie(t,a,e):QC(isNaN(t)?a:t)}}function d$(e,t){var a=t-e;return a?yie(e,a):QC(isNaN(e)?t:e)}const V3=(function e(t){var a=xie(t);function l(d,_){var v=a((d=WP(d)).r,(_=WP(_)).r),i=a(d.g,_.g),P=a(d.b,_.b),I=d$(d.opacity,_.opacity);return function(M){return d.r=v(M),d.g=i(M),d.b=P(M),d.opacity=I(M),d+""}}return l.gamma=e,l})(1);function bie(e,t){t||(t=[]);var a=e?Math.min(t.length,e.length):0,l=t.slice(),d;return function(_){for(d=0;d<a;++d)l[d]=e[d]*(1-_)+t[d]*_;return l}}function wie(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Sie(e,t){var a=t?t.length:0,l=e?Math.min(a,e.length):0,d=new Array(l),_=new Array(a),v;for(v=0;v<l;++v)d[v]=cm(e[v],t[v]);for(;v<a;++v)_[v]=t[v];return function(i){for(v=0;v<l;++v)_[v]=d[v](i);return _}}function Tie(e,t){var a=new Date;return e=+e,t=+t,function(l){return a.setTime(e*(1-l)+t*l),a}}function U0(e,t){return e=+e,t=+t,function(a){return e*(1-a)+t*a}}function Aie(e,t){var a={},l={},d;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(d in t)d in e?a[d]=cm(e[d],t[d]):l[d]=t[d];return function(_){for(d in a)l[d]=a[d](_);return l}}var ZP=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,QE=new RegExp(ZP.source,"g");function Eie(e){return function(){return e}}function Pie(e){return function(t){return e(t)+""}}function Iie(e,t){var a=ZP.lastIndex=QE.lastIndex=0,l,d,_,v=-1,i=[],P=[];for(e=e+"",t=t+"";(l=ZP.exec(e))&&(d=QE.exec(t));)(_=d.index)>a&&(_=t.slice(a,_),i[v]?i[v]+=_:i[++v]=_),(l=l[0])===(d=d[0])?i[v]?i[v]+=d:i[++v]=d:(i[++v]=null,P.push({i:v,x:U0(l,d)})),a=QE.lastIndex;return a<t.length&&(_=t.slice(a),i[v]?i[v]+=_:i[++v]=_),i.length<2?P[0]?Pie(P[0].x):Eie(t):(t=P.length,function(I){for(var M=0,R;M<t;++M)i[(R=P[M]).i]=R.x(I);return i.join("")})}function cm(e,t){var a=typeof t,l;return t==null||a==="boolean"?QC(t):(a==="number"?U0:a==="string"?(l=ty(t))?(t=l,V3):Iie:t instanceof ty?V3:t instanceof Date?Tie:wie(t)?bie:Array.isArray(t)?Sie:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Aie:U0)(e,t)}function eO(e,t){return e=+e,t=+t,function(a){return Math.round(e*(1-a)+t*a)}}function Cie(e,t){t===void 0&&(t=e,e=cm);for(var a=0,l=t.length-1,d=t[0],_=new Array(l<0?0:l);a<l;)_[a]=e(d,d=t[++a]);return function(v){var i=Math.max(0,Math.min(l-1,Math.floor(v*=l)));return _[i](v-i)}}function Oie(e){return function(){return e}}function V0(e){return+e}var $3=[0,1];function ua(e){return e}function XP(e,t){return(t-=e=+e)?function(a){return(a-e)/t}:Oie(isNaN(t)?NaN:.5)}function Mie(e,t){var a;return e>t&&(a=e,e=t,t=a),function(l){return Math.max(e,Math.min(t,l))}}function Rie(e,t,a){var l=e[0],d=e[1],_=t[0],v=t[1];return d<l?(l=XP(d,l),_=a(v,_)):(l=XP(l,d),_=a(_,v)),function(i){return _(l(i))}}function Die(e,t,a){var l=Math.min(e.length,t.length)-1,d=new Array(l),_=new Array(l),v=-1;for(e[l]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++v<l;)d[v]=XP(e[v],e[v+1]),_[v]=a(t[v],t[v+1]);return function(i){var P=Ly(e,i,1,l)-1;return _[P](d[P](i))}}function zy(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ew(){var e=$3,t=$3,a=cm,l,d,_,v=ua,i,P,I;function M(){var F=Math.min(e.length,t.length);return v!==ua&&(v=Mie(e[0],e[F-1])),i=F>2?Die:Rie,P=I=null,R}function R(F){return F==null||isNaN(F=+F)?_:(P||(P=i(e.map(l),t,a)))(l(v(F)))}return R.invert=function(F){return v(d((I||(I=i(t,e.map(l),U0)))(F)))},R.domain=function(F){return arguments.length?(e=Array.from(F,V0),M()):e.slice()},R.range=function(F){return arguments.length?(t=Array.from(F),M()):t.slice()},R.rangeRound=function(F){return t=Array.from(F),a=eO,M()},R.clamp=function(F){return arguments.length?(v=F?!0:ua,M()):v!==ua},R.interpolate=function(F){return arguments.length?(a=F,M()):a},R.unknown=function(F){return arguments.length?(_=F,R):_},function(F,q){return l=F,d=q,M()}}function tO(){return ew()(ua,ua)}function kie(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function $0(e,t){if((a=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var a,l=e.slice(0,a);return[l.length>1?l[0]+l.slice(2):l,+e.slice(a+1)]}function Op(e){return e=$0(Math.abs(e)),e?e[1]:NaN}function Nie(e,t){return function(a,l){for(var d=a.length,_=[],v=0,i=e[0],P=0;d>0&&i>0&&(P+i+1>l&&(i=Math.max(1,l-P)),_.push(a.substring(d-=i,d+i)),!((P+=i+1)>l));)i=e[v=(v+1)%e.length];return _.reverse().join(t)}}function Lie(e){return function(t){return t.replace(/[0-9]/g,function(a){return e[+a]})}}var jie=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ry(e){if(!(t=jie.exec(e)))throw new Error("invalid format: "+e);var t;return new rO({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ry.prototype=rO.prototype;function rO(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}rO.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zie(e){e:for(var t=e.length,a=1,l=-1,d;a<t;++a)switch(e[a]){case".":l=d=a;break;case"0":l===0&&(l=a),d=a;break;default:if(!+e[a])break e;l>0&&(l=0);break}return l>0?e.slice(0,l)+e.slice(d+1):e}var f$;function Fie(e,t){var a=$0(e,t);if(!a)return e+"";var l=a[0],d=a[1],_=d-(f$=Math.max(-8,Math.min(8,Math.floor(d/3)))*3)+1,v=l.length;return _===v?l:_>v?l+new Array(_-v+1).join("0"):_>0?l.slice(0,_)+"."+l.slice(_):"0."+new Array(1-_).join("0")+$0(e,Math.max(0,t+_-1))[0]}function q3(e,t){var a=$0(e,t);if(!a)return e+"";var l=a[0],d=a[1];return d<0?"0."+new Array(-d).join("0")+l:l.length>d+1?l.slice(0,d+1)+"."+l.slice(d+1):l+new Array(d-l.length+2).join("0")}const G3={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:kie,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>q3(e*100,t),r:q3,s:Fie,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function H3(e){return e}var W3=Array.prototype.map,Z3=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Bie(e){var t=e.grouping===void 0||e.thousands===void 0?H3:Nie(W3.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",l=e.currency===void 0?"":e.currency[1]+"",d=e.decimal===void 0?".":e.decimal+"",_=e.numerals===void 0?H3:Lie(W3.call(e.numerals,String)),v=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",P=e.nan===void 0?"NaN":e.nan+"";function I(R){R=ry(R);var F=R.fill,q=R.align,H=R.sign,j=R.symbol,$=R.zero,Y=R.width,K=R.comma,re=R.precision,se=R.trim,J=R.type;J==="n"?(K=!0,J="g"):G3[J]||(re===void 0&&(re=12),se=!0,J="g"),($||F==="0"&&q==="=")&&($=!0,F="0",q="=");var ae=j==="$"?a:j==="#"&&/[boxX]/.test(J)?"0"+J.toLowerCase():"",de=j==="$"?l:/[%p]/.test(J)?v:"",Pe=G3[J],Ne=/[defgprs%]/.test(J);re=re===void 0?6:/[gprs]/.test(J)?Math.max(1,Math.min(21,re)):Math.max(0,Math.min(20,re));function rt(ke){var Ze=ae,nt=de,Je,ot,it;if(J==="c")nt=Pe(ke)+nt,ke="";else{ke=+ke;var Pt=ke<0||1/ke<0;if(ke=isNaN(ke)?P:Pe(Math.abs(ke),re),se&&(ke=zie(ke)),Pt&&+ke==0&&H!=="+"&&(Pt=!1),Ze=(Pt?H==="("?H:i:H==="-"||H==="("?"":H)+Ze,nt=(J==="s"?Z3[8+f$/3]:"")+nt+(Pt&&H==="("?")":""),Ne){for(Je=-1,ot=ke.length;++Je<ot;)if(it=ke.charCodeAt(Je),48>it||it>57){nt=(it===46?d+ke.slice(Je+1):ke.slice(Je))+nt,ke=ke.slice(0,Je);break}}}K&&!$&&(ke=t(ke,1/0));var Ot=Ze.length+ke.length+nt.length,yt=Ot<Y?new Array(Y-Ot+1).join(F):"";switch(K&&$&&(ke=t(yt+ke,yt.length?Y-nt.length:1/0),yt=""),q){case"<":ke=Ze+ke+nt+yt;break;case"=":ke=Ze+yt+ke+nt;break;case"^":ke=yt.slice(0,Ot=yt.length>>1)+Ze+ke+nt+yt.slice(Ot);break;default:ke=yt+Ze+ke+nt;break}return _(ke)}return rt.toString=function(){return R+""},rt}function M(R,F){var q=I((R=ry(R),R.type="f",R)),H=Math.max(-8,Math.min(8,Math.floor(Op(F)/3)))*3,j=Math.pow(10,-H),$=Z3[8+H/3];return function(Y){return q(j*Y)+$}}return{format:I,formatPrefix:M}}var Qx,nO,p$;Uie({thousands:",",grouping:[3],currency:["$",""]});function Uie(e){return Qx=Bie(e),nO=Qx.format,p$=Qx.formatPrefix,Qx}function Vie(e){return Math.max(0,-Op(Math.abs(e)))}function $ie(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Op(t)/3)))*3-Op(Math.abs(e)))}function qie(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Op(t)-Op(e))+1}function m$(e,t,a,l){var d=GP(e,t,a),_;switch(l=ry(l??",f"),l.type){case"s":{var v=Math.max(Math.abs(e),Math.abs(t));return l.precision==null&&!isNaN(_=$ie(d,v))&&(l.precision=_),p$(l,v)}case"":case"e":case"g":case"p":case"r":{l.precision==null&&!isNaN(_=qie(d,Math.max(Math.abs(e),Math.abs(t))))&&(l.precision=_-(l.type==="e"));break}case"f":case"%":{l.precision==null&&!isNaN(_=Vie(d))&&(l.precision=_-(l.type==="%")*2);break}}return nO(l)}function $u(e){var t=e.domain;return e.ticks=function(a){var l=t();return $P(l[0],l[l.length-1],a??10)},e.tickFormat=function(a,l){var d=t();return m$(d[0],d[d.length-1],a??10,l)},e.nice=function(a){a==null&&(a=10);var l=t(),d=0,_=l.length-1,v=l[d],i=l[_],P,I,M=10;for(i<v&&(I=v,v=i,i=I,I=d,d=_,_=I);M-- >0;){if(I=qP(v,i,a),I===P)return l[d]=v,l[_]=i,t(l);if(I>0)v=Math.floor(v/I)*I,i=Math.ceil(i/I)*I;else if(I<0)v=Math.ceil(v*I)/I,i=Math.floor(i*I)/I;else break;P=I}return e},e}function q0(){var e=tO();return e.copy=function(){return zy(e,q0())},gs.apply(e,arguments),$u(e)}function g$(e){var t;function a(l){return l==null||isNaN(l=+l)?t:l}return a.invert=a,a.domain=a.range=function(l){return arguments.length?(e=Array.from(l,V0),a):e.slice()},a.unknown=function(l){return arguments.length?(t=l,a):t},a.copy=function(){return g$(e).unknown(t)},e=arguments.length?Array.from(e,V0):[0,1],$u(a)}function _$(e,t){e=e.slice();var a=0,l=e.length-1,d=e[a],_=e[l],v;return _<d&&(v=a,a=l,l=v,v=d,d=_,_=v),e[a]=t.floor(d),e[l]=t.ceil(_),e}function X3(e){return Math.log(e)}function K3(e){return Math.exp(e)}function Gie(e){return-Math.log(-e)}function Hie(e){return-Math.exp(-e)}function Wie(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Zie(e){return e===10?Wie:e===Math.E?Math.exp:t=>Math.pow(e,t)}function Xie(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function Y3(e){return(t,a)=>-e(-t,a)}function iO(e){const t=e(X3,K3),a=t.domain;let l=10,d,_;function v(){return d=Xie(l),_=Zie(l),a()[0]<0?(d=Y3(d),_=Y3(_),e(Gie,Hie)):e(X3,K3),t}return t.base=function(i){return arguments.length?(l=+i,v()):l},t.domain=function(i){return arguments.length?(a(i),v()):a()},t.ticks=i=>{const P=a();let I=P[0],M=P[P.length-1];const R=M<I;R&&([I,M]=[M,I]);let F=d(I),q=d(M),H,j;const $=i==null?10:+i;let Y=[];if(!(l%1)&&q-F<$){if(F=Math.floor(F),q=Math.ceil(q),I>0){for(;F<=q;++F)for(H=1;H<l;++H)if(j=F<0?H/_(-F):H*_(F),!(j<I)){if(j>M)break;Y.push(j)}}else for(;F<=q;++F)for(H=l-1;H>=1;--H)if(j=F>0?H/_(-F):H*_(F),!(j<I)){if(j>M)break;Y.push(j)}Y.length*2<$&&(Y=$P(I,M,$))}else Y=$P(F,q,Math.min(q-F,$)).map(_);return R?Y.reverse():Y},t.tickFormat=(i,P)=>{if(i==null&&(i=10),P==null&&(P=l===10?"s":","),typeof P!="function"&&(!(l%1)&&(P=ry(P)).precision==null&&(P.trim=!0),P=nO(P)),i===1/0)return P;const I=Math.max(1,l*i/t.ticks().length);return M=>{let R=M/_(Math.round(d(M)));return R*l<l-.5&&(R*=l),R<=I?P(M):""}},t.nice=()=>a(_$(a(),{floor:i=>_(Math.floor(d(i))),ceil:i=>_(Math.ceil(d(i)))})),t}function y$(){const e=iO(ew()).domain([1,10]);return e.copy=()=>zy(e,y$()).base(e.base()),gs.apply(e,arguments),e}function J3(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Q3(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function oO(e){var t=1,a=e(J3(t),Q3(t));return a.constant=function(l){return arguments.length?e(J3(t=+l),Q3(t)):t},$u(a)}function v$(){var e=oO(ew());return e.copy=function(){return zy(e,v$()).constant(e.constant())},gs.apply(e,arguments)}function eF(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Kie(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Yie(e){return e<0?-e*e:e*e}function aO(e){var t=e(ua,ua),a=1;function l(){return a===1?e(ua,ua):a===.5?e(Kie,Yie):e(eF(a),eF(1/a))}return t.exponent=function(d){return arguments.length?(a=+d,l()):a},$u(t)}function sO(){var e=aO(ew());return e.copy=function(){return zy(e,sO()).exponent(e.exponent())},gs.apply(e,arguments),e}function Jie(){return sO.apply(null,arguments).exponent(.5)}function tF(e){return Math.sign(e)*e*e}function Qie(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function x$(){var e=tO(),t=[0,1],a=!1,l;function d(_){var v=Qie(e(_));return isNaN(v)?l:a?Math.round(v):v}return d.invert=function(_){return e.invert(tF(_))},d.domain=function(_){return arguments.length?(e.domain(_),d):e.domain()},d.range=function(_){return arguments.length?(e.range((t=Array.from(_,V0)).map(tF)),d):t.slice()},d.rangeRound=function(_){return d.range(_).round(!0)},d.round=function(_){return arguments.length?(a=!!_,d):a},d.clamp=function(_){return arguments.length?(e.clamp(_),d):e.clamp()},d.unknown=function(_){return arguments.length?(l=_,d):l},d.copy=function(){return x$(e.domain(),t).round(a).clamp(e.clamp()).unknown(l)},gs.apply(d,arguments),$u(d)}function b$(){var e=[],t=[],a=[],l;function d(){var v=0,i=Math.max(1,t.length);for(a=new Array(i-1);++v<i;)a[v-1]=iie(e,v/i);return _}function _(v){return v==null||isNaN(v=+v)?l:t[Ly(a,v)]}return _.invertExtent=function(v){var i=t.indexOf(v);return i<0?[NaN,NaN]:[i>0?a[i-1]:e[0],i<a.length?a[i]:e[e.length-1]]},_.domain=function(v){if(!arguments.length)return e.slice();e=[];for(let i of v)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Fu),d()},_.range=function(v){return arguments.length?(t=Array.from(v),d()):t.slice()},_.unknown=function(v){return arguments.length?(l=v,_):l},_.quantiles=function(){return a.slice()},_.copy=function(){return b$().domain(e).range(t).unknown(l)},gs.apply(_,arguments)}function w$(){var e=0,t=1,a=1,l=[.5],d=[0,1],_;function v(P){return P!=null&&P<=P?d[Ly(l,P,0,a)]:_}function i(){var P=-1;for(l=new Array(a);++P<a;)l[P]=((P+1)*t-(P-a)*e)/(a+1);return v}return v.domain=function(P){return arguments.length?([e,t]=P,e=+e,t=+t,i()):[e,t]},v.range=function(P){return arguments.length?(a=(d=Array.from(P)).length-1,i()):d.slice()},v.invertExtent=function(P){var I=d.indexOf(P);return I<0?[NaN,NaN]:I<1?[e,l[0]]:I>=a?[l[a-1],t]:[l[I-1],l[I]]},v.unknown=function(P){return arguments.length&&(_=P),v},v.thresholds=function(){return l.slice()},v.copy=function(){return w$().domain([e,t]).range(d).unknown(_)},gs.apply($u(v),arguments)}function S$(){var e=[.5],t=[0,1],a,l=1;function d(_){return _!=null&&_<=_?t[Ly(e,_,0,l)]:a}return d.domain=function(_){return arguments.length?(e=Array.from(_),l=Math.min(e.length,t.length-1),d):e.slice()},d.range=function(_){return arguments.length?(t=Array.from(_),l=Math.min(e.length,t.length-1),d):t.slice()},d.invertExtent=function(_){var v=t.indexOf(_);return[e[v-1],e[v]]},d.unknown=function(_){return arguments.length?(a=_,d):a},d.copy=function(){return S$().domain(e).range(t).unknown(a)},gs.apply(d,arguments)}const e2=new Date,t2=new Date;function _o(e,t,a,l){function d(_){return e(_=arguments.length===0?new Date:new Date(+_)),_}return d.floor=_=>(e(_=new Date(+_)),_),d.ceil=_=>(e(_=new Date(_-1)),t(_,1),e(_),_),d.round=_=>{const v=d(_),i=d.ceil(_);return _-v<i-_?v:i},d.offset=(_,v)=>(t(_=new Date(+_),v==null?1:Math.floor(v)),_),d.range=(_,v,i)=>{const P=[];if(_=d.ceil(_),i=i==null?1:Math.floor(i),!(_<v)||!(i>0))return P;let I;do P.push(I=new Date(+_)),t(_,i),e(_);while(I<_&&_<v);return P},d.filter=_=>_o(v=>{if(v>=v)for(;e(v),!_(v);)v.setTime(v-1)},(v,i)=>{if(v>=v)if(i<0)for(;++i<=0;)for(;t(v,-1),!_(v););else for(;--i>=0;)for(;t(v,1),!_(v););}),a&&(d.count=(_,v)=>(e2.setTime(+_),t2.setTime(+v),e(e2),e(t2),Math.floor(a(e2,t2))),d.every=_=>(_=Math.floor(_),!isFinite(_)||!(_>0)?null:_>1?d.filter(l?v=>l(v)%_===0:v=>d.count(0,v)%_===0):d)),d}const G0=_o(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);G0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?_o(t=>{t.setTime(Math.floor(t/e)*e)},(t,a)=>{t.setTime(+t+a*e)},(t,a)=>(a-t)/e):G0);G0.range;const yc=1e3,fs=yc*60,vc=fs*60,Cc=vc*24,lO=Cc*7,rF=Cc*30,r2=Cc*365,Qh=_o(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*yc)},(e,t)=>(t-e)/yc,e=>e.getUTCSeconds());Qh.range;const cO=_o(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*yc)},(e,t)=>{e.setTime(+e+t*fs)},(e,t)=>(t-e)/fs,e=>e.getMinutes());cO.range;const uO=_o(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*fs)},(e,t)=>(t-e)/fs,e=>e.getUTCMinutes());uO.range;const hO=_o(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*yc-e.getMinutes()*fs)},(e,t)=>{e.setTime(+e+t*vc)},(e,t)=>(t-e)/vc,e=>e.getHours());hO.range;const dO=_o(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*vc)},(e,t)=>(t-e)/vc,e=>e.getUTCHours());dO.range;const Fy=_o(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*fs)/Cc,e=>e.getDate()-1);Fy.range;const tw=_o(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Cc,e=>e.getUTCDate()-1);tw.range;const T$=_o(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Cc,e=>Math.floor(e/Cc));T$.range;function vd(e){return _o(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,a)=>{t.setDate(t.getDate()+a*7)},(t,a)=>(a-t-(a.getTimezoneOffset()-t.getTimezoneOffset())*fs)/lO)}const rw=vd(0),H0=vd(1),eoe=vd(2),toe=vd(3),Mp=vd(4),roe=vd(5),noe=vd(6);rw.range;H0.range;eoe.range;toe.range;Mp.range;roe.range;noe.range;function xd(e){return _o(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,a)=>{t.setUTCDate(t.getUTCDate()+a*7)},(t,a)=>(a-t)/lO)}const nw=xd(0),W0=xd(1),ioe=xd(2),ooe=xd(3),Rp=xd(4),aoe=xd(5),soe=xd(6);nw.range;W0.range;ioe.range;ooe.range;Rp.range;aoe.range;soe.range;const fO=_o(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());fO.range;const pO=_o(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());pO.range;const Oc=_o(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Oc.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:_o(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,a)=>{t.setFullYear(t.getFullYear()+a*e)});Oc.range;const Mc=_o(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Mc.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:_o(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,a)=>{t.setUTCFullYear(t.getUTCFullYear()+a*e)});Mc.range;function A$(e,t,a,l,d,_){const v=[[Qh,1,yc],[Qh,5,5*yc],[Qh,15,15*yc],[Qh,30,30*yc],[_,1,fs],[_,5,5*fs],[_,15,15*fs],[_,30,30*fs],[d,1,vc],[d,3,3*vc],[d,6,6*vc],[d,12,12*vc],[l,1,Cc],[l,2,2*Cc],[a,1,lO],[t,1,rF],[t,3,3*rF],[e,1,r2]];function i(I,M,R){const F=M<I;F&&([I,M]=[M,I]);const q=R&&typeof R.range=="function"?R:P(I,M,R),H=q?q.range(I,+M+1):[];return F?H.reverse():H}function P(I,M,R){const F=Math.abs(M-I)/R,q=KC(([,,$])=>$).right(v,F);if(q===v.length)return e.every(GP(I/r2,M/r2,R));if(q===0)return G0.every(Math.max(GP(I,M,R),1));const[H,j]=v[F/v[q-1][2]<v[q][2]/F?q-1:q];return H.every(j)}return[i,P]}const[loe,coe]=A$(Mc,pO,nw,T$,dO,uO),[uoe,hoe]=A$(Oc,fO,rw,Fy,hO,cO);function n2(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function i2(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function p_(e,t,a){return{y:e,m:t,d:a,H:0,M:0,S:0,L:0}}function doe(e){var t=e.dateTime,a=e.date,l=e.time,d=e.periods,_=e.days,v=e.shortDays,i=e.months,P=e.shortMonths,I=m_(d),M=g_(d),R=m_(_),F=g_(_),q=m_(v),H=g_(v),j=m_(i),$=g_(i),Y=m_(P),K=g_(P),re={a:Pt,A:Ot,b:yt,B:ar,c:null,d:lF,e:lF,f:Noe,g:Goe,G:Woe,H:Roe,I:Doe,j:koe,L:E$,m:Loe,M:joe,p:qt,q:rr,Q:hF,s:dF,S:zoe,u:Foe,U:Boe,V:Uoe,w:Voe,W:$oe,x:null,X:null,y:qoe,Y:Hoe,Z:Zoe,"%":uF},se={a:Tr,A:an,b:An,B:Fr,c:null,d:cF,e:cF,f:Joe,g:lae,G:uae,H:Xoe,I:Koe,j:Yoe,L:I$,m:Qoe,M:eae,p:nr,q:Dr,Q:hF,s:dF,S:tae,u:rae,U:nae,V:iae,w:oae,W:aae,x:null,X:null,y:sae,Y:cae,Z:hae,"%":uF},J={a:rt,A:ke,b:Ze,B:nt,c:Je,d:aF,e:aF,f:Ioe,g:oF,G:iF,H:sF,I:sF,j:Toe,L:Poe,m:Soe,M:Aoe,p:Ne,q:woe,Q:Ooe,s:Moe,S:Eoe,u:_oe,U:yoe,V:voe,w:goe,W:xoe,x:ot,X:it,y:oF,Y:iF,Z:boe,"%":Coe};re.x=ae(a,re),re.X=ae(l,re),re.c=ae(t,re),se.x=ae(a,se),se.X=ae(l,se),se.c=ae(t,se);function ae(er,or){return function(br){var jt=[],bn=-1,Hr=0,Zr=er.length,ni,hi,Lo;for(br instanceof Date||(br=new Date(+br));++bn<Zr;)er.charCodeAt(bn)===37&&(jt.push(er.slice(Hr,bn)),(hi=nF[ni=er.charAt(++bn)])!=null?ni=er.charAt(++bn):hi=ni==="e"?" ":"0",(Lo=or[ni])&&(ni=Lo(br,hi)),jt.push(ni),Hr=bn+1);return jt.push(er.slice(Hr,bn)),jt.join("")}}function de(er,or){return function(br){var jt=p_(1900,void 0,1),bn=Pe(jt,er,br+="",0),Hr,Zr;if(bn!=br.length)return null;if("Q"in jt)return new Date(jt.Q);if("s"in jt)return new Date(jt.s*1e3+("L"in jt?jt.L:0));if(or&&!("Z"in jt)&&(jt.Z=0),"p"in jt&&(jt.H=jt.H%12+jt.p*12),jt.m===void 0&&(jt.m="q"in jt?jt.q:0),"V"in jt){if(jt.V<1||jt.V>53)return null;"w"in jt||(jt.w=1),"Z"in jt?(Hr=i2(p_(jt.y,0,1)),Zr=Hr.getUTCDay(),Hr=Zr>4||Zr===0?W0.ceil(Hr):W0(Hr),Hr=tw.offset(Hr,(jt.V-1)*7),jt.y=Hr.getUTCFullYear(),jt.m=Hr.getUTCMonth(),jt.d=Hr.getUTCDate()+(jt.w+6)%7):(Hr=n2(p_(jt.y,0,1)),Zr=Hr.getDay(),Hr=Zr>4||Zr===0?H0.ceil(Hr):H0(Hr),Hr=Fy.offset(Hr,(jt.V-1)*7),jt.y=Hr.getFullYear(),jt.m=Hr.getMonth(),jt.d=Hr.getDate()+(jt.w+6)%7)}else("W"in jt||"U"in jt)&&("w"in jt||(jt.w="u"in jt?jt.u%7:"W"in jt?1:0),Zr="Z"in jt?i2(p_(jt.y,0,1)).getUTCDay():n2(p_(jt.y,0,1)).getDay(),jt.m=0,jt.d="W"in jt?(jt.w+6)%7+jt.W*7-(Zr+5)%7:jt.w+jt.U*7-(Zr+6)%7);return"Z"in jt?(jt.H+=jt.Z/100|0,jt.M+=jt.Z%100,i2(jt)):n2(jt)}}function Pe(er,or,br,jt){for(var bn=0,Hr=or.length,Zr=br.length,ni,hi;bn<Hr;){if(jt>=Zr)return-1;if(ni=or.charCodeAt(bn++),ni===37){if(ni=or.charAt(bn++),hi=J[ni in nF?or.charAt(bn++):ni],!hi||(jt=hi(er,br,jt))<0)return-1}else if(ni!=br.charCodeAt(jt++))return-1}return jt}function Ne(er,or,br){var jt=I.exec(or.slice(br));return jt?(er.p=M.get(jt[0].toLowerCase()),br+jt[0].length):-1}function rt(er,or,br){var jt=q.exec(or.slice(br));return jt?(er.w=H.get(jt[0].toLowerCase()),br+jt[0].length):-1}function ke(er,or,br){var jt=R.exec(or.slice(br));return jt?(er.w=F.get(jt[0].toLowerCase()),br+jt[0].length):-1}function Ze(er,or,br){var jt=Y.exec(or.slice(br));return jt?(er.m=K.get(jt[0].toLowerCase()),br+jt[0].length):-1}function nt(er,or,br){var jt=j.exec(or.slice(br));return jt?(er.m=$.get(jt[0].toLowerCase()),br+jt[0].length):-1}function Je(er,or,br){return Pe(er,t,or,br)}function ot(er,or,br){return Pe(er,a,or,br)}function it(er,or,br){return Pe(er,l,or,br)}function Pt(er){return v[er.getDay()]}function Ot(er){return _[er.getDay()]}function yt(er){return P[er.getMonth()]}function ar(er){return i[er.getMonth()]}function qt(er){return d[+(er.getHours()>=12)]}function rr(er){return 1+~~(er.getMonth()/3)}function Tr(er){return v[er.getUTCDay()]}function an(er){return _[er.getUTCDay()]}function An(er){return P[er.getUTCMonth()]}function Fr(er){return i[er.getUTCMonth()]}function nr(er){return d[+(er.getUTCHours()>=12)]}function Dr(er){return 1+~~(er.getUTCMonth()/3)}return{format:function(er){var or=ae(er+="",re);return or.toString=function(){return er},or},parse:function(er){var or=de(er+="",!1);return or.toString=function(){return er},or},utcFormat:function(er){var or=ae(er+="",se);return or.toString=function(){return er},or},utcParse:function(er){var or=de(er+="",!0);return or.toString=function(){return er},or}}}var nF={"-":"",_:" ",0:"0"},Oo=/^\s*\d+/,foe=/^%/,poe=/[\\^$*+?|[\]().{}]/g;function ri(e,t,a){var l=e<0?"-":"",d=(l?-e:e)+"",_=d.length;return l+(_<a?new Array(a-_+1).join(t)+d:d)}function moe(e){return e.replace(poe,"\\$&")}function m_(e){return new RegExp("^(?:"+e.map(moe).join("|")+")","i")}function g_(e){return new Map(e.map((t,a)=>[t.toLowerCase(),a]))}function goe(e,t,a){var l=Oo.exec(t.slice(a,a+1));return l?(e.w=+l[0],a+l[0].length):-1}function _oe(e,t,a){var l=Oo.exec(t.slice(a,a+1));return l?(e.u=+l[0],a+l[0].length):-1}function yoe(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.U=+l[0],a+l[0].length):-1}function voe(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.V=+l[0],a+l[0].length):-1}function xoe(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.W=+l[0],a+l[0].length):-1}function iF(e,t,a){var l=Oo.exec(t.slice(a,a+4));return l?(e.y=+l[0],a+l[0].length):-1}function oF(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.y=+l[0]+(+l[0]>68?1900:2e3),a+l[0].length):-1}function boe(e,t,a){var l=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(a,a+6));return l?(e.Z=l[1]?0:-(l[2]+(l[3]||"00")),a+l[0].length):-1}function woe(e,t,a){var l=Oo.exec(t.slice(a,a+1));return l?(e.q=l[0]*3-3,a+l[0].length):-1}function Soe(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.m=l[0]-1,a+l[0].length):-1}function aF(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.d=+l[0],a+l[0].length):-1}function Toe(e,t,a){var l=Oo.exec(t.slice(a,a+3));return l?(e.m=0,e.d=+l[0],a+l[0].length):-1}function sF(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.H=+l[0],a+l[0].length):-1}function Aoe(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.M=+l[0],a+l[0].length):-1}function Eoe(e,t,a){var l=Oo.exec(t.slice(a,a+2));return l?(e.S=+l[0],a+l[0].length):-1}function Poe(e,t,a){var l=Oo.exec(t.slice(a,a+3));return l?(e.L=+l[0],a+l[0].length):-1}function Ioe(e,t,a){var l=Oo.exec(t.slice(a,a+6));return l?(e.L=Math.floor(l[0]/1e3),a+l[0].length):-1}function Coe(e,t,a){var l=foe.exec(t.slice(a,a+1));return l?a+l[0].length:-1}function Ooe(e,t,a){var l=Oo.exec(t.slice(a));return l?(e.Q=+l[0],a+l[0].length):-1}function Moe(e,t,a){var l=Oo.exec(t.slice(a));return l?(e.s=+l[0],a+l[0].length):-1}function lF(e,t){return ri(e.getDate(),t,2)}function Roe(e,t){return ri(e.getHours(),t,2)}function Doe(e,t){return ri(e.getHours()%12||12,t,2)}function koe(e,t){return ri(1+Fy.count(Oc(e),e),t,3)}function E$(e,t){return ri(e.getMilliseconds(),t,3)}function Noe(e,t){return E$(e,t)+"000"}function Loe(e,t){return ri(e.getMonth()+1,t,2)}function joe(e,t){return ri(e.getMinutes(),t,2)}function zoe(e,t){return ri(e.getSeconds(),t,2)}function Foe(e){var t=e.getDay();return t===0?7:t}function Boe(e,t){return ri(rw.count(Oc(e)-1,e),t,2)}function P$(e){var t=e.getDay();return t>=4||t===0?Mp(e):Mp.ceil(e)}function Uoe(e,t){return e=P$(e),ri(Mp.count(Oc(e),e)+(Oc(e).getDay()===4),t,2)}function Voe(e){return e.getDay()}function $oe(e,t){return ri(H0.count(Oc(e)-1,e),t,2)}function qoe(e,t){return ri(e.getFullYear()%100,t,2)}function Goe(e,t){return e=P$(e),ri(e.getFullYear()%100,t,2)}function Hoe(e,t){return ri(e.getFullYear()%1e4,t,4)}function Woe(e,t){var a=e.getDay();return e=a>=4||a===0?Mp(e):Mp.ceil(e),ri(e.getFullYear()%1e4,t,4)}function Zoe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ri(t/60|0,"0",2)+ri(t%60,"0",2)}function cF(e,t){return ri(e.getUTCDate(),t,2)}function Xoe(e,t){return ri(e.getUTCHours(),t,2)}function Koe(e,t){return ri(e.getUTCHours()%12||12,t,2)}function Yoe(e,t){return ri(1+tw.count(Mc(e),e),t,3)}function I$(e,t){return ri(e.getUTCMilliseconds(),t,3)}function Joe(e,t){return I$(e,t)+"000"}function Qoe(e,t){return ri(e.getUTCMonth()+1,t,2)}function eae(e,t){return ri(e.getUTCMinutes(),t,2)}function tae(e,t){return ri(e.getUTCSeconds(),t,2)}function rae(e){var t=e.getUTCDay();return t===0?7:t}function nae(e,t){return ri(nw.count(Mc(e)-1,e),t,2)}function C$(e){var t=e.getUTCDay();return t>=4||t===0?Rp(e):Rp.ceil(e)}function iae(e,t){return e=C$(e),ri(Rp.count(Mc(e),e)+(Mc(e).getUTCDay()===4),t,2)}function oae(e){return e.getUTCDay()}function aae(e,t){return ri(W0.count(Mc(e)-1,e),t,2)}function sae(e,t){return ri(e.getUTCFullYear()%100,t,2)}function lae(e,t){return e=C$(e),ri(e.getUTCFullYear()%100,t,2)}function cae(e,t){return ri(e.getUTCFullYear()%1e4,t,4)}function uae(e,t){var a=e.getUTCDay();return e=a>=4||a===0?Rp(e):Rp.ceil(e),ri(e.getUTCFullYear()%1e4,t,4)}function hae(){return"+0000"}function uF(){return"%"}function hF(e){return+e}function dF(e){return Math.floor(+e/1e3)}var np,O$,M$;dae({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function dae(e){return np=doe(e),O$=np.format,np.parse,M$=np.utcFormat,np.utcParse,np}function fae(e){return new Date(e)}function pae(e){return e instanceof Date?+e:+new Date(+e)}function mO(e,t,a,l,d,_,v,i,P,I){var M=tO(),R=M.invert,F=M.domain,q=I(".%L"),H=I(":%S"),j=I("%I:%M"),$=I("%I %p"),Y=I("%a %d"),K=I("%b %d"),re=I("%B"),se=I("%Y");function J(ae){return(P(ae)<ae?q:i(ae)<ae?H:v(ae)<ae?j:_(ae)<ae?$:l(ae)<ae?d(ae)<ae?Y:K:a(ae)<ae?re:se)(ae)}return M.invert=function(ae){return new Date(R(ae))},M.domain=function(ae){return arguments.length?F(Array.from(ae,pae)):F().map(fae)},M.ticks=function(ae){var de=F();return e(de[0],de[de.length-1],ae??10)},M.tickFormat=function(ae,de){return de==null?J:I(de)},M.nice=function(ae){var de=F();return(!ae||typeof ae.range!="function")&&(ae=t(de[0],de[de.length-1],ae??10)),ae?F(_$(de,ae)):M},M.copy=function(){return zy(M,mO(e,t,a,l,d,_,v,i,P,I))},M}function mae(){return gs.apply(mO(uoe,hoe,Oc,fO,rw,Fy,hO,cO,Qh,O$).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function gae(){return gs.apply(mO(loe,coe,Mc,pO,nw,tw,dO,uO,Qh,M$).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function iw(){var e=0,t=1,a,l,d,_,v=ua,i=!1,P;function I(R){return R==null||isNaN(R=+R)?P:v(d===0?.5:(R=(_(R)-a)*d,i?Math.max(0,Math.min(1,R)):R))}I.domain=function(R){return arguments.length?([e,t]=R,a=_(e=+e),l=_(t=+t),d=a===l?0:1/(l-a),I):[e,t]},I.clamp=function(R){return arguments.length?(i=!!R,I):i},I.interpolator=function(R){return arguments.length?(v=R,I):v};function M(R){return function(F){var q,H;return arguments.length?([q,H]=F,v=R(q,H),I):[v(0),v(1)]}}return I.range=M(cm),I.rangeRound=M(eO),I.unknown=function(R){return arguments.length?(P=R,I):P},function(R){return _=R,a=R(e),l=R(t),d=a===l?0:1/(l-a),I}}function qu(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function R$(){var e=$u(iw()(ua));return e.copy=function(){return qu(e,R$())},Nc.apply(e,arguments)}function D$(){var e=iO(iw()).domain([1,10]);return e.copy=function(){return qu(e,D$()).base(e.base())},Nc.apply(e,arguments)}function k$(){var e=oO(iw());return e.copy=function(){return qu(e,k$()).constant(e.constant())},Nc.apply(e,arguments)}function gO(){var e=aO(iw());return e.copy=function(){return qu(e,gO()).exponent(e.exponent())},Nc.apply(e,arguments)}function _ae(){return gO.apply(null,arguments).exponent(.5)}function N$(){var e=[],t=ua;function a(l){if(l!=null&&!isNaN(l=+l))return t((Ly(e,l,1)-1)/(e.length-1))}return a.domain=function(l){if(!arguments.length)return e.slice();e=[];for(let d of l)d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(Fu),a},a.interpolator=function(l){return arguments.length?(t=l,a):t},a.range=function(){return e.map((l,d)=>t(d/(e.length-1)))},a.quantiles=function(l){return Array.from({length:l+1},(d,_)=>nie(e,_/l))},a.copy=function(){return N$(t).domain(e)},Nc.apply(a,arguments)}function ow(){var e=0,t=.5,a=1,l=1,d,_,v,i,P,I=ua,M,R=!1,F;function q(j){return isNaN(j=+j)?F:(j=.5+((j=+M(j))-_)*(l*j<l*_?i:P),I(R?Math.max(0,Math.min(1,j)):j))}q.domain=function(j){return arguments.length?([e,t,a]=j,d=M(e=+e),_=M(t=+t),v=M(a=+a),i=d===_?0:.5/(_-d),P=_===v?0:.5/(v-_),l=_<d?-1:1,q):[e,t,a]},q.clamp=function(j){return arguments.length?(R=!!j,q):R},q.interpolator=function(j){return arguments.length?(I=j,q):I};function H(j){return function($){var Y,K,re;return arguments.length?([Y,K,re]=$,I=Cie(j,[Y,K,re]),q):[I(0),I(.5),I(1)]}}return q.range=H(cm),q.rangeRound=H(eO),q.unknown=function(j){return arguments.length?(F=j,q):F},function(j){return M=j,d=j(e),_=j(t),v=j(a),i=d===_?0:.5/(_-d),P=_===v?0:.5/(v-_),l=_<d?-1:1,q}}function L$(){var e=$u(ow()(ua));return e.copy=function(){return qu(e,L$())},Nc.apply(e,arguments)}function j$(){var e=iO(ow()).domain([.1,1,10]);return e.copy=function(){return qu(e,j$()).base(e.base())},Nc.apply(e,arguments)}function z$(){var e=oO(ow());return e.copy=function(){return qu(e,z$()).constant(e.constant())},Nc.apply(e,arguments)}function _O(){var e=aO(ow());return e.copy=function(){return qu(e,_O()).exponent(e.exponent())},Nc.apply(e,arguments)}function yae(){return _O.apply(null,arguments).exponent(.5)}const fF=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:J_,scaleDiverging:L$,scaleDivergingLog:j$,scaleDivergingPow:_O,scaleDivergingSqrt:yae,scaleDivergingSymlog:z$,scaleIdentity:g$,scaleImplicit:HP,scaleLinear:q0,scaleLog:y$,scaleOrdinal:YC,scalePoint:k_,scalePow:sO,scaleQuantile:b$,scaleQuantize:w$,scaleRadial:x$,scaleSequential:R$,scaleSequentialLog:D$,scaleSequentialPow:gO,scaleSequentialQuantile:N$,scaleSequentialSqrt:_ae,scaleSequentialSymlog:k$,scaleSqrt:Jie,scaleSymlog:v$,scaleThreshold:S$,scaleTime:mae,scaleUtc:gae,tickFormat:m$},Symbol.toStringTag,{value:"Module"}));var o2,pF;function aw(){if(pF)return o2;pF=1;var e=om();function t(a,l,d){for(var _=-1,v=a.length;++_<v;){var i=a[_],P=l(i);if(P!=null&&(I===void 0?P===P&&!e(P):d(P,I)))var I=P,M=i}return M}return o2=t,o2}var a2,mF;function F$(){if(mF)return a2;mF=1;function e(t,a){return t>a}return a2=e,a2}var s2,gF;function vae(){if(gF)return s2;gF=1;var e=aw(),t=F$(),a=lm();function l(d){return d&&d.length?e(d,a,t):void 0}return s2=l,s2}var xae=vae();const sw=si(xae);var l2,_F;function B$(){if(_F)return l2;_F=1;function e(t,a){return t<a}return l2=e,l2}var c2,yF;function bae(){if(yF)return c2;yF=1;var e=aw(),t=B$(),a=lm();function l(d){return d&&d.length?e(d,a,t):void 0}return c2=l,c2}var wae=bae();const lw=si(wae);var u2,vF;function Sae(){if(vF)return u2;vF=1;var e=DC(),t=Ll(),a=ZV(),l=_a();function d(_,v){var i=l(_)?e:a;return i(_,t(v,3))}return u2=d,u2}var h2,xF;function Tae(){if(xF)return h2;xF=1;var e=HV(),t=Sae();function a(l,d){return e(t(l,d),1)}return h2=a,h2}var Aae=Tae();const Eae=si(Aae);var d2,bF;function Pae(){if(bF)return d2;bF=1;var e=HC();function t(a,l){return e(a,l)}return d2=t,d2}var Iae=Pae();const By=si(Iae);var um=1e9,Cae={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},vO,Bi=!0,ms="[DecimalError] ",rd=ms+"Invalid argument: ",yO=ms+"Exponent out of range: ",hm=Math.floor,Zh=Math.pow,Oae=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ba,Eo=1e7,Di=7,U$=9007199254740991,Z0=hm(U$/Di),zr={};zr.absoluteValue=zr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};zr.comparedTo=zr.cmp=function(e){var t,a,l,d,_=this;if(e=new _.constructor(e),_.s!==e.s)return _.s||-e.s;if(_.e!==e.e)return _.e>e.e^_.s<0?1:-1;for(l=_.d.length,d=e.d.length,t=0,a=l<d?l:d;t<a;++t)if(_.d[t]!==e.d[t])return _.d[t]>e.d[t]^_.s<0?1:-1;return l===d?0:l>d^_.s<0?1:-1};zr.decimalPlaces=zr.dp=function(){var e=this,t=e.d.length-1,a=(t-e.e)*Di;if(t=e.d[t],t)for(;t%10==0;t/=10)a--;return a<0?0:a};zr.dividedBy=zr.div=function(e){return Tc(this,new this.constructor(e))};zr.dividedToIntegerBy=zr.idiv=function(e){var t=this,a=t.constructor;return yi(Tc(t,new a(e),0,1),a.precision)};zr.equals=zr.eq=function(e){return!this.cmp(e)};zr.exponent=function(){return io(this)};zr.greaterThan=zr.gt=function(e){return this.cmp(e)>0};zr.greaterThanOrEqualTo=zr.gte=function(e){return this.cmp(e)>=0};zr.isInteger=zr.isint=function(){return this.e>this.d.length-2};zr.isNegative=zr.isneg=function(){return this.s<0};zr.isPositive=zr.ispos=function(){return this.s>0};zr.isZero=function(){return this.s===0};zr.lessThan=zr.lt=function(e){return this.cmp(e)<0};zr.lessThanOrEqualTo=zr.lte=function(e){return this.cmp(e)<1};zr.logarithm=zr.log=function(e){var t,a=this,l=a.constructor,d=l.precision,_=d+5;if(e===void 0)e=new l(10);else if(e=new l(e),e.s<1||e.eq(Ba))throw Error(ms+"NaN");if(a.s<1)throw Error(ms+(a.s?"NaN":"-Infinity"));return a.eq(Ba)?new l(0):(Bi=!1,t=Tc(ny(a,_),ny(e,_),_),Bi=!0,yi(t,d))};zr.minus=zr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?q$(t,e):V$(t,(e.s=-e.s,e))};zr.modulo=zr.mod=function(e){var t,a=this,l=a.constructor,d=l.precision;if(e=new l(e),!e.s)throw Error(ms+"NaN");return a.s?(Bi=!1,t=Tc(a,e,0,1).times(e),Bi=!0,a.minus(t)):yi(new l(a),d)};zr.naturalExponential=zr.exp=function(){return $$(this)};zr.naturalLogarithm=zr.ln=function(){return ny(this)};zr.negated=zr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};zr.plus=zr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?V$(t,e):q$(t,(e.s=-e.s,e))};zr.precision=zr.sd=function(e){var t,a,l,d=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(rd+e);if(t=io(d)+1,l=d.d.length-1,a=l*Di+1,l=d.d[l],l){for(;l%10==0;l/=10)a--;for(l=d.d[0];l>=10;l/=10)a++}return e&&t>a?t:a};zr.squareRoot=zr.sqrt=function(){var e,t,a,l,d,_,v,i=this,P=i.constructor;if(i.s<1){if(!i.s)return new P(0);throw Error(ms+"NaN")}for(e=io(i),Bi=!1,d=Math.sqrt(+i),d==0||d==1/0?(t=Tl(i.d),(t.length+e)%2==0&&(t+="0"),d=Math.sqrt(t),e=hm((e+1)/2)-(e<0||e%2),d==1/0?t="5e"+e:(t=d.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),l=new P(t)):l=new P(d.toString()),a=P.precision,d=v=a+3;;)if(_=l,l=_.plus(Tc(i,_,v+2)).times(.5),Tl(_.d).slice(0,v)===(t=Tl(l.d)).slice(0,v)){if(t=t.slice(v-3,v+1),d==v&&t=="4999"){if(yi(_,a+1,0),_.times(_).eq(i)){l=_;break}}else if(t!="9999")break;v+=4}return Bi=!0,yi(l,a)};zr.times=zr.mul=function(e){var t,a,l,d,_,v,i,P,I,M=this,R=M.constructor,F=M.d,q=(e=new R(e)).d;if(!M.s||!e.s)return new R(0);for(e.s*=M.s,a=M.e+e.e,P=F.length,I=q.length,P<I&&(_=F,F=q,q=_,v=P,P=I,I=v),_=[],v=P+I,l=v;l--;)_.push(0);for(l=I;--l>=0;){for(t=0,d=P+l;d>l;)i=_[d]+q[l]*F[d-l-1]+t,_[d--]=i%Eo|0,t=i/Eo|0;_[d]=(_[d]+t)%Eo|0}for(;!_[--v];)_.pop();return t?++a:_.shift(),e.d=_,e.e=a,Bi?yi(e,R.precision):e};zr.toDecimalPlaces=zr.todp=function(e,t){var a=this,l=a.constructor;return a=new l(a),e===void 0?a:(Ml(e,0,um),t===void 0?t=l.rounding:Ml(t,0,8),yi(a,e+io(a)+1,t))};zr.toExponential=function(e,t){var a,l=this,d=l.constructor;return e===void 0?a=hd(l,!0):(Ml(e,0,um),t===void 0?t=d.rounding:Ml(t,0,8),l=yi(new d(l),e+1,t),a=hd(l,!0,e+1)),a};zr.toFixed=function(e,t){var a,l,d=this,_=d.constructor;return e===void 0?hd(d):(Ml(e,0,um),t===void 0?t=_.rounding:Ml(t,0,8),l=yi(new _(d),e+io(d)+1,t),a=hd(l.abs(),!1,e+io(l)+1),d.isneg()&&!d.isZero()?"-"+a:a)};zr.toInteger=zr.toint=function(){var e=this,t=e.constructor;return yi(new t(e),io(e)+1,t.rounding)};zr.toNumber=function(){return+this};zr.toPower=zr.pow=function(e){var t,a,l,d,_,v,i=this,P=i.constructor,I=12,M=+(e=new P(e));if(!e.s)return new P(Ba);if(i=new P(i),!i.s){if(e.s<1)throw Error(ms+"Infinity");return i}if(i.eq(Ba))return i;if(l=P.precision,e.eq(Ba))return yi(i,l);if(t=e.e,a=e.d.length-1,v=t>=a,_=i.s,v){if((a=M<0?-M:M)<=U$){for(d=new P(Ba),t=Math.ceil(l/Di+4),Bi=!1;a%2&&(d=d.times(i),SF(d.d,t)),a=hm(a/2),a!==0;)i=i.times(i),SF(i.d,t);return Bi=!0,e.s<0?new P(Ba).div(d):yi(d,l)}}else if(_<0)throw Error(ms+"NaN");return _=_<0&&e.d[Math.max(t,a)]&1?-1:1,i.s=1,Bi=!1,d=e.times(ny(i,l+I)),Bi=!0,d=$$(d),d.s=_,d};zr.toPrecision=function(e,t){var a,l,d=this,_=d.constructor;return e===void 0?(a=io(d),l=hd(d,a<=_.toExpNeg||a>=_.toExpPos)):(Ml(e,1,um),t===void 0?t=_.rounding:Ml(t,0,8),d=yi(new _(d),e,t),a=io(d),l=hd(d,e<=a||a<=_.toExpNeg,e)),l};zr.toSignificantDigits=zr.tosd=function(e,t){var a=this,l=a.constructor;return e===void 0?(e=l.precision,t=l.rounding):(Ml(e,1,um),t===void 0?t=l.rounding:Ml(t,0,8)),yi(new l(a),e,t)};zr.toString=zr.valueOf=zr.val=zr.toJSON=zr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=io(e),a=e.constructor;return hd(e,t<=a.toExpNeg||t>=a.toExpPos)};function V$(e,t){var a,l,d,_,v,i,P,I,M=e.constructor,R=M.precision;if(!e.s||!t.s)return t.s||(t=new M(e)),Bi?yi(t,R):t;if(P=e.d,I=t.d,v=e.e,d=t.e,P=P.slice(),_=v-d,_){for(_<0?(l=P,_=-_,i=I.length):(l=I,d=v,i=P.length),v=Math.ceil(R/Di),i=v>i?v+1:i+1,_>i&&(_=i,l.length=1),l.reverse();_--;)l.push(0);l.reverse()}for(i=P.length,_=I.length,i-_<0&&(_=i,l=I,I=P,P=l),a=0;_;)a=(P[--_]=P[_]+I[_]+a)/Eo|0,P[_]%=Eo;for(a&&(P.unshift(a),++d),i=P.length;P[--i]==0;)P.pop();return t.d=P,t.e=d,Bi?yi(t,R):t}function Ml(e,t,a){if(e!==~~e||e<t||e>a)throw Error(rd+e)}function Tl(e){var t,a,l,d=e.length-1,_="",v=e[0];if(d>0){for(_+=v,t=1;t<d;t++)l=e[t]+"",a=Di-l.length,a&&(_+=Ou(a)),_+=l;v=e[t],l=v+"",a=Di-l.length,a&&(_+=Ou(a))}else if(v===0)return"0";for(;v%10===0;)v/=10;return _+v}var Tc=(function(){function e(l,d){var _,v=0,i=l.length;for(l=l.slice();i--;)_=l[i]*d+v,l[i]=_%Eo|0,v=_/Eo|0;return v&&l.unshift(v),l}function t(l,d,_,v){var i,P;if(_!=v)P=_>v?1:-1;else for(i=P=0;i<_;i++)if(l[i]!=d[i]){P=l[i]>d[i]?1:-1;break}return P}function a(l,d,_){for(var v=0;_--;)l[_]-=v,v=l[_]<d[_]?1:0,l[_]=v*Eo+l[_]-d[_];for(;!l[0]&&l.length>1;)l.shift()}return function(l,d,_,v){var i,P,I,M,R,F,q,H,j,$,Y,K,re,se,J,ae,de,Pe,Ne=l.constructor,rt=l.s==d.s?1:-1,ke=l.d,Ze=d.d;if(!l.s)return new Ne(l);if(!d.s)throw Error(ms+"Division by zero");for(P=l.e-d.e,de=Ze.length,J=ke.length,q=new Ne(rt),H=q.d=[],I=0;Ze[I]==(ke[I]||0);)++I;if(Ze[I]>(ke[I]||0)&&--P,_==null?K=_=Ne.precision:v?K=_+(io(l)-io(d))+1:K=_,K<0)return new Ne(0);if(K=K/Di+2|0,I=0,de==1)for(M=0,Ze=Ze[0],K++;(I<J||M)&&K--;I++)re=M*Eo+(ke[I]||0),H[I]=re/Ze|0,M=re%Ze|0;else{for(M=Eo/(Ze[0]+1)|0,M>1&&(Ze=e(Ze,M),ke=e(ke,M),de=Ze.length,J=ke.length),se=de,j=ke.slice(0,de),$=j.length;$<de;)j[$++]=0;Pe=Ze.slice(),Pe.unshift(0),ae=Ze[0],Ze[1]>=Eo/2&&++ae;do M=0,i=t(Ze,j,de,$),i<0?(Y=j[0],de!=$&&(Y=Y*Eo+(j[1]||0)),M=Y/ae|0,M>1?(M>=Eo&&(M=Eo-1),R=e(Ze,M),F=R.length,$=j.length,i=t(R,j,F,$),i==1&&(M--,a(R,de<F?Pe:Ze,F))):(M==0&&(i=M=1),R=Ze.slice()),F=R.length,F<$&&R.unshift(0),a(j,R,$),i==-1&&($=j.length,i=t(Ze,j,de,$),i<1&&(M++,a(j,de<$?Pe:Ze,$))),$=j.length):i===0&&(M++,j=[0]),H[I++]=M,i&&j[0]?j[$++]=ke[se]||0:(j=[ke[se]],$=1);while((se++<J||j[0]!==void 0)&&K--)}return H[0]||H.shift(),q.e=P,yi(q,v?_+io(q)+1:_)}})();function $$(e,t){var a,l,d,_,v,i,P=0,I=0,M=e.constructor,R=M.precision;if(io(e)>16)throw Error(yO+io(e));if(!e.s)return new M(Ba);for(Bi=!1,i=R,v=new M(.03125);e.abs().gte(.1);)e=e.times(v),I+=5;for(l=Math.log(Zh(2,I))/Math.LN10*2+5|0,i+=l,a=d=_=new M(Ba),M.precision=i;;){if(d=yi(d.times(e),i),a=a.times(++P),v=_.plus(Tc(d,a,i)),Tl(v.d).slice(0,i)===Tl(_.d).slice(0,i)){for(;I--;)_=yi(_.times(_),i);return M.precision=R,t==null?(Bi=!0,yi(_,R)):_}_=v}}function io(e){for(var t=e.e*Di,a=e.d[0];a>=10;a/=10)t++;return t}function f2(e,t,a){if(t>e.LN10.sd())throw Bi=!0,a&&(e.precision=a),Error(ms+"LN10 precision limit exceeded");return yi(new e(e.LN10),t)}function Ou(e){for(var t="";e--;)t+="0";return t}function ny(e,t){var a,l,d,_,v,i,P,I,M,R=1,F=10,q=e,H=q.d,j=q.constructor,$=j.precision;if(q.s<1)throw Error(ms+(q.s?"NaN":"-Infinity"));if(q.eq(Ba))return new j(0);if(t==null?(Bi=!1,I=$):I=t,q.eq(10))return t==null&&(Bi=!0),f2(j,I);if(I+=F,j.precision=I,a=Tl(H),l=a.charAt(0),_=io(q),Math.abs(_)<15e14){for(;l<7&&l!=1||l==1&&a.charAt(1)>3;)q=q.times(e),a=Tl(q.d),l=a.charAt(0),R++;_=io(q),l>1?(q=new j("0."+a),_++):q=new j(l+"."+a.slice(1))}else return P=f2(j,I+2,$).times(_+""),q=ny(new j(l+"."+a.slice(1)),I-F).plus(P),j.precision=$,t==null?(Bi=!0,yi(q,$)):q;for(i=v=q=Tc(q.minus(Ba),q.plus(Ba),I),M=yi(q.times(q),I),d=3;;){if(v=yi(v.times(M),I),P=i.plus(Tc(v,new j(d),I)),Tl(P.d).slice(0,I)===Tl(i.d).slice(0,I))return i=i.times(2),_!==0&&(i=i.plus(f2(j,I+2,$).times(_+""))),i=Tc(i,new j(R),I),j.precision=$,t==null?(Bi=!0,yi(i,$)):i;i=P,d+=2}}function wF(e,t){var a,l,d;for((a=t.indexOf("."))>-1&&(t=t.replace(".","")),(l=t.search(/e/i))>0?(a<0&&(a=l),a+=+t.slice(l+1),t=t.substring(0,l)):a<0&&(a=t.length),l=0;t.charCodeAt(l)===48;)++l;for(d=t.length;t.charCodeAt(d-1)===48;)--d;if(t=t.slice(l,d),t){if(d-=l,a=a-l-1,e.e=hm(a/Di),e.d=[],l=(a+1)%Di,a<0&&(l+=Di),l<d){for(l&&e.d.push(+t.slice(0,l)),d-=Di;l<d;)e.d.push(+t.slice(l,l+=Di));t=t.slice(l),l=Di-t.length}else l-=d;for(;l--;)t+="0";if(e.d.push(+t),Bi&&(e.e>Z0||e.e<-Z0))throw Error(yO+a)}else e.s=0,e.e=0,e.d=[0];return e}function yi(e,t,a){var l,d,_,v,i,P,I,M,R=e.d;for(v=1,_=R[0];_>=10;_/=10)v++;if(l=t-v,l<0)l+=Di,d=t,I=R[M=0];else{if(M=Math.ceil((l+1)/Di),_=R.length,M>=_)return e;for(I=_=R[M],v=1;_>=10;_/=10)v++;l%=Di,d=l-Di+v}if(a!==void 0&&(_=Zh(10,v-d-1),i=I/_%10|0,P=t<0||R[M+1]!==void 0||I%_,P=a<4?(i||P)&&(a==0||a==(e.s<0?3:2)):i>5||i==5&&(a==4||P||a==6&&(l>0?d>0?I/Zh(10,v-d):0:R[M-1])%10&1||a==(e.s<0?8:7))),t<1||!R[0])return P?(_=io(e),R.length=1,t=t-_-1,R[0]=Zh(10,(Di-t%Di)%Di),e.e=hm(-t/Di)||0):(R.length=1,R[0]=e.e=e.s=0),e;if(l==0?(R.length=M,_=1,M--):(R.length=M+1,_=Zh(10,Di-l),R[M]=d>0?(I/Zh(10,v-d)%Zh(10,d)|0)*_:0),P)for(;;)if(M==0){(R[0]+=_)==Eo&&(R[0]=1,++e.e);break}else{if(R[M]+=_,R[M]!=Eo)break;R[M--]=0,_=1}for(l=R.length;R[--l]===0;)R.pop();if(Bi&&(e.e>Z0||e.e<-Z0))throw Error(yO+io(e));return e}function q$(e,t){var a,l,d,_,v,i,P,I,M,R,F=e.constructor,q=F.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new F(e),Bi?yi(t,q):t;if(P=e.d,R=t.d,l=t.e,I=e.e,P=P.slice(),v=I-l,v){for(M=v<0,M?(a=P,v=-v,i=R.length):(a=R,l=I,i=P.length),d=Math.max(Math.ceil(q/Di),i)+2,v>d&&(v=d,a.length=1),a.reverse(),d=v;d--;)a.push(0);a.reverse()}else{for(d=P.length,i=R.length,M=d<i,M&&(i=d),d=0;d<i;d++)if(P[d]!=R[d]){M=P[d]<R[d];break}v=0}for(M&&(a=P,P=R,R=a,t.s=-t.s),i=P.length,d=R.length-i;d>0;--d)P[i++]=0;for(d=R.length;d>v;){if(P[--d]<R[d]){for(_=d;_&&P[--_]===0;)P[_]=Eo-1;--P[_],P[d]+=Eo}P[d]-=R[d]}for(;P[--i]===0;)P.pop();for(;P[0]===0;P.shift())--l;return P[0]?(t.d=P,t.e=l,Bi?yi(t,q):t):new F(0)}function hd(e,t,a){var l,d=io(e),_=Tl(e.d),v=_.length;return t?(a&&(l=a-v)>0?_=_.charAt(0)+"."+_.slice(1)+Ou(l):v>1&&(_=_.charAt(0)+"."+_.slice(1)),_=_+(d<0?"e":"e+")+d):d<0?(_="0."+Ou(-d-1)+_,a&&(l=a-v)>0&&(_+=Ou(l))):d>=v?(_+=Ou(d+1-v),a&&(l=a-d-1)>0&&(_=_+"."+Ou(l))):((l=d+1)<v&&(_=_.slice(0,l)+"."+_.slice(l)),a&&(l=a-v)>0&&(d+1===v&&(_+="."),_+=Ou(l))),e.s<0?"-"+_:_}function SF(e,t){if(e.length>t)return e.length=t,!0}function G$(e){var t,a,l;function d(_){var v=this;if(!(v instanceof d))return new d(_);if(v.constructor=d,_ instanceof d){v.s=_.s,v.e=_.e,v.d=(_=_.d)?_.slice():_;return}if(typeof _=="number"){if(_*0!==0)throw Error(rd+_);if(_>0)v.s=1;else if(_<0)_=-_,v.s=-1;else{v.s=0,v.e=0,v.d=[0];return}if(_===~~_&&_<1e7){v.e=0,v.d=[_];return}return wF(v,_.toString())}else if(typeof _!="string")throw Error(rd+_);if(_.charCodeAt(0)===45?(_=_.slice(1),v.s=-1):v.s=1,Oae.test(_))wF(v,_);else throw Error(rd+_)}if(d.prototype=zr,d.ROUND_UP=0,d.ROUND_DOWN=1,d.ROUND_CEIL=2,d.ROUND_FLOOR=3,d.ROUND_HALF_UP=4,d.ROUND_HALF_DOWN=5,d.ROUND_HALF_EVEN=6,d.ROUND_HALF_CEIL=7,d.ROUND_HALF_FLOOR=8,d.clone=G$,d.config=d.set=Mae,e===void 0&&(e={}),e)for(l=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<l.length;)e.hasOwnProperty(a=l[t++])||(e[a]=this[a]);return d.config(e),d}function Mae(e){if(!e||typeof e!="object")throw Error(ms+"Object expected");var t,a,l,d=["precision",1,um,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<d.length;t+=3)if((l=e[a=d[t]])!==void 0)if(hm(l)===l&&l>=d[t+1]&&l<=d[t+2])this[a]=l;else throw Error(rd+a+": "+l);if((l=e[a="LN10"])!==void 0)if(l==Math.LN10)this[a]=new this(l);else throw Error(rd+a+": "+l);return this}var vO=G$(Cae);Ba=new vO(1);const gi=vO;function Rae(e){return Lae(e)||Nae(e)||kae(e)||Dae()}function Dae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kae(e,t){if(e){if(typeof e=="string")return KP(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return KP(e,t)}}function Nae(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function Lae(e){if(Array.isArray(e))return KP(e)}function KP(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}var jae=function(t){return t},H$={},W$=function(t){return t===H$},TF=function(t){return function a(){return arguments.length===0||arguments.length===1&&W$(arguments.length<=0?void 0:arguments[0])?a:t.apply(void 0,arguments)}},zae=function e(t,a){return t===1?a:TF(function(){for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];var v=d.filter(function(i){return i!==H$}).length;return v>=t?a.apply(void 0,d):e(t-v,TF(function(){for(var i=arguments.length,P=new Array(i),I=0;I<i;I++)P[I]=arguments[I];var M=d.map(function(R){return W$(R)?P.shift():R});return a.apply(void 0,Rae(M).concat(P))}))})},cw=function(t){return zae(t.length,t)},YP=function(t,a){for(var l=[],d=t;d<a;++d)l[d-t]=d;return l},Fae=cw(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(a){return t[a]}).map(e)}),Bae=function(){for(var t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];if(!a.length)return jae;var d=a.reverse(),_=d[0],v=d.slice(1);return function(){return v.reduce(function(i,P){return P(i)},_.apply(void 0,arguments))}},JP=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},Z$=function(t){var a=null,l=null;return function(){for(var d=arguments.length,_=new Array(d),v=0;v<d;v++)_[v]=arguments[v];return a&&_.every(function(i,P){return i===a[P]})||(a=_,l=t.apply(void 0,_)),l}};function Uae(e){var t;return e===0?t=1:t=Math.floor(new gi(e).abs().log(10).toNumber())+1,t}function Vae(e,t,a){for(var l=new gi(e),d=0,_=[];l.lt(t)&&d<1e5;)_.push(l.toNumber()),l=l.add(a),d++;return _}var $ae=cw(function(e,t,a){var l=+e,d=+t;return l+a*(d-l)}),qae=cw(function(e,t,a){var l=t-+e;return l=l||1/0,(a-e)/l}),Gae=cw(function(e,t,a){var l=t-+e;return l=l||1/0,Math.max(0,Math.min(1,(a-e)/l))});const uw={rangeStep:Vae,getDigitCount:Uae,interpolateNumber:$ae,uninterpolateNumber:qae,uninterpolateTruncation:Gae};function QP(e){return Zae(e)||Wae(e)||X$(e)||Hae()}function Hae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wae(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function Zae(e){if(Array.isArray(e))return eI(e)}function iy(e,t){return Yae(e)||Kae(e,t)||X$(e,t)||Xae()}function Xae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X$(e,t){if(e){if(typeof e=="string")return eI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return eI(e,t)}}function eI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Kae(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var a=[],l=!0,d=!1,_=void 0;try{for(var v=e[Symbol.iterator](),i;!(l=(i=v.next()).done)&&(a.push(i.value),!(t&&a.length===t));l=!0);}catch(P){d=!0,_=P}finally{try{!l&&v.return!=null&&v.return()}finally{if(d)throw _}}return a}}function Yae(e){if(Array.isArray(e))return e}function K$(e){var t=iy(e,2),a=t[0],l=t[1],d=a,_=l;return a>l&&(d=l,_=a),[d,_]}function Y$(e,t,a){if(e.lte(0))return new gi(0);var l=uw.getDigitCount(e.toNumber()),d=new gi(10).pow(l),_=e.div(d),v=l!==1?.05:.1,i=new gi(Math.ceil(_.div(v).toNumber())).add(a).mul(v),P=i.mul(d);return t?P:new gi(Math.ceil(P))}function Jae(e,t,a){var l=1,d=new gi(e);if(!d.isint()&&a){var _=Math.abs(e);_<1?(l=new gi(10).pow(uw.getDigitCount(e)-1),d=new gi(Math.floor(d.div(l).toNumber())).mul(l)):_>1&&(d=new gi(Math.floor(e)))}else e===0?d=new gi(Math.floor((t-1)/2)):a||(d=new gi(Math.floor(e)));var v=Math.floor((t-1)/2),i=Bae(Fae(function(P){return d.add(new gi(P-v).mul(l)).toNumber()}),YP);return i(0,t)}function J$(e,t,a,l){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(a-1)))return{step:new gi(0),tickMin:new gi(0),tickMax:new gi(0)};var _=Y$(new gi(t).sub(e).div(a-1),l,d),v;e<=0&&t>=0?v=new gi(0):(v=new gi(e).add(t).div(2),v=v.sub(new gi(v).mod(_)));var i=Math.ceil(v.sub(e).div(_).toNumber()),P=Math.ceil(new gi(t).sub(v).div(_).toNumber()),I=i+P+1;return I>a?J$(e,t,a,l,d+1):(I<a&&(P=t>0?P+(a-I):P,i=t>0?i:i+(a-I)),{step:_,tickMin:v.sub(new gi(i).mul(_)),tickMax:v.add(new gi(P).mul(_))})}function Qae(e){var t=iy(e,2),a=t[0],l=t[1],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,v=Math.max(d,2),i=K$([a,l]),P=iy(i,2),I=P[0],M=P[1];if(I===-1/0||M===1/0){var R=M===1/0?[I].concat(QP(YP(0,d-1).map(function(){return 1/0}))):[].concat(QP(YP(0,d-1).map(function(){return-1/0})),[M]);return a>l?JP(R):R}if(I===M)return Jae(I,d,_);var F=J$(I,M,v,_),q=F.step,H=F.tickMin,j=F.tickMax,$=uw.rangeStep(H,j.add(new gi(.1).mul(q)),q);return a>l?JP($):$}function ese(e,t){var a=iy(e,2),l=a[0],d=a[1],_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,v=K$([l,d]),i=iy(v,2),P=i[0],I=i[1];if(P===-1/0||I===1/0)return[l,d];if(P===I)return[P];var M=Math.max(t,2),R=Y$(new gi(I).sub(P).div(M-1),_,0),F=[].concat(QP(uw.rangeStep(new gi(P),new gi(I).sub(new gi(.99).mul(R)),R)),[I]);return l>d?JP(F):F}var tse=Z$(Qae),rse=Z$(ese),nse="Invariant failed";function dd(e,t){throw new Error(nse)}var ise=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Dp(e){"@babel/helpers - typeof";return Dp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dp(e)}function X0(){return X0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},X0.apply(this,arguments)}function ose(e,t){return cse(e)||lse(e,t)||sse(e,t)||ase()}function ase(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sse(e,t){if(e){if(typeof e=="string")return AF(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AF(e,t)}}function AF(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function lse(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function cse(e){if(Array.isArray(e))return e}function use(e,t){if(e==null)return{};var a=hse(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function hse(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function dse(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fse(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,t6(l.key),l)}}function pse(e,t,a){return t&&fse(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function mse(e,t,a){return t=K0(t),gse(e,Q$()?Reflect.construct(t,a||[],K0(e).constructor):t.apply(e,a))}function gse(e,t){if(t&&(Dp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _se(e)}function _se(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q$(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Q$=function(){return!!e})()}function K0(e){return K0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},K0(e)}function yse(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tI(e,t)}function tI(e,t){return tI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},tI(e,t)}function e6(e,t,a){return t=t6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function t6(e){var t=vse(e,"string");return Dp(t)=="symbol"?t:t+""}function vse(e,t){if(Dp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Dp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Uy=(function(e){function t(){return dse(this,t),mse(this,t,arguments)}return yse(t,e),pse(t,[{key:"render",value:function(){var l=this.props,d=l.offset,_=l.layout,v=l.width,i=l.dataKey,P=l.data,I=l.dataPointFormatter,M=l.xAxis,R=l.yAxis,F=use(l,ise),q=Jr(F,!1);this.props.direction==="x"&&M.type!=="number"&&dd();var H=P.map(function(j){var $=I(j,i),Y=$.x,K=$.y,re=$.value,se=$.errorVal;if(!se)return null;var J=[],ae,de;if(Array.isArray(se)){var Pe=ose(se,2);ae=Pe[0],de=Pe[1]}else ae=de=se;if(_==="vertical"){var Ne=M.scale,rt=K+d,ke=rt+v,Ze=rt-v,nt=Ne(re-ae),Je=Ne(re+de);J.push({x1:Je,y1:ke,x2:Je,y2:Ze}),J.push({x1:nt,y1:rt,x2:Je,y2:rt}),J.push({x1:nt,y1:ke,x2:nt,y2:Ze})}else if(_==="horizontal"){var ot=R.scale,it=Y+d,Pt=it-v,Ot=it+v,yt=ot(re-ae),ar=ot(re+de);J.push({x1:Pt,y1:ar,x2:Ot,y2:ar}),J.push({x1:it,y1:yt,x2:it,y2:ar}),J.push({x1:Pt,y1:yt,x2:Ot,y2:yt})}return He.createElement(ti,X0({className:"recharts-errorBar",key:"bar-".concat(J.map(function(qt){return"".concat(qt.x1,"-").concat(qt.x2,"-").concat(qt.y1,"-").concat(qt.y2)}))},q),J.map(function(qt){return He.createElement("line",X0({},qt,{key:"line-".concat(qt.x1,"-").concat(qt.x2,"-").concat(qt.y1,"-").concat(qt.y2)}))}))});return He.createElement(ti,{className:"recharts-errorBars"},H)}}])})(He.Component);e6(Uy,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});e6(Uy,"displayName","ErrorBar");function oy(e){"@babel/helpers - typeof";return oy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oy(e)}function EF(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function qh(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?EF(Object(a),!0).forEach(function(l){xse(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):EF(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function xse(e,t,a){return t=bse(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function bse(e){var t=wse(e,"string");return oy(t)=="symbol"?t:t+""}function wse(e,t){if(oy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(oy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var r6=function(t){var a=t.children,l=t.formattedGraphicalItems,d=t.legendWidth,_=t.legendContent,v=Na(a,Sc);if(!v)return null;var i=Sc.defaultProps,P=i!==void 0?qh(qh({},i),v.props):{},I;return v.props&&v.props.payload?I=v.props&&v.props.payload:_==="children"?I=(l||[]).reduce(function(M,R){var F=R.item,q=R.props,H=q.sectors||q.data||[];return M.concat(H.map(function(j){return{type:v.props.iconType||F.props.legendType,value:j.name,color:j.fill,payload:j}}))},[]):I=(l||[]).map(function(M){var R=M.item,F=R.type.defaultProps,q=F!==void 0?qh(qh({},F),R.props):{},H=q.dataKey,j=q.name,$=q.legendType,Y=q.hide;return{inactive:Y,dataKey:H,type:P.iconType||$||"square",color:xO(R),value:j||H,payload:q}}),qh(qh(qh({},P),Sc.getWithHeight(v,d)),{},{payload:I,item:v})};function ay(e){"@babel/helpers - typeof";return ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ay(e)}function PF(e){return Ese(e)||Ase(e)||Tse(e)||Sse()}function Sse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tse(e,t){if(e){if(typeof e=="string")return rI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rI(e,t)}}function Ase(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ese(e){if(Array.isArray(e))return rI(e)}function rI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function IF(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Wi(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?IF(Object(a),!0).forEach(function(l){xp(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):IF(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function xp(e,t,a){return t=Pse(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Pse(e){var t=Ise(e,"string");return ay(t)=="symbol"?t:t+""}function Ise(e,t){if(ay(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(ay(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mo(e,t,a){return xn(e)||xn(t)?a:go(t)?Va(e,t,a):pn(t)?t(e):a}function N_(e,t,a,l){var d=Eae(e,function(i){return mo(i,t)});if(a==="number"){var _=d.filter(function(i){return fr(i)||parseFloat(i)});return _.length?[lw(_),sw(_)]:[1/0,-1/0]}var v=l?d.filter(function(i){return!xn(i)}):d;return v.map(function(i){return go(i)||i instanceof Date?i:""})}var Cse=function(t){var a,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],d=arguments.length>2?arguments[2]:void 0,_=arguments.length>3?arguments[3]:void 0,v=-1,i=(a=l?.length)!==null&&a!==void 0?a:0;if(i<=1)return 0;if(_&&_.axisType==="angleAxis"&&Math.abs(Math.abs(_.range[1]-_.range[0])-360)<=1e-6)for(var P=_.range,I=0;I<i;I++){var M=I>0?d[I-1].coordinate:d[i-1].coordinate,R=d[I].coordinate,F=I>=i-1?d[0].coordinate:d[I+1].coordinate,q=void 0;if(la(R-M)!==la(F-R)){var H=[];if(la(F-R)===la(P[1]-P[0])){q=F;var j=R+P[1]-P[0];H[0]=Math.min(j,(j+M)/2),H[1]=Math.max(j,(j+M)/2)}else{q=M;var $=F+P[1]-P[0];H[0]=Math.min(R,($+R)/2),H[1]=Math.max(R,($+R)/2)}var Y=[Math.min(R,(q+R)/2),Math.max(R,(q+R)/2)];if(t>Y[0]&&t<=Y[1]||t>=H[0]&&t<=H[1]){v=d[I].index;break}}else{var K=Math.min(M,F),re=Math.max(M,F);if(t>(K+R)/2&&t<=(re+R)/2){v=d[I].index;break}}}else for(var se=0;se<i;se++)if(se===0&&t<=(l[se].coordinate+l[se+1].coordinate)/2||se>0&&se<i-1&&t>(l[se].coordinate+l[se-1].coordinate)/2&&t<=(l[se].coordinate+l[se+1].coordinate)/2||se===i-1&&t>(l[se].coordinate+l[se-1].coordinate)/2){v=l[se].index;break}return v},xO=function(t){var a,l=t,d=l.type.displayName,_=(a=t.type)!==null&&a!==void 0&&a.defaultProps?Wi(Wi({},t.type.defaultProps),t.props):t.props,v=_.stroke,i=_.fill,P;switch(d){case"Line":P=v;break;case"Area":case"Radar":P=v&&v!=="none"?v:i;break;default:P=i;break}return P},Ose=function(t){var a=t.barSize,l=t.totalSize,d=t.stackGroups,_=d===void 0?{}:d;if(!_)return{};for(var v={},i=Object.keys(_),P=0,I=i.length;P<I;P++)for(var M=_[i[P]].stackGroups,R=Object.keys(M),F=0,q=R.length;F<q;F++){var H=M[R[F]],j=H.items,$=H.cateAxisId,Y=j.filter(function(de){return wc(de.type).indexOf("Bar")>=0});if(Y&&Y.length){var K=Y[0].type.defaultProps,re=K!==void 0?Wi(Wi({},K),Y[0].props):Y[0].props,se=re.barSize,J=re[$];v[J]||(v[J]=[]);var ae=xn(se)?a:se;v[J].push({item:Y[0],stackList:Y.slice(1),barSize:xn(ae)?void 0:ca(ae,l,0)})}}return v},Mse=function(t){var a=t.barGap,l=t.barCategoryGap,d=t.bandSize,_=t.sizeList,v=_===void 0?[]:_,i=t.maxBarSize,P=v.length;if(P<1)return null;var I=ca(a,d,0,!0),M,R=[];if(v[0].barSize===+v[0].barSize){var F=!1,q=d/P,H=v.reduce(function(se,J){return se+J.barSize||0},0);H+=(P-1)*I,H>=d&&(H-=(P-1)*I,I=0),H>=d&&q>0&&(F=!0,q*=.9,H=P*q);var j=(d-H)/2>>0,$={offset:j-I,size:0};M=v.reduce(function(se,J){var ae={item:J.item,position:{offset:$.offset+$.size+I,size:F?q:J.barSize}},de=[].concat(PF(se),[ae]);return $=de[de.length-1].position,J.stackList&&J.stackList.length&&J.stackList.forEach(function(Pe){de.push({item:Pe,position:$})}),de},R)}else{var Y=ca(l,d,0,!0);d-2*Y-(P-1)*I<=0&&(I=0);var K=(d-2*Y-(P-1)*I)/P;K>1&&(K>>=0);var re=i===+i?Math.min(K,i):K;M=v.reduce(function(se,J,ae){var de=[].concat(PF(se),[{item:J.item,position:{offset:Y+(K+I)*ae+(K-re)/2,size:re}}]);return J.stackList&&J.stackList.length&&J.stackList.forEach(function(Pe){de.push({item:Pe,position:de[de.length-1].position})}),de},R)}return M},Rse=function(t,a,l,d){var _=l.children,v=l.width,i=l.margin,P=v-(i.left||0)-(i.right||0),I=r6({children:_,legendWidth:P});if(I){var M=d||{},R=M.width,F=M.height,q=I.align,H=I.verticalAlign,j=I.layout;if((j==="vertical"||j==="horizontal"&&H==="middle")&&q!=="center"&&fr(t[q]))return Wi(Wi({},t),{},xp({},q,t[q]+(R||0)));if((j==="horizontal"||j==="vertical"&&q==="center")&&H!=="middle"&&fr(t[H]))return Wi(Wi({},t),{},xp({},H,t[H]+(F||0)))}return t},Dse=function(t,a,l){return xn(a)?!0:t==="horizontal"?a==="yAxis":t==="vertical"||l==="x"?a==="xAxis":l==="y"?a==="yAxis":!0},n6=function(t,a,l,d,_){var v=a.props.children,i=$a(v,Uy).filter(function(I){return Dse(d,_,I.props.direction)});if(i&&i.length){var P=i.map(function(I){return I.props.dataKey});return t.reduce(function(I,M){var R=mo(M,l);if(xn(R))return I;var F=Array.isArray(R)?[lw(R),sw(R)]:[R,R],q=P.reduce(function(H,j){var $=mo(M,j,0),Y=F[0]-Math.abs(Array.isArray($)?$[0]:$),K=F[1]+Math.abs(Array.isArray($)?$[1]:$);return[Math.min(Y,H[0]),Math.max(K,H[1])]},[1/0,-1/0]);return[Math.min(q[0],I[0]),Math.max(q[1],I[1])]},[1/0,-1/0])}return null},kse=function(t,a,l,d,_){var v=a.map(function(i){return n6(t,i,l,_,d)}).filter(function(i){return!xn(i)});return v&&v.length?v.reduce(function(i,P){return[Math.min(i[0],P[0]),Math.max(i[1],P[1])]},[1/0,-1/0]):null},i6=function(t,a,l,d,_){var v=a.map(function(P){var I=P.props.dataKey;return l==="number"&&I&&n6(t,P,I,d)||N_(t,I,l,_)});if(l==="number")return v.reduce(function(P,I){return[Math.min(P[0],I[0]),Math.max(P[1],I[1])]},[1/0,-1/0]);var i={};return v.reduce(function(P,I){for(var M=0,R=I.length;M<R;M++)i[I[M]]||(i[I[M]]=!0,P.push(I[M]));return P},[])},o6=function(t,a){return t==="horizontal"&&a==="xAxis"||t==="vertical"&&a==="yAxis"||t==="centric"&&a==="angleAxis"||t==="radial"&&a==="radiusAxis"},a6=function(t,a,l,d){if(d)return t.map(function(P){return P.coordinate});var _,v,i=t.map(function(P){return P.coordinate===a&&(_=!0),P.coordinate===l&&(v=!0),P.coordinate});return _||i.push(a),v||i.push(l),i},xc=function(t,a,l){if(!t)return null;var d=t.scale,_=t.duplicateDomain,v=t.type,i=t.range,P=t.realScaleType==="scaleBand"?d.bandwidth()/2:2,I=(a||l)&&v==="category"&&d.bandwidth?d.bandwidth()/P:0;if(I=t.axisType==="angleAxis"&&i?.length>=2?la(i[0]-i[1])*2*I:I,a&&(t.ticks||t.niceTicks)){var M=(t.ticks||t.niceTicks).map(function(R){var F=_?_.indexOf(R):R;return{coordinate:d(F)+I,value:R,offset:I}});return M.filter(function(R){return!ky(R.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(R,F){return{coordinate:d(R)+I,value:R,index:F,offset:I}}):d.ticks&&!l?d.ticks(t.tickCount).map(function(R){return{coordinate:d(R)+I,value:R,offset:I}}):d.domain().map(function(R,F){return{coordinate:d(R)+I,value:_?_[R]:R,index:F,offset:I}})},p2=new WeakMap,e0=function(t,a){if(typeof a!="function")return t;p2.has(t)||p2.set(t,new WeakMap);var l=p2.get(t);if(l.has(a))return l.get(a);var d=function(){t.apply(void 0,arguments),a.apply(void 0,arguments)};return l.set(a,d),d},s6=function(t,a,l){var d=t.scale,_=t.type,v=t.layout,i=t.axisType;if(d==="auto")return v==="radial"&&i==="radiusAxis"?{scale:J_(),realScaleType:"band"}:v==="radial"&&i==="angleAxis"?{scale:q0(),realScaleType:"linear"}:_==="category"&&a&&(a.indexOf("LineChart")>=0||a.indexOf("AreaChart")>=0||a.indexOf("ComposedChart")>=0&&!l)?{scale:k_(),realScaleType:"point"}:_==="category"?{scale:J_(),realScaleType:"band"}:{scale:q0(),realScaleType:"linear"};if(ld(d)){var P="scale".concat(Wb(d));return{scale:(fF[P]||k_)(),realScaleType:fF[P]?P:"point"}}return pn(d)?{scale:d}:{scale:k_(),realScaleType:"point"}},CF=1e-4,l6=function(t){var a=t.domain();if(!(!a||a.length<=2)){var l=a.length,d=t.range(),_=Math.min(d[0],d[1])-CF,v=Math.max(d[0],d[1])+CF,i=t(a[0]),P=t(a[l-1]);(i<_||i>v||P<_||P>v)&&t.domain([a[0],a[l-1]])}},Nse=function(t,a){if(!t)return null;for(var l=0,d=t.length;l<d;l++)if(t[l].item===a)return t[l].position;return null},Lse=function(t,a){if(!a||a.length!==2||!fr(a[0])||!fr(a[1]))return t;var l=Math.min(a[0],a[1]),d=Math.max(a[0],a[1]),_=[t[0],t[1]];return(!fr(t[0])||t[0]<l)&&(_[0]=l),(!fr(t[1])||t[1]>d)&&(_[1]=d),_[0]>d&&(_[0]=d),_[1]<l&&(_[1]=l),_},jse=function(t){var a=t.length;if(!(a<=0))for(var l=0,d=t[0].length;l<d;++l)for(var _=0,v=0,i=0;i<a;++i){var P=ky(t[i][l][1])?t[i][l][0]:t[i][l][1];P>=0?(t[i][l][0]=_,t[i][l][1]=_+P,_=t[i][l][1]):(t[i][l][0]=v,t[i][l][1]=v+P,v=t[i][l][1])}},zse=function(t){var a=t.length;if(!(a<=0))for(var l=0,d=t[0].length;l<d;++l)for(var _=0,v=0;v<a;++v){var i=ky(t[v][l][1])?t[v][l][0]:t[v][l][1];i>=0?(t[v][l][0]=_,t[v][l][1]=_+i,_=t[v][l][1]):(t[v][l][0]=0,t[v][l][1]=0)}},Fse={sign:jse,expand:Eee,none:Ap,silhouette:Pee,wiggle:Iee,positive:zse},Bse=function(t,a,l){var d=a.map(function(i){return i.props.dataKey}),_=Fse[l],v=Aee().keys(d).value(function(i,P){return+mo(i,P,0)}).order(RP).offset(_);return v(t)},Use=function(t,a,l,d,_,v){if(!t)return null;var i=v?a.reverse():a,P={},I=i.reduce(function(R,F){var q,H=(q=F.type)!==null&&q!==void 0&&q.defaultProps?Wi(Wi({},F.type.defaultProps),F.props):F.props,j=H.stackId,$=H.hide;if($)return R;var Y=H[l],K=R[Y]||{hasStack:!1,stackGroups:{}};if(go(j)){var re=K.stackGroups[j]||{numericAxisId:l,cateAxisId:d,items:[]};re.items.push(F),K.hasStack=!0,K.stackGroups[j]=re}else K.stackGroups[sm("_stackId_")]={numericAxisId:l,cateAxisId:d,items:[F]};return Wi(Wi({},R),{},xp({},Y,K))},P),M={};return Object.keys(I).reduce(function(R,F){var q=I[F];if(q.hasStack){var H={};q.stackGroups=Object.keys(q.stackGroups).reduce(function(j,$){var Y=q.stackGroups[$];return Wi(Wi({},j),{},xp({},$,{numericAxisId:l,cateAxisId:d,items:Y.items,stackedData:Bse(t,Y.items,_)}))},H)}return Wi(Wi({},R),{},xp({},F,q))},M)},c6=function(t,a){var l=a.realScaleType,d=a.type,_=a.tickCount,v=a.originalDomain,i=a.allowDecimals,P=l||a.scale;if(P!=="auto"&&P!=="linear")return null;if(_&&d==="number"&&v&&(v[0]==="auto"||v[1]==="auto")){var I=t.domain();if(!I.length)return null;var M=tse(I,_,i);return t.domain([lw(M),sw(M)]),{niceTicks:M}}if(_&&d==="number"){var R=t.domain(),F=rse(R,_,i);return{niceTicks:F}}return null};function OF(e){var t=e.axis,a=e.ticks,l=e.bandSize,d=e.entry,_=e.index,v=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!xn(d[t.dataKey])){var i=E0(a,"value",d[t.dataKey]);if(i)return i.coordinate+l/2}return a[_]?a[_].coordinate+l/2:null}var P=mo(d,xn(v)?t.dataKey:v);return xn(P)?null:t.scale(P)}var MF=function(t){var a=t.axis,l=t.ticks,d=t.offset,_=t.bandSize,v=t.entry,i=t.index;if(a.type==="category")return l[i]?l[i].coordinate+d:null;var P=mo(v,a.dataKey,a.domain[i]);return xn(P)?null:a.scale(P)-_/2+d},Vse=function(t){var a=t.numericAxis,l=a.scale.domain();if(a.type==="number"){var d=Math.min(l[0],l[1]),_=Math.max(l[0],l[1]);return d<=0&&_>=0?0:_<0?_:d}return l[0]},$se=function(t,a){var l,d=(l=t.type)!==null&&l!==void 0&&l.defaultProps?Wi(Wi({},t.type.defaultProps),t.props):t.props,_=d.stackId;if(go(_)){var v=a[_];if(v){var i=v.items.indexOf(t);return i>=0?v.stackedData[i]:null}}return null},qse=function(t){return t.reduce(function(a,l){return[lw(l.concat([a[0]]).filter(fr)),sw(l.concat([a[1]]).filter(fr))]},[1/0,-1/0])},u6=function(t,a,l){return Object.keys(t).reduce(function(d,_){var v=t[_],i=v.stackedData,P=i.reduce(function(I,M){var R=qse(M.slice(a,l+1));return[Math.min(I[0],R[0]),Math.max(I[1],R[1])]},[1/0,-1/0]);return[Math.min(P[0],d[0]),Math.max(P[1],d[1])]},[1/0,-1/0]).map(function(d){return d===1/0||d===-1/0?0:d})},RF=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,DF=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nI=function(t,a,l){if(pn(t))return t(a,l);if(!Array.isArray(t))return a;var d=[];if(fr(t[0]))d[0]=l?t[0]:Math.min(t[0],a[0]);else if(RF.test(t[0])){var _=+RF.exec(t[0])[1];d[0]=a[0]-_}else pn(t[0])?d[0]=t[0](a[0]):d[0]=a[0];if(fr(t[1]))d[1]=l?t[1]:Math.max(t[1],a[1]);else if(DF.test(t[1])){var v=+DF.exec(t[1])[1];d[1]=a[1]+v}else pn(t[1])?d[1]=t[1](a[1]):d[1]=a[1];return d},Y0=function(t,a,l){if(t&&t.scale&&t.scale.bandwidth){var d=t.scale.bandwidth();if(!l||d>0)return d}if(t&&a&&a.length>=2){for(var _=ZC(a,function(R){return R.coordinate}),v=1/0,i=1,P=_.length;i<P;i++){var I=_[i],M=_[i-1];v=Math.min((I.coordinate||0)-(M.coordinate||0),v)}return v===1/0?0:v}return l?void 0:0},kF=function(t,a,l){return!t||!t.length||By(t,Va(l,"type.defaultProps.domain"))?a:t},h6=function(t,a){var l=t.type.defaultProps?Wi(Wi({},t.type.defaultProps),t.props):t.props,d=l.dataKey,_=l.name,v=l.unit,i=l.formatter,P=l.tooltipType,I=l.chartType,M=l.hide;return Wi(Wi({},Jr(t,!1)),{},{dataKey:d,unit:v,formatter:i,name:_||d,color:xO(t),value:mo(a,d),type:P,payload:a,chartType:I,hide:M})};function sy(e){"@babel/helpers - typeof";return sy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sy(e)}function NF(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function _c(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?NF(Object(a),!0).forEach(function(l){d6(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):NF(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function d6(e,t,a){return t=Gse(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Gse(e){var t=Hse(e,"string");return sy(t)=="symbol"?t:t+""}function Hse(e,t){if(sy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(sy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Wse(e,t){return Yse(e)||Kse(e,t)||Xse(e,t)||Zse()}function Zse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xse(e,t){if(e){if(typeof e=="string")return LF(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return LF(e,t)}}function LF(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Kse(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Yse(e){if(Array.isArray(e))return e}var J0=Math.PI/180,Jse=function(t){return t*180/Math.PI},Ci=function(t,a,l,d){return{x:t+Math.cos(-J0*d)*l,y:a+Math.sin(-J0*d)*l}},f6=function(t,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(l.left||0)-(l.right||0)),Math.abs(a-(l.top||0)-(l.bottom||0)))/2},Qse=function(t,a,l,d,_){var v=t.width,i=t.height,P=t.startAngle,I=t.endAngle,M=ca(t.cx,v,v/2),R=ca(t.cy,i,i/2),F=f6(v,i,l),q=ca(t.innerRadius,F,0),H=ca(t.outerRadius,F,F*.8),j=Object.keys(a);return j.reduce(function($,Y){var K=a[Y],re=K.domain,se=K.reversed,J;if(xn(K.range))d==="angleAxis"?J=[P,I]:d==="radiusAxis"&&(J=[q,H]),se&&(J=[J[1],J[0]]);else{J=K.range;var ae=J,de=Wse(ae,2);P=de[0],I=de[1]}var Pe=s6(K,_),Ne=Pe.realScaleType,rt=Pe.scale;rt.domain(re).range(J),l6(rt);var ke=c6(rt,_c(_c({},K),{},{realScaleType:Ne})),Ze=_c(_c(_c({},K),ke),{},{range:J,radius:H,realScaleType:Ne,scale:rt,cx:M,cy:R,innerRadius:q,outerRadius:H,startAngle:P,endAngle:I});return _c(_c({},$),{},d6({},Y,Ze))},{})},ele=function(t,a){var l=t.x,d=t.y,_=a.x,v=a.y;return Math.sqrt(Math.pow(l-_,2)+Math.pow(d-v,2))},tle=function(t,a){var l=t.x,d=t.y,_=a.cx,v=a.cy,i=ele({x:l,y:d},{x:_,y:v});if(i<=0)return{radius:i};var P=(l-_)/i,I=Math.acos(P);return d>v&&(I=2*Math.PI-I),{radius:i,angle:Jse(I),angleInRadian:I}},rle=function(t){var a=t.startAngle,l=t.endAngle,d=Math.floor(a/360),_=Math.floor(l/360),v=Math.min(d,_);return{startAngle:a-v*360,endAngle:l-v*360}},nle=function(t,a){var l=a.startAngle,d=a.endAngle,_=Math.floor(l/360),v=Math.floor(d/360),i=Math.min(_,v);return t+i*360},jF=function(t,a){var l=t.x,d=t.y,_=tle({x:l,y:d},a),v=_.radius,i=_.angle,P=a.innerRadius,I=a.outerRadius;if(v<P||v>I)return!1;if(v===0)return!0;var M=rle(a),R=M.startAngle,F=M.endAngle,q=i,H;if(R<=F){for(;q>F;)q-=360;for(;q<R;)q+=360;H=q>=R&&q<=F}else{for(;q>R;)q-=360;for(;q<F;)q+=360;H=q>=F&&q<=R}return H?_c(_c({},a),{},{radius:v,angle:nle(q,a)}):null},p6=function(t){return!ie.isValidElement(t)&&!pn(t)&&typeof t!="boolean"?t.className:""};function ly(e){"@babel/helpers - typeof";return ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ly(e)}var ile=["offset"];function ole(e){return cle(e)||lle(e)||sle(e)||ale()}function ale(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sle(e,t){if(e){if(typeof e=="string")return iI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return iI(e,t)}}function lle(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function cle(e){if(Array.isArray(e))return iI(e)}function iI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function ule(e,t){if(e==null)return{};var a=hle(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function hle(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function zF(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function ho(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?zF(Object(a),!0).forEach(function(l){dle(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):zF(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function dle(e,t,a){return t=fle(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fle(e){var t=ple(e,"string");return ly(t)=="symbol"?t:t+""}function ple(e,t){if(ly(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(ly(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cy(){return cy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},cy.apply(this,arguments)}var mle=function(t){var a=t.value,l=t.formatter,d=xn(t.children)?a:t.children;return pn(l)?l(d):d},gle=function(t,a){var l=la(a-t),d=Math.min(Math.abs(a-t),360);return l*d},_le=function(t,a,l){var d=t.position,_=t.viewBox,v=t.offset,i=t.className,P=_,I=P.cx,M=P.cy,R=P.innerRadius,F=P.outerRadius,q=P.startAngle,H=P.endAngle,j=P.clockWise,$=(R+F)/2,Y=gle(q,H),K=Y>=0?1:-1,re,se;d==="insideStart"?(re=q+K*v,se=j):d==="insideEnd"?(re=H-K*v,se=!j):d==="end"&&(re=H+K*v,se=j),se=Y<=0?se:!se;var J=Ci(I,M,$,re),ae=Ci(I,M,$,re+(se?1:-1)*359),de="M".concat(J.x,",").concat(J.y,`
    A`).concat($,",").concat($,",0,1,").concat(se?0:1,`,
    `).concat(ae.x,",").concat(ae.y),Pe=xn(t.id)?sm("recharts-radial-line-"):t.id;return He.createElement("text",cy({},l,{dominantBaseline:"central",className:Sn("recharts-radial-bar-label",i)}),He.createElement("defs",null,He.createElement("path",{id:Pe,d:de})),He.createElement("textPath",{xlinkHref:"#".concat(Pe)},a))},yle=function(t){var a=t.viewBox,l=t.offset,d=t.position,_=a,v=_.cx,i=_.cy,P=_.innerRadius,I=_.outerRadius,M=_.startAngle,R=_.endAngle,F=(M+R)/2;if(d==="outside"){var q=Ci(v,i,I+l,F),H=q.x,j=q.y;return{x:H,y:j,textAnchor:H>=v?"start":"end",verticalAnchor:"middle"}}if(d==="center")return{x:v,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(d==="centerTop")return{x:v,y:i,textAnchor:"middle",verticalAnchor:"start"};if(d==="centerBottom")return{x:v,y:i,textAnchor:"middle",verticalAnchor:"end"};var $=(P+I)/2,Y=Ci(v,i,$,F),K=Y.x,re=Y.y;return{x:K,y:re,textAnchor:"middle",verticalAnchor:"middle"}},vle=function(t){var a=t.viewBox,l=t.parentViewBox,d=t.offset,_=t.position,v=a,i=v.x,P=v.y,I=v.width,M=v.height,R=M>=0?1:-1,F=R*d,q=R>0?"end":"start",H=R>0?"start":"end",j=I>=0?1:-1,$=j*d,Y=j>0?"end":"start",K=j>0?"start":"end";if(_==="top"){var re={x:i+I/2,y:P-R*d,textAnchor:"middle",verticalAnchor:q};return ho(ho({},re),l?{height:Math.max(P-l.y,0),width:I}:{})}if(_==="bottom"){var se={x:i+I/2,y:P+M+F,textAnchor:"middle",verticalAnchor:H};return ho(ho({},se),l?{height:Math.max(l.y+l.height-(P+M),0),width:I}:{})}if(_==="left"){var J={x:i-$,y:P+M/2,textAnchor:Y,verticalAnchor:"middle"};return ho(ho({},J),l?{width:Math.max(J.x-l.x,0),height:M}:{})}if(_==="right"){var ae={x:i+I+$,y:P+M/2,textAnchor:K,verticalAnchor:"middle"};return ho(ho({},ae),l?{width:Math.max(l.x+l.width-ae.x,0),height:M}:{})}var de=l?{width:I,height:M}:{};return _==="insideLeft"?ho({x:i+$,y:P+M/2,textAnchor:K,verticalAnchor:"middle"},de):_==="insideRight"?ho({x:i+I-$,y:P+M/2,textAnchor:Y,verticalAnchor:"middle"},de):_==="insideTop"?ho({x:i+I/2,y:P+F,textAnchor:"middle",verticalAnchor:H},de):_==="insideBottom"?ho({x:i+I/2,y:P+M-F,textAnchor:"middle",verticalAnchor:q},de):_==="insideTopLeft"?ho({x:i+$,y:P+F,textAnchor:K,verticalAnchor:H},de):_==="insideTopRight"?ho({x:i+I-$,y:P+F,textAnchor:Y,verticalAnchor:H},de):_==="insideBottomLeft"?ho({x:i+$,y:P+M-F,textAnchor:K,verticalAnchor:q},de):_==="insideBottomRight"?ho({x:i+I-$,y:P+M-F,textAnchor:Y,verticalAnchor:q},de):am(_)&&(fr(_.x)||Yh(_.x))&&(fr(_.y)||Yh(_.y))?ho({x:i+ca(_.x,I),y:P+ca(_.y,M),textAnchor:"end",verticalAnchor:"end"},de):ho({x:i+I/2,y:P+M/2,textAnchor:"middle",verticalAnchor:"middle"},de)},xle=function(t){return"cx"in t&&fr(t.cx)};function Io(e){var t=e.offset,a=t===void 0?5:t,l=ule(e,ile),d=ho({offset:a},l),_=d.viewBox,v=d.position,i=d.value,P=d.children,I=d.content,M=d.className,R=M===void 0?"":M,F=d.textBreakAll;if(!_||xn(i)&&xn(P)&&!ie.isValidElement(I)&&!pn(I))return null;if(ie.isValidElement(I))return ie.cloneElement(I,d);var q;if(pn(I)){if(q=ie.createElement(I,d),ie.isValidElement(q))return q}else q=mle(d);var H=xle(_),j=Jr(d,!0);if(H&&(v==="insideStart"||v==="insideEnd"||v==="end"))return _le(d,q,j);var $=H?yle(d):vle(d);return He.createElement(ud,cy({className:Sn("recharts-label",R)},j,$,{breakAll:F}),q)}Io.displayName="Label";var m6=function(t){var a=t.cx,l=t.cy,d=t.angle,_=t.startAngle,v=t.endAngle,i=t.r,P=t.radius,I=t.innerRadius,M=t.outerRadius,R=t.x,F=t.y,q=t.top,H=t.left,j=t.width,$=t.height,Y=t.clockWise,K=t.labelViewBox;if(K)return K;if(fr(j)&&fr($)){if(fr(R)&&fr(F))return{x:R,y:F,width:j,height:$};if(fr(q)&&fr(H))return{x:q,y:H,width:j,height:$}}return fr(R)&&fr(F)?{x:R,y:F,width:0,height:0}:fr(a)&&fr(l)?{cx:a,cy:l,startAngle:_||d||0,endAngle:v||d||0,innerRadius:I||0,outerRadius:M||P||i||0,clockWise:Y}:t.viewBox?t.viewBox:{}},ble=function(t,a){return t?t===!0?He.createElement(Io,{key:"label-implicit",viewBox:a}):go(t)?He.createElement(Io,{key:"label-implicit",viewBox:a,value:t}):ie.isValidElement(t)?t.type===Io?ie.cloneElement(t,{key:"label-implicit",viewBox:a}):He.createElement(Io,{key:"label-implicit",content:t,viewBox:a}):pn(t)?He.createElement(Io,{key:"label-implicit",content:t,viewBox:a}):am(t)?He.createElement(Io,cy({viewBox:a},t,{key:"label-implicit"})):null:null},wle=function(t,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&l&&!t.label)return null;var d=t.children,_=m6(t),v=$a(d,Io).map(function(P,I){return ie.cloneElement(P,{viewBox:a||_,key:"label-".concat(I)})});if(!l)return v;var i=ble(t.label,a||_);return[i].concat(ole(v))};Io.parseViewBox=m6;Io.renderCallByParent=wle;var m2,FF;function Sle(){if(FF)return m2;FF=1;function e(t){var a=t==null?0:t.length;return a?t[a-1]:void 0}return m2=e,m2}var Tle=Sle();const Ale=si(Tle);function uy(e){"@babel/helpers - typeof";return uy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uy(e)}var Ele=["valueAccessor"],Ple=["data","dataKey","clockWise","id","textBreakAll"];function Ile(e){return Rle(e)||Mle(e)||Ole(e)||Cle()}function Cle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ole(e,t){if(e){if(typeof e=="string")return oI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return oI(e,t)}}function Mle(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Rle(e){if(Array.isArray(e))return oI(e)}function oI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Q0(){return Q0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Q0.apply(this,arguments)}function BF(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function UF(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?BF(Object(a),!0).forEach(function(l){Dle(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):BF(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Dle(e,t,a){return t=kle(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function kle(e){var t=Nle(e,"string");return uy(t)=="symbol"?t:t+""}function Nle(e,t){if(uy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(uy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function VF(e,t){if(e==null)return{};var a=Lle(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function Lle(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}var jle=function(t){return Array.isArray(t.value)?Ale(t.value):t.value};function Ac(e){var t=e.valueAccessor,a=t===void 0?jle:t,l=VF(e,Ele),d=l.data,_=l.dataKey,v=l.clockWise,i=l.id,P=l.textBreakAll,I=VF(l,Ple);return!d||!d.length?null:He.createElement(ti,{className:"recharts-label-list"},d.map(function(M,R){var F=xn(_)?a(M,R):mo(M&&M.payload,_),q=xn(i)?{}:{id:"".concat(i,"-").concat(R)};return He.createElement(Io,Q0({},Jr(M,!0),I,q,{parentViewBox:M.parentViewBox,value:F,textBreakAll:P,viewBox:Io.parseViewBox(xn(v)?M:UF(UF({},M),{},{clockWise:v})),key:"label-".concat(R),index:R}))}))}Ac.displayName="LabelList";function zle(e,t){return e?e===!0?He.createElement(Ac,{key:"labelList-implicit",data:t}):He.isValidElement(e)||pn(e)?He.createElement(Ac,{key:"labelList-implicit",data:t,content:e}):am(e)?He.createElement(Ac,Q0({data:t},e,{key:"labelList-implicit"})):null:null}function Fle(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&a&&!e.label)return null;var l=e.children,d=$a(l,Ac).map(function(v,i){return ie.cloneElement(v,{data:t,key:"labelList-".concat(i)})});if(!a)return d;var _=zle(e.label,t);return[_].concat(Ile(d))}Ac.renderCallByParent=Fle;function hy(e){"@babel/helpers - typeof";return hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hy(e)}function aI(){return aI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},aI.apply(this,arguments)}function $F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function qF(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?$F(Object(a),!0).forEach(function(l){Ble(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$F(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Ble(e,t,a){return t=Ule(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ule(e){var t=Vle(e,"string");return hy(t)=="symbol"?t:t+""}function Vle(e,t){if(hy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(hy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $le=function(t,a){var l=la(a-t),d=Math.min(Math.abs(a-t),359.999);return l*d},t0=function(t){var a=t.cx,l=t.cy,d=t.radius,_=t.angle,v=t.sign,i=t.isExternal,P=t.cornerRadius,I=t.cornerIsExternal,M=P*(i?1:-1)+d,R=Math.asin(P/M)/J0,F=I?_:_+v*R,q=Ci(a,l,M,F),H=Ci(a,l,d,F),j=I?_-v*R:_,$=Ci(a,l,M*Math.cos(R*J0),j);return{center:q,circleTangency:H,lineTangency:$,theta:R}},g6=function(t){var a=t.cx,l=t.cy,d=t.innerRadius,_=t.outerRadius,v=t.startAngle,i=t.endAngle,P=$le(v,i),I=v+P,M=Ci(a,l,_,v),R=Ci(a,l,_,I),F="M ".concat(M.x,",").concat(M.y,`
    A `).concat(_,",").concat(_,`,0,
    `).concat(+(Math.abs(P)>180),",").concat(+(v>I),`,
    `).concat(R.x,",").concat(R.y,`
  `);if(d>0){var q=Ci(a,l,d,v),H=Ci(a,l,d,I);F+="L ".concat(H.x,",").concat(H.y,`
            A `).concat(d,",").concat(d,`,0,
            `).concat(+(Math.abs(P)>180),",").concat(+(v<=I),`,
            `).concat(q.x,",").concat(q.y," Z")}else F+="L ".concat(a,",").concat(l," Z");return F},qle=function(t){var a=t.cx,l=t.cy,d=t.innerRadius,_=t.outerRadius,v=t.cornerRadius,i=t.forceCornerRadius,P=t.cornerIsExternal,I=t.startAngle,M=t.endAngle,R=la(M-I),F=t0({cx:a,cy:l,radius:_,angle:I,sign:R,cornerRadius:v,cornerIsExternal:P}),q=F.circleTangency,H=F.lineTangency,j=F.theta,$=t0({cx:a,cy:l,radius:_,angle:M,sign:-R,cornerRadius:v,cornerIsExternal:P}),Y=$.circleTangency,K=$.lineTangency,re=$.theta,se=P?Math.abs(I-M):Math.abs(I-M)-j-re;if(se<0)return i?"M ".concat(H.x,",").concat(H.y,`
        a`).concat(v,",").concat(v,",0,0,1,").concat(v*2,`,0
        a`).concat(v,",").concat(v,",0,0,1,").concat(-v*2,`,0
      `):g6({cx:a,cy:l,innerRadius:d,outerRadius:_,startAngle:I,endAngle:M});var J="M ".concat(H.x,",").concat(H.y,`
    A`).concat(v,",").concat(v,",0,0,").concat(+(R<0),",").concat(q.x,",").concat(q.y,`
    A`).concat(_,",").concat(_,",0,").concat(+(se>180),",").concat(+(R<0),",").concat(Y.x,",").concat(Y.y,`
    A`).concat(v,",").concat(v,",0,0,").concat(+(R<0),",").concat(K.x,",").concat(K.y,`
  `);if(d>0){var ae=t0({cx:a,cy:l,radius:d,angle:I,sign:R,isExternal:!0,cornerRadius:v,cornerIsExternal:P}),de=ae.circleTangency,Pe=ae.lineTangency,Ne=ae.theta,rt=t0({cx:a,cy:l,radius:d,angle:M,sign:-R,isExternal:!0,cornerRadius:v,cornerIsExternal:P}),ke=rt.circleTangency,Ze=rt.lineTangency,nt=rt.theta,Je=P?Math.abs(I-M):Math.abs(I-M)-Ne-nt;if(Je<0&&v===0)return"".concat(J,"L").concat(a,",").concat(l,"Z");J+="L".concat(Ze.x,",").concat(Ze.y,`
      A`).concat(v,",").concat(v,",0,0,").concat(+(R<0),",").concat(ke.x,",").concat(ke.y,`
      A`).concat(d,",").concat(d,",0,").concat(+(Je>180),",").concat(+(R>0),",").concat(de.x,",").concat(de.y,`
      A`).concat(v,",").concat(v,",0,0,").concat(+(R<0),",").concat(Pe.x,",").concat(Pe.y,"Z")}else J+="L".concat(a,",").concat(l,"Z");return J},Gle={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},_6=function(t){var a=qF(qF({},Gle),t),l=a.cx,d=a.cy,_=a.innerRadius,v=a.outerRadius,i=a.cornerRadius,P=a.forceCornerRadius,I=a.cornerIsExternal,M=a.startAngle,R=a.endAngle,F=a.className;if(v<_||M===R)return null;var q=Sn("recharts-sector",F),H=v-_,j=ca(i,H,0,!0),$;return j>0&&Math.abs(M-R)<360?$=qle({cx:l,cy:d,innerRadius:_,outerRadius:v,cornerRadius:Math.min(j,H/2),forceCornerRadius:P,cornerIsExternal:I,startAngle:M,endAngle:R}):$=g6({cx:l,cy:d,innerRadius:_,outerRadius:v,startAngle:M,endAngle:R}),He.createElement("path",aI({},Jr(a,!0),{className:q,d:$,role:"img"}))};function dy(e){"@babel/helpers - typeof";return dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dy(e)}function sI(){return sI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},sI.apply(this,arguments)}function GF(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function HF(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?GF(Object(a),!0).forEach(function(l){Hle(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):GF(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Hle(e,t,a){return t=Wle(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Wle(e){var t=Zle(e,"string");return dy(t)=="symbol"?t:t+""}function Zle(e,t){if(dy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(dy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var WF={curveBasisClosed:pee,curveBasisOpen:mee,curveBasis:fee,curveBumpX:QQ,curveBumpY:eee,curveLinearClosed:gee,curveLinear:Xb,curveMonotoneX:_ee,curveMonotoneY:yee,curveNatural:vee,curveStep:xee,curveStepAfter:wee,curveStepBefore:bee},r0=function(t){return t.x===+t.x&&t.y===+t.y},__=function(t){return t.x},y_=function(t){return t.y},Xle=function(t,a){if(pn(t))return t;var l="curve".concat(Wb(t));return(l==="curveMonotone"||l==="curveBump")&&a?WF["".concat(l).concat(a==="vertical"?"Y":"X")]:WF[l]||Xb},Kle=function(t){var a=t.type,l=a===void 0?"linear":a,d=t.points,_=d===void 0?[]:d,v=t.baseLine,i=t.layout,P=t.connectNulls,I=P===void 0?!1:P,M=Xle(l,i),R=I?_.filter(function(j){return r0(j)}):_,F;if(Array.isArray(v)){var q=I?v.filter(function(j){return r0(j)}):v,H=R.map(function(j,$){return HF(HF({},j),{},{base:q[$]})});return i==="vertical"?F=Hx().y(y_).x1(__).x0(function(j){return j.base.x}):F=Hx().x(__).y1(y_).y0(function(j){return j.base.y}),F.defined(r0).curve(M),F(H)}return i==="vertical"&&fr(v)?F=Hx().y(y_).x1(__).x0(v):fr(v)?F=Hx().x(__).y1(y_).y0(v):F=mV().x(__).y(y_),F.defined(r0).curve(M),F(R)},eb=function(t){var a=t.className,l=t.points,d=t.path,_=t.pathRef;if((!l||!l.length)&&!d)return null;var v=l&&l.length?Kle(t):d;return ie.createElement("path",sI({},Jr(t,!1),P0(t),{className:Sn("recharts-curve",a),d:v,ref:_}))},g2={exports:{}},_2,ZF;function Yle(){if(ZF)return _2;ZF=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return _2=e,_2}var y2,XF;function Jle(){if(XF)return y2;XF=1;var e=Yle();function t(){}function a(){}return a.resetWarningCache=t,y2=function(){function l(v,i,P,I,M,R){if(R!==e){var F=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw F.name="Invariant Violation",F}}l.isRequired=l;function d(){return l}var _={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:d,element:l,elementType:l,instanceOf:d,node:l,objectOf:d,oneOf:d,oneOfType:d,shape:d,exact:d,checkPropTypes:a,resetWarningCache:t};return _.PropTypes=_,_},y2}var KF;function Qle(){return KF||(KF=1,g2.exports=Jle()()),g2.exports}var ece=Qle();const ci=si(ece);var tce=Object.getOwnPropertyNames,rce=Object.getOwnPropertySymbols,nce=Object.prototype.hasOwnProperty;function YF(e,t){return function(l,d,_){return e(l,d,_)&&t(l,d,_)}}function n0(e){return function(a,l,d){if(!a||!l||typeof a!="object"||typeof l!="object")return e(a,l,d);var _=d.cache,v=_.get(a),i=_.get(l);if(v&&i)return v===l&&i===a;_.set(a,l),_.set(l,a);var P=e(a,l,d);return _.delete(a),_.delete(l),P}}function ice(e){return e?.[Symbol.toStringTag]}function JF(e){return tce(e).concat(rce(e))}var oce=Object.hasOwn||(function(e,t){return nce.call(e,t)});function bd(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var ace="__v",sce="__o",lce="_owner",QF=Object.getOwnPropertyDescriptor,eB=Object.keys;function cce(e,t,a){var l=e.length;if(t.length!==l)return!1;for(;l-- >0;)if(!a.equals(e[l],t[l],l,l,e,t,a))return!1;return!0}function uce(e,t){return bd(e.getTime(),t.getTime())}function hce(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function dce(e,t){return e===t}function tB(e,t,a){var l=e.size;if(l!==t.size)return!1;if(!l)return!0;for(var d=new Array(l),_=e.entries(),v,i,P=0;(v=_.next())&&!v.done;){for(var I=t.entries(),M=!1,R=0;(i=I.next())&&!i.done;){if(d[R]){R++;continue}var F=v.value,q=i.value;if(a.equals(F[0],q[0],P,R,e,t,a)&&a.equals(F[1],q[1],F[0],q[0],e,t,a)){M=d[R]=!0;break}R++}if(!M)return!1;P++}return!0}var fce=bd;function pce(e,t,a){var l=eB(e),d=l.length;if(eB(t).length!==d)return!1;for(;d-- >0;)if(!y6(e,t,a,l[d]))return!1;return!0}function v_(e,t,a){var l=JF(e),d=l.length;if(JF(t).length!==d)return!1;for(var _,v,i;d-- >0;)if(_=l[d],!y6(e,t,a,_)||(v=QF(e,_),i=QF(t,_),(v||i)&&(!v||!i||v.configurable!==i.configurable||v.enumerable!==i.enumerable||v.writable!==i.writable)))return!1;return!0}function mce(e,t){return bd(e.valueOf(),t.valueOf())}function gce(e,t){return e.source===t.source&&e.flags===t.flags}function rB(e,t,a){var l=e.size;if(l!==t.size)return!1;if(!l)return!0;for(var d=new Array(l),_=e.values(),v,i;(v=_.next())&&!v.done;){for(var P=t.values(),I=!1,M=0;(i=P.next())&&!i.done;){if(!d[M]&&a.equals(v.value,i.value,v.value,i.value,e,t,a)){I=d[M]=!0;break}M++}if(!I)return!1}return!0}function _ce(e,t){var a=e.length;if(t.length!==a)return!1;for(;a-- >0;)if(e[a]!==t[a])return!1;return!0}function yce(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function y6(e,t,a,l){return(l===lce||l===sce||l===ace)&&(e.$$typeof||t.$$typeof)?!0:oce(t,l)&&a.equals(e[l],t[l],l,l,e,t,a)}var vce="[object Arguments]",xce="[object Boolean]",bce="[object Date]",wce="[object Error]",Sce="[object Map]",Tce="[object Number]",Ace="[object Object]",Ece="[object RegExp]",Pce="[object Set]",Ice="[object String]",Cce="[object URL]",Oce=Array.isArray,nB=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,iB=Object.assign,Mce=Object.prototype.toString.call.bind(Object.prototype.toString);function Rce(e){var t=e.areArraysEqual,a=e.areDatesEqual,l=e.areErrorsEqual,d=e.areFunctionsEqual,_=e.areMapsEqual,v=e.areNumbersEqual,i=e.areObjectsEqual,P=e.arePrimitiveWrappersEqual,I=e.areRegExpsEqual,M=e.areSetsEqual,R=e.areTypedArraysEqual,F=e.areUrlsEqual,q=e.unknownTagComparators;return function(j,$,Y){if(j===$)return!0;if(j==null||$==null)return!1;var K=typeof j;if(K!==typeof $)return!1;if(K!=="object")return K==="number"?v(j,$,Y):K==="function"?d(j,$,Y):!1;var re=j.constructor;if(re!==$.constructor)return!1;if(re===Object)return i(j,$,Y);if(Oce(j))return t(j,$,Y);if(nB!=null&&nB(j))return R(j,$,Y);if(re===Date)return a(j,$,Y);if(re===RegExp)return I(j,$,Y);if(re===Map)return _(j,$,Y);if(re===Set)return M(j,$,Y);var se=Mce(j);if(se===bce)return a(j,$,Y);if(se===Ece)return I(j,$,Y);if(se===Sce)return _(j,$,Y);if(se===Pce)return M(j,$,Y);if(se===Ace)return typeof j.then!="function"&&typeof $.then!="function"&&i(j,$,Y);if(se===Cce)return F(j,$,Y);if(se===wce)return l(j,$,Y);if(se===vce)return i(j,$,Y);if(se===xce||se===Tce||se===Ice)return P(j,$,Y);if(q){var J=q[se];if(!J){var ae=ice(j);ae&&(J=q[ae])}if(J)return J(j,$,Y)}return!1}}function Dce(e){var t=e.circular,a=e.createCustomConfig,l=e.strict,d={areArraysEqual:l?v_:cce,areDatesEqual:uce,areErrorsEqual:hce,areFunctionsEqual:dce,areMapsEqual:l?YF(tB,v_):tB,areNumbersEqual:fce,areObjectsEqual:l?v_:pce,arePrimitiveWrappersEqual:mce,areRegExpsEqual:gce,areSetsEqual:l?YF(rB,v_):rB,areTypedArraysEqual:l?v_:_ce,areUrlsEqual:yce,unknownTagComparators:void 0};if(a&&(d=iB({},d,a(d))),t){var _=n0(d.areArraysEqual),v=n0(d.areMapsEqual),i=n0(d.areObjectsEqual),P=n0(d.areSetsEqual);d=iB({},d,{areArraysEqual:_,areMapsEqual:v,areObjectsEqual:i,areSetsEqual:P})}return d}function kce(e){return function(t,a,l,d,_,v,i){return e(t,a,i)}}function Nce(e){var t=e.circular,a=e.comparator,l=e.createState,d=e.equals,_=e.strict;if(l)return function(P,I){var M=l(),R=M.cache,F=R===void 0?t?new WeakMap:void 0:R,q=M.meta;return a(P,I,{cache:F,equals:d,meta:q,strict:_})};if(t)return function(P,I){return a(P,I,{cache:new WeakMap,equals:d,meta:void 0,strict:_})};var v={cache:void 0,equals:d,meta:void 0,strict:_};return function(P,I){return a(P,I,v)}}var Lce=Gu();Gu({strict:!0});Gu({circular:!0});Gu({circular:!0,strict:!0});Gu({createInternalComparator:function(){return bd}});Gu({strict:!0,createInternalComparator:function(){return bd}});Gu({circular:!0,createInternalComparator:function(){return bd}});Gu({circular:!0,createInternalComparator:function(){return bd},strict:!0});function Gu(e){e===void 0&&(e={});var t=e.circular,a=t===void 0?!1:t,l=e.createInternalComparator,d=e.createState,_=e.strict,v=_===void 0?!1:_,i=Dce(e),P=Rce(i),I=l?l(P):kce(P);return Nce({circular:a,comparator:P,createState:d,equals:I,strict:v})}function jce(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function oB(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=-1,l=function d(_){a<0&&(a=_),_-a>t?(e(_),a=-1):jce(d)};requestAnimationFrame(l)}function lI(e){"@babel/helpers - typeof";return lI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lI(e)}function zce(e){return Vce(e)||Uce(e)||Bce(e)||Fce()}function Fce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bce(e,t){if(e){if(typeof e=="string")return aB(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return aB(e,t)}}function aB(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Uce(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Vce(e){if(Array.isArray(e))return e}function $ce(){var e={},t=function(){return null},a=!1,l=function d(_){if(!a){if(Array.isArray(_)){if(!_.length)return;var v=_,i=zce(v),P=i[0],I=i.slice(1);if(typeof P=="number"){oB(d.bind(null,I),P);return}d(P),oB(d.bind(null,I));return}lI(_)==="object"&&(e=_,t(e)),typeof _=="function"&&_()}};return{stop:function(){a=!0},start:function(_){a=!1,l(_)},subscribe:function(_){return t=_,function(){t=function(){return null}}}}}function fy(e){"@babel/helpers - typeof";return fy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fy(e)}function sB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function lB(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?sB(Object(a),!0).forEach(function(l){v6(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function v6(e,t,a){return t=qce(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function qce(e){var t=Gce(e,"string");return fy(t)==="symbol"?t:String(t)}function Gce(e,t){if(fy(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(fy(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Hce=function(t,a){return[Object.keys(t),Object.keys(a)].reduce(function(l,d){return l.filter(function(_){return d.includes(_)})})},Wce=function(t){return t},Zce=function(t){return t.replace(/([A-Z])/g,function(a){return"-".concat(a.toLowerCase())})},L_=function(t,a){return Object.keys(a).reduce(function(l,d){return lB(lB({},l),{},v6({},d,t(d,a[d])))},{})},cB=function(t,a,l){return t.map(function(d){return"".concat(Zce(d)," ").concat(a,"ms ").concat(l)}).join(",")};function Xce(e,t){return Jce(e)||Yce(e,t)||x6(e,t)||Kce()}function Kce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yce(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Jce(e){if(Array.isArray(e))return e}function Qce(e){return rue(e)||tue(e)||x6(e)||eue()}function eue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x6(e,t){if(e){if(typeof e=="string")return cI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cI(e,t)}}function tue(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function rue(e){if(Array.isArray(e))return cI(e)}function cI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}var tb=1e-4,b6=function(t,a){return[0,3*t,3*a-6*t,3*t-3*a+1]},w6=function(t,a){return t.map(function(l,d){return l*Math.pow(a,d)}).reduce(function(l,d){return l+d})},uB=function(t,a){return function(l){var d=b6(t,a);return w6(d,l)}},nue=function(t,a){return function(l){var d=b6(t,a),_=[].concat(Qce(d.map(function(v,i){return v*i}).slice(1)),[0]);return w6(_,l)}},hB=function(){for(var t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];var d=a[0],_=a[1],v=a[2],i=a[3];if(a.length===1)switch(a[0]){case"linear":d=0,_=0,v=1,i=1;break;case"ease":d=.25,_=.1,v=.25,i=1;break;case"ease-in":d=.42,_=0,v=1,i=1;break;case"ease-out":d=.42,_=0,v=.58,i=1;break;case"ease-in-out":d=0,_=0,v=.58,i=1;break;default:{var P=a[0].split("(");if(P[0]==="cubic-bezier"&&P[1].split(")")[0].split(",").length===4){var I=P[1].split(")")[0].split(",").map(function($){return parseFloat($)}),M=Xce(I,4);d=M[0],_=M[1],v=M[2],i=M[3]}}}var R=uB(d,v),F=uB(_,i),q=nue(d,v),H=function(Y){return Y>1?1:Y<0?0:Y},j=function(Y){for(var K=Y>1?1:Y,re=K,se=0;se<8;++se){var J=R(re)-K,ae=q(re);if(Math.abs(J-K)<tb||ae<tb)return F(re);re=H(re-J/ae)}return F(re)};return j.isStepper=!1,j},iue=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=t.stiff,l=a===void 0?100:a,d=t.damping,_=d===void 0?8:d,v=t.dt,i=v===void 0?17:v,P=function(M,R,F){var q=-(M-R)*l,H=F*_,j=F+(q-H)*i/1e3,$=F*i/1e3+M;return Math.abs($-R)<tb&&Math.abs(j)<tb?[R,0]:[$,j]};return P.isStepper=!0,P.dt=i,P},oue=function(){for(var t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];var d=a[0];if(typeof d=="string")switch(d){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return hB(d);case"spring":return iue();default:if(d.split("(")[0]==="cubic-bezier")return hB(d)}return typeof d=="function"?d:null};function py(e){"@babel/helpers - typeof";return py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},py(e)}function dB(e){return lue(e)||sue(e)||S6(e)||aue()}function aue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sue(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lue(e){if(Array.isArray(e))return hI(e)}function fB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function No(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(a),!0).forEach(function(l){uI(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function uI(e,t,a){return t=cue(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function cue(e){var t=uue(e,"string");return py(t)==="symbol"?t:String(t)}function uue(e,t){if(py(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(py(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hue(e,t){return pue(e)||fue(e,t)||S6(e,t)||due()}function due(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S6(e,t){if(e){if(typeof e=="string")return hI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hI(e,t)}}function hI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function fue(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function pue(e){if(Array.isArray(e))return e}var rb=function(t,a,l){return t+(a-t)*l},dI=function(t){var a=t.from,l=t.to;return a!==l},mue=function e(t,a,l){var d=L_(function(_,v){if(dI(v)){var i=t(v.from,v.to,v.velocity),P=hue(i,2),I=P[0],M=P[1];return No(No({},v),{},{from:I,velocity:M})}return v},a);return l<1?L_(function(_,v){return dI(v)?No(No({},v),{},{velocity:rb(v.velocity,d[_].velocity,l),from:rb(v.from,d[_].from,l)}):v},a):e(t,d,l-1)};const gue=(function(e,t,a,l,d){var _=Hce(e,t),v=_.reduce(function($,Y){return No(No({},$),{},uI({},Y,[e[Y],t[Y]]))},{}),i=_.reduce(function($,Y){return No(No({},$),{},uI({},Y,{from:e[Y],velocity:0,to:t[Y]}))},{}),P=-1,I,M,R=function(){return null},F=function(){return L_(function(Y,K){return K.from},i)},q=function(){return!Object.values(i).filter(dI).length},H=function(Y){I||(I=Y);var K=Y-I,re=K/a.dt;i=mue(a,i,re),d(No(No(No({},e),t),F())),I=Y,q()||(P=requestAnimationFrame(R))},j=function(Y){M||(M=Y);var K=(Y-M)/l,re=L_(function(J,ae){return rb.apply(void 0,dB(ae).concat([a(K)]))},v);if(d(No(No(No({},e),t),re)),K<1)P=requestAnimationFrame(R);else{var se=L_(function(J,ae){return rb.apply(void 0,dB(ae).concat([a(1)]))},v);d(No(No(No({},e),t),se))}};return R=a.isStepper?H:j,function(){return requestAnimationFrame(R),function(){cancelAnimationFrame(P)}}});function kp(e){"@babel/helpers - typeof";return kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kp(e)}var _ue=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function yue(e,t){if(e==null)return{};var a=vue(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function vue(e,t){if(e==null)return{};var a={},l=Object.keys(e),d,_;for(_=0;_<l.length;_++)d=l[_],!(t.indexOf(d)>=0)&&(a[d]=e[d]);return a}function v2(e){return Sue(e)||wue(e)||bue(e)||xue()}function xue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bue(e,t){if(e){if(typeof e=="string")return fI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fI(e,t)}}function wue(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Sue(e){if(Array.isArray(e))return fI(e)}function fI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function pB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function ks(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?pB(Object(a),!0).forEach(function(l){A_(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function A_(e,t,a){return t=T6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Tue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Aue(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,T6(l.key),l)}}function Eue(e,t,a){return t&&Aue(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function T6(e){var t=Pue(e,"string");return kp(t)==="symbol"?t:String(t)}function Pue(e,t){if(kp(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(kp(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Iue(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pI(e,t)}function pI(e,t){return pI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},pI(e,t)}function Cue(e){var t=Oue();return function(){var l=nb(e),d;if(t){var _=nb(this).constructor;d=Reflect.construct(l,arguments,_)}else d=l.apply(this,arguments);return mI(this,d)}}function mI(e,t){if(t&&(kp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gI(e)}function gI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oue(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nb(e){return nb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},nb(e)}var Rl=(function(e){Iue(a,e);var t=Cue(a);function a(l,d){var _;Tue(this,a),_=t.call(this,l,d);var v=_.props,i=v.isActive,P=v.attributeName,I=v.from,M=v.to,R=v.steps,F=v.children,q=v.duration;if(_.handleStyleChange=_.handleStyleChange.bind(gI(_)),_.changeStyle=_.changeStyle.bind(gI(_)),!i||q<=0)return _.state={style:{}},typeof F=="function"&&(_.state={style:M}),mI(_);if(R&&R.length)_.state={style:R[0].style};else if(I){if(typeof F=="function")return _.state={style:I},mI(_);_.state={style:P?A_({},P,I):I}}else _.state={style:{}};return _}return Eue(a,[{key:"componentDidMount",value:function(){var d=this.props,_=d.isActive,v=d.canBegin;this.mounted=!0,!(!_||!v)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(d){var _=this.props,v=_.isActive,i=_.canBegin,P=_.attributeName,I=_.shouldReAnimate,M=_.to,R=_.from,F=this.state.style;if(i){if(!v){var q={style:P?A_({},P,M):M};this.state&&F&&(P&&F[P]!==M||!P&&F!==M)&&this.setState(q);return}if(!(Lce(d.to,M)&&d.canBegin&&d.isActive)){var H=!d.canBegin||!d.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var j=H||I?R:d.to;if(this.state&&F){var $={style:P?A_({},P,j):j};(P&&F[P]!==j||!P&&F!==j)&&this.setState($)}this.runAnimation(ks(ks({},this.props),{},{from:j,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var d=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),d&&d()}},{key:"handleStyleChange",value:function(d){this.changeStyle(d)}},{key:"changeStyle",value:function(d){this.mounted&&this.setState({style:d})}},{key:"runJSAnimation",value:function(d){var _=this,v=d.from,i=d.to,P=d.duration,I=d.easing,M=d.begin,R=d.onAnimationEnd,F=d.onAnimationStart,q=gue(v,i,oue(I),P,this.changeStyle),H=function(){_.stopJSAnimation=q()};this.manager.start([F,M,H,P,R])}},{key:"runStepAnimation",value:function(d){var _=this,v=d.steps,i=d.begin,P=d.onAnimationStart,I=v[0],M=I.style,R=I.duration,F=R===void 0?0:R,q=function(j,$,Y){if(Y===0)return j;var K=$.duration,re=$.easing,se=re===void 0?"ease":re,J=$.style,ae=$.properties,de=$.onAnimationEnd,Pe=Y>0?v[Y-1]:$,Ne=ae||Object.keys(J);if(typeof se=="function"||se==="spring")return[].concat(v2(j),[_.runJSAnimation.bind(_,{from:Pe.style,to:J,duration:K,easing:se}),K]);var rt=cB(Ne,K,se),ke=ks(ks(ks({},Pe.style),J),{},{transition:rt});return[].concat(v2(j),[ke,K,de]).filter(Wce)};return this.manager.start([P].concat(v2(v.reduce(q,[M,Math.max(F,i)])),[d.onAnimationEnd]))}},{key:"runAnimation",value:function(d){this.manager||(this.manager=$ce());var _=d.begin,v=d.duration,i=d.attributeName,P=d.to,I=d.easing,M=d.onAnimationStart,R=d.onAnimationEnd,F=d.steps,q=d.children,H=this.manager;if(this.unSubscribe=H.subscribe(this.handleStyleChange),typeof I=="function"||typeof q=="function"||I==="spring"){this.runJSAnimation(d);return}if(F.length>1){this.runStepAnimation(d);return}var j=i?A_({},i,P):P,$=cB(Object.keys(j),v,I);H.start([M,_,ks(ks({},j),{},{transition:$}),v,R])}},{key:"render",value:function(){var d=this.props,_=d.children;d.begin;var v=d.duration;d.attributeName,d.easing;var i=d.isActive;d.steps,d.from,d.to,d.canBegin,d.onAnimationEnd,d.shouldReAnimate,d.onAnimationReStart;var P=yue(d,_ue),I=ie.Children.count(_),M=this.state.style;if(typeof _=="function")return _(M);if(!i||I===0||v<=0)return _;var R=function(q){var H=q.props,j=H.style,$=j===void 0?{}:j,Y=H.className,K=ie.cloneElement(q,ks(ks({},P),{},{style:ks(ks({},$),M),className:Y}));return K};return I===1?R(ie.Children.only(_)):He.createElement("div",null,ie.Children.map(_,function(F){return R(F)}))}}]),a})(ie.PureComponent);Rl.displayName="Animate";Rl.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Rl.propTypes={from:ci.oneOfType([ci.object,ci.string]),to:ci.oneOfType([ci.object,ci.string]),attributeName:ci.string,duration:ci.number,begin:ci.number,easing:ci.oneOfType([ci.string,ci.func]),steps:ci.arrayOf(ci.shape({duration:ci.number.isRequired,style:ci.object.isRequired,easing:ci.oneOfType([ci.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),ci.func]),properties:ci.arrayOf("string"),onAnimationEnd:ci.func})),children:ci.oneOfType([ci.node,ci.func]),isActive:ci.bool,canBegin:ci.bool,onAnimationEnd:ci.func,shouldReAnimate:ci.bool,onAnimationStart:ci.func,onAnimationReStart:ci.func};function my(e){"@babel/helpers - typeof";return my=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},my(e)}function ib(){return ib=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},ib.apply(this,arguments)}function Mue(e,t){return Nue(e)||kue(e,t)||Due(e,t)||Rue()}function Rue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Due(e,t){if(e){if(typeof e=="string")return mB(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mB(e,t)}}function mB(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function kue(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Nue(e){if(Array.isArray(e))return e}function gB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function _B(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?gB(Object(a),!0).forEach(function(l){Lue(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Lue(e,t,a){return t=jue(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function jue(e){var t=zue(e,"string");return my(t)=="symbol"?t:t+""}function zue(e,t){if(my(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(my(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yB=function(t,a,l,d,_){var v=Math.min(Math.abs(l)/2,Math.abs(d)/2),i=d>=0?1:-1,P=l>=0?1:-1,I=d>=0&&l>=0||d<0&&l<0?1:0,M;if(v>0&&_ instanceof Array){for(var R=[0,0,0,0],F=0,q=4;F<q;F++)R[F]=_[F]>v?v:_[F];M="M".concat(t,",").concat(a+i*R[0]),R[0]>0&&(M+="A ".concat(R[0],",").concat(R[0],",0,0,").concat(I,",").concat(t+P*R[0],",").concat(a)),M+="L ".concat(t+l-P*R[1],",").concat(a),R[1]>0&&(M+="A ".concat(R[1],",").concat(R[1],",0,0,").concat(I,`,
        `).concat(t+l,",").concat(a+i*R[1])),M+="L ".concat(t+l,",").concat(a+d-i*R[2]),R[2]>0&&(M+="A ".concat(R[2],",").concat(R[2],",0,0,").concat(I,`,
        `).concat(t+l-P*R[2],",").concat(a+d)),M+="L ".concat(t+P*R[3],",").concat(a+d),R[3]>0&&(M+="A ".concat(R[3],",").concat(R[3],",0,0,").concat(I,`,
        `).concat(t,",").concat(a+d-i*R[3])),M+="Z"}else if(v>0&&_===+_&&_>0){var H=Math.min(v,_);M="M ".concat(t,",").concat(a+i*H,`
            A `).concat(H,",").concat(H,",0,0,").concat(I,",").concat(t+P*H,",").concat(a,`
            L `).concat(t+l-P*H,",").concat(a,`
            A `).concat(H,",").concat(H,",0,0,").concat(I,",").concat(t+l,",").concat(a+i*H,`
            L `).concat(t+l,",").concat(a+d-i*H,`
            A `).concat(H,",").concat(H,",0,0,").concat(I,",").concat(t+l-P*H,",").concat(a+d,`
            L `).concat(t+P*H,",").concat(a+d,`
            A `).concat(H,",").concat(H,",0,0,").concat(I,",").concat(t,",").concat(a+d-i*H," Z")}else M="M ".concat(t,",").concat(a," h ").concat(l," v ").concat(d," h ").concat(-l," Z");return M},Fue=function(t,a){if(!t||!a)return!1;var l=t.x,d=t.y,_=a.x,v=a.y,i=a.width,P=a.height;if(Math.abs(i)>0&&Math.abs(P)>0){var I=Math.min(_,_+i),M=Math.max(_,_+i),R=Math.min(v,v+P),F=Math.max(v,v+P);return l>=I&&l<=M&&d>=R&&d<=F}return!1},Bue={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},bO=function(t){var a=_B(_B({},Bue),t),l=ie.useRef(),d=ie.useState(-1),_=Mue(d,2),v=_[0],i=_[1];ie.useEffect(function(){if(l.current&&l.current.getTotalLength)try{var se=l.current.getTotalLength();se&&i(se)}catch{}},[]);var P=a.x,I=a.y,M=a.width,R=a.height,F=a.radius,q=a.className,H=a.animationEasing,j=a.animationDuration,$=a.animationBegin,Y=a.isAnimationActive,K=a.isUpdateAnimationActive;if(P!==+P||I!==+I||M!==+M||R!==+R||M===0||R===0)return null;var re=Sn("recharts-rectangle",q);return K?He.createElement(Rl,{canBegin:v>0,from:{width:M,height:R,x:P,y:I},to:{width:M,height:R,x:P,y:I},duration:j,animationEasing:H,isActive:K},function(se){var J=se.width,ae=se.height,de=se.x,Pe=se.y;return He.createElement(Rl,{canBegin:v>0,from:"0px ".concat(v===-1?1:v,"px"),to:"".concat(v,"px 0px"),attributeName:"strokeDasharray",begin:$,duration:j,isActive:Y,easing:H},He.createElement("path",ib({},Jr(a,!0),{className:re,d:yB(de,Pe,J,ae,F),ref:l})))}):He.createElement("path",ib({},Jr(a,!0),{className:re,d:yB(P,I,M,R,F)}))},Uue=["points","className","baseLinePoints","connectNulls"];function hp(){return hp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},hp.apply(this,arguments)}function Vue(e,t){if(e==null)return{};var a=$ue(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function $ue(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function vB(e){return Wue(e)||Hue(e)||Gue(e)||que()}function que(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gue(e,t){if(e){if(typeof e=="string")return _I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _I(e,t)}}function Hue(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Wue(e){if(Array.isArray(e))return _I(e)}function _I(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}var xB=function(t){return t&&t.x===+t.x&&t.y===+t.y},Zue=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=[[]];return t.forEach(function(l){xB(l)?a[a.length-1].push(l):a[a.length-1].length>0&&a.push([])}),xB(t[0])&&a[a.length-1].push(t[0]),a[a.length-1].length<=0&&(a=a.slice(0,-1)),a},j_=function(t,a){var l=Zue(t);a&&(l=[l.reduce(function(_,v){return[].concat(vB(_),vB(v))},[])]);var d=l.map(function(_){return _.reduce(function(v,i,P){return"".concat(v).concat(P===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return l.length===1?"".concat(d,"Z"):d},Xue=function(t,a,l){var d=j_(t,l);return"".concat(d.slice(-1)==="Z"?d.slice(0,-1):d,"L").concat(j_(a.reverse(),l).slice(1))},Kue=function(t){var a=t.points,l=t.className,d=t.baseLinePoints,_=t.connectNulls,v=Vue(t,Uue);if(!a||!a.length)return null;var i=Sn("recharts-polygon",l);if(d&&d.length){var P=v.stroke&&v.stroke!=="none",I=Xue(a,d,_);return He.createElement("g",{className:i},He.createElement("path",hp({},Jr(v,!0),{fill:I.slice(-1)==="Z"?v.fill:"none",stroke:"none",d:I})),P?He.createElement("path",hp({},Jr(v,!0),{fill:"none",d:j_(a,_)})):null,P?He.createElement("path",hp({},Jr(v,!0),{fill:"none",d:j_(d,_)})):null)}var M=j_(a,_);return He.createElement("path",hp({},Jr(v,!0),{fill:M.slice(-1)==="Z"?v.fill:"none",className:i,d:M}))};function yI(){return yI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},yI.apply(this,arguments)}var hw=function(t){var a=t.cx,l=t.cy,d=t.r,_=t.className,v=Sn("recharts-dot",_);return a===+a&&l===+l&&d===+d?ie.createElement("circle",yI({},Jr(t,!1),P0(t),{className:v,cx:a,cy:l,r:d})):null};function gy(e){"@babel/helpers - typeof";return gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gy(e)}var Yue=["x","y","top","left","width","height","className"];function vI(){return vI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},vI.apply(this,arguments)}function bB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Jue(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?bB(Object(a),!0).forEach(function(l){Que(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Que(e,t,a){return t=ehe(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ehe(e){var t=the(e,"string");return gy(t)=="symbol"?t:t+""}function the(e,t){if(gy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(gy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rhe(e,t){if(e==null)return{};var a=nhe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function nhe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}var ihe=function(t,a,l,d,_,v){return"M".concat(t,",").concat(_,"v").concat(d,"M").concat(v,",").concat(a,"h").concat(l)},ohe=function(t){var a=t.x,l=a===void 0?0:a,d=t.y,_=d===void 0?0:d,v=t.top,i=v===void 0?0:v,P=t.left,I=P===void 0?0:P,M=t.width,R=M===void 0?0:M,F=t.height,q=F===void 0?0:F,H=t.className,j=rhe(t,Yue),$=Jue({x:l,y:_,top:i,left:I,width:R,height:q},j);return!fr(l)||!fr(_)||!fr(R)||!fr(q)||!fr(i)||!fr(I)?null:He.createElement("path",vI({},Jr($,!0),{className:Sn("recharts-cross",H),d:ihe(l,_,R,q,i,I)}))},x2,wB;function ahe(){if(wB)return x2;wB=1;var e=aw(),t=F$(),a=Ll();function l(d,_){return d&&d.length?e(d,a(_,2),t):void 0}return x2=l,x2}var she=ahe();const lhe=si(she);var b2,SB;function che(){if(SB)return b2;SB=1;var e=aw(),t=Ll(),a=B$();function l(d,_){return d&&d.length?e(d,t(_,2),a):void 0}return b2=l,b2}var uhe=che();const hhe=si(uhe);var dhe=["cx","cy","angle","ticks","axisLine"],fhe=["ticks","tick","angle","tickFormatter","stroke"];function Np(e){"@babel/helpers - typeof";return Np=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Np(e)}function z_(){return z_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},z_.apply(this,arguments)}function TB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Gh(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?TB(Object(a),!0).forEach(function(l){dw(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):TB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function AB(e,t){if(e==null)return{};var a=phe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function phe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function mhe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function EB(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,E6(l.key),l)}}function ghe(e,t,a){return t&&EB(e.prototype,t),a&&EB(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _he(e,t,a){return t=ob(t),yhe(e,A6()?Reflect.construct(t,a||[],ob(e).constructor):t.apply(e,a))}function yhe(e,t){if(t&&(Np(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vhe(e)}function vhe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(A6=function(){return!!e})()}function ob(e){return ob=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ob(e)}function xhe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xI(e,t)}function xI(e,t){return xI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},xI(e,t)}function dw(e,t,a){return t=E6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function E6(e){var t=bhe(e,"string");return Np(t)=="symbol"?t:t+""}function bhe(e,t){if(Np(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Np(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fw=(function(e){function t(){return mhe(this,t),_he(this,t,arguments)}return xhe(t,e),ghe(t,[{key:"getTickValueCoord",value:function(l){var d=l.coordinate,_=this.props,v=_.angle,i=_.cx,P=_.cy;return Ci(i,P,d,v)}},{key:"getTickTextAnchor",value:function(){var l=this.props.orientation,d;switch(l){case"left":d="end";break;case"right":d="start";break;default:d="middle";break}return d}},{key:"getViewBox",value:function(){var l=this.props,d=l.cx,_=l.cy,v=l.angle,i=l.ticks,P=lhe(i,function(M){return M.coordinate||0}),I=hhe(i,function(M){return M.coordinate||0});return{cx:d,cy:_,startAngle:v,endAngle:v,innerRadius:I.coordinate||0,outerRadius:P.coordinate||0}}},{key:"renderAxisLine",value:function(){var l=this.props,d=l.cx,_=l.cy,v=l.angle,i=l.ticks,P=l.axisLine,I=AB(l,dhe),M=i.reduce(function(H,j){return[Math.min(H[0],j.coordinate),Math.max(H[1],j.coordinate)]},[1/0,-1/0]),R=Ci(d,_,M[0],v),F=Ci(d,_,M[1],v),q=Gh(Gh(Gh({},Jr(I,!1)),{},{fill:"none"},Jr(P,!1)),{},{x1:R.x,y1:R.y,x2:F.x,y2:F.y});return He.createElement("line",z_({className:"recharts-polar-radius-axis-line"},q))}},{key:"renderTicks",value:function(){var l=this,d=this.props,_=d.ticks,v=d.tick,i=d.angle,P=d.tickFormatter,I=d.stroke,M=AB(d,fhe),R=this.getTickTextAnchor(),F=Jr(M,!1),q=Jr(v,!1),H=_.map(function(j,$){var Y=l.getTickValueCoord(j),K=Gh(Gh(Gh(Gh({textAnchor:R,transform:"rotate(".concat(90-i,", ").concat(Y.x,", ").concat(Y.y,")")},F),{},{stroke:"none",fill:I},q),{},{index:$},Y),{},{payload:j});return He.createElement(ti,z_({className:Sn("recharts-polar-radius-axis-tick",p6(v)),key:"tick-".concat(j.coordinate)},cd(l.props,j,$)),t.renderTickItem(v,K,P?P(j.value,$):j.value))});return He.createElement(ti,{className:"recharts-polar-radius-axis-ticks"},H)}},{key:"render",value:function(){var l=this.props,d=l.ticks,_=l.axisLine,v=l.tick;return!d||!d.length?null:He.createElement(ti,{className:Sn("recharts-polar-radius-axis",this.props.className)},_&&this.renderAxisLine(),v&&this.renderTicks(),Io.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(l,d,_){var v;return He.isValidElement(l)?v=He.cloneElement(l,d):pn(l)?v=l(d):v=He.createElement(ud,z_({},d,{className:"recharts-polar-radius-axis-tick-value"}),_),v}}])})(ie.PureComponent);dw(fw,"displayName","PolarRadiusAxis");dw(fw,"axisType","radiusAxis");dw(fw,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Lp(e){"@babel/helpers - typeof";return Lp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lp(e)}function Xh(){return Xh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},Xh.apply(this,arguments)}function PB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Hh(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?PB(Object(a),!0).forEach(function(l){pw(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):PB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function whe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IB(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,I6(l.key),l)}}function She(e,t,a){return t&&IB(e.prototype,t),a&&IB(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function The(e,t,a){return t=ab(t),Ahe(e,P6()?Reflect.construct(t,a||[],ab(e).constructor):t.apply(e,a))}function Ahe(e,t){if(t&&(Lp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ehe(e)}function Ehe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(P6=function(){return!!e})()}function ab(e){return ab=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ab(e)}function Phe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bI(e,t)}function bI(e,t){return bI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},bI(e,t)}function pw(e,t,a){return t=I6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function I6(e){var t=Ihe(e,"string");return Lp(t)=="symbol"?t:t+""}function Ihe(e,t){if(Lp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Lp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Che=Math.PI/180,CB=1e-5,mw=(function(e){function t(){return whe(this,t),The(this,t,arguments)}return Phe(t,e),She(t,[{key:"getTickLineCoord",value:function(l){var d=this.props,_=d.cx,v=d.cy,i=d.radius,P=d.orientation,I=d.tickSize,M=I||8,R=Ci(_,v,i,l.coordinate),F=Ci(_,v,i+(P==="inner"?-1:1)*M,l.coordinate);return{x1:R.x,y1:R.y,x2:F.x,y2:F.y}}},{key:"getTickTextAnchor",value:function(l){var d=this.props.orientation,_=Math.cos(-l.coordinate*Che),v;return _>CB?v=d==="outer"?"start":"end":_<-CB?v=d==="outer"?"end":"start":v="middle",v}},{key:"renderAxisLine",value:function(){var l=this.props,d=l.cx,_=l.cy,v=l.radius,i=l.axisLine,P=l.axisLineType,I=Hh(Hh({},Jr(this.props,!1)),{},{fill:"none"},Jr(i,!1));if(P==="circle")return He.createElement(hw,Xh({className:"recharts-polar-angle-axis-line"},I,{cx:d,cy:_,r:v}));var M=this.props.ticks,R=M.map(function(F){return Ci(d,_,v,F.coordinate)});return He.createElement(Kue,Xh({className:"recharts-polar-angle-axis-line"},I,{points:R}))}},{key:"renderTicks",value:function(){var l=this,d=this.props,_=d.ticks,v=d.tick,i=d.tickLine,P=d.tickFormatter,I=d.stroke,M=Jr(this.props,!1),R=Jr(v,!1),F=Hh(Hh({},M),{},{fill:"none"},Jr(i,!1)),q=_.map(function(H,j){var $=l.getTickLineCoord(H),Y=l.getTickTextAnchor(H),K=Hh(Hh(Hh({textAnchor:Y},M),{},{stroke:"none",fill:I},R),{},{index:j,payload:H,x:$.x2,y:$.y2});return He.createElement(ti,Xh({className:Sn("recharts-polar-angle-axis-tick",p6(v)),key:"tick-".concat(H.coordinate)},cd(l.props,H,j)),i&&He.createElement("line",Xh({className:"recharts-polar-angle-axis-tick-line"},F,$)),v&&t.renderTickItem(v,K,P?P(H.value,j):H.value))});return He.createElement(ti,{className:"recharts-polar-angle-axis-ticks"},q)}},{key:"render",value:function(){var l=this.props,d=l.ticks,_=l.radius,v=l.axisLine;return _<=0||!d||!d.length?null:He.createElement(ti,{className:Sn("recharts-polar-angle-axis",this.props.className)},v&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(l,d,_){var v;return He.isValidElement(l)?v=He.cloneElement(l,d):pn(l)?v=l(d):v=He.createElement(ud,Xh({},d,{className:"recharts-polar-angle-axis-tick-value"}),_),v}}])})(ie.PureComponent);pw(mw,"displayName","PolarAngleAxis");pw(mw,"axisType","angleAxis");pw(mw,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var w2,OB;function Ohe(){if(OB)return w2;OB=1;var e=zV(),t=e(Object.getPrototypeOf,Object);return w2=t,w2}var S2,MB;function Mhe(){if(MB)return S2;MB=1;var e=Dc(),t=Ohe(),a=kc(),l="[object Object]",d=Function.prototype,_=Object.prototype,v=d.toString,i=_.hasOwnProperty,P=v.call(Object);function I(M){if(!a(M)||e(M)!=l)return!1;var R=t(M);if(R===null)return!0;var F=i.call(R,"constructor")&&R.constructor;return typeof F=="function"&&F instanceof F&&v.call(F)==P}return S2=I,S2}var Rhe=Mhe();const Dhe=si(Rhe);var T2,RB;function khe(){if(RB)return T2;RB=1;var e=Dc(),t=kc(),a="[object Boolean]";function l(d){return d===!0||d===!1||t(d)&&e(d)==a}return T2=l,T2}var Nhe=khe();const Lhe=si(Nhe);function _y(e){"@babel/helpers - typeof";return _y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_y(e)}function sb(){return sb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},sb.apply(this,arguments)}function jhe(e,t){return Uhe(e)||Bhe(e,t)||Fhe(e,t)||zhe()}function zhe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fhe(e,t){if(e){if(typeof e=="string")return DB(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return DB(e,t)}}function DB(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Bhe(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Uhe(e){if(Array.isArray(e))return e}function kB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function NB(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?kB(Object(a),!0).forEach(function(l){Vhe(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Vhe(e,t,a){return t=$he(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $he(e){var t=qhe(e,"string");return _y(t)=="symbol"?t:t+""}function qhe(e,t){if(_y(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(_y(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var LB=function(t,a,l,d,_){var v=l-d,i;return i="M ".concat(t,",").concat(a),i+="L ".concat(t+l,",").concat(a),i+="L ".concat(t+l-v/2,",").concat(a+_),i+="L ".concat(t+l-v/2-d,",").concat(a+_),i+="L ".concat(t,",").concat(a," Z"),i},Ghe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Hhe=function(t){var a=NB(NB({},Ghe),t),l=ie.useRef(),d=ie.useState(-1),_=jhe(d,2),v=_[0],i=_[1];ie.useEffect(function(){if(l.current&&l.current.getTotalLength)try{var re=l.current.getTotalLength();re&&i(re)}catch{}},[]);var P=a.x,I=a.y,M=a.upperWidth,R=a.lowerWidth,F=a.height,q=a.className,H=a.animationEasing,j=a.animationDuration,$=a.animationBegin,Y=a.isUpdateAnimationActive;if(P!==+P||I!==+I||M!==+M||R!==+R||F!==+F||M===0&&R===0||F===0)return null;var K=Sn("recharts-trapezoid",q);return Y?He.createElement(Rl,{canBegin:v>0,from:{upperWidth:0,lowerWidth:0,height:F,x:P,y:I},to:{upperWidth:M,lowerWidth:R,height:F,x:P,y:I},duration:j,animationEasing:H,isActive:Y},function(re){var se=re.upperWidth,J=re.lowerWidth,ae=re.height,de=re.x,Pe=re.y;return He.createElement(Rl,{canBegin:v>0,from:"0px ".concat(v===-1?1:v,"px"),to:"".concat(v,"px 0px"),attributeName:"strokeDasharray",begin:$,duration:j,easing:H},He.createElement("path",sb({},Jr(a,!0),{className:K,d:LB(de,Pe,se,J,ae),ref:l})))}):He.createElement("g",null,He.createElement("path",sb({},Jr(a,!0),{className:K,d:LB(P,I,M,R,F)})))},Whe=["option","shapeType","propTransformer","activeClassName","isActive"];function yy(e){"@babel/helpers - typeof";return yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yy(e)}function Zhe(e,t){if(e==null)return{};var a=Xhe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function Xhe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function jB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function lb(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?jB(Object(a),!0).forEach(function(l){Khe(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Khe(e,t,a){return t=Yhe(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Yhe(e){var t=Jhe(e,"string");return yy(t)=="symbol"?t:t+""}function Jhe(e,t){if(yy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(yy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Qhe(e,t){return lb(lb({},t),e)}function ede(e,t){return e==="symbols"}function zB(e){var t=e.shapeType,a=e.elementProps;switch(t){case"rectangle":return He.createElement(bO,a);case"trapezoid":return He.createElement(Hhe,a);case"sector":return He.createElement(_6,a);case"symbols":if(ede(t))return He.createElement(BC,a);break;default:return null}}function tde(e){return ie.isValidElement(e)?e.props:e}function C6(e){var t=e.option,a=e.shapeType,l=e.propTransformer,d=l===void 0?Qhe:l,_=e.activeClassName,v=_===void 0?"recharts-active-shape":_,i=e.isActive,P=Zhe(e,Whe),I;if(ie.isValidElement(t))I=ie.cloneElement(t,lb(lb({},P),tde(t)));else if(pn(t))I=t(P);else if(Dhe(t)&&!Lhe(t)){var M=d(t,P);I=He.createElement(zB,{shapeType:a,elementProps:M})}else{var R=P;I=He.createElement(zB,{shapeType:a,elementProps:R})}return i?He.createElement(ti,{className:v},I):I}function gw(e,t){return t!=null&&"trapezoids"in e.props}function _w(e,t){return t!=null&&"sectors"in e.props}function vy(e,t){return t!=null&&"points"in e.props}function rde(e,t){var a,l,d=e.x===(t==null||(a=t.labelViewBox)===null||a===void 0?void 0:a.x)||e.x===t.x,_=e.y===(t==null||(l=t.labelViewBox)===null||l===void 0?void 0:l.y)||e.y===t.y;return d&&_}function nde(e,t){var a=e.endAngle===t.endAngle,l=e.startAngle===t.startAngle;return a&&l}function ide(e,t){var a=e.x===t.x,l=e.y===t.y,d=e.z===t.z;return a&&l&&d}function ode(e,t){var a;return gw(e,t)?a=rde:_w(e,t)?a=nde:vy(e,t)&&(a=ide),a}function ade(e,t){var a;return gw(e,t)?a="trapezoids":_w(e,t)?a="sectors":vy(e,t)&&(a="points"),a}function sde(e,t){if(gw(e,t)){var a;return(a=t.tooltipPayload)===null||a===void 0||(a=a[0])===null||a===void 0||(a=a.payload)===null||a===void 0?void 0:a.payload}if(_w(e,t)){var l;return(l=t.tooltipPayload)===null||l===void 0||(l=l[0])===null||l===void 0||(l=l.payload)===null||l===void 0?void 0:l.payload}return vy(e,t)?t.payload:{}}function lde(e){var t=e.activeTooltipItem,a=e.graphicalItem,l=e.itemData,d=ade(a,t),_=sde(a,t),v=l.filter(function(P,I){var M=By(_,P),R=a.props[d].filter(function(H){var j=ode(a,t);return j(H,t)}),F=a.props[d].indexOf(R[R.length-1]),q=I===F;return M&&q}),i=l.indexOf(v[v.length-1]);return i}var m0;function jp(e){"@babel/helpers - typeof";return jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jp(e)}function dp(){return dp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},dp.apply(this,arguments)}function FB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Ei(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?FB(Object(a),!0).forEach(function(l){ds(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):FB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function cde(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BB(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,M6(l.key),l)}}function ude(e,t,a){return t&&BB(e.prototype,t),a&&BB(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function hde(e,t,a){return t=cb(t),dde(e,O6()?Reflect.construct(t,a||[],cb(e).constructor):t.apply(e,a))}function dde(e,t){if(t&&(jp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fde(e)}function fde(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(O6=function(){return!!e})()}function cb(e){return cb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},cb(e)}function pde(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&wI(e,t)}function wI(e,t){return wI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},wI(e,t)}function ds(e,t,a){return t=M6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function M6(e){var t=mde(e,"string");return jp(t)=="symbol"?t:t+""}function mde(e,t){if(jp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(jp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Dl=(function(e){function t(a){var l;return cde(this,t),l=hde(this,t,[a]),ds(l,"pieRef",null),ds(l,"sectorRefs",[]),ds(l,"id",sm("recharts-pie-")),ds(l,"handleAnimationEnd",function(){var d=l.props.onAnimationEnd;l.setState({isAnimationFinished:!0}),pn(d)&&d()}),ds(l,"handleAnimationStart",function(){var d=l.props.onAnimationStart;l.setState({isAnimationFinished:!1}),pn(d)&&d()}),l.state={isAnimationFinished:!a.isAnimationActive,prevIsAnimationActive:a.isAnimationActive,prevAnimationId:a.animationId,sectorToFocus:0},l}return pde(t,e),ude(t,[{key:"isActiveIndex",value:function(l){var d=this.props.activeIndex;return Array.isArray(d)?d.indexOf(l)!==-1:l===d}},{key:"hasActiveIndex",value:function(){var l=this.props.activeIndex;return Array.isArray(l)?l.length!==0:l||l===0}},{key:"renderLabels",value:function(l){var d=this.props.isAnimationActive;if(d&&!this.state.isAnimationFinished)return null;var _=this.props,v=_.label,i=_.labelLine,P=_.dataKey,I=_.valueKey,M=Jr(this.props,!1),R=Jr(v,!1),F=Jr(i,!1),q=v&&v.offsetRadius||20,H=l.map(function(j,$){var Y=(j.startAngle+j.endAngle)/2,K=Ci(j.cx,j.cy,j.outerRadius+q,Y),re=Ei(Ei(Ei(Ei({},M),j),{},{stroke:"none"},R),{},{index:$,textAnchor:t.getTextAnchor(K.x,j.cx)},K),se=Ei(Ei(Ei(Ei({},M),j),{},{fill:"none",stroke:j.fill},F),{},{index:$,points:[Ci(j.cx,j.cy,j.outerRadius,Y),K]}),J=P;return xn(P)&&xn(I)?J="value":xn(P)&&(J=I),He.createElement(ti,{key:"label-".concat(j.startAngle,"-").concat(j.endAngle,"-").concat(j.midAngle,"-").concat($)},i&&t.renderLabelLineItem(i,se,"line"),t.renderLabelItem(v,re,mo(j,J)))});return He.createElement(ti,{className:"recharts-pie-labels"},H)}},{key:"renderSectorsStatically",value:function(l){var d=this,_=this.props,v=_.activeShape,i=_.blendStroke,P=_.inactiveShape;return l.map(function(I,M){if(I?.startAngle===0&&I?.endAngle===0&&l.length!==1)return null;var R=d.isActiveIndex(M),F=P&&d.hasActiveIndex()?P:null,q=R?v:F,H=Ei(Ei({},I),{},{stroke:i?I.fill:I.stroke,tabIndex:-1});return He.createElement(ti,dp({ref:function($){$&&!d.sectorRefs.includes($)&&d.sectorRefs.push($)},tabIndex:-1,className:"recharts-pie-sector"},cd(d.props,I,M),{key:"sector-".concat(I?.startAngle,"-").concat(I?.endAngle,"-").concat(I.midAngle,"-").concat(M)}),He.createElement(C6,dp({option:q,isActive:R,shapeType:"sector"},H)))})}},{key:"renderSectorsWithAnimation",value:function(){var l=this,d=this.props,_=d.sectors,v=d.isAnimationActive,i=d.animationBegin,P=d.animationDuration,I=d.animationEasing,M=d.animationId,R=this.state,F=R.prevSectors,q=R.prevIsAnimationActive;return He.createElement(Rl,{begin:i,duration:P,isActive:v,easing:I,from:{t:0},to:{t:1},key:"pie-".concat(M,"-").concat(q),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(H){var j=H.t,$=[],Y=_&&_[0],K=Y.startAngle;return _.forEach(function(re,se){var J=F&&F[se],ae=se>0?Va(re,"paddingAngle",0):0;if(J){var de=za(J.endAngle-J.startAngle,re.endAngle-re.startAngle),Pe=Ei(Ei({},re),{},{startAngle:K+ae,endAngle:K+de(j)+ae});$.push(Pe),K=Pe.endAngle}else{var Ne=re.endAngle,rt=re.startAngle,ke=za(0,Ne-rt),Ze=ke(j),nt=Ei(Ei({},re),{},{startAngle:K+ae,endAngle:K+Ze+ae});$.push(nt),K=nt.endAngle}}),He.createElement(ti,null,l.renderSectorsStatically($))})}},{key:"attachKeyboardHandlers",value:function(l){var d=this;l.onkeydown=function(_){if(!_.altKey)switch(_.key){case"ArrowLeft":{var v=++d.state.sectorToFocus%d.sectorRefs.length;d.sectorRefs[v].focus(),d.setState({sectorToFocus:v});break}case"ArrowRight":{var i=--d.state.sectorToFocus<0?d.sectorRefs.length-1:d.state.sectorToFocus%d.sectorRefs.length;d.sectorRefs[i].focus(),d.setState({sectorToFocus:i});break}case"Escape":{d.sectorRefs[d.state.sectorToFocus].blur(),d.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var l=this.props,d=l.sectors,_=l.isAnimationActive,v=this.state.prevSectors;return _&&d&&d.length&&(!v||!By(v,d))?this.renderSectorsWithAnimation():this.renderSectorsStatically(d)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var l=this,d=this.props,_=d.hide,v=d.sectors,i=d.className,P=d.label,I=d.cx,M=d.cy,R=d.innerRadius,F=d.outerRadius,q=d.isAnimationActive,H=this.state.isAnimationFinished;if(_||!v||!v.length||!fr(I)||!fr(M)||!fr(R)||!fr(F))return null;var j=Sn("recharts-pie",i);return He.createElement(ti,{tabIndex:this.props.rootTabIndex,className:j,ref:function(Y){l.pieRef=Y}},this.renderSectors(),P&&this.renderLabels(v),Io.renderCallByParent(this.props,null,!1),(!q||H)&&Ac.renderCallByParent(this.props,v,!1))}}],[{key:"getDerivedStateFromProps",value:function(l,d){return d.prevIsAnimationActive!==l.isAnimationActive?{prevIsAnimationActive:l.isAnimationActive,prevAnimationId:l.animationId,curSectors:l.sectors,prevSectors:[],isAnimationFinished:!0}:l.isAnimationActive&&l.animationId!==d.prevAnimationId?{prevAnimationId:l.animationId,curSectors:l.sectors,prevSectors:d.curSectors,isAnimationFinished:!0}:l.sectors!==d.curSectors?{curSectors:l.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(l,d){return l>d?"start":l<d?"end":"middle"}},{key:"renderLabelLineItem",value:function(l,d,_){if(He.isValidElement(l))return He.cloneElement(l,d);if(pn(l))return l(d);var v=Sn("recharts-pie-label-line",typeof l!="boolean"?l.className:"");return He.createElement(eb,dp({},d,{key:_,type:"linear",className:v}))}},{key:"renderLabelItem",value:function(l,d,_){if(He.isValidElement(l))return He.cloneElement(l,d);var v=_;if(pn(l)&&(v=l(d),He.isValidElement(v)))return v;var i=Sn("recharts-pie-label-text",typeof l!="boolean"&&!pn(l)?l.className:"");return He.createElement(ud,dp({},d,{alignmentBaseline:"middle",className:i}),v)}}])})(ie.PureComponent);m0=Dl;ds(Dl,"displayName","Pie");ds(Dl,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!yd.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});ds(Dl,"parseDeltaAngle",function(e,t){var a=la(t-e),l=Math.min(Math.abs(t-e),360);return a*l});ds(Dl,"getRealPieData",function(e){var t=e.data,a=e.children,l=Jr(e,!1),d=$a(a,yp);return t&&t.length?t.map(function(_,v){return Ei(Ei(Ei({payload:_},l),_),d&&d[v]&&d[v].props)}):d&&d.length?d.map(function(_){return Ei(Ei({},l),_.props)}):[]});ds(Dl,"parseCoordinateOfPie",function(e,t){var a=t.top,l=t.left,d=t.width,_=t.height,v=f6(d,_),i=l+ca(e.cx,d,d/2),P=a+ca(e.cy,_,_/2),I=ca(e.innerRadius,v,0),M=ca(e.outerRadius,v,v*.8),R=e.maxRadius||Math.sqrt(d*d+_*_)/2;return{cx:i,cy:P,innerRadius:I,outerRadius:M,maxRadius:R}});ds(Dl,"getComposedData",function(e){var t=e.item,a=e.offset,l=t.type.defaultProps!==void 0?Ei(Ei({},t.type.defaultProps),t.props):t.props,d=m0.getRealPieData(l);if(!d||!d.length)return null;var _=l.cornerRadius,v=l.startAngle,i=l.endAngle,P=l.paddingAngle,I=l.dataKey,M=l.nameKey,R=l.valueKey,F=l.tooltipType,q=Math.abs(l.minAngle),H=m0.parseCoordinateOfPie(l,a),j=m0.parseDeltaAngle(v,i),$=Math.abs(j),Y=I;xn(I)&&xn(R)?(Vs(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),Y="value"):xn(I)&&(Vs(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),Y=R);var K=d.filter(function(Pe){return mo(Pe,Y,0)!==0}).length,re=($>=360?K:K-1)*P,se=$-K*q-re,J=d.reduce(function(Pe,Ne){var rt=mo(Ne,Y,0);return Pe+(fr(rt)?rt:0)},0),ae;if(J>0){var de;ae=d.map(function(Pe,Ne){var rt=mo(Pe,Y,0),ke=mo(Pe,M,Ne),Ze=(fr(rt)?rt:0)/J,nt;Ne?nt=de.endAngle+la(j)*P*(rt!==0?1:0):nt=v;var Je=nt+la(j)*((rt!==0?q:0)+Ze*se),ot=(nt+Je)/2,it=(H.innerRadius+H.outerRadius)/2,Pt=[{name:ke,value:rt,payload:Pe,dataKey:Y,type:F}],Ot=Ci(H.cx,H.cy,it,ot);return de=Ei(Ei(Ei({percent:Ze,cornerRadius:_,name:ke,tooltipPayload:Pt,midAngle:ot,middleRadius:it,tooltipPosition:Ot},Pe),H),{},{value:mo(Pe,Y),startAngle:nt,endAngle:Je,payload:Pe,paddingAngle:la(j)*P}),de})}return Ei(Ei({},H),{},{sectors:ae,data:d})});var A2,UB;function gde(){if(UB)return A2;UB=1;var e=Math.ceil,t=Math.max;function a(l,d,_,v){for(var i=-1,P=t(e((d-l)/(_||1)),0),I=Array(P);P--;)I[v?P:++i]=l,l+=_;return I}return A2=a,A2}var E2,VB;function R6(){if(VB)return E2;VB=1;var e=e$(),t=1/0,a=17976931348623157e292;function l(d){if(!d)return d===0?d:0;if(d=e(d),d===t||d===-t){var _=d<0?-1:1;return _*a}return d===d?d:0}return E2=l,E2}var P2,$B;function _de(){if($B)return P2;$B=1;var e=gde(),t=Qb(),a=R6();function l(d){return function(_,v,i){return i&&typeof i!="number"&&t(_,v,i)&&(v=i=void 0),_=a(_),v===void 0?(v=_,_=0):v=a(v),i=i===void 0?_<v?1:-1:a(i),e(_,v,i,d)}}return P2=l,P2}var I2,qB;function yde(){if(qB)return I2;qB=1;var e=_de(),t=e();return I2=t,I2}var vde=yde();const ub=si(vde);function xy(e){"@babel/helpers - typeof";return xy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xy(e)}function GB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function HB(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?GB(Object(a),!0).forEach(function(l){D6(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):GB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function D6(e,t,a){return t=xde(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function xde(e){var t=bde(e,"string");return xy(t)=="symbol"?t:t+""}function bde(e,t){if(xy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(xy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wde=["Webkit","Moz","O","ms"],Sde=function(t,a){var l=t.replace(/(\w)/,function(_){return _.toUpperCase()}),d=wde.reduce(function(_,v){return HB(HB({},_),{},D6({},v+l,a))},{});return d[t]=a,d};function zp(e){"@babel/helpers - typeof";return zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zp(e)}function hb(){return hb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},hb.apply(this,arguments)}function WB(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function C2(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?WB(Object(a),!0).forEach(function(l){Da(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):WB(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Tde(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ZB(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,N6(l.key),l)}}function Ade(e,t,a){return t&&ZB(e.prototype,t),a&&ZB(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ede(e,t,a){return t=db(t),Pde(e,k6()?Reflect.construct(t,a||[],db(e).constructor):t.apply(e,a))}function Pde(e,t){if(t&&(zp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ide(e)}function Ide(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(k6=function(){return!!e})()}function db(e){return db=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},db(e)}function Cde(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&SI(e,t)}function SI(e,t){return SI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},SI(e,t)}function Da(e,t,a){return t=N6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function N6(e){var t=Ode(e,"string");return zp(t)=="symbol"?t:t+""}function Ode(e,t){if(zp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(zp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Mde=function(t){var a=t.data,l=t.startIndex,d=t.endIndex,_=t.x,v=t.width,i=t.travellerWidth;if(!a||!a.length)return{};var P=a.length,I=k_().domain(ub(0,P)).range([_,_+v-i]),M=I.domain().map(function(R){return I(R)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:I(l),endX:I(d),scale:I,scaleValues:M}},XB=function(t){return t.changedTouches&&!!t.changedTouches.length},Fp=(function(e){function t(a){var l;return Tde(this,t),l=Ede(this,t,[a]),Da(l,"handleDrag",function(d){l.leaveTimer&&(clearTimeout(l.leaveTimer),l.leaveTimer=null),l.state.isTravellerMoving?l.handleTravellerMove(d):l.state.isSlideMoving&&l.handleSlideDrag(d)}),Da(l,"handleTouchMove",function(d){d.changedTouches!=null&&d.changedTouches.length>0&&l.handleDrag(d.changedTouches[0])}),Da(l,"handleDragEnd",function(){l.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var d=l.props,_=d.endIndex,v=d.onDragEnd,i=d.startIndex;v?.({endIndex:_,startIndex:i})}),l.detachDragEndListener()}),Da(l,"handleLeaveWrapper",function(){(l.state.isTravellerMoving||l.state.isSlideMoving)&&(l.leaveTimer=window.setTimeout(l.handleDragEnd,l.props.leaveTimeOut))}),Da(l,"handleEnterSlideOrTraveller",function(){l.setState({isTextActive:!0})}),Da(l,"handleLeaveSlideOrTraveller",function(){l.setState({isTextActive:!1})}),Da(l,"handleSlideDragStart",function(d){var _=XB(d)?d.changedTouches[0]:d;l.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:_.pageX}),l.attachDragEndListener()}),l.travellerDragStartHandlers={startX:l.handleTravellerDragStart.bind(l,"startX"),endX:l.handleTravellerDragStart.bind(l,"endX")},l.state={},l}return Cde(t,e),Ade(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(l){var d=l.startX,_=l.endX,v=this.state.scaleValues,i=this.props,P=i.gap,I=i.data,M=I.length-1,R=Math.min(d,_),F=Math.max(d,_),q=t.getIndexInRange(v,R),H=t.getIndexInRange(v,F);return{startIndex:q-q%P,endIndex:H===M?M:H-H%P}}},{key:"getTextOfTick",value:function(l){var d=this.props,_=d.data,v=d.tickFormatter,i=d.dataKey,P=mo(_[l],i,l);return pn(v)?v(P,l):P}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(l){var d=this.state,_=d.slideMoveStartX,v=d.startX,i=d.endX,P=this.props,I=P.x,M=P.width,R=P.travellerWidth,F=P.startIndex,q=P.endIndex,H=P.onChange,j=l.pageX-_;j>0?j=Math.min(j,I+M-R-i,I+M-R-v):j<0&&(j=Math.max(j,I-v,I-i));var $=this.getIndex({startX:v+j,endX:i+j});($.startIndex!==F||$.endIndex!==q)&&H&&H($),this.setState({startX:v+j,endX:i+j,slideMoveStartX:l.pageX})}},{key:"handleTravellerDragStart",value:function(l,d){var _=XB(d)?d.changedTouches[0]:d;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:l,brushMoveStartX:_.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(l){var d=this.state,_=d.brushMoveStartX,v=d.movingTravellerId,i=d.endX,P=d.startX,I=this.state[v],M=this.props,R=M.x,F=M.width,q=M.travellerWidth,H=M.onChange,j=M.gap,$=M.data,Y={startX:this.state.startX,endX:this.state.endX},K=l.pageX-_;K>0?K=Math.min(K,R+F-q-I):K<0&&(K=Math.max(K,R-I)),Y[v]=I+K;var re=this.getIndex(Y),se=re.startIndex,J=re.endIndex,ae=function(){var Pe=$.length-1;return v==="startX"&&(i>P?se%j===0:J%j===0)||i<P&&J===Pe||v==="endX"&&(i>P?J%j===0:se%j===0)||i>P&&J===Pe};this.setState(Da(Da({},v,I+K),"brushMoveStartX",l.pageX),function(){H&&ae()&&H(re)})}},{key:"handleTravellerMoveKeyboard",value:function(l,d){var _=this,v=this.state,i=v.scaleValues,P=v.startX,I=v.endX,M=this.state[d],R=i.indexOf(M);if(R!==-1){var F=R+l;if(!(F===-1||F>=i.length)){var q=i[F];d==="startX"&&q>=I||d==="endX"&&q<=P||this.setState(Da({},d,q),function(){_.props.onChange(_.getIndex({startX:_.state.startX,endX:_.state.endX}))})}}}},{key:"renderBackground",value:function(){var l=this.props,d=l.x,_=l.y,v=l.width,i=l.height,P=l.fill,I=l.stroke;return He.createElement("rect",{stroke:I,fill:P,x:d,y:_,width:v,height:i})}},{key:"renderPanorama",value:function(){var l=this.props,d=l.x,_=l.y,v=l.width,i=l.height,P=l.data,I=l.children,M=l.padding,R=ie.Children.only(I);return R?He.cloneElement(R,{x:d,y:_,width:v,height:i,margin:M,compact:!0,data:P}):null}},{key:"renderTravellerLayer",value:function(l,d){var _,v,i=this,P=this.props,I=P.y,M=P.travellerWidth,R=P.height,F=P.traveller,q=P.ariaLabel,H=P.data,j=P.startIndex,$=P.endIndex,Y=Math.max(l,this.props.x),K=C2(C2({},Jr(this.props,!1)),{},{x:Y,y:I,width:M,height:R}),re=q||"Min value: ".concat((_=H[j])===null||_===void 0?void 0:_.name,", Max value: ").concat((v=H[$])===null||v===void 0?void 0:v.name);return He.createElement(ti,{tabIndex:0,role:"slider","aria-label":re,"aria-valuenow":l,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[d],onTouchStart:this.travellerDragStartHandlers[d],onKeyDown:function(J){["ArrowLeft","ArrowRight"].includes(J.key)&&(J.preventDefault(),J.stopPropagation(),i.handleTravellerMoveKeyboard(J.key==="ArrowRight"?1:-1,d))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(F,K))}},{key:"renderSlide",value:function(l,d){var _=this.props,v=_.y,i=_.height,P=_.stroke,I=_.travellerWidth,M=Math.min(l,d)+I,R=Math.max(Math.abs(d-l)-I,0);return He.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:P,fillOpacity:.2,x:M,y:v,width:R,height:i})}},{key:"renderText",value:function(){var l=this.props,d=l.startIndex,_=l.endIndex,v=l.y,i=l.height,P=l.travellerWidth,I=l.stroke,M=this.state,R=M.startX,F=M.endX,q=5,H={pointerEvents:"none",fill:I};return He.createElement(ti,{className:"recharts-brush-texts"},He.createElement(ud,hb({textAnchor:"end",verticalAnchor:"middle",x:Math.min(R,F)-q,y:v+i/2},H),this.getTextOfTick(d)),He.createElement(ud,hb({textAnchor:"start",verticalAnchor:"middle",x:Math.max(R,F)+P+q,y:v+i/2},H),this.getTextOfTick(_)))}},{key:"render",value:function(){var l=this.props,d=l.data,_=l.className,v=l.children,i=l.x,P=l.y,I=l.width,M=l.height,R=l.alwaysShowText,F=this.state,q=F.startX,H=F.endX,j=F.isTextActive,$=F.isSlideMoving,Y=F.isTravellerMoving,K=F.isTravellerFocused;if(!d||!d.length||!fr(i)||!fr(P)||!fr(I)||!fr(M)||I<=0||M<=0)return null;var re=Sn("recharts-brush",_),se=He.Children.count(v)===1,J=Sde("userSelect","none");return He.createElement(ti,{className:re,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:J},this.renderBackground(),se&&this.renderPanorama(),this.renderSlide(q,H),this.renderTravellerLayer(q,"startX"),this.renderTravellerLayer(H,"endX"),(j||$||Y||K||R)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(l){var d=l.x,_=l.y,v=l.width,i=l.height,P=l.stroke,I=Math.floor(_+i/2)-1;return He.createElement(He.Fragment,null,He.createElement("rect",{x:d,y:_,width:v,height:i,fill:P,stroke:"none"}),He.createElement("line",{x1:d+1,y1:I,x2:d+v-1,y2:I,fill:"none",stroke:"#fff"}),He.createElement("line",{x1:d+1,y1:I+2,x2:d+v-1,y2:I+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(l,d){var _;return He.isValidElement(l)?_=He.cloneElement(l,d):pn(l)?_=l(d):_=t.renderDefaultTraveller(d),_}},{key:"getDerivedStateFromProps",value:function(l,d){var _=l.data,v=l.width,i=l.x,P=l.travellerWidth,I=l.updateId,M=l.startIndex,R=l.endIndex;if(_!==d.prevData||I!==d.prevUpdateId)return C2({prevData:_,prevTravellerWidth:P,prevUpdateId:I,prevX:i,prevWidth:v},_&&_.length?Mde({data:_,width:v,x:i,travellerWidth:P,startIndex:M,endIndex:R}):{scale:null,scaleValues:null});if(d.scale&&(v!==d.prevWidth||i!==d.prevX||P!==d.prevTravellerWidth)){d.scale.range([i,i+v-P]);var F=d.scale.domain().map(function(q){return d.scale(q)});return{prevData:_,prevTravellerWidth:P,prevUpdateId:I,prevX:i,prevWidth:v,startX:d.scale(l.startIndex),endX:d.scale(l.endIndex),scaleValues:F}}return null}},{key:"getIndexInRange",value:function(l,d){for(var _=l.length,v=0,i=_-1;i-v>1;){var P=Math.floor((v+i)/2);l[P]>d?i=P:v=P}return d>=l[i]?i:v}}])})(ie.PureComponent);Da(Fp,"displayName","Brush");Da(Fp,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var O2,KB;function Rde(){if(KB)return O2;KB=1;var e=WC();function t(a,l){var d;return e(a,function(_,v,i){return d=l(_,v,i),!d}),!!d}return O2=t,O2}var M2,YB;function Dde(){if(YB)return M2;YB=1;var e=MV(),t=Ll(),a=Rde(),l=_a(),d=Qb();function _(v,i,P){var I=l(v)?e:a;return P&&d(v,i,P)&&(i=void 0),I(v,t(i,3))}return M2=_,M2}var kde=Dde();const Nde=si(kde);var Pl=function(t,a){var l=t.alwaysShow,d=t.ifOverflow;return l&&(d="extendDomain"),d===a},R2,JB;function Lde(){if(JB)return R2;JB=1;var e=XV();function t(a,l,d){l=="__proto__"&&e?e(a,l,{configurable:!0,enumerable:!0,value:d,writable:!0}):a[l]=d}return R2=t,R2}var D2,QB;function jde(){if(QB)return D2;QB=1;var e=Lde(),t=WV(),a=Ll();function l(d,_){var v={};return _=a(_,3),t(d,function(i,P,I){e(v,P,_(i,P,I))}),v}return D2=l,D2}var zde=jde();const Fde=si(zde);var k2,e5;function Bde(){if(e5)return k2;e5=1;function e(t,a){for(var l=-1,d=t==null?0:t.length;++l<d;)if(!a(t[l],l,t))return!1;return!0}return k2=e,k2}var N2,t5;function Ude(){if(t5)return N2;t5=1;var e=WC();function t(a,l){var d=!0;return e(a,function(_,v,i){return d=!!l(_,v,i),d}),d}return N2=t,N2}var L2,r5;function Vde(){if(r5)return L2;r5=1;var e=Bde(),t=Ude(),a=Ll(),l=_a(),d=Qb();function _(v,i,P){var I=l(v)?e:t;return P&&d(v,i,P)&&(i=void 0),I(v,a(i,3))}return L2=_,L2}var $de=Vde();const L6=si($de);var qde=["x","y"];function by(e){"@babel/helpers - typeof";return by=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},by(e)}function TI(){return TI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},TI.apply(this,arguments)}function n5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function x_(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?n5(Object(a),!0).forEach(function(l){Gde(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Gde(e,t,a){return t=Hde(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Hde(e){var t=Wde(e,"string");return by(t)=="symbol"?t:t+""}function Wde(e,t){if(by(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(by(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Zde(e,t){if(e==null)return{};var a=Xde(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function Xde(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function Kde(e,t){var a=e.x,l=e.y,d=Zde(e,qde),_="".concat(a),v=parseInt(_,10),i="".concat(l),P=parseInt(i,10),I="".concat(t.height||d.height),M=parseInt(I,10),R="".concat(t.width||d.width),F=parseInt(R,10);return x_(x_(x_(x_(x_({},t),d),v?{x:v}:{}),P?{y:P}:{}),{},{height:M,width:F,name:t.name,radius:t.radius})}function i5(e){return He.createElement(C6,TI({shapeType:"rectangle",propTransformer:Kde,activeClassName:"recharts-active-bar"},e))}var Yde=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(l,d){if(typeof t=="number")return t;var _=fr(l)||xQ(l);return _?t(l,d):(_||dd(),a)}},Jde=["value","background"],j6;function Bp(e){"@babel/helpers - typeof";return Bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bp(e)}function Qde(e,t){if(e==null)return{};var a=efe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function efe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function fb(){return fb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},fb.apply(this,arguments)}function o5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function no(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?o5(Object(a),!0).forEach(function(l){ku(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function tfe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a5(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,F6(l.key),l)}}function rfe(e,t,a){return t&&a5(e.prototype,t),a&&a5(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function nfe(e,t,a){return t=pb(t),ife(e,z6()?Reflect.construct(t,a||[],pb(e).constructor):t.apply(e,a))}function ife(e,t){if(t&&(Bp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ofe(e)}function ofe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(z6=function(){return!!e})()}function pb(e){return pb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},pb(e)}function afe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&AI(e,t)}function AI(e,t){return AI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},AI(e,t)}function ku(e,t,a){return t=F6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function F6(e){var t=sfe(e,"string");return Bp(t)=="symbol"?t:t+""}function sfe(e,t){if(Bp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Bp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var wd=(function(e){function t(){var a;tfe(this,t);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return a=nfe(this,t,[].concat(d)),ku(a,"state",{isAnimationFinished:!1}),ku(a,"id",sm("recharts-bar-")),ku(a,"handleAnimationEnd",function(){var v=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),v&&v()}),ku(a,"handleAnimationStart",function(){var v=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),v&&v()}),a}return afe(t,e),rfe(t,[{key:"renderRectanglesStatically",value:function(l){var d=this,_=this.props,v=_.shape,i=_.dataKey,P=_.activeIndex,I=_.activeBar,M=Jr(this.props,!1);return l&&l.map(function(R,F){var q=F===P,H=q?I:v,j=no(no(no({},M),R),{},{isActive:q,option:H,index:F,dataKey:i,onAnimationStart:d.handleAnimationStart,onAnimationEnd:d.handleAnimationEnd});return He.createElement(ti,fb({className:"recharts-bar-rectangle"},cd(d.props,R,F),{key:"rectangle-".concat(R?.x,"-").concat(R?.y,"-").concat(R?.value,"-").concat(F)}),He.createElement(i5,j))})}},{key:"renderRectanglesWithAnimation",value:function(){var l=this,d=this.props,_=d.data,v=d.layout,i=d.isAnimationActive,P=d.animationBegin,I=d.animationDuration,M=d.animationEasing,R=d.animationId,F=this.state.prevData;return He.createElement(Rl,{begin:P,duration:I,isActive:i,easing:M,from:{t:0},to:{t:1},key:"bar-".concat(R),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(q){var H=q.t,j=_.map(function($,Y){var K=F&&F[Y];if(K){var re=za(K.x,$.x),se=za(K.y,$.y),J=za(K.width,$.width),ae=za(K.height,$.height);return no(no({},$),{},{x:re(H),y:se(H),width:J(H),height:ae(H)})}if(v==="horizontal"){var de=za(0,$.height),Pe=de(H);return no(no({},$),{},{y:$.y+$.height-Pe,height:Pe})}var Ne=za(0,$.width),rt=Ne(H);return no(no({},$),{},{width:rt})});return He.createElement(ti,null,l.renderRectanglesStatically(j))})}},{key:"renderRectangles",value:function(){var l=this.props,d=l.data,_=l.isAnimationActive,v=this.state.prevData;return _&&d&&d.length&&(!v||!By(v,d))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(d)}},{key:"renderBackground",value:function(){var l=this,d=this.props,_=d.data,v=d.dataKey,i=d.activeIndex,P=Jr(this.props.background,!1);return _.map(function(I,M){I.value;var R=I.background,F=Qde(I,Jde);if(!R)return null;var q=no(no(no(no(no({},F),{},{fill:"#eee"},R),P),cd(l.props,I,M)),{},{onAnimationStart:l.handleAnimationStart,onAnimationEnd:l.handleAnimationEnd,dataKey:v,index:M,className:"recharts-bar-background-rectangle"});return He.createElement(i5,fb({key:"background-bar-".concat(M),option:l.props.background,isActive:M===i},q))})}},{key:"renderErrorBar",value:function(l,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var _=this.props,v=_.data,i=_.xAxis,P=_.yAxis,I=_.layout,M=_.children,R=$a(M,Uy);if(!R)return null;var F=I==="vertical"?v[0].height/2:v[0].width/2,q=function($,Y){var K=Array.isArray($.value)?$.value[1]:$.value;return{x:$.x,y:$.y,value:K,errorVal:mo($,Y)}},H={clipPath:l?"url(#clipPath-".concat(d,")"):null};return He.createElement(ti,H,R.map(function(j){return He.cloneElement(j,{key:"error-bar-".concat(d,"-").concat(j.props.dataKey),data:v,xAxis:i,yAxis:P,layout:I,offset:F,dataPointFormatter:q})}))}},{key:"render",value:function(){var l=this.props,d=l.hide,_=l.data,v=l.className,i=l.xAxis,P=l.yAxis,I=l.left,M=l.top,R=l.width,F=l.height,q=l.isAnimationActive,H=l.background,j=l.id;if(d||!_||!_.length)return null;var $=this.state.isAnimationFinished,Y=Sn("recharts-bar",v),K=i&&i.allowDataOverflow,re=P&&P.allowDataOverflow,se=K||re,J=xn(j)?this.id:j;return He.createElement(ti,{className:Y},K||re?He.createElement("defs",null,He.createElement("clipPath",{id:"clipPath-".concat(J)},He.createElement("rect",{x:K?I:I-R/2,y:re?M:M-F/2,width:K?R:R*2,height:re?F:F*2}))):null,He.createElement(ti,{className:"recharts-bar-rectangles",clipPath:se?"url(#clipPath-".concat(J,")"):null},H?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(se,J),(!q||$)&&Ac.renderCallByParent(this.props,_))}}],[{key:"getDerivedStateFromProps",value:function(l,d){return l.animationId!==d.prevAnimationId?{prevAnimationId:l.animationId,curData:l.data,prevData:d.curData}:l.data!==d.curData?{curData:l.data}:null}}])})(ie.PureComponent);j6=wd;ku(wd,"displayName","Bar");ku(wd,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!yd.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});ku(wd,"getComposedData",function(e){var t=e.props,a=e.item,l=e.barPosition,d=e.bandSize,_=e.xAxis,v=e.yAxis,i=e.xAxisTicks,P=e.yAxisTicks,I=e.stackedData,M=e.dataStartIndex,R=e.displayedData,F=e.offset,q=Nse(l,a);if(!q)return null;var H=t.layout,j=a.type.defaultProps,$=j!==void 0?no(no({},j),a.props):a.props,Y=$.dataKey,K=$.children,re=$.minPointSize,se=H==="horizontal"?v:_,J=I?se.scale.domain():null,ae=Vse({numericAxis:se}),de=$a(K,yp),Pe=R.map(function(Ne,rt){var ke,Ze,nt,Je,ot,it;I?ke=Lse(I[M+rt],J):(ke=mo(Ne,Y),Array.isArray(ke)||(ke=[ae,ke]));var Pt=Yde(re,j6.defaultProps.minPointSize)(ke[1],rt);if(H==="horizontal"){var Ot,yt=[v.scale(ke[0]),v.scale(ke[1])],ar=yt[0],qt=yt[1];Ze=MF({axis:_,ticks:i,bandSize:d,offset:q.offset,entry:Ne,index:rt}),nt=(Ot=qt??ar)!==null&&Ot!==void 0?Ot:void 0,Je=q.size;var rr=ar-qt;if(ot=Number.isNaN(rr)?0:rr,it={x:Ze,y:v.y,width:Je,height:v.height},Math.abs(Pt)>0&&Math.abs(ot)<Math.abs(Pt)){var Tr=la(ot||Pt)*(Math.abs(Pt)-Math.abs(ot));nt-=Tr,ot+=Tr}}else{var an=[_.scale(ke[0]),_.scale(ke[1])],An=an[0],Fr=an[1];if(Ze=An,nt=MF({axis:v,ticks:P,bandSize:d,offset:q.offset,entry:Ne,index:rt}),Je=Fr-An,ot=q.size,it={x:_.x,y:nt,width:_.width,height:ot},Math.abs(Pt)>0&&Math.abs(Je)<Math.abs(Pt)){var nr=la(Je||Pt)*(Math.abs(Pt)-Math.abs(Je));Je+=nr}}return no(no(no({},Ne),{},{x:Ze,y:nt,width:Je,height:ot,value:I?ke:ke[1],payload:Ne,background:it},de&&de[rt]&&de[rt].props),{},{tooltipPayload:[h6(a,Ne)],tooltipPosition:{x:Ze+Je/2,y:nt+ot/2}})});return no({data:Pe,layout:H},F)});function wy(e){"@babel/helpers - typeof";return wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wy(e)}function lfe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s5(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,B6(l.key),l)}}function cfe(e,t,a){return t&&s5(e.prototype,t),a&&s5(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function l5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Ls(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?l5(Object(a),!0).forEach(function(l){yw(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function yw(e,t,a){return t=B6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function B6(e){var t=ufe(e,"string");return wy(t)=="symbol"?t:t+""}function ufe(e,t){if(wy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(wy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var U6=function(t,a,l,d,_){var v=t.width,i=t.height,P=t.layout,I=t.children,M=Object.keys(a),R={left:l.left,leftMirror:l.left,right:v-l.right,rightMirror:v-l.right,top:l.top,topMirror:l.top,bottom:i-l.bottom,bottomMirror:i-l.bottom},F=!!Na(I,wd);return M.reduce(function(q,H){var j=a[H],$=j.orientation,Y=j.domain,K=j.padding,re=K===void 0?{}:K,se=j.mirror,J=j.reversed,ae="".concat($).concat(se?"Mirror":""),de,Pe,Ne,rt,ke;if(j.type==="number"&&(j.padding==="gap"||j.padding==="no-gap")){var Ze=Y[1]-Y[0],nt=1/0,Je=j.categoricalDomain.sort(SQ);if(Je.forEach(function(an,An){An>0&&(nt=Math.min((an||0)-(Je[An-1]||0),nt))}),Number.isFinite(nt)){var ot=nt/Ze,it=j.layout==="vertical"?l.height:l.width;if(j.padding==="gap"&&(de=ot*it/2),j.padding==="no-gap"){var Pt=ca(t.barCategoryGap,ot*it),Ot=ot*it/2;de=Ot-Pt-(Ot-Pt)/it*Pt}}}d==="xAxis"?Pe=[l.left+(re.left||0)+(de||0),l.left+l.width-(re.right||0)-(de||0)]:d==="yAxis"?Pe=P==="horizontal"?[l.top+l.height-(re.bottom||0),l.top+(re.top||0)]:[l.top+(re.top||0)+(de||0),l.top+l.height-(re.bottom||0)-(de||0)]:Pe=j.range,J&&(Pe=[Pe[1],Pe[0]]);var yt=s6(j,_,F),ar=yt.scale,qt=yt.realScaleType;ar.domain(Y).range(Pe),l6(ar);var rr=c6(ar,Ls(Ls({},j),{},{realScaleType:qt}));d==="xAxis"?(ke=$==="top"&&!se||$==="bottom"&&se,Ne=l.left,rt=R[ae]-ke*j.height):d==="yAxis"&&(ke=$==="left"&&!se||$==="right"&&se,Ne=R[ae]-ke*j.width,rt=l.top);var Tr=Ls(Ls(Ls({},j),rr),{},{realScaleType:qt,x:Ne,y:rt,scale:ar,width:d==="xAxis"?l.width:j.width,height:d==="yAxis"?l.height:j.height});return Tr.bandSize=Y0(Tr,rr),!j.hide&&d==="xAxis"?R[ae]+=(ke?-1:1)*Tr.height:j.hide||(R[ae]+=(ke?-1:1)*Tr.width),Ls(Ls({},q),{},yw({},H,Tr))},{})},V6=function(t,a){var l=t.x,d=t.y,_=a.x,v=a.y;return{x:Math.min(l,_),y:Math.min(d,v),width:Math.abs(_-l),height:Math.abs(v-d)}},hfe=function(t){var a=t.x1,l=t.y1,d=t.x2,_=t.y2;return V6({x:a,y:l},{x:d,y:_})},$6=(function(){function e(t){lfe(this,e),this.scale=t}return cfe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(a){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=l.bandAware,_=l.position;if(a!==void 0){if(_)switch(_){case"start":return this.scale(a);case"middle":{var v=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+v}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(a)+i}default:return this.scale(a)}if(d){var P=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+P}return this.scale(a)}}},{key:"isInRange",value:function(a){var l=this.range(),d=l[0],_=l[l.length-1];return d<=_?a>=d&&a<=_:a>=_&&a<=d}}],[{key:"create",value:function(a){return new e(a)}}])})();yw($6,"EPS",1e-4);var wO=function(t){var a=Object.keys(t).reduce(function(l,d){return Ls(Ls({},l),{},yw({},d,$6.create(t[d])))},{});return Ls(Ls({},a),{},{apply:function(d){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=_.bandAware,i=_.position;return Fde(d,function(P,I){return a[I].apply(P,{bandAware:v,position:i})})},isInRange:function(d){return L6(d,function(_,v){return a[v].isInRange(_)})}})};function dfe(e){return(e%180+180)%180}var ffe=function(t){var a=t.width,l=t.height,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=dfe(d),v=_*Math.PI/180,i=Math.atan(l/a),P=v>i&&v<Math.PI-i?l/Math.sin(v):a/Math.cos(v);return Math.abs(P)},j2,c5;function pfe(){if(c5)return j2;c5=1;var e=Ll(),t=Ny(),a=Yb();function l(d){return function(_,v,i){var P=Object(_);if(!t(_)){var I=e(v,3);_=a(_),v=function(R){return I(P[R],R,P)}}var M=d(_,v,i);return M>-1?P[I?_[M]:M]:void 0}}return j2=l,j2}var z2,u5;function mfe(){if(u5)return z2;u5=1;var e=R6();function t(a){var l=e(a),d=l%1;return l===l?d?l-d:l:0}return z2=t,z2}var F2,h5;function gfe(){if(h5)return F2;h5=1;var e=VV(),t=Ll(),a=mfe(),l=Math.max;function d(_,v,i){var P=_==null?0:_.length;if(!P)return-1;var I=i==null?0:a(i);return I<0&&(I=l(P+I,0)),e(_,t(v,3),I)}return F2=d,F2}var B2,d5;function _fe(){if(d5)return B2;d5=1;var e=pfe(),t=gfe(),a=e(t);return B2=a,B2}var yfe=_fe();const vfe=si(yfe);var xfe=iV();const bfe=si(xfe);var wfe=bfe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),SO=ie.createContext(void 0),TO=ie.createContext(void 0),q6=ie.createContext(void 0),G6=ie.createContext({}),H6=ie.createContext(void 0),W6=ie.createContext(0),Z6=ie.createContext(0),f5=function(t){var a=t.state,l=a.xAxisMap,d=a.yAxisMap,_=a.offset,v=t.clipPathId,i=t.children,P=t.width,I=t.height,M=wfe(_);return He.createElement(SO.Provider,{value:l},He.createElement(TO.Provider,{value:d},He.createElement(G6.Provider,{value:_},He.createElement(q6.Provider,{value:M},He.createElement(H6.Provider,{value:v},He.createElement(W6.Provider,{value:I},He.createElement(Z6.Provider,{value:P},i)))))))},Sfe=function(){return ie.useContext(H6)},X6=function(t){var a=ie.useContext(SO);a==null&&dd();var l=a[t];return l==null&&dd(),l},Tfe=function(){var t=ie.useContext(SO);return Ru(t)},Afe=function(){var t=ie.useContext(TO),a=vfe(t,function(l){return L6(l.domain,Number.isFinite)});return a||Ru(t)},K6=function(t){var a=ie.useContext(TO);a==null&&dd();var l=a[t];return l==null&&dd(),l},Efe=function(){var t=ie.useContext(q6);return t},Pfe=function(){return ie.useContext(G6)},AO=function(){return ie.useContext(Z6)},EO=function(){return ie.useContext(W6)};function Up(e){"@babel/helpers - typeof";return Up=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Up(e)}function Ife(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cfe(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,J6(l.key),l)}}function Ofe(e,t,a){return t&&Cfe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mfe(e,t,a){return t=mb(t),Rfe(e,Y6()?Reflect.construct(t,a||[],mb(e).constructor):t.apply(e,a))}function Rfe(e,t){if(t&&(Up(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dfe(e)}function Dfe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Y6=function(){return!!e})()}function mb(e){return mb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},mb(e)}function kfe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&EI(e,t)}function EI(e,t){return EI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},EI(e,t)}function p5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function m5(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?p5(Object(a),!0).forEach(function(l){PO(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function PO(e,t,a){return t=J6(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function J6(e){var t=Nfe(e,"string");return Up(t)=="symbol"?t:t+""}function Nfe(e,t){if(Up(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Up(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Lfe(e,t){return Bfe(e)||Ffe(e,t)||zfe(e,t)||jfe()}function jfe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zfe(e,t){if(e){if(typeof e=="string")return g5(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g5(e,t)}}function g5(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Ffe(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Bfe(e){if(Array.isArray(e))return e}function PI(){return PI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},PI.apply(this,arguments)}var Ufe=function(t,a){var l;return He.isValidElement(t)?l=He.cloneElement(t,a):pn(t)?l=t(a):l=He.createElement("line",PI({},a,{className:"recharts-reference-line-line"})),l},Vfe=function(t,a,l,d,_,v,i,P,I){var M=_.x,R=_.y,F=_.width,q=_.height;if(l){var H=I.y,j=t.y.apply(H,{position:v});if(Pl(I,"discard")&&!t.y.isInRange(j))return null;var $=[{x:M+F,y:j},{x:M,y:j}];return P==="left"?$.reverse():$}if(a){var Y=I.x,K=t.x.apply(Y,{position:v});if(Pl(I,"discard")&&!t.x.isInRange(K))return null;var re=[{x:K,y:R+q},{x:K,y:R}];return i==="top"?re.reverse():re}if(d){var se=I.segment,J=se.map(function(ae){return t.apply(ae,{position:v})});return Pl(I,"discard")&&Nde(J,function(ae){return!t.isInRange(ae)})?null:J}return null};function $fe(e){var t=e.x,a=e.y,l=e.segment,d=e.xAxisId,_=e.yAxisId,v=e.shape,i=e.className,P=e.alwaysShow,I=Sfe(),M=X6(d),R=K6(_),F=Efe();if(!I||!F)return null;Vs(P===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var q=wO({x:M.scale,y:R.scale}),H=go(t),j=go(a),$=l&&l.length===2,Y=Vfe(q,H,j,$,F,e.position,M.orientation,R.orientation,e);if(!Y)return null;var K=Lfe(Y,2),re=K[0],se=re.x,J=re.y,ae=K[1],de=ae.x,Pe=ae.y,Ne=Pl(e,"hidden")?"url(#".concat(I,")"):void 0,rt=m5(m5({clipPath:Ne},Jr(e,!0)),{},{x1:se,y1:J,x2:de,y2:Pe});return He.createElement(ti,{className:Sn("recharts-reference-line",i)},Ufe(v,rt),Io.renderCallByParent(e,hfe({x1:se,y1:J,x2:de,y2:Pe})))}var IO=(function(e){function t(){return Ife(this,t),Mfe(this,t,arguments)}return kfe(t,e),Ofe(t,[{key:"render",value:function(){return He.createElement($fe,this.props)}}])})(He.Component);PO(IO,"displayName","ReferenceLine");PO(IO,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function II(){return II=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},II.apply(this,arguments)}function Vp(e){"@babel/helpers - typeof";return Vp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vp(e)}function _5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function y5(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?_5(Object(a),!0).forEach(function(l){vw(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function qfe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gfe(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,eq(l.key),l)}}function Hfe(e,t,a){return t&&Gfe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wfe(e,t,a){return t=gb(t),Zfe(e,Q6()?Reflect.construct(t,a||[],gb(e).constructor):t.apply(e,a))}function Zfe(e,t){if(t&&(Vp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xfe(e)}function Xfe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Q6=function(){return!!e})()}function gb(e){return gb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},gb(e)}function Kfe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CI(e,t)}function CI(e,t){return CI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},CI(e,t)}function vw(e,t,a){return t=eq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function eq(e){var t=Yfe(e,"string");return Vp(t)=="symbol"?t:t+""}function Yfe(e,t){if(Vp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Vp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Jfe=function(t){var a=t.x,l=t.y,d=t.xAxis,_=t.yAxis,v=wO({x:d.scale,y:_.scale}),i=v.apply({x:a,y:l},{bandAware:!0});return Pl(t,"discard")&&!v.isInRange(i)?null:i},xw=(function(e){function t(){return qfe(this,t),Wfe(this,t,arguments)}return Kfe(t,e),Hfe(t,[{key:"render",value:function(){var l=this.props,d=l.x,_=l.y,v=l.r,i=l.alwaysShow,P=l.clipPathId,I=go(d),M=go(_);if(Vs(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!I||!M)return null;var R=Jfe(this.props);if(!R)return null;var F=R.x,q=R.y,H=this.props,j=H.shape,$=H.className,Y=Pl(this.props,"hidden")?"url(#".concat(P,")"):void 0,K=y5(y5({clipPath:Y},Jr(this.props,!0)),{},{cx:F,cy:q});return He.createElement(ti,{className:Sn("recharts-reference-dot",$)},t.renderDot(j,K),Io.renderCallByParent(this.props,{x:F-v,y:q-v,width:2*v,height:2*v}))}}])})(He.Component);vw(xw,"displayName","ReferenceDot");vw(xw,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});vw(xw,"renderDot",function(e,t){var a;return He.isValidElement(e)?a=He.cloneElement(e,t):pn(e)?a=e(t):a=He.createElement(hw,II({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),a});function OI(){return OI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},OI.apply(this,arguments)}function $p(e){"@babel/helpers - typeof";return $p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$p(e)}function v5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function x5(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?v5(Object(a),!0).forEach(function(l){bw(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Qfe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function epe(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,rq(l.key),l)}}function tpe(e,t,a){return t&&epe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function rpe(e,t,a){return t=_b(t),npe(e,tq()?Reflect.construct(t,a||[],_b(e).constructor):t.apply(e,a))}function npe(e,t){if(t&&($p(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ipe(e)}function ipe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tq=function(){return!!e})()}function _b(e){return _b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_b(e)}function ope(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MI(e,t)}function MI(e,t){return MI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},MI(e,t)}function bw(e,t,a){return t=rq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function rq(e){var t=ape(e,"string");return $p(t)=="symbol"?t:t+""}function ape(e,t){if($p(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if($p(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var spe=function(t,a,l,d,_){var v=_.x1,i=_.x2,P=_.y1,I=_.y2,M=_.xAxis,R=_.yAxis;if(!M||!R)return null;var F=wO({x:M.scale,y:R.scale}),q={x:t?F.x.apply(v,{position:"start"}):F.x.rangeMin,y:l?F.y.apply(P,{position:"start"}):F.y.rangeMin},H={x:a?F.x.apply(i,{position:"end"}):F.x.rangeMax,y:d?F.y.apply(I,{position:"end"}):F.y.rangeMax};return Pl(_,"discard")&&(!F.isInRange(q)||!F.isInRange(H))?null:V6(q,H)},ww=(function(e){function t(){return Qfe(this,t),rpe(this,t,arguments)}return ope(t,e),tpe(t,[{key:"render",value:function(){var l=this.props,d=l.x1,_=l.x2,v=l.y1,i=l.y2,P=l.className,I=l.alwaysShow,M=l.clipPathId;Vs(I===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var R=go(d),F=go(_),q=go(v),H=go(i),j=this.props.shape;if(!R&&!F&&!q&&!H&&!j)return null;var $=spe(R,F,q,H,this.props);if(!$&&!j)return null;var Y=Pl(this.props,"hidden")?"url(#".concat(M,")"):void 0;return He.createElement(ti,{className:Sn("recharts-reference-area",P)},t.renderRect(j,x5(x5({clipPath:Y},Jr(this.props,!0)),$)),Io.renderCallByParent(this.props,$))}}])})(He.Component);bw(ww,"displayName","ReferenceArea");bw(ww,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});bw(ww,"renderRect",function(e,t){var a;return He.isValidElement(e)?a=He.cloneElement(e,t):pn(e)?a=e(t):a=He.createElement(bO,OI({},t,{className:"recharts-reference-area-rect"})),a});function nq(e,t,a){if(t<1)return[];if(t===1&&a===void 0)return e;for(var l=[],d=0;d<e.length;d+=t)l.push(e[d]);return l}function lpe(e,t,a){var l={width:e.width+t.width,height:e.height+t.height};return ffe(l,a)}function cpe(e,t,a){var l=a==="width",d=e.x,_=e.y,v=e.width,i=e.height;return t===1?{start:l?d:_,end:l?d+v:_+i}:{start:l?d+v:_+i,end:l?d:_}}function yb(e,t,a,l,d){if(e*t<e*l||e*t>e*d)return!1;var _=a();return e*(t-e*_/2-l)>=0&&e*(t+e*_/2-d)<=0}function upe(e,t){return nq(e,t+1)}function hpe(e,t,a,l,d){for(var _=(l||[]).slice(),v=t.start,i=t.end,P=0,I=1,M=v,R=function(){var H=l?.[P];if(H===void 0)return{v:nq(l,I)};var j=P,$,Y=function(){return $===void 0&&($=a(H,j)),$},K=H.coordinate,re=P===0||yb(e,K,Y,M,i);re||(P=0,M=v,I+=1),re&&(M=K+e*(Y()/2+d),P+=I)},F;I<=_.length;)if(F=R(),F)return F.v;return[]}function Sy(e){"@babel/helpers - typeof";return Sy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sy(e)}function b5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function $o(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?b5(Object(a),!0).forEach(function(l){dpe(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function dpe(e,t,a){return t=fpe(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fpe(e){var t=ppe(e,"string");return Sy(t)=="symbol"?t:t+""}function ppe(e,t){if(Sy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Sy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mpe(e,t,a,l,d){for(var _=(l||[]).slice(),v=_.length,i=t.start,P=t.end,I=function(F){var q=_[F],H,j=function(){return H===void 0&&(H=a(q,F)),H};if(F===v-1){var $=e*(q.coordinate+e*j()/2-P);_[F]=q=$o($o({},q),{},{tickCoord:$>0?q.coordinate-$*e:q.coordinate})}else _[F]=q=$o($o({},q),{},{tickCoord:q.coordinate});var Y=yb(e,q.tickCoord,j,i,P);Y&&(P=q.tickCoord-e*(j()/2+d),_[F]=$o($o({},q),{},{isShow:!0}))},M=v-1;M>=0;M--)I(M);return _}function gpe(e,t,a,l,d,_){var v=(l||[]).slice(),i=v.length,P=t.start,I=t.end;if(_){var M=l[i-1],R=a(M,i-1),F=e*(M.coordinate+e*R/2-I);v[i-1]=M=$o($o({},M),{},{tickCoord:F>0?M.coordinate-F*e:M.coordinate});var q=yb(e,M.tickCoord,function(){return R},P,I);q&&(I=M.tickCoord-e*(R/2+d),v[i-1]=$o($o({},M),{},{isShow:!0}))}for(var H=_?i-1:i,j=function(K){var re=v[K],se,J=function(){return se===void 0&&(se=a(re,K)),se};if(K===0){var ae=e*(re.coordinate-e*J()/2-P);v[K]=re=$o($o({},re),{},{tickCoord:ae<0?re.coordinate-ae*e:re.coordinate})}else v[K]=re=$o($o({},re),{},{tickCoord:re.coordinate});var de=yb(e,re.tickCoord,J,P,I);de&&(P=re.tickCoord+e*(J()/2+d),v[K]=$o($o({},re),{},{isShow:!0}))},$=0;$<H;$++)j($);return v}function CO(e,t,a){var l=e.tick,d=e.ticks,_=e.viewBox,v=e.minTickGap,i=e.orientation,P=e.interval,I=e.tickFormatter,M=e.unit,R=e.angle;if(!d||!d.length||!l)return[];if(fr(P)||yd.isSsr)return upe(d,typeof P=="number"&&fr(P)?P:0);var F=[],q=i==="top"||i==="bottom"?"width":"height",H=M&&q==="width"?D_(M,{fontSize:t,letterSpacing:a}):{width:0,height:0},j=function(re,se){var J=pn(I)?I(re.value,se):re.value;return q==="width"?lpe(D_(J,{fontSize:t,letterSpacing:a}),H,R):D_(J,{fontSize:t,letterSpacing:a})[q]},$=d.length>=2?la(d[1].coordinate-d[0].coordinate):1,Y=cpe(_,$,q);return P==="equidistantPreserveStart"?hpe($,Y,j,d,v):(P==="preserveStart"||P==="preserveStartEnd"?F=gpe($,Y,j,d,v,P==="preserveStartEnd"):F=mpe($,Y,j,d,v),F.filter(function(K){return K.isShow}))}var _pe=["viewBox"],ype=["viewBox"],vpe=["ticks"];function qp(e){"@babel/helpers - typeof";return qp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qp(e)}function fp(){return fp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},fp.apply(this,arguments)}function w5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function uo(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?w5(Object(a),!0).forEach(function(l){OO(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function U2(e,t){if(e==null)return{};var a=xpe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function xpe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function bpe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S5(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,oq(l.key),l)}}function wpe(e,t,a){return t&&S5(e.prototype,t),a&&S5(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function Spe(e,t,a){return t=vb(t),Tpe(e,iq()?Reflect.construct(t,a||[],vb(e).constructor):t.apply(e,a))}function Tpe(e,t){if(t&&(qp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ape(e)}function Ape(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iq=function(){return!!e})()}function vb(e){return vb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},vb(e)}function Epe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&RI(e,t)}function RI(e,t){return RI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},RI(e,t)}function OO(e,t,a){return t=oq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function oq(e){var t=Ppe(e,"string");return qp(t)=="symbol"?t:t+""}function Ppe(e,t){if(qp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(qp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var dm=(function(e){function t(a){var l;return bpe(this,t),l=Spe(this,t,[a]),l.state={fontSize:"",letterSpacing:""},l}return Epe(t,e),wpe(t,[{key:"shouldComponentUpdate",value:function(l,d){var _=l.viewBox,v=U2(l,_pe),i=this.props,P=i.viewBox,I=U2(i,ype);return!_p(_,P)||!_p(v,I)||!_p(d,this.state)}},{key:"componentDidMount",value:function(){var l=this.layerReference;if(l){var d=l.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];d&&this.setState({fontSize:window.getComputedStyle(d).fontSize,letterSpacing:window.getComputedStyle(d).letterSpacing})}}},{key:"getTickLineCoord",value:function(l){var d=this.props,_=d.x,v=d.y,i=d.width,P=d.height,I=d.orientation,M=d.tickSize,R=d.mirror,F=d.tickMargin,q,H,j,$,Y,K,re=R?-1:1,se=l.tickSize||M,J=fr(l.tickCoord)?l.tickCoord:l.coordinate;switch(I){case"top":q=H=l.coordinate,$=v+ +!R*P,j=$-re*se,K=j-re*F,Y=J;break;case"left":j=$=l.coordinate,H=_+ +!R*i,q=H-re*se,Y=q-re*F,K=J;break;case"right":j=$=l.coordinate,H=_+ +R*i,q=H+re*se,Y=q+re*F,K=J;break;default:q=H=l.coordinate,$=v+ +R*P,j=$+re*se,K=j+re*F,Y=J;break}return{line:{x1:q,y1:j,x2:H,y2:$},tick:{x:Y,y:K}}}},{key:"getTickTextAnchor",value:function(){var l=this.props,d=l.orientation,_=l.mirror,v;switch(d){case"left":v=_?"start":"end";break;case"right":v=_?"end":"start";break;default:v="middle";break}return v}},{key:"getTickVerticalAnchor",value:function(){var l=this.props,d=l.orientation,_=l.mirror,v="end";switch(d){case"left":case"right":v="middle";break;case"top":v=_?"start":"end";break;default:v=_?"end":"start";break}return v}},{key:"renderAxisLine",value:function(){var l=this.props,d=l.x,_=l.y,v=l.width,i=l.height,P=l.orientation,I=l.mirror,M=l.axisLine,R=uo(uo(uo({},Jr(this.props,!1)),Jr(M,!1)),{},{fill:"none"});if(P==="top"||P==="bottom"){var F=+(P==="top"&&!I||P==="bottom"&&I);R=uo(uo({},R),{},{x1:d,y1:_+F*i,x2:d+v,y2:_+F*i})}else{var q=+(P==="left"&&!I||P==="right"&&I);R=uo(uo({},R),{},{x1:d+q*v,y1:_,x2:d+q*v,y2:_+i})}return He.createElement("line",fp({},R,{className:Sn("recharts-cartesian-axis-line",Va(M,"className"))}))}},{key:"renderTicks",value:function(l,d,_){var v=this,i=this.props,P=i.tickLine,I=i.stroke,M=i.tick,R=i.tickFormatter,F=i.unit,q=CO(uo(uo({},this.props),{},{ticks:l}),d,_),H=this.getTickTextAnchor(),j=this.getTickVerticalAnchor(),$=Jr(this.props,!1),Y=Jr(M,!1),K=uo(uo({},$),{},{fill:"none"},Jr(P,!1)),re=q.map(function(se,J){var ae=v.getTickLineCoord(se),de=ae.line,Pe=ae.tick,Ne=uo(uo(uo(uo({textAnchor:H,verticalAnchor:j},$),{},{stroke:"none",fill:I},Y),Pe),{},{index:J,payload:se,visibleTicksCount:q.length,tickFormatter:R});return He.createElement(ti,fp({className:"recharts-cartesian-axis-tick",key:"tick-".concat(se.value,"-").concat(se.coordinate,"-").concat(se.tickCoord)},cd(v.props,se,J)),P&&He.createElement("line",fp({},K,de,{className:Sn("recharts-cartesian-axis-tick-line",Va(P,"className"))})),M&&t.renderTickItem(M,Ne,"".concat(pn(R)?R(se.value,J):se.value).concat(F||"")))});return He.createElement("g",{className:"recharts-cartesian-axis-ticks"},re)}},{key:"render",value:function(){var l=this,d=this.props,_=d.axisLine,v=d.width,i=d.height,P=d.ticksGenerator,I=d.className,M=d.hide;if(M)return null;var R=this.props,F=R.ticks,q=U2(R,vpe),H=F;return pn(P)&&(H=F&&F.length>0?P(this.props):P(q)),v<=0||i<=0||!H||!H.length?null:He.createElement(ti,{className:Sn("recharts-cartesian-axis",I),ref:function($){l.layerReference=$}},_&&this.renderAxisLine(),this.renderTicks(H,this.state.fontSize,this.state.letterSpacing),Io.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(l,d,_){var v,i=Sn(d.className,"recharts-cartesian-axis-tick-value");return He.isValidElement(l)?v=He.cloneElement(l,uo(uo({},d),{},{className:i})):pn(l)?v=l(uo(uo({},d),{},{className:i})):v=He.createElement(ud,fp({},d,{className:"recharts-cartesian-axis-tick-value"}),_),v}}])})(ie.Component);OO(dm,"displayName","CartesianAxis");OO(dm,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Ipe=["x1","y1","x2","y2","key"],Cpe=["offset"];function fd(e){"@babel/helpers - typeof";return fd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fd(e)}function T5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function qo(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?T5(Object(a),!0).forEach(function(l){Ope(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function Ope(e,t,a){return t=Mpe(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Mpe(e){var t=Rpe(e,"string");return fd(t)=="symbol"?t:t+""}function Rpe(e,t){if(fd(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(fd(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ed(){return ed=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},ed.apply(this,arguments)}function A5(e,t){if(e==null)return{};var a=Dpe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function Dpe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}var kpe=function(t){var a=t.fill;if(!a||a==="none")return null;var l=t.fillOpacity,d=t.x,_=t.y,v=t.width,i=t.height,P=t.ry;return He.createElement("rect",{x:d,y:_,ry:P,width:v,height:i,stroke:"none",fill:a,fillOpacity:l,className:"recharts-cartesian-grid-bg"})};function aq(e,t){var a;if(He.isValidElement(e))a=He.cloneElement(e,t);else if(pn(e))a=e(t);else{var l=t.x1,d=t.y1,_=t.x2,v=t.y2,i=t.key,P=A5(t,Ipe),I=Jr(P,!1);I.offset;var M=A5(I,Cpe);a=He.createElement("line",ed({},M,{x1:l,y1:d,x2:_,y2:v,fill:"none",key:i}))}return a}function Npe(e){var t=e.x,a=e.width,l=e.horizontal,d=l===void 0?!0:l,_=e.horizontalPoints;if(!d||!_||!_.length)return null;var v=_.map(function(i,P){var I=qo(qo({},e),{},{x1:t,y1:i,x2:t+a,y2:i,key:"line-".concat(P),index:P});return aq(d,I)});return He.createElement("g",{className:"recharts-cartesian-grid-horizontal"},v)}function Lpe(e){var t=e.y,a=e.height,l=e.vertical,d=l===void 0?!0:l,_=e.verticalPoints;if(!d||!_||!_.length)return null;var v=_.map(function(i,P){var I=qo(qo({},e),{},{x1:i,y1:t,x2:i,y2:t+a,key:"line-".concat(P),index:P});return aq(d,I)});return He.createElement("g",{className:"recharts-cartesian-grid-vertical"},v)}function jpe(e){var t=e.horizontalFill,a=e.fillOpacity,l=e.x,d=e.y,_=e.width,v=e.height,i=e.horizontalPoints,P=e.horizontal,I=P===void 0?!0:P;if(!I||!t||!t.length)return null;var M=i.map(function(F){return Math.round(F+d-d)}).sort(function(F,q){return F-q});d!==M[0]&&M.unshift(0);var R=M.map(function(F,q){var H=!M[q+1],j=H?d+v-F:M[q+1]-F;if(j<=0)return null;var $=q%t.length;return He.createElement("rect",{key:"react-".concat(q),y:F,x:l,height:j,width:_,stroke:"none",fill:t[$],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return He.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},R)}function zpe(e){var t=e.vertical,a=t===void 0?!0:t,l=e.verticalFill,d=e.fillOpacity,_=e.x,v=e.y,i=e.width,P=e.height,I=e.verticalPoints;if(!a||!l||!l.length)return null;var M=I.map(function(F){return Math.round(F+_-_)}).sort(function(F,q){return F-q});_!==M[0]&&M.unshift(0);var R=M.map(function(F,q){var H=!M[q+1],j=H?_+i-F:M[q+1]-F;if(j<=0)return null;var $=q%l.length;return He.createElement("rect",{key:"react-".concat(q),x:F,y:v,width:j,height:P,stroke:"none",fill:l[$],fillOpacity:d,className:"recharts-cartesian-grid-bg"})});return He.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},R)}var Fpe=function(t,a){var l=t.xAxis,d=t.width,_=t.height,v=t.offset;return a6(CO(qo(qo(qo({},dm.defaultProps),l),{},{ticks:xc(l,!0),viewBox:{x:0,y:0,width:d,height:_}})),v.left,v.left+v.width,a)},Bpe=function(t,a){var l=t.yAxis,d=t.width,_=t.height,v=t.offset;return a6(CO(qo(qo(qo({},dm.defaultProps),l),{},{ticks:xc(l,!0),viewBox:{x:0,y:0,width:d,height:_}})),v.top,v.top+v.height,a)},ip={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function DI(e){var t,a,l,d,_,v,i=AO(),P=EO(),I=Pfe(),M=qo(qo({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:ip.stroke,fill:(a=e.fill)!==null&&a!==void 0?a:ip.fill,horizontal:(l=e.horizontal)!==null&&l!==void 0?l:ip.horizontal,horizontalFill:(d=e.horizontalFill)!==null&&d!==void 0?d:ip.horizontalFill,vertical:(_=e.vertical)!==null&&_!==void 0?_:ip.vertical,verticalFill:(v=e.verticalFill)!==null&&v!==void 0?v:ip.verticalFill,x:fr(e.x)?e.x:I.left,y:fr(e.y)?e.y:I.top,width:fr(e.width)?e.width:I.width,height:fr(e.height)?e.height:I.height}),R=M.x,F=M.y,q=M.width,H=M.height,j=M.syncWithTicks,$=M.horizontalValues,Y=M.verticalValues,K=Tfe(),re=Afe();if(!fr(q)||q<=0||!fr(H)||H<=0||!fr(R)||R!==+R||!fr(F)||F!==+F)return null;var se=M.verticalCoordinatesGenerator||Fpe,J=M.horizontalCoordinatesGenerator||Bpe,ae=M.horizontalPoints,de=M.verticalPoints;if((!ae||!ae.length)&&pn(J)){var Pe=$&&$.length,Ne=J({yAxis:re?qo(qo({},re),{},{ticks:Pe?$:re.ticks}):void 0,width:i,height:P,offset:I},Pe?!0:j);Vs(Array.isArray(Ne),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(fd(Ne),"]")),Array.isArray(Ne)&&(ae=Ne)}if((!de||!de.length)&&pn(se)){var rt=Y&&Y.length,ke=se({xAxis:K?qo(qo({},K),{},{ticks:rt?Y:K.ticks}):void 0,width:i,height:P,offset:I},rt?!0:j);Vs(Array.isArray(ke),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(fd(ke),"]")),Array.isArray(ke)&&(de=ke)}return He.createElement("g",{className:"recharts-cartesian-grid"},He.createElement(kpe,{fill:M.fill,fillOpacity:M.fillOpacity,x:M.x,y:M.y,width:M.width,height:M.height,ry:M.ry}),He.createElement(Npe,ed({},M,{offset:I,horizontalPoints:ae,xAxis:K,yAxis:re})),He.createElement(Lpe,ed({},M,{offset:I,verticalPoints:de,xAxis:K,yAxis:re})),He.createElement(jpe,ed({},M,{horizontalPoints:ae})),He.createElement(zpe,ed({},M,{verticalPoints:de})))}DI.displayName="CartesianGrid";var Upe=["type","layout","connectNulls","ref"],Vpe=["key"];function Gp(e){"@babel/helpers - typeof";return Gp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gp(e)}function E5(e,t){if(e==null)return{};var a=$pe(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function $pe(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function F_(){return F_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},F_.apply(this,arguments)}function P5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Ra(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?P5(Object(a),!0).forEach(function(l){js(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function op(e){return Wpe(e)||Hpe(e)||Gpe(e)||qpe()}function qpe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gpe(e,t){if(e){if(typeof e=="string")return kI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kI(e,t)}}function Hpe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Wpe(e){if(Array.isArray(e))return kI(e)}function kI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function Zpe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I5(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,lq(l.key),l)}}function Xpe(e,t,a){return t&&I5(e.prototype,t),a&&I5(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function Kpe(e,t,a){return t=xb(t),Ype(e,sq()?Reflect.construct(t,a||[],xb(e).constructor):t.apply(e,a))}function Ype(e,t){if(t&&(Gp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jpe(e)}function Jpe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sq=function(){return!!e})()}function xb(e){return xb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},xb(e)}function Qpe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NI(e,t)}function NI(e,t){return NI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},NI(e,t)}function js(e,t,a){return t=lq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function lq(e){var t=eme(e,"string");return Gp(t)=="symbol"?t:t+""}function eme(e,t){if(Gp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Gp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Nu=(function(e){function t(){var a;Zpe(this,t);for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];return a=Kpe(this,t,[].concat(d)),js(a,"state",{isAnimationFinished:!0,totalLength:0}),js(a,"generateSimpleStrokeDasharray",function(v,i){return"".concat(i,"px ").concat(v-i,"px")}),js(a,"getStrokeDasharray",function(v,i,P){var I=P.reduce(function(Y,K){return Y+K});if(!I)return a.generateSimpleStrokeDasharray(i,v);for(var M=Math.floor(v/I),R=v%I,F=i-v,q=[],H=0,j=0;H<P.length;j+=P[H],++H)if(j+P[H]>R){q=[].concat(op(P.slice(0,H)),[R-j]);break}var $=q.length%2===0?[0,F]:[F];return[].concat(op(t.repeat(P,M)),op(q),$).map(function(Y){return"".concat(Y,"px")}).join(", ")}),js(a,"id",sm("recharts-line-")),js(a,"pathRef",function(v){a.mainCurve=v}),js(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),js(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return Qpe(t,e),Xpe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var l=this.getTotalLength();this.setState({totalLength:l})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var l=this.getTotalLength();l!==this.state.totalLength&&this.setState({totalLength:l})}}},{key:"getTotalLength",value:function(){var l=this.mainCurve;try{return l&&l.getTotalLength&&l.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(l,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var _=this.props,v=_.points,i=_.xAxis,P=_.yAxis,I=_.layout,M=_.children,R=$a(M,Uy);if(!R)return null;var F=function(j,$){return{x:j.x,y:j.y,value:j.value,errorVal:mo(j.payload,$)}},q={clipPath:l?"url(#clipPath-".concat(d,")"):null};return He.createElement(ti,q,R.map(function(H){return He.cloneElement(H,{key:"bar-".concat(H.props.dataKey),data:v,xAxis:i,yAxis:P,layout:I,dataPointFormatter:F})}))}},{key:"renderDots",value:function(l,d,_){var v=this.props.isAnimationActive;if(v&&!this.state.isAnimationFinished)return null;var i=this.props,P=i.dot,I=i.points,M=i.dataKey,R=Jr(this.props,!1),F=Jr(P,!0),q=I.map(function(j,$){var Y=Ra(Ra(Ra({key:"dot-".concat($),r:3},R),F),{},{index:$,cx:j.x,cy:j.y,value:j.value,dataKey:M,payload:j.payload,points:I});return t.renderDotItem(P,Y)}),H={clipPath:l?"url(#clipPath-".concat(d?"":"dots-").concat(_,")"):null};return He.createElement(ti,F_({className:"recharts-line-dots",key:"dots"},H),q)}},{key:"renderCurveStatically",value:function(l,d,_,v){var i=this.props,P=i.type,I=i.layout,M=i.connectNulls;i.ref;var R=E5(i,Upe),F=Ra(Ra(Ra({},Jr(R,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:d?"url(#clipPath-".concat(_,")"):null,points:l},v),{},{type:P,layout:I,connectNulls:M});return He.createElement(eb,F_({},F,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(l,d){var _=this,v=this.props,i=v.points,P=v.strokeDasharray,I=v.isAnimationActive,M=v.animationBegin,R=v.animationDuration,F=v.animationEasing,q=v.animationId,H=v.animateNewValues,j=v.width,$=v.height,Y=this.state,K=Y.prevPoints,re=Y.totalLength;return He.createElement(Rl,{begin:M,duration:R,isActive:I,easing:F,from:{t:0},to:{t:1},key:"line-".concat(q),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(se){var J=se.t;if(K){var ae=K.length/i.length,de=i.map(function(Ze,nt){var Je=Math.floor(nt*ae);if(K[Je]){var ot=K[Je],it=za(ot.x,Ze.x),Pt=za(ot.y,Ze.y);return Ra(Ra({},Ze),{},{x:it(J),y:Pt(J)})}if(H){var Ot=za(j*2,Ze.x),yt=za($/2,Ze.y);return Ra(Ra({},Ze),{},{x:Ot(J),y:yt(J)})}return Ra(Ra({},Ze),{},{x:Ze.x,y:Ze.y})});return _.renderCurveStatically(de,l,d)}var Pe=za(0,re),Ne=Pe(J),rt;if(P){var ke="".concat(P).split(/[,\s]+/gim).map(function(Ze){return parseFloat(Ze)});rt=_.getStrokeDasharray(Ne,re,ke)}else rt=_.generateSimpleStrokeDasharray(re,Ne);return _.renderCurveStatically(i,l,d,{strokeDasharray:rt})})}},{key:"renderCurve",value:function(l,d){var _=this.props,v=_.points,i=_.isAnimationActive,P=this.state,I=P.prevPoints,M=P.totalLength;return i&&v&&v.length&&(!I&&M>0||!By(I,v))?this.renderCurveWithAnimation(l,d):this.renderCurveStatically(v,l,d)}},{key:"render",value:function(){var l,d=this.props,_=d.hide,v=d.dot,i=d.points,P=d.className,I=d.xAxis,M=d.yAxis,R=d.top,F=d.left,q=d.width,H=d.height,j=d.isAnimationActive,$=d.id;if(_||!i||!i.length)return null;var Y=this.state.isAnimationFinished,K=i.length===1,re=Sn("recharts-line",P),se=I&&I.allowDataOverflow,J=M&&M.allowDataOverflow,ae=se||J,de=xn($)?this.id:$,Pe=(l=Jr(v,!1))!==null&&l!==void 0?l:{r:3,strokeWidth:2},Ne=Pe.r,rt=Ne===void 0?3:Ne,ke=Pe.strokeWidth,Ze=ke===void 0?2:ke,nt=RQ(v)?v:{},Je=nt.clipDot,ot=Je===void 0?!0:Je,it=rt*2+Ze;return He.createElement(ti,{className:re},se||J?He.createElement("defs",null,He.createElement("clipPath",{id:"clipPath-".concat(de)},He.createElement("rect",{x:se?F:F-q/2,y:J?R:R-H/2,width:se?q:q*2,height:J?H:H*2})),!ot&&He.createElement("clipPath",{id:"clipPath-dots-".concat(de)},He.createElement("rect",{x:F-it/2,y:R-it/2,width:q+it,height:H+it}))):null,!K&&this.renderCurve(ae,de),this.renderErrorBar(ae,de),(K||v)&&this.renderDots(ae,ot,de),(!j||Y)&&Ac.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(l,d){return l.animationId!==d.prevAnimationId?{prevAnimationId:l.animationId,curPoints:l.points,prevPoints:d.curPoints}:l.points!==d.curPoints?{curPoints:l.points}:null}},{key:"repeat",value:function(l,d){for(var _=l.length%2!==0?[].concat(op(l),[0]):l,v=[],i=0;i<d;++i)v=[].concat(op(v),op(_));return v}},{key:"renderDotItem",value:function(l,d){var _;if(He.isValidElement(l))_=He.cloneElement(l,d);else if(pn(l))_=l(d);else{var v=d.key,i=E5(d,Vpe),P=Sn("recharts-line-dot",typeof l!="boolean"?l.className:"");_=He.createElement(hw,F_({key:v},i,{className:P}))}return _}}])})(ie.PureComponent);js(Nu,"displayName","Line");js(Nu,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!yd.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});js(Nu,"getComposedData",function(e){var t=e.props,a=e.xAxis,l=e.yAxis,d=e.xAxisTicks,_=e.yAxisTicks,v=e.dataKey,i=e.bandSize,P=e.displayedData,I=e.offset,M=t.layout,R=P.map(function(F,q){var H=mo(F,v);return M==="horizontal"?{x:OF({axis:a,ticks:d,bandSize:i,entry:F,index:q}),y:xn(H)?null:l.scale(H),value:H,payload:F}:{x:xn(H)?null:a.scale(H),y:OF({axis:l,ticks:_,bandSize:i,entry:F,index:q}),value:H,payload:F}});return Ra({points:R,layout:M},I)});function Hp(e){"@babel/helpers - typeof";return Hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hp(e)}function tme(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rme(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,hq(l.key),l)}}function nme(e,t,a){return t&&rme(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ime(e,t,a){return t=bb(t),ome(e,cq()?Reflect.construct(t,a||[],bb(e).constructor):t.apply(e,a))}function ome(e,t){if(t&&(Hp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ame(e)}function ame(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cq=function(){return!!e})()}function bb(e){return bb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},bb(e)}function sme(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LI(e,t)}function LI(e,t){return LI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},LI(e,t)}function uq(e,t,a){return t=hq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function hq(e){var t=lme(e,"string");return Hp(t)=="symbol"?t:t+""}function lme(e,t){if(Hp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Hp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function jI(){return jI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},jI.apply(this,arguments)}function cme(e){var t=e.xAxisId,a=AO(),l=EO(),d=X6(t);return d==null?null:ie.createElement(dm,jI({},d,{className:Sn("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:a,height:l},ticksGenerator:function(v){return xc(v,!0)}}))}var Wp=(function(e){function t(){return tme(this,t),ime(this,t,arguments)}return sme(t,e),nme(t,[{key:"render",value:function(){return ie.createElement(cme,this.props)}}])})(ie.Component);uq(Wp,"displayName","XAxis");uq(Wp,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Zp(e){"@babel/helpers - typeof";return Zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zp(e)}function ume(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hme(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,pq(l.key),l)}}function dme(e,t,a){return t&&hme(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function fme(e,t,a){return t=wb(t),pme(e,dq()?Reflect.construct(t,a||[],wb(e).constructor):t.apply(e,a))}function pme(e,t){if(t&&(Zp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mme(e)}function mme(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dq=function(){return!!e})()}function wb(e){return wb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},wb(e)}function gme(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zI(e,t)}function zI(e,t){return zI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},zI(e,t)}function fq(e,t,a){return t=pq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pq(e){var t=_me(e,"string");return Zp(t)=="symbol"?t:t+""}function _me(e,t){if(Zp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Zp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function FI(){return FI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},FI.apply(this,arguments)}var yme=function(t){var a=t.yAxisId,l=AO(),d=EO(),_=K6(a);return _==null?null:ie.createElement(dm,FI({},_,{className:Sn("recharts-".concat(_.axisType," ").concat(_.axisType),_.className),viewBox:{x:0,y:0,width:l,height:d},ticksGenerator:function(i){return xc(i,!0)}}))},Xp=(function(e){function t(){return ume(this,t),fme(this,t,arguments)}return gme(t,e),dme(t,[{key:"render",value:function(){return ie.createElement(yme,this.props)}}])})(ie.Component);fq(Xp,"displayName","YAxis");fq(Xp,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function C5(e){return wme(e)||bme(e)||xme(e)||vme()}function vme(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xme(e,t){if(e){if(typeof e=="string")return BI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return BI(e,t)}}function bme(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wme(e){if(Array.isArray(e))return BI(e)}function BI(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}var UI=function(t,a,l,d,_){var v=$a(t,IO),i=$a(t,xw),P=[].concat(C5(v),C5(i)),I=$a(t,ww),M="".concat(d,"Id"),R=d[0],F=a;if(P.length&&(F=P.reduce(function(j,$){if($.props[M]===l&&Pl($.props,"extendDomain")&&fr($.props[R])){var Y=$.props[R];return[Math.min(j[0],Y),Math.max(j[1],Y)]}return j},F)),I.length){var q="".concat(R,"1"),H="".concat(R,"2");F=I.reduce(function(j,$){if($.props[M]===l&&Pl($.props,"extendDomain")&&fr($.props[q])&&fr($.props[H])){var Y=$.props[q],K=$.props[H];return[Math.min(j[0],Y,K),Math.max(j[1],Y,K)]}return j},F)}return _&&_.length&&(F=_.reduce(function(j,$){return fr($)?[Math.min(j[0],$),Math.max(j[1],$)]:j},F)),F},V2={exports:{}},O5;function Sme(){return O5||(O5=1,(function(e){var t=Object.prototype.hasOwnProperty,a="~";function l(){}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(a=!1));function d(P,I,M){this.fn=P,this.context=I,this.once=M||!1}function _(P,I,M,R,F){if(typeof M!="function")throw new TypeError("The listener must be a function");var q=new d(M,R||P,F),H=a?a+I:I;return P._events[H]?P._events[H].fn?P._events[H]=[P._events[H],q]:P._events[H].push(q):(P._events[H]=q,P._eventsCount++),P}function v(P,I){--P._eventsCount===0?P._events=new l:delete P._events[I]}function i(){this._events=new l,this._eventsCount=0}i.prototype.eventNames=function(){var I=[],M,R;if(this._eventsCount===0)return I;for(R in M=this._events)t.call(M,R)&&I.push(a?R.slice(1):R);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(M)):I},i.prototype.listeners=function(I){var M=a?a+I:I,R=this._events[M];if(!R)return[];if(R.fn)return[R.fn];for(var F=0,q=R.length,H=new Array(q);F<q;F++)H[F]=R[F].fn;return H},i.prototype.listenerCount=function(I){var M=a?a+I:I,R=this._events[M];return R?R.fn?1:R.length:0},i.prototype.emit=function(I,M,R,F,q,H){var j=a?a+I:I;if(!this._events[j])return!1;var $=this._events[j],Y=arguments.length,K,re;if($.fn){switch($.once&&this.removeListener(I,$.fn,void 0,!0),Y){case 1:return $.fn.call($.context),!0;case 2:return $.fn.call($.context,M),!0;case 3:return $.fn.call($.context,M,R),!0;case 4:return $.fn.call($.context,M,R,F),!0;case 5:return $.fn.call($.context,M,R,F,q),!0;case 6:return $.fn.call($.context,M,R,F,q,H),!0}for(re=1,K=new Array(Y-1);re<Y;re++)K[re-1]=arguments[re];$.fn.apply($.context,K)}else{var se=$.length,J;for(re=0;re<se;re++)switch($[re].once&&this.removeListener(I,$[re].fn,void 0,!0),Y){case 1:$[re].fn.call($[re].context);break;case 2:$[re].fn.call($[re].context,M);break;case 3:$[re].fn.call($[re].context,M,R);break;case 4:$[re].fn.call($[re].context,M,R,F);break;default:if(!K)for(J=1,K=new Array(Y-1);J<Y;J++)K[J-1]=arguments[J];$[re].fn.apply($[re].context,K)}}return!0},i.prototype.on=function(I,M,R){return _(this,I,M,R,!1)},i.prototype.once=function(I,M,R){return _(this,I,M,R,!0)},i.prototype.removeListener=function(I,M,R,F){var q=a?a+I:I;if(!this._events[q])return this;if(!M)return v(this,q),this;var H=this._events[q];if(H.fn)H.fn===M&&(!F||H.once)&&(!R||H.context===R)&&v(this,q);else{for(var j=0,$=[],Y=H.length;j<Y;j++)(H[j].fn!==M||F&&!H[j].once||R&&H[j].context!==R)&&$.push(H[j]);$.length?this._events[q]=$.length===1?$[0]:$:v(this,q)}return this},i.prototype.removeAllListeners=function(I){var M;return I?(M=a?a+I:I,this._events[M]&&v(this,M)):(this._events=new l,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=a,i.EventEmitter=i,e.exports=i})(V2)),V2.exports}var Tme=Sme();const Ame=si(Tme);var $2=new Ame,q2="recharts.syncMouseEvents";function Ty(e){"@babel/helpers - typeof";return Ty=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ty(e)}function Eme(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pme(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,mq(l.key),l)}}function Ime(e,t,a){return t&&Pme(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function G2(e,t,a){return t=mq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mq(e){var t=Cme(e,"string");return Ty(t)=="symbol"?t:t+""}function Cme(e,t){if(Ty(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Ty(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ome=(function(){function e(){Eme(this,e),G2(this,"activeIndex",0),G2(this,"coordinateList",[]),G2(this,"layout","horizontal")}return Ime(e,[{key:"setDetails",value:function(a){var l,d=a.coordinateList,_=d===void 0?null:d,v=a.container,i=v===void 0?null:v,P=a.layout,I=P===void 0?null:P,M=a.offset,R=M===void 0?null:M,F=a.mouseHandlerCallback,q=F===void 0?null:F;this.coordinateList=(l=_??this.coordinateList)!==null&&l!==void 0?l:[],this.container=i??this.container,this.layout=I??this.layout,this.offset=R??this.offset,this.mouseHandlerCallback=q??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(a){if(this.coordinateList.length!==0)switch(a.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(a){this.activeIndex=a}},{key:"spoofMouse",value:function(){var a,l;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var d=this.container.getBoundingClientRect(),_=d.x,v=d.y,i=d.height,P=this.coordinateList[this.activeIndex].coordinate,I=((a=window)===null||a===void 0?void 0:a.scrollX)||0,M=((l=window)===null||l===void 0?void 0:l.scrollY)||0,R=_+P+I,F=v+this.offset.top+i/2+M;this.mouseHandlerCallback({pageX:R,pageY:F})}}}])})();function Mme(e,t,a){if(a==="number"&&t===!0&&Array.isArray(e)){var l=e?.[0],d=e?.[1];if(l&&d&&fr(l)&&fr(d))return!0}return!1}function Rme(e,t,a,l){var d=l/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-d:a.left+.5,y:e==="horizontal"?a.top+.5:t.y-d,width:e==="horizontal"?l:a.width-1,height:e==="horizontal"?a.height-1:l}}function gq(e){var t=e.cx,a=e.cy,l=e.radius,d=e.startAngle,_=e.endAngle,v=Ci(t,a,l,d),i=Ci(t,a,l,_);return{points:[v,i],cx:t,cy:a,radius:l,startAngle:d,endAngle:_}}function Dme(e,t,a){var l,d,_,v;if(e==="horizontal")l=t.x,_=l,d=a.top,v=a.top+a.height;else if(e==="vertical")d=t.y,v=d,l=a.left,_=a.left+a.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,P=t.cy,I=t.innerRadius,M=t.outerRadius,R=t.angle,F=Ci(i,P,I,R),q=Ci(i,P,M,R);l=F.x,d=F.y,_=q.x,v=q.y}else return gq(t);return[{x:l,y:d},{x:_,y:v}]}function Ay(e){"@babel/helpers - typeof";return Ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ay(e)}function M5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function i0(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?M5(Object(a),!0).forEach(function(l){kme(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function kme(e,t,a){return t=Nme(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Nme(e){var t=Lme(e,"string");return Ay(t)=="symbol"?t:t+""}function Lme(e,t){if(Ay(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Ay(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function jme(e){var t,a,l=e.element,d=e.tooltipEventType,_=e.isActive,v=e.activeCoordinate,i=e.activePayload,P=e.offset,I=e.activeTooltipIndex,M=e.tooltipAxisBandSize,R=e.layout,F=e.chartName,q=(t=l.props.cursor)!==null&&t!==void 0?t:(a=l.type.defaultProps)===null||a===void 0?void 0:a.cursor;if(!l||!q||!_||!v||F!=="ScatterChart"&&d!=="axis")return null;var H,j=eb;if(F==="ScatterChart")H=v,j=ohe;else if(F==="BarChart")H=Rme(R,v,P,M),j=bO;else if(R==="radial"){var $=gq(v),Y=$.cx,K=$.cy,re=$.radius,se=$.startAngle,J=$.endAngle;H={cx:Y,cy:K,startAngle:se,endAngle:J,innerRadius:re,outerRadius:re},j=_6}else H={points:Dme(R,v,P)},j=eb;var ae=i0(i0(i0(i0({stroke:"#ccc",pointerEvents:"none"},P),H),Jr(q,!1)),{},{payload:i,payloadIndex:I,className:Sn("recharts-tooltip-cursor",q.className)});return ie.isValidElement(q)?ie.cloneElement(q,ae):ie.createElement(j,ae)}var zme=["item"],Fme=["children","className","width","height","style","compact","title","desc"];function Kp(e){"@babel/helpers - typeof";return Kp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kp(e)}function pp(){return pp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},pp.apply(this,arguments)}function R5(e,t){return Vme(e)||Ume(e,t)||yq(e,t)||Bme()}function Bme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ume(e,t){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var l,d,_,v,i=[],P=!0,I=!1;try{if(_=(a=a.call(e)).next,t!==0)for(;!(P=(l=_.call(a)).done)&&(i.push(l.value),i.length!==t);P=!0);}catch(M){I=!0,d=M}finally{try{if(!P&&a.return!=null&&(v=a.return(),Object(v)!==v))return}finally{if(I)throw d}}return i}}function Vme(e){if(Array.isArray(e))return e}function D5(e,t){if(e==null)return{};var a=$me(e,t),l,d;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(d=0;d<_.length;d++)l=_[d],!(t.indexOf(l)>=0)&&Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}function $me(e,t){if(e==null)return{};var a={};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){if(t.indexOf(l)>=0)continue;a[l]=e[l]}return a}function qme(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gme(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,vq(l.key),l)}}function Hme(e,t,a){return t&&Gme(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wme(e,t,a){return t=Sb(t),Zme(e,_q()?Reflect.construct(t,a||[],Sb(e).constructor):t.apply(e,a))}function Zme(e,t){if(t&&(Kp(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xme(e)}function Xme(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_q=function(){return!!e})()}function Sb(e){return Sb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Sb(e)}function Kme(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VI(e,t)}function VI(e,t){return VI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},VI(e,t)}function Yp(e){return Qme(e)||Jme(e)||yq(e)||Yme()}function Yme(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yq(e,t){if(e){if(typeof e=="string")return $I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $I(e,t)}}function Jme(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Qme(e){if(Array.isArray(e))return $I(e)}function $I(e,t){(t==null||t>e.length)&&(t=e.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=e[a];return l}function k5(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,l)}return a}function Ft(e){for(var t=1;t<arguments.length;t++){var a=arguments[t]!=null?arguments[t]:{};t%2?k5(Object(a),!0).forEach(function(l){rn(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k5(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function rn(e,t,a){return t=vq(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function vq(e){var t=ege(e,"string");return Kp(t)=="symbol"?t:t+""}function ege(e,t){if(Kp(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var l=a.call(e,t);if(Kp(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var tge={xAxis:["bottom","top"],yAxis:["left","right"]},rge={width:"100%",height:"100%"},xq={x:0,y:0};function o0(e){return e}var nge=function(t,a){return a==="horizontal"?t.x:a==="vertical"?t.y:a==="centric"?t.angle:t.radius},ige=function(t,a,l,d){var _=a.find(function(M){return M&&M.index===l});if(_){if(t==="horizontal")return{x:_.coordinate,y:d.y};if(t==="vertical")return{x:d.x,y:_.coordinate};if(t==="centric"){var v=_.coordinate,i=d.radius;return Ft(Ft(Ft({},d),Ci(d.cx,d.cy,i,v)),{},{angle:v,radius:i})}var P=_.coordinate,I=d.angle;return Ft(Ft(Ft({},d),Ci(d.cx,d.cy,P,I)),{},{angle:I,radius:P})}return xq},Sw=function(t,a){var l=a.graphicalItems,d=a.dataStartIndex,_=a.dataEndIndex,v=(l??[]).reduce(function(i,P){var I=P.props.data;return I&&I.length?[].concat(Yp(i),Yp(I)):i},[]);return v.length>0?v:t&&t.length&&fr(d)&&fr(_)?t.slice(d,_+1):[]};function bq(e){return e==="number"?[0,"auto"]:void 0}var qI=function(t,a,l,d){var _=t.graphicalItems,v=t.tooltipAxis,i=Sw(a,t);return l<0||!_||!_.length||l>=i.length?null:_.reduce(function(P,I){var M,R=(M=I.props.data)!==null&&M!==void 0?M:a;R&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=l&&(R=R.slice(t.dataStartIndex,t.dataEndIndex+1));var F;if(v.dataKey&&!v.allowDuplicatedCategory){var q=R===void 0?i:R;F=E0(q,v.dataKey,d)}else F=R&&R[l]||i[l];return F?[].concat(Yp(P),[h6(I,F)]):P},[])},N5=function(t,a,l,d){var _=d||{x:t.chartX,y:t.chartY},v=nge(_,l),i=t.orderedTooltipTicks,P=t.tooltipAxis,I=t.tooltipTicks,M=Cse(v,i,I,P);if(M>=0&&I){var R=I[M]&&I[M].value,F=qI(t,a,M,R),q=ige(l,i,M,_);return{activeTooltipIndex:M,activeLabel:R,activePayload:F,activeCoordinate:q}}return null},oge=function(t,a){var l=a.axes,d=a.graphicalItems,_=a.axisType,v=a.axisIdKey,i=a.stackGroups,P=a.dataStartIndex,I=a.dataEndIndex,M=t.layout,R=t.children,F=t.stackOffset,q=o6(M,_);return l.reduce(function(H,j){var $,Y=j.type.defaultProps!==void 0?Ft(Ft({},j.type.defaultProps),j.props):j.props,K=Y.type,re=Y.dataKey,se=Y.allowDataOverflow,J=Y.allowDuplicatedCategory,ae=Y.scale,de=Y.ticks,Pe=Y.includeHidden,Ne=Y[v];if(H[Ne])return H;var rt=Sw(t.data,{graphicalItems:d.filter(function(rr){var Tr,an=v in rr.props?rr.props[v]:(Tr=rr.type.defaultProps)===null||Tr===void 0?void 0:Tr[v];return an===Ne}),dataStartIndex:P,dataEndIndex:I}),ke=rt.length,Ze,nt,Je;Mme(Y.domain,se,K)&&(Ze=nI(Y.domain,null,se),q&&(K==="number"||ae!=="auto")&&(Je=N_(rt,re,"category")));var ot=bq(K);if(!Ze||Ze.length===0){var it,Pt=(it=Y.domain)!==null&&it!==void 0?it:ot;if(re){if(Ze=N_(rt,re,K),K==="category"&&q){var Ot=wQ(Ze);J&&Ot?(nt=Ze,Ze=ub(0,ke)):J||(Ze=kF(Pt,Ze,j).reduce(function(rr,Tr){return rr.indexOf(Tr)>=0?rr:[].concat(Yp(rr),[Tr])},[]))}else if(K==="category")J?Ze=Ze.filter(function(rr){return rr!==""&&!xn(rr)}):Ze=kF(Pt,Ze,j).reduce(function(rr,Tr){return rr.indexOf(Tr)>=0||Tr===""||xn(Tr)?rr:[].concat(Yp(rr),[Tr])},[]);else if(K==="number"){var yt=kse(rt,d.filter(function(rr){var Tr,an,An=v in rr.props?rr.props[v]:(Tr=rr.type.defaultProps)===null||Tr===void 0?void 0:Tr[v],Fr="hide"in rr.props?rr.props.hide:(an=rr.type.defaultProps)===null||an===void 0?void 0:an.hide;return An===Ne&&(Pe||!Fr)}),re,_,M);yt&&(Ze=yt)}q&&(K==="number"||ae!=="auto")&&(Je=N_(rt,re,"category"))}else q?Ze=ub(0,ke):i&&i[Ne]&&i[Ne].hasStack&&K==="number"?Ze=F==="expand"?[0,1]:u6(i[Ne].stackGroups,P,I):Ze=i6(rt,d.filter(function(rr){var Tr=v in rr.props?rr.props[v]:rr.type.defaultProps[v],an="hide"in rr.props?rr.props.hide:rr.type.defaultProps.hide;return Tr===Ne&&(Pe||!an)}),K,M,!0);if(K==="number")Ze=UI(R,Ze,Ne,_,de),Pt&&(Ze=nI(Pt,Ze,se));else if(K==="category"&&Pt){var ar=Pt,qt=Ze.every(function(rr){return ar.indexOf(rr)>=0});qt&&(Ze=ar)}}return Ft(Ft({},H),{},rn({},Ne,Ft(Ft({},Y),{},{axisType:_,domain:Ze,categoricalDomain:Je,duplicateDomain:nt,originalDomain:($=Y.domain)!==null&&$!==void 0?$:ot,isCategorical:q,layout:M})))},{})},age=function(t,a){var l=a.graphicalItems,d=a.Axis,_=a.axisType,v=a.axisIdKey,i=a.stackGroups,P=a.dataStartIndex,I=a.dataEndIndex,M=t.layout,R=t.children,F=Sw(t.data,{graphicalItems:l,dataStartIndex:P,dataEndIndex:I}),q=F.length,H=o6(M,_),j=-1;return l.reduce(function($,Y){var K=Y.type.defaultProps!==void 0?Ft(Ft({},Y.type.defaultProps),Y.props):Y.props,re=K[v],se=bq("number");if(!$[re]){j++;var J;return H?J=ub(0,q):i&&i[re]&&i[re].hasStack?(J=u6(i[re].stackGroups,P,I),J=UI(R,J,re,_)):(J=nI(se,i6(F,l.filter(function(ae){var de,Pe,Ne=v in ae.props?ae.props[v]:(de=ae.type.defaultProps)===null||de===void 0?void 0:de[v],rt="hide"in ae.props?ae.props.hide:(Pe=ae.type.defaultProps)===null||Pe===void 0?void 0:Pe.hide;return Ne===re&&!rt}),"number",M),d.defaultProps.allowDataOverflow),J=UI(R,J,re,_)),Ft(Ft({},$),{},rn({},re,Ft(Ft({axisType:_},d.defaultProps),{},{hide:!0,orientation:Va(tge,"".concat(_,".").concat(j%2),null),domain:J,originalDomain:se,isCategorical:H,layout:M})))}return $},{})},sge=function(t,a){var l=a.axisType,d=l===void 0?"xAxis":l,_=a.AxisComp,v=a.graphicalItems,i=a.stackGroups,P=a.dataStartIndex,I=a.dataEndIndex,M=t.children,R="".concat(d,"Id"),F=$a(M,_),q={};return F&&F.length?q=oge(t,{axes:F,graphicalItems:v,axisType:d,axisIdKey:R,stackGroups:i,dataStartIndex:P,dataEndIndex:I}):v&&v.length&&(q=age(t,{Axis:_,graphicalItems:v,axisType:d,axisIdKey:R,stackGroups:i,dataStartIndex:P,dataEndIndex:I})),q},lge=function(t){var a=Ru(t),l=xc(a,!1,!0);return{tooltipTicks:l,orderedTooltipTicks:ZC(l,function(d){return d.coordinate}),tooltipAxis:a,tooltipAxisBandSize:Y0(a,l)}},L5=function(t){var a=t.children,l=t.defaultShowTooltip,d=Na(a,Fp),_=0,v=0;return t.data&&t.data.length!==0&&(v=t.data.length-1),d&&d.props&&(d.props.startIndex>=0&&(_=d.props.startIndex),d.props.endIndex>=0&&(v=d.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:_,dataEndIndex:v,activeTooltipIndex:-1,isTooltipActive:!!l}},cge=function(t){return!t||!t.length?!1:t.some(function(a){var l=wc(a&&a.type);return l&&l.indexOf("Bar")>=0})},j5=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},uge=function(t,a){var l=t.props,d=t.graphicalItems,_=t.xAxisMap,v=_===void 0?{}:_,i=t.yAxisMap,P=i===void 0?{}:i,I=l.width,M=l.height,R=l.children,F=l.margin||{},q=Na(R,Fp),H=Na(R,Sc),j=Object.keys(P).reduce(function(J,ae){var de=P[ae],Pe=de.orientation;return!de.mirror&&!de.hide?Ft(Ft({},J),{},rn({},Pe,J[Pe]+de.width)):J},{left:F.left||0,right:F.right||0}),$=Object.keys(v).reduce(function(J,ae){var de=v[ae],Pe=de.orientation;return!de.mirror&&!de.hide?Ft(Ft({},J),{},rn({},Pe,Va(J,"".concat(Pe))+de.height)):J},{top:F.top||0,bottom:F.bottom||0}),Y=Ft(Ft({},$),j),K=Y.bottom;q&&(Y.bottom+=q.props.height||Fp.defaultProps.height),H&&a&&(Y=Rse(Y,d,l,a));var re=I-Y.left-Y.right,se=M-Y.top-Y.bottom;return Ft(Ft({brushBottom:K},Y),{},{width:Math.max(re,0),height:Math.max(se,0)})},hge=function(t,a){if(a==="xAxis")return t[a].width;if(a==="yAxis")return t[a].height},MO=function(t){var a=t.chartName,l=t.GraphicalChild,d=t.defaultTooltipEventType,_=d===void 0?"axis":d,v=t.validateTooltipEventTypes,i=v===void 0?["axis"]:v,P=t.axisComponents,I=t.legendContent,M=t.formatAxisMap,R=t.defaultProps,F=function(Y,K){var re=K.graphicalItems,se=K.stackGroups,J=K.offset,ae=K.updateId,de=K.dataStartIndex,Pe=K.dataEndIndex,Ne=Y.barSize,rt=Y.layout,ke=Y.barGap,Ze=Y.barCategoryGap,nt=Y.maxBarSize,Je=j5(rt),ot=Je.numericAxisName,it=Je.cateAxisName,Pt=cge(re),Ot=[];return re.forEach(function(yt,ar){var qt=Sw(Y.data,{graphicalItems:[yt],dataStartIndex:de,dataEndIndex:Pe}),rr=yt.type.defaultProps!==void 0?Ft(Ft({},yt.type.defaultProps),yt.props):yt.props,Tr=rr.dataKey,an=rr.maxBarSize,An=rr["".concat(ot,"Id")],Fr=rr["".concat(it,"Id")],nr={},Dr=P.reduce(function(Ni,oo){var Ho=K["".concat(oo.axisType,"Map")],qa=rr["".concat(oo.axisType,"Id")];Ho&&Ho[qa]||oo.axisType==="zAxis"||dd();var Ga=Ho[qa];return Ft(Ft({},Ni),{},rn(rn({},oo.axisType,Ga),"".concat(oo.axisType,"Ticks"),xc(Ga)))},nr),er=Dr[it],or=Dr["".concat(it,"Ticks")],br=se&&se[An]&&se[An].hasStack&&$se(yt,se[An].stackGroups),jt=wc(yt.type).indexOf("Bar")>=0,bn=Y0(er,or),Hr=[],Zr=Pt&&Ose({barSize:Ne,stackGroups:se,totalSize:hge(Dr,it)});if(jt){var ni,hi,Lo=xn(an)?nt:an,ki=(ni=(hi=Y0(er,or,!0))!==null&&hi!==void 0?hi:Lo)!==null&&ni!==void 0?ni:0;Hr=Mse({barGap:ke,barCategoryGap:Ze,bandSize:ki!==bn?ki:bn,sizeList:Zr[Fr],maxBarSize:Lo}),ki!==bn&&(Hr=Hr.map(function(Ni){return Ft(Ft({},Ni),{},{position:Ft(Ft({},Ni.position),{},{offset:Ni.position.offset-ki/2})})}))}var Go=yt&&yt.type&&yt.type.getComposedData;Go&&Ot.push({props:Ft(Ft({},Go(Ft(Ft({},Dr),{},{displayedData:qt,props:Y,dataKey:Tr,item:yt,bandSize:bn,barPosition:Hr,offset:J,stackedData:br,layout:rt,dataStartIndex:de,dataEndIndex:Pe}))),{},rn(rn(rn({key:yt.key||"item-".concat(ar)},ot,Dr[ot]),it,Dr[it]),"animationId",ae)),childIndex:NQ(yt,Y.children),item:yt})}),Ot},q=function(Y,K){var re=Y.props,se=Y.dataStartIndex,J=Y.dataEndIndex,ae=Y.updateId;if(!ZL({props:re}))return null;var de=re.children,Pe=re.layout,Ne=re.stackOffset,rt=re.data,ke=re.reverseStackOrder,Ze=j5(Pe),nt=Ze.numericAxisName,Je=Ze.cateAxisName,ot=$a(de,l),it=Use(rt,ot,"".concat(nt,"Id"),"".concat(Je,"Id"),Ne,ke),Pt=P.reduce(function(rr,Tr){var an="".concat(Tr.axisType,"Map");return Ft(Ft({},rr),{},rn({},an,sge(re,Ft(Ft({},Tr),{},{graphicalItems:ot,stackGroups:Tr.axisType===nt&&it,dataStartIndex:se,dataEndIndex:J}))))},{}),Ot=uge(Ft(Ft({},Pt),{},{props:re,graphicalItems:ot}),K?.legendBBox);Object.keys(Pt).forEach(function(rr){Pt[rr]=M(re,Pt[rr],Ot,rr.replace("Map",""),a)});var yt=Pt["".concat(Je,"Map")],ar=lge(yt),qt=F(re,Ft(Ft({},Pt),{},{dataStartIndex:se,dataEndIndex:J,updateId:ae,graphicalItems:ot,stackGroups:it,offset:Ot}));return Ft(Ft({formattedGraphicalItems:qt,graphicalItems:ot,offset:Ot,stackGroups:it},ar),Pt)},H=(function($){function Y(K){var re,se,J;return qme(this,Y),J=Wme(this,Y,[K]),rn(J,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),rn(J,"accessibilityManager",new Ome),rn(J,"handleLegendBBoxUpdate",function(ae){if(ae){var de=J.state,Pe=de.dataStartIndex,Ne=de.dataEndIndex,rt=de.updateId;J.setState(Ft({legendBBox:ae},q({props:J.props,dataStartIndex:Pe,dataEndIndex:Ne,updateId:rt},Ft(Ft({},J.state),{},{legendBBox:ae}))))}}),rn(J,"handleReceiveSyncEvent",function(ae,de,Pe){if(J.props.syncId===ae){if(Pe===J.eventEmitterSymbol&&typeof J.props.syncMethod!="function")return;J.applySyncEvent(de)}}),rn(J,"handleBrushChange",function(ae){var de=ae.startIndex,Pe=ae.endIndex;if(de!==J.state.dataStartIndex||Pe!==J.state.dataEndIndex){var Ne=J.state.updateId;J.setState(function(){return Ft({dataStartIndex:de,dataEndIndex:Pe},q({props:J.props,dataStartIndex:de,dataEndIndex:Pe,updateId:Ne},J.state))}),J.triggerSyncEvent({dataStartIndex:de,dataEndIndex:Pe})}}),rn(J,"handleMouseEnter",function(ae){var de=J.getMouseInfo(ae);if(de){var Pe=Ft(Ft({},de),{},{isTooltipActive:!0});J.setState(Pe),J.triggerSyncEvent(Pe);var Ne=J.props.onMouseEnter;pn(Ne)&&Ne(Pe,ae)}}),rn(J,"triggeredAfterMouseMove",function(ae){var de=J.getMouseInfo(ae),Pe=de?Ft(Ft({},de),{},{isTooltipActive:!0}):{isTooltipActive:!1};J.setState(Pe),J.triggerSyncEvent(Pe);var Ne=J.props.onMouseMove;pn(Ne)&&Ne(Pe,ae)}),rn(J,"handleItemMouseEnter",function(ae){J.setState(function(){return{isTooltipActive:!0,activeItem:ae,activePayload:ae.tooltipPayload,activeCoordinate:ae.tooltipPosition||{x:ae.cx,y:ae.cy}}})}),rn(J,"handleItemMouseLeave",function(){J.setState(function(){return{isTooltipActive:!1}})}),rn(J,"handleMouseMove",function(ae){ae.persist(),J.throttleTriggeredAfterMouseMove(ae)}),rn(J,"handleMouseLeave",function(ae){J.throttleTriggeredAfterMouseMove.cancel();var de={isTooltipActive:!1};J.setState(de),J.triggerSyncEvent(de);var Pe=J.props.onMouseLeave;pn(Pe)&&Pe(de,ae)}),rn(J,"handleOuterEvent",function(ae){var de=kQ(ae),Pe=Va(J.props,"".concat(de));if(de&&pn(Pe)){var Ne,rt;/.*touch.*/i.test(de)?rt=J.getMouseInfo(ae.changedTouches[0]):rt=J.getMouseInfo(ae),Pe((Ne=rt)!==null&&Ne!==void 0?Ne:{},ae)}}),rn(J,"handleClick",function(ae){var de=J.getMouseInfo(ae);if(de){var Pe=Ft(Ft({},de),{},{isTooltipActive:!0});J.setState(Pe),J.triggerSyncEvent(Pe);var Ne=J.props.onClick;pn(Ne)&&Ne(Pe,ae)}}),rn(J,"handleMouseDown",function(ae){var de=J.props.onMouseDown;if(pn(de)){var Pe=J.getMouseInfo(ae);de(Pe,ae)}}),rn(J,"handleMouseUp",function(ae){var de=J.props.onMouseUp;if(pn(de)){var Pe=J.getMouseInfo(ae);de(Pe,ae)}}),rn(J,"handleTouchMove",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&J.throttleTriggeredAfterMouseMove(ae.changedTouches[0])}),rn(J,"handleTouchStart",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&J.handleMouseDown(ae.changedTouches[0])}),rn(J,"handleTouchEnd",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&J.handleMouseUp(ae.changedTouches[0])}),rn(J,"handleDoubleClick",function(ae){var de=J.props.onDoubleClick;if(pn(de)){var Pe=J.getMouseInfo(ae);de(Pe,ae)}}),rn(J,"handleContextMenu",function(ae){var de=J.props.onContextMenu;if(pn(de)){var Pe=J.getMouseInfo(ae);de(Pe,ae)}}),rn(J,"triggerSyncEvent",function(ae){J.props.syncId!==void 0&&$2.emit(q2,J.props.syncId,ae,J.eventEmitterSymbol)}),rn(J,"applySyncEvent",function(ae){var de=J.props,Pe=de.layout,Ne=de.syncMethod,rt=J.state.updateId,ke=ae.dataStartIndex,Ze=ae.dataEndIndex;if(ae.dataStartIndex!==void 0||ae.dataEndIndex!==void 0)J.setState(Ft({dataStartIndex:ke,dataEndIndex:Ze},q({props:J.props,dataStartIndex:ke,dataEndIndex:Ze,updateId:rt},J.state)));else if(ae.activeTooltipIndex!==void 0){var nt=ae.chartX,Je=ae.chartY,ot=ae.activeTooltipIndex,it=J.state,Pt=it.offset,Ot=it.tooltipTicks;if(!Pt)return;if(typeof Ne=="function")ot=Ne(Ot,ae);else if(Ne==="value"){ot=-1;for(var yt=0;yt<Ot.length;yt++)if(Ot[yt].value===ae.activeLabel){ot=yt;break}}var ar=Ft(Ft({},Pt),{},{x:Pt.left,y:Pt.top}),qt=Math.min(nt,ar.x+ar.width),rr=Math.min(Je,ar.y+ar.height),Tr=Ot[ot]&&Ot[ot].value,an=qI(J.state,J.props.data,ot),An=Ot[ot]?{x:Pe==="horizontal"?Ot[ot].coordinate:qt,y:Pe==="horizontal"?rr:Ot[ot].coordinate}:xq;J.setState(Ft(Ft({},ae),{},{activeLabel:Tr,activeCoordinate:An,activePayload:an,activeTooltipIndex:ot}))}else J.setState(ae)}),rn(J,"renderCursor",function(ae){var de,Pe=J.state,Ne=Pe.isTooltipActive,rt=Pe.activeCoordinate,ke=Pe.activePayload,Ze=Pe.offset,nt=Pe.activeTooltipIndex,Je=Pe.tooltipAxisBandSize,ot=J.getTooltipEventType(),it=(de=ae.props.active)!==null&&de!==void 0?de:Ne,Pt=J.props.layout,Ot=ae.key||"_recharts-cursor";return He.createElement(jme,{key:Ot,activeCoordinate:rt,activePayload:ke,activeTooltipIndex:nt,chartName:a,element:ae,isActive:it,layout:Pt,offset:Ze,tooltipAxisBandSize:Je,tooltipEventType:ot})}),rn(J,"renderPolarAxis",function(ae,de,Pe){var Ne=Va(ae,"type.axisType"),rt=Va(J.state,"".concat(Ne,"Map")),ke=ae.type.defaultProps,Ze=ke!==void 0?Ft(Ft({},ke),ae.props):ae.props,nt=rt&&rt[Ze["".concat(Ne,"Id")]];return ie.cloneElement(ae,Ft(Ft({},nt),{},{className:Sn(Ne,nt.className),key:ae.key||"".concat(de,"-").concat(Pe),ticks:xc(nt,!0)}))}),rn(J,"renderPolarGrid",function(ae){var de=ae.props,Pe=de.radialLines,Ne=de.polarAngles,rt=de.polarRadius,ke=J.state,Ze=ke.radiusAxisMap,nt=ke.angleAxisMap,Je=Ru(Ze),ot=Ru(nt),it=ot.cx,Pt=ot.cy,Ot=ot.innerRadius,yt=ot.outerRadius;return ie.cloneElement(ae,{polarAngles:Array.isArray(Ne)?Ne:xc(ot,!0).map(function(ar){return ar.coordinate}),polarRadius:Array.isArray(rt)?rt:xc(Je,!0).map(function(ar){return ar.coordinate}),cx:it,cy:Pt,innerRadius:Ot,outerRadius:yt,key:ae.key||"polar-grid",radialLines:Pe})}),rn(J,"renderLegend",function(){var ae=J.state.formattedGraphicalItems,de=J.props,Pe=de.children,Ne=de.width,rt=de.height,ke=J.props.margin||{},Ze=Ne-(ke.left||0)-(ke.right||0),nt=r6({children:Pe,formattedGraphicalItems:ae,legendWidth:Ze,legendContent:I});if(!nt)return null;var Je=nt.item,ot=D5(nt,zme);return ie.cloneElement(Je,Ft(Ft({},ot),{},{chartWidth:Ne,chartHeight:rt,margin:ke,onBBoxUpdate:J.handleLegendBBoxUpdate}))}),rn(J,"renderTooltip",function(){var ae,de=J.props,Pe=de.children,Ne=de.accessibilityLayer,rt=Na(Pe,La);if(!rt)return null;var ke=J.state,Ze=ke.isTooltipActive,nt=ke.activeCoordinate,Je=ke.activePayload,ot=ke.activeLabel,it=ke.offset,Pt=(ae=rt.props.active)!==null&&ae!==void 0?ae:Ze;return ie.cloneElement(rt,{viewBox:Ft(Ft({},it),{},{x:it.left,y:it.top}),active:Pt,label:ot,payload:Pt?Je:[],coordinate:nt,accessibilityLayer:Ne})}),rn(J,"renderBrush",function(ae){var de=J.props,Pe=de.margin,Ne=de.data,rt=J.state,ke=rt.offset,Ze=rt.dataStartIndex,nt=rt.dataEndIndex,Je=rt.updateId;return ie.cloneElement(ae,{key:ae.key||"_recharts-brush",onChange:e0(J.handleBrushChange,ae.props.onChange),data:Ne,x:fr(ae.props.x)?ae.props.x:ke.left,y:fr(ae.props.y)?ae.props.y:ke.top+ke.height+ke.brushBottom-(Pe.bottom||0),width:fr(ae.props.width)?ae.props.width:ke.width,startIndex:Ze,endIndex:nt,updateId:"brush-".concat(Je)})}),rn(J,"renderReferenceElement",function(ae,de,Pe){if(!ae)return null;var Ne=J,rt=Ne.clipPathId,ke=J.state,Ze=ke.xAxisMap,nt=ke.yAxisMap,Je=ke.offset,ot=ae.type.defaultProps||{},it=ae.props,Pt=it.xAxisId,Ot=Pt===void 0?ot.xAxisId:Pt,yt=it.yAxisId,ar=yt===void 0?ot.yAxisId:yt;return ie.cloneElement(ae,{key:ae.key||"".concat(de,"-").concat(Pe),xAxis:Ze[Ot],yAxis:nt[ar],viewBox:{x:Je.left,y:Je.top,width:Je.width,height:Je.height},clipPathId:rt})}),rn(J,"renderActivePoints",function(ae){var de=ae.item,Pe=ae.activePoint,Ne=ae.basePoint,rt=ae.childIndex,ke=ae.isRange,Ze=[],nt=de.props.key,Je=de.item.type.defaultProps!==void 0?Ft(Ft({},de.item.type.defaultProps),de.item.props):de.item.props,ot=Je.activeDot,it=Je.dataKey,Pt=Ft(Ft({index:rt,dataKey:it,cx:Pe.x,cy:Pe.y,r:4,fill:xO(de.item),strokeWidth:2,stroke:"#fff",payload:Pe.payload,value:Pe.value},Jr(ot,!1)),P0(ot));return Ze.push(Y.renderActiveDot(ot,Pt,"".concat(nt,"-activePoint-").concat(rt))),Ne?Ze.push(Y.renderActiveDot(ot,Ft(Ft({},Pt),{},{cx:Ne.x,cy:Ne.y}),"".concat(nt,"-basePoint-").concat(rt))):ke&&Ze.push(null),Ze}),rn(J,"renderGraphicChild",function(ae,de,Pe){var Ne=J.filterFormatItem(ae,de,Pe);if(!Ne)return null;var rt=J.getTooltipEventType(),ke=J.state,Ze=ke.isTooltipActive,nt=ke.tooltipAxis,Je=ke.activeTooltipIndex,ot=ke.activeLabel,it=J.props.children,Pt=Na(it,La),Ot=Ne.props,yt=Ot.points,ar=Ot.isRange,qt=Ot.baseLine,rr=Ne.item.type.defaultProps!==void 0?Ft(Ft({},Ne.item.type.defaultProps),Ne.item.props):Ne.item.props,Tr=rr.activeDot,an=rr.hide,An=rr.activeBar,Fr=rr.activeShape,nr=!!(!an&&Ze&&Pt&&(Tr||An||Fr)),Dr={};rt!=="axis"&&Pt&&Pt.props.trigger==="click"?Dr={onClick:e0(J.handleItemMouseEnter,ae.props.onClick)}:rt!=="axis"&&(Dr={onMouseLeave:e0(J.handleItemMouseLeave,ae.props.onMouseLeave),onMouseEnter:e0(J.handleItemMouseEnter,ae.props.onMouseEnter)});var er=ie.cloneElement(ae,Ft(Ft({},Ne.props),Dr));function or(oo){return typeof nt.dataKey=="function"?nt.dataKey(oo.payload):null}if(nr)if(Je>=0){var br,jt;if(nt.dataKey&&!nt.allowDuplicatedCategory){var bn=typeof nt.dataKey=="function"?or:"payload.".concat(nt.dataKey.toString());br=E0(yt,bn,ot),jt=ar&&qt&&E0(qt,bn,ot)}else br=yt?.[Je],jt=ar&&qt&&qt[Je];if(Fr||An){var Hr=ae.props.activeIndex!==void 0?ae.props.activeIndex:Je;return[ie.cloneElement(ae,Ft(Ft(Ft({},Ne.props),Dr),{},{activeIndex:Hr})),null,null]}if(!xn(br))return[er].concat(Yp(J.renderActivePoints({item:Ne,activePoint:br,basePoint:jt,childIndex:Je,isRange:ar})))}else{var Zr,ni=(Zr=J.getItemByXY(J.state.activeCoordinate))!==null&&Zr!==void 0?Zr:{graphicalItem:er},hi=ni.graphicalItem,Lo=hi.item,ki=Lo===void 0?ae:Lo,Go=hi.childIndex,Ni=Ft(Ft(Ft({},Ne.props),Dr),{},{activeIndex:Go});return[ie.cloneElement(ki,Ni),null,null]}return ar?[er,null,null]:[er,null]}),rn(J,"renderCustomized",function(ae,de,Pe){return ie.cloneElement(ae,Ft(Ft({key:"recharts-customized-".concat(Pe)},J.props),J.state))}),rn(J,"renderMap",{CartesianGrid:{handler:o0,once:!0},ReferenceArea:{handler:J.renderReferenceElement},ReferenceLine:{handler:o0},ReferenceDot:{handler:J.renderReferenceElement},XAxis:{handler:o0},YAxis:{handler:o0},Brush:{handler:J.renderBrush,once:!0},Bar:{handler:J.renderGraphicChild},Line:{handler:J.renderGraphicChild},Area:{handler:J.renderGraphicChild},Radar:{handler:J.renderGraphicChild},RadialBar:{handler:J.renderGraphicChild},Scatter:{handler:J.renderGraphicChild},Pie:{handler:J.renderGraphicChild},Funnel:{handler:J.renderGraphicChild},Tooltip:{handler:J.renderCursor,once:!0},PolarGrid:{handler:J.renderPolarGrid,once:!0},PolarAngleAxis:{handler:J.renderPolarAxis},PolarRadiusAxis:{handler:J.renderPolarAxis},Customized:{handler:J.renderCustomized}}),J.clipPathId="".concat((re=K.id)!==null&&re!==void 0?re:sm("recharts"),"-clip"),J.throttleTriggeredAfterMouseMove=t$(J.triggeredAfterMouseMove,(se=K.throttleDelay)!==null&&se!==void 0?se:1e3/60),J.state={},J}return Kme(Y,$),Hme(Y,[{key:"componentDidMount",value:function(){var re,se;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(re=this.props.margin.left)!==null&&re!==void 0?re:0,top:(se=this.props.margin.top)!==null&&se!==void 0?se:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var re=this.props,se=re.children,J=re.data,ae=re.height,de=re.layout,Pe=Na(se,La);if(Pe){var Ne=Pe.props.defaultIndex;if(!(typeof Ne!="number"||Ne<0||Ne>this.state.tooltipTicks.length-1)){var rt=this.state.tooltipTicks[Ne]&&this.state.tooltipTicks[Ne].value,ke=qI(this.state,J,Ne,rt),Ze=this.state.tooltipTicks[Ne].coordinate,nt=(this.state.offset.top+ae)/2,Je=de==="horizontal",ot=Je?{x:Ze,y:nt}:{y:Ze,x:nt},it=this.state.formattedGraphicalItems.find(function(Ot){var yt=Ot.item;return yt.type.name==="Scatter"});it&&(ot=Ft(Ft({},ot),it.props.points[Ne].tooltipPosition),ke=it.props.points[Ne].tooltipPayload);var Pt={activeTooltipIndex:Ne,isTooltipActive:!0,activeLabel:rt,activePayload:ke,activeCoordinate:ot};this.setState(Pt),this.renderCursor(Pe),this.accessibilityManager.setIndex(Ne)}}}},{key:"getSnapshotBeforeUpdate",value:function(re,se){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==se.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==re.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==re.margin){var J,ae;this.accessibilityManager.setDetails({offset:{left:(J=this.props.margin.left)!==null&&J!==void 0?J:0,top:(ae=this.props.margin.top)!==null&&ae!==void 0?ae:0}})}return null}},{key:"componentDidUpdate",value:function(re){AP([Na(re.children,La)],[Na(this.props.children,La)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var re=Na(this.props.children,La);if(re&&typeof re.props.shared=="boolean"){var se=re.props.shared?"axis":"item";return i.indexOf(se)>=0?se:_}return _}},{key:"getMouseInfo",value:function(re){if(!this.container)return null;var se=this.container,J=se.getBoundingClientRect(),ae=bne(J),de={chartX:Math.round(re.pageX-ae.left),chartY:Math.round(re.pageY-ae.top)},Pe=J.width/se.offsetWidth||1,Ne=this.inRange(de.chartX,de.chartY,Pe);if(!Ne)return null;var rt=this.state,ke=rt.xAxisMap,Ze=rt.yAxisMap,nt=this.getTooltipEventType(),Je=N5(this.state,this.props.data,this.props.layout,Ne);if(nt!=="axis"&&ke&&Ze){var ot=Ru(ke).scale,it=Ru(Ze).scale,Pt=ot&&ot.invert?ot.invert(de.chartX):null,Ot=it&&it.invert?it.invert(de.chartY):null;return Ft(Ft({},de),{},{xValue:Pt,yValue:Ot},Je)}return Je?Ft(Ft({},de),Je):null}},{key:"inRange",value:function(re,se){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ae=this.props.layout,de=re/J,Pe=se/J;if(ae==="horizontal"||ae==="vertical"){var Ne=this.state.offset,rt=de>=Ne.left&&de<=Ne.left+Ne.width&&Pe>=Ne.top&&Pe<=Ne.top+Ne.height;return rt?{x:de,y:Pe}:null}var ke=this.state,Ze=ke.angleAxisMap,nt=ke.radiusAxisMap;if(Ze&&nt){var Je=Ru(Ze);return jF({x:de,y:Pe},Je)}return null}},{key:"parseEventsOfWrapper",value:function(){var re=this.props.children,se=this.getTooltipEventType(),J=Na(re,La),ae={};J&&se==="axis"&&(J.props.trigger==="click"?ae={onClick:this.handleClick}:ae={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var de=P0(this.props,this.handleOuterEvent);return Ft(Ft({},de),ae)}},{key:"addListener",value:function(){$2.on(q2,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){$2.removeListener(q2,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(re,se,J){for(var ae=this.state.formattedGraphicalItems,de=0,Pe=ae.length;de<Pe;de++){var Ne=ae[de];if(Ne.item===re||Ne.props.key===re.key||se===wc(Ne.item.type)&&J===Ne.childIndex)return Ne}return null}},{key:"renderClipPath",value:function(){var re=this.clipPathId,se=this.state.offset,J=se.left,ae=se.top,de=se.height,Pe=se.width;return He.createElement("defs",null,He.createElement("clipPath",{id:re},He.createElement("rect",{x:J,y:ae,height:de,width:Pe})))}},{key:"getXScales",value:function(){var re=this.state.xAxisMap;return re?Object.entries(re).reduce(function(se,J){var ae=R5(J,2),de=ae[0],Pe=ae[1];return Ft(Ft({},se),{},rn({},de,Pe.scale))},{}):null}},{key:"getYScales",value:function(){var re=this.state.yAxisMap;return re?Object.entries(re).reduce(function(se,J){var ae=R5(J,2),de=ae[0],Pe=ae[1];return Ft(Ft({},se),{},rn({},de,Pe.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(re){var se;return(se=this.state.xAxisMap)===null||se===void 0||(se=se[re])===null||se===void 0?void 0:se.scale}},{key:"getYScaleByAxisId",value:function(re){var se;return(se=this.state.yAxisMap)===null||se===void 0||(se=se[re])===null||se===void 0?void 0:se.scale}},{key:"getItemByXY",value:function(re){var se=this.state,J=se.formattedGraphicalItems,ae=se.activeItem;if(J&&J.length)for(var de=0,Pe=J.length;de<Pe;de++){var Ne=J[de],rt=Ne.props,ke=Ne.item,Ze=ke.type.defaultProps!==void 0?Ft(Ft({},ke.type.defaultProps),ke.props):ke.props,nt=wc(ke.type);if(nt==="Bar"){var Je=(rt.data||[]).find(function(Ot){return Fue(re,Ot)});if(Je)return{graphicalItem:Ne,payload:Je}}else if(nt==="RadialBar"){var ot=(rt.data||[]).find(function(Ot){return jF(re,Ot)});if(ot)return{graphicalItem:Ne,payload:ot}}else if(gw(Ne,ae)||_w(Ne,ae)||vy(Ne,ae)){var it=lde({graphicalItem:Ne,activeTooltipItem:ae,itemData:Ze.data}),Pt=Ze.activeIndex===void 0?it:Ze.activeIndex;return{graphicalItem:Ft(Ft({},Ne),{},{childIndex:Pt}),payload:vy(Ne,ae)?Ze.data[it]:Ne.props.data[it]}}}return null}},{key:"render",value:function(){var re=this;if(!ZL(this))return null;var se=this.props,J=se.children,ae=se.className,de=se.width,Pe=se.height,Ne=se.style,rt=se.compact,ke=se.title,Ze=se.desc,nt=D5(se,Fme),Je=Jr(nt,!1);if(rt)return He.createElement(f5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},He.createElement(PP,pp({},Je,{width:de,height:Pe,title:ke,desc:Ze}),this.renderClipPath(),KL(J,this.renderMap)));if(this.props.accessibilityLayer){var ot,it;Je.tabIndex=(ot=this.props.tabIndex)!==null&&ot!==void 0?ot:0,Je.role=(it=this.props.role)!==null&&it!==void 0?it:"application",Je.onKeyDown=function(Ot){re.accessibilityManager.keyboardEvent(Ot)},Je.onFocus=function(){re.accessibilityManager.focus()}}var Pt=this.parseEventsOfWrapper();return He.createElement(f5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},He.createElement("div",pp({className:Sn("recharts-wrapper",ae),style:Ft({position:"relative",cursor:"default",width:de,height:Pe},Ne)},Pt,{ref:function(yt){re.container=yt}}),He.createElement(PP,pp({},Je,{width:de,height:Pe,title:ke,desc:Ze,style:rge}),this.renderClipPath(),KL(J,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])})(ie.Component);rn(H,"displayName",a),rn(H,"defaultProps",Ft({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},R)),rn(H,"getDerivedStateFromProps",function($,Y){var K=$.dataKey,re=$.data,se=$.children,J=$.width,ae=$.height,de=$.layout,Pe=$.stackOffset,Ne=$.margin,rt=Y.dataStartIndex,ke=Y.dataEndIndex;if(Y.updateId===void 0){var Ze=L5($);return Ft(Ft(Ft({},Ze),{},{updateId:0},q(Ft(Ft({props:$},Ze),{},{updateId:0}),Y)),{},{prevDataKey:K,prevData:re,prevWidth:J,prevHeight:ae,prevLayout:de,prevStackOffset:Pe,prevMargin:Ne,prevChildren:se})}if(K!==Y.prevDataKey||re!==Y.prevData||J!==Y.prevWidth||ae!==Y.prevHeight||de!==Y.prevLayout||Pe!==Y.prevStackOffset||!_p(Ne,Y.prevMargin)){var nt=L5($),Je={chartX:Y.chartX,chartY:Y.chartY,isTooltipActive:Y.isTooltipActive},ot=Ft(Ft({},N5(Y,re,de)),{},{updateId:Y.updateId+1}),it=Ft(Ft(Ft({},nt),Je),ot);return Ft(Ft(Ft({},it),q(Ft({props:$},it),Y)),{},{prevDataKey:K,prevData:re,prevWidth:J,prevHeight:ae,prevLayout:de,prevStackOffset:Pe,prevMargin:Ne,prevChildren:se})}if(!AP(se,Y.prevChildren)){var Pt,Ot,yt,ar,qt=Na(se,Fp),rr=qt&&(Pt=(Ot=qt.props)===null||Ot===void 0?void 0:Ot.startIndex)!==null&&Pt!==void 0?Pt:rt,Tr=qt&&(yt=(ar=qt.props)===null||ar===void 0?void 0:ar.endIndex)!==null&&yt!==void 0?yt:ke,an=rr!==rt||Tr!==ke,An=!xn(re),Fr=An&&!an?Y.updateId:Y.updateId+1;return Ft(Ft({updateId:Fr},q(Ft(Ft({props:$},Y),{},{updateId:Fr,dataStartIndex:rr,dataEndIndex:Tr}),Y)),{},{prevChildren:se,dataStartIndex:rr,dataEndIndex:Tr})}return null}),rn(H,"renderActiveDot",function($,Y,K){var re;return ie.isValidElement($)?re=ie.cloneElement($,Y):pn($)?re=$(Y):re=He.createElement(hw,Y),He.createElement(ti,{className:"recharts-active-dot",key:K},re)});var j=ie.forwardRef(function(Y,K){return He.createElement(H,pp({},Y,{ref:K}))});return j.displayName=H.displayName,j},dge=MO({chartName:"LineChart",GraphicalChild:Nu,axisComponents:[{axisType:"xAxis",AxisComp:Wp},{axisType:"yAxis",AxisComp:Xp}],formatAxisMap:U6}),fge=MO({chartName:"BarChart",GraphicalChild:wd,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Wp},{axisType:"yAxis",AxisComp:Xp}],formatAxisMap:U6}),z5=MO({chartName:"PieChart",GraphicalChild:Dl,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:mw},{axisType:"radiusAxis",AxisComp:fw}],formatAxisMap:Qse,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});function F5(){const{data:e,isLoading:t}=Po({queryKey:["/api/v1/networks"],queryFn:()=>po.getNetworks(10),refetchInterval:3e4}),{data:a,isLoading:l}=Po({queryKey:["/api/v1/analytics"],queryFn:()=>po.getAnalytics(),refetchInterval:3e4}),{data:d,isLoading:_}=Po({queryKey:["/api/v1/radio-stats"],queryFn:()=>po.getRadioStats(),refetchInterval:3e4}),{data:v}=Po({queryKey:["/api/v1/security-analysis"],queryFn:()=>po.getSecurityAnalysis(),refetchInterval:3e4}),{data:i}=Po({queryKey:["/api/v1/signal-strength"],queryFn:()=>po.getSignalStrengthDistribution(),refetchInterval:3e4}),{data:P}=Po({queryKey:["/api/v1/timeline"],queryFn:()=>po.getTimelineData(),refetchInterval:3e4}),I=a?.data?.overview||{},M=d?.data||[],R=K=>{const re=M.find(se=>se.radio_type===K);return{observations:re?.total_observations||0,networks:re?.distinct_networks||0}},F=R("wifi"),q=R("cellular"),H=R("bluetooth"),j=R("ble"),Y=(()=>{const K=P?.data||[],re=Array.from({length:24},(se,J)=>({hour:J.toString().padStart(2,"0")+":00",wifi:0,cellular:0,bluetooth:0,ble:0}));return K.forEach(se=>{const ae=new Date(se.hour).getHours(),de=se.radio_type?.toLowerCase()||"",Pe=Number(se.detection_count)||0;ae>=0&&ae<24&&(de==="wifi"?re[ae].wifi+=Pe:de==="cellular"?re[ae].cellular+=Pe:de==="bluetooth"?re[ae].bluetooth+=Pe:de==="ble"&&(re[ae].ble+=Pe))}),re})();return T.jsx("div",{className:"flex-1 flex flex-col h-full min-h-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:T.jsx("main",{className:"flex-1 overflow-y-auto min-h-0",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[T.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30",children:T.jsx(Ec,{className:"h-6 w-6 text-white"})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(59,130,246,0.5)]",children:"Intelligence Dashboard"}),T.jsx("p",{className:"text-sm text-slate-400 cyber-text tracking-wide mt-1",children:"Real-time SIGINT analytics and network forensics"})]})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[T.jsx("div",{className:"premium-card","aria-label":`WiFi observations: ${F.observations.toLocaleString()} total, ${F.networks.toLocaleString()} networks`,"data-testid":"card-wifi",children:T.jsx(Hi,{className:"relative p-8",children:T.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx(nd,{className:"h-8 w-8 text-blue-400"})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-3xl metric-value mb-2","data-testid":"metric-wifi-observations",children:F.observations.toLocaleString()}),T.jsx("p",{className:"text-base font-semibold text-blue-400 mb-1",children:"WiFi Observations"}),T.jsxs("p",{className:"text-sm !text-slate-700 dark:!text-slate-300 silver-accent px-3 py-1 rounded-full",children:[F.networks.toLocaleString()," networks"]})]})]})})}),T.jsx("div",{className:"premium-card","aria-label":`Cellular observations: ${q.observations.toLocaleString()} total, ${q.networks.toLocaleString()} towers`,"data-testid":"card-cellular",children:T.jsx(Hi,{className:"relative p-8",children:T.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx(nP,{className:"h-8 w-8 text-emerald-500"})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-3xl metric-value mb-2","data-testid":"metric-cellular-observations",children:q.observations.toLocaleString()}),T.jsx("p",{className:"text-base font-semibold text-emerald-500 mb-1",children:"Cellular Observations"}),T.jsxs("p",{className:"text-sm !text-slate-700 dark:!text-slate-300 silver-accent px-3 py-1 rounded-full",children:[q.networks.toLocaleString()," towers"]})]})]})})}),T.jsx("div",{className:"premium-card","aria-label":`Bluetooth observations: ${H.observations.toLocaleString()} total, ${H.networks.toLocaleString()} devices`,"data-testid":"card-bluetooth",children:T.jsx(Hi,{className:"relative p-8",children:T.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx(iP,{className:"h-8 w-8 text-purple-400"})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-3xl metric-value mb-2","data-testid":"metric-bluetooth-observations",children:H.observations.toLocaleString()}),T.jsx("p",{className:"text-base font-semibold text-purple-400 mb-1",children:"Bluetooth Observations"}),T.jsxs("p",{className:"text-sm !text-slate-700 dark:!text-slate-300 silver-accent px-3 py-1 rounded-full",children:[H.networks.toLocaleString()," devices"]})]})]})})}),T.jsx("div",{className:"premium-card","aria-label":`BLE observations: ${j.observations.toLocaleString()} total, ${j.networks.toLocaleString()} devices`,"data-testid":"card-ble",children:T.jsx(Hi,{className:"relative p-8",children:T.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx(v0,{className:"h-8 w-8 text-amber-500"})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-3xl metric-value mb-2","data-testid":"metric-ble-observations",children:j.observations.toLocaleString()}),T.jsx("p",{className:"text-base font-semibold text-amber-500 mb-1",children:"BLE Observations"}),T.jsxs("p",{className:"text-sm !text-slate-700 dark:!text-slate-300 silver-accent px-3 py-1 rounded-full",children:[j.networks.toLocaleString()," devices"]})]})]})})})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[T.jsx("div",{className:"premium-card",children:T.jsx(Hi,{className:"relative p-8",children:T.jsx("div",{className:"flex items-start justify-between",children:T.jsxs("div",{className:"flex items-center gap-4",children:[T.jsx("div",{className:"icon-container w-16 h-16",children:T.jsx(M_,{className:"h-8 w-8 text-cyan-400"})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-4xl metric-value mb-2","data-testid":"metric-total-observations",children:Number(I.total_observations||0).toLocaleString()}),T.jsx("p",{className:"text-lg font-medium text-cyan-400 mb-1",children:"Total Network Observations"}),T.jsx("p",{className:"text-sm !text-slate-700 dark:!text-slate-300 silver-accent px-3 py-1 rounded-full inline-block",children:"Location records in database"})]})]})})})}),T.jsx("div",{className:"premium-card",children:T.jsx(Hi,{className:"relative p-8",children:T.jsx("div",{className:"flex items-start justify-between",children:T.jsxs("div",{className:"flex items-center gap-4",children:[T.jsx("div",{className:"icon-container w-16 h-16",children:T.jsx(Us,{className:"h-8 w-8 text-indigo-400"})}),T.jsxs("div",{children:[T.jsx("p",{className:"text-4xl metric-value mb-2","data-testid":"metric-distinct-networks",children:Number(I.distinct_networks||0).toLocaleString()}),T.jsx("p",{className:"text-lg font-medium text-indigo-400 mb-1",children:"Distinct Networks"}),T.jsx("p",{className:"text-sm !text-slate-700 dark:!text-slate-300 silver-accent px-3 py-1 rounded-full inline-block",children:"Unique radio sources detected"})]})]})})})})]}),T.jsxs("div",{className:"premium-card",children:[T.jsxs(us,{children:[T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx(Us,{className:"h-5 w-5 text-rose-400"}),"Network Security Breakdown"]}),T.jsx(gc,{className:"text-slate-400",children:"Encryption and security analysis of detected networks"})]}),T.jsxs(Hi,{children:[T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6",children:[T.jsx("div",{className:"flex justify-center",children:T.jsx(Xx,{width:"100%",height:300,children:T.jsxs(z5,{children:[T.jsx(Dl,{data:(v?.data||[]).slice(0,4).map(K=>({name:K.security_level||K.security,value:K.network_count,color:K.security?.toLowerCase().includes("wpa3")?"#10b981":K.security?.toLowerCase().includes("wpa2")?"#3b82f6":K.security?.toLowerCase().includes("wep")?"#f59e0b":K.security==="Open Network"||!K.security?"#ef4444":"#9ca3af"})),cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:2,dataKey:"value",children:(v?.data||[]).slice(0,4).map((K,re)=>{const se=K.security?.toLowerCase().includes("wpa3")?"#10b981":K.security?.toLowerCase().includes("wpa2")?"#3b82f6":K.security?.toLowerCase().includes("wep")?"#f59e0b":K.security==="Open Network"||!K.security?"#ef4444":"#9ca3af";return T.jsx(yp,{fill:se},`cell-${re}`)})}),T.jsx(La,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #475569",borderRadius:"8px",color:"#e2e8f0"}}),T.jsx(Sc,{wrapperStyle:{color:"#e2e8f0"}})]})})}),T.jsx("div",{className:"space-y-4",children:(v?.data||[]).slice(0,4).map((K,re)=>{const se=K.security?.toLowerCase().includes("wpa3")?"bg-green-500/10 border-green-500/20":K.security?.toLowerCase().includes("wpa2")?"bg-blue-500/10 border-blue-500/20":K.security?.toLowerCase().includes("wep")?"bg-orange-500/10 border-orange-500/20":"bg-red-500/10 border-red-500/20",J=K.security?.toLowerCase().includes("wpa3")?"text-green-300":K.security?.toLowerCase().includes("wpa2")?"text-blue-300":K.security?.toLowerCase().includes("wep")?"text-orange-300":"text-red-300",ae=K.security?.toLowerCase().includes("wpa3")?"text-green-400":K.security?.toLowerCase().includes("wpa2")?"text-blue-400":K.security?.toLowerCase().includes("wep")?"text-orange-400":"text-red-400";return T.jsxs("div",{className:`text-center p-4 ${se} rounded-xl border`,children:[T.jsx("p",{className:`text-3xl font-bold ${J} mb-2 font-mono`,children:K.network_count?.toLocaleString()||0}),T.jsx("p",{className:"text-sm text-slate-300",children:K.security_level}),T.jsxs("p",{className:`text-xs ${ae} mt-1`,children:[K.percentage?.toFixed(1),"% of total"]})]},re)})})]}),T.jsxs("div",{className:"space-y-3",children:[(v?.data||[]).slice(0,8).map((K,re)=>{const se=Number(K.network_count)||0;return T.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border/30 bg-background/40","data-testid":`security-${K.security?.toLowerCase().replace(/[^a-z0-9]/g,"-")||"unknown"}`,children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:`w-3 h-3 rounded-full ${K.security?.includes("WPA3")?"bg-green-500":K.security?.includes("WPA2")?"bg-blue-500":K.security?.includes("WPA")?"bg-yellow-500":K.security?.includes("WEP")?"bg-orange-500":K.security==="[ESS]"||!K.security?"bg-red-500":"bg-gray-500"}`}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-medium text-foreground",children:K.security_level||"Unknown Security"}),T.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:K.security||"Unknown"})]})]}),T.jsxs("div",{className:"text-right",children:[T.jsx("p",{className:"text-lg font-bold text-foreground",children:se.toLocaleString()}),T.jsxs("p",{className:"text-xs text-muted-foreground",children:[K.percentage?.toFixed(1),"%"]})]})]},re)}),(!v?.data||v.data.length===0)&&T.jsx("div",{className:"col-span-full text-center py-4",children:T.jsx(Mu,{className:"h-16 w-full"})})]})]})]}),T.jsxs("div",{className:"premium-card",children:[T.jsxs(us,{children:[T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx(M_,{className:"h-5 w-5 text-teal-400"}),"Radio Type Distribution"]}),T.jsx(gc,{className:"text-slate-400",children:"Breakdown of detected wireless protocols and radio frequencies"})]}),T.jsx(Hi,{children:T.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6",children:[T.jsx("div",{className:"flex justify-center",children:T.jsx(Xx,{width:"100%",height:300,children:T.jsxs(z5,{children:[T.jsx(Dl,{data:[{name:"WiFi Networks",value:F.observations,color:"#3b82f6"},{name:"Cellular Towers",value:q.observations,color:"#10b981"},{name:"Bluetooth Devices",value:H.observations,color:"#a855f7"},{name:"BLE Beacons",value:j.observations,color:"#f59e0b"}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:2,dataKey:"value",children:[{color:"#3b82f6"},{color:"#10b981"},{color:"#a855f7"},{color:"#f59e0b"}].map((K,re)=>T.jsx(yp,{fill:K.color},`cell-${re}`))}),T.jsx(La,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #475569",borderRadius:"8px",color:"#e2e8f0"}}),T.jsx(Sc,{wrapperStyle:{color:"#e2e8f0"}})]})})}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"text-center p-4 bg-blue-500/10 rounded-xl border border-blue-500/20",children:[T.jsx("p",{className:"text-3xl font-bold text-blue-300 mb-2 font-mono",children:F.observations.toLocaleString()}),T.jsx("p",{className:"text-sm text-slate-300",children:"WiFi Networks"}),T.jsxs("p",{className:"text-xs text-blue-400 mt-1",children:[F.networks.toLocaleString()," unique networks"]})]}),T.jsxs("div",{className:"text-center p-4 bg-green-500/10 rounded-xl border border-green-500/20",children:[T.jsx("p",{className:"text-3xl font-bold text-green-300 mb-2 font-mono",children:q.observations.toLocaleString()}),T.jsx("p",{className:"text-sm text-slate-300",children:"Cellular Towers"}),T.jsxs("p",{className:"text-xs text-green-400 mt-1",children:[q.networks.toLocaleString()," unique towers"]})]}),T.jsxs("div",{className:"text-center p-4 bg-purple-500/10 rounded-xl border border-purple-500/20",children:[T.jsx("p",{className:"text-3xl font-bold text-purple-300 mb-2 font-mono",children:H.observations.toLocaleString()}),T.jsx("p",{className:"text-sm text-slate-300",children:"Bluetooth Devices"}),T.jsxs("p",{className:"text-xs text-purple-400 mt-1",children:[H.networks.toLocaleString()," unique devices"]})]}),T.jsxs("div",{className:"text-center p-4 bg-orange-500/10 rounded-xl border border-orange-500/20",children:[T.jsx("p",{className:"text-3xl font-bold text-orange-300 mb-2 font-mono",children:j.observations.toLocaleString()}),T.jsx("p",{className:"text-sm text-slate-300",children:"BLE Beacons"}),T.jsxs("p",{className:"text-xs text-orange-400 mt-1",children:[j.networks.toLocaleString()," unique beacons"]})]})]})]})})]}),T.jsxs("div",{className:"premium-card",children:[T.jsxs(us,{children:[T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx(id,{className:"h-5 w-5 text-emerald-400"}),"Signal Strength Distribution"]}),T.jsx(gc,{className:"text-slate-400",children:"Distribution of network signal strengths across all observations"})]}),T.jsx(Hi,{children:T.jsx("div",{className:"h-80",children:T.jsx(Xx,{width:"100%",height:"100%",children:T.jsxs(fge,{data:(i?.data||[]).map(K=>({range:K.signal_range,count:Number(K.count)||0,fill:K.signal_range?.includes("Very Weak")?"#ef4444":K.signal_range?.includes("Weak")?"#f59e0b":K.signal_range?.includes("Fair")?"#eab308":K.signal_range?.includes("Good")?"#84cc16":K.signal_range?.includes("Excellent")?"#10b981":"#9ca3af"})),margin:{top:20,right:30,left:20,bottom:60},children:[T.jsx(DI,{strokeDasharray:"3 3",stroke:"#334155"}),T.jsx(Wp,{dataKey:"range",stroke:"#94a3b8",angle:-45,textAnchor:"end",height:80,style:{fontSize:"12px"}}),T.jsx(Xp,{stroke:"#94a3b8",label:{value:"Observation Count",angle:-90,position:"insideLeft",style:{fill:"#94a3b8"}},style:{fontSize:"12px"}}),T.jsx(La,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #475569",borderRadius:"8px",color:"#e2e8f0"},cursor:{fill:"rgba(59, 130, 246, 0.1)"}}),T.jsx(wd,{dataKey:"count",radius:[8,8,0,0],children:(i?.data||[]).map((K,re)=>{const se=K.signal_range?.includes("Very Weak")?"#ef4444":K.signal_range?.includes("Weak")?"#f59e0b":K.signal_range?.includes("Fair")?"#eab308":K.signal_range?.includes("Good")?"#84cc16":K.signal_range?.includes("Excellent")?"#10b981":"#9ca3af";return T.jsx(yp,{fill:se},`cell-${re}`)})})]})})})})]}),T.jsxs("div",{className:"premium-card",children:[T.jsxs(us,{children:[T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx(d4,{className:"h-5 w-5 text-yellow-400"}),"Network Detection Timeline"]}),T.jsx(gc,{className:"text-slate-400",children:"Trend of network detections over the past 24 hours"})]}),T.jsx(Hi,{children:T.jsx("div",{className:"h-80",children:T.jsx(Xx,{width:"100%",height:"100%",children:T.jsxs(dge,{data:Y,margin:{top:20,right:30,left:20,bottom:20},children:[T.jsx(DI,{strokeDasharray:"3 3",stroke:"#334155"}),T.jsx(Wp,{dataKey:"hour",stroke:"#94a3b8",style:{fontSize:"12px"},interval:1}),T.jsx(Xp,{stroke:"#94a3b8",label:{value:"Detections",angle:-90,position:"insideLeft",style:{fill:"#94a3b8"}},style:{fontSize:"12px"}}),T.jsx(La,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #475569",borderRadius:"8px",color:"#e2e8f0"}}),T.jsx(Sc,{wrapperStyle:{color:"#e2e8f0"}}),T.jsx(Nu,{type:"monotone",dataKey:"wifi",stroke:"#60a5fa",strokeWidth:2,dot:{r:3},activeDot:{r:5},name:"WiFi"}),T.jsx(Nu,{type:"monotone",dataKey:"cellular",stroke:"#34d399",strokeWidth:2,dot:{r:3},activeDot:{r:5},name:"Cellular"}),T.jsx(Nu,{type:"monotone",dataKey:"bluetooth",stroke:"#c084fc",strokeWidth:2,dot:{r:3},activeDot:{r:5},name:"Bluetooth"}),T.jsx(Nu,{type:"monotone",dataKey:"ble",stroke:"#fbbf24",strokeWidth:2,dot:{r:3},activeDot:{r:5},name:"BLE"})]})})})})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[T.jsx(ka,{href:"/visualization",className:"block",children:T.jsx("div",{className:"premium-card group cursor-pointer hover:scale-105 transition-all duration-300 h-full",children:T.jsx(us,{className:"relative p-8",children:T.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx(M_,{className:"h-8 w-8 text-sky-400"})}),T.jsxs("div",{children:[T.jsx(hs,{className:"text-slate-300 text-xl mb-3",children:"Interactive Visualization"}),T.jsx(gc,{className:"text-slate-400",children:"Geospatial mapping and analysis tools with Mapbox integration for forensics data"})]})]})})})}),T.jsx(ka,{href:"/admin",className:"block",children:T.jsx("div",{className:"premium-card group cursor-pointer hover:scale-105 transition-all duration-300 h-full",children:T.jsx(us,{className:"relative p-8",children:T.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[T.jsx("div",{className:"icon-container",children:T.jsx(Us,{className:"h-8 w-8 text-orange-400"})}),T.jsxs("div",{children:[T.jsx(hs,{className:"text-slate-300 text-xl mb-3",children:"System Administration"}),T.jsx(gc,{className:"text-slate-400",children:"Database monitoring, API status, and system health diagnostics"})]})]})})})})]}),T.jsxs("div",{className:"premium-card",children:[T.jsxs(us,{children:[T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx(id,{className:"h-5 w-5 text-lime-400"}),"Recent SIGINT Activity"]}),T.jsx(gc,{className:"text-slate-400",children:"Latest wireless network observations from forensics database"})]}),T.jsx(Hi,{children:t?T.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((K,re)=>T.jsx(Mu,{className:"h-16 w-full"},re))}):e?.data&&e.data.length>0?T.jsx("div",{className:"space-y-3","data-testid":"recent-activity",children:e.data.slice(0,5).map(K=>T.jsxs("div",{className:"flex items-center justify-between p-3 rounded border border-slate-500/20 bg-background/40","data-testid":`activity-${K.bssid}`,children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"w-2 h-2 bg-cyan-400 rounded-full animate-pulse"}),T.jsxs("div",{children:[T.jsx("p",{className:"font-mono text-sm text-slate-300","data-testid":`activity-ssid-${K.bssid}`,children:K.ssid||"Hidden Network"}),T.jsxs("p",{className:"text-xs text-muted-foreground",children:[K.bssid,"  ",K.frequency," MHz"]})]})]}),T.jsxs("div",{className:"text-right",children:[T.jsxs(Ji,{variant:"outline",className:"text-xs",children:[K.bestlevel," dBm"]}),T.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(Number(K.lasttime)).toLocaleTimeString()})]})]},K.bssid))}):T.jsx("div",{className:"text-center py-8 text-muted-foreground","data-testid":"no-activity",children:"No recent forensics activity. Database connection may be required."})})]})]})})})}var pge=ie.createContext(void 0);function Vy(e){const t=ie.useContext(pge);return e||t||"ltr"}var H2=0;function wq(){ie.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??B5()),document.body.insertAdjacentElement("beforeend",e[1]??B5()),H2++,()=>{H2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),H2--}},[])}function B5(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var W2="focusScope.autoFocusOnMount",Z2="focusScope.autoFocusOnUnmount",U5={bubbles:!1,cancelable:!0},mge="FocusScope",RO=ie.forwardRef((e,t)=>{const{loop:a=!1,trapped:l=!1,onMountAutoFocus:d,onUnmountAutoFocus:_,...v}=e,[i,P]=ie.useState(null),I=ga(d),M=ga(_),R=ie.useRef(null),F=ui(t,j=>P(j)),q=ie.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;ie.useEffect(()=>{if(l){let j=function(re){if(q.paused||!i)return;const se=re.target;i.contains(se)?R.current=se:Cu(R.current,{select:!0})},$=function(re){if(q.paused||!i)return;const se=re.relatedTarget;se!==null&&(i.contains(se)||Cu(R.current,{select:!0}))},Y=function(re){if(document.activeElement===document.body)for(const J of re)J.removedNodes.length>0&&Cu(i)};document.addEventListener("focusin",j),document.addEventListener("focusout",$);const K=new MutationObserver(Y);return i&&K.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",j),document.removeEventListener("focusout",$),K.disconnect()}}},[l,i,q.paused]),ie.useEffect(()=>{if(i){$5.add(q);const j=document.activeElement;if(!i.contains(j)){const Y=new CustomEvent(W2,U5);i.addEventListener(W2,I),i.dispatchEvent(Y),Y.defaultPrevented||(gge(bge(Sq(i)),{select:!0}),document.activeElement===j&&Cu(i))}return()=>{i.removeEventListener(W2,I),setTimeout(()=>{const Y=new CustomEvent(Z2,U5);i.addEventListener(Z2,M),i.dispatchEvent(Y),Y.defaultPrevented||Cu(j??document.body,{select:!0}),i.removeEventListener(Z2,M),$5.remove(q)},0)}}},[i,I,M,q]);const H=ie.useCallback(j=>{if(!a&&!l||q.paused)return;const $=j.key==="Tab"&&!j.altKey&&!j.ctrlKey&&!j.metaKey,Y=document.activeElement;if($&&Y){const K=j.currentTarget,[re,se]=_ge(K);re&&se?!j.shiftKey&&Y===se?(j.preventDefault(),a&&Cu(re,{select:!0})):j.shiftKey&&Y===re&&(j.preventDefault(),a&&Cu(se,{select:!0})):Y===K&&j.preventDefault()}},[a,l,q.paused]);return T.jsx(yn.div,{tabIndex:-1,...v,ref:F,onKeyDown:H})});RO.displayName=mge;function gge(e,{select:t=!1}={}){const a=document.activeElement;for(const l of e)if(Cu(l,{select:t}),document.activeElement!==a)return}function _ge(e){const t=Sq(e),a=V5(t,e),l=V5(t.reverse(),e);return[a,l]}function Sq(e){const t=[],a=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const d=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||d?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)t.push(a.currentNode);return t}function V5(e,t){for(const a of e)if(!yge(a,{upTo:t}))return a}function yge(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function vge(e){return e instanceof HTMLInputElement&&"select"in e}function Cu(e,{select:t=!1}={}){if(e&&e.focus){const a=document.activeElement;e.focus({preventScroll:!0}),e!==a&&vge(e)&&t&&e.select()}}var $5=xge();function xge(){let e=[];return{add(t){const a=e[0];t!==a&&a?.pause(),e=q5(e,t),e.unshift(t)},remove(t){e=q5(e,t),e[0]?.resume()}}}function q5(e,t){const a=[...e],l=a.indexOf(t);return l!==-1&&a.splice(l,1),a}function bge(e){return e.filter(t=>t.tagName!=="A")}var X2="rovingFocusGroup.onEntryFocus",wge={bubbles:!1,cancelable:!0},$y="RovingFocusGroup",[GI,Tq,Sge]=Cy($y),[Tge,Tw]=Gs($y,[Sge]),[Age,Ege]=Tge($y),Aq=ie.forwardRef((e,t)=>T.jsx(GI.Provider,{scope:e.__scopeRovingFocusGroup,children:T.jsx(GI.Slot,{scope:e.__scopeRovingFocusGroup,children:T.jsx(Pge,{...e,ref:t})})}));Aq.displayName=$y;var Pge=ie.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:a,orientation:l,loop:d=!1,dir:_,currentTabStopId:v,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:P,onEntryFocus:I,preventScrollOnEntryFocus:M=!1,...R}=e,F=ie.useRef(null),q=ui(t,F),H=Vy(_),[j,$]=Il({prop:v,defaultProp:i??null,onChange:P,caller:$y}),[Y,K]=ie.useState(!1),re=ga(I),se=Tq(a),J=ie.useRef(!1),[ae,de]=ie.useState(0);return ie.useEffect(()=>{const Pe=F.current;if(Pe)return Pe.addEventListener(X2,re),()=>Pe.removeEventListener(X2,re)},[re]),T.jsx(Age,{scope:a,orientation:l,dir:H,loop:d,currentTabStopId:j,onItemFocus:ie.useCallback(Pe=>$(Pe),[$]),onItemShiftTab:ie.useCallback(()=>K(!0),[]),onFocusableItemAdd:ie.useCallback(()=>de(Pe=>Pe+1),[]),onFocusableItemRemove:ie.useCallback(()=>de(Pe=>Pe-1),[]),children:T.jsx(yn.div,{tabIndex:Y||ae===0?-1:0,"data-orientation":l,...R,ref:q,style:{outline:"none",...e.style},onMouseDown:Pr(e.onMouseDown,()=>{J.current=!0}),onFocus:Pr(e.onFocus,Pe=>{const Ne=!J.current;if(Pe.target===Pe.currentTarget&&Ne&&!Y){const rt=new CustomEvent(X2,wge);if(Pe.currentTarget.dispatchEvent(rt),!rt.defaultPrevented){const ke=se().filter(it=>it.focusable),Ze=ke.find(it=>it.active),nt=ke.find(it=>it.id===j),ot=[Ze,nt,...ke].filter(Boolean).map(it=>it.ref.current);Iq(ot,M)}}J.current=!1}),onBlur:Pr(e.onBlur,()=>K(!1))})})}),Eq="RovingFocusGroupItem",Pq=ie.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:a,focusable:l=!0,active:d=!1,tabStopId:_,children:v,...i}=e,P=Cl(),I=_||P,M=Ege(Eq,a),R=M.currentTabStopId===I,F=Tq(a),{onFocusableItemAdd:q,onFocusableItemRemove:H,currentTabStopId:j}=M;return ie.useEffect(()=>{if(l)return q(),()=>H()},[l,q,H]),T.jsx(GI.ItemSlot,{scope:a,id:I,focusable:l,active:d,children:T.jsx(yn.span,{tabIndex:R?0:-1,"data-orientation":M.orientation,...i,ref:t,onMouseDown:Pr(e.onMouseDown,$=>{l?M.onItemFocus(I):$.preventDefault()}),onFocus:Pr(e.onFocus,()=>M.onItemFocus(I)),onKeyDown:Pr(e.onKeyDown,$=>{if($.key==="Tab"&&$.shiftKey){M.onItemShiftTab();return}if($.target!==$.currentTarget)return;const Y=Oge($,M.orientation,M.dir);if(Y!==void 0){if($.metaKey||$.ctrlKey||$.altKey||$.shiftKey)return;$.preventDefault();let re=F().filter(se=>se.focusable).map(se=>se.ref.current);if(Y==="last")re.reverse();else if(Y==="prev"||Y==="next"){Y==="prev"&&re.reverse();const se=re.indexOf($.currentTarget);re=M.loop?Mge(re,se+1):re.slice(se+1)}setTimeout(()=>Iq(re))}}),children:typeof v=="function"?v({isCurrentTabStop:R,hasTabStop:j!=null}):v})})});Pq.displayName=Eq;var Ige={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Cge(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Oge(e,t,a){const l=Cge(e.key,a);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return Ige[l]}function Iq(e,t=!1){const a=document.activeElement;for(const l of e)if(l===a||(l.focus({preventScroll:t}),document.activeElement!==a))return}function Mge(e,t){return e.map((a,l)=>e[(t+l)%e.length])}var Cq=Aq,Oq=Pq,Rge=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},ap=new WeakMap,a0=new WeakMap,s0={},K2=0,Mq=function(e){return e&&(e.host||Mq(e.parentNode))},Dge=function(e,t){return t.map(function(a){if(e.contains(a))return a;var l=Mq(a);return l&&e.contains(l)?l:(console.error("aria-hidden",a,"in not contained inside",e,". Doing nothing"),null)}).filter(function(a){return!!a})},kge=function(e,t,a,l){var d=Dge(t,Array.isArray(e)?e:[e]);s0[a]||(s0[a]=new WeakMap);var _=s0[a],v=[],i=new Set,P=new Set(d),I=function(R){!R||i.has(R)||(i.add(R),I(R.parentNode))};d.forEach(I);var M=function(R){!R||P.has(R)||Array.prototype.forEach.call(R.children,function(F){if(i.has(F))M(F);else try{var q=F.getAttribute(l),H=q!==null&&q!=="false",j=(ap.get(F)||0)+1,$=(_.get(F)||0)+1;ap.set(F,j),_.set(F,$),v.push(F),j===1&&H&&a0.set(F,!0),$===1&&F.setAttribute(a,"true"),H||F.setAttribute(l,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",F,Y)}})};return M(t),i.clear(),K2++,function(){v.forEach(function(R){var F=ap.get(R)-1,q=_.get(R)-1;ap.set(R,F),_.set(R,q),F||(a0.has(R)||R.removeAttribute(l),a0.delete(R)),q||R.removeAttribute(a)}),K2--,K2||(ap=new WeakMap,ap=new WeakMap,a0=new WeakMap,s0={})}},Rq=function(e,t,a){a===void 0&&(a="data-aria-hidden");var l=Array.from(Array.isArray(e)?e:[e]),d=Rge(e);return d?(l.push.apply(l,Array.from(d.querySelectorAll("[aria-live], script"))),kge(l,d,a,"aria-hidden")):function(){return null}},wl=function(){return wl=Object.assign||function(t){for(var a,l=1,d=arguments.length;l<d;l++){a=arguments[l];for(var _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(t[_]=a[_])}return t},wl.apply(this,arguments)};function Dq(e,t){var a={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(e);d<l.length;d++)t.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(e,l[d])&&(a[l[d]]=e[l[d]]);return a}function Nge(e,t,a){if(a||arguments.length===2)for(var l=0,d=t.length,_;l<d;l++)(_||!(l in t))&&(_||(_=Array.prototype.slice.call(t,0,l)),_[l]=t[l]);return e.concat(_||Array.prototype.slice.call(t))}var g0="right-scroll-bar-position",_0="width-before-scroll-bar",Lge="with-scroll-bars-hidden",jge="--removed-body-scroll-bar-size";function Y2(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function zge(e,t){var a=ie.useState(function(){return{value:e,callback:t,facade:{get current(){return a.value},set current(l){var d=a.value;d!==l&&(a.value=l,a.callback(l,d))}}}})[0];return a.callback=t,a.facade}var Fge=typeof window<"u"?ie.useLayoutEffect:ie.useEffect,G5=new WeakMap;function Bge(e,t){var a=zge(null,function(l){return e.forEach(function(d){return Y2(d,l)})});return Fge(function(){var l=G5.get(a);if(l){var d=new Set(l),_=new Set(e),v=a.current;d.forEach(function(i){_.has(i)||Y2(i,null)}),_.forEach(function(i){d.has(i)||Y2(i,v)})}G5.set(a,e)},[e]),a}function Uge(e){return e}function Vge(e,t){t===void 0&&(t=Uge);var a=[],l=!1,d={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return a.length?a[a.length-1]:e},useMedium:function(_){var v=t(_,l);return a.push(v),function(){a=a.filter(function(i){return i!==v})}},assignSyncMedium:function(_){for(l=!0;a.length;){var v=a;a=[],v.forEach(_)}a={push:function(i){return _(i)},filter:function(){return a}}},assignMedium:function(_){l=!0;var v=[];if(a.length){var i=a;a=[],i.forEach(_),v=a}var P=function(){var M=v;v=[],M.forEach(_)},I=function(){return Promise.resolve().then(P)};I(),a={push:function(M){v.push(M),I()},filter:function(M){return v=v.filter(M),a}}}};return d}function $ge(e){e===void 0&&(e={});var t=Vge(null);return t.options=wl({async:!0,ssr:!1},e),t}var kq=function(e){var t=e.sideCar,a=Dq(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=t.read();if(!l)throw new Error("Sidecar medium not found");return ie.createElement(l,wl({},a))};kq.isSideCarExport=!0;function qge(e,t){return e.useMedium(t),kq}var Nq=$ge(),J2=function(){},Aw=ie.forwardRef(function(e,t){var a=ie.useRef(null),l=ie.useState({onScrollCapture:J2,onWheelCapture:J2,onTouchMoveCapture:J2}),d=l[0],_=l[1],v=e.forwardProps,i=e.children,P=e.className,I=e.removeScrollBar,M=e.enabled,R=e.shards,F=e.sideCar,q=e.noRelative,H=e.noIsolation,j=e.inert,$=e.allowPinchZoom,Y=e.as,K=Y===void 0?"div":Y,re=e.gapMode,se=Dq(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),J=F,ae=Bge([a,t]),de=wl(wl({},se),d);return ie.createElement(ie.Fragment,null,M&&ie.createElement(J,{sideCar:Nq,removeScrollBar:I,shards:R,noRelative:q,noIsolation:H,inert:j,setCallbacks:_,allowPinchZoom:!!$,lockRef:a,gapMode:re}),v?ie.cloneElement(ie.Children.only(i),wl(wl({},de),{ref:ae})):ie.createElement(K,wl({},de,{className:P,ref:ae}),i))});Aw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Aw.classNames={fullWidth:_0,zeroRight:g0};var Gge=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Hge(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Gge();return t&&e.setAttribute("nonce",t),e}function Wge(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Zge(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Xge=function(){var e=0,t=null;return{add:function(a){e==0&&(t=Hge())&&(Wge(t,a),Zge(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Kge=function(){var e=Xge();return function(t,a){ie.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&a])}},Lq=function(){var e=Kge(),t=function(a){var l=a.styles,d=a.dynamic;return e(l,d),null};return t},Yge={left:0,top:0,right:0,gap:0},Q2=function(e){return parseInt(e||"",10)||0},Jge=function(e){var t=window.getComputedStyle(document.body),a=t[e==="padding"?"paddingLeft":"marginLeft"],l=t[e==="padding"?"paddingTop":"marginTop"],d=t[e==="padding"?"paddingRight":"marginRight"];return[Q2(a),Q2(l),Q2(d)]},Qge=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Yge;var t=Jge(e),a=document.documentElement.clientWidth,l=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,l-a+t[2]-t[0])}},e_e=Lq(),bp="data-scroll-locked",t_e=function(e,t,a,l){var d=e.left,_=e.top,v=e.right,i=e.gap;return a===void 0&&(a="margin"),`
  .`.concat(Lge,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(i,"px ").concat(l,`;
  }
  body[`).concat(bp,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(l,";"),a==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(_,`px;
    padding-right: `).concat(v,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(l,`;
    `),a==="padding"&&"padding-right: ".concat(i,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(g0,` {
    right: `).concat(i,"px ").concat(l,`;
  }
  
  .`).concat(_0,` {
    margin-right: `).concat(i,"px ").concat(l,`;
  }
  
  .`).concat(g0," .").concat(g0,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(_0," .").concat(_0,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(bp,`] {
    `).concat(jge,": ").concat(i,`px;
  }
`)},H5=function(){var e=parseInt(document.body.getAttribute(bp)||"0",10);return isFinite(e)?e:0},r_e=function(){ie.useEffect(function(){return document.body.setAttribute(bp,(H5()+1).toString()),function(){var e=H5()-1;e<=0?document.body.removeAttribute(bp):document.body.setAttribute(bp,e.toString())}},[])},n_e=function(e){var t=e.noRelative,a=e.noImportant,l=e.gapMode,d=l===void 0?"margin":l;r_e();var _=ie.useMemo(function(){return Qge(d)},[d]);return ie.createElement(e_e,{styles:t_e(_,!t,d,a?"":"!important")})},HI=!1;if(typeof window<"u")try{var l0=Object.defineProperty({},"passive",{get:function(){return HI=!0,!0}});window.addEventListener("test",l0,l0),window.removeEventListener("test",l0,l0)}catch{HI=!1}var sp=HI?{passive:!1}:!1,i_e=function(e){return e.tagName==="TEXTAREA"},jq=function(e,t){if(!(e instanceof Element))return!1;var a=window.getComputedStyle(e);return a[t]!=="hidden"&&!(a.overflowY===a.overflowX&&!i_e(e)&&a[t]==="visible")},o_e=function(e){return jq(e,"overflowY")},a_e=function(e){return jq(e,"overflowX")},W5=function(e,t){var a=t.ownerDocument,l=t;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var d=zq(e,l);if(d){var _=Fq(e,l),v=_[1],i=_[2];if(v>i)return!0}l=l.parentNode}while(l&&l!==a.body);return!1},s_e=function(e){var t=e.scrollTop,a=e.scrollHeight,l=e.clientHeight;return[t,a,l]},l_e=function(e){var t=e.scrollLeft,a=e.scrollWidth,l=e.clientWidth;return[t,a,l]},zq=function(e,t){return e==="v"?o_e(t):a_e(t)},Fq=function(e,t){return e==="v"?s_e(t):l_e(t)},c_e=function(e,t){return e==="h"&&t==="rtl"?-1:1},u_e=function(e,t,a,l,d){var _=c_e(e,window.getComputedStyle(t).direction),v=_*l,i=a.target,P=t.contains(i),I=!1,M=v>0,R=0,F=0;do{if(!i)break;var q=Fq(e,i),H=q[0],j=q[1],$=q[2],Y=j-$-_*H;(H||Y)&&zq(e,i)&&(R+=Y,F+=H);var K=i.parentNode;i=K&&K.nodeType===Node.DOCUMENT_FRAGMENT_NODE?K.host:K}while(!P&&i!==document.body||P&&(t.contains(i)||t===i));return(M&&Math.abs(R)<1||!M&&Math.abs(F)<1)&&(I=!0),I},c0=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Z5=function(e){return[e.deltaX,e.deltaY]},X5=function(e){return e&&"current"in e?e.current:e},h_e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},d_e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},f_e=0,lp=[];function p_e(e){var t=ie.useRef([]),a=ie.useRef([0,0]),l=ie.useRef(),d=ie.useState(f_e++)[0],_=ie.useState(Lq)[0],v=ie.useRef(e);ie.useEffect(function(){v.current=e},[e]),ie.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(d));var j=Nge([e.lockRef.current],(e.shards||[]).map(X5),!0).filter(Boolean);return j.forEach(function($){return $.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),j.forEach(function($){return $.classList.remove("allow-interactivity-".concat(d))})}}},[e.inert,e.lockRef.current,e.shards]);var i=ie.useCallback(function(j,$){if("touches"in j&&j.touches.length===2||j.type==="wheel"&&j.ctrlKey)return!v.current.allowPinchZoom;var Y=c0(j),K=a.current,re="deltaX"in j?j.deltaX:K[0]-Y[0],se="deltaY"in j?j.deltaY:K[1]-Y[1],J,ae=j.target,de=Math.abs(re)>Math.abs(se)?"h":"v";if("touches"in j&&de==="h"&&ae.type==="range")return!1;var Pe=W5(de,ae);if(!Pe)return!0;if(Pe?J=de:(J=de==="v"?"h":"v",Pe=W5(de,ae)),!Pe)return!1;if(!l.current&&"changedTouches"in j&&(re||se)&&(l.current=J),!J)return!0;var Ne=l.current||J;return u_e(Ne,$,j,Ne==="h"?re:se)},[]),P=ie.useCallback(function(j){var $=j;if(!(!lp.length||lp[lp.length-1]!==_)){var Y="deltaY"in $?Z5($):c0($),K=t.current.filter(function(J){return J.name===$.type&&(J.target===$.target||$.target===J.shadowParent)&&h_e(J.delta,Y)})[0];if(K&&K.should){$.cancelable&&$.preventDefault();return}if(!K){var re=(v.current.shards||[]).map(X5).filter(Boolean).filter(function(J){return J.contains($.target)}),se=re.length>0?i($,re[0]):!v.current.noIsolation;se&&$.cancelable&&$.preventDefault()}}},[]),I=ie.useCallback(function(j,$,Y,K){var re={name:j,delta:$,target:Y,should:K,shadowParent:m_e(Y)};t.current.push(re),setTimeout(function(){t.current=t.current.filter(function(se){return se!==re})},1)},[]),M=ie.useCallback(function(j){a.current=c0(j),l.current=void 0},[]),R=ie.useCallback(function(j){I(j.type,Z5(j),j.target,i(j,e.lockRef.current))},[]),F=ie.useCallback(function(j){I(j.type,c0(j),j.target,i(j,e.lockRef.current))},[]);ie.useEffect(function(){return lp.push(_),e.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:F}),document.addEventListener("wheel",P,sp),document.addEventListener("touchmove",P,sp),document.addEventListener("touchstart",M,sp),function(){lp=lp.filter(function(j){return j!==_}),document.removeEventListener("wheel",P,sp),document.removeEventListener("touchmove",P,sp),document.removeEventListener("touchstart",M,sp)}},[]);var q=e.removeScrollBar,H=e.inert;return ie.createElement(ie.Fragment,null,H?ie.createElement(_,{styles:d_e(d)}):null,q?ie.createElement(n_e,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function m_e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const g_e=qge(Nq,p_e);var DO=ie.forwardRef(function(e,t){return ie.createElement(Aw,wl({},e,{ref:t,sideCar:g_e}))});DO.classNames=Aw.classNames;var WI=["Enter"," "],__e=["ArrowDown","PageUp","Home"],Bq=["ArrowUp","PageDown","End"],y_e=[...__e,...Bq],v_e={ltr:[...WI,"ArrowRight"],rtl:[...WI,"ArrowLeft"]},x_e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},qy="Menu",[Ey,b_e,w_e]=Cy(qy),[Sd,Uq]=Gs(qy,[w_e,im,Tw]),Ew=im(),Vq=Tw(),[S_e,Td]=Sd(qy),[T_e,Gy]=Sd(qy),$q=e=>{const{__scopeMenu:t,open:a=!1,children:l,dir:d,onOpenChange:_,modal:v=!0}=e,i=Ew(t),[P,I]=ie.useState(null),M=ie.useRef(!1),R=ga(_),F=Vy(d);return ie.useEffect(()=>{const q=()=>{M.current=!0,document.addEventListener("pointerdown",H,{capture:!0,once:!0}),document.addEventListener("pointermove",H,{capture:!0,once:!0})},H=()=>M.current=!1;return document.addEventListener("keydown",q,{capture:!0}),()=>{document.removeEventListener("keydown",q,{capture:!0}),document.removeEventListener("pointerdown",H,{capture:!0}),document.removeEventListener("pointermove",H,{capture:!0})}},[]),T.jsx(SC,{...i,children:T.jsx(S_e,{scope:t,open:a,onOpenChange:R,content:P,onContentChange:I,children:T.jsx(T_e,{scope:t,onClose:ie.useCallback(()=>R(!1),[R]),isUsingKeyboardRef:M,dir:F,modal:v,children:l})})})};$q.displayName=qy;var A_e="MenuAnchor",kO=ie.forwardRef((e,t)=>{const{__scopeMenu:a,...l}=e,d=Ew(a);return T.jsx(TC,{...d,...l,ref:t})});kO.displayName=A_e;var NO="MenuPortal",[E_e,qq]=Sd(NO,{forceMount:void 0}),Gq=e=>{const{__scopeMenu:t,forceMount:a,children:l,container:d}=e,_=Td(NO,t);return T.jsx(E_e,{scope:t,forceMount:a,children:T.jsx(Rc,{present:a||_.open,children:T.jsx(Rb,{asChild:!0,container:d,children:l})})})};Gq.displayName=NO;var ps="MenuContent",[P_e,LO]=Sd(ps),Hq=ie.forwardRef((e,t)=>{const a=qq(ps,e.__scopeMenu),{forceMount:l=a.forceMount,...d}=e,_=Td(ps,e.__scopeMenu),v=Gy(ps,e.__scopeMenu);return T.jsx(Ey.Provider,{scope:e.__scopeMenu,children:T.jsx(Rc,{present:l||_.open,children:T.jsx(Ey.Slot,{scope:e.__scopeMenu,children:v.modal?T.jsx(I_e,{...d,ref:t}):T.jsx(C_e,{...d,ref:t})})})})}),I_e=ie.forwardRef((e,t)=>{const a=Td(ps,e.__scopeMenu),l=ie.useRef(null),d=ui(t,l);return ie.useEffect(()=>{const _=l.current;if(_)return Rq(_)},[]),T.jsx(jO,{...e,ref:d,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:Pr(e.onFocusOutside,_=>_.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)})}),C_e=ie.forwardRef((e,t)=>{const a=Td(ps,e.__scopeMenu);return T.jsx(jO,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>a.onOpenChange(!1)})}),O_e=wp("MenuContent.ScrollLock"),jO=ie.forwardRef((e,t)=>{const{__scopeMenu:a,loop:l=!1,trapFocus:d,onOpenAutoFocus:_,onCloseAutoFocus:v,disableOutsidePointerEvents:i,onEntryFocus:P,onEscapeKeyDown:I,onPointerDownOutside:M,onFocusOutside:R,onInteractOutside:F,onDismiss:q,disableOutsideScroll:H,...j}=e,$=Td(ps,a),Y=Gy(ps,a),K=Ew(a),re=Vq(a),se=b_e(a),[J,ae]=ie.useState(null),de=ie.useRef(null),Pe=ui(t,de,$.onContentChange),Ne=ie.useRef(0),rt=ie.useRef(""),ke=ie.useRef(0),Ze=ie.useRef(null),nt=ie.useRef("right"),Je=ie.useRef(0),ot=H?DO:ie.Fragment,it=H?{as:O_e,allowPinchZoom:!0}:void 0,Pt=yt=>{const ar=rt.current+yt,qt=se().filter(nr=>!nr.disabled),rr=document.activeElement,Tr=qt.find(nr=>nr.ref.current===rr)?.textValue,an=qt.map(nr=>nr.textValue),An=V_e(an,ar,Tr),Fr=qt.find(nr=>nr.textValue===An)?.ref.current;(function nr(Dr){rt.current=Dr,window.clearTimeout(Ne.current),Dr!==""&&(Ne.current=window.setTimeout(()=>nr(""),1e3))})(ar),Fr&&setTimeout(()=>Fr.focus())};ie.useEffect(()=>()=>window.clearTimeout(Ne.current),[]),wq();const Ot=ie.useCallback(yt=>nt.current===Ze.current?.side&&q_e(yt,Ze.current?.area),[]);return T.jsx(P_e,{scope:a,searchRef:rt,onItemEnter:ie.useCallback(yt=>{Ot(yt)&&yt.preventDefault()},[Ot]),onItemLeave:ie.useCallback(yt=>{Ot(yt)||(de.current?.focus(),ae(null))},[Ot]),onTriggerLeave:ie.useCallback(yt=>{Ot(yt)&&yt.preventDefault()},[Ot]),pointerGraceTimerRef:ke,onPointerGraceIntentChange:ie.useCallback(yt=>{Ze.current=yt},[]),children:T.jsx(ot,{...it,children:T.jsx(RO,{asChild:!0,trapped:d,onMountAutoFocus:Pr(_,yt=>{yt.preventDefault(),de.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:v,children:T.jsx(Oy,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:I,onPointerDownOutside:M,onFocusOutside:R,onInteractOutside:F,onDismiss:q,children:T.jsx(Cq,{asChild:!0,...re,dir:Y.dir,orientation:"vertical",loop:l,currentTabStopId:J,onCurrentTabStopIdChange:ae,onEntryFocus:Pr(P,yt=>{Y.isUsingKeyboardRef.current||yt.preventDefault()}),preventScrollOnEntryFocus:!0,children:T.jsx(AC,{role:"menu","aria-orientation":"vertical","data-state":lG($.open),"data-radix-menu-content":"",dir:Y.dir,...K,...j,ref:Pe,style:{outline:"none",...j.style},onKeyDown:Pr(j.onKeyDown,yt=>{const qt=yt.target.closest("[data-radix-menu-content]")===yt.currentTarget,rr=yt.ctrlKey||yt.altKey||yt.metaKey,Tr=yt.key.length===1;qt&&(yt.key==="Tab"&&yt.preventDefault(),!rr&&Tr&&Pt(yt.key));const an=de.current;if(yt.target!==an||!y_e.includes(yt.key))return;yt.preventDefault();const Fr=se().filter(nr=>!nr.disabled).map(nr=>nr.ref.current);Bq.includes(yt.key)&&Fr.reverse(),B_e(Fr)}),onBlur:Pr(e.onBlur,yt=>{yt.currentTarget.contains(yt.target)||(window.clearTimeout(Ne.current),rt.current="")}),onPointerMove:Pr(e.onPointerMove,Py(yt=>{const ar=yt.target,qt=Je.current!==yt.clientX;if(yt.currentTarget.contains(ar)&&qt){const rr=yt.clientX>Je.current?"right":"left";nt.current=rr,Je.current=yt.clientX}}))})})})})})})});Hq.displayName=ps;var M_e="MenuGroup",zO=ie.forwardRef((e,t)=>{const{__scopeMenu:a,...l}=e;return T.jsx(yn.div,{role:"group",...l,ref:t})});zO.displayName=M_e;var R_e="MenuLabel",Wq=ie.forwardRef((e,t)=>{const{__scopeMenu:a,...l}=e;return T.jsx(yn.div,{...l,ref:t})});Wq.displayName=R_e;var Tb="MenuItem",K5="menu.itemSelect",Pw=ie.forwardRef((e,t)=>{const{disabled:a=!1,onSelect:l,...d}=e,_=ie.useRef(null),v=Gy(Tb,e.__scopeMenu),i=LO(Tb,e.__scopeMenu),P=ui(t,_),I=ie.useRef(!1),M=()=>{const R=_.current;if(!a&&R){const F=new CustomEvent(K5,{bubbles:!0,cancelable:!0});R.addEventListener(K5,q=>l?.(q),{once:!0}),cC(R,F),F.defaultPrevented?I.current=!1:v.onClose()}};return T.jsx(Zq,{...d,ref:P,disabled:a,onClick:Pr(e.onClick,M),onPointerDown:R=>{e.onPointerDown?.(R),I.current=!0},onPointerUp:Pr(e.onPointerUp,R=>{I.current||R.currentTarget?.click()}),onKeyDown:Pr(e.onKeyDown,R=>{const F=i.searchRef.current!=="";a||F&&R.key===" "||WI.includes(R.key)&&(R.currentTarget.click(),R.preventDefault())})})});Pw.displayName=Tb;var Zq=ie.forwardRef((e,t)=>{const{__scopeMenu:a,disabled:l=!1,textValue:d,..._}=e,v=LO(Tb,a),i=Vq(a),P=ie.useRef(null),I=ui(t,P),[M,R]=ie.useState(!1),[F,q]=ie.useState("");return ie.useEffect(()=>{const H=P.current;H&&q((H.textContent??"").trim())},[_.children]),T.jsx(Ey.ItemSlot,{scope:a,disabled:l,textValue:d??F,children:T.jsx(Oq,{asChild:!0,...i,focusable:!l,children:T.jsx(yn.div,{role:"menuitem","data-highlighted":M?"":void 0,"aria-disabled":l||void 0,"data-disabled":l?"":void 0,..._,ref:I,onPointerMove:Pr(e.onPointerMove,Py(H=>{l?v.onItemLeave(H):(v.onItemEnter(H),H.defaultPrevented||H.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Pr(e.onPointerLeave,Py(H=>v.onItemLeave(H))),onFocus:Pr(e.onFocus,()=>R(!0)),onBlur:Pr(e.onBlur,()=>R(!1))})})})}),D_e="MenuCheckboxItem",Xq=ie.forwardRef((e,t)=>{const{checked:a=!1,onCheckedChange:l,...d}=e;return T.jsx(eG,{scope:e.__scopeMenu,checked:a,children:T.jsx(Pw,{role:"menuitemcheckbox","aria-checked":Ab(a)?"mixed":a,...d,ref:t,"data-state":BO(a),onSelect:Pr(d.onSelect,()=>l?.(Ab(a)?!0:!a),{checkForDefaultPrevented:!1})})})});Xq.displayName=D_e;var Kq="MenuRadioGroup",[k_e,N_e]=Sd(Kq,{value:void 0,onValueChange:()=>{}}),Yq=ie.forwardRef((e,t)=>{const{value:a,onValueChange:l,...d}=e,_=ga(l);return T.jsx(k_e,{scope:e.__scopeMenu,value:a,onValueChange:_,children:T.jsx(zO,{...d,ref:t})})});Yq.displayName=Kq;var Jq="MenuRadioItem",Qq=ie.forwardRef((e,t)=>{const{value:a,...l}=e,d=N_e(Jq,e.__scopeMenu),_=a===d.value;return T.jsx(eG,{scope:e.__scopeMenu,checked:_,children:T.jsx(Pw,{role:"menuitemradio","aria-checked":_,...l,ref:t,"data-state":BO(_),onSelect:Pr(l.onSelect,()=>d.onValueChange?.(a),{checkForDefaultPrevented:!1})})})});Qq.displayName=Jq;var FO="MenuItemIndicator",[eG,L_e]=Sd(FO,{checked:!1}),tG=ie.forwardRef((e,t)=>{const{__scopeMenu:a,forceMount:l,...d}=e,_=L_e(FO,a);return T.jsx(Rc,{present:l||Ab(_.checked)||_.checked===!0,children:T.jsx(yn.span,{...d,ref:t,"data-state":BO(_.checked)})})});tG.displayName=FO;var j_e="MenuSeparator",rG=ie.forwardRef((e,t)=>{const{__scopeMenu:a,...l}=e;return T.jsx(yn.div,{role:"separator","aria-orientation":"horizontal",...l,ref:t})});rG.displayName=j_e;var z_e="MenuArrow",nG=ie.forwardRef((e,t)=>{const{__scopeMenu:a,...l}=e,d=Ew(a);return T.jsx(EC,{...d,...l,ref:t})});nG.displayName=z_e;var F_e="MenuSub",[mxe,iG]=Sd(F_e),E_="MenuSubTrigger",oG=ie.forwardRef((e,t)=>{const a=Td(E_,e.__scopeMenu),l=Gy(E_,e.__scopeMenu),d=iG(E_,e.__scopeMenu),_=LO(E_,e.__scopeMenu),v=ie.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:P}=_,I={__scopeMenu:e.__scopeMenu},M=ie.useCallback(()=>{v.current&&window.clearTimeout(v.current),v.current=null},[]);return ie.useEffect(()=>M,[M]),ie.useEffect(()=>{const R=i.current;return()=>{window.clearTimeout(R),P(null)}},[i,P]),T.jsx(kO,{asChild:!0,...I,children:T.jsx(Zq,{id:d.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":d.contentId,"data-state":lG(a.open),...e,ref:Mb(t,d.onTriggerChange),onClick:R=>{e.onClick?.(R),!(e.disabled||R.defaultPrevented)&&(R.currentTarget.focus(),a.open||a.onOpenChange(!0))},onPointerMove:Pr(e.onPointerMove,Py(R=>{_.onItemEnter(R),!R.defaultPrevented&&!e.disabled&&!a.open&&!v.current&&(_.onPointerGraceIntentChange(null),v.current=window.setTimeout(()=>{a.onOpenChange(!0),M()},100))})),onPointerLeave:Pr(e.onPointerLeave,Py(R=>{M();const F=a.content?.getBoundingClientRect();if(F){const q=a.content?.dataset.side,H=q==="right",j=H?-5:5,$=F[H?"left":"right"],Y=F[H?"right":"left"];_.onPointerGraceIntentChange({area:[{x:R.clientX+j,y:R.clientY},{x:$,y:F.top},{x:Y,y:F.top},{x:Y,y:F.bottom},{x:$,y:F.bottom}],side:q}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>_.onPointerGraceIntentChange(null),300)}else{if(_.onTriggerLeave(R),R.defaultPrevented)return;_.onPointerGraceIntentChange(null)}})),onKeyDown:Pr(e.onKeyDown,R=>{const F=_.searchRef.current!=="";e.disabled||F&&R.key===" "||v_e[l.dir].includes(R.key)&&(a.onOpenChange(!0),a.content?.focus(),R.preventDefault())})})})});oG.displayName=E_;var aG="MenuSubContent",sG=ie.forwardRef((e,t)=>{const a=qq(ps,e.__scopeMenu),{forceMount:l=a.forceMount,...d}=e,_=Td(ps,e.__scopeMenu),v=Gy(ps,e.__scopeMenu),i=iG(aG,e.__scopeMenu),P=ie.useRef(null),I=ui(t,P);return T.jsx(Ey.Provider,{scope:e.__scopeMenu,children:T.jsx(Rc,{present:l||_.open,children:T.jsx(Ey.Slot,{scope:e.__scopeMenu,children:T.jsx(jO,{id:i.contentId,"aria-labelledby":i.triggerId,...d,ref:I,align:"start",side:v.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:M=>{v.isUsingKeyboardRef.current&&P.current?.focus(),M.preventDefault()},onCloseAutoFocus:M=>M.preventDefault(),onFocusOutside:Pr(e.onFocusOutside,M=>{M.target!==i.trigger&&_.onOpenChange(!1)}),onEscapeKeyDown:Pr(e.onEscapeKeyDown,M=>{v.onClose(),M.preventDefault()}),onKeyDown:Pr(e.onKeyDown,M=>{const R=M.currentTarget.contains(M.target),F=x_e[v.dir].includes(M.key);R&&F&&(_.onOpenChange(!1),i.trigger?.focus(),M.preventDefault())})})})})})});sG.displayName=aG;function lG(e){return e?"open":"closed"}function Ab(e){return e==="indeterminate"}function BO(e){return Ab(e)?"indeterminate":e?"checked":"unchecked"}function B_e(e){const t=document.activeElement;for(const a of e)if(a===t||(a.focus(),document.activeElement!==t))return}function U_e(e,t){return e.map((a,l)=>e[(t+l)%e.length])}function V_e(e,t,a){const d=t.length>1&&Array.from(t).every(I=>I===t[0])?t[0]:t,_=a?e.indexOf(a):-1;let v=U_e(e,Math.max(_,0));d.length===1&&(v=v.filter(I=>I!==a));const P=v.find(I=>I.toLowerCase().startsWith(d.toLowerCase()));return P!==a?P:void 0}function $_e(e,t){const{x:a,y:l}=e;let d=!1;for(let _=0,v=t.length-1;_<t.length;v=_++){const i=t[_],P=t[v],I=i.x,M=i.y,R=P.x,F=P.y;M>l!=F>l&&a<(R-I)*(l-M)/(F-M)+I&&(d=!d)}return d}function q_e(e,t){if(!t)return!1;const a={x:e.clientX,y:e.clientY};return $_e(a,t)}function Py(e){return t=>t.pointerType==="mouse"?e(t):void 0}var G_e=$q,H_e=kO,W_e=Gq,Z_e=Hq,X_e=zO,K_e=Wq,Y_e=Pw,J_e=Xq,Q_e=Yq,eye=Qq,tye=tG,rye=rG,nye=nG,iye=oG,oye=sG,Iw="DropdownMenu",[aye]=Gs(Iw,[Uq]),ha=Uq(),[sye,cG]=aye(Iw),uG=e=>{const{__scopeDropdownMenu:t,children:a,dir:l,open:d,defaultOpen:_,onOpenChange:v,modal:i=!0}=e,P=ha(t),I=ie.useRef(null),[M,R]=Il({prop:d,defaultProp:_??!1,onChange:v,caller:Iw});return T.jsx(sye,{scope:t,triggerId:Cl(),triggerRef:I,contentId:Cl(),open:M,onOpenChange:R,onOpenToggle:ie.useCallback(()=>R(F=>!F),[R]),modal:i,children:T.jsx(G_e,{...P,open:M,onOpenChange:R,dir:l,modal:i,children:a})})};uG.displayName=Iw;var hG="DropdownMenuTrigger",dG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,disabled:l=!1,...d}=e,_=cG(hG,a),v=ha(a);return T.jsx(H_e,{asChild:!0,...v,children:T.jsx(yn.button,{type:"button",id:_.triggerId,"aria-haspopup":"menu","aria-expanded":_.open,"aria-controls":_.open?_.contentId:void 0,"data-state":_.open?"open":"closed","data-disabled":l?"":void 0,disabled:l,...d,ref:Mb(t,_.triggerRef),onPointerDown:Pr(e.onPointerDown,i=>{!l&&i.button===0&&i.ctrlKey===!1&&(_.onOpenToggle(),_.open||i.preventDefault())}),onKeyDown:Pr(e.onKeyDown,i=>{l||(["Enter"," "].includes(i.key)&&_.onOpenToggle(),i.key==="ArrowDown"&&_.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});dG.displayName=hG;var lye="DropdownMenuPortal",fG=e=>{const{__scopeDropdownMenu:t,...a}=e,l=ha(t);return T.jsx(W_e,{...l,...a})};fG.displayName=lye;var pG="DropdownMenuContent",mG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=cG(pG,a),_=ha(a),v=ie.useRef(!1);return T.jsx(Z_e,{id:d.contentId,"aria-labelledby":d.triggerId,..._,...l,ref:t,onCloseAutoFocus:Pr(e.onCloseAutoFocus,i=>{v.current||d.triggerRef.current?.focus(),v.current=!1,i.preventDefault()}),onInteractOutside:Pr(e.onInteractOutside,i=>{const P=i.detail.originalEvent,I=P.button===0&&P.ctrlKey===!0,M=P.button===2||I;(!d.modal||M)&&(v.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mG.displayName=pG;var cye="DropdownMenuGroup",uye=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(X_e,{...d,...l,ref:t})});uye.displayName=cye;var hye="DropdownMenuLabel",gG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(K_e,{...d,...l,ref:t})});gG.displayName=hye;var dye="DropdownMenuItem",_G=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(Y_e,{...d,...l,ref:t})});_G.displayName=dye;var fye="DropdownMenuCheckboxItem",yG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(J_e,{...d,...l,ref:t})});yG.displayName=fye;var pye="DropdownMenuRadioGroup",mye=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(Q_e,{...d,...l,ref:t})});mye.displayName=pye;var gye="DropdownMenuRadioItem",vG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(eye,{...d,...l,ref:t})});vG.displayName=gye;var _ye="DropdownMenuItemIndicator",xG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(tye,{...d,...l,ref:t})});xG.displayName=_ye;var yye="DropdownMenuSeparator",bG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(rye,{...d,...l,ref:t})});bG.displayName=yye;var vye="DropdownMenuArrow",xye=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(nye,{...d,...l,ref:t})});xye.displayName=vye;var bye="DropdownMenuSubTrigger",wG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(iye,{...d,...l,ref:t})});wG.displayName=bye;var wye="DropdownMenuSubContent",SG=ie.forwardRef((e,t)=>{const{__scopeDropdownMenu:a,...l}=e,d=ha(a);return T.jsx(oye,{...d,...l,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});SG.displayName=wye;var Sye=uG,Tye=dG,Aye=fG,TG=mG,AG=gG,EG=_G,PG=yG,IG=vG,CG=xG,OG=bG,MG=wG,RG=SG;const DG=Sye,kG=Tye,Eye=ie.forwardRef(({className:e,inset:t,children:a,...l},d)=>T.jsxs(MG,{ref:d,className:Nn("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...l,children:[a,T.jsx(f4,{className:"ml-auto"})]}));Eye.displayName=MG.displayName;const Pye=ie.forwardRef(({className:e,...t},a)=>T.jsx(RG,{ref:a,className:Nn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...t}));Pye.displayName=RG.displayName;const UO=ie.forwardRef(({className:e,sideOffset:t=4,...a},l)=>T.jsx(Aye,{children:T.jsx(TG,{ref:l,sideOffset:t,className:Nn("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...a})}));UO.displayName=TG.displayName;const Iye=ie.forwardRef(({className:e,inset:t,...a},l)=>T.jsx(EG,{ref:l,className:Nn("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...a}));Iye.displayName=EG.displayName;const bc=ie.forwardRef(({className:e,children:t,checked:a,...l},d)=>T.jsxs(PG,{ref:d,className:Nn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...l,children:[T.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:T.jsx(CG,{children:T.jsx(p4,{className:"h-4 w-4"})})}),t]}));bc.displayName=PG.displayName;const Cye=ie.forwardRef(({className:e,children:t,...a},l)=>T.jsxs(IG,{ref:l,className:Nn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[T.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:T.jsx(CG,{children:T.jsx(N7,{className:"h-2 w-2 fill-current"})})}),t]}));Cye.displayName=IG.displayName;const VO=ie.forwardRef(({className:e,inset:t,...a},l)=>T.jsx(AG,{ref:l,className:Nn("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a}));VO.displayName=AG.displayName;const $O=ie.forwardRef(({className:e,...t},a)=>T.jsx(OG,{ref:a,className:Nn("-mx-1 my-1 h-px bg-muted",e),...t}));$O.displayName=OG.displayName;var y0={exports:{}},Oye=y0.exports,Y5;function Mye(){return Y5||(Y5=1,(function(e,t){(function(a,l){e.exports=l()})(Oye,(function(){var a,l,d;function _(i,P){if(!a)a=P;else if(!l)l=P;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",M={};a(M),d=P(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}_(["exports"],(function(i){var P=1e-6,I=typeof Float32Array<"u"?Float32Array:Array;function M(s,r){var o=r[0],u=r[1],h=r[2],m=r[3],g=o*m-h*u;return g?(s[0]=m*(g=1/g),s[1]=-u*g,s[2]=-h*g,s[3]=o*g,s):null}function R(){var s=new I(9);return I!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function F(s,r){var o=r[0],u=r[1],h=r[2],m=r[3],g=r[4],b=r[5],S=r[6],E=r[7],O=r[8];return s[0]=g*O-b*E,s[1]=h*E-u*O,s[2]=u*b-h*g,s[3]=b*S-m*O,s[4]=o*O-h*S,s[5]=h*m-o*b,s[6]=m*E-g*S,s[7]=u*S-o*E,s[8]=o*g-u*m,s}function q(s,r,o){var u=r[0],h=r[1],m=r[2],g=r[3],b=r[4],S=r[5],E=r[6],O=r[7],D=r[8],N=o[0],B=o[1],U=o[2],X=o[3],Q=o[4],ee=o[5],ue=o[6],he=o[7],pe=o[8];return s[0]=N*u+B*g+U*E,s[1]=N*h+B*b+U*O,s[2]=N*m+B*S+U*D,s[3]=X*u+Q*g+ee*E,s[4]=X*h+Q*b+ee*O,s[5]=X*m+Q*S+ee*D,s[6]=ue*u+he*g+pe*E,s[7]=ue*h+he*b+pe*O,s[8]=ue*m+he*S+pe*D,s}function H(){var s=new I(16);return I!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function j(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function $(s,r){var o=r[0],u=r[1],h=r[2],m=r[3],g=r[4],b=r[5],S=r[6],E=r[7],O=r[8],D=r[9],N=r[10],B=r[11],U=r[12],X=r[13],Q=r[14],ee=r[15],ue=o*b-u*g,he=o*S-h*g,pe=o*E-m*g,Ae=u*S-h*b,Ee=u*E-m*b,Oe=h*E-m*S,De=O*X-D*U,Le=O*Q-N*U,ct=O*ee-B*U,Ue=D*Q-N*X,ut=D*ee-B*X,_t=N*ee-B*Q,ht=ue*_t-he*ut+pe*Ue+Ae*ct-Ee*Le+Oe*De;return ht?(s[0]=(b*_t-S*ut+E*Ue)*(ht=1/ht),s[1]=(h*ut-u*_t-m*Ue)*ht,s[2]=(X*Oe-Q*Ee+ee*Ae)*ht,s[3]=(N*Ee-D*Oe-B*Ae)*ht,s[4]=(S*ct-g*_t-E*Le)*ht,s[5]=(o*_t-h*ct+m*Le)*ht,s[6]=(Q*pe-U*Oe-ee*he)*ht,s[7]=(O*Oe-N*pe+B*he)*ht,s[8]=(g*ut-b*ct+E*De)*ht,s[9]=(u*ct-o*ut-m*De)*ht,s[10]=(U*Ee-X*pe+ee*ue)*ht,s[11]=(D*pe-O*Ee-B*ue)*ht,s[12]=(b*Le-g*Ue-S*De)*ht,s[13]=(o*Ue-u*Le+h*De)*ht,s[14]=(X*he-U*Ae-Q*ue)*ht,s[15]=(O*Ae-D*he+N*ue)*ht,s):null}function Y(s,r,o){var u=r[0],h=r[1],m=r[2],g=r[3],b=r[4],S=r[5],E=r[6],O=r[7],D=r[8],N=r[9],B=r[10],U=r[11],X=r[12],Q=r[13],ee=r[14],ue=r[15],he=o[0],pe=o[1],Ae=o[2],Ee=o[3];return s[0]=he*u+pe*b+Ae*D+Ee*X,s[1]=he*h+pe*S+Ae*N+Ee*Q,s[2]=he*m+pe*E+Ae*B+Ee*ee,s[3]=he*g+pe*O+Ae*U+Ee*ue,s[4]=(he=o[4])*u+(pe=o[5])*b+(Ae=o[6])*D+(Ee=o[7])*X,s[5]=he*h+pe*S+Ae*N+Ee*Q,s[6]=he*m+pe*E+Ae*B+Ee*ee,s[7]=he*g+pe*O+Ae*U+Ee*ue,s[8]=(he=o[8])*u+(pe=o[9])*b+(Ae=o[10])*D+(Ee=o[11])*X,s[9]=he*h+pe*S+Ae*N+Ee*Q,s[10]=he*m+pe*E+Ae*B+Ee*ee,s[11]=he*g+pe*O+Ae*U+Ee*ue,s[12]=(he=o[12])*u+(pe=o[13])*b+(Ae=o[14])*D+(Ee=o[15])*X,s[13]=he*h+pe*S+Ae*N+Ee*Q,s[14]=he*m+pe*E+Ae*B+Ee*ee,s[15]=he*g+pe*O+Ae*U+Ee*ue,s}function K(s,r,o){var u,h,m,g,b,S,E,O,D,N,B,U,X=o[0],Q=o[1],ee=o[2];return r===s?(s[12]=r[0]*X+r[4]*Q+r[8]*ee+r[12],s[13]=r[1]*X+r[5]*Q+r[9]*ee+r[13],s[14]=r[2]*X+r[6]*Q+r[10]*ee+r[14],s[15]=r[3]*X+r[7]*Q+r[11]*ee+r[15]):(h=r[1],m=r[2],g=r[3],b=r[4],S=r[5],E=r[6],O=r[7],D=r[8],N=r[9],B=r[10],U=r[11],s[0]=u=r[0],s[1]=h,s[2]=m,s[3]=g,s[4]=b,s[5]=S,s[6]=E,s[7]=O,s[8]=D,s[9]=N,s[10]=B,s[11]=U,s[12]=u*X+b*Q+D*ee+r[12],s[13]=h*X+S*Q+N*ee+r[13],s[14]=m*X+E*Q+B*ee+r[14],s[15]=g*X+O*Q+U*ee+r[15]),s}function re(s,r,o){var u=o[0],h=o[1],m=o[2];return s[0]=r[0]*u,s[1]=r[1]*u,s[2]=r[2]*u,s[3]=r[3]*u,s[4]=r[4]*h,s[5]=r[5]*h,s[6]=r[6]*h,s[7]=r[7]*h,s[8]=r[8]*m,s[9]=r[9]*m,s[10]=r[10]*m,s[11]=r[11]*m,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function se(s,r,o){var u=Math.sin(o),h=Math.cos(o),m=r[4],g=r[5],b=r[6],S=r[7],E=r[8],O=r[9],D=r[10],N=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=m*h+E*u,s[5]=g*h+O*u,s[6]=b*h+D*u,s[7]=S*h+N*u,s[8]=E*h-m*u,s[9]=O*h-g*u,s[10]=D*h-b*u,s[11]=N*h-S*u,s}function J(s,r,o){var u=Math.sin(o),h=Math.cos(o),m=r[0],g=r[1],b=r[2],S=r[3],E=r[8],O=r[9],D=r[10],N=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*h-E*u,s[1]=g*h-O*u,s[2]=b*h-D*u,s[3]=S*h-N*u,s[8]=m*u+E*h,s[9]=g*u+O*h,s[10]=b*u+D*h,s[11]=S*u+N*h,s}function ae(s,r,o){var u=Math.sin(o),h=Math.cos(o),m=r[0],g=r[1],b=r[2],S=r[3],E=r[4],O=r[5],D=r[6],N=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*h+E*u,s[1]=g*h+O*u,s[2]=b*h+D*u,s[3]=S*h+N*u,s[4]=E*h-m*u,s[5]=O*h-g*u,s[6]=D*h-b*u,s[7]=N*h-S*u,s}function de(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Pe(s,r,o){var u,h,m,g=o[0],b=o[1],S=o[2],E=Math.sqrt(g*g+b*b+S*S);return E<P?null:(g*=E=1/E,b*=E,S*=E,u=Math.sin(r),h=Math.cos(r),s[0]=g*g*(m=1-h)+h,s[1]=b*g*m+S*u,s[2]=S*g*m-b*u,s[3]=0,s[4]=g*b*m-S*u,s[5]=b*b*m+h,s[6]=S*b*m+g*u,s[7]=0,s[8]=g*S*m+b*u,s[9]=b*S*m-g*u,s[10]=S*S*m+h,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function Ne(s,r){var o=r[0],u=r[1],h=r[2],m=r[3],g=o+o,b=u+u,S=h+h,E=o*g,O=u*g,D=u*b,N=h*g,B=h*b,U=h*S,X=m*g,Q=m*b,ee=m*S;return s[0]=1-D-U,s[1]=O+ee,s[2]=N-Q,s[3]=0,s[4]=O-ee,s[5]=1-E-U,s[6]=B+X,s[7]=0,s[8]=N+Q,s[9]=B-X,s[10]=1-E-D,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}var rt=Y;function ke(){var s=new I(3);return I!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Ze(s){var r=new I(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function nt(s){var r=s[0],o=s[1],u=s[2];return Math.sqrt(r*r+o*o+u*u)}function Je(s,r,o){var u=new I(3);return u[0]=s,u[1]=r,u[2]=o,u}function ot(s,r,o,u){return s[0]=r,s[1]=o,s[2]=u,s}function it(s,r,o){return s[0]=r[0]+o[0],s[1]=r[1]+o[1],s[2]=r[2]+o[2],s}function Pt(s,r,o){return s[0]=r[0]-o[0],s[1]=r[1]-o[1],s[2]=r[2]-o[2],s}function Ot(s,r,o){return s[0]=r[0]*o[0],s[1]=r[1]*o[1],s[2]=r[2]*o[2],s}function yt(s,r,o){return s[0]=Math.min(r[0],o[0]),s[1]=Math.min(r[1],o[1]),s[2]=Math.min(r[2],o[2]),s}function ar(s,r,o){return s[0]=Math.max(r[0],o[0]),s[1]=Math.max(r[1],o[1]),s[2]=Math.max(r[2],o[2]),s}function qt(s,r,o){return s[0]=r[0]*o,s[1]=r[1]*o,s[2]=r[2]*o,s}function rr(s,r,o,u){return s[0]=r[0]+o[0]*u,s[1]=r[1]+o[1]*u,s[2]=r[2]+o[2]*u,s}function Tr(s,r){var o=r[0]-s[0],u=r[1]-s[1],h=r[2]-s[2];return o*o+u*u+h*h}function an(s){var r=s[0],o=s[1],u=s[2];return r*r+o*o+u*u}function An(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s}function Fr(s,r){var o=r[0],u=r[1],h=r[2],m=o*o+u*u+h*h;return m>0&&(m=1/Math.sqrt(m)),s[0]=r[0]*m,s[1]=r[1]*m,s[2]=r[2]*m,s}function nr(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Dr(s,r,o){var u=r[0],h=r[1],m=r[2],g=o[0],b=o[1],S=o[2];return s[0]=h*S-m*b,s[1]=m*g-u*S,s[2]=u*b-h*g,s}function er(s,r,o,u){var h=r[0],m=r[1],g=r[2];return s[0]=h+u*(o[0]-h),s[1]=m+u*(o[1]-m),s[2]=g+u*(o[2]-g),s}function or(s,r,o){var u=r[0],h=r[1],m=r[2],g=o[3]*u+o[7]*h+o[11]*m+o[15];return s[0]=(o[0]*u+o[4]*h+o[8]*m+o[12])/(g=g||1),s[1]=(o[1]*u+o[5]*h+o[9]*m+o[13])/g,s[2]=(o[2]*u+o[6]*h+o[10]*m+o[14])/g,s}function br(s,r,o){var u=r[0],h=r[1],m=r[2];return s[0]=u*o[0]+h*o[3]+m*o[6],s[1]=u*o[1]+h*o[4]+m*o[7],s[2]=u*o[2]+h*o[5]+m*o[8],s}function jt(s,r,o){var u=o[0],h=o[1],m=o[2],g=o[3],b=r[0],S=r[1],E=r[2],O=h*E-m*S,D=m*b-u*E,N=u*S-h*b;return s[0]=b+g*(O+=O)+h*(N+=N)-m*(D+=D),s[1]=S+g*D+m*O-u*N,s[2]=E+g*N+u*D-h*O,s}function bn(s){return s[0]=0,s[1]=0,s[2]=0,s}function Hr(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]}var Zr=Pt,ni=Ot,hi=nt;function Lo(){var s=new I(4);return I!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),s}function ki(s,r,o){return s[0]=r[0]*o,s[1]=r[1]*o,s[2]=r[2]*o,s[3]=r[3]*o,s}function Go(s,r){var o=r[0],u=r[1],h=r[2],m=r[3],g=o*o+u*u+h*h+m*m;return g>0&&(g=1/Math.sqrt(g)),s[0]=o*g,s[1]=u*g,s[2]=h*g,s[3]=m*g,s}function Ni(s,r,o){var u=r[0],h=r[1],m=r[2],g=r[3];return s[0]=o[0]*u+o[4]*h+o[8]*m+o[12]*g,s[1]=o[1]*u+o[5]*h+o[9]*m+o[13]*g,s[2]=o[2]*u+o[6]*h+o[10]*m+o[14]*g,s[3]=o[3]*u+o[7]*h+o[11]*m+o[15]*g,s}function oo(){var s=new I(4);return I!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Ho(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function qa(s,r,o){o*=.5;var u=r[0],h=r[1],m=r[2],g=r[3],b=Math.sin(o),S=Math.cos(o);return s[0]=u*S+g*b,s[1]=h*S+m*b,s[2]=m*S-h*b,s[3]=g*S-u*b,s}function Ga(s,r,o){o*=.5;var u=r[0],h=r[1],m=r[2],g=r[3],b=Math.sin(o),S=Math.cos(o);return s[0]=u*S-m*b,s[1]=h*S+g*b,s[2]=m*S+u*b,s[3]=g*S-h*b,s}ke(),Lo();var Mo,Wo,Zu,_s=Go,Lc=(Mo=ke(),Wo=Je(1,0,0),Zu=Je(0,1,0),function(s,r,o){var u=nr(r,o);return u<-.999999?(Dr(Mo,Wo,r),hi(Mo)<1e-6&&Dr(Mo,Zu,r),Fr(Mo,Mo),(function(h,m,g){g*=.5;var b=Math.sin(g);h[0]=b*m[0],h[1]=b*m[1],h[2]=b*m[2],h[3]=Math.cos(g)})(s,Mo,Math.PI),s):u>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Dr(Mo,r,o),s[0]=Mo[0],s[1]=Mo[1],s[2]=Mo[2],s[3]=1+u,_s(s,s))});function Zi(){var s=new I(2);return I!=Float32Array&&(s[0]=0,s[1]=0),s}function ya(s,r){var o=new I(2);return o[0]=s,o[1]=r,o}function Xu(s,r,o){return s[0]=r,s[1]=o,s}function Zs(s,r,o){return s[0]=r[0]+o[0],s[1]=r[1]+o[1],s}function Ha(s,r,o){return s[0]=r[0]-o[0],s[1]=r[1]-o[1],s}function ys(s,r,o){return s[0]=r[0]*o,s[1]=r[1]*o,s}function jl(s){var r=s[0],o=s[1];return Math.sqrt(r*r+o*o)}function Zn(s,r){var o=r[0],u=r[1],h=o*o+u*u;return h>0&&(h=1/Math.sqrt(h)),s[0]=r[0]*h,s[1]=r[1]*h,s}function $i(s,r){return s[0]*r[0]+s[1]*r[1]}oo(),oo(),R();var Ku,zl,va=Ha;function Yu(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}Zi();var Ju=(function(){if(zl)return Ku;function s(r,o,u,h){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=u,this.p2y=h}return zl=1,Ku=s,s.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,h=0;h<8;h++){var m=this.sampleCurveX(u)-r;if(Math.abs(m)<o)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=m/g}var b=0,S=1;for(u=r,h=0;h<20&&(m=this.sampleCurveX(u),!(Math.abs(m-r)<o));h++)r>m?b=u:S=u,u=.5*(S-b)+b;return u},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},Ku})(),Ad=Yu(Ju);function wt(s,r){this.x=s,this.y=r}function vs(s,r){if(Array.isArray(s)){if(!Array.isArray(r)||s.length!==r.length)return!1;for(let o=0;o<s.length;o++)if(!vs(s[o],r[o]))return!1;return!0}if(typeof s=="object"&&s!==null&&r!==null){if(typeof r!="object"||Object.keys(s).length!==Object.keys(r).length)return!1;for(const o in s)if(!vs(s[o],r[o]))return!1;return!0}return s===r}wt.prototype={clone(){return new wt(this.x,this.y)},add(s){return this.clone()._add(s)},sub(s){return this.clone()._sub(s)},multByPoint(s){return this.clone()._multByPoint(s)},divByPoint(s){return this.clone()._divByPoint(s)},mult(s){return this.clone()._mult(s)},div(s){return this.clone()._div(s)},rotate(s){return this.clone()._rotate(s)},rotateAround(s,r){return this.clone()._rotateAround(s,r)},matMult(s){return this.clone()._matMult(s)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(s){return this.x===s.x&&this.y===s.y},dist(s){return Math.sqrt(this.distSqr(s))},distSqr(s){const r=s.x-this.x,o=s.y-this.y;return r*r+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith(s){return this.angleWithSep(s.x,s.y)},angleWithSep(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult(s){const r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add(s){return this.x+=s.x,this.y+=s.y,this},_sub(s){return this.x-=s.x,this.y-=s.y,this},_mult(s){return this.x*=s,this.y*=s,this},_div(s){return this.x/=s,this.y/=s,this},_multByPoint(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint(s){return this.x/=s.x,this.y/=s.y,this},_unit(){return this._div(this.mag()),this},_perp(){const s=this.y;return this.y=this.x,this.x=-s,this},_rotate(s){const r=Math.cos(s),o=Math.sin(s),u=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=u,this},_rotateAround(s,r){const o=Math.cos(s),u=Math.sin(s),h=r.y+u*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-u*(this.y-r.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:wt},wt.convert=function(s){if(s instanceof wt)return s;if(Array.isArray(s))return new wt(+s[0],+s[1]);if(s.x!==void 0&&s.y!==void 0)return new wt(+s.x,+s.y);throw new Error("Expected [x, y] or {x, y} point format")};const pm=Math.PI/180,jc=180/Math.PI;function Fe(s){return s*pm}function ne(s){return s*jc}const ce=[[0,0],[1,0],[1,1],[0,1]];function ye(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,o=r*s;return 4*(s<.5?o:3*(s-r)+o-.75)}function Me(s,r,o,u){const h=new Ad(s,r,o,u);return function(m){return h.solve(m)}}const Ce=Me(.25,.1,.25,1);function Ie(s,r,o){return Math.min(o,Math.max(r,s))}function Ye(s,r,o){return(o=Ie((o-s)/(r-s),0,1))*o*(3-2*o)}function ze(s,r,o){const u=o-r,h=((s-r)%u+u)%u+r;return h===r?o:h}function Qe(s,r,o){if(!s.length)return o(null,[]);let u=s.length;const h=new Array(s.length);let m=null;s.forEach(((g,b)=>{r(g,((S,E)=>{S&&(m=S),h[b]=E,--u==0&&o(m,h)}))}))}let It=1;function pt(){return It++}function tr(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log2(s)))}function pr(s,r){s.forEach((o=>{r[o]&&(r[o]=r[o].bind(r))}))}function yr(s,r,o){const u={};for(const h in s)u[h]=r.call(this,s[h],h,s);return u}function Ur(s,r,o){const u={};for(const h in s)r.call(this,s[h],h,s)&&(u[h]=s[h]);return u}function Br(s){return Array.isArray(s)?s.map(Br):typeof s=="object"&&s?yr(s,Br):s}function Gr(s,r){for(let o=0;o<s.length;o++)if(r.indexOf(s[o])>=0)return!0;return!1}const En={};function Vr(s){En[s]||(typeof console<"u"&&console.warn(s),En[s]=!0)}function ii(s,r,o){return(o.y-s.y)*(r.x-s.x)>(r.y-s.y)*(o.x-s.x)}function vi(s){let r=0;for(let o,u,h=0,m=s.length,g=m-1;h<m;g=h++)o=s[h],u=s[g],r+=(u.x-o.x)*(o.y+u.y);return r}function xi([s,r,o]){const u=Fe(r+90),h=Fe(o);return{x:s*Math.cos(u)*Math.sin(h),y:s*Math.sin(u)*Math.sin(h),z:s*Math.cos(h),azimuthal:r,polar:o}}function Tn(s){return(typeof self<"u"||s!==void 0)&&typeof WorkerGlobalScope<"u"&&(s!==void 0?s:self)instanceof WorkerGlobalScope}function sn(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,u,h,m)=>{const g=h||m;return r[u]=!g||g.toLowerCase(),""})),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r}let Jn=null;function Qn(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}function Ln(s,r,o,u){for(;r<o;){const h=r+o>>1;s[h]<u?r=h+1:o=h}return r}function Xi(s,r,o,u){for(;r<o;){const h=r+o>>1;s[h]<=u?r=h+1:o=h}return r}function yo(s){return s>0?1/(1.001-s):1+s}function Zo(s){return s>0?1-1/(1.001-s):-s}function xs(s,r,o){return(s-r.min)*(o.max-o.min)/(r.max-r.min)+o.min}const ao={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ao.API_URL)return null;try{const s=new URL(ao.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function zc(s){return ao.API_URL_REGEX.test(s)}function Hy(s){return ao.API_SPRITE_REGEX.test(s)}let Xs,Fc,Qu,eh,Ks,th;function mm(){return Xs==null&&(Xs=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xs}const Wa={now:()=>eh!==void 0?eh:performance.now(),setNow(s){eh=s},restoreNow(){eh=void 0},frame(s){const r=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:o,height:u}=s;Ks||(Ks=document.createElement("canvas"));const h=Ks.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>Ks.width||u>Ks.height)&&(Ks.width=o,Ks.height=u),h.clearRect(-r,-r,o+2*r,u+2*r),h.drawImage(s,0,0,o,u),h.getImageData(-r,-r,o+2*r,u+2*r)},resolveURL:s=>(Fc||(Fc=document.createElement("a")),Fc.href=s,Fc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Qu==null&&(Qu=window.matchMedia("(prefers-reduced-motion: reduce)")),Qu.matches)},hasCanvasFingerprintNoise(){if(th!==void 0)return th;if(!mm())return th=!1,!1;const s=new OffscreenCanvas(85,1),r=s.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<s.width;++h)r.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,r.fillRect(h,0,1,1);const u=r.getImageData(0,0,s.width,s.height);o=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&o++!==u.data[h])return th=!0,!0;return th=!1,!1}};function gm(s,r){const o=s.indexOf("?");if(o<0)return`${s}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(s.slice(o));for(const h in r)u.set(h,r[h]);return`${s.slice(0,o)}?${u.toString()}`}function Ed(s,r={persistentParams:[]}){const o=s.indexOf("?");if(o<0)return s;const u=new URLSearchParams,h=new URLSearchParams(s.slice(o));for(const g of r.persistentParams){const b=h.get(g);b&&u.set(g,b)}const m=u.toString();return`${s.slice(0,o)}${m.length>0?`?${m}`:""}`}const Xo="mapbox-tiles";let xa=500,bs=50;const ba=["language","worldview","jobid"];let vo,Fl;function _m(){try{return caches}catch{}}function rh(){const s=_m();s&&vo==null&&(vo=s.open(Xo))}let Ys=1/0;const nh={supported:!1,testSupport:function(s){!Ko&&Bc&&(ym?Uc(s):ih=s)}};let ih,Bc,Ko=!1,ym=!1;const Pd=typeof self<"u"?self:{};function Uc(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Bc),s.isContextLost())return;nh.supported=!0}catch{}s.deleteTexture(r),Ko=!0}Pd.document&&(Bc=Pd.document.createElement("img"),Bc.onload=function(){ih&&Uc(ih),ih=null,ym=!0},Bc.onerror=function(){Ko=!0,ih=null},Bc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Id={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Id);class vm extends Error{constructor(r,o,u){o===401&&zc(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Cd=Tn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Xr=function(s,r){if(!(/^file:/.test(o=s.url)||/^file:/.test(Cd())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,h){const m=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Cd(),referrerPolicy:u.referrerPolicy,signal:m.signal});let b=!1,S=!1;const E=(O=g.url).indexOf("sku=")>0&&zc(O);var O;u.type==="json"&&g.headers.set("Accept","application/json");const D=(B,U,X)=>{if(S)return;if(B&&B.message!=="SecurityError"&&Vr(B.toString()),U&&X)return N(U);const Q=Date.now();fetch(g).then((ee=>{if(ee.ok){const ue=E?ee.clone():null;return N(ee,ue,Q)}return h(new vm(ee.statusText,ee.status,u.url))})).catch((ee=>{ee.name!=="AbortError"&&h(new Error(`${ee.message} ${u.url}`))}))},N=(B,U,X)=>{(u.type==="arrayBuffer"?B.arrayBuffer():u.type==="json"?B.json():B.text()).then((Q=>{S||(U&&X&&(function(ee,ue,he){if(rh(),vo==null)return;const pe=sn(ue.headers.get("Cache-Control")||"");if(pe["no-store"])return;const Ae={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach(((De,Le)=>Ae.headers.set(Le,De))),pe["max-age"]&&Ae.headers.set("Expires",new Date(he+1e3*pe["max-age"]).toUTCString());const Ee=Ae.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-he<42e4)return;let Oe=Ed(ee.url,{persistentParams:ba});if(ue.status===206){const De=ee.headers.get("Range");if(!De)return;Ae.status=200,Oe=gm(Oe,{range:De})}(function(De,Le){if(Fl===void 0)try{new Response(new ReadableStream),Fl=!0}catch{Fl=!1}Fl?Le(De.body):De.blob().then(Le).catch((ct=>Vr(ct.message)))})(ue,(De=>{const Le=new Response((ct=ue.status)!==200&&ct!==404&&[101,103,204,205,304].includes(ct)?null:De,Ae);var ct;rh(),vo?.then((Ue=>Ue.put(Oe,Le))).catch((Ue=>Vr(Ue.message)))}))})(g,U,X),b=!0,h(null,Q,B.headers.get("Cache-Control"),B.headers.get("Expires")))})).catch((Q=>{S||h(new Error(Q.message))}))};return E?(function(B,U){if(rh(),vo==null)return U(null);vo.then((X=>{let Q=Ed(B.url,{persistentParams:ba});const ee=B.headers.get("Range");ee&&(Q=gm(Q,{range:ee})),X.match(Q).then((ue=>{const he=(function(pe){if(!pe)return!1;const Ae=new Date(pe.headers.get("Expires")||0),Ee=sn(pe.headers.get("Cache-Control")||"");return Number(Ae)>Date.now()&&!Ee["no-cache"]})(ue);X.delete(Q).catch(U),he&&X.put(Q,ue.clone()).catch(U),U(null,ue,he)})).catch(U)})).catch(U)})(g,D):D(null,null),{cancel:()=>{S=!0,b||m.abort()}}})(s,r);if(Tn(self)&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var o;return(function(u,h){const m=new XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const g in u.headers)m.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(u.type==="json")try{g=JSON.parse(m.response)}catch(b){return h(b)}h(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new vm(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}})(s,r)},Vc=function(s,r){return Xr(Object.assign(s,{type:"arrayBuffer"}),r)};function Wy(s){const r=document.createElement("a");return r.href=s,r.protocol===location.protocol&&r.host===location.host}const Zy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Od,Js;Od=[],Js=0;const $c=function(s,r){if(nh.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Js>=ao.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Od.push(m),m}Js++;let o=!1;const u=()=>{if(!o)for(o=!0,Js--;Od.length&&Js<ao.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Od.shift(),{requestParameters:g,callback:b,cancelled:S}=m;S||(m.cancel=$c(g,b).cancel)}},h=Vc(s,((m,g,b,S)=>{u(),m?r(m):g&&(self.createImageBitmap?(function(E,O){const D=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(D).then((N=>{O(null,N)})).catch((N=>{O(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(g,((E,O)=>r(E,O,b,S))):(function(E,O){const D=new Image;D.onload=()=>{O(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame((()=>{D.src=Zy}))},D.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Blob([new Uint8Array(E)],{type:"image/png"});D.src=E.byteLength?URL.createObjectURL(N):Zy})(g,((E,O)=>r(E,O,b,S))))}));return{cancel:()=>{h.cancel(),u()}}};var oh,Md,Xy,Bl={exports:{}},Ky={exports:{}},xm={exports:{}},qc=(function(){if(Xy)return Bl.exports;Xy=1;var s=(oh||(oh=1,Ky.exports=function(o,u){var h,m,g,b,S,E,O,D;for(m=o.length-(h=3&o.length),g=u,S=3432918353,E=461845907,D=0;D<m;)O=255&o.charCodeAt(D)|(255&o.charCodeAt(++D))<<8|(255&o.charCodeAt(++D))<<16|(255&o.charCodeAt(++D))<<24,++D,g=27492+(65535&(b=5*(65535&(g=(g^=O=(65535&(O=(O=(65535&O)*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*E+(((O>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(O=0,h){case 3:O^=(255&o.charCodeAt(D+2))<<16;case 2:O^=(255&o.charCodeAt(D+1))<<8;case 1:g^=O=(65535&(O=(O=(65535&(O^=255&o.charCodeAt(D)))*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*E+(((O>>>16)*E&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Ky.exports),r=(Md||(Md=1,xm.exports=function(o,u){for(var h,m=o.length,g=u^m,b=0;m>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(b)|(255&o.charCodeAt(++b))<<8|(255&o.charCodeAt(++b))<<16|(255&o.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++b;switch(m){case 3:g^=(255&o.charCodeAt(b+2))<<16;case 2:g^=(255&o.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),xm.exports);return Bl.exports=s,Bl.exports.murmur3=s,Bl.exports.murmur2=r,Bl.exports})(),Rd=Yu(qc);class wa{constructor(r,...o){Object.assign(this,o[0]||{}),this.type=r}}class ah extends wa{constructor(r,o={}){super("error",Object.assign({error:r},o))}}function Dd(s,r,o){o[s]&&o[s].indexOf(r)!==-1||(o[s]=o[s]||[],o[s].push(r))}function Yo(s,r,o){if(o&&o[s]){const u=o[s].indexOf(r);u!==-1&&o[s].splice(u,1)}}class Ul{on(r,o){return this._listeners=this._listeners||{},Dd(r,o,this._listeners),this}off(r,o){return Yo(r,o,this._listeners),Yo(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Dd(r,o,this._oneTimeListeners),this):new Promise((u=>{this.once(r,u)}))}fire(r,o){const u=typeof r=="string"?new wa(r,o):r,h=u.type;if(this.listens(h)){u.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const S of m)S.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const S of g)Yo(h,S,this._oneTimeListeners),S.call(this,u);const b=this._eventedParent;if(b){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,S),b.fire(u)}}else u instanceof ah&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}class Jo{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new Jo(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[o,u]=r.split("");return new Jo({name:o,iconsetId:u})}static isEqual(r,o){return r.name===o.name&&r.iconsetId===o.iconsetId}toString(){return Jo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var bm,kd={},wm=(function(){if(bm)return kd;bm=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(m){return(m=Math.round(m))<0?0:m>255?255:m}function o(m){return r(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function h(m,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?m+(g-m)*b*6:2*b<1?g:3*b<2?m+(g-m)*(2/3-b)*6:m}try{kd.parseCSSColor=function(m){var g,b=m.replace(/ /g,"").toLowerCase();if(b in s)return s[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var S=b.indexOf("("),E=b.indexOf(")");if(S!==-1&&E+1===b.length){var O=b.substr(0,S),D=b.substr(S+1,E-(S+1)).split(","),N=1;switch(O){case"rgba":if(D.length!==4)return null;N=u(D.pop());case"rgb":return D.length!==3?null:[o(D[0]),o(D[1]),o(D[2]),N];case"hsla":if(D.length!==4)return null;N=u(D.pop());case"hsl":if(D.length!==3)return null;var B=(parseFloat(D[0])%360+360)%360/360,U=u(D[1]),X=u(D[2]),Q=X<=.5?X*(U+1):X+U-X*U,ee=2*X-Q;return[r(255*h(ee,Q,B+1/3)),r(255*h(ee,Q,B)),r(255*h(ee,Q,B-1/3)),N];default:return null}}return null}}catch{}return kd})();class cn{constructor(r,o,u,h=1){this.r=r,this.g=o,this.b=u,this.a=h}static parse(r){if(!r)return;if(r instanceof cn)return r;if(typeof r!="string")return;const o=wm.parseCSSColor(r);return o?new cn(o[0]/255,o[1]/255,o[2]/255,o[3]):void 0}toString(){const[r,o,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*o)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(r){const{r:o,g:u,b:h,a:m}=this;return new Yy(r,o,u,h,m)}toPremultipliedRenderColor(r){const{r:o,g:u,b:h,a:m}=this;return new Nd(r,o*m,u*m,h*m,m)}clone(){return new cn(this.r,this.g,this.b,this.a)}}class Sm{constructor(r,o,u,h,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,r){const b=r.image.height,S=b*b;this.premultiplied?(o=m===0?0:o/m*(b-1),u=m===0?0:u/m*(b-1),h=m===0?0:h/m*(b-1)):(o*=b-1,u*=b-1,h*=b-1);const E=Math.floor(o),O=Math.floor(u),D=Math.floor(h),N=Math.ceil(o),B=Math.ceil(u),U=Math.ceil(h),X=o-E,Q=u-O,ee=h-D,ue=r.image.data,he=4*(E+O*S+D*b),pe=4*(E+O*S+U*b),Ae=4*(E+B*S+D*b),Ee=4*(E+B*S+U*b),Oe=4*(N+O*S+D*b),De=4*(N+O*S+U*b),Le=4*(N+B*S+D*b),ct=4*(N+B*S+U*b);if(he<0||ct>=ue.length)throw new Error("out of range");this.r=lr(lr(lr(ue[he],ue[pe],ee),lr(ue[Ae],ue[Ee],ee),Q),lr(lr(ue[Oe],ue[De],ee),lr(ue[Le],ue[ct],ee),Q),X)/255*(this.premultiplied?m:1),this.g=lr(lr(lr(ue[he+1],ue[pe+1],ee),lr(ue[Ae+1],ue[Ee+1],ee),Q),lr(lr(ue[Oe+1],ue[De+1],ee),lr(ue[Le+1],ue[ct+1],ee),Q),X)/255*(this.premultiplied?m:1),this.b=lr(lr(lr(ue[he+2],ue[pe+2],ee),lr(ue[Ae+2],ue[Ee+2],ee),Q),lr(lr(ue[Oe+2],ue[De+2],ee),lr(ue[Le+2],ue[ct+2],ee),Q),X)/255*(this.premultiplied?m:1),this.a=m}else this.r=o,this.g=u,this.b=h,this.a=m}toArray(){const{r,g:o,b:u,a:h}=this;return[255*r,255*o,255*u,h]}toHslaArray(){let{r,g:o,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const U=1/h;r*=U,o*=U,u*=U}const m=Math.min(Math.max(r,0),1),g=Math.min(Math.max(o,0),1),b=Math.min(Math.max(u,0),1),S=Math.min(m,g,b),E=Math.max(m,g,b),O=E-S,D=.5*(S+E);if(O===0)return[0,0,100*D,h];const N=D>.5?O/(2-E-S):O/(E+S);let B;switch(E){case m:B=60*((g-b)/O+(g<b?6:0));break;case g:B=60*((b-m)/O+2);break;default:B=60*((m-g)/O+4)}return[B,100*N,100*D,h]}toArray01(){const{r,g:o,b:u,a:h}=this;return[r,o,u,h]}toArray01Scaled(r){const{r:o,g:u,b:h}=this;return[o*r,u*r,h*r]}toArray01Linear(){const{r,g:o,b:u,a:h}=this;return[Math.pow(r,2.2),Math.pow(o,2.2),Math.pow(u,2.2),h]}}class Yy extends Sm{constructor(r,o,u,h,m){super(r,o,u,h,m,!1)}}class Nd extends Sm{constructor(r,o,u,h,m){super(r,o,u,h,m,!0)}}function lr(s,r,o){return s*(1-o)+r*o}function Tm(s,r,o){return s.map(((u,h)=>lr(u,r[h],o)))}cn.black=new cn(0,0,0,1),cn.white=new cn(1,1,1,1),cn.transparent=new cn(0,0,0,0),cn.red=new cn(1,0,0,1),cn.blue=new cn(0,0,1,1);var Qo=Object.freeze({__proto__:null,array:Tm,color:function(s,r,o){return new cn(lr(s.r,r.r,o),lr(s.g,r.g,o),lr(s.b,r.b,o),lr(s.a,r.a,o))},number:lr});class Sa extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}class Ld{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[u,h]of o)this.bindings[u]=h}concat(r){return new Ld(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Za={kind:"null"},Jt={kind:"number"},un={kind:"string"},mn={kind:"boolean"},jo={kind:"color"},Vl={kind:"object"},nn={kind:"value"},jd={kind:"collator"},Qs={kind:"formatted"},sh={kind:"resolvedImage"};function so(s,r){return{kind:"array",itemType:s,N:r}}function bi(s){if(s.kind==="array"){const r=bi(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const Lw=[Za,Jt,un,mn,jo,Qs,Vl,so(nn),sh];function lh(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!lh(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const o of Lw)if(!lh(o,r))return null}}return`Expected ${bi(s)} but found ${bi(r)} instead.`}function Am(s,r){return r.some((o=>o.kind===s.kind))}function ch(s,r){return r.some((o=>o==="null"?s===null:o==="array"?Array.isArray(s):o==="object"?s&&!Array.isArray(s)&&typeof s=="object":o===typeof s))}function uh(s,r){return s.kind==="array"&&r.kind==="array"?s.N===r.N&&uh(s.itemType,r.itemType):s.kind===r.kind}class el{constructor(r,o,u){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zd{constructor(r,o,u,h,m){this.text=r.normalize?r.normalize():r,this.image=o,this.scale=u,this.fontStack=h,this.textColor=m}}class xo{constructor(r){this.sections=r}static fromString(r){return new xo([new zd(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||!!r.image&&r.image.hasPrimary()))}static factory(r){return r instanceof xo?r:xo.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const o of this.sections){if(o.image){const h=o.image.getPrimary().id.toString();r.push(["image",h]);continue}r.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(u)}return r}}class Ta{constructor(r,o={}){if(this.id=Jo.from(r),this.options=Object.assign({},o),o.transform){const{a:u,b:h,c:m,d:g,e:b,f:S}=o.transform;this.options.transform=new DOMMatrix([u,h,m,g,b,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:r,b:o,c:u,d:h,e:m,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:r,b:o,c:u,d:h,e:m,f:g}})}static parse(r){let o,u,h,m;try{({name:o,iconsetId:u,params:h,transform:m}=JSON.parse(r)||{})}catch{return null}if(!o)return null;const{a:g,b,c:S,d:E,e:O,f:D}=m||{};return new Ta({name:o,iconsetId:u},{params:h,transform:new DOMMatrix([g,b,S,E,O,D])})}scaleSelf(r,o){return this.options.transform.scaleSelf(r,o),this}}class Ro{constructor(r,o,u,h,m=!1){this.primaryId=Jo.from(r),this.primaryOptions=o,u&&(this.secondaryId=Jo.from(u)),this.secondaryOptions=h,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ta(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ta(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?Ro.build({name:r}):r}static build(r,o,u,h){return!r||typeof r=="object"&&!("name"in r)?null:new Ro(r,u,o,h)}}function Jy(s,r,o,u){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[s,r,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[s,r,o,u]:[s,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gc(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof cn||s instanceof el||s instanceof xo||s instanceof Ro)return!0;if(Array.isArray(s)){for(const r of s)if(!Gc(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!Gc(s[r]))return!1;return!0}return!1}function Li(s){if(s===null)return Za;if(typeof s=="string")return un;if(typeof s=="boolean")return mn;if(typeof s=="number")return Jt;if(s instanceof cn)return jo;if(s instanceof el)return jd;if(s instanceof xo)return Qs;if(s instanceof Ro)return sh;if(Array.isArray(s)){const r=s.length;let o;for(const u of s){const h=Li(u);if(o){if(o===h)continue;o=nn;break}o=h}return so(o||nn,r)}return Vl}function Do(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof xo||s instanceof Ro||s instanceof cn?s.toString():JSON.stringify(s)}class Ir{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Gc(r[1]))return o.error("invalid value");const u=r[1];let h=Li(u);const m=o.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new Ir(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof cn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof xo?this.value.serialize():this.value}}class Bt{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const hh={string:un,number:Jt,boolean:mn,object:Vl};class ur{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let u,h=1;const m=r[0];if(m==="array"){let b,S;if(r.length>2){const E=r[1];if(typeof E!="string"||!(E in hh)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=hh[E],h++}else b=nn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=r[2],h++}u=so(b,S)}else u=hh[m];const g=[];for(;h<r.length;h++){const b=o.parse(r[h],h,nn);if(!b)return null;g.push(b)}return new ur(u,g)}evaluate(r){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(r);if(!lh(this.type,Li(u)))return u;if(o===this.args.length-1)throw new Bt(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${bi(Li(u))} but was expected to be of type ${bi(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,o=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const h=r.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map((u=>u.serialize())))}}class $l{constructor(r){this.type=Qs,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const h=[];let m=!1;for(let g=1;g<=r.length-1;++g){const b=r[g];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let S=null;if(b["font-scale"]&&(S=o.parseObjectValue(b["font-scale"],g,"font-scale",Jt),!S))return null;let E=null;if(b["text-font"]&&(E=o.parseObjectValue(b["text-font"],g,"text-font",so(un)),!E))return null;let O=null;if(b["text-color"]&&(O=o.parseObjectValue(b["text-color"],g,"text-color",jo),!O))return null;const D=h[h.length-1];D.scale=S,D.font=E,D.textColor=O}else{const S=o.parse(r[g],g,nn);if(!S)return null;const E=S.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:S,scale:null,font:null,textColor:null})}}return new $l(h)}evaluate(r){return new xo(this.sections.map((o=>{const u=o.content.evaluate(r);return uh(Li(u),sh)?new zd("",u,null,null,null):new zd(Do(u),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null)})))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const o of this.sections){r.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),r.push(u)}return r}}class Hc{constructor(r,o,u,h){this._imageWarnHistory={},this.type=sh,this.namePrimary=r,this.nameSecondary=o,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(r,o){if(r.length<2)return o.error("Expected two or more arguments.");let u=1;const h=[];function m(){if(u<r.length){const b=o.parse(r[u],u++,un);return b?(h.push({image:b,options:{}}),!0):(o.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<r.length){const S=r[u];if((b=S)===null||typeof b!="object"||Array.isArray(b))return!0;const E=S.params,O=S.iconset,D=o.concat(u);if(!E&&!O)return u++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const N={},B=D.concat(void 0,"params");for(const U in E){if(!U)return B.error("Image parameter name should be non-empty"),!1;const X=B.concat(void 0,U).parse(E[U],void 0,jo,void 0,{typeAnnotation:"coerce"});if(!X)return!1;N[U]=X}h[h.length-1].options.params=N}if(O){if(typeof O!="object"||O.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!O.id)return D.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=O}return u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!m()||!g())return;return new Hc(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(r,o){const u={};if(o){for(const h in o)if(o[h])try{u[h]=o[h].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const o={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,h=Ro.build(o,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(h&&r.availableImages){const m=h.getPrimary().id;if(h.available=r.availableImages.some((g=>Jo.isEqual(g,m))),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=r.availableImages.some((b=>Jo.isEqual(b,g))))}}return h}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&r(this.paramsPrimary[o]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&r(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(r,o){const u={};if(o&&(u.iconset={id:o}),r){u.params={};for(const h in r)r[h]&&(u.params[h]=r[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&r.push(o)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&r.push(o)}return r}}function mr(s){return dh(s)?"string":fh(s)?"number":Pm(s)?"boolean":Array.isArray(s)?"array":s===null?"null":Em(s)?"object":typeof s}function Em(s){return s!=null&&!Array.isArray(s)&&typeof s!="function"&&!(s instanceof String||s instanceof Number||s instanceof Boolean)&&typeof s=="object"}function dh(s){return typeof s=="string"||s instanceof String}function fh(s){return typeof s=="number"||s instanceof Number}function Pm(s){return typeof s=="boolean"||s instanceof Boolean}const Fd={"to-boolean":mn,"to-color":jo,"to-number":Jt,"to-string":un};class pi{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[0],h=[];let m=Za;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const g=r[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);m=so(o.expectedType.itemType,g)}else{if(!(g>0&&Gc(r[1][0])))return null;m=so(Li(r[1][0]),g)}for(let b=0;b<g;b++){const S=r[1][b];let E;if(Array.isArray(S))E=o.parse(S,void 0,m.itemType);else{const O=mr(S);if(O!==m.itemType.kind)return o.error(`Expected ${m.itemType.kind} but found ${O}.`);E=o.registry.literal.parse(["literal",S===void 0?null:S],o)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return o.error("Expected one argument.");m=Fd[u];for(let g=1;g<r.length;g++){const b=o.parse(r[g],g,nn);if(!b)return null;h.push(b)}}return new pi(m,h)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let o,u;for(const h of this.args){if(o=h.evaluate(r),u=null,o instanceof cn)return o;if(typeof o=="string"){const m=r.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Jy(o[0],o[1],o[2],o[3]),!u))return new cn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Bt(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(r),o===null)return 0;const h=Number(o);if(!isNaN(h))return h}throw new Bt(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?xo.fromString(Do(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Ro.build(Do(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map((o=>o.evaluate(r))):Do(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new $l([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hc(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((o=>{r.push(o.serialize())})),r}}const Im=["Unknown","Point","LineString","Polygon"];class ws{constructor(r,o,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=o,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Im[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-r[0])+this.featureDistanceData.bearing[1]*(h*o-r[1])}return 0}parseColor(r){let o=this._parseColorCache[r];return o||(o=this._parseColorCache[r]=cn.parse(r)),o}getConfig(r){return this.options?this.options.get(r):null}}class bo{constructor(r,o,u,h,m){this.name=r,this.type=o,this._evaluate=u,this.args=h,this._overloadIndex=m}evaluate(r){if(!this._evaluate){const o=bo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,o){const u=r[0],h=bo.definitions[u];if(!h)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[];let S=null,E=-1;for(const[O,D]of g){if(Array.isArray(O)&&O.length!==r.length-1)continue;b.push(O),E++,S=new ef(o.registry,o.path,null,o.scope,void 0,o._scope,o.options,o.iconImageUseTheme);const N=[];let B=!1;for(let U=1;U<r.length;U++){const X=r[U],Q=Array.isArray(O)?O[U-1]:O.type,ee=S.parse(X,1+N.length,Q);if(!ee){B=!0;break}N.push(ee)}if(!B)if(Array.isArray(O)&&O.length!==N.length)S.error(`Expected ${O.length} arguments, but found ${N.length} instead.`);else{for(let U=0;U<N.length;U++){const X=Array.isArray(O)?O[U]:O.type,Q=N[U];S.concat(U+1).checkSubtype(X,Q.type)}if(S.errors.length===0)return new bo(u,m,D,N,E)}}if(b.length===1)o.errors.push(...S.errors);else{const O=(b.length?b:g.map((([N])=>N))).map(tl).join(" | "),D=[];for(let N=1;N<r.length;N++){const B=o.parse(r[N],1+D.length);if(!B)return null;D.push(bi(B.type))}o.error(`Expected arguments of type ${O}, but found (${D.join(", ")}) instead.`)}return null}static register(r,o){bo.definitions=o;for(const u in o)r[u]=bo}}function tl(s){return Array.isArray(s)?`(${s.map(bi).join(", ")})`:`(${bi(s.type)}...)`}class Ki{constructor(r,o,u){this.type=jd,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?o.parse(!1,1,mn):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",mn);if(!h)return null;const m=u["diacritic-sensitive"]===void 0?o.parse(!1,1,mn):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",mn);if(!m)return null;let g=null;return u.locale&&(g=o.parseObjectValue(u.locale,1,"locale",un),!g)?null:new Ki(h,m,g)}evaluate(r){return new el(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function Qy(s,r,o=0,u=s.length-1,h=jw){for(;u>o;){if(u-o>600){const S=u-o+1,E=r-o+1,O=Math.log(S),D=.5*Math.exp(2*O/3),N=.5*Math.sqrt(O*D*(S-D)/S)*(E-S/2<0?-1:1);Qy(s,r,Math.max(o,Math.floor(r-E*D/S+N)),Math.min(u,Math.floor(r+(S-E)*D/S+N)),h)}const m=s[r];let g=o,b=u;for(ph(s,o,r),h(s[u],m)>0&&ph(s,o,u);g<b;){for(ph(s,g,b),g++,b--;h(s[g],m)<0;)g++;for(;h(s[b],m)>0;)b--}h(s[o],m)===0?ph(s,o,b):(b++,ph(s,b,u)),b<=r&&(o=b+1),r<=b&&(u=b-1)}}function ph(s,r,o){const u=s[r];s[r]=s[o],s[o]=u}function jw(s,r){return s<r?-1:s>r?1:0}function Bd(s){let r=0;for(let o,u,h=0,m=s.length,g=m-1;h<m;g=h++)o=s[h],u=s[g],r+=(u.x-o.x)*(o.y+u.y);return r}function Wc(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Aa(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function zw(s,r,o){const u=s[0]-r[0],h=s[1]-r[1],m=s[0]-o[0],g=s[1]-o[1];return u*g-m*h==0&&u*m<=0&&h*g<=0}function Zc(s,r,o=!1){let u=!1;for(let b=0,S=r.length;b<S;b++){const E=r[b];for(let O=0,D=E.length,N=D-1;O<D;N=O++){const B=E[N],U=E[O];if(zw(s,B,U))return o;(m=B)[1]>(h=s)[1]!=(g=U)[1]>h[1]&&h[0]<(g[0]-m[0])*(h[1]-m[1])/(g[1]-m[1])+m[0]&&(u=!u)}}var h,m,g;return u}function ev(s,r,o,u){const h=u[0]-o[0],m=u[1]-o[1],g=(s[0]-o[0])*m-h*(s[1]-o[1]),b=(r[0]-o[0])*m-h*(r[1]-o[1]);return g>0&&b<0||g<0&&b>0}function Ud(s,r,o,u){return(h=[u[0]-o[0],u[1]-o[1]])[0]*(m=[r[0]-s[0],r[1]-s[1]])[1]-h[1]*m[0]!=0&&!(!ev(s,r,o,u)||!ev(o,u,s,r));var h,m}function Vd(s){const r=new wt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=new wt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of s[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),o.x<u.x&&(o.x=u.x),o.y<u.y&&(o.y=u.y);return{min:r,max:o}}const rl=8192;function ql(s,r){const o=(180+s[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(o*h*rl),Math.round(u*h*rl)]}function Fw(s,r){for(let o=0;o<r.length;o++)if(Zc(s,r[o]))return!0;return!1}function Bw(s,r,o){for(const u of o)for(let h=0,m=u.length,g=m-1;h<m;g=h++)if(Ud(s,r,u[g],u[h]))return!0;return!1}function $d(s,r){for(let o=0;o<s.length;++o)if(!Zc(s[o],r))return!1;for(let o=0;o<s.length-1;++o)if(Bw(s[o],s[o+1],r))return!1;return!0}function tv(s,r){for(let o=0;o<r.length;o++)if($d(s,r[o]))return!0;return!1}function qd(s,r,o){const u=[];for(let h=0;h<s.length;h++){const m=[];for(let g=0;g<s[h].length;g++){const b=ql(s[h][g],o);Wc(r,b),m.push(b)}u.push(m)}return u}function da(s,r,o){const u=[];for(let h=0;h<s.length;h++){const m=qd(s[h],r,o);u.push(m)}return u}function rv(s,r,o,u){if(s[0]<o[0]||s[0]>o[2]){const h=.5*u;let m=s[0]-o[0]>h?-u:o[0]-s[0]>h?u:0;m===0&&(m=s[0]-o[2]>h?-u:o[2]-s[0]>h?u:0),s[0]+=m}Wc(r,s)}function nv(s,r,o,u){const h=Math.pow(2,u.z)*rl,m=[u.x*rl,u.y*rl],g=[];if(!s)return g;for(const b of s)for(const S of b){const E=[S.x+m[0],S.y+m[1]];rv(E,r,o,h),g.push(E)}return g}function iv(s,r,o,u){const h=Math.pow(2,u.z)*rl,m=[u.x*rl,u.y*rl],g=[];if(!s)return g;for(const S of s){const E=[];for(const O of S){const D=[O.x+m[0],O.y+m[1]];Wc(r,D),E.push(D)}g.push(E)}if(r[2]-r[0]<=h/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of g)for(const E of S)rv(E,r,o,h)}var b;return g}class Gl{constructor(r,o){this.type=mn,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Gc(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const m=u.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Gl(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Gl(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Gl(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,u){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=qd(u.coordinates,m,g),S=nv(o.geometry(),h,m,g);if(!Aa(h,m))return!1;for(const E of S)if(!Zc(E,b))return!1}if(u.type==="MultiPolygon"){const b=da(u.coordinates,m,g),S=nv(o.geometry(),h,m,g);if(!Aa(h,m))return!1;for(const E of S)if(!Fw(E,b))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,u){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const b=qd(u.coordinates,m,g),S=iv(o.geometry(),h,m,g);if(!Aa(h,m))return!1;for(const E of S)if(!$d(E,b))return!1}if(u.type==="MultiPolygon"){const b=da(u.coordinates,m,g),S=iv(o.geometry(),h,m,g);if(!Aa(h,m))return!1;for(const E of S)if(!tv(E,b))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const mh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Cm=1/298.257223563,Om=Cm*(2-Cm),Xc=Math.PI/180;class Kc{static fromTile(r,o,u){const h=Math.PI*(1-2*(r+.5)/Math.pow(2,o)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Xc;return new Kc(m,u)}static get units(){return mh}constructor(r,o){if(r===void 0)throw new Error("No latitude given.");if(o&&!mh[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(mh).join(", ")}`);const u=6378.137*Xc*(o?mh[o]:1),h=Math.cos(r*Xc),m=1/(1-Om*(1-h*h)),g=Math.sqrt(m);this.kx=u*g*h,this.ky=u*g*m*(1-Om)}distance(r,o){const u=ea(r[0]-o[0])*this.kx,h=(r[1]-o[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(r,o){const u=ea(o[0]-r[0])*this.kx;return Math.atan2(u,(o[1]-r[1])*this.ky)/Xc}destination(r,o,u){const h=u*Xc;return this.offset(r,Math.sin(h)*o,Math.cos(h)*o)}offset(r,o,u){return[r[0]+o/this.kx,r[1]+u/this.ky]}lineDistance(r){let o=0;for(let u=0;u<r.length-1;u++)o+=this.distance(r[u],r[u+1]);return o}area(r){let o=0;for(let u=0;u<r.length;u++){const h=r[u];for(let m=0,g=h.length,b=g-1;m<g;b=m++)o+=ea(h[m][0]-h[b][0])*(h[m][1]+h[b][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(r,o){let u=0;if(o<=0)return r[0];for(let h=0;h<r.length-1;h++){const m=r[h],g=r[h+1],b=this.distance(m,g);if(u+=b,u>o)return Gd(m,g,(o-(u-b))/b)}return r[r.length-1]}pointToSegmentDistance(r,o,u){let[h,m]=o,g=ea(u[0]-h)*this.kx,b=(u[1]-m)*this.ky;if(g!==0||b!==0){const S=(ea(r[0]-h)*this.kx*g+(r[1]-m)*this.ky*b)/(g*g+b*b);S>1?(h=u[0],m=u[1]):S>0&&(h+=g/this.kx*S,m+=b/this.ky*S)}return g=ea(r[0]-h)*this.kx,b=(r[1]-m)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(r,o){let u=1/0,h=r[0][0],m=r[0][1],g=0,b=0;for(let S=0;S<r.length-1;S++){let E=r[S][0],O=r[S][1],D=ea(r[S+1][0]-E)*this.kx,N=(r[S+1][1]-O)*this.ky,B=0;D===0&&N===0||(B=(ea(o[0]-E)*this.kx*D+(o[1]-O)*this.ky*N)/(D*D+N*N),B>1?(E=r[S+1][0],O=r[S+1][1]):B>0&&(E+=D/this.kx*B,O+=N/this.ky*B)),D=ea(o[0]-E)*this.kx,N=(o[1]-O)*this.ky;const U=D*D+N*N;U<u&&(u=U,h=E,m=O,g=S,b=B)}return{point:[h,m],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(r,o,u){let h=this.pointOnLine(u,r),m=this.pointOnLine(u,o);if(h.index>m.index||h.index===m.index&&h.t>m.t){const E=h;h=m,m=E}const g=[h.point],b=h.index+1,S=m.index;!Mm(u[b],g[0])&&b<=S&&g.push(u[b]);for(let E=b+1;E<=S;E++)g.push(u[E]);return Mm(u[S],m.point)||g.push(m.point),g}lineSliceAlong(r,o,u){let h=0;const m=[];for(let g=0;g<u.length-1;g++){const b=u[g],S=u[g+1],E=this.distance(b,S);if(h+=E,h>r&&m.length===0&&m.push(Gd(b,S,(r-(h-E))/E)),h>=o)return m.push(Gd(b,S,(o-(h-E))/E)),m;h>r&&m.push(S)}return m}bufferPoint(r,o){const u=o/this.ky,h=o/this.kx;return[r[0]-h,r[1]-u,r[0]+h,r[1]+u]}bufferBBox(r,o){const u=o/this.ky,h=o/this.kx;return[r[0]-h,r[1]-u,r[2]+h,r[3]+u]}insideBBox(r,o){return ea(r[0]-o[0])>=0&&ea(r[0]-o[2])<=0&&r[1]>=o[1]&&r[1]<=o[3]}}function Mm(s,r){return s[0]===r[0]&&s[1]===r[1]}function Gd(s,r,o){const u=ea(r[0]-s[0]);return[s[0]+u*o,s[1]+(r[1]-s[1])*o]}function ea(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class Hd{constructor(r=[],o=((u,h)=>u<h?-1:u>h?1:0)){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:u}=this,h=o[r];for(;r>0;){const m=r-1>>1,g=o[m];if(u(h,g)>=0)break;o[r]=g,r=m}o[r]=h}_down(r){const{data:o,compare:u}=this,h=this.length>>1,m=o[r];for(;r<h;){let g=1+(r<<1);const b=g+1;if(b<this.length&&u(o[b],o[g])<0&&(g=b),u(o[g],m)>=0)break;o[r]=o[g],r=g}o[r]=m}}var Mt=8192;function Rm(s,r){return r.dist-s.dist}const Yc=100,Jc=50;function gh(s){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==s.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==s[o])return!1;return!0}function _h(s){return s[1]-s[0]+1}function Xa(s,r){const o=s[1]>=s[0]&&s[1]<r;return o||console.warn("Distance Expression: Index is out of range"),o}function Wd(s,r){if(s[0]>s[1])return[null,null];const o=_h(s);if(r){if(o===2)return[s,null];const u=Math.floor(o/2);return[[s[0],s[0]+u],[s[0]+u,s[1]]]}{if(o===1)return[s,null];const u=Math.floor(o/2)-1;return[[s[0],s[0]+u],[s[0]+u+1,s[1]]]}}function fa(s,r){const o=[1/0,1/0,-1/0,-1/0];if(!Xa(r,s.length))return o;for(let u=r[0];u<=r[1];++u)Wc(o,s[u]);return o}function $r(s){const r=[1/0,1/0,-1/0,-1/0];for(let o=0;o<s.length;++o)for(let u=0;u<s[o].length;++u)Wc(r,s[o][u]);return r}function Qc(s,r,o){if(gh(s)||gh(r))return NaN;let u=0,h=0;return s[2]<r[0]&&(u=r[0]-s[2]),s[0]>r[2]&&(u=s[0]-r[2]),s[1]>r[3]&&(h=s[1]-r[3]),s[3]<r[1]&&(h=r[1]-s[3]),o.distance([0,0],[u,h])}function Uw(s){return 360*s-180}function Vw(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Zd(s,r){const o=Math.pow(2,r.z),u=(s.y/Mt+r.y)/o;return[Uw((s.x/Mt+r.x)/o),Vw(u)]}function $w(s,r){const o=[];for(let u=0;u<s.length;++u)o.push(Zd(s[u],r));return o}function Gn(s,r,o){const u=o.pointOnLine(r,s).point;return o.distance(s,u)}function ov(s,r,o,u,h){const m=o.slice(u[0],u[1]+1);let g=1/0;for(let b=r[0];b<=r[1];++b)if((g=Math.min(g,Gn(s[b],m,h)))===0)return 0;return g}function Dm(s,r,o,u,h){const m=Math.min(h.pointToSegmentDistance(s,o,u),h.pointToSegmentDistance(r,o,u)),g=Math.min(h.pointToSegmentDistance(o,s,r),h.pointToSegmentDistance(u,s,r));return Math.min(m,g)}function qw(s,r,o,u,h){if(!Xa(r,s.length)||!Xa(u,o.length))return NaN;let m=1/0;for(let g=r[0];g<r[1];++g)for(let b=u[0];b<u[1];++b){if(Ud(s[g],s[g+1],o[b],o[b+1]))return 0;m=Math.min(m,Dm(s[g],s[g+1],o[b],o[b+1],h))}return m}function Gw(s,r,o,u,h){if(!Xa(r,s.length)||!Xa(u,o.length))return NaN;let m=1/0;for(let g=r[0];g<=r[1];++g)for(let b=u[0];b<=u[1];++b)if((m=Math.min(m,h.distance(s[g],o[b])))===0)return m;return m}function Hw(s,r,o){if(Zc(s,r,!0))return 0;let u=1/0;for(const h of r){const m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&(u=Math.min(u,o.pointToSegmentDistance(s,h[m-1],h[0])))===0||(u=Math.min(u,Gn(s,h,o)))===0)return u}return u}function Ww(s,r,o,u){if(!Xa(r,s.length))return NaN;for(let m=r[0];m<=r[1];++m)if(Zc(s[m],o,!0))return 0;let h=1/0;for(let m=r[0];m<r[1];++m)for(const g of o)for(let b=0,S=g.length,E=S-1;b<S;E=b++){if(Ud(s[m],s[m+1],g[E],g[b]))return 0;h=Math.min(h,Dm(s[m],s[m+1],g[E],g[b],u))}return h}function av(s,r){for(const o of s)for(let u=0;u<=o.length-1;++u)if(Zc(o[u],r,!0))return!0;return!1}function Zw(s,r,o,u=1/0){const h=$r(s),m=$r(r);if(u!==1/0&&Qc(h,m,o)>=u)return u;if(Aa(h,m)){if(av(s,r))return 0}else if(av(r,s))return 0;let g=u;for(const b of s)for(let S=0,E=b.length,O=E-1;S<E;O=S++)for(const D of r)for(let N=0,B=D.length,U=B-1;N<B;U=N++){if(Ud(b[O],b[S],D[U],D[N]))return 0;g=Math.min(g,Dm(b[O],b[S],D[U],D[N],o))}return g}function Xd(s,r,o,u,h,m,g){if(m===null||g===null)return;const b=Qc(fa(u,m),fa(h,g),o);b<r&&s.push({dist:b,range1:m,range2:g})}function Xw(s,r,o,u,h=1/0){let m=Math.min(u.distance(s[0],o[0][0]),h);if(m===0)return m;const g=new Hd([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Rm),b=r?Jc:Yc,S=$r(o);for(;g.length;){const E=g.pop();if(E.dist>=m)continue;const O=E.range1;if(_h(O)<=b){if(!Xa(O,s.length))return NaN;if(r){const D=Ww(s,O,o,u);if((m=Math.min(m,D))===0)return m}else for(let D=O[0];D<=O[1];++D){const N=Hw(s[D],o,u);if((m=Math.min(m,N))===0)return m}}else{const D=Wd(O,r);if(D[0]!==null){const N=Qc(fa(s,D[0]),S,u);N<m&&g.push({dist:N,range1:D[0],range2:[0,0]})}if(D[1]!==null){const N=Qc(fa(s,D[1]),S,u);N<m&&g.push({dist:N,range1:D[1],range2:[0,0]})}}}return m}function sv(s,r,o,u,h,m=1/0){let g=Math.min(m,h.distance(s[0],o[0]));if(g===0)return g;const b=new Hd([{dist:0,range1:[0,s.length-1],range2:[0,o.length-1]}],Rm),S=r?Jc:Yc,E=u?Jc:Yc;for(;b.length;){const O=b.pop();if(O.dist>=g)continue;const D=O.range1,N=O.range2;if(_h(D)<=S&&_h(N)<=E){if(!Xa(D,s.length)||!Xa(N,o.length))return NaN;if(r&&u?g=Math.min(g,qw(s,D,o,N,h)):r||u?r&&!u?g=Math.min(g,ov(o,N,s,D,h)):!r&&u&&(g=Math.min(g,ov(s,D,o,N,h))):g=Math.min(g,Gw(s,D,o,N,h)),g===0)return g}else{const B=Wd(D,r),U=Wd(N,u);Xd(b,g,h,s,o,B[0],U[0]),Xd(b,g,h,s,o,B[0],U[1]),Xd(b,g,h,s,o,B[1],U[0]),Xd(b,g,h,s,o,B[1],U[1])}}return g}function km(s,r,o,u,h=1/0){let m=h;const g=fa(s,[0,s.length-1]);for(const b of o)if(!(m!==1/0&&Qc(g,fa(b,[0,b.length-1]),u)>=m)&&(m=Math.min(m,sv(s,r,b,!0,u,m)),m===0))return m;return m}function Kd(s,r,o,u,h=1/0){let m=h;const g=fa(s,[0,s.length-1]);for(const b of o){if(m!==1/0&&Qc(g,$r(b),u)>=m)continue;const S=Xw(s,r,b,u,m);if(isNaN(S))return S;if((m=Math.min(m,S))===0)return m}return m}function Nm(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class Hl{constructor(r,o){this.type=Jt,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(Gc(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(Nm(u.features[h].geometry.type))return new Hl(u,u.features[h].geometry)}else if(u.type==="Feature"){if(Nm(u.geometry.type))return new Hl(u,u.geometry)}else if(Nm(u.type))return new Hl(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const o=r.geometry(),u=r.canonicalID();if(o!=null&&u!=null){if(r.geometryType()==="Point")return(function(h,m,g){const b=[];for(const E of h)for(const O of E)b.push(Zd(O,m));const S=new Kc(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?sv(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",S):g.type==="MultiLineString"?km(b,!1,g.coordinates,S):g.type==="Polygon"||g.type==="MultiPolygon"?Kd(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,S):null})(o,u,this.geometries);if(r.geometryType()==="LineString")return(function(h,m,g){const b=[];for(const E of h){const O=[];for(const D of E)O.push(Zd(D,m));b.push(O)}const S=new Kc(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return km(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,S);if(g.type==="MultiLineString"){let E=1/0;for(let O=0;O<g.coordinates.length;O++){const D=km(g.coordinates[O],!0,b,S,E);if(isNaN(D))return D;if((E=Math.min(E,D))===0)return E}return E}if(g.type==="Polygon"||g.type==="MultiPolygon"){let E=1/0;for(let O=0;O<b.length;O++){const D=Kd(b[O],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,S,E);if(isNaN(D))return D;if((E=Math.min(E,D))===0)return E}return E}return null})(o,u,this.geometries);if(r.geometryType()==="Polygon")return(function(h,m,g){const b=[];for(const E of(function(O,D){const N=O.length;if(N<=1)return[O];const B=[];let U,X;for(let Q=0;Q<N;Q++){const ee=Bd(O[Q]);ee!==0&&(O[Q].area=Math.abs(ee),X===void 0&&(X=ee<0),X===ee<0?(U&&B.push(U),U=[O[Q]]):U.push(O[Q]))}return U&&B.push(U),B})(h)){const O=[];for(let D=0;D<E.length;++D)O.push($w(E[D],m));b.push(O)}const S=new Kc(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Kd(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,S);if(g.type==="MultiLineString"){let E=1/0;for(let O=0;O<g.coordinates.length;O++){const D=Kd(g.coordinates[O],!0,b,S,E);if(isNaN(D))return D;if((E=Math.min(E,D))===0)return E}return E}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(E,O,D){let N=1/0;for(const B of E)for(const U of O){const X=Zw(B,U,D,N);if(isNaN(X))return X;if((N=Math.min(N,X))===0)return N}return N})(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,S):null})(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function eu(s){if(s instanceof bo&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Gl||s instanceof Hl)return!1;if(s instanceof ru)return s.featureConstant;let r=!0;return s.eachChild((o=>{r&&!eu(o)&&(r=!1)})),r}function Yd(s){if(s instanceof bo&&s.name==="feature-state")return!1;let r=!0;return s.eachChild((o=>{r&&!Yd(o)&&(r=!1)})),r}function Jd(s){if(s instanceof ru)return new Set([s.key]);let r=new Set;return s.eachChild((o=>{r=new Set([...r,...Jd(o)])})),r}function tu(s,r){if(s instanceof bo&&r.indexOf(s.name)>=0)return!1;let o=!0;return s.eachChild((u=>{o&&!tu(u,r)&&(o=!1)})),o}function lv(s,r,o){return[s,r,o].filter(Boolean).join("")}function Lm(s,r){switch(s){case"string":return Do(r);case"number":return+r;case"boolean":return!!r;case"color":return cn.parse(r);case"formatted":return xo.fromString(Do(r));case"resolvedImage":return Ro.build(Do(r))}return r}function cv(s,r,o,u){return u!==void 0&&(s=u*Math.round(s/u)),r!==void 0&&s<r&&(s=r),o!==void 0&&s>o&&(s=o),s}class ru{constructor(r,o,u,h=!1){this.type=r,this.key=o,this.scope=u,this.featureConstant=h}static parse(r,o){let u=o.expectedType;if(u==null&&(u=nn),r.length<2||r.length>3)return o.error("Invalid number of arguments for 'config' expression.");const h=o.parse(r[1],1);if(!(h instanceof Ir))return o.error("Key name of 'config' expression must be a string literal.");let m,g=!0;const b=Do(h.value);if(r.length>=3){const S=o.parse(r[2],2);if(!(S instanceof Ir))return o.error("Scope of 'config' expression must be a string literal.");m=Do(S.value)}if(o.options){const S=lv(b,m,o._scope),E=o.options.get(S);E&&(g=eu(E.value||E.default))}return new ru(u,b,m,g)}evaluate(r){const o=lv(this.key,this.scope,r.scope),u=r.getConfig(o);if(!u)return null;const{type:h,value:m,values:g,minValue:b,maxValue:S,stepValue:E}=u,O=u.default.evaluate(r);let D=O;if(m){const N=r.scope;r.scope=(N||"").split("").slice(1).join(""),D=m.evaluate(r),r.scope=N}return h&&(D=Lm(h,D)),D===void 0||b===void 0&&S===void 0&&E===void 0||(typeof D=="number"?D=cv(D,b,S,E):Array.isArray(D)&&(D=D.map((N=>typeof N=="number"?cv(N,b,S,E):N)))),m!==void 0&&D!==void 0&&g&&!g.includes(D)&&(D=O,h&&(D=Lm(h,D))),(h&&h!==this.type||D!==void 0&&!uh(Li(D),this.type))&&(D=Lm(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class Qd{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=r[1];return o.scope.has(u)?new Qd(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ef{constructor(r,o=[],u,h=new Ld,m=[],g,b,S){this.registry=r,this.path=o,this.key=o.map((E=>typeof E=="string"?`['${E}']`:`[${E}]`)).join(""),this.scope=h,this.errors=m,this.expectedType=u,this._scope=g,this.options=b,this.iconImageUseTheme=S}parse(r,o,u,h,m={}){return o||u?this.concat(o,null,u,h)._parse(r,m):this._parse(r,m)}parseObjectValue(r,o,u,h,m,g={}){return this.concat(o,u,h,m)._parse(r,g)}_parse(r,o){function u(h,m,g){return g==="assert"?new ur(m,[h]):g==="coerce"?new pi(m,[h]):h}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(h){let m=h.parse(r,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,b=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else m=u(m,g,o.typeAnnotation||"coerce");else m=u(m,g,o.typeAnnotation||"assert")}if(!(m instanceof Ir)&&m.type.kind!=="resolvedImage"&&jm(m)){const g=new ws(this._scope,this.options,this.iconImageUseTheme);try{m=new Ir(m.type,m.evaluate(g))}catch(b){return this.error(b.message),null}}return m}return pi.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,u,h){let m=typeof r=="number"?this.path.concat(r):this.path;m=typeof o=="string"?m.concat(o):m;const g=h?this.scope.concat(h):this.scope;return new ef(this.registry,m,u||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...o){const u=`${this.key}${o.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Sa(u,r))}checkSubtype(r,o){const u=lh(r,o);return u&&this.error(u),u}}function jm(s){if(s instanceof Qd)return jm(s.boundExpression);if(s instanceof bo&&s.name==="error"||s instanceof Ki||s instanceof Gl||s instanceof Hl||s instanceof ru)return!1;const r=s instanceof pi||s instanceof ur;let o=!0;return s.eachChild((u=>{o=r?o&&jm(u):o&&u instanceof Ir})),!!o&&eu(s)&&tu(s,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function tf(s,r){const o=s.length-1;let u,h,m=0,g=o,b=0;for(;m<=g;)if(b=Math.floor((m+g)/2),u=s[b],h=s[b+1],u<=r){if(b===o||r<h)return b;m=b+1}else{if(!(u>r))throw new Bt("Input is not a number.");g=b-1}return 0}class yh{constructor(r,o,u){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[h,m]of u)this.labels.push(h),this.outputs.push(m)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(r[1],1,Jt);if(!u)return null;const h=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let g=1;g<r.length;g+=2){const b=g===1?-1/0:r[g],S=r[g+1],E=g,O=g+1;if(typeof b!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=b)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const D=o.parse(S,O,m);if(!D)return null;m=m||D.type,h.push([b,D])}return new yh(m,u,h)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=o[0])return u[0].evaluate(r);const m=o.length;return h>=o[m-1]?u[m-1].evaluate(r):u[tf(o,h)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&r.push(this.labels[o]),r.push(this.outputs[o].serialize());return r}}const uv=.95047,hv=1.08883,dv=4/29,nl=6/29,fv=3*nl*nl,pv=nl*nl*nl,Kw=Math.PI/180,Yw=180/Math.PI;function zm(s){return s>pv?Math.pow(s,1/3):s/fv+dv}function rf(s){return s>nl?s*s*s:fv*(s-dv)}function nf(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function il(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Fm(s){const r=il(s.r),o=il(s.g),u=il(s.b),h=zm((.4124564*r+.3575761*o+.1804375*u)/uv),m=zm((.2126729*r+.7151522*o+.072175*u)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-zm((.0193339*r+.119192*o+.9503041*u)/hv)),alpha:s.a}}function Bm(s){let r=(s.l+16)/116,o=isNaN(s.a)?r:r+s.a/500,u=isNaN(s.b)?r:r-s.b/200;return r=1*rf(r),o=uv*rf(o),u=hv*rf(u),new cn(nf(3.2404542*o-1.5371385*r-.4985314*u),nf(-.969266*o+1.8760108*r+.041556*u),nf(.0556434*o-.2040259*r+1.0572252*u),s.alpha)}function Jw(s,r,o){const u=r-s;return s+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Wl={forward:Fm,reverse:Bm,interpolate:function(s,r,o){return{l:lr(s.l,r.l,o),a:lr(s.a,r.a,o),b:lr(s.b,r.b,o),alpha:lr(s.alpha,r.alpha,o)}}},Zl={forward:function(s){const{l:r,a:o,b:u}=Fm(s),h=Math.atan2(u,o)*Yw;return{h:h<0?h+360:h,c:Math.sqrt(o*o+u*u),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Kw,o=s.c;return Bm({l:s.l,a:Math.cos(r)*o,b:Math.sin(r)*o,alpha:s.alpha})},interpolate:function(s,r,o){return{h:Jw(s.h,r.h,o),c:lr(s.c,r.c,o),l:lr(s.l,r.l,o),alpha:lr(s.alpha,r.alpha,o)}}};var mv=Object.freeze({__proto__:null,hcl:Zl,lab:Wl});class ta{constructor(r,o,u,h,m){this.type=r,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[g,b]of m)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(r,o,u,h){let m=0;if(r.name==="exponential")m=of(o,r.base,u,h);else if(r.name==="linear")m=of(o,1,u,h);else if(r.name==="cubic-bezier"){const g=r.controlPoints;m=new Ad(g[0],g[1],g[2],g[3]).solve(of(o,1,u,h))}return m}static parse(r,o){let[u,h,m,...g]=r;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some((O=>typeof O!="number"||O<0||O>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,Jt),!m)return null;const b=[];let S=null;u==="interpolate-hcl"||u==="interpolate-lab"?S=jo:o.expectedType&&o.expectedType.kind!=="value"&&(S=o.expectedType);for(let E=0;E<g.length;E+=2){const O=g[E],D=g[E+1],N=E+3,B=E+4;if(typeof O!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(b.length&&b[b.length-1][0]>=O)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const U=o.parse(D,B,S);if(!U)return null;S=S||U.type,b.push([O,U])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new ta(S,u,h,m,b):o.error(`Type ${bi(S)} is not interpolatable.`)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=o[0])return u[0].evaluate(r);const m=o.length;if(h>=o[m-1])return u[m-1].evaluate(r);const g=tf(o,h),b=ta.interpolationFactor(this.interpolation,h,o[g],o[g+1]),S=u[g].evaluate(r),E=u[g+1].evaluate(r);return this.operator==="interpolate"?Qo[this.type.kind.toLowerCase()](S,E,b):this.operator==="interpolate-hcl"?Zl.reverse(Zl.interpolate(Zl.forward(S),Zl.forward(E),b)):Wl.reverse(Wl.interpolate(Wl.forward(S),Wl.forward(E),b))}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function of(s,r,o,u){const h=u-o,m=s-o;return h===0?0:r===1?m/h:(Math.pow(r,m)-1)/(Math.pow(r,h)-1)}class vh{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expectected at least one argument.");let u=null;const h=o.expectedType;h&&h.kind!=="value"&&(u=h);const m=[];for(const b of r.slice(1)){const S=o.parse(b,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!S)return null;u=u||S.type,m.push(S)}const g=h&&m.some((b=>lh(h,b.type)));return new vh(g?nn:u,m)}evaluate(r){let o,u=null,h=0;for(const m of this.args){if(h++,u=m.evaluate(r),u&&u instanceof Ro&&!u.available&&(o||(o=u),u=null,h===this.args.length))return o;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((o=>{r.push(o.serialize())})),r}}class af{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let m=1;m<r.length-1;m+=2){const g=r[m];if(typeof g!="string")return o.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=o.parse(r[m+1],m+1);if(!b)return null;u.push([g,b])}const h=o.parse(r[r.length-1],r.length-1,o.expectedType,u);return h?new af(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[o,u]of this.bindings)r.push(o,u.serialize());return r.push(this.result.serialize()),r}}class Um{constructor(r,o,u){this.type=r,this.index=o,this.input=u}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,Jt),h=o.parse(r[2],2,so(o.expectedType||nn));return u&&h?new Um(h.type.itemType,u,h):null}evaluate(r){const o=this.index.evaluate(r),u=this.input.evaluate(r);if(o<0)throw new Bt("Array index out of bounds: negative index");if(o>=u.length)throw new Bt("Array index out of bounds: index exceeds array size");if(o!==Math.floor(o))throw new Bt("Array index must be an integer. Use at-interpolated for fractional indices");return u[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vm{constructor(r,o,u){this.type=r,this.index=o,this.input=u}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,Jt),h=o.parse(r[2],2,so(o.expectedType||nn));return u&&h?new Vm(h.type.itemType,u,h):null}evaluate(r){const o=this.index.evaluate(r),u=this.input.evaluate(r);if(o<0)throw new Bt(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new Bt(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const h=Math.floor(o),m=Math.ceil(o),g=u[h],b=u[m];if(typeof g!="number"||typeof b!="number")throw new Bt(`Cannot interpolate between non-number values at index ${o}.`);const S=o-h;return g*(1-S)+b*S}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class sf{constructor(r,o){this.type=mn,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,nn),h=o.parse(r[2],2,nn);return u&&h?Am(u.type,[mn,un,Jt,Za,nn])?new sf(u,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(u.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!ch(o,["boolean","string","number","null"]))throw new Bt(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Li(o))} instead.`);if(!ch(u,["string","array"]))throw new Bt(`Expected second argument to be of type array or string, but found ${bi(Li(u))} instead.`);return u.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class xh{constructor(r,o,u){this.type=Jt,this.needle=r,this.haystack=o,this.fromIndex=u}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,nn),h=o.parse(r[2],2,nn);if(!u||!h)return null;if(!Am(u.type,[mn,un,Jt,Za,nn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(u.type)} instead`);if(r.length===4){const m=o.parse(r[3],3,Jt);return m?new xh(u,h,m):null}return new xh(u,h)}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!ch(o,["boolean","string","number","null"]))throw new Bt(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Li(o))} instead.`);if(!ch(u,["string","array"]))throw new Bt(`Expected second argument to be of type array or string, but found ${bi(Li(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return u.indexOf(o,h)}return u.indexOf(o)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class nu{constructor(r,o,u,h,m,g){this.inputType=r,this.type=o,this.input=u,this.cases=h,this.outputs=m,this.otherwise=g}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const m={},g=[];for(let E=2;E<r.length-1;E+=2){let O=r[E];const D=r[E+1];Array.isArray(O)||(O=[O]);const N=o.concat(E);if(O.length===0)return N.error("Expected at least one branch label.");for(const U of O){if(typeof U!="number"&&typeof U!="string")return N.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,Li(U)))return null}else u=Li(U);if(m[String(U)]!==void 0)return N.error("Branch labels must be unique.");m[String(U)]=g.length}const B=o.parse(D,E,h);if(!B)return null;h=h||B.type,g.push(B)}const b=o.parse(r[1],1,nn);if(!b)return null;const S=o.parse(r[r.length-1],r.length-1,h);return S?b.type.kind!=="value"&&o.concat(1).checkSubtype(u,b.type)?null:new nu(u,h,b,m,g,S):null}evaluate(r){const o=this.input.evaluate(r);return(uh(Li(o),this.inputType)&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],h={};for(const g of o){const b=h[this.cases[g]];b===void 0?(h[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[b][1].push(g)}const m=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of u)r.push(b.length===1?m(b[0]):b.map(m)),r.push(this.outputs[g].serialize());return r.push(this.otherwise.serialize()),r}}class $m{constructor(r,o,u){this.type=r,this.branches=o,this.otherwise=u}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const h=[];for(let g=1;g<r.length-1;g+=2){const b=o.parse(r[g],g,mn);if(!b)return null;const S=o.parse(r[g+1],g+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}const m=o.parse(r[r.length-1],r.length-1,u);return m?new $m(u,h,m):null}evaluate(r){for(const[o,u]of this.branches)if(o.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,u]of this.branches)r(o),r(u);r(this.otherwise)}outputDefined(){return this.branches.every((([r,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((o=>{r.push(o.serialize())})),r}}class bh{constructor(r,o,u,h){this.type=r,this.input=o,this.beginIndex=u,this.endIndex=h}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,nn),h=o.parse(r[2],2,Jt);if(!u||!h)return null;if(!Am(u.type,[so(nn),un,nn]))return o.error(`Expected first argument to be of type array or string, but found ${bi(u.type)} instead`);if(r.length===4){const m=o.parse(r[3],3,Jt);return m?new bh(u.type,u,h,m):null}return new bh(u.type,u,h)}evaluate(r){const o=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!ch(o,["string","array"]))throw new Bt(`Expected first argument to be of type array or string, but found ${bi(Li(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return o.slice(u,h)}return o.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class qm{constructor(r,o){this.type=so(un),this.str=r,this.delimiter=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,un),h=o.parse(r[2],2,un);return u&&h?new qm(u,h):void 0}evaluate(r){const o=this.str.evaluate(r),u=this.delimiter.evaluate(r);return o.split(u)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function gv(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Gm(s,r,o,u){return u.compare(r,o)===0}function Xl(s,r,o){const u=s!=="=="&&s!=="!=";return class NG{constructor(m,g,b){this.type=mn,this.lhs=m,this.rhs=g,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const b=m[0];let S=g.parse(m[1],1,nn);if(!S)return null;if(!gv(b,S.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${bi(S.type)}'.`);let E=g.parse(m[2],2,nn);if(!E)return null;if(!gv(b,E.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${bi(E.type)}'.`);if(S.type.kind!==E.type.kind&&S.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${bi(S.type)}' and '${bi(E.type)}'.`);u&&(S.type.kind==="value"&&E.type.kind!=="value"?S=new ur(E.type,[S]):S.type.kind!=="value"&&E.type.kind==="value"&&(E=new ur(S.type,[E])));let O=null;if(m.length===4){if(S.type.kind!=="string"&&E.type.kind!=="string"&&S.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(O=g.parse(m[3],3,jd),!O)return null}return new NG(S,E,O)}evaluate(m){const g=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){const S=Li(g),E=Li(b);if(S.kind!==E.kind||S.kind!=="string"&&S.kind!=="number")throw new Bt(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${S.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const S=Li(g),E=Li(b);if(S.kind!=="string"||E.kind!=="string")return r(m,g,b)}return this.collator?o(m,g,b,this.collator.evaluate(m)):r(m,g,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[s];return this.eachChild((g=>{m.push(g.serialize())})),m}}}const Qw=Xl("==",(function(s,r,o){return r===o}),Gm),e1=Xl("!=",(function(s,r,o){return r!==o}),(function(s,r,o,u){return!Gm(0,r,o,u)})),t1=Xl("<",(function(s,r,o){return r<o}),(function(s,r,o,u){return u.compare(r,o)<0})),lf=Xl(">",(function(s,r,o){return r>o}),(function(s,r,o,u){return u.compare(r,o)>0})),r1=Xl("<=",(function(s,r,o){return r<=o}),(function(s,r,o,u){return u.compare(r,o)<=0})),n1=Xl(">=",(function(s,r,o){return r>=o}),(function(s,r,o,u){return u.compare(r,o)>=0}));class Hm{constructor(r,o,u,h,m,g){this.type=un,this.number=r,this.locale=o,this.currency=u,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const u=o.parse(r[1],1,Jt);if(!u)return null;const h=r[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=o.parseObjectValue(h.locale,2,"locale",un),!m))return null;let g=null;if(h.currency&&(g=o.parseObjectValue(h.currency,2,"currency",un),!g))return null;let b=null;if(h.unit&&(b=o.parseObjectValue(h.unit,2,"unit",un),!b))return null;let S=null;if(h["min-fraction-digits"]&&(S=o.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Jt),!S))return null;let E=null;return h["max-fraction-digits"]&&(E=o.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Jt),!E)?null:new Hm(u,m,g,b,S,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Wm{constructor(r){this.type=Jt,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=o.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${bi(u.type)} instead.`):new Wm(u):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Bt(`Expected value to be of type string or array, but found ${bi(Li(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((o=>{r.push(o.serialize())})),r}}function Zm(s){return function(){s=1831565813+(s|=0)|0;let r=Math.imul(s^s>>>15,1|s);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const iu={"==":Qw,"!=":e1,">":lf,"<":t1,">=":n1,"<=":r1,array:ur,at:Um,"at-interpolated":Vm,boolean:ur,case:$m,coalesce:vh,collator:Ki,format:$l,image:Hc,in:sf,"index-of":xh,interpolate:ta,"interpolate-hcl":ta,"interpolate-lab":ta,length:Wm,let:af,literal:Ir,match:nu,number:ur,"number-format":Hm,object:ur,slice:bh,step:yh,string:ur,"to-boolean":pi,"to-color":pi,"to-number":pi,"to-string":pi,var:Qd,within:Gl,distance:Hl,config:ru,split:qm};function _v(s,[r,o,u,h]){r=r.evaluate(s),o=o.evaluate(s),u=u.evaluate(s);const m=h?h.evaluate(s):1,g=Jy(r,o,u,m);if(g)throw new Bt(g);return new cn(r/255,o/255,u/255,m)}function Xm(s,[r,o,u,h]){r=r.evaluate(s),o=o.evaluate(s),u=u.evaluate(s);const m=h?h.evaluate(s):1,g=(function(E,O,D,N){return typeof E=="number"&&E>=0&&E<=360?typeof O=="number"&&O>=0&&O<=100&&typeof D=="number"&&D>=0&&D<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[E,O,D,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[E,O,D,N]:[E,O,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[E,O,D,N]:[E,O,D]).join(", ")}]: 'h' must be between 0 and 360.`})(r,o,u,m);if(g)throw new Bt(g);const b=`hsla(${r}, ${o}%, ${u}%, ${m})`,S=cn.parse(b);if(!S)throw new Bt(`Failed to parse HSLA color: ${b}`);return S}function Km(s,r){return s in r}function cf(s,r){const o=r[s];return o===void 0?null:o}function Kl(s){return{type:s}}function Yl(s){return{result:"success",value:s}}function ol(s){return{result:"error",value:s}}function Ym(s,r){return!!s&&!!s.parameters&&s.parameters.indexOf(r)>-1}function uf(s){return s["property-type"]==="data-driven"}function Jm(s){return Ym(s.expression,"measure-light")}function Qm(s){return Ym(s.expression,"zoom")}function hf(s){return!!s.expression&&s.expression.interpolated}function df(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function eg(s){return s}function ff(s,r){const o=r.type==="color",u=s.stops&&typeof s.stops[0][0]=="object",h=u||!(u||s.property!==void 0),m=s.type||(hf(r)?"exponential":"interval");if(o&&((s=Object.assign({},s)).stops&&(s.stops=s.stops.map((E=>[E[0],cn.parse(E[1])]))),s.default=cn.parse(s.default?s.default:r.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!mv[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let g,b,S;if(m==="exponential")g=yv;else if(m==="interval")g=al;else if(m==="categorical"){g=i1,b=Object.create(null);for(const E of s.stops)b[E[0]]=E[1];S=typeof s.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=o1}if(u){const E={},O=[];for(let B=0;B<s.stops.length;B++){const U=s.stops[B],X=U[0].zoom;E[X]===void 0&&(E[X]={zoom:X,type:s.type,property:s.property,default:s.default,stops:[]},O.push(X)),E[X].stops.push([U[0].value,U[1]])}const D=[];for(const B of O)D.push([E[B].zoom,ff(E[B],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:ta.interpolationFactor.bind(void 0,N),zoomStops:D.map((B=>B[0])),evaluate:({zoom:B},U)=>yv({stops:D,base:s.base},r,B).evaluate(B,U)}}if(h){const E=m==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ta.interpolationFactor.bind(void 0,E),zoomStops:s.stops.map((O=>O[0])),evaluate:({zoom:O})=>g(s,r,O,b,S)}}return{kind:"source",evaluate(E,O){const D=O&&O.properties?O.properties[s.property]:void 0;return D===void 0?ou(s.default,r.default):g(s,r,D,b,S)}}}function ou(s,r,o){return s!==void 0?s:r!==void 0?r:o!==void 0?o:void 0}function i1(s,r,o,u,h){return ou(typeof o===h?u[o]:void 0,s.default,r.default)}function al(s,r,o){if(!fh(o))return ou(s.default,r.default);const u=s.stops.length;if(u===1||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[u-1][0])return s.stops[u-1][1];const h=tf(s.stops.map((m=>m[0])),o);return s.stops[h][1]}function yv(s,r,o){const u=s.base!==void 0?s.base:1;if(!fh(o))return ou(s.default,r.default);const h=s.stops.length;if(h===1||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[h-1][0])return s.stops[h-1][1];const m=tf(s.stops.map((O=>O[0])),o),g=(function(O,D,N,B){const U=B-N,X=O-N;return U===0?0:D===1?X/U:(Math.pow(D,X)-1)/(Math.pow(D,U)-1)})(o,u,s.stops[m][0],s.stops[m+1][0]),b=s.stops[m][1],S=s.stops[m+1][1];let E=Qo[r.type]||eg;if(s.colorSpace&&s.colorSpace!=="rgb"){const O=mv[s.colorSpace];E=(D,N)=>O.reverse(O.interpolate(O.forward(D),O.forward(N),g))}return typeof b.evaluate=="function"?{evaluate(...O){const D=b.evaluate.apply(void 0,O),N=S.evaluate.apply(void 0,O);if(D!==void 0&&N!==void 0)return E(D,N,g)}}:E(b,S,g)}function o1(s,r,o){return r.type==="color"?o=cn.parse(o):r.type==="formatted"?o=xo.fromString(o.toString()):r.type==="resolvedImage"?o=Ro.build(o.toString()):mr(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0),ou(o,s.default,r.default)}bo.register(iu,{error:[{kind:"error"},[un],(s,[r])=>{throw new Bt(r.evaluate(s))}],typeof:[un,[nn],(s,[r])=>bi(Li(r.evaluate(s)))],"to-rgba":[so(Jt,4),[jo],(s,[r])=>r.evaluate(s).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[so(Jt,4),[jo],(s,[r])=>r.evaluate(s).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[jo,[Jt,Jt,Jt],_v],rgba:[jo,[Jt,Jt,Jt,Jt],_v],hsl:[jo,[Jt,Jt,Jt],Xm],hsla:[jo,[Jt,Jt,Jt,Jt],Xm],has:{type:mn,overloads:[[[un],(s,[r])=>Km(r.evaluate(s),s.properties())],[[un,Vl],(s,[r,o])=>Km(r.evaluate(s),o.evaluate(s))]]},get:{type:nn,overloads:[[[un],(s,[r])=>cf(r.evaluate(s),s.properties())],[[un,Vl],(s,[r,o])=>cf(r.evaluate(s),o.evaluate(s))]]},"feature-state":[nn,[un],(s,[r])=>cf(r.evaluate(s),s.featureState||{})],properties:[Vl,[],s=>s.properties()],"geometry-type":[un,[],s=>s.geometryType()],worldview:[un,[],s=>s.globals.worldview||""],id:[nn,[],s=>s.id()],zoom:[Jt,[],s=>s.globals.zoom],pitch:[Jt,[],s=>s.globals.pitch||0],"distance-from-center":[Jt,[],s=>s.distanceFromCenter()],"measure-light":[Jt,[un],(s,[r])=>s.measureLight(r.evaluate(s))],"heatmap-density":[Jt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Jt,[],s=>s.globals.lineProgress||0],"raster-value":[Jt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Jt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Jt,[],s=>s.globals.skyRadialProgress||0],accumulated:[nn,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Jt,Kl(Jt),(s,r)=>{let o=0;for(const u of r)o+=u.evaluate(s);return o}],"*":[Jt,Kl(Jt),(s,r)=>{let o=1;for(const u of r)o*=u.evaluate(s);return o}],"-":{type:Jt,overloads:[[[Jt,Jt],(s,[r,o])=>r.evaluate(s)-o.evaluate(s)],[[Jt],(s,[r])=>-r.evaluate(s)]]},"/":[Jt,[Jt,Jt],(s,[r,o])=>r.evaluate(s)/o.evaluate(s)],"%":[Jt,[Jt,Jt],(s,[r,o])=>r.evaluate(s)%o.evaluate(s)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(s,[r,o])=>Math.pow(r.evaluate(s),o.evaluate(s))],sqrt:[Jt,[Jt],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[Jt,[Jt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[Jt,[Jt],(s,[r])=>Math.log(r.evaluate(s))],log2:[Jt,[Jt],(s,[r])=>Math.log2(r.evaluate(s))],sin:[Jt,[Jt],(s,[r])=>Math.sin(r.evaluate(s))],cos:[Jt,[Jt],(s,[r])=>Math.cos(r.evaluate(s))],tan:[Jt,[Jt],(s,[r])=>Math.tan(r.evaluate(s))],asin:[Jt,[Jt],(s,[r])=>Math.asin(r.evaluate(s))],acos:[Jt,[Jt],(s,[r])=>Math.acos(r.evaluate(s))],atan:[Jt,[Jt],(s,[r])=>Math.atan(r.evaluate(s))],min:[Jt,Kl(Jt),(s,r)=>Math.min(...r.map((o=>o.evaluate(s))))],max:[Jt,Kl(Jt),(s,r)=>Math.max(...r.map((o=>o.evaluate(s))))],abs:[Jt,[Jt],(s,[r])=>Math.abs(r.evaluate(s))],round:[Jt,[Jt],(s,[r])=>{const o=r.evaluate(s);return o<0?-Math.round(-o):Math.round(o)}],floor:[Jt,[Jt],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[Jt,[Jt],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[mn,[un,nn],(s,[r,o])=>s.properties()[r.value]===o.value],"filter-id-==":[mn,[nn],(s,[r])=>s.id()===r.value],"filter-type-==":[mn,[un],(s,[r])=>s.geometryType()===r.value],"filter-<":[mn,[un,nn],(s,[r,o])=>{const u=s.properties()[r.value],h=o.value;return typeof u==typeof h&&u<h}],"filter-id-<":[mn,[nn],(s,[r])=>{const o=s.id(),u=r.value;return typeof o==typeof u&&o<u}],"filter->":[mn,[un,nn],(s,[r,o])=>{const u=s.properties()[r.value],h=o.value;return typeof u==typeof h&&u>h}],"filter-id->":[mn,[nn],(s,[r])=>{const o=s.id(),u=r.value;return typeof o==typeof u&&o>u}],"filter-<=":[mn,[un,nn],(s,[r,o])=>{const u=s.properties()[r.value],h=o.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[mn,[nn],(s,[r])=>{const o=s.id(),u=r.value;return typeof o==typeof u&&o<=u}],"filter->=":[mn,[un,nn],(s,[r,o])=>{const u=s.properties()[r.value],h=o.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[mn,[nn],(s,[r])=>{const o=s.id(),u=r.value;return typeof o==typeof u&&o>=u}],"filter-has":[mn,[nn],(s,[r])=>r.value in s.properties()],"filter-has-id":[mn,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[mn,[so(un)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[mn,[so(nn)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[mn,[un,so(nn)],(s,[r,o])=>o.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[mn,[un,so(nn)],(s,[r,o])=>(function(u,h,m,g){for(;m<=g;){const b=m+g>>1;if(h[b]===u)return!0;h[b]>u?g=b-1:m=b+1}return!1})(s.properties()[r.value],o.value,0,o.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(s,[r,o])=>r.evaluate(s)&&o.evaluate(s)],[Kl(mn),(s,r)=>{for(const o of r)if(!o.evaluate(s))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(s,[r,o])=>r.evaluate(s)||o.evaluate(s)],[Kl(mn),(s,r)=>{for(const o of r)if(o.evaluate(s))return!0;return!1}]]},"!":[mn,[mn],(s,[r])=>!r.evaluate(s)],"is-supported-script":[mn,[un],(s,[r])=>{const o=s.globals&&s.globals.isSupportedScript;return!o||o(r.evaluate(s))}],upcase:[un,[un],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[un,[un],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[un,Kl(nn),(s,r)=>r.map((o=>Do(o.evaluate(s)))).join("")],"resolved-locale":[un,[jd],(s,[r])=>r.evaluate(s).resolvedLocale()],random:[Jt,[Jt,Jt,nn],(s,r)=>{const[o,u,h]=r.map((g=>g.evaluate(s)));if(o>u||o===u)return o;let m;if(typeof h=="string")m=(function(g){let b=0;if(g.length===0)return b;for(let S=0;S<g.length;S++)b=(b<<5)-b+g.charCodeAt(S),b|=0;return b})(h);else{if(typeof h!="number")throw new Bt(`Invalid seed input: ${h}`);m=h}return o+Zm(m)()*(u-o)}]});class pf{constructor(r,o,u,h,m){this.expression=r,this._warningHistory={},this._evaluator=new ws(u,h,m),this._defaultValue=o?(function(g){return g.type==="color"&&(df(g.default)||Array.isArray(g.default))?new cn(0,0,0,0):g.type==="color"?cn.parse(g.default)||null:g.default===void 0?null:g.default})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=Jd(r)}evaluateWithoutErrorHandling(r,o,u,h,m,g,b,S){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(r,o,u,h,m,g,b,S,E){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=E||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new Bt(`Expected value to be one of ${Object.keys(this._enumValues).map((D=>JSON.stringify(D))).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${O.message}`)),this._defaultValue}}}function tg(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in iu}function Ka(s,r,o,u,h){const m=new ef(iu,[],r?(function(b){const S={color:jo,string:un,number:Jt,enum:un,boolean:mn,formatted:Qs,resolvedImage:sh};return b.type==="array"?so(S[b.value]||nn,b.length):S[b.type]})(r):void 0,void 0,void 0,o,u,h),g=m.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Yl(new pf(g,r,o,u,h)):ol(m.errors)}class wh{constructor(r,o,u,h){this.kind=r,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=r!=="constant"&&!Yd(o.expression),this.configDependencies=Jd(o.expression)}evaluateWithoutErrorHandling(r,o,u,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,h,m,g)}evaluate(r,o,u,h,m,g,b){return this._styleExpression.evaluate(r,o,u,h,m,g,void 0,void 0,b)}}class sl{constructor(r,o,u,h,m,g){this.kind=r,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!Yd(o.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=Jd(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,o,u,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,h,m,g)}evaluate(r,o,u,h,m,g){return this._styleExpression.evaluate(r,o,u,h,m,g)}interpolationFactor(r,o,u){return this.interpolationType?ta.interpolationFactor(this.interpolationType,r,o,u):0}}function rg(s,r,o,u,h){if((s=Ka(s,r,o,u,h)).result==="error")return s;const m=s.value.expression,g=eu(m);if(!g&&!uf(r))return ol([new Sa("","data expressions not supported")]);const b=tu(m,["zoom","pitch","distance-from-center"]);if(!b&&!Qm(r))return ol([new Sa("","zoom expressions not supported")]);const S=tu(m,["measure-light"]);if(!S&&!Jm(r))return ol([new Sa("","measure-light expression not supported")]);const E=tu(m,["line-progress"]);if(!E&&!(function(N){return Ym(N.expression,"line-progress")})(r))return ol([new Sa("","line-progress expression not supported")]);const O=r.expression&&r.expression.relaxZoomRestriction,D=gf(m);return D||b||O?D instanceof Sa?ol([D]):D instanceof ta&&!hf(r)?ol([new Sa("",'"interpolate" expressions cannot be used with this property')]):Yl(D?new sl(g&&E?"camera":"composite",s.value,D.labels,D instanceof ta?D.interpolation:void 0,S,E):new wh(g&&E?"constant":"source",s.value,S,E)):ol([new Sa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mf{constructor(r,o){this._parameters=r,this._specification=o,Object.assign(this,ff(this._parameters,this._specification))}static deserialize(r){return new mf(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function gf(s){let r=null;if(s instanceof af)r=gf(s.result);else if(s instanceof vh){for(const o of s.args)if(r=gf(o),r)break}else(s instanceof yh||s instanceof ta)&&s.input instanceof bo&&s.input.name==="zoom"&&(r=s);return r instanceof Sa||s.eachChild((o=>{const u=gf(o);u instanceof Sa?r=u:r&&u&&r!==u&&(r=new Sa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}var Sh,_f,vv=(function(){if(_f)return Sh;_f=1,Sh=r;var s=3;function r(o,u,h){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var g=new Int32Array(this.arrayBuffer);o=g[0],this.d=(u=g[1])+2*(h=g[2]);for(var b=0;b<this.d*this.d;b++){var S=g[s+b],E=g[s+b+1];m.push(S===E?null:g.subarray(S,E))}var O=g[s+m.length+1];this.keys=g.subarray(g[s+m.length],O),this.bboxes=g.subarray(O),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var D=0;D<this.d*this.d;D++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=h,this.scale=u/o,this.uid=0;var N=h/u*o;this.min=-N,this.max=o+N}return r.prototype.insert=function(o,u,h,m,g){this._forEachCell(u,h,m,g,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(o,u,h,m,g,b){this.cells[g].push(b)},r.prototype.query=function(o,u,h,m,g){var b=this.min,S=this.max;if(o<=b&&u<=b&&S<=h&&S<=m&&!g)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(o,u,h,m,this._queryCell,E,{},g),E},r.prototype._queryCell=function(o,u,h,m,g,b,S,E){var O=this.cells[g];if(O!==null)for(var D=this.keys,N=this.bboxes,B=0;B<O.length;B++){var U=O[B];if(S[U]===void 0){var X=4*U;(E?E(N[X+0],N[X+1],N[X+2],N[X+3]):o<=N[X+2]&&u<=N[X+3]&&h>=N[X+0]&&m>=N[X+1])?(S[U]=!0,b.push(D[U])):S[U]=!1}}},r.prototype._forEachCell=function(o,u,h,m,g,b,S,E){for(var O=this._convertToCellCoord(o),D=this._convertToCellCoord(u),N=this._convertToCellCoord(h),B=this._convertToCellCoord(m),U=O;U<=N;U++)for(var X=D;X<=B;X++){var Q=this.d*X+U;if((!E||E(this._convertFromCellCoord(U),this._convertFromCellCoord(X),this._convertFromCellCoord(U+1),this._convertFromCellCoord(X+1)))&&g.call(this,o,u,h,m,Q,b,S,E))return}},r.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},r.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=s+this.cells.length+1+1,h=0,m=0;m<this.cells.length;m++)h+=this.cells[m].length;var g=new Int32Array(u+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=u,S=0;S<o.length;S++){var E=o[S];g[s+S]=b,g.set(E,b),b+=E.length}return g[s+o.length]=b,g.set(this.keys,b),g[s+o.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},Sh})(),Jl=Yu(vv);const au={};function Ut(s,r,o={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writable:!1}),au[r]={klass:s,omit:o.omit||[]}}Ut(Object,"Object"),Jl.serialize=function(s,r){const o=s.toArrayBuffer();return r&&r.add(o),{buffer:o}},Jl.deserialize=function(s){return new Jl(s.buffer)},Object.defineProperty(Jl,"name",{value:"Grid"}),Ut(Jl,"Grid"),delete wt.prototype.constructor,typeof DOMMatrix<"u"&&Ut(DOMMatrix,"DOMMatrix"),Ut(cn,"Color"),Ut(Error,"Error"),Ut(xo,"Formatted"),Ut(zd,"FormattedSection"),Ut(vm,"AJAXError"),Ut(Ro,"ResolvedImage"),Ut(mf,"StylePropertyFunction"),Ut(pf,"StyleExpression",{omit:["_evaluator"]}),Ut(Jo,"ImageId"),Ut(Ta,"ImageVariant"),Ut(sl,"ZoomDependentExpression"),Ut(wh,"ZoomConstantExpression"),Ut(bo,"CompoundExpression",{omit:["_evaluate"]});for(const s in iu)au[iu[s]._classRegistryKey]||Ut(iu[s],`Expression${s}`);function ng(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Ss(s){return self.ImageBitmap&&s instanceof ImageBitmap}function ll(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(ng(s)||Ss(s))return r&&r.add(s),s;if(ArrayBuffer.isView(s))return r&&r.add(s.buffer),s;if(s instanceof ImageData)return r&&r.add(s.data.buffer),s;if(Array.isArray(s)){const o=[];for(const u of s)o.push(ll(u,r));return o}if(s instanceof Map){const o={$name:"Map",entries:[]};for(const[u,h]of s.entries())o.entries.push(ll(u),ll(h,r));return o}if(s instanceof Set){const o={$name:"Set"};let u=0;for(const h of s.values())o[++u]=ll(h);return o}if(s instanceof DOMMatrix){const o={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of u)o[h]=s[h];return o}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const o=s.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const h=o.serialize?o.serialize(s,r):{};if(!o.serialize){for(const m in s)s.hasOwnProperty(m)&&(au[u].omit.indexOf(m)>=0||(h[m]=ll(s[m],r)));s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof s)}function cl(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||ng(s)||Ss(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(cl);if(typeof s=="object"){const r=s.$name||"Object";if(r==="Map"){const h=s.entries||[],m=new Map;for(let g=0;g<h.length;g+=2)m.set(cl(h[g]),cl(h[g+1]));return m}if(r==="Set"){const h=new Set;for(const m of Object.keys(s))m!=="$name"&&h.add(cl(s[m]));return h}if(r==="DOMMatrix"){let h;return h=s.is2D?[s.a,s.b,s.c,s.d,s.e,s.f]:[s.m11,s.m12,s.m13,s.m14,s.m21,s.m22,s.m23,s.m24,s.m31,s.m32,s.m33,s.m34,s.m41,s.m42,s.m43,s.m44],new DOMMatrix(h)}if(r==="BigInt")return BigInt(s.value);const{klass:o}=au[r];if(!o)throw new Error(`Can't deserialize unregistered class "${r}".`);if(o.deserialize)return o.deserialize(s);const u=Object.create(o.prototype);for(const h of Object.keys(s))h!=="$name"&&(u[h]=cl(s[h]));return u}throw new Error("can't deserialize object of type "+typeof s)}const sr={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function ig(s){for(const r of s)if(vf(r.charCodeAt(0)))return!0;return!1}function xv(s){for(const r of s)if(!yf(r.charCodeAt(0)))return!1;return!0}function yf(s){return!(sr.Arabic(s)||sr["Arabic Supplement"](s)||sr["Arabic Extended-A"](s)||sr["Arabic Presentation Forms-A"](s)||sr["Arabic Presentation Forms-B"](s))}function vf(s){return!(s!==746&&s!==747&&(s<4352||!(sr["Bopomofo Extended"](s)||sr.Bopomofo(s)||sr["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||sr["CJK Compatibility Ideographs"](s)||sr["CJK Compatibility"](s)||sr["CJK Radicals Supplement"](s)||sr["CJK Strokes"](s)||!(!sr["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||sr["CJK Unified Ideographs Extension A"](s)||sr["CJK Unified Ideographs"](s)||sr["Enclosed CJK Letters and Months"](s)||sr["Hangul Compatibility Jamo"](s)||sr["Hangul Jamo Extended-A"](s)||sr["Hangul Jamo Extended-B"](s)||sr["Hangul Jamo"](s)||sr["Hangul Syllables"](s)||sr.Hiragana(s)||sr["Ideographic Description Characters"](s)||sr.Kanbun(s)||sr["Kangxi Radicals"](s)||sr["Katakana Phonetic Extensions"](s)||sr.Katakana(s)&&s!==12540||!(!sr["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!sr["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||sr["Unified Canadian Aboriginal Syllabics"](s)||sr["Unified Canadian Aboriginal Syllabics Extended"](s)||sr["Vertical Forms"](s)||sr["Yijing Hexagram Symbols"](s)||sr["Yi Syllables"](s)||sr["Yi Radicals"](s))))}function xf(s){return!(vf(s)||(function(r){return!!(sr["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||sr["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||sr["Letterlike Symbols"](r)||sr["Number Forms"](r)||sr["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||sr["Control Pictures"](r)&&r!==9251||sr["Optical Character Recognition"](r)||sr["Enclosed Alphanumerics"](r)||sr["Geometric Shapes"](r)||sr["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||sr["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||sr["CJK Symbols and Punctuation"](r)||sr.Katakana(r)||sr["Private Use Area"](r)||sr["CJK Compatibility Forms"](r)||sr["Small Form Variants"](r)||sr["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(s))}function a1(s){return sr.Arabic(s)||sr["Arabic Supplement"](s)||sr["Arabic Extended-A"](s)||sr["Arabic Presentation Forms-A"](s)||sr["Arabic Presentation Forms-B"](s)}function bv(s){return s>=1424&&s<=2303||sr["Arabic Presentation Forms-A"](s)||sr["Arabic Presentation Forms-B"](s)}function s1(s,r){return!(!r&&bv(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||sr.Khmer(s))}function l1(s){for(const r of s)if(bv(r.charCodeAt(0)))return!0;return!1}const zo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let og=null,wo=zo.unavailable,ul=null;const wv=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(wo=zo.error),og&&og(s)};function ag(){sg.fire(new wa("pluginStateChange",{pluginStatus:wo,pluginURL:ul}))}const sg=new Ul,bf=function(){return wo},Ql=function(){if(wo!==zo.deferred||!ul)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wo=zo.loading,ag(),ul&&Vc({url:ul},(s=>{s?wv(s):(wo=zo.loaded,ag())}))},Ya={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>wo===zo.loaded||Ya.applyArabicShaping!=null,isLoading:()=>wo===zo.loading,setState(s){wo=s.pluginStatus,ul=s.pluginURL},isParsing:()=>wo===zo.parsing,isParsed:()=>wo===zo.parsed,getPluginURL:()=>ul};class Cn{constructor(r,o){this.zoom=r,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness,this.worldview=o.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return(function(o,u){for(const h of o)if(!s1(h.charCodeAt(0),u))return!1;return!0})(r,Ya.isLoaded())}}class ec{constructor(r,o,u,h,m){this.property=r,this.value=o,this.expression=(function(g,b,S,E,O){if(df(g))return new mf(g,b);if(tg(g)||Array.isArray(g)&&g.length>0){const D=rg(g,b,S,E,O);if(D.result==="error")throw new Error(D.value.map((N=>`${N.key}: ${N.message}`)).join(", "));return D.value}{let D=g;return typeof g=="string"&&b.type==="color"&&(D=cn.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}})(o===void 0?r.specification.default:o,r.specification,u,h,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,o,u,h){return this.property.possiblyEvaluate(this,r,o,u,h)}}class lg{constructor(r,o,u,h){this.property=r,this.value=new ec(r,void 0,o,u,h)}transitioned(r,o){return new Ts(this.property,this.value,o,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new Ts(this.property,this.value,null,{},0)}}class Sv{constructor(r,o,u,h){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(r){return Br(this._values[r].value.value)}setValue(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new lg(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new ec(this._values[r].property,o===null?void 0:Br(o),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,o){o&&(this._options=o);const u=this._properties.properties;if(r)for(const h in r){const m=r[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);u[g]&&this.setTransition(g,m)}else u.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(r){return Br(this._values[r].transition)}setTransition(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new lg(this._values[r].property)),this._values[r].transition=Br(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u);const h=this.getTransition(o);h!==void 0&&(r[`${o}-transition`]=h)}return r}transitioned(r,o){const u=new cg(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(r,o._values[h]);return u}untransitioned(){const r=new cg(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class Ts{constructor(r,o,u,h,m){const g=h.delay||0,b=h.duration||0;m=m||0,this.property=r,this.value=o,this.begin=m+g,this.end=this.begin+b,r.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(r,o,u){const h=r.now||0,m=this.value.possiblyEvaluate(r,o,u),g=this.prior;if(g){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return g.possiblyEvaluate(r,o,u);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(r,o,u),m,ye(b))}}return m}}class cg{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,u){const h=new nc(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,o,u);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class tc{constructor(r,o,u,h){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=o,this._options=u,this._iconImageUseTheme=h,this.configDependencies=new Set}getValue(r){return Br(this._values[r].value)}setValue(r,o){this._values[r]=new ec(this._values[r].property,o===null?void 0:Br(o),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u)}return r}possiblyEvaluate(r,o,u,h){const m=new nc(this._properties);for(const g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(r,o,u,h);return m}}class rc{constructor(r,o,u,h){this.property=r,this.value=o,this.parameters=u,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,u,h){return this.property.evaluate(this.value,this.parameters,r,o,u,h,this.iconImageUseTheme)}}class nc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Tt{constructor(r){this.specification=r}possiblyEvaluate(r,o){return r.expression.evaluate(o)}interpolate(r,o,u){const h=Qo[this.specification.type];return h?h(r,o,u):r}}class Nt{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,u,h,m){return r.expression.kind==="constant"||r.expression.kind==="camera"?new rc(this,{kind:"constant",value:r.expression.evaluate(o,null,{},u,h,void 0,m)},o):new rc(this,r.expression,o,m)}interpolate(r,o,u){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new rc(this,{kind:"constant",value:void 0},r.parameters);const h=Qo[this.specification.type];return h?new rc(this,{kind:"constant",value:h(r.value.value,o.value.value,u)},r.parameters):r}evaluate(r,o,u,h,m,g,b){return r.kind==="constant"?r.value:r.evaluate(o,u,h,m,g,void 0,b)}}class su{constructor(r){this.specification=r}possiblyEvaluate(r,o,u,h){return!!r.expression.evaluate(o,null,{},u,h)}interpolate(){return!1}}class Xn{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Cn(0,{});for(const u in r){const h=r[u];h.specification.overridable&&this.overridableProperties.push(u);const m=this.defaultPropertyValues[u]=new ec(h,void 0),g=this.defaultTransitionablePropertyValues[u]=new lg(h);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(o)}}}Ut(Nt,"DataDrivenProperty"),Ut(Tt,"DataConstantProperty"),Ut(su,"ColorRampProperty");var Be=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function wf(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ic(s){if(Array.isArray(s))return s.map(ic);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const o in s)r[o]=ic(s[o]);return r}return wf(s)}function Sf(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Sf(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Th(s,r="",o=null,u="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Sf(s)||(s=Tf(s));const h=s;let m=!0;try{m=(function(O){if(!lu(O))return O;let D=ic(O);return Ea(D),D=Tv(D),D})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=Be[`filter_${u}`];const O=Ka(m,b,r,o);if(O.result==="error")throw new Error(O.value.map((D=>`${D.key}: ${D.message}`)).join(", "));g=(D,N,B)=>O.value.evaluate(D,N,{},B)}let S=null,E=null;if(m!==h){const O=Ka(h,b,r,o);if(O.result==="error")throw new Error(O.value.map((D=>`${D.key}: ${D.message}`)).join(", "));S=(D,N,B,U,X)=>O.value.evaluate(D,N,{},B,void 0,void 0,U,X),E=!eu(O.value.expression)}return{filter:g,dynamicFilter:S||void 0,needGeometry:Ev(m),needFeature:!!E}}function Tv(s){if(!Array.isArray(s))return s;const r=(function(o){if(Av.has(o[0])){for(let u=1;u<o.length;u++)if(lu(o[u]))return!0}return o})(s);return r===!0?r:r.map((o=>Tv(o)))}function Ea(s){let r=!1;const o=[];if(s[0]==="case"){for(let u=1;u<s.length-1;u+=2)r=r||lu(s[u]),o.push(s[u+1]);o.push(s[s.length-1])}else if(s[0]==="match"){r=r||lu(s[1]);for(let u=2;u<s.length-1;u+=2)o.push(s[u+1]);o.push(s[s.length-1])}else if(s[0]==="step"){r=r||lu(s[1]);for(let u=1;u<s.length-1;u+=2)o.push(s[u+1])}r&&(s.length=0,s.push("any",...o));for(let u=1;u<s.length;u++)Ea(s[u])}function lu(s){if(!Array.isArray(s))return!1;if((r=s[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let o=1;o<s.length;o++)if(lu(s[o]))return!0;return!1}const Av=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function c1(s,r){return s<r?-1:s>r?1:0}function Ev(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let r=1;r<s.length;r++)if(Ev(s[r]))return!0;return!1}function Tf(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?ug(s[1],s[2],"=="):r==="!="?Af(ug(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ug(s[1],s[2],r):r==="any"?(o=s.slice(1),["any"].concat(o.map(Tf))):r==="all"?["all"].concat(s.slice(1).map(Tf)):r==="none"?["all"].concat(s.slice(1).map(Tf).map(Af)):r==="in"?Pv(s[1],s.slice(2)):r==="!in"?Af(Pv(s[1],s.slice(2))):r==="has"?Iv(s[1]):r!=="!has"||Af(Iv(s[1]));var o}function ug(s,r,o){switch(s){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,s,r]}}function Pv(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((o=>typeof o!=typeof r[0]))?["filter-in-large",s,["literal",r.sort(c1)]]:["filter-in-small",s,["literal",r]]}}function Iv(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Af(s){return["!",s]}const Ah="";function cu(s,r){return r?`${s}${Ah}${r}`:s}let hg;const Cv=()=>hg||(hg=new Xn({"icon-size":new Nt(Be.layout_symbol["icon-size"]),"icon-image":new Nt(Be.layout_symbol["icon-image"]),"icon-rotate":new Nt(Be.layout_symbol["icon-rotate"]),"icon-offset":new Nt(Be.layout_symbol["icon-offset"])}));class u1{constructor(r,o,u,h,m,g){const b=Ka(r,Be.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=o,u){this.properties=new nc(Cv()),this.unevaluatedLayout=new tc(Cv(),h,m,g);for(const S in u)this.unevaluatedLayout.setValue(S,u[S])}}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.properties&&(r.properties=this.properties),r}}const Ov="-transition",Mv=new Set(["fill","line","background","hillshade","raster"]);class lo extends Ul{constructor(r,o,u,h,m,g){if(super(),this.id=r.id,this.fqid=cu(this.id,u),this.type=r.type,this.scope=u,this.lut=h,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const b=Ka(this.filter,Be[`filter_${r.type}`]);b.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...b.value.configDependencies]))}if(r.slot&&(this.slot=r.slot),r.appearances&&r.appearances.forEach((b=>{this.appearances.push(new u1(b.condition,b.name,b.properties,this.scope,m,this.iconImageUseTheme))})),o.layout&&(this._unevaluatedLayout=new tc(o.layout,this.scope,m,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new Sv(o.paint,this.scope,m);for(const b in r.paint)this.setPaintProperty(b,r.paint[b]);for(const b in r.layout)this.setLayoutProperty(b,r.layout[b]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nc(o.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&Mv.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,o){if(this.type==="custom"&&r==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(Ov)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o){const u=this._transitionablePaint,h=u._properties.properties;if(r.endsWith(Ov)){const D=r.slice(0,-11);return h[D]&&u.setTransition(D,o||void 0),!1}if(!h[r])return!1;const m=u._values[r],g=m.value.isDataDriven(),b=m.value;u.setValue(r,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const S=u._values[r].value,E=S.isDataDriven(),O=r.endsWith("pattern")||r==="line-dasharray";return E||g||O||this._handleOverridablePaintPropertyUpdate(r,b,S)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,o,u){return null}_handleOverridablePaintPropertyUpdate(r,o,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map((o=>o.serialize()))),Ur(r,((o,u)=>!(o===void 0||u==="layout"&&!Object.keys(o).length||u==="paint"&&!Object.keys(o).length)))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof rc&&uf(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Th(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(r){}queryIntersectsFeature(r,o,u,h,m,g,b,S,E){}}const hl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class uu{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jn{constructor(){this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&o.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qr(s,r=1){let o=0,u=0;return{members:s.map((h=>{const m=hl[h.type].BYTES_PER_ELEMENT,g=o=Rv(o,Math.max(r,m)),b=h.components||1;return u=Math.max(u,m),o+=m*b,{name:h.name,type:h.type,components:b,offset:g}})),size:Rv(o,Math.max(u,r)),alignment:r}}function Rv(s,r){return Math.ceil(s/r)*r}class dl extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const h=2*r;return this.int16[h+0]=o,this.int16[h+1]=u,r}}dl.prototype.bytesPerElement=4,Ut(dl,"StructArrayLayout2i4");class oc extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u)}emplace(r,o,u,h){const m=3*r;return this.int16[m+0]=o,this.int16[m+1]=u,this.int16[m+2]=h,r}}oc.prototype.bytesPerElement=6,Ut(oc,"StructArrayLayout3i6");class ac extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,h)}emplace(r,o,u,h,m){const g=4*r;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=h,this.int16[g+3]=m,r}}ac.prototype.bytesPerElement=8,Ut(ac,"StructArrayLayout4i8");class fl extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}fl.prototype.bytesPerElement=4,Ut(fl,"StructArrayLayout1f4");class dg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u)}emplace(r,o,u,h){const m=4*r,g=2*r;return this.int16[m+0]=o,this.int16[m+1]=u,this.float32[g+1]=h,r}}dg.prototype.bytesPerElement=8,Ut(dg,"StructArrayLayout2i1f8");class Ef extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u)}emplace(r,o,u,h){const m=4*r;return this.int16[m+0]=o,this.int16[m+1]=u,this.int16[m+2]=h,r}}Ef.prototype.bytesPerElement=8,Ut(Ef,"StructArrayLayout3i8");class fg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,h,m)}emplace(r,o,u,h,m,g){const b=5*r;return this.int16[b+0]=o,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=m,this.int16[b+4]=g,r}}fg.prototype.bytesPerElement=10,Ut(fg,"StructArrayLayout5i10");class Pf extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b){const S=this.length;return this.resize(S+1),this.emplace(S,r,o,u,h,m,g,b)}emplace(r,o,u,h,m,g,b,S){const E=6*r,O=12*r,D=3*r;return this.int16[E+0]=o,this.int16[E+1]=u,this.uint8[O+4]=h,this.uint8[O+5]=m,this.uint8[O+6]=g,this.uint8[O+7]=b,this.float32[D+2]=S,r}}Pf.prototype.bytesPerElement=12,Ut(Pf,"StructArrayLayout2i4ub1f12");class ko extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u)}emplace(r,o,u,h){const m=3*r;return this.float32[m+0]=o,this.float32[m+1]=u,this.float32[m+2]=h,r}}ko.prototype.bytesPerElement=12,Ut(ko,"StructArrayLayout3f12");class pl extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,h,m)}emplace(r,o,u,h,m,g){const b=6*r,S=3*r;return this.uint16[b+0]=o,this.uint16[b+1]=u,this.uint16[b+2]=h,this.uint16[b+3]=m,this.float32[S+2]=g,r}}pl.prototype.bytesPerElement=12,Ut(pl,"StructArrayLayout4ui1f12");class hu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,h)}emplace(r,o,u,h,m){const g=4*r;return this.uint16[g+0]=o,this.uint16[g+1]=u,this.uint16[g+2]=h,this.uint16[g+3]=m,r}}hu.prototype.bytesPerElement=8,Ut(hu,"StructArrayLayout4ui8");class If extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,h,m,g)}emplace(r,o,u,h,m,g,b){const S=6*r;return this.int16[S+0]=o,this.int16[S+1]=u,this.int16[S+2]=h,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=b,r}}If.prototype.bytesPerElement=12,Ut(If,"StructArrayLayout6i12");class pg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E,O,D,N){const B=this.length;return this.resize(B+1),this.emplace(B,r,o,u,h,m,g,b,S,E,O,D,N)}emplace(r,o,u,h,m,g,b,S,E,O,D,N,B){const U=12*r;return this.int16[U+0]=o,this.int16[U+1]=u,this.int16[U+2]=h,this.int16[U+3]=m,this.uint16[U+4]=g,this.uint16[U+5]=b,this.uint16[U+6]=S,this.uint16[U+7]=E,this.int16[U+8]=O,this.int16[U+9]=D,this.int16[U+10]=N,this.int16[U+11]=B,r}}pg.prototype.bytesPerElement=24,Ut(pg,"StructArrayLayout4i4ui4i24");class mg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,h,m,g)}emplace(r,o,u,h,m,g,b){const S=10*r,E=5*r;return this.int16[S+0]=o,this.int16[S+1]=u,this.int16[S+2]=h,this.float32[E+2]=m,this.float32[E+3]=g,this.float32[E+4]=b,r}}mg.prototype.bytesPerElement=20,Ut(mg,"StructArrayLayout3i3f20");class Pa extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,h)}emplace(r,o,u,h,m){const g=4*r;return this.float32[g+0]=o,this.float32[g+1]=u,this.float32[g+2]=h,this.float32[g+3]=m,r}}Pa.prototype.bytesPerElement=16,Ut(Pa,"StructArrayLayout4f16");class du extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}du.prototype.bytesPerElement=4,Ut(du,"StructArrayLayout1ul4");class wi extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const h=2*r;return this.uint16[h+0]=o,this.uint16[h+1]=u,r}}wi.prototype.bytesPerElement=4,Ut(wi,"StructArrayLayout2ui4");class fu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E,O,D,N,B){const U=this.length;return this.resize(U+1),this.emplace(U,r,o,u,h,m,g,b,S,E,O,D,N,B)}emplace(r,o,u,h,m,g,b,S,E,O,D,N,B,U){const X=20*r,Q=10*r;return this.int16[X+0]=o,this.int16[X+1]=u,this.int16[X+2]=h,this.int16[X+3]=m,this.int16[X+4]=g,this.float32[Q+3]=b,this.float32[Q+4]=S,this.float32[Q+5]=E,this.float32[Q+6]=O,this.int16[X+14]=D,this.uint32[Q+8]=N,this.uint16[X+18]=B,this.uint16[X+19]=U,r}}fu.prototype.bytesPerElement=40,Ut(fu,"StructArrayLayout5i4f1i1ul2ui40");class Cf extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b){const S=this.length;return this.resize(S+1),this.emplace(S,r,o,u,h,m,g,b)}emplace(r,o,u,h,m,g,b,S){const E=8*r;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=m,this.int16[E+5]=g,this.int16[E+6]=b,this.int16[E+7]=S,r}}Cf.prototype.bytesPerElement=16,Ut(Cf,"StructArrayLayout3i2i2i16");class gg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,h,m)}emplace(r,o,u,h,m,g){const b=4*r,S=8*r;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=h,this.int16[S+6]=m,this.int16[S+7]=g,r}}gg.prototype.bytesPerElement=16,Ut(gg,"StructArrayLayout2f1f2i16");class _g extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,h,m,g)}emplace(r,o,u,h,m,g,b){const S=20*r,E=5*r;return this.uint8[S+0]=o,this.uint8[S+1]=u,this.float32[E+1]=h,this.float32[E+2]=m,this.float32[E+3]=g,this.float32[E+4]=b,r}}_g.prototype.bytesPerElement=20,Ut(_g,"StructArrayLayout2ub4f20");class Oi extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u)}emplace(r,o,u,h){const m=3*r;return this.uint16[m+0]=o,this.uint16[m+1]=u,this.uint16[m+2]=h,r}}Oi.prototype.bytesPerElement=6,Ut(Oi,"StructArrayLayout3ui6");class Eh extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he,pe,Ae){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he,pe,Ae)}emplace(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he,pe,Ae,Ee){const Oe=30*r,De=15*r,Le=60*r;return this.int16[Oe+0]=o,this.int16[Oe+1]=u,this.int16[Oe+2]=h,this.float32[De+2]=m,this.float32[De+3]=g,this.uint16[Oe+8]=b,this.uint16[Oe+9]=S,this.uint32[De+5]=E,this.uint32[De+6]=O,this.uint32[De+7]=D,this.uint16[Oe+16]=N,this.uint16[Oe+17]=B,this.uint16[Oe+18]=U,this.float32[De+10]=X,this.float32[De+11]=Q,this.uint8[Le+48]=ee,this.uint8[Le+49]=ue,this.uint8[Le+50]=he,this.uint32[De+13]=pe,this.int16[Oe+28]=Ae,this.uint8[Le+58]=Ee,r}}Eh.prototype.bytesPerElement=60,Ut(Eh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class yg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he,pe,Ae,Ee,Oe,De,Le,ct,Ue,ut,_t,ht,ft,bt,st){const mt=this.length;return this.resize(mt+1),this.emplace(mt,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he,pe,Ae,Ee,Oe,De,Le,ct,Ue,ut,_t,ht,ft,bt,st)}emplace(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he,pe,Ae,Ee,Oe,De,Le,ct,Ue,ut,_t,ht,ft,bt,st,mt){const Ke=20*r,Ge=40*r,St=80*r;return this.float32[Ke+0]=o,this.float32[Ke+1]=u,this.int16[Ge+4]=h,this.int16[Ge+5]=m,this.int16[Ge+6]=g,this.int16[Ge+7]=b,this.int16[Ge+8]=S,this.int16[Ge+9]=E,this.int16[Ge+10]=O,this.int16[Ge+11]=D,this.int16[Ge+12]=N,this.uint16[Ge+13]=B,this.uint16[Ge+14]=U,this.uint16[Ge+15]=X,this.uint16[Ge+16]=Q,this.uint16[Ge+17]=ee,this.uint16[Ge+18]=ue,this.uint16[Ge+19]=he,this.uint16[Ge+20]=pe,this.uint16[Ge+21]=Ae,this.uint16[Ge+22]=Ee,this.uint16[Ge+23]=Oe,this.uint16[Ge+24]=De,this.uint16[Ge+25]=Le,this.uint16[Ge+26]=ct,this.uint16[Ge+27]=Ue,this.uint32[Ke+14]=ut,this.float32[Ke+15]=_t,this.float32[Ke+16]=ht,this.float32[Ke+17]=ft,this.float32[Ke+18]=bt,this.uint8[St+76]=st,this.uint16[Ge+39]=mt,r}}yg.prototype.bytesPerElement=80,Ut(yg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ph extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g){const b=this.length;return this.resize(b+1),this.emplace(b,r,o,u,h,m,g)}emplace(r,o,u,h,m,g,b){const S=6*r;return this.float32[S+0]=o,this.float32[S+1]=u,this.float32[S+2]=h,this.float32[S+3]=m,this.float32[S+4]=g,this.float32[S+5]=b,r}}Ph.prototype.bytesPerElement=24,Ut(Ph,"StructArrayLayout6f24");class sc extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,r,o,u,h,m)}emplace(r,o,u,h,m,g){const b=5*r;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=m,this.float32[b+4]=g,r}}sc.prototype.bytesPerElement=20,Ut(sc,"StructArrayLayout5f20");class vg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b){const S=this.length;return this.resize(S+1),this.emplace(S,r,o,u,h,m,g,b)}emplace(r,o,u,h,m,g,b,S){const E=7*r;return this.float32[E+0]=o,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=m,this.float32[E+4]=g,this.float32[E+5]=b,this.float32[E+6]=S,r}}vg.prototype.bytesPerElement=28,Ut(vg,"StructArrayLayout7f28");class Of extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E,O,D){const N=this.length;return this.resize(N+1),this.emplace(N,r,o,u,h,m,g,b,S,E,O,D)}emplace(r,o,u,h,m,g,b,S,E,O,D,N){const B=11*r;return this.float32[B+0]=o,this.float32[B+1]=u,this.float32[B+2]=h,this.float32[B+3]=m,this.float32[B+4]=g,this.float32[B+5]=b,this.float32[B+6]=S,this.float32[B+7]=E,this.float32[B+8]=O,this.float32[B+9]=D,this.float32[B+10]=N,r}}Of.prototype.bytesPerElement=44,Ut(Of,"StructArrayLayout11f44");class Ih extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E){const O=this.length;return this.resize(O+1),this.emplace(O,r,o,u,h,m,g,b,S,E)}emplace(r,o,u,h,m,g,b,S,E,O){const D=9*r;return this.float32[D+0]=o,this.float32[D+1]=u,this.float32[D+2]=h,this.float32[D+3]=m,this.float32[D+4]=g,this.float32[D+5]=b,this.float32[D+6]=S,this.float32[D+7]=E,this.float32[D+8]=O,r}}Ih.prototype.bytesPerElement=36,Ut(Ih,"StructArrayLayout9f36");class pu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const h=2*r;return this.float32[h+0]=o,this.float32[h+1]=u,r}}pu.prototype.bytesPerElement=8,Ut(pu,"StructArrayLayout2f8");class Mf extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,h)}emplace(r,o,u,h,m){const g=6*r;return this.uint32[3*r+0]=o,this.uint16[g+2]=u,this.uint16[g+3]=h,this.uint16[g+4]=m,r}}Mf.prototype.bytesPerElement=12,Ut(Mf,"StructArrayLayout1ul3ui12");class Rf extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}Rf.prototype.bytesPerElement=2,Ut(Rf,"StructArrayLayout1ui2");class xg extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q){const ee=this.length;return this.resize(ee+1),this.emplace(ee,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q)}emplace(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee){const ue=16*r;return this.float32[ue+0]=o,this.float32[ue+1]=u,this.float32[ue+2]=h,this.float32[ue+3]=m,this.float32[ue+4]=g,this.float32[ue+5]=b,this.float32[ue+6]=S,this.float32[ue+7]=E,this.float32[ue+8]=O,this.float32[ue+9]=D,this.float32[ue+10]=N,this.float32[ue+11]=B,this.float32[ue+12]=U,this.float32[ue+13]=X,this.float32[ue+14]=Q,this.float32[ue+15]=ee,r}}xg.prototype.bytesPerElement=64,Ut(xg,"StructArrayLayout16f64");class mu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,h,m,g,b){const S=this.length;return this.resize(S+1),this.emplace(S,r,o,u,h,m,g,b)}emplace(r,o,u,h,m,g,b,S){const E=10*r,O=5*r;return this.uint16[E+0]=o,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=m,this.float32[O+2]=g,this.float32[O+3]=b,this.float32[O+4]=S,r}}mu.prototype.bytesPerElement=20,Ut(mu,"StructArrayLayout4ui3f20");class gu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.int16[1*r+0]=o,r}}gu.prototype.bytesPerElement=2,Ut(gu,"StructArrayLayout1i2");class Df extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint8[1*r+0]=o,r}}Df.prototype.bytesPerElement=1,Ut(Df,"StructArrayLayout1ub1");class Dv extends uu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Dv.prototype.size=40;class bg extends fu{get(r){return new Dv(this,r)}}Ut(bg,"CollisionBoxArray");class kv extends uu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}kv.prototype.size=60;class kf extends Eh{get(r){return new kv(this,r)}}Ut(kf,"PlacedSymbolArray");class Nv extends uu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Nv.prototype.size=80;class Lv extends yg{get(r){return new Nv(this,r)}}Ut(Lv,"SymbolInstanceArray");class jv extends fl{getoffsetX(r){return this.float32[1*r+0]}}Ut(jv,"GlyphOffsetArray");class zv extends dl{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Ut(zv,"SymbolLineVertexArray");class wg extends uu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}wg.prototype.size=12;class Fv extends Mf{get(r){return new wg(this,r)}}Ut(Fv,"FeatureIndexArray");class Bv extends wi{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Ut(Bv,"FillExtrusionCentroidArray");class Uv extends uu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Uv.prototype.size=6;class Vv extends oc{get(r){return new Uv(this,r)}}Ut(Vv,"FillExtrusionWallArray");const h1=qr([{name:"a_pos",components:2,type:"Int16"}],4),d1=qr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),f1=qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hn{constructor(r=[]){this.segments=r}_prepareSegment(r,o,u,h){let m=this.segments[this.segments.length-1];return r>Hn.MAX_VERTEX_ARRAY_LENGTH&&Vr(`Max vertices per segment is ${Hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>Hn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(r,o,u,h){return this._prepareSegment(r,o.length,u.length,h)}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,u,h){return new Hn([{vertexOffset:r,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function Ch(s,r){return 256*(s=Ie(Math.floor(s),0,255))+Ie(Math.floor(r),0,255)}Hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut(Hn,"SegmentVector");const p1=qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),m1=qr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Nf=qr([{name:"a_dash",components:4,type:"Uint16"}]);class Oh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,o,u,h){this.ids.push(Sg(r)),this.positions.push(o,u,h)}eachPosition(r,o){const u=Sg(r);let h=0,m=this.ids.length-1;for(;h<m;){const g=h+m>>1;this.ids[g]>=u?m=g:h=g+1}for(;this.ids[h]===u;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(r,o){const u=new Float64Array(r.ids),h=new Uint32Array(r.positions);return Tg(u,h,0,u.length-1),o&&(o.add(u.buffer),o.add(h.buffer)),{ids:u,positions:h}}static deserialize(r){const o=new Oh;let u;o.ids=r.ids,o.positions=r.positions;for(const h of o.ids)h!==u&&o.uniqueIds.push(h),u=h;return o.indexed=!0,o}}function Sg(s){const r=+s;return Number.isSafeInteger(r)?r:Rd(String(s))}function Tg(s,r,o,u){for(;o<u;){const h=s[o+u>>1];let m=o-1,g=u+1;for(;;){do m++;while(s[m]<h);do g--;while(s[g]>h);if(m>=g)break;Mh(s,m,g),Mh(r,3*m,3*g),Mh(r,3*m+1,3*g+1),Mh(r,3*m+2,3*g+2)}g-o<u-g?(Tg(s,r,o,g),o=g+1):(Tg(s,r,g+1,u),u=g)}}function Mh(s,r,o){const u=s[r];s[r]=s[o],s[o]=u}Ut(Oh,"FeaturePositionMap");class Ja{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,o),this.initialized=!0),!!this.location}set(r,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Rh extends Ja{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class di extends Ja{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Qa extends Ja{constructor(r){super(r),this.current=[0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Dh extends Ja{constructor(r){super(r),this.current=[0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class kh extends Ja{constructor(r){super(r),this.current=[0,0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class $v extends Ja{constructor(r){super(r),this.current=cn.transparent.toPremultipliedRenderColor(null)}set(r,o,u){this.fetchUniformLocation(r,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const g1=new Float32Array(16);class Nh extends Ja{constructor(r){super(r),this.current=g1}set(r,o,u){if(this.fetchUniformLocation(r,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const _1=new Float32Array(9),y1=new Float32Array(4);class Lf extends Ja{constructor(r){super(r),this.current=y1}set(r,o,u){if(this.fetchUniformLocation(r,o)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Lh(s){return[Ch(255*s.r,255*s.g),Ch(255*s.b,255*s.a)]}class ra{constructor(r,o,u,h){this.value=r,this.uniformNames=o.map((m=>`u_${m}`)),this.type=u,this.context=h}setUniform(r,o,u,h,m){const g=h.constantOr(this.value);o.set(r,m,g instanceof cn?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(r,o){return this.type==="color"?new $v(r):new di(r)}}class lc{constructor(r,o){this.uniformNames=o.map((u=>`u_${u}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,o){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=o?o.tl.concat(o.br):this.pattern}setUniform(r,o,u,h,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&o.set(r,m,g)}getBinding(r,o){return o==="u_pattern"||o==="u_pattern_b"||o==="u_dash"?new kh(r):new di(r)}}class ml{constructor(r,o,u,h){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map((m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(r,o,u,h,m,g,b,S){const E=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Cn(0,{brightness:g,worldview:S}),o,{},m,h,b):this.expression.kind==="constant"&&this.expression.value,D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cn(0,{brightness:g,worldview:S}),o,{},m,h,b):this.lutExpression.value)==="none";this.paintVertexArray.resize(r),this._setPaintValue(E,r,O,D?null:this.context.lut)}updatePaintArray(r,o,u,h,m,g,b,S){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:S},u,h,void 0,m):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cn(0,{brightness:b,worldview:S}),u,h,void 0,m):this.lutExpression.value)==="none";this._setPaintValue(r,o,E,O?null:this.context.lut)}_setPaintValue(r,o,u,h){if(this.type==="color"){const m=Lh(u.toPremultipliedRenderColor(h));for(let g=r;g<o;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=r;m<o;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class As{constructor(r,o,u,h,m,g){this.expression=r,this.uniformNames=o.map((b=>`u_${b}_t`)),this.type=u,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=o.map((b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(r,o,u,h,m,g,b,S){const E=this.expression.evaluate(new Cn(this.context.zoom,{brightness:g,worldview:S}),o,{},m,h,b),O=this.expression.evaluate(new Cn(this.context.zoom+1,{brightness:g,worldview:S}),o,{},m,h,b),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cn(0,{brightness:g,worldview:S}),o,{},m,h,b):this.lutExpression.value)==="none",N=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(N,r,E,O,D?null:this.context.lut)}updatePaintArray(r,o,u,h,m,g,b,S){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:S},u,h,void 0,m),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:S},u,h,void 0,m),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cn(0,{brightness:b,worldview:S}),u,h,void 0,m):this.lutExpression.value)==="none";this._setPaintValue(r,o,E,O,D?null:this.context.lut)}_setPaintValue(r,o,u,h,m){if(this.type==="color"){const g=Lh(u.toPremultipliedRenderColor(m)),b=Lh(u.toPremultipliedRenderColor(m));for(let S=r;S<o;S++)this.paintVertexArray.emplace(S,g[0],g[1],b[0],b[1])}else{for(let g=r;g<o;g++)this.paintVertexArray.emplace(g,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o,u,h,m){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=Ie(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);o.set(r,m,b)}getBinding(r,o){return new di(r)}}class Es{constructor(r,o,u,h,m){this.expression=r,this.layerId=m,this.paintVertexAttributes=(u==="array"?Nf:p1).members;for(let g=0;g<o.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new hu}populatePaintArray(r,o,u,h){const m=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(m,r,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(r,o,u,h,m,g,b){this._setPaintValues(r,o,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(r,o,u,h){if(!h||!u)return;const m=h[u[0]],g=h[u[1]];if(m){if(m){const{tl:b,br:S,pixelRatio:E}=m;for(let O=r;O<o;O++)this.paintVertexArray.emplace(O,b[0],b[1],S[0],S[1],E)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:S}=g;for(let E=r;E<o;E++)this.paintTransitionVertexArray.emplace(E,b[0],b[1],S[0],S[1])}}}upload(r){const o=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,o)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,m1.members,o))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class cc{constructor(r,o,u=(()=>!0)){this.binders={},this._buffers=[],this.context=o;const h=[];for(const m in r.paint._values){const g=r.paint.get(m);if(m.endsWith("-use-theme")||!u(m)||!(g instanceof rc&&uf(g.property.specification)))continue;const b=rM(m,r.type),S=g.value,E=g.property.specification.type,O=!!g.property.useIntegerZoom,D=m==="line-dasharray"||m.endsWith("pattern"),N=r.paint.get(`${m}-use-theme`),B=m==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(S.kind!=="constant"||B)if(S.kind==="source"||B||D){const U=c(m,E,"source");this.binders[m]=D?new Es(S,b,E,U,r.id):new ml(S,b,E,U),h.push(`/a_${m}`)}else{const U=c(m,E,"composite");this.binders[m]=new As(S,b,E,O,o,U),h.push(`/z_${m}`)}else this.binders[m]=D?new lc(S.value,b):new ra(S.value,b,E,o),h.push(`/u_${m}`);N&&(this.binders[m].lutExpression=N.value)}this.cacheKey=h.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof ml||o instanceof As?o.maxValue:0}populatePaintArrays(r,o,u,h,m,g,b,S){for(const E in this.binders){const O=this.binders[E];O.context=this.context,(O instanceof ml||O instanceof As||O instanceof Es)&&O.populatePaintArray(r,o,u,h,m,g,b,S)}}setConstantPatternPositions(r,o){for(const u in this.binders){const h=this.binders[u];h instanceof lc&&h.setConstantPatternPositions(r,o)}}getPatternTransitionVertexBuffer(r){const o=this.binders[r];return o instanceof Es?o.paintTransitionVertexBuffer:null}updatePaintArrays(r,o,u,h,m,g,b,S,E,O){let D=!1;const N=Object.keys(r),B=N.length!==0&&!S,U=B?N:o.uniqueIds;this.context.lut=m.lut;for(const X in this.binders){const Q=this.binders[X];if(Q.context=this.context,(Q instanceof ml||Q instanceof As||Q instanceof Es)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const ee=m.paint.get(X);Q.expression=ee.value;for(const ue of U){const he=r[ue.toString()];o.eachPosition(ue,((pe,Ae,Ee)=>{const Oe=h.feature(pe);Q.updatePaintArray(Ae,Ee,Oe,he,g,b,E,O)}))}if(!B)for(const ue of u.uniqueIds){const he=r[ue.toString()];u.eachPosition(ue,((pe,Ae,Ee)=>{const Oe=h.feature(pe);Q.updatePaintArray(Ae,Ee,Oe,he,g,b,E,O)}))}D=!0}}return D}defines(){const r=[];for(const o in this.binders){const u=this.binders[o];(u instanceof ra||u instanceof lc)&&r.push(...u.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const o=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof ra||h instanceof lc||h instanceof As)for(const m of h.uniformNames)o.push({name:m,property:u,binding:h.getBinding(r,m)})}return o}setUniforms(r,o,u,h,m){for(const{name:g,property:b,binding:S}of u)this.binders[b].setUniform(r,S,m,h.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const o=this.binders[r];(o instanceof ml||o instanceof As||o instanceof Es)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer),o instanceof Es&&o.paintTransitionVertexBuffer&&this._buffers.push(o.paintTransitionVertexBuffer)}}upload(r){for(const o in this.binders){const u=this.binders[o];(u instanceof ml||u instanceof As||u instanceof Es)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof ml||o instanceof As||o instanceof Es)&&o.destroy()}}}class Ia{constructor(r,o,u=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new cc(h,o,u);this.needsUpload=!1,this._featureMap=new Oh,this._featureMapWithoutIds=new Oh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,o,u,h,m,g,b,S,E){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(r,o,h,m,g,b,S,E);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,u,h,m,g,b,S){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,o,E,h,m,g,b||0,S)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const qv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function rM(s,r){return qv[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const p={"line-pattern":{source:pl,composite:pl},"fill-pattern":{source:pl,composite:pl},"fill-extrusion-pattern":{source:pl,composite:pl},"line-dasharray":{source:hu,composite:hu}},n={color:{source:pu,composite:Pa},number:{source:fl,composite:pu}};function c(s,r,o){const u=p[s];return u&&u[o]||n[r][o]}Ut(ra,"ConstantBinder"),Ut(lc,"PatternConstantBinder"),Ut(ml,"SourceExpressionBinder"),Ut(Es,"PatternCompositeBinder"),Ut(As,"CompositeExpressionBinder"),Ut(cc,"ProgramConfiguration",{omit:["_buffers"]}),Ut(Ia,"ProgramConfigurationSet");const f=Mt/Math.PI/2,y=5,x=6,w=16383,A=64,C=[A,32,16],k=-f,L=f;function V(s,r,o,u=f){return o=Fe(o),[s*Math.sin(o)*u,-r*u,s*Math.cos(o)*u]}function z(s,r,o){return V(Math.cos(Fe(s)),Math.sin(Fe(s)),r,o)}const G=63710088e-1,W=2*Math.PI*G;class Z{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Z(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,u=this.lat*o,h=r.lat*o,m=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((r.lng-this.lng)*o);return G*Math.acos(Math.min(m,1))}toBounds(r=0){const o=360*r/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new oe({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(r){return z(this.lat,this.lng,f+r*f/G)}static convert(r){if(r instanceof Z)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Z(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Z(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class oe{constructor(r,o){r&&(o?this.setSouthWest(r).setNorthEast(o):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Z?new Z(r.lng,r.lat):Z.convert(r),this}setSouthWest(r){return this._sw=r instanceof Z?new Z(r.lng,r.lat):Z.convert(r),this}extend(r){const o=this._sw,u=this._ne;let h,m;if(r instanceof Z)h=r,m=r;else{if(!(r instanceof oe))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(oe.convert(r)):this.extend(Z.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Z.convert(r)):this;if(h=r._sw,m=r._ne,!h||!m)return this}return o||u?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new Z(h.lng,h.lat),this._ne=new Z(m.lng,m.lat)),this}getCenter(){return new Z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Z(this.getWest(),this.getNorth())}getSouthEast(){return new Z(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:o,lat:u}=Z.convert(r);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(r){if(r)return r instanceof oe?r:new oe(r)}}const te=0,le=25.5;function fe(s){return W*Math.cos(s*Math.PI/180)}function me(s){return(180+s)/360}function we(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function xe(s,r){return s/fe(r)}function Se(s){return 360*s-180}function be(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function ve(s,r){return s*fe(be(r))}const Te=85.051129;function qe(s){return Math.cos(Fe(Ie(s,-Te,Te)))}function je(s,r){const o=Ie(r,te,le),u=Math.pow(2,o);return qe(s)*W/(512*u)}function tt(s){return 1/Math.cos(s*Math.PI/180)}function Ve(s,r=0){const o=Math.exp(Math.PI*(1-(s.y+r/Mt)/(1<<s.z)*2));return 80150034*o/(o*o+1)/Mt/(1<<s.z)}class et{constructor(r,o,u=0){this.x=+r,this.y=+o,this.z=+u}static fromLngLat(r,o=0){const u=Z.convert(r);return new et(me(u.lng),we(u.lat),xe(o,u.lat))}toLngLat(){return new Z(Se(this.x),be(this.y))}toAltitude(){return ve(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/W*tt(be(this.y))}}function Et(s,r,o,u,h,m,g,b,S){const E=(r+u)/2,O=(o+h)/2,D=new wt(E,O);b(D),(function(N,B,U,X,Q,ee){const ue=U-Q,he=X-ee;return Math.abs((X-B)*ue-(U-N)*he)/Math.hypot(ue,he)})(D.x,D.y,m.x,m.y,g.x,g.y)>=S?(Et(s,r,o,E,O,m,D,b,S),Et(s,E,O,u,h,D,g,b,S)):s.push(g)}function $e(s,r,o){let u=s[0],h=u.x,m=u.y;r(u);const g=[u];for(let b=1;b<s.length;b++){const S=s[b],{x:E,y:O}=S;r(S),Et(g,h,m,E,O,u,S,r,o),h=E,m=O,u=S}return g}function Re(s,r,o,u){if(u(r,o)){const h=r.add(o)._mult(.5);Re(s,r,h,u),Re(s,h,o,u)}else s.push(o)}function at(s,r){let o=s[0];const u=[o];for(let h=1;h<s.length;h++){const m=s[h];Re(u,o,m,r),o=m}return u}const We=Math.pow(2,14)-1,dt=-We-1;function At(s,r){const o=Math.round(s.x*r),u=Math.round(s.y*r);return s.x=Ie(o,dt,We),s.y=Ie(u,dt,We),(o<s.x||o>s.x+1||u<s.y||u>s.y+1)&&Vr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Lt(s,r,o){const u=s.loadGeometry(),h=s.extent,m=Mt/h;if(r&&o&&o.projection.isReprojectedInTileSpace){const g=1<<r.z,{scale:b,x:S,y:E,projection:O}=o,D=N=>{const B=Se((r.x+N.x/h)/g),U=be((r.y+N.y/h)/g),X=O.project(B,U);N.x=(X.x*b-S)*h,N.y=(X.y*b-E)*h};for(let N=0;N<u.length;N++)if(s.type!==1)u[N]=$e(u[N],D,1);else{const B=[];for(const U of u[N])U.x<0||U.x>=h||U.y<0||U.y>=h||(D(U),B.push(U));u[N]=B}}for(const g of u)for(const b of g)At(b,m);return u}function xt(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Lt(s):[]}}class gt{constructor(r,o,u,h,m){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=h,this._values=m,r.readFields(Kt,this,o)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos,u=[];let h,m=1,g=0,b=0,S=0;for(;r.pos<o;){if(g<=0){const E=r.readVarint();m=7&E,g=E>>3}if(g--,m===1||m===2)b+=r.readSVarint(),S+=r.readSVarint(),m===1&&(h&&u.push(h),h=[]),h&&h.push(new wt(b,S));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos;let u=1,h=0,m=0,g=0,b=1/0,S=-1/0,E=1/0,O=-1/0;for(;r.pos<o;){if(h<=0){const D=r.readVarint();u=7&D,h=D>>3}if(h--,u===1||u===2)m+=r.readSVarint(),g+=r.readSVarint(),m<b&&(b=m),m>S&&(S=m),g<E&&(E=g),g>O&&(O=g);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,E,S,O]}toGeoJSON(r,o,u){const h=this.extent*Math.pow(2,u),m=this.extent*r,g=this.extent*o,b=this.loadGeometry();function S(N){return[360*(N.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+g)/h)*Math.PI))-90]}function E(N){return N.map(S)}let O;if(this.type===1){const N=[];for(const U of b)N.push(U[0]);const B=E(N);O=N.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const N=b.map(E);O=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=(function(U){const X=U.length;if(X<=1)return[U];const Q=[];let ee,ue;for(let he=0;he<X;he++){const pe=Wt(U[he]);pe!==0&&(ue===void 0&&(ue=pe<0),ue===pe<0?(ee&&Q.push(ee),ee=[U[he]]):ee&&ee.push(U[he]))}return ee&&Q.push(ee),Q})(b),B=[];for(const U of N)B.push(U.map(E));O=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const D={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function Kt(s,r,o){s===1?r.id=o.readVarint():s===2?(function(u,h){const m=u.readVarint()+u.pos;for(;u.pos<m;){const g=h._keys[u.readVarint()],b=h._values[u.readVarint()];h.properties[g]=b}})(o,r):s===3?r.type=o.readVarint():s===4&&(r._geometry=o.pos)}function Wt(s){let r=0;for(let o,u,h=0,m=s.length,g=m-1;h<m;g=h++)o=s[h],u=s[g],r+=(u.x-o.x)*(o.y+u.y);return r}gt.types=["Unknown","Point","LineString","Polygon"];class Xt{constructor(r,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Ht,this,o),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const o=this._pbf.readVarint()+this._pbf.pos;return new gt(this._pbf,o,this.extent,this._keys,this._values)}}function Ht(s,r,o){s===15?r.version=o.readVarint():s===1?r.name=o.readString():s===5?r.extent=o.readVarint():s===2?r._features.push(o.pos):s===3?r._keys.push(o.readString()):s===4&&r._values.push((function(u){let h=null;const m=u.readVarint()+u.pos;for(;u.pos<m;){const g=u.readVarint()>>3;h=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(o))}class gr{constructor(r,o){this.layers=r.readFields(Ar,{},o)}}function Ar(s,r,o){if(s===3){const u=new Xt(o,o.readVarint()+o.pos);u.length&&(r[u.name]=u)}}const Cr="3d_elevation_id",hn="level";class vr{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,o){return this._valid&&r(o(this._geometry)),this}require(r,o,u){return this.get(r,!0,o,u)}optional(r,o,u){return this.get(r,!1,o,u)}success(){return this._valid}get(r,o,u,h){const m=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?u(h?h(m):m):o&&(this._valid=!1),this}}class Yr{constructor(r,o){this.featureFunc=r,this.vertexFunc=o}parseFeature(r,o,u){return this.featureFunc(r,o,u)}parseVertex(r,o,u){return this.vertexFunc(r,o,u)}}const ln=new Yr(((s,r,o)=>s.reset(r).require(Cr,(u=>{o.id=u})).optional("fixed_height_relative",(u=>{o.constantHeight=u}),Er.decodeRelativeHeight).geometry((u=>{o.bounds=u}),Vd).success()),((s,r,o)=>s.reset(r).require(Cr,(u=>{o.id=u})).require("elevation_idx",(u=>{o.idx=u})).require("extent",(u=>{o.extent=u})).require("height_relative",(u=>{o.height=u}),Er.decodeRelativeHeight).geometry((u=>{o.position=u}),Er.getPoint).success())),zn=new Yr(((s,r,o)=>s.reset(r).require(Cr,(u=>{o.id=u})).optional("fixed_height",(u=>{o.constantHeight=u}),Er.decodeMetricHeight).geometry((u=>{o.bounds=u}),Vd).success()),((s,r,o)=>s.reset(r).require(Cr,(u=>{o.id=u})).require("elevation_idx",(u=>{o.idx=u})).require("extent",(u=>{o.extent=u})).require("height",(u=>{o.height=u}),Er.decodeMetricHeight).geometry((u=>{o.position=u}),Er.getPoint).success()));class Er{static getPoint(r){return ya(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?zn:void 0:ln}static parse(r){const o=[],u=[],h=r.length,m=new vr;for(let g=0;g<h;g++){const b=r.feature(g),S=b.properties.version,E=Er.getVersionSchema(S);if(E===void 0){Vr(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const O=b.properties.type;if(!O)continue;const D=gt.types[b.type];if(D==="Point"&&O==="curve_point"){const N={};E.parseVertex(m,b,N)&&o.push(N)}else if(D==="Polygon"&&O==="curve_meta"){const N={};E.parseFeature(m,b,N)&&u.push(N)}}return{vertices:o,features:u}}}class tn{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,u){const h=$i(o,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,!0}}class Qr{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,u){const h=nr(o,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1]+(r[2]-this.pos[2])*o[2])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(r,o,u){if((function(B,U){var X=B[0],Q=B[1],ee=B[2],ue=U[0],he=U[1],pe=U[2];return Math.abs(X-ue)<=P*Math.max(1,Math.abs(X),Math.abs(ue))&&Math.abs(Q-he)<=P*Math.max(1,Math.abs(Q),Math.abs(he))&&Math.abs(ee-pe)<=P*Math.max(1,Math.abs(ee),Math.abs(pe))})(this.pos,r)||o===0)return u[0]=u[1]=u[2]=0,!1;const[h,m,g]=this.dir,b=this.pos[0]-r[0],S=this.pos[1]-r[1],E=this.pos[2]-r[2],O=h*h+m*m+g*g,D=2*(b*h+S*m+E*g),N=D*D-4*O*(b*b+S*S+E*E-o*o);if(N<0){const B=Math.max(-D/2,0),U=b+h*B,X=S+m*B,Q=E+g*B,ee=Math.hypot(U,X,Q);return u[0]=U*o/ee,u[1]=X*o/ee,u[2]=Q*o/ee,!1}{const B=(-D-Math.sqrt(N))/(2*O);if(B<0){const U=Math.hypot(b,S,E);return u[0]=b*o/U,u[1]=S*o/U,u[2]=E*o/U,!1}return u[0]=b+h*B,u[1]=S+m*B,u[2]=E+g*B,!0}}}class on{constructor(r,o,u,h,m){this.TL=r,this.TR=o,this.BR=u,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(r,o,u){const h=[-1,1,1],m=[1,1,1],g=[1,-1,1],b=[-1,-1,1],S=or(h,h,r),E=or(m,m,r),O=or(g,g,r),D=or(b,b,r);return new on(S,E,O,D,o/u)}}function Bn(s,r,o){let u=1/0,h=-1/0;const m=[];for(const g of s){Zr(m,g,r);const b=nr(m,o);u=Math.min(u,b),h=Math.max(h,b)}return[u,h]}function oi(s,r){let o=!0;for(let u=0;u<s.planes.length;u++){const h=s.planes[u];let m=0;for(let g=0;g<r.length;g++)m+=+(nr(h,r[g])+h[3]>=0);if(m===0)return 0;m!==r.length&&(o=!1)}return o?2:1}function ji(s,r){for(const o of s.projections){const u=Bn(r,s.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function Un(s,r){let o=0;const u=[0,0,0,0];for(let g=0;g<s.length;g++)u[0]=s[g][0],u[1]=s[g][1],u[2]=s[g][2],u[3]=1,(h=u)[0]*(m=r)[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3]>=0&&o++;var h,m;return o}class Or{constructor(r,o){this.points=r||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=hr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Zr([],this.points[2],this.points[3]),Zr([],this.points[0],this.points[3]),Zr([],this.points[4],this.points[0]),Zr([],this.points[5],this.points[1]),Zr([],this.points[6],this.points[2]),Zr([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],m=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Bn(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:Bn(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(r,o,u,h){const m=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((E=>{const O=Ni([],E,r),D=1/O[3]/o*m;return(N=O)[0]=(B=O)[0]*(U=[D,D,h?1/O[3]:D,D])[0],N[1]=B[1]*U[1],N[2]=B[2]*U[2],N[3]=B[3]*U[3],N;var N,B,U})),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((E=>{const O=Fr([],Dr([],Zr([],g[E[0]],g[E[1]]),Zr([],g[E[2]],g[E[1]]))),D=-nr(O,g[E[1]]);return O.concat(D)})),S=[];for(let E=0;E<g.length;E++)S.push([g[E][0],g[E][1],g[E][2]]);return new Or(S,b)}intersectsPrecise(r,o,u){for(let h=0;h<o.length;h++)if(!Un(r,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Un(r,this.planes[h]))return 0;for(const h of u)for(const m of this.frustumEdges){const g=Dr([],h,m),b=nt(g);if(b===0)continue;qt(g,g,1/b);const S=Bn(this.points,this.points[0],g),E=Bn(r,this.points[0],g);if(S[0]>E[1]||E[0]>S[1])return 0}return 1}containsPoint(r){for(const o of this.planes){const u=o[3];if(nr([o[0],o[1],o[2]],r)+u<0)return!1}return!0}}class hr{static fromPoints(r){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of r)yt(o,o,h),ar(u,u,h);return new hr(o,u)}static fromTileIdAndHeight(r,o,u){const h=1<<r.canonical.z,m=r.canonical.x,g=r.canonical.y;return new hr([m/h,g/h,o],[(m+1)/h,(g+1)/h,u])}static applyTransform(r,o){const u=r.getCorners();for(let h=0;h<u.length;++h)or(u[h],u[h],o);return hr.fromPoints(u)}static applyTransformFast(r,o){const u=[o[12],o[13],o[14]],h=[...u];for(let m=0;m<3;m++)for(let g=0;g<3;g++){const b=o[4*g+m],S=b*r.min[g],E=b*r.max[g];u[m]+=Math.min(S,E),h[m]+=Math.max(S,E)}return new hr(u,h)}static projectAabbCorners(r,o){const u=r.getCorners();for(let h=0;h<u.length;++h)or(u[h],u[h],o);return u}constructor(r,o){this.min=r,this.max=o,this.center=qt([],it([],this.min,this.max),.5)}quadrant(r){const o=[r%2==0,r<2],u=Ze(this.min),h=Ze(this.max);for(let m=0;m<o.length;m++)u[m]=o[m]?this.min[m]:this.center[m],h[m]=o[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new hr(u,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,o=this.max;return[[r[0],r[1],r[2]],[o[0],r[1],r[2]],[o[0],o[1],r[2]],[r[0],o[1],r[2]],[r[0],r[1],o[2]],[o[0],r[1],o[2]],[o[0],o[1],o[2]],[r[0],o[1],o[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?oi(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?oi(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,o){return o||this.intersects(r)?ji(r,this.getCorners()):0}intersectsPreciseFlat(r,o){return o||this.intersectsFlat(r)?ji(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let o=0;o<3;++o)if(this.min[o]>r.max[o]||r.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],r.min[o]),this.max[o]=Math.max(this.max[o],r.max[o])}encapsulatePoint(r){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],r[o]),this.max[o]=Math.max(this.max[o],r[o])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}Ut(hr,"Aabb");class dn{constructor(r,o){this.feature=r,this.metersToTile=o,this.index=0}get(){const r=this.feature.vertices[this.index],o=this.feature.vertexProps[this.index].dir,u=o[1],h=-o[0],m=(r.extent+1)*this.metersToTile;return[new wt(Math.trunc(r.position[0]+u*m),Math.trunc(r.position[1]+h*m)),new wt(Math.trunc(r.position[0]-u*m),Math.trunc(r.position[1]-h*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Kn{constructor(r,o,u,h,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Zi(),Zi(),Zi(),Zi(),Zi(),Zi(),Zi()],this.id=r,this.heightRange={min:u,max:u},this.safeArea=o,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=m,this.edges=this.edges.filter((b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((S=this.vertices[b.a].position)[0]===(E=this.vertices[b.b].position)[0]&&S[1]===E[1]);var S,E})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:ya(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const S=this.vertices[b.a].position,E=this.vertices[b.b].position,O=Ha(Zi(),E,S),D=jl(O),N=ys(Zi(),O,1/D);this.edgeProps.push({vec:O,dir:N,len:D});const B=this.vertexProps[b.a].dir,U=this.vertexProps[b.b].dir;Zs(B,B,N),Zs(U,U,N)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||Zn(b.dir,b.dir);this.tessellate(g)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(r);if(o==null)return 0;const[u,h]=o;return lr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(r,o){const u=this.getClosestEdge(r);if(!u)return Je(0,0,1);const h=u[0],m=this.edges[h],g=this.edgeProps[h].vec,b=Je(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*o),S=Je(b[1],-b[0],0);Dr(S,S,b);const E=nt(S);return E>0?qt(S,S,1/E):ot(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let o=0,u=Number.POSITIVE_INFINITY,h=0;const[m,g,b,S,E,O,D]=this._tmpVec2;Xu(D,r.x,r.y);const N=new tn(D,null);for(let B=0;B<this.edges.length;B++){const U=this.edges[B],X=this.edgeProps[B].dir;N.dir=X;const Q=this.vertices[U.a].position,ee=this.vertices[U.b].position,ue=N.intersectsPlane(Q,this.vertexProps[U.a].dir,m),he=N.intersectsPlane(ee,this.vertexProps[U.b].dir,g);if(!ue||!he)continue;Ha(b,g,m),Ha(S,D,m);const pe=$i(b,b),Ae=pe>0?$i(S,b)/pe:0,Ee=Ie(Ae,0,1),Oe=Math.abs((Ae-Ee)*this.edgeProps[B].len);Ha(E,D,Q),Xu(O,X[1],-X[0]);const De=Oe+Math.abs($i(E,O));De<u&&(o=B,u=De,h=Ee)}return[o,h]}tessellate(r){const o=ke(),u=ke(),h=ke(),m=ke();for(let g=this.edges.length-1;g>=0;--g){const b=this.edges[g].a,S=this.edges[g].b,{position:E,height:O,extent:D}=this.vertices[b],{position:N,height:B,extent:U}=this.vertices[S],X=this.vertexProps[b].dir,Q=this.vertexProps[S].dir;if(ot(o,E[0]/r,E[1]/r,O),ot(u,N[0]/r,N[1]/r,B),ot(h,X[1],-X[0],0),qt(h,h,D),ot(m,Q[1],-Q[0],0),qt(m,m,U),this.distSqLines(Je(o[0]+.5*h[0],o[1]+.5*h[1],o[2]+.5*h[2]),Je(u[0]-.5*m[0],u[1]-.5*m[1],u[2]-.5*m[2]),Je(o[0]-.5*h[0],o[1]-.5*h[1],o[2]-.5*h[2]),Je(u[0]+.5*m[0],u[1]+.5*m[1],u[2]+.5*m[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,ue=Zs(Zi(),E,N);this.vertices.push({position:ys(ue,ue,.5),height:.5*(O+B),extent:.5*(D+U)});const he=Zs(Zi(),X,Q);this.vertexProps.push({dir:Zn(he,he)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:b,b:ee}),this.edges.push({a:ee,b:S});const pe=Ha(Zi(),this.vertices[ee].position,E),Ae=jl(pe),Ee={vec:pe,dir:ys(Zi(),pe,1/Ae),len:Ae};this.edgeProps.push(Ee),this.edgeProps.push(Ee)}}distSqLines(r,o,u,h){const m=Pt(ke(),o,r),g=Pt(ke(),h,u),b=Pt(ke(),r,u),S=nr(m,m),E=nr(m,g),O=nr(m,b),D=nr(g,g),N=nr(g,b),B=S*D-E*E;if(B===0)return Tr(er(m,u,h,nr(b,g)/nr(g,g)),r);const U=(S*N-E*O)/B;return Tr(er(m,r,o,(E*N-O*D)/B),er(g,u,h,U))}}class $n{static parseFrom(r,o){const u=Er.parse(r);if(!u)return[];let{vertices:h,features:m}=u;const g=1/Ve(o);m.sort(((O,D)=>O.id-D.id)),h.sort(((O,D)=>O.id-D.id||O.idx-D.idx)),h=h.filter(((O,D,N)=>D===N.findIndex((B=>B.id===O.id&&B.idx===O.idx))));const b=new Array;let S=0;const E=h.length;for(const O of m){if(O.constantHeight){b.push(new Kn(O.id,O.bounds,O.constantHeight));continue}for(;S!==E&&h[S].id<O.id;)S++;if(S===E||h[S].id!==O.id)continue;const D=new Array,N=new Array,B=S;for(;S!==E&&h[S].id===O.id;){const U=h[S];if(D.push({position:U.position,height:U.height,extent:U.extent}),S!==B&&h[S-1].idx===U.idx-1){const X=S-B;N.push({a:X-1,b:X})}S++}b.push(new Kn(O.id,O.bounds,void 0,D,N,g))}return b}static getElevationFeature(r,o){if(!o)return;const u=+r.properties[Cr];return Number.isNaN(u)?void 0:o.find((h=>h.id===u))}}class mi{constructor(r,o){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(o)||(this.zScale=Math.pow(2,o.z-r.z),this.xOffset=(r.x*this.zScale-o.x)*Mt,this.yOffset=(r.y*this.zScale-o.y)*Mt)}constantElevation(r,o){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,o)}pointElevation(r,o,u){const h=this.constantElevation(o,u);return h??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(r),u))}computeBiasedHeight(r,o){return o<=0?r:r+o*Ye(0,o,r>=0?r:Math.abs(.5*r))}}Ut(Kn,"ElevationFeature");class qi{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new dl,this.indexArray=new Oi,this.segments=new Hn,this.programConfigurations=new Ia(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new fl),this.worldview=r.worldview}updateFootprints(r,o){}populate(r,o,u,h){const m=this.layers[0],g=[];let b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(const{feature:E,id:O,index:D,sourceLayerIndex:N}of r){const B=this.layers[0]._featureFilter.needGeometry,U=xt(E,B);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom,{worldview:this.worldview}),U,u))continue;const X=b?b.evaluate(U,{},u):void 0,Q={id:O,properties:E.properties,type:E.type,sourceLayerIndex:N,index:D,geometry:B?U.geometry:Lt(E,u,h),patterns:{},sortKey:X};g.push(Q)}b&&g.sort(((E,O)=>E.sortKey-O.sortKey));let S=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new If,S=h.projection);for(const E of g){const{geometry:O,index:D,sourceLayerIndex:N}=E,B=r[D].feature;this.addFeature(E,O,D,o.availableImages,u,S,o.brightness,o.elevationFeatures),o.featureIndex.insert(B,O,D,N,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,o,u,h,m,g,b){this.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,h1.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,f1.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,d1.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,o,u,h,m,g,b,S){let E;this.elevationMode!=="none"&&(E=$n.getElevationFeature(r,S));for(const O of o)for(const D of O){const N=D.x,B=D.y;if(N<0||N>=Mt||B<0||B>=Mt)continue;if(g){const Q=g.projectTilePoint(N,B,m),ee=g.upVector(m,N,B);this.addGlobeExtVertex(Q,ee),this.addGlobeExtVertex(Q,ee),this.addGlobeExtVertex(Q,ee),this.addGlobeExtVertex(Q,ee)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),X=U.vertexLength;if(this.addCircleVertex(N,B,-1,-1),this.addCircleVertex(N,B,1,-1),this.addCircleVertex(N,B,1,1),this.addCircleVertex(N,B,-1,1),this.elevationMode!=="none"){const Q=E?E.pointElevation(new wt(N,B)):0;this.hasElevation=this.hasElevation||Q!==0;for(let ee=0;ee<4;ee++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},h,m,b,void 0,this.worldview)}addCircleVertex(r,o,u,h){this.layoutVertexArray.emplaceBack(2*r+(u+1)/2,2*o+(h+1)/2)}addGlobeExtVertex(r,o){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}}function na(s,r){for(let o=0;o<s.length;o++)if(zi(r,s[o]))return!0;for(let o=0;o<r.length;o++)if(zi(s,r[o]))return!0;return!!So(s,r)}function ia(s,r,o){return!!zi(s,r)||!!ai(r,s,o)}function Fo(s,r){if(s.length===1)return Si(r,s[0]);for(let o=0;o<r.length;o++){const u=r[o];for(let h=0;h<u.length;h++)if(zi(s,u[h]))return!0}for(let o=0;o<s.length;o++)if(Si(r,s[o]))return!0;for(let o=0;o<r.length;o++)if(So(s,r[o]))return!0;return!1}function Bo(s,r,o){if(s.length>1){if(So(s,r))return!0;for(let u=0;u<r.length;u++)if(ai(r[u],s,o))return!0}for(let u=0;u<s.length;u++)if(ai(s[u],r,o))return!0;return!1}function So(s,r){if(s.length===0||r.length===0)return!1;for(let o=0;o<s.length-1;o++){const u=s[o],h=s[o+1];for(let m=0;m<r.length-1;m++)if(pa(u,h,r[m],r[m+1]))return!0}return!1}function pa(s,r,o,u){return ii(s,o,u)!==ii(r,o,u)&&ii(s,r,o)!==ii(s,r,u)}function Ca(s,r,o){return(s.x-o.x)*(r.y-o.y)-(s.y-o.y)*(r.x-o.x)}function ei(s,r,o,u){const h=Ca(s,r,u),m=Ca(s,r,o);if(Math.sign(h)===Math.sign(m))return;const g=Ca(o,u,s),b=g+m-h;return Math.sign(g)!==Math.sign(b)?[g/(g-b),m/(m-h)]:void 0}function ai(s,r,o){const u=o*o;if(r.length===1)return s.distSqr(r[0])<u;for(let h=1;h<r.length;h++)if(qn(s,r[h-1],r[h])<u)return!0;return!1}function qn(s,r,o){const u=r.distSqr(o);if(u===0)return s.distSqr(r);const h=((s.x-r.x)*(o.x-r.x)+(s.y-r.y)*(o.y-r.y))/u;return s.distSqr(h<0?r:h>1?o:o.sub(r)._mult(h)._add(r))}function Si(s,r){let o,u,h,m=!1;for(let g=0;g<s.length;g++){o=s[g];for(let b=0,S=o.length-1;b<o.length;S=b++)u=o[b],h=o[S],u.y>r.y!=h.y>r.y&&r.x<(h.x-u.x)*(r.y-u.y)/(h.y-u.y)+u.x&&(m=!m)}return m}function zi(s,r){let o=!1;for(let u=0,h=s.length-1;u<s.length;h=u++){const m=s[u],g=s[h];m.y>r.y!=g.y>r.y&&r.x<(g.x-m.x)*(r.y-m.y)/(g.y-m.y)+m.x&&(o=!o)}return o}function fi(s,r,o,u,h){for(const g of s)if(r<=g.x&&o<=g.y&&u>=g.x&&h>=g.y)return!0;const m=[new wt(r,o),new wt(r,h),new wt(u,h),new wt(u,o)];if(s.length>2){for(const g of m)if(zi(s,g))return!0}for(let g=0;g<s.length-1;g++)if(Qi(s[g],s[g+1],m))return!0;return!1}function Qi(s,r,o){const u=o[0],h=o[2];if(s.x<u.x&&r.x<u.x||s.x>h.x&&r.x>h.x||s.y<u.y&&r.y<u.y||s.y>h.y&&r.y>h.y)return!1;const m=ii(s,r,o[0]);return m!==ii(s,r,o[1])||m!==ii(s,r,o[2])||m!==ii(s,r,o[3])}function es(s,r,o,u,h,m){let g=r.y-s.y,b=s.x-r.x;if(m=m||0){const S=g*g+b*b;if(S===0)return!0;const E=Math.sqrt(S);g/=E,b/=E}return!((o.x-s.x)*g+(o.y-s.y)*b-m<0||(u.x-s.x)*g+(u.y-s.y)*b-m<0||(h.x-s.x)*g+(h.y-s.y)*b-m<0)}function Ps(s,r,o,u,h,m,g){return!(es(s,r,u,h,m,g)||es(r,o,u,h,m,g)||es(o,s,u,h,m,g)||es(u,h,s,r,o,g)||es(h,m,s,r,o,g)||es(m,u,s,r,o,g))}function Oa(s,r,o){const u=r.paint.get(s).value;return u.kind==="constant"?u.value:o.programConfigurations.get(r.id).getMaxValue(s)}function gl(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function _l(s,r,o,u,h){if(!r[0]&&!r[1])return s;const m=wt.convert(r)._mult(h);o==="viewport"&&m._rotate(-u);const g=[];for(let b=0;b<s.length;b++)g.push(s[b].sub(m));return g}function ts(s,r,o,u){const h=wt.convert(s)._mult(u);return r==="viewport"&&h._rotate(-o),h}let _u,Is;function rs(s,r,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[s*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}Ut(qi,"CircleBucket",{omit:["layers"]});class Cs{constructor(r,o,u){this.z=r,this.x=o,this.y=u,this.key=zf(0,r,r,o,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const o=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>o&&r.y===this.y>>o}url(r,o){const u=(function(m,g,b){var S=rs(256*m,256*(g=Math.pow(2,b)-g-1),b),E=rs(256*(m+1),256*(g+1),b);return S[0]+","+S[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),h=(function(m,g,b){let S,E="";for(let O=m;O>0;O--)S=1<<O-1,E+=(g&S?1:0)+(b&S?2:0);return E})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jf{constructor(r,o){this.wrap=r,this.canonical=o,this.key=zf(r,o.z,o.z,o.x,o.y)}}class To{constructor(r,o,u,h,m){this.overscaledZ=r,this.wrap=o,this.canonical=new Cs(u,+h,+m),this.key=o===0&&r===u?this.canonical.key:zf(o,r,u,h,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const o=this.canonical.z-r;return r>this.canonical.z?new To(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new To(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o=!0){if(this.overscaledZ===r&&o)return this.key;if(r>this.canonical.z)return zf(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return zf(this.wrap*+o,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new To(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new To(o,this.wrap,o,u,h),new To(o,this.wrap,o,u+1,h),new To(o,this.wrap,o,u,h+1),new To(o,this.wrap,o,u+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new To(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new To(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zf(s,r,o,u,h){const m=1<<Math.min(o,22);let g=m*(h%m)+u%m;return s&&o<22&&(g+=m*m*((s<0?-2*s-1:2*s)%(1<<2*(22-o)))),16*(32*g+o)+(r-o)}const rH=[s=>{let r=s.canonical.x-1,o=s.wrap;return r<0&&(r=(1<<s.canonical.z)-1,o--),new To(s.overscaledZ,o,s.canonical.z,r,s.canonical.y)},s=>{let r=s.canonical.x+1,o=s.wrap;return r===1<<s.canonical.z&&(r=0,o++),new To(s.overscaledZ,o,s.canonical.z,r,s.canonical.y)},s=>new To(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new To(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];Ut(Cs,"CanonicalTileID"),Ut(To,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const nH=qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Gv}=nH,iH=qr([{name:"a_pos_3",components:3,type:"Int16"}]);var nM=qr([{name:"a_pos",type:"Int16",components:2}]);function Hv(s){return s*f/G}const oH=[new hr([k,k,k],[L,L,L]),new hr([k,k,k],[0,0,L]),new hr([0,k,k],[L,0,L]),new hr([k,0,k],[0,L,L]),new hr([0,0,k],[L,L,L])];function iM(s,r,o,u=!0){const h=qt([],s._camera.position,s.worldSize),m=[r,o,1,1];Ni(m,m,s.pixelMatrixInverse),ki(m,m,1/m[3]);const g=Fr([],Zr([],m,h)),b=s.globeMatrix,S=[b[12],b[13],b[14]],E=Zr([],S,h),O=nt(E),D=Fr([],E),N=s.worldSize/(2*Math.PI),B=nr(D,g),U=Math.asin(N/O);if(U<Math.acos(B)){if(!u)return null;const ct=[],Ue=[];qt(ct,g,O/B),Fr(Ue,Zr(Ue,ct,E)),Fr(g,it(g,E,qt(g,Ue,Math.tan(U)*O)))}const X=[];new Qr(h,g).closestPointOnSphere(S,N,X);const Q=Fr([],Qn(b,0)),ee=Fr([],Qn(b,1)),ue=Fr([],Qn(b,2)),he=nr(Q,X),pe=nr(ee,X),Ae=nr(ue,X),Ee=ne(Math.asin(-pe/N));let Oe=ne(Math.atan2(he,Ae));Oe=s.center.lng+(function(ct,Ue){const ut=(Ue-ct+180)%360-180;return ut<-180?ut+360:ut})(s.center.lng,Oe);const De=me(Oe),Le=Ie(we(Ee),0,1);return new et(De,Le)}class aH{constructor(r,o,u){this.a=Zr([],r,u),this.b=Zr([],o,u),this.center=u;const h=Fr([],this.a),m=Fr([],this.b);this.angle=Math.acos(nr(h,m))}}function v1(s,r){if(s.angle===0)return null;let o;return o=s.a[r]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),o<0||o>1?null:(function(u,h,m,g){const b=Math.sin(m);return u*(Math.sin((1-g)*m)/b)+h*(Math.sin(g*m)/b)})(s.a[r],s.b[r],s.angle,Ie(o,0,1))+s.center[r]}function yl(s){if(s.z<=1)return oH[s.z+2*s.y+s.x];const r=x1(Wv(s));return hr.fromPoints(r)}function uc(s,r,o){return qt(s,s,1-o),rr(s,s,r,o)}function oM(s,r,o){for(const u of s)or(u,u,r),qt(u,u,o)}function aM(s,r,o,u){const h=r/s.worldSize,m=s.globeMatrix;if(o.z<=1){const Le=yl(o).getCorners();return oM(Le,m,h),hr.fromPoints(Le)}const g=Wv(o,u),b=x1(g,f+Hv(s._tileCoverLift));oM(b,m,h);const S=Number.MAX_VALUE,E=[-S,-S,-S],O=[S,S,S];if(g.contains(s.center)){for(const Ue of b)yt(O,O,Ue),ar(E,E,Ue);E[2]=0;const Le=s.point,ct=[Le.x*h,Le.y*h,0];return yt(O,O,ct),ar(E,E,ct),new hr(O,E)}if(s._tileCoverLift>0){for(const Le of b)yt(O,O,Le),ar(E,E,Le);return new hr(O,E)}const D=[m[12]*h,m[13]*h,m[14]*h],N=g.getCenter(),B=Ie(s.center.lat,-Te,Te),U=Ie(N.lat,-Te,Te),X=me(s.center.lng),Q=we(B);let ee=X-me(N.lng);const ue=Q-we(U);ee>.5?ee-=1:ee<-.5&&(ee+=1);let he=0;Math.abs(ee)>Math.abs(ue)?he=ee>=0?1:3:(he=ue>=0?0:2,rr(D,D,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(Fe(ue>=0?g.getSouth():g.getNorth()))*f));const pe=b[he],Ae=b[(he+1)%4],Ee=new aH(pe,Ae,D),Oe=[v1(Ee,0)||pe[0],v1(Ee,1)||pe[1],v1(Ee,2)||pe[2]],De=yu(s.zoom);if(De>0){const Le=(function({x:Ue,y:ut,z:_t},ht,ft,bt,st){const mt=1/(1<<_t);let Ke=Ue*mt,Ge=Ke+mt,St=ut*mt,vt=St+mt,Qt=0;const zt=(Ke+Ge)/2-bt;return zt>.5?Qt=-1:zt<-.5&&(Qt=1),Ke=((Ke+Qt)*ht-(bt*=ht))*ft+bt,Ge=((Ge+Qt)*ht-bt)*ft+bt,St=(St*ht-(st*=ht))*ft+st,vt=(vt*ht-st)*ft+st,[[Ke,vt,0],[Ge,vt,0],[Ge,St,0],[Ke,St,0]]})(o,r,s._pixelsPerMercatorPixel,X,Q);for(let Ue=0;Ue<b.length;Ue++)uc(b[Ue],Le[Ue],De);const ct=it([],Le[he],Le[(he+1)%4]);qt(ct,ct,.5),uc(Oe,ct,De)}for(const Le of b)yt(O,O,Le),ar(E,E,Le);return O[2]=Math.min(pe[2],Ae[2]),yt(O,O,Oe),ar(E,E,Oe),new hr(O,E)}function Wv({x:s,y:r,z:o},u=!1){const h=1/(1<<o),m=new Z(Se(s*h),r===(1<<o)-1&&u?-90:be((r+1)*h)),g=new Z(Se((s+1)*h),r===0&&u?90:be(r*h));return new oe(m,g)}function x1(s,r=f){const o=Fe(s.getNorth()),u=Fe(s.getSouth()),h=Math.cos(o),m=Math.cos(u),g=Math.sin(o),b=Math.sin(u),S=s.getWest(),E=s.getEast();return[V(m,b,S,r),V(m,b,E,r),V(h,g,E,r),V(h,g,S,r)]}function Ag(s,r,o,u){const h=1<<o.z,m=(s/Mt+o.x)/h;return z(be((r/Mt+o.y)/h),Se(m),u)}function Zv({min:s,max:r}){return w/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const sM=new Float64Array(16);function Xv(s){const r=Zv(s),o=de(sM,[r,r,r]);return K(o,o,An([],s.min))}function b1(s){const r=(u=s.min,(o=sM)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o);var o,u;const h=1/Zv(s);return re(r,r,[h,h,h])}function w1(s){const r=Mt/(2*Math.PI);return s/(2*Math.PI)/r}function lM(s,r){return Mt/(512*Math.pow(2,s))*Zv(yl(r))}function cM(s,r,o,u,h){const m=w1(o),g=[s,r,-o/(2*Math.PI)],b=j(new Float64Array(16));return K(b,b,g),re(b,b,[m,m,m]),se(b,b,Fe(-h)),J(b,b,Fe(-u)),b}function yu(s){return Ye(y,x,s)}function uM(s,r){const o=z(r.lat,r.lng),u=(function(U){const X=z(U._center.lat,U._center.lng);let Q=Dr([],Je(0,1,0),X);const ee=Pe([],-U.angle,X);Q=or(Q,Q,ee),Pe(ee,-U._pitch,Q);const ue=Fr([],X);return qt(ue,ue,Hv(U.cameraToCenterDistance/U.pixelsPerMeter)),or(ue,ue,ee),it([],X,ue)})(s);return g=(h=Pt([],u,o))[0],b=h[1],S=h[2],E=(m=o)[0],O=m[1],D=m[2],B=(N=Math.sqrt((g*g+b*b+S*S)*(E*E+O*O+D*D)))&&nr(h,m)/N,Math.acos(Math.min(Math.max(B,-1),1));var h,m,g,b,S,E,O,D,N,B}function S1(s,r){return uM(s,r)>Math.PI/2*1.01}const hM=Fe(85),sH=Math.cos(hM),lH=Math.sin(hM),cH=H(),dM=s=>{const r=[];return s.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function fM(s,r,o,u,h,m,g,b,S){if(m&&s.queryGeometry.isAboveHorizon)return!1;m&&(S*=s.pixelToTileUnitsFactor);const E=s.tileID.canonical,O=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const D of r)for(const N of D){const B=N.add(b),U=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(B.x,B.y,!0):0,X=o.projection.projectTilePoint(B.x,B.y,E);if(U>0){const he=o.projection.upVector(E,B.x,B.y);X.x+=he[0]*O*U,X.y+=he[1]*O*U,X.z+=he[2]*O*U}const Q=m?B:uH(X.x,X.y,X.z,u),ee=m?s.tilespaceRays.map((he=>dH(he,U))):s.queryGeometry.screenGeometry,ue=Ni([],[X.x,X.y,X.z,1],u);if(!g&&m?S*=ue[3]/o.cameraToCenterDistance:g&&!m&&(S*=o.cameraToCenterDistance/ue[3]),m){const he=be((N.y/Mt+E.y)/(1<<E.z));S/=o.projection.pixelsPerMeter(he,1)/xe(1,he)}if(ia(ee,Q,S))return!0}return!1}function uH(s,r,o,u){const h=Ni([],[s,r,o,1],u);return new wt(h[0]/h[3],h[1]/h[3])}const pM=Je(0,0,0),hH=Je(0,0,1);function dH(s,r){const o=ke();return pM[2]=r,s.intersectsPlane(pM,hH,o),new wt(o[0],o[1])}class mM extends qi{}let gM,_M,yM,vM;function xM(s,{width:r,height:o},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*o*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*o*u);return s.width=r,s.height=o,s.data=h,s}function bM(s,r,o){const{width:u,height:h}=r;u===s.width&&h===s.height||(T1(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,u),height:Math.min(s.height,h)},o,null),s.width=u,s.height=h,s.data=r.data)}function T1(s,r,o,u,h,m,g,b){if(h.width===0||h.height===0)return r;if(h.width>s.width||h.height>s.height||o.x>s.width-h.width||o.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||u.x>r.width-h.width||u.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const S=s.data,E=r.data,O=m===4&&b;for(let D=0;D<h.height;D++){const N=((o.y+D)*s.width+o.x)*m,B=((u.y+D)*r.width+u.x)*m;if(O)for(let U=0;U<h.width;U++){const X=N+U*m+3,Q=B+U*m;E[Q+0]=255,E[Q+1]=255,E[Q+2]=255,E[Q+3]=S[X]}else if(g)for(let U=0;U<h.width;U++){const X=N+U*m,Q=B+U*m,ee=new cn(S[X+0]/255,S[X+1]/255,S[X+2]/255,S[X+3]).toNonPremultipliedRenderColor(g).toArray();E[Q+0]=ee[0],E[Q+1]=ee[1],E[Q+2]=ee[2],E[Q+3]=ee[3]}else for(let U=0;U<h.width*m;U++)E[B+U]=S[N+U]}return r}Ut(mM,"HeatmapBucket",{omit:["layers"]});class vu{constructor(r,o){xM(this,r,1,o)}resize(r){bM(this,new vu(r),1)}clone(){return new vu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,h,m){T1(r,o,u,h,m,1,null)}}class eo{constructor(r,o){xM(this,r,4,o)}resize(r){bM(this,new eo(r),4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,h,m,g,b){T1(r,o,u,h,m,4,g,b)}}class wM{constructor(r,o){this.width=r.width,this.height=r.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function Eg(s){const r={},o=s.resolution||256,u=s.clips?s.clips.length:1,h=s.image||new eo({width:o,height:u}),m=(g,b,S)=>{r[s.evaluationKey]=S;const E=s.expression.evaluate(r),O=E?E.toNonPremultipliedRenderColor(null):null;O&&(h.data[g+b+0]=Math.floor(255*O.r),h.data[g+b+1]=Math.floor(255*O.g),h.data[g+b+2]=Math.floor(255*O.b),h.data[g+b+3]=Math.floor(255*O.a))};if(s.clips)for(let g=0,b=0;g<u;++g,b+=4*o)for(let S=0,E=0;S<o;S++,E+=4){const O=S/(o-1),{start:D,end:N}=s.clips[g];m(b,E,D*(1-O)+N*O)}else for(let g=0,b=0;g<o;g++,b+=4)m(0,b,g/(o-1));return h}Ut(vu,"AlphaImage"),Ut(eo,"RGBAImage");const fH=qr([{name:"a_pos",components:2,type:"Int16"}],4),pH=qr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),mH=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),gH=qr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ff(s,r,o=2){const u=r&&r.length,h=u?r[0]*o:s.length;let m=SM(s,0,h,o,!0);const g=[];if(!m||m.next===m.prev)return g;let b,S,E;if(u&&(m=(function(O,D,N,B){const U=[];for(let X=0,Q=D.length;X<Q;X++){const ee=SM(O,D[X]*B,X<Q-1?D[X+1]*B:O.length,B,!1);ee===ee.next&&(ee.steiner=!0),U.push(TH(ee))}U.sort(bH);for(let X=0;X<U.length;X++)N=wH(U[X],N);return N})(s,r,m,o)),s.length>80*o){b=s[0],S=s[1];let O=b,D=S;for(let N=o;N<h;N+=o){const B=s[N],U=s[N+1];B<b&&(b=B),U<S&&(S=U),B>O&&(O=B),U>D&&(D=U)}E=Math.max(O-b,D-S),E=E!==0?32767/E:0}return Pg(m,g,o,b,S,E,0),g}function SM(s,r,o,u,h){let m;if(h===(function(g,b,S,E){let O=0;for(let D=b,N=S-E;D<S;D+=E)O+=(g[N]-g[D])*(g[D+1]+g[N+1]),N=D;return O})(s,r,o,u)>0)for(let g=r;g<o;g+=u)m=PM(g/u|0,s[g],s[g+1],m);else for(let g=o-u;g>=r;g-=u)m=PM(g/u|0,s[g],s[g+1],m);return m&&Bf(m,m.next)&&(Og(m),m=m.next),m}function jh(s,r){if(!s)return s;r||(r=s);let o,u=s;do if(o=!1,u.steiner||!Bf(u,u.next)&&Ui(u.prev,u,u.next)!==0)u=u.next;else{if(Og(u),u=r=u.prev,u===u.next)break;o=!0}while(o||u!==r);return r}function Pg(s,r,o,u,h,m,g){if(!s)return;!g&&m&&(function(S,E,O,D){let N=S;do N.z===0&&(N.z=A1(N.x,N.y,E,O,D)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,(function(B){let U,X=1;do{let Q,ee=B;B=null;let ue=null;for(U=0;ee;){U++;let he=ee,pe=0;for(let Ee=0;Ee<X&&(pe++,he=he.nextZ,he);Ee++);let Ae=X;for(;pe>0||Ae>0&&he;)pe!==0&&(Ae===0||!he||ee.z<=he.z)?(Q=ee,ee=ee.nextZ,pe--):(Q=he,he=he.nextZ,Ae--),ue?ue.nextZ=Q:B=Q,Q.prevZ=ue,ue=Q;ee=he}ue.nextZ=null,X*=2}while(U>1)})(N)})(s,u,h,m);let b=s;for(;s.prev!==s.next;){const S=s.prev,E=s.next;if(m?yH(s,u,h,m):_H(s))r.push(S.i,s.i,E.i),Og(s),s=E.next,b=E.next;else if((s=E)===b){g?g===1?Pg(s=vH(jh(s),r),r,o,u,h,m,2):g===2&&xH(s,r,o,u,h,m):Pg(jh(s),r,o,u,h,m,1);break}}}function _H(s){const r=s.prev,o=s,u=s.next;if(Ui(r,o,u)>=0)return!1;const h=r.x,m=o.x,g=u.x,b=r.y,S=o.y,E=u.y,O=Math.min(h,m,g),D=Math.min(b,S,E),N=Math.max(h,m,g),B=Math.max(b,S,E);let U=u.next;for(;U!==r;){if(U.x>=O&&U.x<=N&&U.y>=D&&U.y<=B&&Ig(h,b,m,S,g,E,U.x,U.y)&&Ui(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function yH(s,r,o,u){const h=s.prev,m=s,g=s.next;if(Ui(h,m,g)>=0)return!1;const b=h.x,S=m.x,E=g.x,O=h.y,D=m.y,N=g.y,B=Math.min(b,S,E),U=Math.min(O,D,N),X=Math.max(b,S,E),Q=Math.max(O,D,N),ee=A1(B,U,r,o,u),ue=A1(X,Q,r,o,u);let he=s.prevZ,pe=s.nextZ;for(;he&&he.z>=ee&&pe&&pe.z<=ue;){if(he.x>=B&&he.x<=X&&he.y>=U&&he.y<=Q&&he!==h&&he!==g&&Ig(b,O,S,D,E,N,he.x,he.y)&&Ui(he.prev,he,he.next)>=0||(he=he.prevZ,pe.x>=B&&pe.x<=X&&pe.y>=U&&pe.y<=Q&&pe!==h&&pe!==g&&Ig(b,O,S,D,E,N,pe.x,pe.y)&&Ui(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;he&&he.z>=ee;){if(he.x>=B&&he.x<=X&&he.y>=U&&he.y<=Q&&he!==h&&he!==g&&Ig(b,O,S,D,E,N,he.x,he.y)&&Ui(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;pe&&pe.z<=ue;){if(pe.x>=B&&pe.x<=X&&pe.y>=U&&pe.y<=Q&&pe!==h&&pe!==g&&Ig(b,O,S,D,E,N,pe.x,pe.y)&&Ui(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function vH(s,r){let o=s;do{const u=o.prev,h=o.next.next;!Bf(u,h)&&AM(u,o,o.next,h)&&Cg(u,h)&&Cg(h,u)&&(r.push(u.i,o.i,h.i),Og(o),Og(o.next),o=s=h),o=o.next}while(o!==s);return jh(o)}function xH(s,r,o,u,h,m){let g=s;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&AH(g,b)){let S=EM(g,b);return g=jh(g,g.next),S=jh(S,S.next),Pg(g,r,o,u,h,m,0),void Pg(S,r,o,u,h,m,0)}b=b.next}g=g.next}while(g!==s)}function bH(s,r){let o=s.x-r.x;return o===0&&(o=s.y-r.y,o===0)&&(o=(s.next.y-s.y)/(s.next.x-s.x)-(r.next.y-r.y)/(r.next.x-r.x)),o}function wH(s,r){const o=(function(h,m){let g=m;const b=h.x,S=h.y;let E,O=-1/0;if(Bf(h,g))return g;do{if(Bf(h,g.next))return g.next;if(S<=g.y&&S>=g.next.y&&g.next.y!==g.y){const X=g.x+(S-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(X<=b&&X>O&&(O=X,E=g.x<g.next.x?g:g.next,X===b))return E}g=g.next}while(g!==m);if(!E)return null;const D=E,N=E.x,B=E.y;let U=1/0;g=E;do{if(b>=g.x&&g.x>=N&&b!==g.x&&TM(S<B?b:O,S,N,B,S<B?O:b,S,g.x,g.y)){const X=Math.abs(S-g.y)/(b-g.x);Cg(g,h)&&(X<U||X===U&&(g.x>E.x||g.x===E.x&&SH(E,g)))&&(E=g,U=X)}g=g.next}while(g!==D);return E})(s,r);if(!o)return r;const u=EM(o,s);return jh(u,u.next),jh(o,o.next)}function SH(s,r){return Ui(s.prev,s,r.prev)<0&&Ui(r.next,s,s.next)<0}function A1(s,r,o,u,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-o)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function TH(s){let r=s,o=s;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==s);return o}function TM(s,r,o,u,h,m,g,b){return(h-g)*(r-b)>=(s-g)*(m-b)&&(s-g)*(u-b)>=(o-g)*(r-b)&&(o-g)*(m-b)>=(h-g)*(u-b)}function Ig(s,r,o,u,h,m,g,b){return!(s===g&&r===b)&&TM(s,r,o,u,h,m,g,b)}function AH(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!(function(o,u){let h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==u.i&&h.next.i!==u.i&&AM(h,h.next,o,u))return!0;h=h.next}while(h!==o);return!1})(s,r)&&(Cg(s,r)&&Cg(r,s)&&(function(o,u){let h=o,m=!1;const g=(o.x+u.x)/2,b=(o.y+u.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&g<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==o);return m})(s,r)&&(Ui(s.prev,s,r.prev)||Ui(s,r.prev,r))||Bf(s,r)&&Ui(s.prev,s,s.next)>0&&Ui(r.prev,r,r.next)>0)}function Ui(s,r,o){return(r.y-s.y)*(o.x-r.x)-(r.x-s.x)*(o.y-r.y)}function Bf(s,r){return s.x===r.x&&s.y===r.y}function AM(s,r,o,u){const h=Yv(Ui(s,r,o)),m=Yv(Ui(s,r,u)),g=Yv(Ui(o,u,s)),b=Yv(Ui(o,u,r));return h!==m&&g!==b||!(h!==0||!Kv(s,o,r))||!(m!==0||!Kv(s,u,r))||!(g!==0||!Kv(o,s,u))||!(b!==0||!Kv(o,r,u))}function Kv(s,r,o){return r.x<=Math.max(s.x,o.x)&&r.x>=Math.min(s.x,o.x)&&r.y<=Math.max(s.y,o.y)&&r.y>=Math.min(s.y,o.y)}function Yv(s){return s>0?1:s<0?-1:0}function Cg(s,r){return Ui(s.prev,s,s.next)<0?Ui(s,r,s.next)>=0&&Ui(s,s.prev,r)>=0:Ui(s,r,s.prev)<0||Ui(s,s.next,r)<0}function EM(s,r){const o=E1(s.i,s.x,s.y),u=E1(r.i,r.x,r.y),h=s.next,m=r.prev;return s.next=r,r.prev=s,o.next=h,h.prev=o,u.next=o,o.prev=u,m.next=u,u.prev=m,u}function PM(s,r,o,u){const h=E1(s,r,o);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Og(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function E1(s,r,o){return{i:s,x:r,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mg(s,r){const o=s.length;if(o<=1)return[s];const u=[];let h,m;for(let g=0;g<o;g++){const b=vi(s[g]);b!==0&&(s[g].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(h&&u.push(h),h=[s[g]]):h.push(s[g]))}if(h&&u.push(h),r>1)for(let g=0;g<u.length;g++)u[g].length<=r||(Qy(u[g],r,1,u[g].length-1,EH),u[g]=u[g].slice(0,r));return u}function EH(s,r){return r.area-s.area}function IM(s,r,o=1){if(!s)return null;const u=typeof s=="string"?Ro.from(s).getPrimary():s.getPrimary(),h=typeof s=="string"?null:s.getSecondary();for(const m of[u,h]){if(!m)continue;const g=m.id.toString();r.has(g)||r.set(g,[]),m.scaleSelf(o),r.get(g).push(m)}return{primary:u.toString(),secondary:h?h.toString():null}}function P1(s,r,o,u){const h=u.patternDependencies;let m=!1;for(const g of r){const b=g.paint.get(`${s}-pattern`);b.isConstant()||(m=!0),IM(b.constantOr(null),h,o)&&(m=!0)}return m}function I1(s,r,o,u,h,m){const g=m.patternDependencies;for(const b of r){const S=b.paint.get(`${s}-pattern`).value;if(S.kind!=="constant"){let E=S.evaluate({zoom:u},o,{},m.availableImages);E=E&&E.name?E.name:E;const O=IM(E,g,h);if(!O)continue;const{primary:D,secondary:N}=O;D&&(o.patterns[b.id]=[D,N].filter(Boolean))}}return o}class CM{constructor(){this.polygons=new Map}add(r,...o){const u=this.polygons.get(r);u?u.push(...o):this.polygons.set(r,o)}merge(r){for(const[o,u]of r.polygons)this.add(o,...u)}}class hc{constructor(){this.portals=[]}static isOnBorder(r,o){return r<=0&&o<=0||r>=Mt&&o>=Mt}static evaluate(r){if(r.length===0)return new hc;let o=[];for(const S of r)o.push(...S.portals);if(o.length===0)return new hc;for(const S of o){const E=S.va,O=S.vb;(hc.isOnBorder(E.x,O.x)||hc.isOnBorder(E.y,O.y))&&(S.type="border")}const u=o.filter((S=>S.type!=="unevaluated")),h=o.filter((S=>S.type==="unevaluated"));if(h.length===0)return new hc;h.sort(((S,E)=>S.hash===E.hash?S.isTunnel===E.isTunnel?0:S.isTunnel?-1:1:S.hash<E.hash?1:-1)),o=u.concat(h);let m=u.length,g=m,b=m;do if(g++,g===o.length||o[m].hash!==o[g].hash){if(g-m==2){b<m&&(o[b]=o[m],o[m]=null);const S=o[b],E=o[g-1];S.type=S.isTunnel!==E.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:E.connection.a},b++}m=g}while(m!==o.length);return o.splice(b),o.sort(((S,E)=>S.hash<E.hash?1:-1)),{portals:o}}}Ut(hc,"ElevationPortalGraph"),Ut(CM,"ElevationPolygons");class PH{constructor(r,o,u){this.outPositions=r,this.outNormals=o,this.outIndices=u,this.vertexLookup=new Map}addVertex(r,o,u){let h=r[2];u!=null&&(h*=u);const m=`${r[0]},${r[1]},${r[2]},${o[0]},${o[1]},${o[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;const b=this.outPositions.length;this.vertexLookup.set(m,b);const S=Math.trunc(16384*o[0]),E=Math.trunc(16384*o[1]),O=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(r[0],r[1],h),this.outNormals.emplaceBack(S,E,O),b}addTriangle(r,o,u){this.outIndices.emplaceBack(r,o,u)}addTriangles(r,o,u){if(r.length===0)return;const h=u.length===1,m=ke(),g=ke();for(let b=0;b<r.length;b+=3){const S=o[r[b+0]],E=o[r[b+1]],O=o[r[b+2]],D=h?u[0]:u[r[b+1]],N=h?u[0]:u[r[b+2]];ot(m,S.x,S.y,h?u[0]:u[r[b+0]]);const B=this.addVertex(m,g);ot(m,E.x,E.y,D);const U=this.addVertex(m,g);ot(m,O.x,O.y,N);const X=this.addVertex(m,g);this.outIndices.emplaceBack(B,U,X)}}addQuad(r,o,u,h,m,g){const b=this.addVertex(r,m,g),S=this.addVertex(o,m,g),E=this.addVertex(u,m,g),O=this.addVertex(h,m,g);this.addTriangle(b,S,E),this.addTriangle(E,O,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class oa{constructor(r,o,u,h){this.unevaluatedPortals=new hc,this.portalPolygons=new CM,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new dg,this.vertexNormals=new Ef,this.indexArray=new Oi,this.tileToMeters=Ve(r),this.bridgeProgramConfigurations=new Ia(o,{zoom:u,lut:h},(m=>m!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Ia(o,{zoom:u,lut:h},(m=>m!=="fill-bridge-guard-rail-color"))}addVertices(r,o){const u=this.unevalVertices.length;for(let h=0;h<r.length;h++)this.unevalVertices.push(r[h]),this.unevalHeights.push(o[h]);return u}addTriangles(r,o,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of r)h.push(m+o)}addRenderableRing(r,o,u,h,m,g){const b=[new wt(m.min.x,m.min.y),new wt(m.max.x,m.min.y),new wt(m.max.x,m.max.y),new wt(m.min.x,m.max.y)];for(let S=0;S<u-1;S++){const E=o+S,O=E+1,D=this.unevalVertices[E],N=this.unevalVertices[O];if(!(D.x>=m.min.x&&D.x<=m.max.x&&D.y>=m.min.y&&D.y<=m.max.y||N.x>=m.min.x&&N.x<=m.max.x&&N.y>=m.min.y&&N.y<=m.max.y||Qi(D,N,b))||this.isOnBorder(D.x,N.x)||this.isOnBorder(D.y,N.y))continue;const B=oa.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[O]);let U,X=this.vertexHashLookup.get(oa.computePosHash(D));X!=null?U=X.next:(X=this.vertexHashLookup.get(oa.computePosHash(N)),U=X!=null?X.prev:B),this.unevalEdges.push({polygonIdx:r,a:E,b:O,hash:B,portalHash:U,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(r,o,u,h,m){if(o.length===0)return;this.portalPolygons.add(r,{geometry:o,zLevel:m});const g=o[0];this.vertexHashLookup.clear();let b=oa.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let S=0;S<g.length-1;S++){const E=g[S+0],O=g[S+1],D=ya(O.x-E.x,O.y-E.y),N=jl(D);if(N===0)continue;let B="unevaluated";const U=h.pointElevation(E),X=h.pointElevation(O);Math.abs(U)<.01&&Math.abs(X)<.01?B="entrance":(this.isOnBorder(E.x,O.x)||this.isOnBorder(E.y,O.y))&&(B="border");const Q=oa.computeEdgeHash(E,O);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:E,vb:O,vab:D,length:N,hash:Q,isTunnel:u,type:B});const ee=oa.computePosHash(E);this.vertexHashLookup.set(ee,{prev:b,next:Q}),b=Q}}construct(r){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},h=new PH(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const m=o(),g=o(),b=o(),S=(N,B)=>{N.sort(((X,Q)=>X.type===B&&Q.type!==B?-1:X.type!==B&&Q.type===B?1:0));const U=N.findIndex((X=>X.type!==B));return U>=0?U:N.length};let E=0;this.unevalEdges.length>0&&(E=S(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),u(b);const O=o(),D=o();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(E),B=S(N,"tunnel")+E;this.unevalEdges.push(...N),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:B})}u(O),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(D),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(m),this.maskSegments=Hn.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=Hn.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=Hn.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=Hn.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.shadowCasterSegments=Hn.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(r,o,u,h,m,g,b,S){this.bridgeProgramConfigurations.updatePaintArrays(r,o,m,u,h,g,b,S),this.tunnelProgramConfigurations.updatePaintArrays(r,o,m,u,h,g,b,S)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,mH.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,gH.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,o,u,h,m){const g=(b,S)=>{for(let E=0;E<S.length-1;E++){const O=S[E].featureIndex,D=S[E+1].vertexStart,N=r.feature(O);b.populatePaintArrays(D,N,O,{},u,o,h,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,o,u,h,m){const g=new Map;for(let b=h;b<m;b++){const S=u[b],E=S.a,O=S.b,D=oa.computePosHash(r[E]),N=oa.computePosHash(r[O]);let B=g.get(D);B||(B={},g.set(D,B));let U=g.get(N);U||(U={},g.set(N,U)),o[E]<=0&&o[O]<=0||(B.to=O,U.from=E)}return g}isTerminalVertex(r,o){const u=oa.computePosHash(this.unevalVertices[r]),h=o.get(u);return!h||!h.from||!h.to}constructBridgeStructures(r,o,u,h,m,g){r.clearVertexLookup();const b=this.computeVertexConnections(o,u,h,m.min,m.max),S=1/g,E=.5*S,O=(ft,bt)=>ot(ft,o[bt].x,o[bt].y,u[bt]*S),D=ke(),N=ke(),B=ke(),U=ke(),X=ke(),Q=(ft,bt)=>{const st=b.get(oa.computePosHash(o[bt])),mt=st.from,Ke=st.to;if(!mt||!Ke)return;O(D,mt),O(N,bt),O(B,Ke),bn(U),Hr(D,N)||(Zr(X,N,D),Fr(U,X)),Hr(B,N)||(Zr(X,B,N),it(U,U,Fr(X,X)));const Ge=hi(U);return Ge>0?qt(ft,U,1/Ge):void 0};let ee=Number.POSITIVE_INFINITY;this.sortSubarray(h,m.min,m.max,((ft,bt)=>ft.featureInfo.featureIndex-bt.featureInfo.featureIndex));const ue=ke(),he=ke(),pe=ke(),Ae=ke(),Ee=ke(),Oe=ke(),De=ke(),Le=ke(),ct=ke(),Ue=[ke(),ke(),ke(),ke()],ut=[ke(),ke(),ke(),ke()],_t=[{coord:new wt(0,0),height:0},{coord:new wt(0,0),height:0}],ht=(ft,bt)=>ft>bt;for(let ft=m.min;ft<m.max;ft++){const bt=h[ft];if(!bt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(_t,o,u,bt,ht))continue;const[st,mt]=_t;if(ot(ue,st.coord.x,st.coord.y,S*st.height),ot(he,mt.coord.x,mt.coord.y,S*mt.height),Hr(ue,he))continue;Zr(pe,he,ue),Fr(pe,pe);const Ke=Q(Le,bt.a)||pe,Ge=Q(ct,bt.b)||pe;ot(Ae,Ke[1],-Ke[0],0),Fr(Ae,Ae),ot(Ee,Ge[1],-Ge[0],0),Fr(Ee,Ee),Dr(Le,Ae,Ke),Fr(Oe,Le),Dr(Le,Ee,Ge),Fr(De,Le),it(Ue[0],ue,qt(Le,Zr(Le,Ae,Oe),E)),it(Ue[1],ue,qt(Le,it(Le,Ae,Oe),E)),it(Ue[2],ue,qt(Le,Oe,E)),Ue[3]=ue,it(ut[0],he,qt(Le,Zr(Le,Ee,De),E)),it(ut[1],he,qt(Le,it(Le,Ee,De),E)),it(ut[2],he,qt(Le,De,E)),ut[3]=he,ee=this.addFeatureSection(bt.featureInfo.featureIndex,ee,this.bridgeFeatureSections,r);const St=r.addVertex(Ue[0],Ae,g),vt=r.addVertex(Ue[1],Ae,g),Qt=r.addVertex(ut[0],Ee,g),zt=r.addVertex(ut[1],Ee,g);r.addTriangle(St,vt,Qt),r.addTriangle(vt,zt,Qt);const Gt=r.addVertex(Ue[1],Oe,g),Ct=r.addVertex(Ue[2],Oe,g),Yt=r.addVertex(ut[1],De,g),_r=r.addVertex(ut[2],De,g);r.addTriangle(Gt,Ct,Yt),r.addTriangle(Ct,_r,Yt),An(Ae,Ae),An(Ee,Ee);const kt=r.addVertex(Ue[2],Ae,g),Zt=r.addVertex(Ue[3],Ae,g),cr=r.addVertex(ut[2],Ee,g),xr=r.addVertex(ut[3],Ee,g);r.addTriangle(kt,Zt,cr),r.addTriangle(Zt,xr,cr);const kr=this.isTerminalVertex(bt.a,b),Sr=this.isTerminalVertex(bt.b,b);st.height<.01&&kr&&r.addQuad(Ue[3],Ue[2],Ue[1],Ue[0],An(Ke,Ke),g),mt.height<.01&&Sr&&r.addQuad(ut[0],ut[1],ut[2],ut[3],Ge,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,o,u,h,m,g){r.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const S=(ee,ue)=>ee.featureInfo.featureIndex-ue.featureInfo.featureIndex;this.sortSubarray(h,m.min,m.max,S),this.sortSubarray(h,g.min,g.max,S);const E=ee=>Fr(ee,ee),O=[{coord:new wt(0,0),height:0},{coord:new wt(0,0),height:0}],D=(ee,ue)=>ee<ue,N=ke(),B=ke(),U=ke(),X=ke(),Q=ke();for(let ee=m.min;ee<m.max;ee++){if(!this.prepareEdgePoints(O,o,u,h[ee],D))continue;const[ue,he]=O,pe=E(ot(Q,-(he.coord.y-ue.coord.y),he.coord.x-ue.coord.x,0));b=this.addFeatureSection(h[ee].featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(ot(N,ue.coord.x,ue.coord.y,ue.height),ot(B,he.coord.x,he.coord.y,he.height),ot(U,he.coord.x,he.coord.y,h[ee].isTunnel?-.1:0),ot(X,ue.coord.x,ue.coord.y,h[ee].isTunnel?-.1:0),pe)}for(let ee=g.min;ee<g.max;ee++){const ue=h[ee];ue.isTunnel&&([ue.a,ue.b]=[ue.b,ue.a]);const he=o[ue.a],pe=o[ue.b],Ae=E(ot(Q,-(pe.y-he.y),pe.x-he.x,0));b=this.addFeatureSection(ue.featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(ot(N,pe.x,pe.y,0),ot(B,he.x,he.y,0),ot(U,he.x,he.y,u[ue.a]+4),ot(X,pe.x,pe.y,u[ue.b]+4),Ae),r.addQuad(ot(N,he.x,he.y,0),ot(B,pe.x,pe.y,0),ot(U,pe.x,pe.y,u[ue.b]+4),ot(X,he.x,he.y,u[ue.a]+4),Ae)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,o,u,h){r.coord.x=o,r.coord.y=u,r.height=h}prepareEdgePoints(r,o,u,h,m){let g=o[h.a].x,b=o[h.a].y,S=o[h.b].x,E=o[h.b].y,O=u[h.a],D=u[h.b];const N=m(O,0),B=m(D,0);if(N&&B)return this.setElevatedPoint(r[0],g,b,O),this.setElevatedPoint(r[1],S,E,D),!0;if(!N&&!B)return!1;if(N){if(!B){const U=D/(D-O);S=lr(S,g,U),E=lr(E,b,U),D=lr(D,O,U)}}else{const U=O/(O-D);g=lr(g,S,U),b=lr(b,E,U),O=lr(O,D,U)}return this.setElevatedPoint(r[0],g,b,O),this.setElevatedPoint(r[1],S,E,D),!0}prepareEdges(r,o){if(o.length===0)return;o.sort(((b,S)=>b.hash===S.hash?S.polygonIdx-b.polygonIdx:S.hash>b.hash?1:-1));let u=0,h=0,m=0,g=o[u].polygonIdx;do h++,(h===o.length||o[u].hash!==o[h].hash)&&((h-u==1||o[h-1].polygonIdx!==g)&&(m<u&&(o[m]=o[u],o[u]=null),o[m].type="none",m++),u=h,u!==o.length&&(g=o[u].polygonIdx));while(u!==o.length);if(o.splice(m),o.length!==0&&r.length!==0){o.sort(((E,O)=>E.portalHash<O.portalHash?1:-1));let b=0,S=0;for(;b!==o.length&&S!==r.length;){const E=o[b],O=r[S];E.portalHash>O.hash?b++:O.hash>E.portalHash?S++:(E.type=O.type,b++)}}}isOnBorder(r,o){return r<=0&&o<=0||r>=Mt&&o>=Mt}addFeatureSection(r,o,u,h){return r!==o&&(o=r,u.push({featureIndex:r,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),o}sortSubarray(r,o,u,h){const m=r.slice(o,u);m.sort(h),r.splice(o,m.length,...m)}static computeEdgeHash(r,o){return(r.y===o.y&&r.x>o.x||r.y>o.y)&&([r,o]=[o,r]),BigInt(oa.computePosHash(r))<<32n|BigInt(oa.computePosHash(o))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var OM,MM={exports:{}},RM=(OM||(OM=1,(function(s,r){(function(o){function u(ge,_e){return ge>_e?1:ge<_e?-1:0}var h=function(ge,_e){ge===void 0&&(ge=u),_e===void 0&&(_e=!1),this._compare=ge,this._root=null,this._size=0,this._noDuplicates=!!_e},m={size:{configurable:!0}};function g(ge,_e,Xe,lt,Dt){var Rt=Dt-lt;if(Rt>0){var Vt=lt+Math.floor(Rt/2),ir={key:_e[Vt],data:Xe[Vt],parent:ge};return ir.left=g(ir,_e,Xe,lt,Vt),ir.right=g(ir,_e,Xe,Vt+1,Dt),ir}return null}function b(ge,_e,Xe,lt,Dt){if(!(Xe>=lt)){for(var Rt=ge[Xe+lt>>1],Vt=Xe-1,ir=lt+1;;){do Vt++;while(Dt(ge[Vt],Rt)<0);do ir--;while(Dt(ge[ir],Rt)>0);if(Vt>=ir)break;var Nr=ge[Vt];ge[Vt]=ge[ir],ge[ir]=Nr,Nr=_e[Vt],_e[Vt]=_e[ir],_e[ir]=Nr}b(ge,_e,Xe,ir,Dt),b(ge,_e,ir+1,lt,Dt)}}h.prototype.rotateLeft=function(ge){var _e=ge.right;_e&&(ge.right=_e.left,_e.left&&(_e.left.parent=ge),_e.parent=ge.parent),ge.parent?ge===ge.parent.left?ge.parent.left=_e:ge.parent.right=_e:this._root=_e,_e&&(_e.left=ge),ge.parent=_e},h.prototype.rotateRight=function(ge){var _e=ge.left;_e&&(ge.left=_e.right,_e.right&&(_e.right.parent=ge),_e.parent=ge.parent),ge.parent?ge===ge.parent.left?ge.parent.left=_e:ge.parent.right=_e:this._root=_e,_e&&(_e.right=ge),ge.parent=_e},h.prototype._splay=function(ge){for(;ge.parent;){var _e=ge.parent;_e.parent?_e.left===ge&&_e.parent.left===_e?(this.rotateRight(_e.parent),this.rotateRight(_e)):_e.right===ge&&_e.parent.right===_e?(this.rotateLeft(_e.parent),this.rotateLeft(_e)):_e.left===ge&&_e.parent.right===_e?(this.rotateRight(_e),this.rotateLeft(_e)):(this.rotateLeft(_e),this.rotateRight(_e)):_e.left===ge?this.rotateRight(_e):this.rotateLeft(_e)}},h.prototype.splay=function(ge){for(var _e,Xe,lt,Dt,Rt;ge.parent;)(Xe=(_e=ge.parent).parent)&&Xe.parent?((lt=Xe.parent).left===Xe?lt.left=ge:lt.right=ge,ge.parent=lt):(ge.parent=null,this._root=ge),Dt=ge.left,Rt=ge.right,ge===_e.left?(Xe&&(Xe.left===_e?(_e.right?(Xe.left=_e.right,Xe.left.parent=Xe):Xe.left=null,_e.right=Xe,Xe.parent=_e):(Dt?(Xe.right=Dt,Dt.parent=Xe):Xe.right=null,ge.left=Xe,Xe.parent=ge)),Rt?(_e.left=Rt,Rt.parent=_e):_e.left=null,ge.right=_e,_e.parent=ge):(Xe&&(Xe.right===_e?(_e.left?(Xe.right=_e.left,Xe.right.parent=Xe):Xe.right=null,_e.left=Xe,Xe.parent=_e):(Rt?(Xe.left=Rt,Rt.parent=Xe):Xe.left=null,ge.right=Xe,Xe.parent=ge)),Dt?(_e.right=Dt,Dt.parent=_e):_e.right=null,ge.left=_e,_e.parent=ge)},h.prototype.replace=function(ge,_e){ge.parent?ge===ge.parent.left?ge.parent.left=_e:ge.parent.right=_e:this._root=_e,_e&&(_e.parent=ge.parent)},h.prototype.minNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.left;)ge=ge.left;return ge},h.prototype.maxNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.right;)ge=ge.right;return ge},h.prototype.insert=function(ge,_e){var Xe=this._root,lt=null,Dt=this._compare;if(this._noDuplicates)for(;Xe;){if(lt=Xe,Dt(Xe.key,ge)===0)return;Xe=Dt(Xe.key,ge)<0?Xe.right:Xe.left}else for(;Xe;)lt=Xe,Xe=Dt(Xe.key,ge)<0?Xe.right:Xe.left;return Xe={key:ge,data:_e,left:null,right:null,parent:lt},lt?Dt(lt.key,Xe.key)<0?lt.right=Xe:lt.left=Xe:this._root=Xe,this.splay(Xe),this._size++,Xe},h.prototype.find=function(ge){for(var _e=this._root,Xe=this._compare;_e;){var lt=Xe(_e.key,ge);if(lt<0)_e=_e.right;else{if(!(lt>0))return _e;_e=_e.left}}return null},h.prototype.contains=function(ge){for(var _e=this._root,Xe=this._compare;_e;){var lt=Xe(ge,_e.key);if(lt===0)return!0;_e=lt<0?_e.left:_e.right}return!1},h.prototype.remove=function(ge){var _e=this.find(ge);if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var Xe=this.minNode(_e.right);Xe.parent!==_e&&(this.replace(Xe,Xe.right),Xe.right=_e.right,Xe.right.parent=Xe),this.replace(_e,Xe),Xe.left=_e.left,Xe.left.parent=Xe}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},h.prototype.removeNode=function(ge){if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var _e=this.minNode(ge.right);_e.parent!==ge&&(this.replace(_e,_e.right),_e.right=ge.right,_e.right.parent=_e),this.replace(ge,_e),_e.left=ge.left,_e.left.parent=_e}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},h.prototype.erase=function(ge){var _e=this.find(ge);if(_e){this.splay(_e);var Xe=_e.left,lt=_e.right,Dt=null;Xe&&(Xe.parent=null,Dt=this.maxNode(Xe),this.splay(Dt),this._root=Dt),lt&&(Xe?Dt.right=lt:this._root=lt,lt.parent=Dt),this._size--}},h.prototype.pop=function(){var ge=this._root,_e=null;if(ge){for(;ge.left;)ge=ge.left;_e={key:ge.key,data:ge.data},this.remove(ge.key)}return _e},h.prototype.next=function(ge){var _e=ge;if(_e)if(_e.right)for(_e=_e.right;_e&&_e.left;)_e=_e.left;else for(_e=ge.parent;_e&&_e.right===ge;)ge=_e,_e=_e.parent;return _e},h.prototype.prev=function(ge){var _e=ge;if(_e)if(_e.left)for(_e=_e.left;_e&&_e.right;)_e=_e.right;else for(_e=ge.parent;_e&&_e.left===ge;)ge=_e,_e=_e.parent;return _e},h.prototype.forEach=function(ge){for(var _e=this._root,Xe=[],lt=!1,Dt=0;!lt;)_e?(Xe.push(_e),_e=_e.left):Xe.length>0?(ge(_e=Xe.pop(),Dt++),_e=_e.right):lt=!0;return this},h.prototype.range=function(ge,_e,Xe,lt){for(var Dt=[],Rt=this._compare,Vt=this._root;Dt.length!==0||Vt;)if(Vt)Dt.push(Vt),Vt=Vt.left;else{if(Rt((Vt=Dt.pop()).key,_e)>0)break;if(Rt(Vt.key,ge)>=0&&Xe.call(lt,Vt))return this;Vt=Vt.right}return this},h.prototype.keys=function(){for(var ge=this._root,_e=[],Xe=[],lt=!1;!lt;)ge?(_e.push(ge),ge=ge.left):_e.length>0?(ge=_e.pop(),Xe.push(ge.key),ge=ge.right):lt=!0;return Xe},h.prototype.values=function(){for(var ge=this._root,_e=[],Xe=[],lt=!1;!lt;)ge?(_e.push(ge),ge=ge.left):_e.length>0?(ge=_e.pop(),Xe.push(ge.data),ge=ge.right):lt=!0;return Xe},h.prototype.at=function(ge){for(var _e=this._root,Xe=[],lt=!1,Dt=0;!lt;)if(_e)Xe.push(_e),_e=_e.left;else if(Xe.length>0){if(_e=Xe.pop(),Dt===ge)return _e;Dt++,_e=_e.right}else lt=!0;return null},h.prototype.load=function(ge,_e,Xe){if(ge===void 0&&(ge=[]),_e===void 0&&(_e=[]),Xe===void 0&&(Xe=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var lt=ge.length;return Xe&&b(ge,_e,0,lt-1,this._compare),this._root=g(null,ge,_e,0,lt),this._size=lt,this},h.prototype.min=function(){var ge=this.minNode(this._root);return ge?ge.key:null},h.prototype.max=function(){var ge=this.maxNode(this._root);return ge?ge.key:null},h.prototype.isEmpty=function(){return this._root===null},m.size.get=function(){return this._size},h.createTree=function(ge,_e,Xe,lt,Dt){return new h(Xe,Dt).load(ge,_e,lt)},Object.defineProperties(h.prototype,m);var S=0,E=1,O=2,D=3,N=0,B=1,U=2,X=3;function Q(ge,_e,Xe){_e===null?(ge.inOut=!1,ge.otherInOut=!0):(ge.isSubject===_e.isSubject?(ge.inOut=!_e.inOut,ge.otherInOut=_e.otherInOut):(ge.inOut=!_e.otherInOut,ge.otherInOut=_e.isVertical()?!_e.inOut:_e.inOut),_e&&(ge.prevInResult=!ee(_e,Xe)||_e.isVertical()?_e.prevInResult:_e));var lt=ee(ge,Xe);ge.resultTransition=lt?(function(Dt,Rt){var Vt,ir=!Dt.inOut,Nr=!Dt.otherInOut;switch(Rt){case N:Vt=ir&&Nr;break;case B:Vt=ir||Nr;break;case X:Vt=ir^Nr;break;case U:Vt=Dt.isSubject?ir&&!Nr:Nr&&!ir}return Vt?1:-1})(ge,Xe):0}function ee(ge,_e){switch(ge.type){case S:switch(_e){case N:return!ge.otherInOut;case B:return ge.otherInOut;case U:return ge.isSubject&&ge.otherInOut||!ge.isSubject&&!ge.otherInOut;case X:return!0}break;case O:return _e===N||_e===B;case D:return _e===U;case E:return!1}return!1}var ue=function(ge,_e,Xe,lt,Dt){this.left=_e,this.point=ge,this.otherEvent=Xe,this.isSubject=lt,this.type=Dt||S,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function pe(ge,_e){return ge[0]===_e[0]&&ge[1]===_e[1]}ue.prototype.isBelow=function(ge){var _e=this.point,Xe=this.otherEvent.point;return this.left?(_e[0]-ge[0])*(Xe[1]-ge[1])-(Xe[0]-ge[0])*(_e[1]-ge[1])>0:(Xe[0]-ge[0])*(_e[1]-ge[1])-(_e[0]-ge[0])*(Xe[1]-ge[1])>0},ue.prototype.isAbove=function(ge){return!this.isBelow(ge)},ue.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},ue.prototype.clone=function(){var ge=new ue(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ge.contourId=this.contourId,ge.resultTransition=this.resultTransition,ge.prevInResult=this.prevInResult,ge.isExteriorRing=this.isExteriorRing,ge.inOut=this.inOut,ge.otherInOut=this.otherInOut,ge},Object.defineProperties(ue.prototype,he);var Ae=11102230246251565e-32,Ee=134217729,Oe=(3+8*Ae)*Ae;function De(ge,_e,Xe,lt,Dt){var Rt,Vt,ir,Nr,Lr=_e[0],Rr=lt[0],fn=0,Vn=0;Rr>Lr==Rr>-Lr?(Rt=Lr,Lr=_e[++fn]):(Rt=Rr,Rr=lt[++Vn]);var Mr=0;if(fn<ge&&Vn<Xe)for(Rr>Lr==Rr>-Lr?(ir=Rt-((Vt=Lr+Rt)-Lr),Lr=_e[++fn]):(ir=Rt-((Vt=Rr+Rt)-Rr),Rr=lt[++Vn]),Rt=Vt,ir!==0&&(Dt[Mr++]=ir);fn<ge&&Vn<Xe;)Rr>Lr==Rr>-Lr?(ir=Rt-((Vt=Rt+Lr)-(Nr=Vt-Rt))+(Lr-Nr),Lr=_e[++fn]):(ir=Rt-((Vt=Rt+Rr)-(Nr=Vt-Rt))+(Rr-Nr),Rr=lt[++Vn]),Rt=Vt,ir!==0&&(Dt[Mr++]=ir);for(;fn<ge;)ir=Rt-((Vt=Rt+Lr)-(Nr=Vt-Rt))+(Lr-Nr),Lr=_e[++fn],Rt=Vt,ir!==0&&(Dt[Mr++]=ir);for(;Vn<Xe;)ir=Rt-((Vt=Rt+Rr)-(Nr=Vt-Rt))+(Rr-Nr),Rr=lt[++Vn],Rt=Vt,ir!==0&&(Dt[Mr++]=ir);return Rt===0&&Mr!==0||(Dt[Mr++]=Rt),Mr}function Le(ge){return new Float64Array(ge)}var ct=33306690738754716e-32,Ue=22204460492503146e-32,ut=11093356479670487e-47,_t=Le(4),ht=Le(8),ft=Le(12),bt=Le(16),st=Le(4);function mt(ge,_e,Xe){var lt=(function(Dt,Rt,Vt,ir,Nr,Lr){var Rr=(Rt-Lr)*(Vt-Nr),fn=(Dt-Nr)*(ir-Lr),Vn=Rr-fn;if(Rr===0||fn===0||Rr>0!=fn>0)return Vn;var Mr=Math.abs(Rr+fn);return Math.abs(Vn)>=ct*Mr?Vn:-(function(On,gn,en,Rn,Dn,Pn,Mn){var _n,jr,vn,Wn,dr,Kr,kn,Yn,Fn,Ti,wn,_i,Uo,to,Yi,Vo,bl,Ai,Fi=On-Dn,ro=en-Dn,Ao=gn-Pn,co=Rn-Pn;_t[0]=(Yi=(Yn=Fi-(kn=(Kr=Ee*Fi)-(Kr-Fi)))*(Ti=co-(Fn=(Kr=Ee*co)-(Kr-co)))-((to=Fi*co)-kn*Fn-Yn*Fn-kn*Ti))-((wn=Yi-(bl=(Yn=Ao-(kn=(Kr=Ee*Ao)-(Kr-Ao)))*(Ti=ro-(Fn=(Kr=Ee*ro)-(Kr-ro)))-((Vo=Ao*ro)-kn*Fn-Yn*Fn-kn*Ti)))+(dr=Yi-wn))+(dr-bl),_t[1]=(Uo=to-((_i=to+wn)-(dr=_i-to))+(wn-dr))-((wn=Uo-Vo)+(dr=Uo-wn))+(dr-Vo),_t[2]=_i-((Ai=_i+wn)-(dr=Ai-_i))+(wn-dr),_t[3]=Ai;var Eu=(function(hxe,Hk){for(var Wk=Hk[0],kS=1;kS<4;kS++)Wk+=Hk[kS];return Wk})(0,_t),l_=Ue*Mn;if(Eu>=l_||-Eu>=l_||(_n=On-(Fi+(dr=On-Fi))+(dr-Dn),vn=en-(ro+(dr=en-ro))+(dr-Dn),jr=gn-(Ao+(dr=gn-Ao))+(dr-Pn),Wn=Rn-(co+(dr=Rn-co))+(dr-Pn),_n===0&&jr===0&&vn===0&&Wn===0)||(l_=ut*Mn+Oe*Math.abs(Eu),(Eu+=Fi*Wn+co*_n-(Ao*vn+ro*jr))>=l_||-Eu>=l_))return Eu;st[0]=(Yi=(Yn=_n-(kn=(Kr=Ee*_n)-(Kr-_n)))*(Ti=co-(Fn=(Kr=Ee*co)-(Kr-co)))-((to=_n*co)-kn*Fn-Yn*Fn-kn*Ti))-((wn=Yi-(bl=(Yn=jr-(kn=(Kr=Ee*jr)-(Kr-jr)))*(Ti=ro-(Fn=(Kr=Ee*ro)-(Kr-ro)))-((Vo=jr*ro)-kn*Fn-Yn*Fn-kn*Ti)))+(dr=Yi-wn))+(dr-bl),st[1]=(Uo=to-((_i=to+wn)-(dr=_i-to))+(wn-dr))-((wn=Uo-Vo)+(dr=Uo-wn))+(dr-Vo),st[2]=_i-((Ai=_i+wn)-(dr=Ai-_i))+(wn-dr),st[3]=Ai;var M7=De(4,_t,4,st,ht);st[0]=(Yi=(Yn=Fi-(kn=(Kr=Ee*Fi)-(Kr-Fi)))*(Ti=Wn-(Fn=(Kr=Ee*Wn)-(Kr-Wn)))-((to=Fi*Wn)-kn*Fn-Yn*Fn-kn*Ti))-((wn=Yi-(bl=(Yn=Ao-(kn=(Kr=Ee*Ao)-(Kr-Ao)))*(Ti=vn-(Fn=(Kr=Ee*vn)-(Kr-vn)))-((Vo=Ao*vn)-kn*Fn-Yn*Fn-kn*Ti)))+(dr=Yi-wn))+(dr-bl),st[1]=(Uo=to-((_i=to+wn)-(dr=_i-to))+(wn-dr))-((wn=Uo-Vo)+(dr=Uo-wn))+(dr-Vo),st[2]=_i-((Ai=_i+wn)-(dr=Ai-_i))+(wn-dr),st[3]=Ai;var R7=De(M7,ht,4,st,ft);st[0]=(Yi=(Yn=_n-(kn=(Kr=Ee*_n)-(Kr-_n)))*(Ti=Wn-(Fn=(Kr=Ee*Wn)-(Kr-Wn)))-((to=_n*Wn)-kn*Fn-Yn*Fn-kn*Ti))-((wn=Yi-(bl=(Yn=jr-(kn=(Kr=Ee*jr)-(Kr-jr)))*(Ti=vn-(Fn=(Kr=Ee*vn)-(Kr-vn)))-((Vo=jr*vn)-kn*Fn-Yn*Fn-kn*Ti)))+(dr=Yi-wn))+(dr-bl),st[1]=(Uo=to-((_i=to+wn)-(dr=_i-to))+(wn-dr))-((wn=Uo-Vo)+(dr=Uo-wn))+(dr-Vo),st[2]=_i-((Ai=_i+wn)-(dr=Ai-_i))+(wn-dr),st[3]=Ai;var D7=De(R7,ft,4,st,bt);return bt[D7-1]})(Dt,Rt,Vt,ir,Nr,Lr,Mr)})(ge[0],ge[1],_e[0],_e[1],Xe[0],Xe[1]);return lt>0?-1:lt<0?1:0}function Ke(ge,_e){var Xe=ge.point,lt=_e.point;return Xe[0]>lt[0]?1:Xe[0]<lt[0]?-1:Xe[1]!==lt[1]?Xe[1]>lt[1]?1:-1:(function(Dt,Rt,Vt,ir){return Dt.left!==Rt.left?Dt.left?1:-1:mt(Vt,Dt.otherEvent.point,Rt.otherEvent.point)!==0?Dt.isBelow(Rt.otherEvent.point)?-1:1:!Dt.isSubject&&Rt.isSubject?1:-1})(ge,_e,Xe)}function Ge(ge,_e,Xe){var lt=new ue(_e,!1,ge,ge.isSubject),Dt=new ue(_e,!0,ge.otherEvent,ge.isSubject);return pe(ge.point,ge.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ge),lt.contourId=Dt.contourId=ge.contourId,Ke(Dt,ge.otherEvent)>0&&(ge.otherEvent.left=!0,Dt.left=!1),ge.otherEvent.otherEvent=Dt,ge.otherEvent=lt,Xe.push(Dt),Xe.push(lt),Xe}function St(ge,_e){return ge[0]*_e[1]-ge[1]*_e[0]}function vt(ge,_e){return ge[0]*_e[0]+ge[1]*_e[1]}function Qt(ge,_e,Xe){var lt=(function(Nr,Lr,Rr,fn,Vn){var Mr=[Lr[0]-Nr[0],Lr[1]-Nr[1]],On=[fn[0]-Rr[0],fn[1]-Rr[1]];function gn(Kr,kn,Yn){return[Kr[0]+kn*Yn[0],Kr[1]+kn*Yn[1]]}var en=[Rr[0]-Nr[0],Rr[1]-Nr[1]],Rn=St(Mr,On),Dn=Rn*Rn,Pn=vt(Mr,Mr);if(Dn>0){var Mn=St(en,On)/Rn;if(Mn<0||Mn>1)return null;var _n=St(en,Mr)/Rn;return _n<0||_n>1?null:Mn===0||Mn===1?[gn(Nr,Mn,Mr)]:_n===0||_n===1?[gn(Rr,_n,On)]:[gn(Nr,Mn,Mr)]}if((Dn=(Rn=St(en,Mr))*Rn)>0)return null;var jr=vt(Mr,en)/Pn,vn=jr+vt(Mr,On)/Pn,Wn=Math.min(jr,vn),dr=Math.max(jr,vn);return Wn<=1&&dr>=0?Wn===1?[gn(Nr,Wn>0?Wn:0,Mr)]:dr===0?[gn(Nr,dr<1?dr:1,Mr)]:[gn(Nr,Wn>0?Wn:0,Mr),gn(Nr,dr<1?dr:1,Mr)]:null})(ge.point,ge.otherEvent.point,_e.point,_e.otherEvent.point),Dt=lt?lt.length:0;if(Dt===0||Dt===1&&(pe(ge.point,_e.point)||pe(ge.otherEvent.point,_e.otherEvent.point))||Dt===2&&ge.isSubject===_e.isSubject)return 0;if(Dt===1)return pe(ge.point,lt[0])||pe(ge.otherEvent.point,lt[0])||Ge(ge,lt[0],Xe),pe(_e.point,lt[0])||pe(_e.otherEvent.point,lt[0])||Ge(_e,lt[0],Xe),1;var Rt=[],Vt=!1,ir=!1;return pe(ge.point,_e.point)?Vt=!0:Ke(ge,_e)===1?Rt.push(_e,ge):Rt.push(ge,_e),pe(ge.otherEvent.point,_e.otherEvent.point)?ir=!0:Ke(ge.otherEvent,_e.otherEvent)===1?Rt.push(_e.otherEvent,ge.otherEvent):Rt.push(ge.otherEvent,_e.otherEvent),Vt&&ir||Vt?(_e.type=E,ge.type=_e.inOut===ge.inOut?O:D,Vt&&!ir&&Ge(Rt[1].otherEvent,Rt[0].point,Xe),2):ir?(Ge(Rt[0],Rt[1].point,Xe),3):Rt[0]!==Rt[3].otherEvent?(Ge(Rt[0],Rt[1].point,Xe),Ge(Rt[1],Rt[2].point,Xe),3):(Ge(Rt[0],Rt[1].point,Xe),Ge(Rt[3].otherEvent,Rt[2].point,Xe),3)}function zt(ge,_e){if(ge===_e)return 0;if(mt(ge.point,ge.otherEvent.point,_e.point)!==0||mt(ge.point,ge.otherEvent.point,_e.otherEvent.point)!==0)return pe(ge.point,_e.point)?ge.isBelow(_e.otherEvent.point)?-1:1:ge.point[0]===_e.point[0]?ge.point[1]<_e.point[1]?-1:1:Ke(ge,_e)===1?_e.isAbove(ge.point)?-1:1:ge.isBelow(_e.point)?-1:1;if(ge.isSubject!==_e.isSubject)return ge.isSubject?-1:1;var Xe=ge.point,lt=_e.point;return Xe[0]===lt[0]&&Xe[1]===lt[1]?(Xe=ge.otherEvent.point)[0]===(lt=_e.otherEvent.point)[0]&&Xe[1]===lt[1]?0:ge.contourId>_e.contourId?1:-1:Ke(ge,_e)===1?1:-1}var Gt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ct(ge,_e,Xe,lt){var Dt,Rt=ge+1,Vt=_e[ge].point,ir=_e.length;for(Rt<ir&&(Dt=_e[Rt].point);Rt<ir&&Dt[0]===Vt[0]&&Dt[1]===Vt[1];){if(!Xe[Rt])return Rt;++Rt<ir&&(Dt=_e[Rt].point)}for(Rt=ge-1;Xe[Rt]&&Rt>lt;)Rt--;return Rt}Gt.prototype.isExterior=function(){return this.holeOf==null};var Yt=kt,_r=kt;function kt(ge,_e){if(!(this instanceof kt))return new kt(ge,_e);if(this.data=ge||[],this.length=this.data.length,this.compare=_e||Zt,this.length>0)for(var Xe=(this.length>>1)-1;Xe>=0;Xe--)this._down(Xe)}function Zt(ge,_e){return ge<_e?-1:ge>_e?1:0}kt.prototype={push:function(ge){this.data.push(ge),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ge=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ge}},peek:function(){return this.data[0]},_up:function(ge){for(var _e=this.data,Xe=this.compare,lt=_e[ge];ge>0;){var Dt=ge-1>>1,Rt=_e[Dt];if(Xe(lt,Rt)>=0)break;_e[ge]=Rt,ge=Dt}_e[ge]=lt},_down:function(ge){for(var _e=this.data,Xe=this.compare,lt=this.length>>1,Dt=_e[ge];ge<lt;){var Rt=1+(ge<<1),Vt=Rt+1,ir=_e[Rt];if(Vt<this.length&&Xe(_e[Vt],ir)<0&&(Rt=Vt,ir=_e[Vt]),Xe(ir,Dt)>=0)break;_e[ge]=ir,ge=Rt}_e[ge]=Dt}},Yt.default=_r;var cr=Math.max,xr=Math.min,kr=0;function Sr(ge,_e,Xe,lt,Dt,Rt){var Vt,ir,Nr,Lr,Rr,fn;for(Vt=0,ir=ge.length-1;Vt<ir;Vt++)if(Lr=ge[Vt+1],Rr=new ue(Nr=ge[Vt],!1,void 0,_e),fn=new ue(Lr,!1,Rr,_e),Rr.otherEvent=fn,Nr[0]!==Lr[0]||Nr[1]!==Lr[1]){Rr.contourId=fn.contourId=Xe,Rt||(Rr.isExteriorRing=!1,fn.isExteriorRing=!1),Ke(Rr,fn)>0?fn.left=!0:Rr.left=!0;var Vn=Nr[0],Mr=Nr[1];Dt[0]=xr(Dt[0],Vn),Dt[1]=xr(Dt[1],Mr),Dt[2]=cr(Dt[2],Vn),Dt[3]=cr(Dt[3],Mr),lt.push(Rr),lt.push(fn)}}var $t=[];function wr(ge,_e,Xe){typeof ge[0][0][0]=="number"&&(ge=[ge]),typeof _e[0][0][0]=="number"&&(_e=[_e]);var lt=(function(Mr,On,gn){var en=null;return Mr.length*On.length==0&&(gn===N?en=$t:gn===U?en=Mr:gn!==B&&gn!==X||(en=Mr.length===0?On:Mr)),en})(ge,_e,Xe);if(lt)return lt===$t?null:lt;var Dt=[1/0,1/0,-1/0,-1/0],Rt=[1/0,1/0,-1/0,-1/0],Vt=(function(Mr,On,gn,en,Rn){var Dn,Pn,Mn,_n,jr,vn,Wn=new Yt(null,Ke);for(Mn=0,_n=Mr.length;Mn<_n;Mn++)for(jr=0,vn=(Dn=Mr[Mn]).length;jr<vn;jr++)(Pn=jr===0)&&kr++,Sr(Dn[jr],!0,kr,Wn,gn,Pn);for(Mn=0,_n=On.length;Mn<_n;Mn++)for(jr=0,vn=(Dn=On[Mn]).length;jr<vn;jr++)Pn=jr===0,Rn===U&&(Pn=!1),Pn&&kr++,Sr(Dn[jr],!1,kr,Wn,en,Pn);return Wn})(ge,_e,Dt,Rt,Xe);if(lt=(function(Mr,On,gn,en,Rn){var Dn=null;return(gn[0]>en[2]||en[0]>gn[2]||gn[1]>en[3]||en[1]>gn[3])&&(Rn===N?Dn=$t:Rn===U?Dn=Mr:Rn!==B&&Rn!==X||(Dn=Mr.concat(On))),Dn})(ge,_e,Dt,Rt,Xe))return lt===$t?null:lt;for(var ir=(function(Mr){var On,gn,en=(function(Mn){var _n,jr,vn,Wn,dr=[];for(jr=0,vn=Mn.length;jr<vn;jr++)((_n=Mn[jr]).left&&_n.inResult||!_n.left&&_n.otherEvent.inResult)&&dr.push(_n);for(var Kr=!1;!Kr;)for(Kr=!0,jr=0,vn=dr.length;jr<vn;jr++)jr+1<vn&&Ke(dr[jr],dr[jr+1])===1&&(Wn=dr[jr],dr[jr]=dr[jr+1],dr[jr+1]=Wn,Kr=!1);for(jr=0,vn=dr.length;jr<vn;jr++)(_n=dr[jr]).otherPos=jr;for(jr=0,vn=dr.length;jr<vn;jr++)(_n=dr[jr]).left||(Wn=_n.otherPos,_n.otherPos=_n.otherEvent.otherPos,_n.otherEvent.otherPos=Wn);return dr})(Mr),Rn={},Dn=[],Pn=function(){if(!Rn[On]){var Mn=Dn.length,_n=(function(dr,Kr,kn){var Yn=new Gt;if(dr.prevInResult!=null){var Fn=dr.prevInResult,Ti=Fn.outputContourId;if(Fn.resultTransition>0){var wn=Kr[Ti];if(wn.holeOf!=null){var _i=wn.holeOf;Kr[_i].holeIds.push(kn),Yn.holeOf=_i,Yn.depth=Kr[Ti].depth}else Kr[Ti].holeIds.push(kn),Yn.holeOf=Ti,Yn.depth=Kr[Ti].depth+1}else Yn.holeOf=null,Yn.depth=Kr[Ti].depth}else Yn.holeOf=null,Yn.depth=0;return Yn})(en[On],Dn,Mn),jr=function(dr){Rn[dr]=!0,dr<en.length&&en[dr]&&(en[dr].outputContourId=Mn)},vn=On,Wn=On;for(_n.points.push(en[On].point);jr(vn),jr(vn=en[vn].otherPos),_n.points.push(en[vn].point),!((vn=Ct(vn,en,Rn,Wn))==Wn||vn>=en.length)&&en[vn];);Dn.push(_n)}};for(On=0,gn=en.length;On<gn;On++)Pn();return Dn})((function(Mr,On,gn,en,Rn,Dn){for(var Pn,Mn,_n,jr=new h(zt),vn=[],Wn=Math.min(en[2],Rn[2]);Mr.length!==0;){var dr=Mr.pop();if(vn.push(dr),Dn===N&&dr.point[0]>Wn||Dn===U&&dr.point[0]>en[2])break;if(dr.left){Mn=Pn=jr.insert(dr),Pn=Pn!==(_n=jr.minNode())?jr.prev(Pn):null,Mn=jr.next(Mn);var Kr=Pn?Pn.key:null;if(Q(dr,Kr,Dn),Mn&&Qt(dr,Mn.key,Mr)===2&&(Q(dr,Kr,Dn),Q(Mn.key,dr,Dn)),Pn&&Qt(Pn.key,dr,Mr)===2){var kn=Pn;Q(Kr,(kn=kn!==_n?jr.prev(kn):null)?kn.key:null,Dn),Q(dr,Kr,Dn)}}else Mn=Pn=jr.find(dr=dr.otherEvent),Pn&&Mn&&(Pn=Pn!==_n?jr.prev(Pn):null,Mn=jr.next(Mn),jr.remove(dr),Mn&&Pn&&Qt(Pn.key,Mn.key,Mr))}return vn})(Vt,0,0,Dt,Rt,Xe)),Nr=[],Lr=0;Lr<ir.length;Lr++){var Rr=ir[Lr];if(Rr.isExterior()){for(var fn=[Rr.points],Vn=0;Vn<Rr.holeIds.length;Vn++)fn.push(ir[Rr.holeIds[Vn]].points);Nr.push(fn)}}return Nr}var Wr={UNION:B,DIFFERENCE:U,INTERSECTION:N,XOR:X};o.diff=function(ge,_e){return wr(ge,_e,U)},o.intersection=function(ge,_e){return wr(ge,_e,N)},o.operations=Wr,o.union=function(ge,_e){return wr(ge,_e,B)},o.xor=function(ge,_e){return wr(ge,_e,X)},Object.defineProperty(o,"__esModule",{value:!0})})(r)})(0,MM.exports)),MM.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Jv(s,r,o,u){const h=[],m=u===0?(g,b,S,E,O,D)=>{g.push(new wt(D,S+(D-b)/(E-b)*(O-S)))}:(g,b,S,E,O,D)=>{g.push(new wt(b+(D-S)/(O-S)*(E-b),D))};for(const g of s){const b=[];for(const S of g){if(S.length<=2)continue;const E=[];for(let N=0;N<S.length-1;N++){const B=S[N].x,U=S[N].y,X=S[N+1].x,Q=S[N+1].y,ee=u===0?B:U,ue=u===0?X:Q;ee<r?ue>r&&m(E,B,U,X,Q,r):ee>o?ue<o&&m(E,B,U,X,Q,o):E.push(S[N]),ue<r&&ee>=r&&m(E,B,U,X,Q,r),ue>o&&ee<=o&&m(E,B,U,X,Q,o)}let O=S[S.length-1];const D=u===0?O.x:O.y;D>=r&&D<=o&&E.push(O),E.length&&(O=E[E.length-1],E[0].x===O.x&&E[0].y===O.y||E.push(E[0]),b.push(E))}b.length&&h.push(b)}return h}function IH(s,r){const o=C1(s),u=C1([r]),h=RM.intersection(o,u);return h==null?[]:DM(h)}function CH(s,r){let u=C1(s,65536);const h=[];for(;r.valid();r.next()){const[m,g]=r.get(),b=m.x*65536,S=m.y*65536,E=g.x*65536,O=g.y*65536,D=E-b,N=O-S,B=Math.hypot(D,N);if(B===0)continue;const U=Math.trunc(N/B*3),X=-Math.trunc(D/B*3);h.push([[[b,S],[E,O],[E+U,O+X],[b+U,S+X],[b,S]]])}return h.length>0&&(u=RM.diff(u,h)),DM(u,1/65536)}function C1(s,r=1){return[s.map((o=>o.map((u=>[u.x*r,u.y*r]))))]}function DM(s,r=1){return s.map((o=>o.map(((u,h)=>{const m=u.map((g=>new wt(g[0]*r,g[1]*r).round()));return h>0&&m.reverse(),m}))))}class O1{constructor(r,o){this.layoutVertexArray=new dl,this.indexArray=new Oi,this.lineIndexArray=new wi,this.triangleSegments=new Hn,this.lineSegments=new Hn,this.programConfigurations=new Ia(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new fl)}update(r,o,u,h,m,g,b,S){this.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,fH.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,pH.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,o,u,h,m,g,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,o,u,h,m,g,void 0,b)}}class M1{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new O1(r,!1),this.elevationBufferData=new O1(r,!0),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview}updateFootprints(r,o){}populate(r,o,u,h){this.hasPattern=P1("fill",this.layers,this.pixelRatio,o);const m=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:O}of r){const D=this.layers[0]._featureFilter.needGeometry,N=xt(b,D);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom,{worldview:this.worldview}),N,u))continue;const B=m?m.evaluate(N,{},u,o.availableImages):void 0,U={id:S,properties:b.properties,type:b.type,sourceLayerIndex:O,index:E,geometry:D?N.geometry:Lt(b,u,h),patterns:{},sortKey:B};g.push(U)}m&&g.sort(((b,S)=>b.sortKey-S.sortKey));for(const b of g){const{geometry:S,index:E,sourceLayerIndex:O}=b;if(this.hasPattern){const D=I1("fill",this.layers,b,this.zoom,this.pixelRatio,o);this.patternFeatures.push(D)}else this.addFeature(b,S,E,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(r[E].feature,S,E,O,this.index)}}update(r,o,u,h,m,g,b){this.bufferData.update(r,o,u,h,m,g,b,this.worldview),this.elevationBufferData.update(r,o,u,h,m,g,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,o,u,h,m,g,b,this.worldview)}addFeatures(r,o,u,h,m,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,u,h,g,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,o,u,h,m,g=[],b,S){const E=Mg(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,E,h,u,S):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(r,u,m,g,h,b,this.worldview),this.elevationBufferData.populatePaintArrays(r,u,m,g,h,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,o,u,h,m){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(o,u,h,m,this.worldview))}addElevatedRoadFeature(r,o,u,h,m){const g=new Array,b=$n.getElevationFeature(r,m);if(!b)return void this.addGeometry(o,this.bufferData);{const E=this.clipPolygonsToTile(o,1);E.length>0&&g.push({polygons:E,elevationFeature:b,elevationTileID:u})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},u),featureIndex:h};for(const E of g)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new oa(E.elevationTileID,this.layers,this.zoom,this.lut));const D=E.elevationFeature.isTunnel();let N=0;r.properties.hasOwnProperty(hn)&&(N=+r.properties[hn]);for(const B of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,B,D,E.elevationFeature,N)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const O=new mi(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,O,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,S)}}addElevatedGeometry(r,o,u,h,m,g){const b={elevation:u,elevationSampler:o,bias:h,index:m,featureInfo:g},[S,E]=this.addGeometry(r,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(r,o,u){let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(h=g,m=g));const b=(S,E,O)=>{if(u!=null)if(E.push(S),g!=null)o.elevatedLayoutVertexArray.emplaceBack(g),O.push(g);else{const D=u.elevationSampler.pointElevation(S,u.elevation,u.bias);o.elevatedLayoutVertexArray.emplaceBack(D),O.push(D),h=Math.min(h,D),m=Math.max(m,D)}};for(const S of r){let E=0;for(const he of S)E+=he.length;const O=o.triangleSegments.prepareSegment(E,o.layoutVertexArray,o.indexArray),D=O.vertexLength,N=[],B=[],U=[],X=[],Q=[],ee=o.layoutVertexArray.length;for(const he of S){if(he.length===0)continue;he!==S[0]&&B.push(N.length/2);const pe=o.lineSegments.prepareSegment(he.length,o.layoutVertexArray,o.lineIndexArray),Ae=pe.vertexLength;u&&Q.push(o.layoutVertexArray.length-ee),b(he[0],U,X),o.layoutVertexArray.emplaceBack(he[0].x,he[0].y),o.lineIndexArray.emplaceBack(Ae+he.length-1,Ae),N.push(he[0].x),N.push(he[0].y);for(let Ee=1;Ee<he.length;Ee++)b(he[Ee],U,X),o.layoutVertexArray.emplaceBack(he[Ee].x,he[Ee].y),o.lineIndexArray.emplaceBack(Ae+Ee-1,Ae+Ee),N.push(he[Ee].x),N.push(he[Ee].y);pe.vertexLength+=he.length,pe.primitiveLength+=he.length}const ue=Ff(N,B);for(let he=0;he<ue.length;he+=3)o.indexArray.emplaceBack(D+ue[he],D+ue[he+1],D+ue[he+2]);if(ue.length>0&&u&&this.elevationMode==="hd-road-base"){const he=u.elevation.isTunnel(),pe=u.elevation.safeArea,Ae=this.elevatedStructures.addVertices(U,X);this.elevatedStructures.addTriangles(ue,Ae,he);const Ee=Q.length;if(Ee>0){for(let Oe=0;Oe<Ee-1;Oe++)this.elevatedStructures.addRenderableRing(u.index,Q[Oe]+Ae,Q[Oe+1]-Q[Oe],he,pe,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,Q[Ee-1]+Ae,U.length-Q[Ee-1],he,pe,u.featureInfo)}}O.vertexLength+=E,O.primitiveLength+=ue.length/3}return[h,m]}prepareElevatedPolygons(r,o,u){const h=1/Ve(u),m=[];for(const g of r){const b=CH(g,new dn(o,h));m.push(...b)}return m}clipPolygonsToTile(r,o){const u=-o,h=-o,m=Mt+o,g=Mt+o;let b=0;const S=[],E=[];for(;b<r.length;b++){const N=r[b],B=Vd(N);(B.min.x>=u&&B.max.x<=m&&B.min.y>=h&&B.max.y<=g?S:E).push(N)}if(S.length===r.length)return r;const O=[new wt(u,h),new wt(m,h),new wt(m,g),new wt(u,g),new wt(u,h)],D=S;for(const N of E)D.push(...IH(N,O));return D}}let kM,NM,LM,jM;Ut(M1,"FillBucket",{omit:["layers","patternFeatures"]}),Ut(O1,"FillBufferData"),Ut(oa,"ElevatedStructures");class Qv{constructor(r,o,u,h){if(this.triangleCount=o.length/3,this.min=new wt(0,0),this.max=new wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[m,g]=[r[0].clone(),r[0].clone()];for(let D=1;D<r.length;++D){const N=r[D];m.x=Math.min(m.x,N.x),m.y=Math.min(m.y,N.y),g.x=Math.max(g.x,N.x),g.y=Math.max(g.y,N.y)}if(h){const D=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/h);u=Math.max(u,D)}if(u===0)return;this.min=m,this.max=g;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const S=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/S)),this.cellsY=Math.max(1,Math.ceil(b.y/S)),this.xScale=1/S,this.yScale=1/S;const E=[];for(let D=0;D<this.triangleCount;D++){const N=r[o[3*D+0]].sub(this.min),B=r[o[3*D+1]].sub(this.min),U=r[o[3*D+2]].sub(this.min),X=vl(Math.floor(Math.min(N.x,B.x,U.x)),this.xScale,this.cellsX),Q=vl(Math.floor(Math.max(N.x,B.x,U.x)),this.xScale,this.cellsX),ee=vl(Math.floor(Math.min(N.y,B.y,U.y)),this.yScale,this.cellsY),ue=vl(Math.floor(Math.max(N.y,B.y,U.y)),this.yScale,this.cellsY),he=new wt(0,0),pe=new wt(0,0),Ae=new wt(0,0),Ee=new wt(0,0);for(let Oe=ee;Oe<=ue;++Oe){he.y=pe.y=Oe*S,Ae.y=Ee.y=(Oe+1)*S;for(let De=X;De<=Q;++De)he.x=Ae.x=De*S,pe.x=Ee.x=(De+1)*S,(Ps(N,B,U,he,pe,Ee)||Ps(N,B,U,he,Ee,Ae))&&E.push({cellIdx:Oe*this.cellsX+De,triIdx:D})}}if(E.length===0)return;E.sort(((D,N)=>D.cellIdx-N.cellIdx||D.triIdx-N.triIdx));let O=0;for(;O<E.length;){const D=E[O].cellIdx,N={start:this.payload.length,len:0};for(;O<E.length&&E[O].cellIdx===D;)++N.len,this.payload.push(E[O++].triIdx);this.cells[D]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,o){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=vl(r.x-this.min.x,this.xScale,this.cellsX),h=vl(r.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+u];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){const b=this.payload[m.start+g],S=Math.floor(b/8),E=1<<b%8;if(!(this.lookup[S]&E)&&(this.lookup[S]|=E,o.push(b),o.length===this.triangleCount))return}}}query(r,o,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>o.x||r.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const h=vl(r.x-this.min.x,this.xScale,this.cellsX),m=vl(o.x-this.min.x,this.xScale,this.cellsX),g=vl(r.y-this.min.y,this.yScale,this.cellsY),b=vl(o.y-this.min.y,this.yScale,this.cellsY);for(let S=g;S<=b;S++)for(let E=h;E<=m;E++){const O=this.cells[S*this.cellsX+E];if(O)for(let D=0;D<O.len;D++){const N=this.payload[O.start+D],B=Math.floor(N/8),U=1<<N%8;if(!(this.lookup[B]&U)&&(this.lookup[B]|=U,u.push(N),u.length===this.triangleCount))return}}}}function vl(s,r,o){return Math.max(0,Math.min(o-1,Math.floor(s*r)))}Ut(Qv,"TriangleGridIndex");class zM{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.footprints=[],this.worldview=r.worldview}updateFootprints(r,o){for(const u of this.footprints)o.push({footprint:u,id:r})}populate(r,o,u,h){const m=[];for(const{feature:g,id:b,index:S,sourceLayerIndex:E}of r){const O=this.layers[0]._featureFilter.needGeometry,D=xt(g,O);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom,{worldview:this.worldview}),D,u))continue;const N={id:b,properties:g.properties,type:g.type,sourceLayerIndex:E,index:S,geometry:O?D.geometry:Lt(g,u,h),patterns:{}};m.push(N)}for(const g of m){const{geometry:b,index:S,sourceLayerIndex:E}=g;this.addFeature(g,b,S,u,{},o.availableImages,o.brightness),o.featureIndex.insert(r[S].feature,b,S,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,o,u,h,m,g,b){}destroy(){}addFeature(r,o,u,h,m,g=[],b){for(const S of Mg(o,2)){const E=[],O=[],D=[],N=new wt(1/0,1/0),B=new wt(-1/0,-1/0);for(const Q of S)if(Q.length!==0){Q!==S[0]&&D.push(O.length/2);for(let ee=0;ee<Q.length;ee++)O.push(Q[ee].x),O.push(Q[ee].y),E.push(Q[ee]),N.x=Math.min(N.x,Q[ee].x),N.y=Math.min(N.y,Q[ee].y),B.x=Math.max(B.x,Q[ee].x),B.y=Math.max(B.y,Q[ee].y)}const U=Ff(O,D),X=new Qv(E,U,8,256);this.footprints.push({vertices:E,indices:U,grid:X,min:N,max:B})}}}Ut(zM,"ClipBucket",{omit:["layers"]});const OH=qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),MH=qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),RH=qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),DH=qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),kH=qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),NH=qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:LH}=OH,Rg=Number.MAX_SAFE_INTEGER,FM=Rg-1;function BM(s,r,o,u){return s.order<r||s.order===Rg||!(s.clipMask&o)||(function(h,m){return m.length!==0&&m.find((g=>g===h))===void 0})(u,s.clipScope)}function ex(s,r){return s.x-r.x||s.y-r.y}function UM(s,r){return ex(s.min,r.min)===0&&ex(s.max,r.max)===0}function R1(s,r){return!(s.min.x>r.max.x||s.max.x<r.min.x||s.min.y>r.max.y||s.max.y<r.min.y)}function tx(s,r){if(s.length!==r.length)return!1;for(let o=0;o<s.length;o++)if(s[o].sourceId!==r[o].sourceId||!UM(s[o],r[o])||s[o].order!==r[o].order||s[o].clipMask!==r[o].clipMask||!vs(s[o].clipScope,r[o].clipScope))return!1;return!0}function VM(s,r,o){const u=1/Mt,h=1/(1<<o.canonical.z),m=(r.x*u+o.canonical.x)*h+o.wrap,g=(r.y*u+o.canonical.y)*h;return{min:new wt((s.x*u+o.canonical.x)*h+o.wrap,(s.y*u+o.canonical.y)*h),max:new wt(m,g)}}function jH(s,r,o){const u=1<<o.canonical.z,h=((r.x-o.wrap)*u-o.canonical.x)*Mt,m=(r.y*u-o.canonical.y)*Mt;return{min:new wt(((s.x-o.wrap)*u-o.canonical.x)*Mt,(s.y*u-o.canonical.y)*Mt),max:new wt(h,m)}}function D1(s,r,o,u,h,m,g){const b=s.indices,S=s.vertices,E=[];for(let O=u;O<u+h;O+=3){const D=r[o[O+0]+m],N=r[o[O+1]+m],B=r[o[O+2]+m],U=Math.min(D.x,N.x,B.x),X=Math.max(D.x,N.x,B.x),Q=Math.min(D.y,N.y,B.y),ee=Math.max(D.y,N.y,B.y);E.length=0,s.grid.query(new wt(U,Q),new wt(X,ee),E);for(let ue=0;ue<E.length;ue++){const he=E[ue];if(Ps(S[b[3*he+0]],S[b[3*he+1]],S[b[3*he+2]],D,N,B,g))return!0}}return!1}function $M(s,r,o,u){if(!s||!o)return!1;let h=s.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(o.vertices.length<s.vertices.length)return $M(o,u,s,r);const m=r.canonical,g=u.canonical,b=Math.pow(2,g.z-m.z);h=s.vertices.map((S=>new wt((S.x+m.x*Mt)*b-g.x*Mt,(S.y+m.y*Mt)*b-g.y*Mt)))}return D1(o,h,s.indices,0,s.indices.length,0,0)}function qM(s,r,o,u){const h=Math.pow(2,u.z-o.z);return new wt((s+o.x*Mt)*h-u.x*Mt,(r+o.y*Mt)*h-u.y*Mt)}function k1(s,r){const o=[];r.grid.queryPoint(s,o);const u=r.indices,h=r.vertices;for(let m=0;m<o.length;m++){const g=o[m];if(zi([h[u[3*g+0]],h[u[3*g+1]],h[u[3*g+2]]],s))return!0}return!1}const N1=[new wt(0,0),new wt(Mt,0),new wt(Mt,Mt),new wt(0,Mt)];function GM(s,r){const o=[];let u=[];if(!r||s.length<2)return[s];if(s.length===2)return Qi(s[0],s[1],N1)?[s]:[];for(let h=0;h<s.length+2;h++){const m=s[h%s.length],g=s[(h+1)%s.length],b=Qi(h===0?s[s.length-1]:s[(h-1)%s.length],m,N1),S=Qi(m,g,N1),E=b||S;E&&u.push(m),E&&S||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const L1=gt.types,zH=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],FH=["fill-extrusion-flood-light-ground-radius"],BH=Math.pow(2,13),UH=Math.pow(2,15)-1,HM=new wt(0,1),xu=2147483648;function Dg(s,r,o,u,h,m,g,b){s.emplaceBack((r<<1)+g,(o<<1)+m,(Math.floor(u*BH)<<1)+h,Math.round(b))}function kg(s,r,o){s.emplaceBack(r.x*Mt,r.y*Mt,o?1:0)}function rx(s,r,o,u,h,m){s.emplaceBack(r.x,r.y,(o.x<<1)+u,(o.y<<1)+h,m)}function Ng(s,r,o){s.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class WM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ZM{constructor(){this.centroidXY=new wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class XM{constructor(){this.acc=new wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,o){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=o.x,r.min.y=r.max.y=o.y)}appendEdge(r,o,u){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<r.min.x?(r.min.x=o.x,h=!0):o.x>r.max.x&&(r.max.x=o.x,h=!0),o.y<r.min.y?(r.min.y=o.y,h=!0):o.y>r.max.y&&(r.max.y=o.y,h=!0),((o.x===0||o.x===Mt)&&o.x===u.x)!=((o.y===0||o.y===Mt)&&o.y===u.y)&&this.processBorderOverlap(o,u),h&&this.checkBorderIntersection(o,u)}checkBorderIntersection(r,o){o.x<0!=r.x<0&&this.addBorderIntersection(0,lr(o.y,r.y,(0-o.x)/(r.x-o.x))),o.x>Mt!=r.x>Mt&&this.addBorderIntersection(1,lr(o.y,r.y,(Mt-o.x)/(r.x-o.x))),o.y<0!=r.y<0&&this.addBorderIntersection(2,lr(o.x,r.x,(0-o.y)/(r.y-o.y))),o.y>Mt!=r.y>Mt&&this.addBorderIntersection(3,lr(o.x,r.x,(Mt-o.y)/(r.y-o.y)))}addBorderIntersection(r,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(r,o){if(r.x===o.x){if(r.y===o.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new wt(0,0):new wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((r,o)=>r+ +(o[0]!==Number.MAX_VALUE)),0):0}}function KM(s,r){const o=s.add(r)._unit(),u=Ie(s.x*o.x+s.y*o.y,-1,1);var h,m,g;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*UH*((m=s).x*(g=r).y-m.y*g.x<0?-1:1)}const VH=[s=>s.x<0,s=>s.x>Mt,s=>s.y<0,s=>s.y>Mt];function $H(s,r,o,u){const h=[4];if(u===0)return h;o._mult(u);const m=s.sub(o),g=r.sub(o),b=[s,r,m,g];for(let S=0;S<4;S++)for(const E of b)if(VH[S](E)){h.push(S);break}return h}class j1{constructor(r){this.vertexArray=new fg,this.indexArray=new Oi,this.programConfigurations=new Ia(r.layers,{zoom:r.zoom,lut:r.lut},(o=>FH.includes(o))),this._segments=new Hn,this.hiddenByLandmarkVertexArray=new Df,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Hn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,o,u,h=!1){const m=r.length;if(m>2){let g=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let S;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const E=r[0],O=r[1];S=KM(E.sub(r[m-1])._perp()._unit(),O.sub(E)._perp()._unit())}for(let E=0;E<m;E++){const O=E===m-1?0:E+1,D=r[E],N=r[O],B=r[O===m-1?0:O+1],U=N.sub(D)._perp()._unit(),X=KM(U,B.sub(N)._perp()._unit()),Q=S,ee=X;if(z1(D,N,o)||h&&QM(D,o)&&QM(N,o)){S=X;continue}const ue=b.vertexLength;rx(this.vertexArray,D,N,1,1,Q),rx(this.vertexArray,D,N,1,0,Q),rx(this.vertexArray,D,N,0,1,ee),rx(this.vertexArray,D,N,0,0,ee),b.vertexLength+=4;const he=$H(D,N,U,u);for(const pe of he)this._segmentToGroundQuads[g].push({id:ue,region:pe}),this._segmentToRegionTriCounts[g][pe]+=2,b.primitiveLength+=2;S=X}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),o=r.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort(((h,m)=>h.region-m.region));for(let u=0;u<o;u++){const h=this._segmentToGroundQuads[u],m=r[u],g=this._segmentToRegionTriCounts[u];g.reduce(((S,E)=>S+E),0);let b=0;for(let S=0;S<=4;S++){const E=g[S];if(E!==0){let O=this.regionSegments[S];O||(O=this.regionSegments[S]=new Hn);const D={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+b,vertexLength:m.vertexLength,primitiveLength:E};O.get().push(D)}b+=E}for(let S=0;S<h.length;S++){const E=h[S].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,o,u,h,m,g,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,o,u,h,m,g,void 0,b)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,MH.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,o,u,h,m,g,b,S){this.hasData()&&this.programConfigurations.updatePaintArrays(r,o,u,h,m,g,b,S)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&xu))}updateHiddenByLandmarkRange(r,o,u){if(!this.hasData())return;const h=o+r;if(o!==0){for(let m=r;m<h;++m)this.hiddenByLandmarkVertexArray.emplace(m,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,kH.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const o=this.regionSegments[r];o&&o.destroy()}}}}class nx{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map((o=>o.fqid)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Oi,this.footprintVertices=new dl,this.footprintSegments=[],this.layoutVertexArray=new ac,this.centroidVertexArray=new Bv,this.wallVertexArray=new Vv,this.indexArray=new Oi,this.programConfigurations=new Ia(r.layers,{zoom:r.zoom,lut:r.lut},(o=>zH.includes(o))),this.segments=new Hn,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.groundEffect=new j1(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview}updateFootprints(r,o){}populate(r,o,u,h){this.features=[],this.hasPattern=P1("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ve(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:g,index:b,sourceLayerIndex:S}of r){const E=this.layers[0]._featureFilter.needGeometry,O=xt(m,E);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom,{worldview:this.worldview}),O,u))continue;const D={id:g,sourceLayerIndex:S,index:b,geometry:E?O.geometry:Lt(m,u,h),properties:m.properties,type:m.type,patterns:{}},N=this.layoutVertexArray.length,B=L1[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:I1("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,o)});else if(this.wallMode)for(const U of D.geometry)for(const X of GM(U,B))this.addFeature(m.id,D,[X],b,u,{},o.availableImages,h,o.brightness);else this.addFeature(m.id,D,D.geometry,b,u,{},o.availableImages,h,o.brightness);o.featureIndex.insert(m,D.geometry,b,S,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,o,u,h,m,g){for(const{featureId:b,feature:S}of this.features){const E=L1[S.type]==="Polygon",{geometry:O}=S;if(this.wallMode)for(const D of O)for(const N of GM(D,E))this.addFeature(b,S,[N],S.index,o,u,h,m,g);else this.addFeature(b,S,O,S.index,o,u,h,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,o,u,h,m,g,b){this.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b,this.worldview),this.groundEffect.update(r,o,m,u,h,g,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,LH),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,DH.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,NH.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,RH.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,u,h,m,g,b,S,E){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,D=[new wt(0,0),new wt(Mt,Mt)],N=S.projection,B=N.name==="globe",U=this.wallMode||L1[o.type]==="Polygon",X=new XM;X.centroidDataIndex=this.centroidData.length;const Q=new ZM;Q.buildingId=r,o.properties&&o.properties.hasOwnProperty("building_id")&&(Q.buildingId=o.properties.building_id);const ee=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},m)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},m);let he;if(Q.height=ue,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new If),this.wallMode){if(B)return void Vr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;he=(function(Ue){const ut=Ue[0].x===Ue[Ue.length-1].x&&Ue[0].y===Ue[Ue.length-1].y;(function(Ct){let Yt=0;const _r=Ct.length;for(let kt=0;kt<_r;kt++)Yt+=(Ct[(kt+1)%_r].x-Ct[kt].x)*(Ct[(kt+1)%_r].y+Ct[kt].y);return Yt>=0})(Ue)||(Ue=Ue.reverse());const ht={geometry:[],joinNormals:[],indices:[]},ft=[],bt=[],st=[];let mt=Ue.length;for(;mt>=2&&Ue[mt-1].equals(Ue[mt-2]);)mt--;if(mt<(ut?3:2))return ht;let Ke,Ge,St,vt,Qt,zt=0;for(;zt<mt-1&&Ue[zt].equals(Ue[zt+1]);)zt++;ut&&(Ke=Ue[mt-2],Qt=Ue[zt].sub(Ke)._unit()._perp());for(let Ct=zt;Ct<mt;Ct++){if(St=Ct===mt-1?ut?Ue[zt+1]:void 0:Ue[Ct+1],St&&Ue[Ct].equals(St))continue;Qt&&(vt=Qt),Ke&&(Ge=Ke),Ke=Ue[Ct],Qt=St?St.sub(Ke)._unit()._perp():vt,vt=vt||Qt;let Yt=vt.add(Qt);Yt.x===0&&Yt.y===0||Yt._unit();const _r=Yt.x*Qt.x+Yt.y*Qt.y,kt=_r!==0?1/_r:1/0,Zt=vt.x*Qt.y-vt.y*Qt.x>0;let cr="miter";const xr=2;cr==="miter"&&kt>xr&&(cr="bevel"),cr==="bevel"&&(kt>100&&(cr="flipbevel"),kt<xr&&(cr="miter"));const kr=(Sr,$t,wr,Wr)=>{const ge=new wt(Sr.x,Sr.y),_e=new wt(Sr.x,Sr.y);ge.x+=$t.x*Wr,ge.y+=$t.y*Wr,_e.x-=$t.x*Math.max(wr,1),_e.y-=$t.y*Math.max(wr,1),st.push($t),ft.push(ge),bt.push(_e)};if(cr==="miter")Yt._mult(kt),kr(Ke,Yt,0,0);else if(cr==="flipbevel")Yt=Qt.mult(-1),kr(Ke,Yt,0,0),kr(Ke,Yt.mult(-1),0,0);else{const Sr=-Math.sqrt(kt*kt-1),$t=Zt?Sr:0,wr=Zt?0:Sr;Ge&&kr(Ke,vt,$t,wr),St&&kr(Ke,Qt,$t,wr)}}ht.geometry=[...ft,...bt.reverse(),ft[0]],ht.joinNormals=[...st,...st.reverse(),st[st.length-1]];const Gt=ht.geometry.length-1;for(let Ct=0;Ct<Gt/2;Ct++)if(Ct+1<Gt/2){let Yt=Ct,_r=Ct+1,kt=Gt-1-Ct,Zt=Gt-2-Ct;Yt=Yt===0?Gt-1:Yt-1,_r=_r===0?Gt-1:_r-1,kt=kt===0?Gt-1:kt-1,Zt=Zt===0?Gt-1:Zt-1,ht.indices.push(kt),ht.indices.push(_r),ht.indices.push(Yt),ht.indices.push(kt),ht.indices.push(Zt),ht.indices.push(_r)}return ht})(u[0]),u=[he.geometry]}const pe=(Ue,ut)=>Ue<(ut.length-1)/2||Ue===ut.length-1,Ae=this.wallMode?[u]:Mg(u,500);for(let Ue=Ae.length-1;Ue>=0;Ue--){const ut=Ae[Ue];(ut.length===0||(Ee=ut[0]).every((_t=>_t.x<=0))||Ee.every((_t=>_t.x>=Mt))||Ee.every((_t=>_t.y<=0))||Ee.every((_t=>_t.y>=Mt)))&&Ae.splice(Ue,1)}var Ee;let Oe;if(B)Oe=nR(Ae,D,m);else{Oe=[];for(const Ue of Ae)Oe.push({polygon:Ue,bounds:D})}const De=U?this.edgeRadius:0,Le=De>0&&this.zoom<17,ct=(Ue,ut)=>{if(Ue.length===0)return!1;const _t=Ue[Ue.length-1];return ut.x===_t.x&&ut.y===_t.y};for(const{polygon:Ue,bounds:ut}of Oe){let _t=0,ht=0;for(const mt of Ue)U&&!mt[0].equals(mt[mt.length-1])&&mt.push(mt[0]),ht+=U?mt.length-1:mt.length;const ft=this.segments.prepareSegment((U?5:4)*ht,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},st=new WM;if(st.vertexOffset=this.footprintVertices.length,st.indexOffset=3*this.footprintIndices.length,st.ringIndices=[],U){const mt=[],Ke=[];_t=ft.vertexLength;for(let St=0;St<Ue.length;St++){const vt=Ue[St];vt.length&&St!==0&&Ke.push(mt.length/2);const Qt=[];let zt,Gt;zt=vt[1].sub(vt[0])._perp()._unit(),st.ringIndices.push(vt.length-1);for(let Ct=1;Ct<vt.length;Ct++){const Yt=vt[Ct],_r=vt[Ct===vt.length-1?1:Ct+1],kt=Yt.clone();if(De){Gt=_r.sub(Yt)._perp()._unit();const Zt=zt.add(Gt)._unit(),cr=De*Math.min(4,1/(zt.x*Zt.x+zt.y*Zt.y));kt.x+=cr*Zt.x,kt.y+=cr*Zt.y,kt.x=Math.round(kt.x),kt.y=Math.round(kt.y),zt=Gt}if(!ee||De!==0&&!Le||ct(Qt,kt)||Qt.push(kt),Dg(this.layoutVertexArray,kt.x,kt.y,0,0,1,1,0),this.wallMode){const Zt=pe(Ct,vt);kg(this.wallVertexArray,he.joinNormals[Ct],!Zt)}ft.vertexLength++,this.footprintVertices.emplaceBack(Yt.x,Yt.y),mt.push(Yt.x,Yt.y),B&&Ng(this.layoutVertexExtArray,N.projectTilePoint(kt.x,kt.y,m),N.upVector(m,kt.x,kt.y))}ee&&(De===0||Le)&&(Qt.length!==0&&ct(Qt,Qt[0])&&Qt.pop(),this.groundEffect.addData(Qt,ut,O))}const Ge=this.wallMode?he.indices:Ff(mt,Ke);for(let St=0;St<Ge.length;St+=3)this.footprintIndices.emplaceBack(st.vertexOffset+Ge[St+0],st.vertexOffset+Ge[St+1],st.vertexOffset+Ge[St+2]),this.indexArray.emplaceBack(_t+Ge[St],_t+Ge[St+2],_t+Ge[St+1]),ft.primitiveLength++;st.indexCount+=Ge.length,st.vertexCount+=this.footprintVertices.length-st.vertexOffset}for(let mt=0;mt<Ue.length;mt++){const Ke=Ue[mt];X.startRing(Q,Ke[0]);let Ge=Ke.length>4&&eR(Ke[Ke.length-2],Ke[0],Ke[1]),St=De?qH(Ke[Ke.length-2],Ke[0],Ke[1],De):0;const vt=[];let Qt,zt,Gt;zt=Ke[1].sub(Ke[0])._perp()._unit();let Ct=!0;for(let Yt=1,_r=0;Yt<Ke.length;Yt++){let kt=Ke[Yt-1],Zt=Ke[Yt];const cr=Ke[Yt===Ke.length-1?1:Yt+1];if(X.appendEdge(Q,Zt,kt),z1(Zt,kt,ut)){De&&(zt=cr.sub(Zt)._perp()._unit(),Ct=!Ct);continue}const xr=Zt.sub(kt)._perp(),kr=xr.x/(Math.abs(xr.x)+Math.abs(xr.y)),Sr=xr.y>0?1:0,$t=kt.dist(Zt);if(_r+$t>32768&&(_r=0),De){Gt=cr.sub(Zt)._perp()._unit();let _e=JM(kt,Zt,cr,YM(zt,Gt),De);isNaN(_e)&&(_e=0);const Xe=Zt.sub(kt)._unit();kt=kt.add(Xe.mult(St))._round(),Zt=Zt.add(Xe.mult(-_e))._round(),St=_e,zt=Gt,ee&&this.zoom>=17&&(ct(vt,kt)||vt.push(kt),ct(vt,Zt)||vt.push(Zt))}const wr=ft.vertexLength,Wr=Ke.length>4&&eR(kt,Zt,cr);let ge=tR(_r,Ge,Ct);if(Dg(this.layoutVertexArray,kt.x,kt.y,kr,Sr,0,0,ge),Dg(this.layoutVertexArray,kt.x,kt.y,kr,Sr,0,1,ge),this.wallMode){const _e=pe(Yt-1,Ke),Xe=he.joinNormals[Yt-1];kg(this.wallVertexArray,Xe,_e),kg(this.wallVertexArray,Xe,_e)}if(_r+=$t,ge=tR(_r,Wr,!Ct),Ge=Wr,Dg(this.layoutVertexArray,Zt.x,Zt.y,kr,Sr,0,0,ge),Dg(this.layoutVertexArray,Zt.x,Zt.y,kr,Sr,0,1,ge),this.wallMode){const _e=pe(Yt,Ke),Xe=he.joinNormals[Yt];kg(this.wallVertexArray,Xe,_e),kg(this.wallVertexArray,Xe,_e)}if(ft.vertexLength+=4,this.indexArray.emplaceBack(wr+0,wr+1,wr+2),this.indexArray.emplaceBack(wr+1,wr+3,wr+2),ft.primitiveLength+=2,De){const _e=_t+(Yt===1?Ke.length-2:Yt-2),Xe=Yt===1?_t:_e+1;if(this.indexArray.emplaceBack(wr+1,_e,wr+3),this.indexArray.emplaceBack(_e,Xe,wr+3),ft.primitiveLength+=2,Qt===void 0&&(Qt=wr),!z1(cr,Ke[Yt],ut)){const lt=Yt===Ke.length-1?Qt:ft.vertexLength;this.indexArray.emplaceBack(wr+2,wr+3,lt),this.indexArray.emplaceBack(wr+3,lt+1,lt),this.indexArray.emplaceBack(wr+3,Xe,lt+1),ft.primitiveLength+=3}Ct=!Ct}if(B){const _e=this.layoutVertexExtArray,Xe=N.projectTilePoint(kt.x,kt.y,m),lt=N.projectTilePoint(Zt.x,Zt.y,m),Dt=N.upVector(m,kt.x,kt.y),Rt=N.upVector(m,Zt.x,Zt.y);Ng(_e,Xe,Dt),Ng(_e,Xe,Dt),Ng(_e,lt,Rt),Ng(_e,lt,Rt)}}U&&(_t+=Ke.length-1),ee&&De&&this.zoom>=17&&(vt.length!==0&&ct(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,ut,O,De>0))}this.footprintSegments.push(st),bt.triangleCount=this.indexArray.length-bt.triangleArrayOffset,this.polygonSegments.push(bt),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=X.borders?HM:this.encodeCentroid(X,Q),this.centroidData.push(Q),X.borders){this.featuresOnBorder.push(X);const Ue=this.featuresOnBorder.length-1;for(let ut=0;ut<X.borders.length;ut++)X.borders[ut][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ut].push(Ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,g,b,m,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(o,h,g,b,m,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort(((o,u)=>this.featuresOnBorder[o].borders[r][0]-this.featuresOnBorder[u].borders[r][0]))}splitToSubtiles(){const r=[];for(let b=0;b<this.centroidData.length;b++){const S=this.centroidData[b],E=+(S.min.y+S.max.y>Mt),O=2*E+(+(S.min.x+S.max.x>Mt)^E);for(let D=0;D<S.polygonSegLen;D++){const N=S.polygonSegIdx+D;r.push({centroidIdx:b,subtile:O,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const o=new Oi;r.sort(((b,S)=>b.triangleSegmentIdx===S.triangleSegmentIdx?b.subtile-S.subtile:b.triangleSegmentIdx-S.triangleSegmentIdx));let u=0,h=0,m=0;for(const b of r){if(b.triangleSegmentIdx!==u)break;m++}const g=r.length;for(;h!==r.length;){u=r[h].triangleSegmentIdx;let b=0,S=h,E=h;for(let O=S;O<m&&r[O].subtile===b;O++)E++;for(;S!==m;){const O=r[S];b=O.subtile;const D=this.centroidData[O.centroidIdx].min.clone(),N=this.centroidData[O.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=S;U<E;U++){const X=r[U],Q=this.polygonSegments[X.polygonSegmentIdx],ee=this.centroidData[X.centroidIdx].min,ue=this.centroidData[X.centroidIdx].max,he=this.indexArray.uint16;for(let pe=Q.triangleArrayOffset;pe<Q.triangleArrayOffset+Q.triangleCount;pe++)o.emplaceBack(he[3*pe],he[3*pe+1],he[3*pe+2]);B.primitiveLength+=Q.triangleCount,D.x=Math.min(D.x,ee.x),D.y=Math.min(D.y,ee.y),N.x=Math.max(N.x,ue.x),N.y=Math.max(N.y,ue.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:D,max:N}),S=E;for(let U=S;U<m&&r[U].subtile===r[S].subtile;U++)E++}h=m;for(let O=h;O<g&&r[O].triangleSegmentIdx===r[h].triangleSegmentIdx;O++)m++}o._trim(),this.indexArray=o}getVisibleSegments(r,o,u){const h=new Hn;if(this.wallMode){for(const X of this.triangleSubSegments)h.segments.push(X.segment);return h}let m=0,g=0;const b=1<<r.canonical.z;if(o){const X=o.getMinMaxForTile(r);X&&(m=X.min,g=X.max)}g+=this.maxHeight;const S=r.toUnwrapped();let E;const O=[S.canonical.x/b+S.wrap,S.canonical.y/b],D=[(S.canonical.x+1)/b+S.wrap,(S.canonical.y+1)/b],N=(X,Q,ee)=>[X[0]*(1-ee[0])+Q[0]*ee[0],X[1]*(1-ee[1])+Q[1]*ee[1]],B=[],U=[];for(const X of this.triangleSubSegments){B[0]=X.min.x/Mt,B[1]=X.min.y/Mt,U[0]=X.max.x/Mt,U[1]=X.max.y/Mt;const Q=N(O,D,B),ee=N(O,D,U);if(new hr([Q[0],Q[1],m],[ee[0],ee[1],g]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}const ue=X.segment;E&&E.vertexOffset!==ue.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=ue.vertexLength,E.primitiveLength+=ue.primitiveLength):E={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(r,o){const u=r.centroid(),h=o.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new wt(Ie(u.x,1,Mt-1)<<3|m,Ie(u.y,1,Mt-1)<<3|g)}encodeBorderCentroid(r){if(!r.borders)return new wt(0,0);const o=r.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const h=o[0][0]!==u?0:1;return new wt(6|(o[0][0]!==u?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{const h=o[2][0]!==u?2:3;return new wt((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(r){const o=this.centroidData[r.centroidDataIndex];o.flags&=2147483647,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const o=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,h=r.flags&xu?HM:r.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||m!==h.x){for(let g=o;g<u;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(r.toUnwrapped());if(tx(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const m=[];for(const g of this.activeReplacements){if(g.order<u)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-r.canonical.z));if(g.footprint.buildingId){const S=g.footprint.buildingId;for(const E of this.centroidData)E.buildingId===S&&(E.flags|=xu)}else for(const S of this.centroidData)if(!(S.flags&xu||g.min.x>S.max.x||S.min.x>g.max.x||g.min.y>S.max.y||S.min.y>g.max.y))for(let E=0;E<S.footprintSegLen;E++){const O=this.footprintSegments[S.footprintSegIdx+E];if(m.length=0,GH(this.footprintVertices,O.vertexOffset,O.vertexCount,g.footprintTileId.canonical,r.canonical,m),D1(g.footprint,m,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-b)){S.flags|=xu;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,o,u){let h=!1;for(let m=0;m<u.footprintSegLen;m++){const g=this.footprintSegments[u.footprintSegIdx+m];let b=0;for(const S of g.ringIndices){for(let E=b,O=S+b-1;E<S+b;O=E++){const D=this.footprintVertices.int16[2*(E+g.vertexOffset)+0],N=this.footprintVertices.int16[2*(E+g.vertexOffset)+1],B=this.footprintVertices.int16[2*(O+g.vertexOffset)+1];N>o!=B>o&&r<(this.footprintVertices.int16[2*(O+g.vertexOffset)+0]-D)*(o-N)/(B-N)+D&&(h=!h)}b=S}}return h}getHeightAtTileCoord(r,o){let u=Number.NEGATIVE_INFINITY,h=!0;const m=4*(r+Mt)*Mt+(o+Mt);if(this.partLookup.hasOwnProperty(m)){const g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&xu)}:void 0}for(const g of this.centroidData)r>g.max.x||g.min.x>r||o>g.max.y||g.min.y>o||g.height<=u||this.footprintContainsPoint(r,o,g)&&(u=g.height,this.partLookup[m]=g,h=!!(g.flags&xu));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[m]=void 0}}function YM(s,r){const o=s.add(r)._unit();return s.x*o.x+s.y*o.y}function qH(s,r,o,u){const h=r.sub(s)._perp()._unit(),m=o.sub(r)._perp()._unit();return JM(s,r,o,YM(h,m),u)}function JM(s,r,o,u,h){const m=Math.sqrt(1-u*u);return Math.min(s.dist(r)/3,r.dist(o)/3,h*m/u)}function z1(s,r,o){return s.x<o[0].x&&r.x<o[0].x||s.x>o[1].x&&r.x>o[1].x||s.y<o[0].y&&r.y<o[0].y||s.y>o[1].y&&r.y>o[1].y}function QM(s,r){return s.x<r[0].x||s.x>r[1].x||s.y<r[0].y||s.y>r[1].y}function eR(s,r,o){if(s.x<0||s.x>=Mt||r.x<0||r.x>=Mt||o.x<0||o.x>=Mt)return!1;const u=o.sub(r),h=u.perp(),m=s.sub(r);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function tR(s,r,o){const u=r?2|s:-3&s;return o?1|u:-2&u}function rR(){const s=Math.PI/32,r=Math.tan(s),o=G;return o*Math.sqrt(1+2*r*r)-o}function nR(s,r,o){const u=1<<o.z,h=Se(o.x/u),m=Se((o.x+1)/u),g=be(o.y/u),b=be((o.y+1)/u);return(function(S,E,O,D,N=0,B){const U=[];if(!S.length||!O||!D)return U;const X=(Ee,Oe)=>{for(const De of Ee)U.push({polygon:De,bounds:Oe})},Q=Math.ceil(Math.log2(O)),ee=Math.ceil(Math.log2(D)),ue=Q-ee,he=[];for(let Ee=0;Ee<Math.abs(ue);Ee++)he.push(ue>0?0:1);for(let Ee=0;Ee<Math.min(Q,ee);Ee++)he.push(0),he.push(1);let pe=S;if(pe=Jv(pe,E[0].y-N,E[1].y+N,1),pe=Jv(pe,E[0].x-N,E[1].x+N,0),!pe.length)return U;const Ae=[];for(he.length?Ae.push({polygons:pe,bounds:E,depth:0}):X(pe,E);Ae.length;){const Ee=Ae.pop(),Oe=Ee.depth,De=he[Oe],Le=Ee.bounds[0],ct=Ee.bounds[1],Ue=De===0?Le.x:Le.y,ut=De===0?ct.x:ct.y,_t=B?B(De,Ue,ut):.5*(Ue+ut),ht=Jv(Ee.polygons,Ue-N,_t+N,De),ft=Jv(Ee.polygons,_t-N,ut+N,De);if(ht.length){const bt=[Le,new wt(De===0?_t:ct.x,De===1?_t:ct.y)];he.length>Oe+1?Ae.push({polygons:ht,bounds:bt,depth:Oe+1}):X(ht,bt)}if(ft.length){const bt=[new wt(De===0?_t:Le.x,De===1?_t:Le.y),ct];he.length>Oe+1?Ae.push({polygons:ft,bounds:bt,depth:Oe+1}):X(ft,bt)}}return U})(s,r,Math.ceil((m-h)/11.25),Math.ceil((g-b)/11.25),1,((S,E,O)=>{if(S===0)return .5*(E+O);{const D=be((o.y+E/Mt)/u);return(we(.5*(be((o.y+O/Mt)/u)+D))*u-o.y)*Mt}}))}function GH(s,r,o,u,h,m){const g=Math.pow(2,u.z-h.z);for(let b=0;b<o;b++){let S=s.int16[2*(b+r)+0],E=s.int16[2*(b+r)+1];S=(S+h.x*Mt)*g-u.x*Mt,E=(E+h.y*Mt)*g-u.y*Mt,m.push(new wt(S,E))}}let iR,oR;Ut(nx,"FillExtrusionBucket",{omit:["layers","features"]}),Ut(ZM,"PartData"),Ut(WM,"FootprintSegment"),Ut(XM,"BorderCentroidData"),Ut(j1,"GroundEffect");class zh extends wt{constructor(r,o,u){super(r,o),this.z=u}}class aR extends zh{constructor(r,o,u,h){super(r,o,u),this.w=h}}function sR(s,r,o,u){const h=o==="x"?"y":"x",m=(u-s[o])/(r[o]-s[o]);s[h]=Math.round(s[h]+(r[h]-s[h])*m),s[o]=u,s.hasOwnProperty("z")&&(s.z=lr(s.z,r.z,m)),s.hasOwnProperty("w")&&(s.w=lr(s.w,r.w,m))}function lR(s,r,o,u){const h=o,m=u;for(const g of["x","y"]){let b=s,S=r;b[g]>=S[g]&&(b=r,S=s),b[g]<h&&S[g]>h&&sR(b,S,g,h),b[g]<m&&S[g]>m&&sR(S,b,g,m)}}function ix(s,r,o,u,h,m){const g=[];for(let b=0;b<s.length;b++){const S=s[b];let E;const O=g.length;let D=0;for(let N=0;N<S.length-1;N++){let B=S[N],U=S[N+1],X=0;const Q=D;let ee,ue;m&&(X=Math.hypot(U.x-B.x,U.y-B.y),D+=X,ee=B,ue=U),B.x<r&&U.x<r||(B.x<r?B=new wt(r,B.y+(r-B.x)/(U.x-B.x)*(U.y-B.y))._round():U.x<r&&(U=new wt(r,B.y+(r-B.x)/(U.x-B.x)*(U.y-B.y))._round()),B.y<o&&U.y<o||(B.y<o?B=new wt(B.x+(o-B.y)/(U.y-B.y)*(U.x-B.x),o)._round():U.y<o&&(U=new wt(B.x+(o-B.y)/(U.y-B.y)*(U.x-B.x),o)._round()),B.x>=u&&U.x>=u||(B.x>=u?B=new wt(u,B.y+(u-B.x)/(U.x-B.x)*(U.y-B.y))._round():U.x>=u&&(U=new wt(u,B.y+(u-B.x)/(U.x-B.x)*(U.y-B.y))._round()),B.y>=h&&U.y>=h||(B.y>=h?B=new wt(B.x+(h-B.y)/(U.y-B.y)*(U.x-B.x),h)._round():U.y>=h&&(U=new wt(B.x+(h-B.y)/(U.y-B.y)*(U.x-B.x),h)._round()),E&&B.equals(E[E.length-1])||(E=[B],g.push(E),m&&m.push({progress:{min:Q+cR(ee,ue,B)*X,max:1},parentIndex:b,prevPoint:ee,nextPoint:ue})),E.push(U),m&&(m[m.length-1].progress.max=Q+cR(ee,ue,U)*X,m[m.length-1].nextPoint=ue)))))}if(m&&D>0)for(let N=O;N<g.length;N++)m[N].progress.min/=D,m[N].progress.max/=D}return g}function HH(s,r,o,u,h){if(s.length<2)return void u.push(s);const m=[];for(;r.valid();){const[E,O]=r.get();for(let D=0;D<s.length-1;D++){const N=s[D],B=s[D+1],U=ei(N,B,E,O);if(U){const[X]=U,Q=new wt(lr(N.x,B.x,X),lr(N.y,B.y,X));m.push({t:D+X,distance:0,point:Q})}}r.next()}if(m.length===0)return void u.push(s);m.sort(((E,O)=>E.t-O.t));let g=0,b=0,S=[];for(u.push(S);g!==s.length;){if(b===m.length){for(;g!==s.length;)S.length!==0&&S[S.length-1].equals(s[g])||S.push(s[g]),g++;break}m[b].t<=g?(S.length!==0&&S[S.length-1].equals(m[b].point)||S.push(m[b].point),Math.trunc(m[b].t),b++):(S.length!==0&&S[S.length-1].equals(s[g])||S.push(s[g]),g++)}}function cR(s,r,o){return s.x!==r.x?(o.x-s.x)/(r.x-s.x):s.y!==r.y?(o.y-s.y)/(r.y-s.y):0}function Lg(s,r){return s.x*r.x+s.y*r.y}function uR(s,r){if(s.length===1){let o=0;const u=r[o++];let h;for(;!h||u.equals(h);)if(h=r[o++],!h)return 1/0;for(;o<r.length;o++){const m=r[o],g=s[0],b=h.sub(u),S=m.sub(u),E=g.sub(u),O=Lg(b,b),D=Lg(b,S),N=Lg(S,S),B=Lg(E,b),U=Lg(E,S),X=O*N-D*D,Q=(N*B-D*U)/X,ee=(O*U-D*B)/X,ue=u.z*(1-Q-ee)+h.z*Q+m.z*ee;if(isFinite(ue))return ue}return 1/0}{let o=1/0;for(const u of r)o=Math.min(o,u.z);return o}}function hR(s,r,o,u,h,m,g,b){const S=g*h.getElevationAt(s,r,!0,!0),E=m[0]!==0,O=E?m[1]===0?g*(m[0]/7-450):g*(function(D,N,B){const U=Math.floor(N[0]/8),X=Math.floor(N[1]/8),Q=10*(N[0]-8*U),ee=10*(N[1]-8*X),ue=D.getElevationAt(U,X,!0,!0),he=D.getMeterToDEM(B),pe=Math.floor(.5*(Q*he-1)),Ae=Math.floor(.5*(ee*he-1)),Ee=D.tileCoordToPixel(U,X),Oe=2*pe+1,De=2*Ae+1,Le=(function(ft,bt,st,mt,Ke){return[ft.getElevationAtPixel(bt,st,!0),ft.getElevationAtPixel(bt+Ke,st,!0),ft.getElevationAtPixel(bt,st+Ke,!0),ft.getElevationAtPixel(bt+mt,st+Ke,!0)]})(D,Ee.x-pe,Ee.y-Ae,Oe,De),ct=Math.abs(Le[0]-Le[1]),Ue=Math.abs(Le[2]-Le[3]),ut=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),_t=Math.min(.25,.5*he*(ct+Ue)/Oe),ht=Math.min(.25,.5*he*ut/De);return ue+Math.max(_t*Q,ht*ee)})(h,m,b):S;return{base:S+(o===0?-1:o),top:E?Math.max(O+u,S+o+2):S+u}}class WH{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZH{constructor(){this.tasks={},this.taskQueue=[],pr(["process"],this),this.invoker=new WH(this.process),this.nextId=0}add(r,o){const u=this.nextId++,h=(function({type:m,isSymbolTile:g,zoom:b}){return b=b||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-b:m==="maybePrepare"&&g?400-b:500:200-b:100-b})(o);if(h===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:o,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((u=>!!this.tasks[u])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const o=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let r=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<o&&(o=m.priority,r=h)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class dR{constructor(r,o,u){this.target=r,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},pr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZH}send(r,o,u,h,m=!1,g){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[b]=u);const S=new Set;return this.target.postMessage({id:b,type:r,hasCallback:!!u,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:ll(o,S)},S),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(r){const o=r.data;if(!o)return;const u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(o.mustQueue||Tn(self)){const h=this.callbacks[u],m=this.scheduler.add((()=>this.processTask(u,o)),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[u]=m)}else this.processTask(u,o)}processTask(r,o){if(delete this.cancelCallbacks[r],o.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(o.error?u(cl(o.error)):u(null,cl(o.data)))}else{const u=new Set,h=o.hasCallback?(g,b)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:g?ll(g):null,data:ll(b,u)},u)}:()=>{},m=cl(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,m,h);else if(this.parent.getWorkerSource){const g=o.type.split("."),{source:b,scope:S}=m;this.parent.getWorkerSource(o.sourceMapId,g[0],b,S)[g[1]](m,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var jg={workerUrl:"",workerClass:null,workerParams:void 0};const F1="mapboxgl_preloaded_worker_pool";class Fh{constructor(){this.active={}}acquire(r,o=Fh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(jg.workerClass!=null?new jg.workerClass:new self.Worker(jg.workerUrl,jg.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[F1]}numActive(){return Object.keys(this.active).length}}Fh.workerCount=2;class Uf{constructor(r,o,u="Worker",h=Fh.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=pt();const m=this.workerPool.acquire(this.id,h);for(let g=0;g<m.length;g++){const b=new Uf.Actor(m[g],o,this.id);b.name=`${u} ${g}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(r,o,u){Qe(this.actors,((h,m)=>{h.send(r,o,m)}),u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((r=>{r.remove()})),this.actors=[],this.workerPool.release(this.id)}}let zg,B1;function ox(){return zg||(zg=new Fh),zg}Uf.Actor=dR;class XH{constructor(r){this.module=r}createIntArray(r){const o=new Int32Array(r),u=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heap32.set(o,u/o.BYTES_PER_ELEMENT),u}createFloatArray(r){const o=new Float32Array(r),u=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heapF32.set(o,u/o.BYTES_PER_ELEMENT),u}createStringBuffer(r){const o=this.module.malloc(r.length+1);for(let u=0;u<r.length;++u)this.module.heapU8[o+u]=r.charCodeAt(u);return this.module.heapU8[o+r.length]=0,o}readStringBuffer(r){let o="";for(;this.module.heapU8[r]!==0;)o+=String.fromCharCode(this.module.heapU8[r]),++r;return o}setStyle(r){const o=r.entranceColorRgb,u=r.facadeGlazingColorRgb,h=r.roofColorRgb,m=r.wallColorRgb,g=r.normalScale;this.module.setStyle(o[0],o[1],o[2],u[0],u[1],u[2],h[0],h[1],h[2],m[0],m[1],m[2],g[0],g[1],g[2],r.tileToMeters)}setAOOptions(r,o){this.module.setAOOptions(r?1:0,o)}setMetricOptions(r,o){this.module.setMetricOptions(r?1:0,o)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,o){this.module.setFacadeOptions(r,o?1:0)}setFauxFacadeOptions(r,o,u){this.module.setFauxFacadeOptions(r?1:0,o?1:0,u)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,o){for(const b of r){const S=this.createStringBuffer(b.roofType),E=[0],O=[];for(const B of b.coordinates)if(Array.isArray(B)){for(const U of B)O.push(U.x),O.push(U.y);E.push(O.length)}const D=this.createIntArray(E),N=this.createFloatArray(O);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,S,b.roofType.length,N,D,E.length-1),this.module.free(S),this.module.free(D),this.module.free(N)}for(const b of o){let S;S=b.entrances?JSON.parse(b.entrances):[];const E=this.createFloatArray(S),O=[];for(const N of b.coordinates)O.push(N.x),O.push(N.y);const D=this.createFloatArray(O);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,E,S.length,D,O.length),this.module.free(E),this.module.free(D)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const u=this.module.getMeshCount(),h=new Array(u);for(let b=0;b<u;b++){const S=this.module.getPositionsPtr(b),E=this.module.getPositionsLength(b),O=new Float32Array(this.module.heapF32.buffer,S,E),D=this.module.getNormalsPtr(b),N=this.module.getNormalsLength(b),B=new Float32Array(this.module.heapF32.buffer,D,N),U=this.module.getColorsPtr(b),X=this.module.getColorsLength(b),Q=new Uint8Array(this.module.heapU8.buffer,U,X),ee=this.module.getAOPtr(b),ue=this.module.getAOLength(b),he=new Float32Array(this.module.heapF32.buffer,ee,ue),pe=this.module.getUVPtr(b),Ae=this.module.getUVLength(b),Ee=new Float32Array(this.module.heapF32.buffer,pe,Ae),Oe=this.module.getFauxFacadePtr(b),De=this.module.getFauxFacadeLength(b),Le=new Uint8Array(this.module.heapU8.buffer,Oe,De),ct=this.module.getIndicesPtr(b),Ue=this.module.getIndicesLength(b),ut=new Int32Array(this.module.heap32.buffer,ct,Ue),_t=this.module.getBuildingPart(b),ht=this.readStringBuffer(_t);h[b]={positions:O,normals:B,colors:Q,ao:he,uv:Ee,isFauxFacade:Le,indices:ut,buildingPart:ht}}const m=this.module.getRingCount(),g=[];for(let b=0;b<m;b++){const S=this.module.getRingPtr(b),E=this.module.getRingLength(b),O=new Float32Array(this.module.heapF32.buffer,S,E);g.push(O)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let Fg,U1,Os,Vf,V1,$f=null,qf=null,fR=null,ax=null;function pR(){return Tn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:U1||ao.DRACO_URL}function mR(){if(Tn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vf)return Vf;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vf=WebAssembly.validate(s)?ao.MESHOPT_SIMD_URL:ao.MESHOPT_URL,Vf}function KH(){return ax}const sx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},YH={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Bg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function gR(s,r,o){const u=o.json.bufferViews.length,h=o.buffers.length;r.bufferView=u,o.json.bufferViews[u]={buffer:h,byteLength:s.byteLength},o.buffers[h]=s}const $1="KHR_draco_mesh_compression";function JH(s,r){const o=s.extensions&&s.extensions[$1];if(!o)return;const u=new Os.Decoder,h=xR(r,o.bufferView),m=new Os.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");const g=r.json.accessors[s.indices],b=sx[g.componentType],S=g.count*b.BYTES_PER_ELEMENT,E=Os._malloc(S);b===Uint16Array?u.GetTrianglesUInt16Array(m,S,E):u.GetTrianglesUInt32Array(m,S,E),gR(Os.memory.buffer.slice(E,E+S),g,r),Os._free(E);for(const O of Object.keys(o.attributes)){const D=u.GetAttributeByUniqueId(m,o.attributes[O]),N=r.json.accessors[s.attributes[O]],B=YH[N.componentType],U=N.count*Bg[N.type]*sx[N.componentType].BYTES_PER_ELEMENT,X=Os._malloc(U);u.GetAttributeDataArrayForAllPoints(m,D,Os[B],U,X),gR(Os.memory.buffer.slice(X,X+U),N,r),Os._free(X)}u.destroy(),m.destroy(),delete s.extensions[$1]}const lx="EXT_meshopt_compression";function QH(s,r){if(!s.extensions||!s.extensions[lx])return;const o=s.extensions[lx],u=new Uint8Array(r.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);V1.decodeGltfBuffer(h,o.count,o.byteStride,u,o.mode,o.filter),s.buffer=r.buffers.length,s.byteOffset=0,r.buffers[s.buffer]=h.buffer,delete s.extensions[lx]}const _R=1179937895,yR=new TextDecoder("utf8");function vR(s,r){return new URL(s,r).href}function eW(s,r,o,u){return fetch(vR(s.uri,u)).then((h=>h.arrayBuffer())).then((h=>{r.buffers[o]=h}))}function xR(s,r){const o=s.json.bufferViews[r];return new Uint8Array(s.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function tW(s,r,o,u){if(s.uri){const h=vR(s.uri,u);return fetch(h).then((m=>m.blob())).then((m=>createImageBitmap(m))).then((m=>{r.images[o]=m}))}if(s.bufferView!==void 0){const h=xR(r,s.bufferView),m=new Blob([h],{type:s.mimeType});return createImageBitmap(m).then((g=>{r.images[o]=g}))}}function bR(s,r=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(s,r,1)[0]===_R){const O=new Uint32Array(s,r);let D=2;const N=(O[D++]>>2)-3,B=O[D++]>>2;if(D++,u.json=JSON.parse(yR.decode(O.subarray(D,D+B))),D+=B,D<N){const U=O[D++];D++;const X=r+(D<<2);u.buffers[0]=s.slice(X,X+U)}}else u.json=JSON.parse(yR.decode(new Uint8Array(s,r)));const{buffers:h,images:m,meshes:g,extensionsUsed:b,bufferViews:S}=u.json;let E=Promise.resolve();if(h){const O=[];for(let D=0;D<h.length;D++){const N=h[D];N.uri?O.push(eW(N,u,D,o)):u.buffers[D]||(u.buffers[D]=null)}E=Promise.all(O)}return E.then((()=>{const O=[],D=b&&b.includes($1),N=b&&b.includes(lx);if(D&&O.push((function(){if(!Os)return Fg??(Fg=(function(B){let U,X=null;function Q(){U=new Uint8Array(X.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const ue={a:{a:ee,d:function(he,pe,Ae){return U.copyWithin(he,pe,pe+Ae)},c:function(he){const pe=U.length,Ae=Math.max(he>>>0,Math.ceil(1.2*pe)),Ee=Math.ceil((Ae-pe)/65536);try{return X.grow(Ee),Q(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,ue):B.then((he=>he.arrayBuffer())).then((he=>WebAssembly.instantiate(he,ue)))).then((he=>{const{Rb:pe,Qb:Ae,P:Ee,T:Oe,X:De,Ja:Le,La:ct,Qa:Ue,Va:ut,Wa:_t,eb:ht,jb:ft,f:bt,e:st,yb:mt,zb:Ke,Ab:Ge,Bb:St,Db:vt,Gb:Qt}=he.instance.exports;X=st;const zt=(()=>{let Gt=0,Ct=0,Yt=0,_r=0;return kt=>{Yt&&(pe(_r),pe(Gt),Ct+=Yt,Yt=Gt=0),Gt||(Ct+=128,Gt=Ae(Ct));const Zt=kt.length+7&-8;let cr=Gt;Zt>=Ct&&(Yt=Zt,cr=_r=Ae(Zt));for(let xr=0;xr<kt.length;xr++)U[cr+xr]=kt[xr];return cr}})();return Q(),bt(),{memory:st,_free:pe,_malloc:Ae,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Oe(this.ptr)}},Decoder:class{constructor(){this.ptr=Le()}destroy(){ft(this.ptr)}DecodeArrayToMesh(Gt,Ct,Yt){const _r=zt(Gt),kt=ct(this.ptr,_r,Ct,Yt.ptr);return!!De(kt)}GetAttributeByUniqueId(Gt,Ct){return{ptr:Ue(this.ptr,Gt.ptr,Ct)}}GetTrianglesUInt16Array(Gt,Ct,Yt){ut(this.ptr,Gt.ptr,Ct,Yt)}GetTrianglesUInt32Array(Gt,Ct,Yt){_t(this.ptr,Gt.ptr,Ct,Yt)}GetAttributeDataArrayForAllPoints(Gt,Ct,Yt,_r,kt){ht(this.ptr,Gt.ptr,Ct.ptr,Yt,_r,kt)}},DT_INT8:mt(),DT_UINT8:Ke(),DT_INT16:Ge(),DT_UINT16:St(),DT_UINT32:vt(),DT_FLOAT32:Qt()}}))})(fetch(pR())),Fg.then((B=>{Os=B,Fg=void 0})))})()),N&&O.push((function(){if(V1)return;const B=(function(U){let X;const Q=WebAssembly.instantiateStreaming(U,{}).then((he=>{X=he.instance,X.exports.__wasm_call_ctors()})),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(he,pe,Ae,Ee,Oe,De){(function(Le,ct,Ue,ut,_t,ht,ft){const bt=Le.exports.sbrk,st=ut+3&-4,mt=bt(st*_t),Ke=bt(ht.length),Ge=new Uint8Array(Le.exports.memory.buffer);Ge.set(ht,Ke);const St=ct(mt,ut,_t,Ke,ht.length);if(St===0&&ft&&ft(mt,st,_t),Ue.set(Ge.subarray(mt,mt+ut*_t)),bt(mt-bt(0)),St!==0)throw new Error(`Malformed buffer data: ${St}`)})(X,X.exports[ue[Oe]],he,pe,Ae,Ee,X.exports[ee[De]])}}})(fetch(mR()));return B.ready.then((()=>{V1=B}))})()),m)for(let B=0;B<m.length;B++)O.push(tW(m[B],u,B,o));return(O.length?Promise.all(O):Promise.resolve()).then((()=>{if(D&&g)for(const{primitives:B}of g)for(const U of B)JH(U,u);if(N&&g&&S)for(const B of S)QH(B,u);return u}))}))}function q1(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function G1(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class H1{constructor(r,o,u,h){this.context=r,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=r.gl.createTexture(),this.update(o,{premultiply:h&&h.premultiply})}update(r,o){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,h=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:m}=this,{gl:g}=m,{x:b,y:S}=o&&o.position?o.position:{x:0,y:0},E=b+u,O=S+h;!this.size||this.size[0]===E&&this.size[1]===O||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!o||o.premultiply!==!1));const D=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&E>0&&O>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(E,O)))+1:1;g.texStorage2D(g.TEXTURE_2D,N,this.format,E,O),this.size=[E,O]}this.size&&(D?g.texSubImage2D(g.TEXTURE_2D,0,b,S,q1(this.format),G1(this.format),r):"data"in r&&r.data&&g.texSubImage2D(g.TEXTURE_2D,0,b,S,u,h,q1(this.format),G1(this.format),r.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(r,o,u=!1){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),o!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(r,o,u,h,m){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),o!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),this.magFilter=o),r!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?r===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrapT=h),m!==this.compareMode&&(m?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,m)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=m)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Ug{constructor(r,o){this.context=r,this.texture=o}bind(r,o){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,r),this.minFilter=r),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}const rW=qr([{name:"a_pos_3f",components:3,type:"Float32"}]),nW=qr([{name:"a_color_3f",components:3,type:"Float32"}]),iW=qr([{name:"a_color_4f",components:4,type:"Float32"}]),oW=qr([{name:"a_uv_2f",components:2,type:"Float32"}]),aW=qr([{name:"a_normal_3f",components:3,type:"Float32"}]),sW=qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),lW=qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function wR(s,r){const o=cx(s.projection,s.zoom,s.width,s.height),u=(function(m,g,b,S,E){const O=new Z(b.lng-180*bu,b.lat),D=new Z(b.lng+180*bu,b.lat),N=m.project(O.lng,O.lat),B=m.project(D.lng,D.lat),U=-Math.atan2(B.y-N.y,B.x-N.x),X=et.fromLngLat(b);X.y=Ie(X.y,-1+bu,1-bu);const Q=X.toLngLat(),ee=m.project(Q.lng,Q.lat),ue=et.fromLngLat(Q);ue.x+=bu;const he=ue.toLngLat(),pe=m.project(he.lng,he.lat),Ae=TR(pe.x-ee.x,pe.y-ee.y,U),Ee=et.fromLngLat(Q);Ee.y+=bu;const Oe=Ee.toLngLat(),De=m.project(Oe.lng,Oe.lat),Le=TR(De.x-ee.x,De.y-ee.y,U),ct=Math.abs(Ae.x)/Math.abs(Le.y),Ue=j([]);ae(Ue,Ue,-U*(1-(E?0:S)));const ut=j([]);return re(ut,ut,[1,1-(1-ct)*S,1]),ut[4]=-Le.x/Le.y*S,ae(ut,ut,U),Y(ut,Ue,ut),ut})(s.projection,0,s.center,o,r),h=SR(s);return re(u,u,[h,h,1]),u}function SR(s){const r=s.projection,o=cx(s.projection,s.zoom,s.width,s.height),u=W1(r,s.center),h=W1(r,Z.convert(r.center));return Math.pow(2,u*o+(1-o)*h)}function cx(s,r,o,u,h=1/0){const m=s.range;if(!m)return 0;const g=Math.min(h,Math.max(o,u)),b=Math.log2(g/1024);return Ye(m[0]+b,m[1]+b,r)}const bu=1/4e4;function W1(s,r){const o=Ie(r.lat,-Te,Te),u=new Z(r.lng-180*bu,o),h=new Z(r.lng+180*bu,o),m=s.project(u.lng,o),g=s.project(h.lng,o),b=et.fromLngLat(u),S=et.fromLngLat(h),E=g.x-m.x,O=g.y-m.y,D=S.x-b.x,N=S.y-b.y,B=Math.sqrt((D*D+N*N)/(E*E+O*O));return Math.log2(B)}function TR(s,r,o){const u=Math.cos(o),h=Math.sin(o);return{x:s*u-r*h,y:s*h+r*u}}function AR(s,r,o){j(s),ae(s,s,Fe(r[2])),se(s,s,Fe(r[0])),J(s,s,Fe(r[1])),re(s,s,o),Y(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ux(s,r,o,u,h,m,g,b){const S=[o[0]-r[0],o[1]-r[1],0],E=[u[0]-r[0],u[1]-r[1],0];if(nt(S)<1e-12||nt(E)<1e-12)return Ho(s);const O=Dr([],S,E);Fr(O,O),Pt(E,u,r),S[2]=(m-h)*b,E[2]=(g-h)*b;const D=S;return Dr(D,S,E),Fr(D,D),Lc(s,O,D)}function Z1(s,r,o=!1){const u=yu(r.zoom),h=(function(m,g,b){const S=g.worldSize,E=[m[12],m[13],m[14]],O=be(E[1]/S),D=Se(E[0]/S),N=j([]),B=xe(1,O)*S,U=xe(1,0)*S*je(O,g.zoom),X=1/w1(S);let Q=U*X;if(b){const pe=cx(g.projection,g.zoom,g.width,g.height,1024);Q=X*g.projection.pixelSpaceConversion(g.center.lat,S,pe)}const ee=z(O,D);it(ee,ee,qt([],Fr([],ee),B*Q*E[2]));const ue=(function(pe){const Ae=[pe[0],pe[1],pe[2]];let Ee=[0,1,0];const Oe=Dr([],Ee,Ae);return Dr(Ee,Ae,Oe),an(Ee)===0&&(Ee=[0,1,0],Dr(Oe,Ae,Ee)),Fr(Oe,Oe),Fr(Ee,Ee),Fr(Ae,Ae),[Oe[0],Oe[1],Oe[2],0,Ee[0],Ee[1],Ee[2],0,Ae[0],Ae[1],Ae[2],0,pe[0],pe[1],pe[2],1]})(ee);re(N,N,[Q,Q,Q*B]),K(N,N,[-E[0],-E[1],-E[2]]);const he=Y([],g.globeMatrix,ue);return Y(he,he,N),Y(he,he,m),he})(s,r,o);if(u>0){const m=(function(g,b){const S=b.worldSize,E=xe(1,0)*S*je(b.center.lat,b.zoom)/w1(S),O=xe(1,b.center.lat)*S,D=j([]);J(D,D,Fe(b.center.lng)),se(D,D,Fe(b.center.lat)),K(D,D,[0,0,f]),re(D,D,[E,E,E*O]);const N=b.point;return K(D,D,[-N.x,-N.y,0]),Y(D,D,g),Y(D,b.globeMatrix,D)})(s,r);return(function(g,b,S){const E=(U,X,Q)=>{const ee=nt(U),ue=nt(X),he=uc(U,X,Q);return qt(he,he,1/nt(he)*lr(ee,ue,Q))},O=E([g[0],g[1],g[2]],[b[0],b[1],b[2]],S),D=E([g[4],g[5],g[6]],[b[4],b[5],b[6]],S),N=E([g[8],g[9],g[10]],[b[8],b[9],b[10]],S),B=uc([g[12],g[13],g[14]],[b[12],b[13],b[14]],S);return[O[0],O[1],O[2],0,D[0],D[1],D[2],0,N[0],N[1],N[2],0,B[0],B[1],B[2],1]})(h,m,u)}return h}function ER(s,r,o,u){const h=hr.projectAabbCorners(u,o);let m=Number.MAX_VALUE,g=-1;for(let E=0;E<h.length;++E){const O=h[E];O[0]=(.5*O[0]+.5)*r.width,O[1]=(.5-.5*O[1])*r.height,O[2]<m&&(g=E,m=O[2])}const b=E=>new wt(h[E][0],h[E][1]);let S;switch(g){case 0:case 6:S=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:S=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:S=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:S=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(na(s,S))return m}const Bh=64,Gf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function PR(s,r,o,u,h,m,g,b,S,E=!1){const O=o.zoom,D=o.project(u),N=je(u.lat,O),B=1/N;j(s),K(s,s,[D.x+g[0]*B,D.y+g[1]*B,g[2]]);let U=1,X=1;const Q=o.worldSize;if(E){if(o.projection.name==="mercator"){let pe=0;o.elevation&&(pe=o.elevation.getAtPointOrZero(new et(D.x/Q,D.y/Q),0));const Ae=Ni([],[D.x,D.y,pe,1],o.projMatrix)[3]/o.cameraToCenterDistance;U=Ae,X=Ae*je(o.center.lat,O)}else if(o.projection.name==="globe"){const pe=Z1(s,o),Ae=[0,0,0,1];Ni(Ae,Ae,Y([],o.projMatrix,pe));const Ee=Ae[3]/o.cameraToCenterDistance,Oe=yu(O),De=o.projection.pixelsPerMeter(u.lat,Q)*je(u.lat,O),Le=o.projection.pixelsPerMeter(o.center.lat,Q)*je(o.center.lat,O);U=Ee/lr(De,qe(o.center.lat),Oe),X=Ee*N/De,U*=Le,X*=Le}}else U=B;re(s,s,[U,U,X]);const ee=[...s],ue=r.orientation,he=[];if(AR(he,[ue[0]+h[0],ue[1]+h[1],ue[2]+h[2]],m),Y(s,ee,he),b&&o.elevation){let pe=0;const Ae=[];if(S&&o.elevation){pe=(function(Oe,De,Le,ct,Ue){const ut=De.elevation;if(!ut)return 0;const _t=hr.projectAabbCorners(Le,ct),ht=xe(1,Ue.lat)*De.worldSize,ft=(function(Ct,Yt){const _r=[0,0,1],kt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Zt of kt){const cr=Ct[Zt.corners[0]],xr=Ct[Zt.corners[1]],kr=Ct[Zt.corners[2]],Sr=[xr[0]-cr[0],xr[1]-cr[1],Yt*(xr[2]-cr[2])],$t=Dr(Sr,Sr,[kr[0]-cr[0],kr[1]-cr[1],Yt*(kr[2]-cr[2])]);Fr($t,$t),Zt.dotProductWithUp=nr($t,_r)}return kt.sort(((Zt,cr)=>Zt.dotProductWithUp-cr.dotProductWithUp)),kt[0].corners})(_t,ht),bt=_t[ft[0]],st=_t[ft[1]],mt=_t[ft[2]],Ke=_t[ft[3]],Ge=ut.getAtPointOrZero(new et(bt[0]/De.worldSize,bt[1]/De.worldSize),0),St=ut.getAtPointOrZero(new et(st[0]/De.worldSize,st[1]/De.worldSize),0),vt=ut.getAtPointOrZero(new et(mt[0]/De.worldSize,mt[1]/De.worldSize),0),Qt=ut.getAtPointOrZero(new et(Ke[0]/De.worldSize,Ke[1]/De.worldSize),0),zt=(Ge+Qt)/2,Gt=(St+vt)/2;return zt>Gt?St<vt?ux(Oe,st,Ke,bt,St,Qt,Ge,ht):ux(Oe,mt,bt,Ke,vt,Ge,Qt,ht):Ge<Qt?ux(Oe,bt,st,mt,Ge,St,vt,ht):ux(Oe,Ke,mt,st,Qt,vt,St,ht),Math.max(zt,Gt)})(Ae,o,r.aabb,s,u);const Ee=Y([],Ne([],Ae),he);Y(s,ee,Ee)}else pe=o.elevation.getAtPointOrZero(new et(D.x/Q,D.y/Q),0);pe!==0&&(s[14]+=pe)}}function Vg(s,r,o=!1){s.uploaded||(s.gfxTexture=new H1(r,s.image,o?r.gl.R8:r.gl.RGBA8,{useMipmap:s.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function cW(s,r,o){s.indexBuffer=r.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=r.createVertexBuffer(s.vertexArray,rW.members,!1,!0),s.normalArray&&(s.normalBuffer=r.createVertexBuffer(s.normalArray,aW.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=r.createVertexBuffer(s.texcoordArray,oW.members,!1,!0)),s.colorArray&&(s.colorBuffer=r.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?nW:iW).members,!1,!0)),s.featureArray&&(s.pbrBuffer=r.createVertexBuffer(s.featureArray,lW.members,!0)),s.segments=Hn.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const u=s.material;u.pbrMetallicRoughness.baseColorTexture&&Vg(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Vg(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Vg(u.normalTexture,r),u.occlusionTexture&&Vg(u.occlusionTexture,r,o),u.emissionTexture&&Vg(u.emissionTexture,r)}function X1(s,r,o){if(s.meshes)for(const u of s.meshes)cW(u,r,o);if(s.children)for(const u of s.children)X1(u,r,o)}function hx(s){if(s.meshes)for(const r of s.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(s.children)for(const r of s.children)hx(r)}function K1(s){if(s.meshes)for(const o of s.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((r=o.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(s.children)for(const o of s.children)K1(o)}function Uh(s,r){const o=s.json.bufferViews[r.bufferView],u=sx[r.componentType];return new u(s.buffers[o.buffer],(r.byteOffset||0)+(o.byteOffset||0),r.count*(o.byteStride&&o.byteStride!==Bg[r.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Bg[r.type]))}function Y1(s,r,o,u){const h=sx[r.componentType],m=(function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),g=s.json.bufferViews[r.bufferView],b=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:Bg[r.type],S=o.float32,E=S.length/o.capacity;for(let O=0,D=0;O<r.count*b;O+=b,D+=E)for(let N=0;N<E;N++)S[D+N]=u[O+N]*m;o._trim()}function uW(s,r,o){const u=s.indices,h=s.attributes,m={};m.indexArray=new Oi;const g=r.json.accessors[u],b=g.count/3;m.indexArray.reserve(b);const S=Uh(r,g);for(let N=0;N<b;N++)m.indexArray.emplaceBack(S[3*N],S[3*N+1],S[3*N+2]);m.indexArray._trim(),m.vertexArray=new ko;const E=r.json.accessors[h.POSITION];m.vertexArray.reserve(E.count);const O=Uh(r,E);for(let N=0;N<E.count;N++)m.vertexArray.emplaceBack(O[3*N],O[3*N+1],O[3*N+2]);if(m.vertexArray._trim(),m.aabb=new hr(E.min,E.max),m.centroid=(function(N,B){const U=[0,0,0],X=N.length;if(X>0){for(let Q=0;Q<X;Q++){const ee=3*N[Q];U[0]+=B[ee],U[1]+=B[ee+1],U[2]+=B[ee+2]}U[0]/=X,U[1]/=X,U[2]/=X}return U})(S,O),h.COLOR_0!==void 0){const N=r.json.accessors[h.COLOR_0],B=Bg[N.type],U=Uh(r,N);m.colorArray=B===3?new ko:new Pa,m.colorArray.resize(N.count),Y1(r,N,m.colorArray,U)}if(h.NORMAL!==void 0){m.normalArray=new ko;const N=r.json.accessors[h.NORMAL];m.normalArray.resize(N.count);const B=Uh(r,N);Y1(r,N,m.normalArray,B)}if(h.TEXCOORD_0!==void 0&&o.length>0){m.texcoordArray=new pu;const N=r.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(N.count);const B=Uh(r,N);Y1(r,N,m.texcoordArray,B)}if(h._FEATURE_ID_RGBA4444!==void 0){const N=r.json.accessors[h._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Uh(r,N))}h._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Uh(r,r.json.accessors[h._FEATURE_RGBA4444]).buffer));const D=s.material;return m.material=(function(N,B){const{emissiveFactor:U=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:Q=.5,normalTexture:ee,occlusionTexture:ue,emissiveTexture:he,doubleSided:pe}=N,{baseColorFactor:Ae=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Oe=1,baseColorTexture:De,metallicRoughnessTexture:Le}=N.pbrMetallicRoughness||{},ct=ue?B[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&ct){const Ue=ue.extensions.KHR_texture_transform;ct.offsetScale=[Ue.offset[0],Ue.offset[1],Ue.scale[0],Ue.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new cn(...Ae),metallicFactor:Ee,roughnessFactor:Oe,baseColorTexture:De?B[De.index]:void 0,metallicRoughnessTexture:Le?B[Le.index]:void 0},doubleSided:pe,emissiveFactor:new cn(...U),alphaMode:X,alphaCutoff:Q,normalTexture:ee?B[ee.index]:void 0,occlusionTexture:ct,emissionTexture:he?B[he.index]:void 0,defined:N.defined===void 0}})(D!==void 0?r.json.materials[D]:{defined:!1},o),m}function IR(s,r,o){const{matrix:u,rotation:h,translation:m,scale:g,mesh:b,extras:S,children:E}=s,O={};if(O.matrix=u||(function(D,N,B,U){var X=N[0],Q=N[1],ee=N[2],ue=N[3],he=X+X,pe=Q+Q,Ae=ee+ee,Ee=X*he,Oe=X*pe,De=X*Ae,Le=Q*pe,ct=Q*Ae,Ue=ee*Ae,ut=ue*he,_t=ue*pe,ht=ue*Ae,ft=U[0],bt=U[1],st=U[2];return D[0]=(1-(Le+Ue))*ft,D[1]=(Oe+ht)*ft,D[2]=(De-_t)*ft,D[3]=0,D[4]=(Oe-ht)*bt,D[5]=(1-(Ee+Ue))*bt,D[6]=(ct+ut)*bt,D[7]=0,D[8]=(De+_t)*st,D[9]=(ct-ut)*st,D[10]=(1-(Ee+Le))*st,D[11]=0,D[12]=B[0],D[13]=B[1],D[14]=B[2],D[15]=1,D})([],h||[0,0,0,1],m||[0,0,0],g||[1,1,1]),b!==void 0){O.meshes=o[b];const D=O.anchor=[0,0];for(const N of O.meshes){const{min:B,max:U}=N.aabb;D[0]+=B[0]+U[0],D[1]+=B[1]+U[1]}D[0]=Math.floor(D[0]/O.meshes.length/2),D[1]=Math.floor(D[1]/O.meshes.length/2)}if(S&&(S.id&&(O.id=S.id),S.lights&&(O.lights=(function(D){if(!D.length)return[];const N=(function(ee){const ue=atob(ee),he=new Uint8Array(ue.length);for(let pe=0;pe<ue.length;pe++)he[pe]=ue.codePointAt(pe);return he})(D),B=[],U=N.length/24,X=new Uint16Array(N.buffer),Q=new Float32Array(N.buffer);for(let ee=0;ee<U;ee++){const ue=X[2*ee*6]/30,he=X[2*ee*6+1]/30,pe=X[2*ee*6+10]/100,Ae=Q[6*ee+1],Ee=Q[6*ee+2],Oe=Q[6*ee+3],De=Q[6*ee+4],Le=Oe-Ae,ct=De-Ee,Ue=Math.hypot(Le,ct);B.push({pos:[Ae+.5*Le,Ee+.5*ct,he],normal:[ct/Ue,-Le/Ue,0],width:Ue,height:ue,depth:pe,points:[Ae,Ee,Oe,De]})}return B})(S.lights))),E){const D=[];for(const N of E)D.push(IR(r.json.nodes[N],r,o));O.children=D}return O}function hW(s){if(s.vertices.length===0||s.indices.length===0)return null;const r=new Qv(s.vertices,s.indices,8,256),[o,u]=[r.min.clone(),r.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:r,min:o,max:u}}function dW(s){if(!s.extras||!s.extras.ground)return null;const r=s.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const o=r[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const g of o){if(!Array.isArray(g)||g.length!==2)continue;const b=g[0],S=g[1];typeof b=="number"&&typeof S=="number"&&u.push(new wt(b,S))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let g=0;g<u.length;g++){const b=u[g],S=u[(g+1)%u.length],E=u[(g+2)%u.length];h+=(b.x-S.x)*(E.y-S.y)-(E.x-S.x)*(b.y-S.y)}h>0&&u.reverse();const m=Ff(u.flatMap((g=>[g.x,g.y])),[]);return m.length===0?null:{vertices:u,indices:m}}function fW(s,r){const o=[],u=[];let h=0;const m=[];for(const g of s){h=o.length;const b=g.vertexArray.float32,S=g.indexArray.uint16;for(let E=0;E<g.vertexArray.length;E++)m[0]=b[3*E+0],m[1]=b[3*E+1],m[2]=b[3*E+2],or(m,m,r),o.push(new wt(m[0],m[1]));for(let E=0;E<3*g.indexArray.length;E++)u.push(S[E]+h)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const b=o[u[g+0]],S=o[u[g+1]],E=o[u[g+2]];(b.x-S.x)*(E.y-S.y)-(E.x-S.x)*(b.y-S.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:o,indices:u}}function CR(s){const r=(function(S,E){const O=[],D=WebGL2RenderingContext;if(S.json.textures)for(const N of S.json.textures){const B={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};N.sampler!==void 0&&Object.assign(B,S.json.samplers[N.sampler]),O.push({image:E[N.source],sampler:B,uploaded:!1})}return O})(s,s.images),o=(function(S,E){const O=[];for(const D of S.json.meshes){const N=[];for(const B of D.primitives)N.push(uW(B,S,E));O.push(N)}return O})(s,r),{scenes:u,scene:h,nodes:m}=s.json,g=u?u[h||0].nodes:[...m.keys()],b=[];for(const S of g)b.push(IR(m[S],s,o));return(function(S,E,O){const D={},N=new Set;for(let B=0;B<S.length;B++){const U=O[E[B]];if(!U.extras)continue;const X=U.extras["mapbox:footprint:version"],Q=U.extras["mapbox:footprint:id"];(X||Q)&&N.add(B),X==="1.0.0"&&Q&&(D[Q]=B)}for(let B=0;B<S.length;B++){if(N.has(B))continue;const U=S[B],X=O[E[B]];if(!X.extras)continue;let Q=null;U.id in D&&(Q=fW(S[D[U.id]].meshes,U.matrix)),Q||(Q=dW(X)),Q&&(U.footprint=hW(Q))}if(N.size>0){const B=Array.from(N.values()).sort(((U,X)=>U-X));for(let U=B.length-1;U>=0;U--)S.splice(B[U],1)}})(b,g,s.json.nodes),b}function pW(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const r=s.vertexArray.float32,o=s.aabb.min[0]-1,u=s.aabb.min[1]-1,h=Bh/(s.aabb.max[0]-o+2),m=Bh/(s.aabb.max[1]-u+2);for(let g=0;g<r.length;g+=3){const b=r[g+2],S=(r[g+0]-o)*h|0,E=(r[g+1]-u)*m|0;b>s.heightmap[E*Bh+S]&&(s.heightmap[E*Bh+S]=b)}}function OR(s,r,o,u,h){o.reserve(o.length+4*s.length),u.reserve(u.length+10*s.length),h.reserve(h.length+10*s.length);let m=u.length;for(const g of s){const b=Math.min(10,Math.max(4,1.3*g.height))*r,S=[-g.normal[1],g.normal[0],0],E=Math.min(.29,.1*g.width/g.depth),O=g.width-2*g.depth*r*(E+.01),D=rr([],g.pos,S,O/2),N=rr([],g.pos,S,-O/2),B=[D[0],D[1],D[2]+g.height],U=[N[0],N[1],N[2]+g.height],X=rr([],g.normal,S,E);qt(X,X,b);const Q=rr([],g.normal,S,-E);qt(Q,Q,b),it(X,D,X),it(Q,N,Q),D[2]+=.1,N[2]+=.1,u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(Q[0],Q[1],Q[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(N[0],N[1],N[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(N[0],N[1],N[2]),u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(Q[0],Q[1],Q[2]);const ee=O/b/2;h.emplaceBack(-ee-E,-1,ee,.8),h.emplaceBack(ee+E,-1,ee,.8),h.emplaceBack(-ee,0,ee,1.3),h.emplaceBack(ee,0,ee,1.3),h.emplaceBack(ee+E,-.8,ee,.7),h.emplaceBack(ee+E,-.8,ee,.7),h.emplaceBack(0,0,ee,1.3),h.emplaceBack(0,0,ee,1.3),h.emplaceBack(ee+E,-1.2,ee,.8),h.emplaceBack(ee+E,-1.2,ee,.8),o.emplaceBack(6+m,4+m,8+m),o.emplaceBack(7+m,9+m,5+m),o.emplaceBack(0+m,1+m,2+m),o.emplaceBack(1+m,3+m,2+m),m+=10}}function mW(s,r){const o={};o.indexArray=new Oi,o.vertexArray=new ko,o.colorArray=new Pa,OR(s,r,o.indexArray,o.vertexArray,o.colorArray);const u={defined:!0};u.emissiveFactor=cn.black;const h={};return h.baseColorFactor=cn.white,u.pbrMetallicRoughness=h,o.material=u,o.aabb=new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const MR=qr([{name:"a_pos_3f",components:3,type:"Float32"}]),gW=qr([{name:"a_normal_3",components:3,type:"Int16"}]),_W=qr([{name:"a_centroid_3",components:3,type:"Int16"}]),RR=qr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),yW=qr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),vW=qr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),xW=qr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),bW=qr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),DR=gt.types,J1=32767;function wW(s,r){const o=Mt+r;for(const u of s)for(const h of u)if(h.x<-r||h.x>o||h.y<-r||h.y>o)return!1;return!0}class kR{constructor(){this.layoutVertexArray=new ko,this.layoutAttenuationArray=new Pa,this.layoutColorArray=new wi,this.indexArray=new Oi,this.indexArrayForConflation=new Oi,this.segmentsBucket=new Hn}}class Q1{constructor(){this.layoutVertexArray=new ko,this.layoutNormalArray=new oc,this.layoutCentroidArray=new oc,this.layoutColorArray=new wi,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Oi,this.indexArrayForConflation=new Oi,this.segmentsBucket=new Hn,this.entranceBloom=new kR}}class NR{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new Q1,this.buildingWithFacade=new Q1,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.buildingWithFacade.layoutFacadePaintArray=new wi,this.buildingWithFacade.layoutFacadeDataArray=new hu,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new wi,this.programConfigurations=new Ia(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.projection=r.projection,this.groundEffect=new j1(r)}updateFootprints(r,o){for(const u of this.footprints)o.push({footprint:u,id:r})}prepare(){return(function(){if(ax!=null||fR!=null)return null;if(qf!=null)return qf;const r=fetch(ao.BUILDING_GEN_URL);return qf=(function(o){let u,h,m,g;function b(){u=new Uint8Array(g.buffer),h=new Int32Array(g.buffer),m=new Float32Array(g.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},O={a:{a:S,f:function(D){const N=u.length,B=Math.max(D>>>0,Math.ceil(1.2*N)),U=Math.ceil((B-N)/65536);try{return g.grow(U),b(),!0}catch{return!1}},g:S,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,O):o.then((D=>D.arrayBuffer())).then((D=>WebAssembly.instantiate(D,O)))).then((D=>{const N=D.instance.exports;return(0,N.g)(),g=N.f,b(),new XH({setStyle:N.h,setAOOptions:N.i,setMetricOptions:N.j,setStructuralOptions:N.k,setFacadeOptions:N.l,setFauxFacadeOptions:N.m,setFacadeClassifierOptions:N.n,addFeature:N.o,addFacade:N.p,generateMesh:N.q,getLastError:N.r,getOuterRingLength:N.s,getMeshCount:N.t,getPositionsPtr:N.u,getPositionsLength:N.v,getNormalsPtr:N.w,getNormalsLength:N.x,getColorsPtr:N.y,getColorsLength:N.z,getAOPtr:N.A,getAOLength:N.B,getUVPtr:N.C,getUVLength:N.D,getFauxFacadePtr:N.E,getFauxFacadeLength:N.F,getIndicesPtr:N.G,getIndicesLength:N.H,getBuildingPart:N.I,getRingCount:N.J,getRingPtr:N.K,getRingLength:N.L,free:N.M,malloc:N.N,heapU8:u,heap32:h,heapF32:m})}))})(r).then((o=>(qf=null,ax=o,ax))).catch((o=>{Vr("Could not load building-gen"),qf=null,fR=o})),qf})()}populate(r,o,u,h){const m=KH();if(!m)return;const g=Ve(u);this.tileToMeter=g,this.brightness=o.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const b=new Map;for(const{feature:S}of r){if(DR[S.type]!=="LineString")continue;const E=this.layers[0]._featureFilter.needGeometry,O=xt(S,E);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),O,u))continue;const D=E?O.geometry:Lt(S,u,h),N=[];for(const Q of D)for(const ee of Q)N.push({x:ee.x,y:ee.y});const B={coordinates:N,crossPerc:S.properties.cross_perc,distanceToRoad:S.properties.distance_to_road,entrances:S.properties.entrances,sourceId:0},U=S.properties.source_id;let X=b.get(U);X||(X=[],b.set(U,X)),X.push(B)}this.maxHeight=0;for(const{feature:S,index:E}of r){if(DR[S.type]==="LineString")continue;const O=this.layers[0]._featureFilter.needGeometry,D=xt(S,O);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom),D,u))continue;const N=O?D.geometry:Lt(S,u,h),B=Mg(N,500);if(!wW(N,163))continue;const U=this.layers[0],X=U.layout.get("building-base").evaluate(S,{},u),Q=U.layout.get("building-height").evaluate(S,{},u),ee=U.layout.get("building-roof-shape").evaluate(S,{},u),ue=U.paint.get("building-ambient-occlusion-intensity"),he=U.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(ee==="flat")continue;const pe=U.layout.get("building-facade").evaluate(S,{},u);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(pe,!1,1);const Ae=S.properties.source_id;let Ee;Ee=b.has(Ae)?b.get(Ae):[];let Oe=0,De=0,Le=0,ct=0,Ue=0,ut=0;if(pe){let $t=Math.round(U.layout.get("building-facade-floors").evaluate(S,{},u));if(X===0){$t=Math.max(1,$t-(Ee.length>0?1:0));let Wr=4;if(Q>100){const ge=[10,13,15];Wr=ge[S.id?S.id%ge.length:0],m.setFacadeOptions(Wr,!0)}Ue=1.6803*Wr/g}else Ue=X/g;ut=Q/g,Ue=Math.min(Ue,ut),Le=U.layout.get("building-facade-unit-width").evaluate(S,{},u)/g,ct=(ut-Ue)/$t,m.setFauxFacadeOptions(!0,!0,Le);const wr=U.layout.get("building-facade-window").evaluate(S,{},u);Oe=wr[0],De=wr[1]}const _t=[],ht=new wt(1/0,1/0),ft=new wt(-1/0,-1/0),bt=new wt(0,0);let st=0;for(const $t of B)if($t.length>0){const wr=[];for(const Wr of $t){const ge=[];for(let _e=Wr.length-1;_e>=0;_e--){const Xe=Wr[_e];ge.push({x:Xe.x,y:Xe.y}),ht.x=Math.min(ht.x,Xe.x),ht.y=Math.min(ht.y,Xe.y),ft.x=Math.max(ft.x,Xe.x),ft.y=Math.max(ft.y,Xe.y),bt.x+=Xe.x,bt.y+=Xe.y,st++}wr.push(ge)}_t.push({id:S.id?S.id:0,height:Q,minHeight:X,sourceId:0,roofType:ee,coordinates:wr})}bt.x/=st||1,bt.y/=st||1;const mt=m.generateMesh(_t,Ee);if(typeof mt=="string"){Vr(`Unable to generate building ${S.id}: ${mt}`);continue}if(mt.meshes.length===0||mt.modifiedPolygonRings.length===0)continue;let Ke=0;for(const $t of mt.meshes)Ke+=$t.positions.length/3;const Ge=pe?this.buildingWithFacade:this.buildingWithoutFacade,St=Ge.segmentsBucket.prepareSegment(Ke,Ge.layoutVertexArray,Ge.indexArray),vt=[];let Qt=null,zt=0,Gt=-1;const Ct=Ge.indexArray.length;let Yt=0;for(const $t of mt.meshes){const wr=Ge.layoutVertexArray.length;if($t.buildingPart==="entrance"){const lt=new Array;for(let ir=0;ir<$t.indices.length;ir+=12){const Nr=$t.positions[ir+0],Lr=$t.positions[ir+1],Rr=$t.positions[ir+3],fn=$t.positions[ir+4],Vn=$t.positions[ir+2],Mr=$t.positions[ir+8]-Vn,On=1,gn=Rr-Nr,en=fn-Lr,Rn=Math.hypot(gn,en);lt.push({pos:[Nr+.5*gn,Lr+.5*en,Vn],normal:[en/Rn,-gn/Rn,0],width:Rn,height:Mr,depth:On,points:[Nr,Lr,Rr,fn]})}const Dt=Ge.entranceBloom.segmentsBucket.prepareSegment(10*lt.length,Ge.entranceBloom.layoutVertexArray,Ge.entranceBloom.indexArray),Rt=Ge.entranceBloom.layoutVertexArray.length;zt=Ge.entranceBloom.indexArray.length,OR(lt,.5/this.tileToMeter,Ge.entranceBloom.indexArray,Ge.entranceBloom.layoutVertexArray,Ge.entranceBloom.layoutAttenuationArray);const Vt=Ge.entranceBloom.layoutVertexArray.length-Rt;Gt=Ge.entranceBloom.indexArray.length-zt;for(let ir=0;ir<Vt;ir++)Ge.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Dt.vertexLength+=Vt,Dt.primitiveLength+=Gt,Qt={part:$t.buildingPart,vertexOffset:Rt,vertexLength:Vt}}for(let lt=0;lt<$t.positions.length;lt+=3)Yt=Math.max(Yt,$t.positions[lt+2]),Ge.layoutVertexArray.emplaceBack($t.positions[lt],$t.positions[lt+1],$t.positions[lt+2]);const Wr=Math.floor(bt.x),ge=Math.floor(bt.y),_e=Math.floor(Yt);for(let lt=0;lt<$t.positions.length;lt+=3)Ge.layoutCentroidArray.emplaceBack(Wr,ge,_e);for(let lt=0;lt<$t.normals.length;lt+=3)Ge.layoutNormalArray.emplaceBack($t.normals[lt+0]*J1,$t.normals[lt+1]*J1,$t.normals[lt+2]*J1);for(let lt=0;lt<$t.ao.length;lt++)Ge.layoutAOArray.push($t.ao[lt]);for(let lt=0;lt<$t.colors.length;lt+=3){const Dt=1+($t.ao[lt/3]-1)*ue;Ge.layoutColorArray.emplaceBack($t.colors[lt]*Dt<<8|$t.colors[lt+1]*Dt,$t.colors[lt+2]*Dt<<8)}if(pe){for(let lt=0;lt<$t.positions.length;lt+=3)Ge.layoutFacadePaintArray.emplaceBack(65535,255);for(let lt=0;lt<$t.isFauxFacade.length;lt++)if($t.isFauxFacade[lt]){const Dt=1|Math.min(65535,Math.floor($t.uv[2*lt]*mt.outerRingLength)),Rt=Math.floor(255*Oe)<<8|Math.floor(255*De),Vt=Math.floor(65535*Math.min(1,Le/Mt)),ir=Math.floor(65535*Math.min(1,ct/Mt));Ge.layoutFacadeDataArray.emplaceBack(Dt,Rt,Vt,ir);const Nr=Math.floor(65535*Math.min(1,Ue/Mt)),Lr=Math.floor(65535*Math.min(1,ut/Mt));Ge.layoutFacadeVerticalRangeArray.emplaceBack(Nr,Lr)}else Ge.layoutFacadeDataArray.emplaceBack(0,0,0,0),Ge.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Xe=St.vertexLength;for(let lt=0;lt<$t.indices.length;lt+=3)Ge.indexArray.emplaceBack(Xe+$t.indices[lt],Xe+$t.indices[lt+1],Xe+$t.indices[lt+2]);St.vertexLength+=$t.positions.length/3,St.primitiveLength+=$t.indices.length/3,($t.buildingPart==="roof"||$t.buildingPart==="wall"||$t.buildingPart==="facade_glazing"||$t.buildingPart==="entrance")&&vt.push({part:$t.buildingPart,vertexOffset:wr,vertexLength:$t.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Yt),this.buildingFeatures.push({feature:D,hasFauxFacade:pe,segment:St,parts:vt,buildingBloom:Qt});const _r=Ge.indexArray.length-Ct,kt=[],Zt=[],cr=new wt(1/0,1/0),xr=new wt(-1/0,-1/0),kr=this.groundEffect.vertexArray.length;for(const $t of mt.modifiedPolygonRings){const wr=[],Wr=new wt(1/0,1/0),ge=new wt(-1/0,-1/0);for(let _e=0;_e<$t.length;_e+=2){const Xe=$t.length-_e-2;Wr.x=Math.min(Wr.x,$t[Xe]),Wr.y=Math.min(Wr.y,$t[Xe+1]),ge.x=Math.max(ge.x,$t[Xe]),ge.y=Math.max(ge.y,$t[Xe+1]);const lt=new wt($t[Xe],$t[Xe+1]);wr.push(lt),kt.push(lt.x,lt.y),Zt.push(lt.clone())}cr.x=Math.min(cr.x,Wr.x),cr.y=Math.min(cr.y,Wr.y),xr.x=Math.max(xr.x,ge.x),xr.y=Math.max(xr.y,ge.y),this.groundEffect.addData(wr,[Wr,ge],he)}const Sr=this.groundEffect.vertexArray.length-kr;(ht.x<0||ft.x>Mt||ht.y<0||ft.y>Mt)&&this.featuresOnBorder.push({featureId:S.id,footprintIndex:this.footprints.length});{const $t=Ff(kt,null,2),wr=new Qv(Zt,$t,8,256);let Wr=S.id;S.properties&&S.properties.hasOwnProperty("building_id")&&(Wr=S.properties.building_id),this.footprints.push({vertices:Zt,indices:$t,grid:wr,min:cr,max:xr,buildingId:Wr,hiddenFlags:0,indicesOffset:Ct,indicesLength:_r,bloomIndicesOffset:zt,bloomIndicesLength:Gt,groundEffectVertexOffset:kr,groundEffectVertexLength:Sr,hasFauxFacade:pe,segment:St,height:Yt})}this.programConfigurations.populatePaintArrays(Ge.layoutVertexArray.length,S,E,{},o.availableImages,u,o.brightness),this.groundEffect.addPaintPropertiesData(S,E,{},o.availableImages,u,o.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(r,o,u,h,m,g,b){this.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b),this.groundEffect.update(r,o,m,u,h,g,b),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const o=u=>{u.layoutVertexBuffer=r.createVertexBuffer(u.layoutVertexArray,MR.members),u.layoutNormalBuffer=r.createVertexBuffer(u.layoutNormalArray,gW.members),u.layoutCentroidBuffer=r.createVertexBuffer(u.layoutCentroidArray,_W.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=r.createVertexBuffer(u.layoutFacadeDataArray,vW.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(u.layoutFacadeVerticalRangeArray,xW.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(u.entranceBloom.layoutVertexArray,MR.members),u.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,bW.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=o=>{o.layoutVertexBuffer&&(o.layoutVertexBuffer.destroy(),o.layoutNormalBuffer.destroy(),o.layoutColorBuffer.destroy(),o.segmentsBucket.destroy(),o.indexBuffer&&o.indexBuffer.destroy(),o.entranceBloom.layoutVertexBuffer&&(o.entranceBloom.layoutVertexBuffer.destroy(),o.entranceBloom.layoutColorBuffer.destroy(),o.entranceBloom.layoutAttenuationBuffer.destroy(),o.entranceBloom.indexBuffer.destroy(),o.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,o,u=!0){let h=!1;const m=u?o:0,g=0|(u?-1:~o);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of r){const S=this.footprints[b],E=S.hiddenFlags&g|m;S.hiddenFlags!==E&&(S.hiddenFlags=E,h=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const o=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};o(this.buildingWithoutFacade),o(this.buildingWithFacade);for(const h of this.footprints){const m=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let S=h.indicesOffset;S<g;S++)m.indexArrayForConflation.uint16[3*S+0]=0,m.indexArrayForConflation.uint16[3*S+1]=0,m.indexArrayForConflation.uint16[3*S+2]=0;const b=h.bloomIndicesOffset+h.bloomIndicesLength;for(let S=h.bloomIndicesOffset;S<b;S++)m.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const u=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=r.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=r.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const o=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=r.createVertexBuffer(u.layoutColorArray,RR.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=r.createVertexBuffer(u.layoutFacadePaintArray,yW.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=r.createVertexBuffer(u.entranceBloom.layoutColorArray,RR.members,!0)};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,o){const u=r.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const m=o[h.feature.id],g=h.feature;g.properties["building-part"]="roof";const b=r.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),S=r.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";const E=r.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),O=r.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";const D=r.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),N=r.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";const B=r.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),U=r.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),X=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ee of h.parts){let ue,he=b;ee.part==="roof"?(he=b,ue=S):ee.part==="wall"?(he=E,ue=O):ee.part==="facade_glazing"?(he=D,ue=N):ee.part==="entrance"&&(he=B,ue=U),ue=Ie(ue,0,1);for(let pe=0;pe<ee.vertexLength;pe++){const Ae=ee.vertexOffset+pe,Ee=1+(X.layoutAOArray[Ae]-1)*u;X.layoutColorArray.emplace(Ae,he.r*Ee*255<<8|he.g*Ee*255,he.b*Ee*255<<8|255*ue),h.hasFauxFacade&&X.layoutFacadePaintArray.emplace(Ae,255*D.r<<8|255*D.g,255*D.b<<8|255*N)}}const Q=h.buildingBloom;if(Q)for(let ee=0;ee<Q.vertexLength;ee++)X.entranceBloom.layoutColorArray.emplace(Q.vertexOffset+ee,255*B.r<<8|255*B.g,255*B.b<<8|51*U)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(r.toUnwrapped());if(tx(this.activeReplacements,h))return;this.activeReplacements=h;for(const g of this.footprints)g.hiddenFlags&=-2;const m=[];for(const g of this.activeReplacements){if(g.order<=FM)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-r.canonical.z));for(const S of this.footprints)S.min.x>g.max.x||S.max.x<g.min.x||S.min.y>g.max.y||S.max.y<g.min.y||(m.length=0,SW(S.vertices,0,S.vertices.length,g.footprintTileId.canonical,r.canonical,m),D1(g.footprint,m,S.indices,0,S.indices.length,0,-b)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(r,o){let u=Number.NEGATIVE_INFINITY,h=!0;const m=4*(r+Mt)*Mt+(o+Mt);if(this.footprintLookup.hasOwnProperty(m)){const b=this.footprintLookup[m];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const g=new wt(r,o);for(const b of this.footprints)r>b.max.x||b.min.x>r||o>b.max.y||b.min.y>o||b.height<=u||k1(g,b)&&(u=b.height,this.footprintLookup[m]=b,h=b.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[m]=void 0}}function SW(s,r,o,u,h,m){const g=Math.pow(2,u.z-h.z);for(let b=0;b<o;b++){let S=s[b+r].x,E=s[b+r].y;S=(S+h.x*Mt)*g-u.x*Mt,E=(E+h.y*Mt)*g-u.y*Mt,m.push(new wt(S,E))}}let LR,jR;Ut(NR,"BuildingBucket",{omit:["layers"]}),Ut(Q1,"BuildingGeometry"),Ut(kR,"BuildingBloomGeometry");const TW=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),AW=qr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:EW}=TW,PW=qr([{name:"a_packed",components:3,type:"Float32"}]),{members:IW}=PW,CW=qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:OW}=CW;class zR{constructor(r,o){this.width=r,this.height=o,this.nextRow=0,this.image=new vu({width:r,height:o}),this.positions={},this.uploaded=!1}getDash(r,o){const u=this.getKey(r,o);return this.positions[u]}trim(){const r=this.width,o=this.height=tr(this.nextRow);this.image.resize({width:r,height:o})}getKey(r,o){return r.join(",")+o}getDashRanges(r,o,u){const h=[];let m=r.length%2==1?-r[r.length-1]*u:0,g=r[0]*u,b=!0;h.push({left:m,right:g,isDash:b,zeroLength:r[0]===0});let S=r[0];for(let E=1;E<r.length;E++){b=!b;const O=r[E];m=S*u,S+=O,g=S*u,h.push({left:m,right:g,isDash:b,zeroLength:O===0})}return h}addRoundDash(r,o,u){const h=o/2;for(let m=-u;m<=u;m++){const g=this.width*(this.nextRow+u+m);let b=0,S=r[b];for(let E=0;E<this.width;E++){E/S.right>1&&(S=r[++b]);const O=Math.abs(E-S.left),D=Math.abs(E-S.right),N=Math.min(O,D);let B;const U=m/u*(h+1);if(S.isDash){const X=h-Math.abs(U);B=Math.sqrt(N*N+X*X)}else B=h-Math.sqrt(N*N+U*U);this.image.data[g+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(r,o){for(let S=r.length-1;S>=0;--S){const E=r[S],O=r[S+1];E.zeroLength?r.splice(S,1):O&&O.isDash===E.isDash&&(O.left=E.left,r.splice(S,1))}const u=r[0],h=r[r.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const m=this.width*this.nextRow;let g=0,b=r[g];for(let S=0;S<this.width;S++){S/b.right>1&&(b=r[++g]);const E=Math.abs(S-b.left),O=Math.abs(S-b.right),D=Math.min(E,O);this.image.data[m+S]=Math.max(0,Math.min(255,(b.isDash?D:-D)+o+128))}}addDash(r,o){const u=this.getKey(r,o);if(this.positions[u])return this.positions[u];const h=o==="round",m=h?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Vr("LineAtlas out of space"),null;r.length===0&&r.push(1);let b=0;for(let O=0;O<r.length;O++)r[O]<0&&(Vr("Negative value is found in line dasharray, replacing values with 0"),r[O]=0),b+=r[O];if(b!==0){const O=this.width/b,D=this.getDashRanges(r,this.width,O);h?this.addRoundDash(D,O,m):this.addRegularDash(D,o==="square"?.5*O:0)}const S=this.nextRow+m;this.nextRow+=g;const E={tl:[S,m],br:[b,0]};return this.positions[u]=E,E}}Ut(zR,"LineAtlas");const MW=gt.types,RW=Math.cos(Math.PI/180*37.5),DW=Math.cos(Math.PI/180*5);class eS{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new Pf,this.layoutVertexArray2=new ko,this.patternVertexArray=new ko,this.indexArray=new Oi,this.programConfigurations=new Ia(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Hn,this.maxLineLength=0,this.zOffsetVertexArray=new ko,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.tessellationStep=r.tessellationStep?r.tessellationStep:Mt/64,this.worldview=r.worldview}updateFootprints(r,o){}populate(r,o,u,h){this.hasPattern=P1("line",this.layers,this.pixelRatio,o);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ve(u);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const N=this.layers[0].layout.get("line-z-offset"),B=N.isConstant()&&!N.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&g==="none"&&Vr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const S=[];for(const{feature:N,id:B,index:U,sourceLayerIndex:X}of r){const Q=this.layers[0]._featureFilter.needGeometry,ee=xt(N,Q);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom,{worldview:this.worldview}),ee,u))continue;const ue=m?m.evaluate(ee,{},u):void 0,he={id:B,properties:N.properties,type:N.type,sourceLayerIndex:X,index:U,geometry:Q?ee.geometry:Lt(N,u,h),patterns:{},sortKey:ue};S.push(he)}m&&S.sort(((N,B)=>N.sortKey-B.sortKey));const{lineAtlas:E,featureIndex:O}=o,D=this.addConstantDashes(E);for(const N of S){const{geometry:B,index:U,sourceLayerIndex:X}=N;if(D&&this.addFeatureDashes(N,E),this.hasPattern){const Q=I1("line",this.layers,N,this.zoom,this.pixelRatio,o);this.patternFeatures.push(Q)}else this.addFeature(N,B,U,u,E.positions,o.availableImages,o.brightness,o.elevationFeatures);O.insert(r[U].feature,B,U,X,this.index)}}addConstantDashes(r){let o=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(h.kind!=="constant"||m.kind!=="constant")o=!0;else{const g=m.value,b=h.value;if(!b)continue;r.addDash(b,g)}}return o}addFeatureDashes(r,o){const u=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let b,S;if(m.kind==="constant"){if(b=m.value,!b)continue}else b=m.evaluate({zoom:u},r);S=g.kind==="constant"?g.value:g.evaluate({zoom:u},r),o.addDash(b,S),r.patterns[h.id]=[o.getKey(b,S)]}}update(r,o,u,h,m,g,b,S){this.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b,S)}addFeatures(r,o,u,h,m,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,u,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,IW)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,OW)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,AW.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,EW),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,o){let u,h;if(o&&o>0?(u=`mapbox_clip_start_${o}`,h=`mapbox_clip_end_${o}`):(u="mapbox_clip_start",h="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(u)&&r.properties.hasOwnProperty(h))return{start:+r.properties[u],end:+r.properties[h]}}addFeature(r,o,u,h,m,g,b,S){const E=this.layers[0].layout,O=E.get("line-join").evaluate(r,{}),D=E.get("line-cap").evaluate(r,{}),N=E.get("line-miter-limit"),B=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const U=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=E.get("line-z-offset").value;const X=this.layers[0].paint.get("line-width").value;if(X.kind!=="constant"&&X.isLineProgressConstant===!1&&(this.variableWidthValue=X),this.elevationType==="road"){const Q=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,o,h,S,O,D,N,B)){const[ee,ue]=this.clipRuntimeLinesToTile(o,1);for(let he=0;he<ee.length;he++){const pe=ee[he],Ae=ue[he],Ee={progress:{min:Ae.progress.min,max:Ae.progress.max},nextDir:this.computeSegNextDir(Ae,pe),prevDir:this.computeSegPrevDir(Ae,pe)};this.addLine(pe,r,h,O,D,N,B,Ee,U&&Ae.parentIndex>0?Ae.parentIndex:null)}this.fillNonElevatedRoadSegment(Q)}}else for(let Q=0;Q<o.length;Q++)this.addLine(o[Q],r,h,O,D,N,B,void 0,U&&Q>0?Q:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,g,h,b,void 0,this.worldview)}computeSegNextDir(r,o){return r.nextPoint.sub(o.at(-2)).unit()}computeSegPrevDir(r,o){return o[1].sub(r.prevPoint).unit()}clipLinesToTile(r,o){return ix(r,-o,-o,Mt+o,Mt+o)}clipRuntimeLinesToTile(r,o){const u=[];return[ix(r,-o,-o,Mt+o,Mt+o,u),u]}addElevatedRoadFeature(r,o,u,h,m,g,b,S){const E=[],O=$n.getElevationFeature(r,h);if(O){const D=this.clipLinesToTile(o,1),N=this.prepareElevatedLines(D,O,u);for(const B of N)E.push({geometry:B,elevation:O,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const D of E){const N=this.layoutVertexArray.length;this.addLine(D.geometry,r,u,m,g,b,S);const B=new mi(u,D.elevationTileID);if(D.elevation)for(let U=N;U<this.layoutVertexArray.length;U++){const X=new wt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),Q=B.pointElevation(X,D.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(N)}return!0}prepareElevatedLines(r,o,u){if(o.constantHeight!=null)return r;const h=[],m=1/Ve(u);for(const g of r)HH(g,new dn(o,m),0,h);return h}fillNonElevatedRoadSegment(r){for(let o=r;o<this.layoutVertexArray.length;o++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,o,u,h,m,g,b,S,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=E?this.lineFeatureClips(o,E):this.lineClips;const O=h==="none";this.patternJoinNone=this.hasPattern&&O,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const D=S&&S.progress.min>0,N=S&&S.progress.max<1;if(this.lineClips){let Le={min:this.lineClips.start,max:this.lineClips.end},ct=1;if(S){const _t=this.lineClips.end-this.lineClips.start;Le=(function(ht,ft,bt){return{min:xs(ht.min,ft,bt),max:xs(ht.max,ft,bt)}})(S.progress,{min:0,max:1},Le),_t>0&&(ct=(Le.max-Le.min)/_t)}const Ue=+o.properties.mapbox_clip_feature_len,ut=+o.properties.mapbox_clip_seg_len;if(Number.isNaN(Ue)||Number.isNaN(ut)){for(let ht=0;ht<r.length-1;ht++)this.totalDistance+=r[ht].dist(r[ht+1]);const _t=this.totalDistance/(Le.max-Le.min);this.totalFeatureLength=Number.isFinite(_t)?_t:0,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ue,this.distance=ut*ct,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const B=MW[o.type]==="Polygon";let U=r.length;for(;U>=2&&r[U-1].equals(r[U-2]);)U--;let X=0;for(;X<U-1&&r[X].equals(r[X+1]);)X++;if(U<(B?3:2))return;h==="bevel"&&(g=1.05);const Q=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let ee,ue,he,pe,Ae,Ee,Oe,De;S&&S.prevDir&&(Ee=S.prevDir.perp()),S&&S.nextDir&&(Oe=S.nextDir.perp()),this.e1=this.e2=-1,B&&(ee=r[U-2],Ae=r[X].sub(ee)._unit()._perp());for(let Le=X;Le<U;Le++){if(he=Le===U-1?B?r[X+1]:void 0:r[Le+1],he&&r[Le].equals(he))continue;Ae&&(pe=Ae),ee&&(ue=ee),ee=r[Le],De=this.evaluateLineProgressFeatures(ue?ue.dist(ee):0),Ae=he?he.sub(ee)._unit()._perp():pe,pe=pe||Ae;const ct=ue&&he;let Ue=ct?h:B||O?"butt":m;const ut=pe.x*Ae.x+pe.y*Ae.y;if(O){const Ge=function(St){if(St.patternJoinNone){const vt=St.segmentPoints.length/2,Qt=St.lineSoFar-St.segmentStart;for(let zt=0;zt<vt;++zt){const Gt=St.segmentPoints[2*zt+1],Ct=Math.round(St.segmentPoints[2*zt])+.5+.25*Gt;St.patternVertexArray.emplaceBack(Ct,Qt,St.segmentStart),St.patternVertexArray.emplaceBack(Ct,Qt,St.segmentStart)}St.segmentPoints.length=0}St.e1=St.e2=-1};if(ct&&ut<DW){this.updateDistance(ue,ee),this.addCurrentVertex(ee,pe,1,1,Q,De),Ge(this),this.addCurrentVertex(ee,Ae,-1,-1,Q,De);continue}if(ue){if(!he){this.updateDistance(ue,ee),this.addCurrentVertex(ee,pe,1,1,Q,De),Ge(this);continue}Ue="miter"}}let _t=pe.add(Ae);_t.x===0&&_t.y===0||_t._unit();const ht=_t.x*Ae.x+_t.y*Ae.y,ft=ht!==0?1/ht:1/0,bt=2*Math.sqrt(2-2*ht),st=ht<RW&&ue&&he,mt=pe.x*Ae.y-pe.y*Ae.x>0,Ke=this.overscaling<=16?15*Mt/(512*this.overscaling):0;if(ct&&Ue==="round"){if(ft<b)Ue="miter";else if(ft<=2){const Ge=tS(ee,-10,Mt+10);Ue=this.elevationType==="offset"&&(Ge||this.hasCrossSlope)?"miter":"fakeround"}}if(Ue==="miter"&&ft>g&&(Ue="bevel"),Ue==="bevel"&&(ft>2&&(Ue="flipbevel"),ft<g&&(Ue="miter")),ue&&!(Ue==="miter"&&st)&&this.updateDistance(ue,ee),Ue==="miter")if(st){const Ge=ee.dist(ue);if(Ge>2*Ke){const vt=ee.sub(ee.sub(ue)._mult(Ke/Ge)._round());this.updateDistance(ue,vt),this.addCurrentVertex(vt,pe,0,0,Q,De),ue=vt}this.updateDistance(ue,ee),_t._mult(ft),this.addCurrentVertex(ee,_t,0,0,Q,De);const St=ee.dist(he);if(St>2*Ke){const vt=ee.add(he.sub(ee)._mult(Ke/St)._round());this.updateDistance(ee,vt),this.addCurrentVertex(vt,Ae,0,0,Q,De),ee=vt}}else _t._mult(ft),this.addCurrentVertex(ee,_t,0,0,Q,De);else if(Ue==="flipbevel"){if(ft>100)_t=Ae.mult(-1);else{const Ge=ft*pe.add(Ae).mag()/pe.sub(Ae).mag();_t._perp()._mult(Ge*(mt?-1:1))}this.addCurrentVertex(ee,_t,0,0,Q,De),this.addCurrentVertex(ee,_t.mult(-1),0,0,Q,De)}else if(Ue==="bevel"||Ue==="fakeround"){De!=null&&ue&&this.addCurrentVertex(ee,Oe||pe,-1,-1,Q,De);const Ge=ee.dist(ue)<=2*Ke&&Ue!=="bevel",St=_t.mult(mt?1:-1);St._mult(ft);const vt=Ae.mult(mt?-1:1),Qt=pe.mult(mt?-1:1),zt=this.evaluateLineProgressFeatures(this.distance);if(De==null&&(this.addHalfVertex(ee,St.x,St.y,!1,!mt,0,Q,zt),Ge||this.addHalfVertex(ee,St.x+2*Qt.x,St.y+2*Qt.y,!1,mt,0,Q,zt)),Ue==="fakeround"){const Gt=Math.round(180*bt/Math.PI/20);this.addHalfVertex(ee,Qt.x,Qt.y,!1,mt,0,Q,zt);for(let Ct=0;Ct<Gt;Ct++){let Yt=Ct/Gt;if(Yt!==.5){const kt=Yt-.5;Yt+=Yt*kt*(Yt-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*kt*kt+(.848013+ut*(.215638*ut-1.06021)))}const _r=vt.sub(Qt)._mult(Yt)._add(Qt)._unit();this.addHalfVertex(ee,_r.x,_r.y,!1,mt,0,Q,zt)}this.addHalfVertex(ee,vt.x,vt.y,!1,mt,0,Q,zt)}Ge||De!=null||this.addHalfVertex(ee,St.x+2*vt.x,St.y+2*vt.y,!1,mt,0,Q,zt),De!=null&&he&&this.addCurrentVertex(ee,Ee||Ae,1,1,Q,De)}else if(Ue==="butt")this.addCurrentVertex(ee,_t,0,0,Q,De);else if(Ue==="square"){if(!ue){const Ge=D?0:-1;this.addCurrentVertex(ee,_t,Ge,Ge,Q,De)}if(this.addCurrentVertex(ee,_t,0,0,Q,De),ue){const Ge=N?0:1;this.addCurrentVertex(ee,_t,Ge,Ge,Q,De)}}else if(Ue==="round"){if(ue){const Ge=!ct&&Oe?Oe:pe;this.addCurrentVertex(ee,Ge,0,0,Q,De),!ct&&N||this.addCurrentVertex(ee,Ge,1,1,Q,De,!0)}if(he){const Ge=!ct&&Ee?Ee:Ae;!ct&&D||this.addCurrentVertex(ee,Ge,-1,-1,Q,De,!0),this.addCurrentVertex(ee,Ge,0,0,Q,De)}}}}addVerticesTo(r,o,u,h,m,g,b,S,E,O){const D=(o.w-r.w)/this.tessellationStep|0;let N=0;const B=this.scaledDistance;if(D>1){this.lineSoFar=r.w;const X=(o.x-r.x)/D,Q=(o.y-r.y)/D,ee=(o.z-r.z)/D,ue=(o.w-r.w)/D;for(let he=1;he<D;++he){r.x+=X,r.y+=Q,r.z+=ee,this.lineSoFar+=ue,N+=ue;const pe=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(r,u,h,O,!1,b,E,pe),this.addHalfVertex(r,m,g,O,!0,-S,E,pe)}}this.lineSoFar=o.w,this.scaledDistance=B;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,h,O,!1,b,E,U),this.addHalfVertex(o,m,g,O,!0,-S,E,U)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):Vr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:o}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}}addCurrentVertex(r,o,u,h,m,g,b=!1){const S=o.x+o.y*u,E=o.y-o.x*u,O=o.y*h-o.x,D=-o.y-o.x*h;if(g!=null){const N=this.elevationType==="offset",B=-10,U=Mt+10,X=g.zOffset,Q=new aR(r.x,r.y,X,this.lineSoFar),ee=!!N&&tS(r,B,U),ue=this.lineSoFar,he=this.distance;if(this.currentVertex)if(ee){const pe=this.currentVertexIsOutside,Ae=this.currentVertex,Ee=new aR(r.x,r.y,X,this.lineSoFar);if(lR(Ae,Ee,B,U),!tS(Ee,B,U)){if(pe){this.e1=this.e2=-1,this.distance-=Ae.dist(Q),this.lineSoFar=Ae.w;const Oe=this.evaluateLineProgressFeatures(Ae.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ae,S,E,b,!1,u,m,Oe),this.addHalfVertex(Ae,O,D,b,!0,-h,m,Oe),this.prevDistance=this.distance}this.distance=this.prevDistance+Ae.dist(Ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ae,Ee,S,E,O,D,u,h,m,b),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const pe=this.currentVertex;if(this.currentVertexIsOutside){lR(pe,Q,B,U),this.e1=this.e2=-1,this.distance-=pe.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=pe.w;const Ae=this.evaluateLineProgressFeatures(pe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(pe,S,E,b,!1,u,m,Ae),this.addHalfVertex(pe,O,D,b,!0,-h,m,Ae),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(pe,Q,S,E,O,D,u,h,m,b)}else ee||(this.addHalfVertex(r,S,E,b,!1,u,m,g),this.addHalfVertex(r,O,D,b,!0,-h,m,g));this.currentVertex=Q,this.currentVertexIsOutside=ee,this.lineSoFar=ue}else this.addHalfVertex(r,S,E,b,!1,u,m,g),this.addHalfVertex(r,O,D,b,!0,-h,m,g)}addHalfVertex({x:r,y:o},u,h,m,g,b,S,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(o<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=lr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const O=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),S.primitiveLength++),g?this.e2=O:this.e1=O,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,o){this.prevDistance=this.distance,this.distance+=r.dist(o),this.updateScaledDistance()}}function tS(s,r,o){return s.x<r||s.x>o||s.y<r||s.y>o}let FR,BR;function UR(s,r,o){return r*(Mt/(s.tileSize*Math.pow(2,o-s.tileID.overscaledZ)))}Ut(eS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const VR=(s,r,o)=>(1-o)*s+o*r;function $R(s,r){return 1/UR(s,1,r.tileZoom)}function qR(s,r,o,u){return s.translatePosMatrix(u||r.tileID.projMatrix,r,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const GR=s=>{const r=[];HR(s)&&r.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const o=s.paint.get("line-trim-offset");o[0]===0&&o[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=s.layout.get("line-join").constantOr("miter")==="none",h=!!s.paint.get("line-pattern").constantOr(1);return u&&h&&r.push("LINE_JOIN_NONE"),r};function HR(s){const r=s.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let rS;const WR=()=>rS||(rS={layout:FR||(FR=new Xn({"line-cap":new Nt(Be.layout_line["line-cap"]),"line-join":new Nt(Be.layout_line["line-join"]),"line-miter-limit":new Tt(Be.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Be.layout_line["line-round-limit"]),"line-sort-key":new Nt(Be.layout_line["line-sort-key"]),"line-z-offset":new Nt(Be.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(Be.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(Be.layout_line["line-cross-slope"]),visibility:new Tt(Be.layout_line.visibility),"line-width-unit":new Tt(Be.layout_line["line-width-unit"])})),paint:BR||(BR=new Xn({"line-opacity":new Nt(Be.paint_line["line-opacity"]),"line-color":new Nt(Be.paint_line["line-color"]),"line-translate":new Tt(Be.paint_line["line-translate"]),"line-translate-anchor":new Tt(Be.paint_line["line-translate-anchor"]),"line-width":new Nt(Be.paint_line["line-width"]),"line-gap-width":new Nt(Be.paint_line["line-gap-width"]),"line-offset":new Nt(Be.paint_line["line-offset"]),"line-blur":new Nt(Be.paint_line["line-blur"]),"line-dasharray":new Nt(Be.paint_line["line-dasharray"]),"line-pattern":new Nt(Be.paint_line["line-pattern"]),"line-pattern-cross-fade":new Tt(Be.paint_line["line-pattern-cross-fade"]),"line-gradient":new su(Be.paint_line["line-gradient"]),"line-trim-offset":new Tt(Be.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(Be.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(Be.paint_line["line-trim-color"]),"line-emissive-strength":new Tt(Be.paint_line["line-emissive-strength"]),"line-border-width":new Nt(Be.paint_line["line-border-width"]),"line-border-color":new Nt(Be.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(Be.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},rS);class kW extends Nt{possiblyEvaluate(r,o){return o=new Cn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition,worldview:o.worldview}),super.possiblyEvaluate(r,o)}evaluate(r,o,u,h){return o=Object.assign({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(r,o,u,h)}}let $g;function ZR(s,r){return r>0?r+2*s:s}const NW=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),LW=qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),jW=qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zW=qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),FW=qr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),BW=qr([{name:"a_texb",components:2,type:"Uint16"}]),UW=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),VW=qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const XR=qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$W=qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Gi=24;function qW(s,r,o){return s.sections.forEach((u=>{u.text=(function(h,m,g){const b=m.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),Ya.applyArabicShaping&&(h=Ya.applyArabicShaping(h)),h})(u.text,r,o)})),s}const qg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function GW(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function HW(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}const nS=4294967296,KR=1/nS,YR=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let dx=class{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,r,o=this.length){for(;this.pos<o;){const u=this.readVarint(),h=u>>3,m=this.pos;this.type=7&u,s(h,r,this),this.pos===m&&this.skip(u)}return r}readMessage(s,r){return this.readFields(s,r,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*nS;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*nS;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const r=this.buf;let o,u;return u=r[this.pos++],o=127&u,u<128?o:(u=r[this.pos++],o|=(127&u)<<7,u<128?o:(u=r[this.pos++],o|=(127&u)<<14,u<128?o:(u=r[this.pos++],o|=(127&u)<<21,u<128?o:(u=r[this.pos],o|=(15&u)<<28,(function(h,m,g){const b=g.buf;let S,E;if(E=b[g.pos++],S=(112&E)>>4,E<128||(E=b[g.pos++],S|=(127&E)<<3,E<128)||(E=b[g.pos++],S|=(127&E)<<10,E<128)||(E=b[g.pos++],S|=(127&E)<<17,E<128)||(E=b[g.pos++],S|=(127&E)<<24,E<128)||(E=b[g.pos++],S|=(1&E)<<31,E<128))return Hf(h,S,m);throw new Error("Expected varint not more than 10 bytes")})(o,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&YR?YR.decode(this.buf.subarray(r,s)):(function(o,u,h){let m="",g=u;for(;g<h;){const b=o[g];let S,E,O,D=null,N=b>239?4:b>223?3:b>191?2:1;if(g+N>h)break;N===1?b<128&&(D=b):N===2?(S=o[g+1],(192&S)==128&&(D=(31&b)<<6|63&S,D<=127&&(D=null))):N===3?(S=o[g+1],E=o[g+2],(192&S)==128&&(192&E)==128&&(D=(15&b)<<12|(63&S)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):N===4&&(S=o[g+1],E=o[g+2],O=o[g+3],(192&S)==128&&(192&E)==128&&(192&O)==128&&(D=(15&b)<<18|(63&S)<<12|(63&E)<<6|63&O,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,N=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),g+=N}return m})(this.buf,r,s)}readBytes(){const s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r}readPackedVarint(s=[],r){const o=this.readPackedEnd();for(;this.pos<o;)s.push(this.readVarint(r));return s}readPackedSVarint(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const r=this.readPackedEnd();for(;this.pos<r;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const r=7&s;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(s,r){this.writeVarint(s<<3|r)}realloc(s){let r=this.length||16;for(;r<this.pos+s;)r*=2;if(r!==this.length){const o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*KR),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*KR),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?(function(r,o){let u,h;if(r>=0?(u=r%4294967296|0,h=r/4294967296|0):(u=~(-r%4294967296),h=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(m,g,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)})(u,0,o),(function(m,g){const b=(7&m)<<4;g.buf[g.pos++]|=b|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(h,o)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const r=this.pos;this.pos=(function(u,h,m){for(let g,b,S=0;S<h.length;S++){if(g=h.charCodeAt(S),g>55295&&g<57344){if(!b){g>56319||S+1===h.length?(u[m++]=239,u[m++]=191,u[m++]=189):b=g;continue}if(g<56320){u[m++]=239,u[m++]=191,u[m++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(u[m++]=239,u[m++]=191,u[m++]=189,b=null);g<128?u[m++]=g:(g<2048?u[m++]=g>>6|192:(g<65536?u[m++]=g>>12|224:(u[m++]=g>>18|240,u[m++]=g>>12&63|128),u[m++]=g>>6&63|128),u[m++]=63&g|128)}return m})(this.buf,s,this.pos);const o=this.pos-r;o>=128&&JR(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const r=s.length;this.writeVarint(r),this.realloc(r);for(let o=0;o<r;o++)this.buf[this.pos++]=s[o]}writeRawMessage(s,r){this.pos++;const o=this.pos;s(r,this);const u=this.pos-o;u>=128&&JR(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(s,r,o){this.writeTag(s,2),this.writeRawMessage(r,o)}writePackedVarint(s,r){r.length&&this.writeMessage(s,WW,r)}writePackedSVarint(s,r){r.length&&this.writeMessage(s,ZW,r)}writePackedBoolean(s,r){r.length&&this.writeMessage(s,YW,r)}writePackedFloat(s,r){r.length&&this.writeMessage(s,XW,r)}writePackedDouble(s,r){r.length&&this.writeMessage(s,KW,r)}writePackedFixed32(s,r){r.length&&this.writeMessage(s,JW,r)}writePackedSFixed32(s,r){r.length&&this.writeMessage(s,QW,r)}writePackedFixed64(s,r){r.length&&this.writeMessage(s,e9,r)}writePackedSFixed64(s,r){r.length&&this.writeMessage(s,t9,r)}writeBytesField(s,r){this.writeTag(s,2),this.writeBytes(r)}writeFixed32Field(s,r){this.writeTag(s,5),this.writeFixed32(r)}writeSFixed32Field(s,r){this.writeTag(s,5),this.writeSFixed32(r)}writeFixed64Field(s,r){this.writeTag(s,1),this.writeFixed64(r)}writeSFixed64Field(s,r){this.writeTag(s,1),this.writeSFixed64(r)}writeVarintField(s,r){this.writeTag(s,0),this.writeVarint(r)}writeSVarintField(s,r){this.writeTag(s,0),this.writeSVarint(r)}writeStringField(s,r){this.writeTag(s,2),this.writeString(r)}writeFloatField(s,r){this.writeTag(s,5),this.writeFloat(r)}writeDoubleField(s,r){this.writeTag(s,1),this.writeDouble(r)}writeBooleanField(s,r){this.writeVarintField(s,+r)}};function Hf(s,r,o){return o?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function JR(s,r,o){const u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));o.realloc(u);for(let h=o.pos-1;h>=s;h--)o.buf[h+u]=o.buf[h]}function WW(s,r){for(let o=0;o<s.length;o++)r.writeVarint(s[o])}function ZW(s,r){for(let o=0;o<s.length;o++)r.writeSVarint(s[o])}function XW(s,r){for(let o=0;o<s.length;o++)r.writeFloat(s[o])}function KW(s,r){for(let o=0;o<s.length;o++)r.writeDouble(s[o])}function YW(s,r){for(let o=0;o<s.length;o++)r.writeBoolean(s[o])}function JW(s,r){for(let o=0;o<s.length;o++)r.writeFixed32(s[o])}function QW(s,r){for(let o=0;o<s.length;o++)r.writeSFixed32(s[o])}function e9(s,r){for(let o=0;o<s.length;o++)r.writeFixed64(s[o])}function t9(s,r){for(let o=0;o<s.length;o++)r.writeSFixed64(s[o])}const iS=3;function r9(s,r,o){r.glyphs=[],s===1&&o.readMessage(n9,r)}function n9(s,r,o){if(s===3){const{id:u,bitmap:h,width:m,height:g,left:b,top:S,advance:E}=o.readMessage(i9,{});r.glyphs.push({id:u,bitmap:new vu({width:m+2*iS,height:g+2*iS},h),metrics:{width:m,height:g,left:b,top:S,advance:E}})}else s===4?r.ascender=o.readSVarint():s===5&&(r.descender=o.readSVarint())}function i9(s,r,o){s===1?r.id=o.readVarint():s===2?r.bitmap=o.readBytes():s===3?r.width=o.readVarint():s===4?r.height=o.readVarint():s===5?r.left=o.readSVarint():s===6?r.top=o.readSVarint():s===7&&(r.advance=o.readVarint())}const QR=iS,aa={horizontal:1,vertical:2,horizontalOnly:3};class Gg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,o){const u=new Gg;return u.scale=r||1,u.fontStack=o,u}static forImage(r){const o=new Gg;return o.image=r,o}}class Wf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o,u){const h=new Wf;for(let m=0;m<r.sections.length;m++){const g=r.sections[m];g.image?h.addImageSection(g,u):h.addTextSection(g,o)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=(function(o,u){let h="";for(let m=0;m<o.length;m++){const g=o.charCodeAt(m+1)||null,b=o.charCodeAt(m-1)||null;h+=!u&&(g&&xf(g)&&!qg[o[m+1]]||b&&xf(b)&&!qg[o[m-1]])||!qg[o[m]]?o[m]:qg[o[m]]}return h})(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&fx[this.text.charCodeAt(u)];u++)r++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&fx[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const u=new Wf;return u.text=this.text.substring(r,o),u.sectionIndex=this.sectionIndex.slice(r,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,o)=>Math.max(r,this.sections[o].scale)),0)}addTextSection(r,o){this.text+=r.text,this.sections.push(Gg.forText(r.scale,r.fontStack||o));const u=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(u)}addImageSection(r,o){const u=r.image?r.image.getPrimary():null;if(!u)return void Vr("Can't add FormattedSection with an empty image.");u.scaleSelf(o);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Gg.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Vr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function oS(s,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X=1){const Q=Wf.fromFeature(s,h,X);D===aa.vertical&&Q.verticalizePunctuation(N);let ee=[];const ue=(function(Oe,De,Le,ct,Ue,ut){if(!Oe)return[];const _t=[],ht=(function(mt,Ke,Ge,St,vt,Qt){let zt=0;for(let Gt=0;Gt<mt.length();Gt++){const Ct=mt.getSection(Gt);zt+=eD(mt.getCodePoint(Gt),Ct,St,vt,Ke,Qt)}return zt/Math.max(1,Math.ceil(zt/Ge))})(Oe,De,Le,ct,Ue,ut),ft=Oe.text.indexOf("")>=0;let bt=0;for(let mt=0;mt<Oe.length();mt++){const Ke=Oe.getSection(mt),Ge=Oe.getCodePoint(mt);if(fx[Ge]||(bt+=eD(Ge,Ke,ct,Ue,De,ut)),mt<Oe.length()-1){const St=!((st=Ge)<11904||!(sr["Bopomofo Extended"](st)||sr.Bopomofo(st)||sr["CJK Compatibility Forms"](st)||sr["CJK Compatibility Ideographs"](st)||sr["CJK Compatibility"](st)||sr["CJK Radicals Supplement"](st)||sr["CJK Strokes"](st)||sr["CJK Symbols and Punctuation"](st)||sr["CJK Unified Ideographs Extension A"](st)||sr["CJK Unified Ideographs"](st)||sr["Enclosed CJK Letters and Months"](st)||sr["Halfwidth and Fullwidth Forms"](st)||sr.Hiragana(st)||sr["Ideographic Description Characters"](st)||sr["Kangxi Radicals"](st)||sr["Katakana Phonetic Extensions"](st)||sr.Katakana(st)||sr["Vertical Forms"](st)||sr["Yi Radicals"](st)||sr["Yi Syllables"](st)));(o9[Ge]||St||Ke.image)&&_t.push(rD(mt+1,bt,ht,_t,a9(Ge,Oe.getCodePoint(mt+1),St&&ft),!1))}}var st;return nD(rD(Oe.length(),bt,ht,_t,0,!0))})(Q,E,m,r,u,B),{processBidirectionalText:he,processStyledBidirectionalText:pe}=Ya;if(he&&Q.sections.length===1){const Oe=he(Q.toString(),ue);for(const De of Oe){const Le=new Wf;Le.text=De,Le.sections=Q.sections;for(let ct=0;ct<De.length;ct++)Le.sectionIndex.push(0);ee.push(Le)}}else if(pe){const Oe=pe(Q.text,Q.sectionIndex,ue);for(const De of Oe){const Le=new Wf;Le.text=De[0],Le.sectionIndex=De[1],Le.sections=Q.sections,ee.push(Le)}}else ee=(function(Oe,De){const Le=[],ct=Oe.text;let Ue=0;for(const ut of De)Le.push(Oe.substring(Ue,ut)),Ue=ut;return Ue<ct.length&&Le.push(Oe.substring(Ue,ct.length)),Le})(Q,ue);const Ae=[],Ee={positionedLines:Ae,text:Q.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Oe,De,Le,ct,Ue,ut,_t,ht,ft,bt,st,mt){let Ke=0,Ge=0,St=0;const vt=ht==="right"?1:ht==="left"?0:.5;let Qt=!1;for(const kt of Ue){const Zt=kt.getSections();for(const cr of Zt){if(cr.image)continue;const xr=De[cr.fontStack];if(xr&&(Qt=xr.ascender!==void 0&&xr.descender!==void 0,!Qt))break}if(!Qt)break}let zt=0;for(const kt of Ue){kt.trim();const Zt=kt.getMaxScale(),cr=(Zt-1)*Gi,xr={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[zt]=xr;const kr=xr.positionedGlyphs;let Sr=0;if(!kt.length()){Ge+=ut,++zt;continue}let $t=0,wr=0;for(let ge=0;ge<kt.length();ge++){const _e=kt.getSection(ge),Xe=kt.getSectionIndex(ge),lt=kt.getCodePoint(ge);let Dt=_e.scale,Rt=null,Vt=null,ir=null,Nr=Gi,Lr=0,Rr=ft;Rr===aa.vertical&&((Gt=lt)===12312||Gt===12313||Gt===12316||Gt===12540||Gt===12448)&&(Rr=aa.horizontal);const fn=!(Rr===aa.horizontal||!st&&!vf(lt)||st&&(fx[lt]||a1(lt)));if(_e.image){const Vn=ct.get(_e.image.toString());if(!Vn)continue;ir=_e.image,Oe.iconsInText=Oe.iconsInText||!0,Vt=Vn.paddedRect;const Mr=Vn.displaySize;Dt=Dt*Gi/mt,Rt={width:Mr[0],height:Mr[1],left:0,top:-QR,advance:fn?Mr[1]:Mr[0],localGlyph:!1},Lr=Qt?-Rt.height*Dt:Zt*Gi-17-Mr[1]*Dt,Nr=Rt.advance;const On=(fn?Mr[0]:Mr[1])*Dt-Gi*Zt;On>0&&On>Sr&&(Sr=On)}else{const Vn=Le[_e.fontStack];if(!Vn)continue;Vn[lt]&&(Vt=Vn[lt]);const Mr=De[_e.fontStack];if(!Mr)continue;const On=Mr.glyphs[lt];if(!On)continue;if(Rt=On.metrics,Nr=lt!==8203?Gi:0,Qt){const gn=Mr.ascender!==void 0?Math.abs(Mr.ascender):0,en=Mr.descender!==void 0?Math.abs(Mr.descender):0,Rn=(gn+en)*Dt;$t<Rn&&($t=Rn,wr=(gn-en)/2*Dt),Lr=-gn*Dt}else Lr=(Zt-Dt)*Gi-17}fn?(Oe.verticalizable=!0,kr.push({glyph:lt,image:ir,x:Ke,y:Ge+Lr,vertical:fn,scale:Dt,localGlyph:Rt.localGlyph,fontStack:_e.fontStack,sectionIndex:Xe,metrics:Rt,rect:Vt}),Ke+=Nr*Dt+bt):(kr.push({glyph:lt,image:ir,x:Ke,y:Ge+Lr,vertical:fn,scale:Dt,localGlyph:Rt.localGlyph,fontStack:_e.fontStack,sectionIndex:Xe,metrics:Rt,rect:Vt}),Ke+=Rt.advance*Dt+bt)}kr.length!==0&&(St=Math.max(Ke-bt,St),Qt?iD(kr,vt,Sr,wr,ut*Zt/2):iD(kr,vt,Sr,0,ut/2)),Ke=0;const Wr=ut*Zt+Sr;xr.lineOffset=Math.max(Sr,cr),Ge+=Wr,++zt}var Gt;const Ct=Ge,{horizontalAlign:Yt,verticalAlign:_r}=aS(_t);(function(kt,Zt,cr,xr,kr,Sr){const $t=(Zt-cr)*kr,wr=-Sr*xr;for(const Wr of kt)for(const ge of Wr.positionedGlyphs)ge.x+=$t,ge.y+=wr})(Oe.positionedLines,vt,Yt,_r,St,Ct),Oe.top+=-_r*Ct,Oe.bottom=Oe.top+Ct,Oe.left+=-Yt*St,Oe.right=Oe.left+St,Oe.hasBaseline=Qt})(Ee,r,o,u,ee,g,b,S,D,E,N,U),!(function(Oe){for(const De of Oe)if(De.positionedGlyphs.length!==0)return!1;return!0})(Ae))return Ee}const fx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},o9={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eD(s,r,o,u,h,m){if(r.image){const g=u.get(r.image.toString());return g?g.displaySize[0]*r.scale*Gi/m+h:0}{const g=o[r.fontStack],b=g&&g.glyphs[s];return b?b.metrics.advance*r.scale+h:0}}function tD(s,r,o,u){const h=Math.pow(s-r,2);return u?s<r?h/2:2*h:h+Math.abs(o)*o}function a9(s,r,o){let u=0;return s===10&&(u-=1e4),o&&(u+=150),s!==40&&s!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function rD(s,r,o,u,h,m){let g=null,b=tD(r,o,h,m);for(const S of u){const E=tD(r-S.x,o,h,m)+S.badness;E<=b&&(g=S,b=E)}return{index:s,x:r,priorBreak:g,badness:b}}function nD(s){return s?nD(s.priorBreak).concat(s.index):[]}function aS(s){let r=.5,o=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function iD(s,r,o,u,h){if(!(r||o||u||h))return;const m=s.length-1,g=s[m],b=(g.x+g.metrics.advance*g.scale)*r;for(let S=0;S<=m;S++)s[S].x-=b,s[S].y+=o+u+h}function oD(s){return s.imagePrimary!==void 0&&s.top!==void 0&&s.bottom!==void 0&&s.left!==void 0&&s.right!==void 0}function s9(s,r,o,u){const{horizontalAlign:h,verticalAlign:m}=aS(u),g=o[0]-s.displaySize[0]*h,b=o[1]-s.displaySize[1]*m;return{imagePrimary:s,imageSecondary:r,top:b,bottom:b+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function aD(s,r,o,u,h,m){const g=s.imagePrimary;let b;if(g.content){const Q=g.content,ee=g.pixelRatio||1;b=[Q[0]/ee,Q[1]/ee,g.displaySize[0]-Q[2]/ee,g.displaySize[1]-Q[3]/ee]}const S=r.left*m,E=r.right*m;let O,D,N,B;o==="width"||o==="both"?(B=h[0]+S-u[3],D=h[0]+E+u[1]):(B=h[0]+(S+E-g.displaySize[0])/2,D=B+g.displaySize[0]);const U=r.top*m,X=r.bottom*m;return o==="height"||o==="both"?(O=h[1]+U-u[0],N=h[1]+X+u[2]):(O=h[1]+(U+X-g.displaySize[1])/2,N=O+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:O,right:D,bottom:N,left:B,collisionPadding:b}}function sD(s){return!s.imagePrimary.stretchX}function lD(s){return!s.imagePrimary.stretchY}function cD(s){return{width:s.right-s.left,height:s.bottom-s.top}}const xl=128;function uD(s,r,o){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Cn(s+1,{worldview:o}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:m}=u;let g=0;for(;g<h.length&&h[g]<=s;)g++;g=Math.max(0,g-1);let b=g;for(;b<h.length&&h[b]<s+1;)b++;b=Math.min(h.length-1,b);const S=h[g],E=h[b];return u.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:S,maxZoom:E,minSize:u.evaluate(new Cn(S,{worldview:o})),maxSize:u.evaluate(new Cn(E,{worldview:o})),interpolationType:m}}}function sS(s,{uSize:r,uSizeT:o},{lowerSize:u,upperSize:h}){return s.kind==="source"?u/xl:s.kind==="composite"?lr(u/xl,h/xl,o):r}function Hg(s,r,o=1){let u=0,h=0;if(s.kind==="constant")h=s.layoutSize*o;else if(s.kind!=="source"){const{interpolationType:m,minZoom:g,maxZoom:b}=s,S=m?Ie(ta.interpolationFactor(m,r,g,b),0,1):0;s.kind==="camera"?h=lr(s.minSize,s.maxSize,S)*o:u=S*o}return{uSizeT:u,uSize:h}}class dc extends wt{constructor(r,o,u,h,m){super(r,o),this.angle=h,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new dc(this.x,this.y,this.z,this.angle,this.segment)}}function hD(s,r,o,u,h){if(r.segment===void 0)return!0;let m=r,g=r.segment+1,b=0;for(;b>-o/2;){if(g--,g<0)return!1;b-=s[g].dist(m),m=s[g]}b+=s[g].dist(s[g+1]),g++;const S=[];let E=0;for(;b<o/2;){const O=s[g],D=s[g+1];if(!D)return!1;let N=s[g-1].angleTo(O)-O.angleTo(D);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:N}),E+=N;b-S[0].distance>u;)E-=S.shift().angleDelta;if(E>h)return!1;g++,b+=O.dist(D)}return!0}function dD(s){let r=0;for(let o=0;o<s.length-1;o++)r+=s[o].dist(s[o+1]);return r}function fD(s,r,o){return s?.6*r*o:0}function pD(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function l9(s,r,o,u,h,m){const g=fD(o,h,m),b=pD(o,u)*m;let S=0;const E=dD(s)/2;for(let O=0;O<s.length-1;O++){const D=s[O],N=s[O+1],B=D.dist(N);if(S+B>E){const U=(E-S)/B,X=lr(D.x,N.x,U),Q=lr(D.y,N.y,U),ee=new dc(X,Q,0,N.angleTo(D),O);return!g||hD(s,ee,b,g,r)?ee:void 0}S+=B}}function c9(s,r,o,u,h,m,g,b,S){const E=fD(u,m,g),O=pD(u,h),D=O*g,N=s[0].x===0||s[0].x===S||s[0].y===0||s[0].y===S;return r-D<r/4&&(r=D+r/4),mD(s,N?r/2*b%r:(O/2+2*m)*g*b%r,r,E,o,D,N,!1,S)}function mD(s,r,o,u,h,m,g,b,S){const E=m/2,O=dD(s);let D=0,N=r-o,B=[];for(let U=0;U<s.length-1;U++){const X=s[U],Q=s[U+1],ee=X.dist(Q),ue=Q.angleTo(X);for(;N+o<D+ee;){N+=o;const he=(N-D)/ee,pe=lr(X.x,Q.x,he),Ae=lr(X.y,Q.y,he);if(pe>=0&&pe<S&&Ae>=0&&Ae<S&&N-E>=0&&N+E<=O){const Ee=new dc(pe,Ae,0,ue,U);u&&!hD(s,Ee,m,u,h)||B.push(Ee)}}D+=ee}return b||B.length||g||(B=mD(s,D/2,o,u,h,m,g,!0,S)),B}function gD(s){let r=0,o=0;for(const g of s)r+=g.w*g.h,o=Math.max(o,g.w);s.sort(((g,b)=>b.h-g.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let h=0,m=0;for(const g of s)for(let b=u.length-1;b>=0;b--){const S=u[b];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,m=Math.max(m,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===S.w&&g.h===S.h){const E=u.pop();E&&b<u.length&&(u[b]=E)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(u.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:h,h:m,fill:r/(h*m)||0}}Ut(dc,"Anchor");const Vh=1;class Wg{static getImagePositionScale(r,o,u){if(o&&r&&r.options&&r.options.transform){const h=r.options.transform;return{x:h.a,y:h.d}}return{x:u,y:u}}constructor(r,o,u,h){this.paddedRect=r;const{pixelRatio:m,version:g,stretchX:b,stretchY:S,content:E,sdf:O,usvg:D}=o;this.pixelRatio=m,this.stretchX=b,this.stretchY=S,this.content=E,this.version=g,this.padding=u,this.sdf=O,this.usvg=D,this.scale=Wg.getImagePositionScale(h,D,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function lS(s,r,o){const u=Ta.parse(s),h=(function(m,g,b=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*b[0])+2*g,h:(m.data?m.data.height:m.height*b[1])+2*g}})(r,o,[u.options.transform.a,u.options.transform.d]);return{bin:h,imagePosition:new Wg(h,r,o,u),imageVariant:u}}class _D{constructor(r,o,u){const h=new Map,m=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(r,h,Vh,g),this.addImages(o,m,2,g);const{w:b,h:S}=gD(g),E=new eo({width:b||1,height:S||1});for(const[O,D]of r.entries()){const N=h.get(O).paddedRect;eo.copy(D.data,E,{x:0,y:0},{x:N.x+Vh,y:N.y+Vh},D.data,null,D.sdf)}for(const[O,D]of o.entries()){const N=m.get(O),B=N.paddedRect;let U=N.padding;const X=B.x+U,Q=B.y+U,ee=D.data.width,ue=D.data.height;U=U>1?U-1:U,eo.copy(D.data,E,{x:0,y:0},{x:X,y:Q},D.data,u),eo.copy(D.data,E,{x:0,y:ue-U},{x:X,y:Q-U},{width:ee,height:U},u),eo.copy(D.data,E,{x:0,y:0},{x:X,y:Q+ue},{width:ee,height:U},u),eo.copy(D.data,E,{x:ee-U,y:0},{x:X-U,y:Q},{width:U,height:ue},u),eo.copy(D.data,E,{x:0,y:0},{x:X+ee,y:Q},{width:U,height:ue},u),eo.copy(D.data,E,{x:ee-U,y:ue-U},{x:X-U,y:Q-U},{width:U,height:U},u),eo.copy(D.data,E,{x:0,y:ue-U},{x:X+ee,y:Q-U},{width:U,height:U},u),eo.copy(D.data,E,{x:0,y:0},{x:X+ee,y:Q+ue},{width:U,height:U},u),eo.copy(D.data,E,{x:ee-U,y:0},{x:X-U,y:Q+ue},{width:U,height:U},u)}this.lut=u,this.image=E,this.iconPositions=h,this.patternPositions=m}addImages(r,o,u,h){for(const[m,g]of r.entries()){const{bin:b,imagePosition:S,imageVariant:E}=lS(m,g,u);o.set(m,S),h.push(b),g.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(r,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>r.hasImage(h,u))),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of r.getUpdatedImages(u)){for(const m of this.iconPositions.keys()){const g=Ta.parse(m);if(Jo.isEqual(g.id,h)){const b=r.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(m),b,o,null)}}for(const m of this.patternPositions.keys()){const g=Ta.parse(m);if(Jo.isEqual(g.id,h)){const b=r.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(m),b,o,this.lut)}}}}patchUpdatedImage(r,o,u,h=null){if(!r||!o||r.version===o.version)return;r.version=o.version;const[m,g]=r.tl,b=r.sdf;if(this.lut||b){const S={width:o.data.width,height:o.data.height},E=new eo(S);eo.copy(o.data,E,{x:0,y:0},{x:0,y:0},S,h,b),u.update(E,{position:{x:m,y:g}})}else u.update(o.data,{position:{x:m,y:g}})}}Ut(Wg,"ImagePosition"),Ut(_D,"ImageAtlas");const Zg=1e20;function yD(s,r,o,u,h,m,g,b,S){for(let E=r;E<r+u;E++)vD(s,o*m+E,m,h,g,b,S);for(let E=o;E<o+h;E++)vD(s,E*m+r,1,u,g,b,S)}function vD(s,r,o,u,h,m,g){m[0]=0,g[0]=-Zg,g[1]=Zg,h[0]=s[r];for(let b=1,S=0,E=0;b<u;b++){h[b]=s[r+b*o];const O=b*b;do{const D=m[S];E=(h[b]-h[D]+O-D*D)/(b-D)/2}while(E<=g[S]&&--S>-1);S++,m[S]=b,g[S]=E,g[S+1]=Zg}for(let b=0,S=0;b<u;b++){for(;g[S+1]<b;)S++;const E=m[S],O=b-E;s[r+b*o]=h[E]+O*O}}const Ms=2,cS={none:0,ideographs:1,all:2};class Zf{constructor(r,o,u){this.requestManager=r,this.localGlyphMode=o,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,o){const u=[],h=this.url||ao.GLYPHS_URL;for(const m in r)for(const g of r[m])u.push({stack:m,id:g});Qe(u,(({stack:m,id:g},b)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=S.glyphs[g];if(E!==void 0)return void b(null,{stack:m,id:g,glyph:E});if(E=this._tinySDF(S,m,g),E)return S.glyphs[g]=E,void b(null,{stack:m,id:g,glyph:E});const O=Math.floor(g/256);if(256*O>65535)return Vr("glyphs > 65535 not supported"),void b(null,{stack:m,id:g,glyph:E});if(S.ranges[O])return void b(null,{stack:m,id:g,glyph:E});let D=S.requests[O];D||(D=S.requests[O]=[],Zf.loadGlyphRange(m,O,h,this.requestManager,((N,B)=>{if(B){S.ascender=B.ascender,S.descender=B.descender;for(const U in B.glyphs)this._doesCharSupportLocalGlyph(+U)||(S.glyphs[+U]=B.glyphs[+U]);S.ranges[O]=!0}for(const U of D)U(N,B);delete S.requests[O]}))),D.push(((N,B)=>{N?b(N):B&&b(null,{stack:m,id:g,glyph:B.glyphs[g]||null})}))}),((m,g)=>{if(m)o(m);else if(g){const b={};for(const{stack:S,id:E,glyph:O}of g)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[E]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;o(null,b)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==cS.none&&(this.localGlyphMode===cS.all?!!this.localFontFamily:!!this.localFontFamily&&(sr["CJK Unified Ideographs"](r)||sr["Hangul Syllables"](r)||sr.Hiragana(r)||sr.Katakana(r)||sr["CJK Symbols and Punctuation"](r)||sr["CJK Unified Ideographs Extension A"](r)||sr["CJK Unified Ideographs Extension B"](r)||sr.Osage(r)))}_tinySDF(r,o,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let m=r.tinySDF;if(!m){let X="400";/bold/i.test(o)?X="900":/medium/i.test(o)?X="500":/light/i.test(o)&&(X="200"),m=r.tinySDF=new Zf.TinySDF({fontFamily:h,fontWeight:X,fontSize:24*Ms,buffer:3*Ms,radius:8*Ms}),m.fontWeight=X}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];const g=String.fromCodePoint(u),{data:b,width:S,height:E,glyphWidth:O,glyphHeight:D,glyphLeft:N,glyphTop:B,glyphAdvance:U}=m.draw(g);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new vu({width:S,height:E},b),metrics:{width:O/Ms,height:D/Ms,left:N/Ms,top:B/Ms-27,advance:U/Ms,localGlyph:!0}}}}Zf.loadGlyphRange=function(s,r,o,u,h){const m=256*r,g=m+255,b=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",s).replace("{range}",`${m}-${g}`),Id.Glyphs);Vc(b,((S,E)=>{if(S)h(S);else if(E){const O={},D=(function(N){return new dx(N).readFields(r9,{})})(E);for(const N of D.glyphs)O[N.id]=N;h(null,{glyphs:O,ascender:D.ascender,descender:D.descender})}}))},Zf.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:o=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:b=null}={}){this.buffer=r,this.cutoff=u,this.radius=o,this.lang=b;const S=this.size=s+4*r,E=this._createCanvas(S),O=this.ctx=E.getContext("2d",{willReadFrequently:!0});O.font=`${g} ${m} ${s}px ${h}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(s),g=Math.ceil(o),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),S=Math.min(this.size-this.buffer,g+Math.ceil(u)),E=b+2*this.buffer,O=S+2*this.buffer,D=Math.max(E*O,0),N=new Uint8ClampedArray(D),B={data:N,width:E,height:O,glyphWidth:b,glyphHeight:S,glyphTop:g,glyphLeft:0,glyphAdvance:r};if(b===0||S===0)return B;const{ctx:U,buffer:X,gridInner:Q,gridOuter:ee}=this;this.lang&&(U.lang=this.lang),U.clearRect(X,X,b,S),U.fillText(s,X,X+g);const ue=U.getImageData(X,X,b,S);ee.fill(Zg,0,D),Q.fill(0,0,D);for(let he=0;he<S;he++)for(let pe=0;pe<b;pe++){const Ae=ue.data[4*(he*b+pe)+3]/255;if(Ae===0)continue;const Ee=(he+X)*E+pe+X;if(Ae===1)ee[Ee]=0,Q[Ee]=Zg;else{const Oe=.5-Ae;ee[Ee]=Oe>0?Oe*Oe:0,Q[Ee]=Oe<0?Oe*Oe:0}}yD(ee,0,0,E,O,E,this.f,this.v,this.z),yD(Q,X,X,b,S,E,this.f,this.v,this.z);for(let he=0;he<D;he++){const pe=Math.sqrt(ee[he])-Math.sqrt(Q[he]);N[he]=Math.round(255-255*(pe/this.radius+this.cutoff))}return B}};const wu=Vh;function xD(s,r){return s+r[1]-r[0]}function bD(s,r,o,u,h=1){const m=[],g=s.imagePrimary,b=g.pixelRatio,S=g.paddedRect.w-2*wu,E=g.paddedRect.h-2*wu,O=(s.right-s.left)*h,D=(s.bottom-s.top)*h,N=g.stretchX||[[0,S]],B=g.stretchY||[[0,E]],U=N.reduce(xD,0),X=B.reduce(xD,0),Q=S-U,ee=E-X;let ue=0,he=U,pe=0,Ae=X,Ee=0,Oe=Q,De=0,Le=ee;if(g.content&&u){const Ue=g.content;ue=px(N,0,Ue[0]),pe=px(B,0,Ue[1]),he=px(N,Ue[0],Ue[2]),Ae=px(B,Ue[1],Ue[3]),Ee=Ue[0]-ue,De=Ue[1]-pe,Oe=Ue[2]-Ue[0]-he,Le=Ue[3]-Ue[1]-Ae}const ct=(Ue,ut,_t,ht)=>{const ft=mx(Ue.stretch-ue,he,O,s.left*h),bt=gx(Ue.fixed-Ee,Oe,Ue.stretch,U),st=mx(ut.stretch-pe,Ae,D,s.top*h),mt=gx(ut.fixed-De,Le,ut.stretch,X),Ke=mx(_t.stretch-ue,he,O,s.left*h),Ge=gx(_t.fixed-Ee,Oe,_t.stretch,U),St=mx(ht.stretch-pe,Ae,D,s.top*h),vt=gx(ht.fixed-De,Le,ht.stretch,X),Qt=new wt(ft,st),zt=new wt(Ke,st),Gt=new wt(Ke,St),Ct=new wt(ft,St),Yt=new wt(bt/b,mt/b),_r=new wt(Ge/b,vt/b),kt=r*Math.PI/180;if(kt){const $t=Math.sin(kt),wr=Math.cos(kt),Wr=[wr,-$t,$t,wr];Qt._matMult(Wr),zt._matMult(Wr),Ct._matMult(Wr),Gt._matMult(Wr)}const Zt=Ue.stretch+Ue.fixed,cr=_t.stretch+_t.fixed,xr=ut.stretch+ut.fixed,kr=ht.stretch+ht.fixed,Sr=s.imageSecondary;return{tl:Qt,tr:zt,bl:Ct,br:Gt,texPrimary:{x:g.paddedRect.x+wu+Zt,y:g.paddedRect.y+wu+xr,w:cr-Zt,h:kr-xr},texSecondary:Sr?{x:Sr.paddedRect.x+wu+Zt,y:Sr.paddedRect.y+wu+xr,w:cr-Zt,h:kr-xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:_r,minFontScaleX:Oe/b/O,minFontScaleY:Le/b/D,isSDF:o}};if(u&&(g.stretchX||g.stretchY)){const Ue=wD(N,Q,U),ut=wD(B,ee,X);for(let _t=0;_t<Ue.length-1;_t++){const ht=Ue[_t],ft=Ue[_t+1];for(let bt=0;bt<ut.length-1;bt++)m.push(ct(ht,ut[bt],ft,ut[bt+1]))}}else m.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return m}function px(s,r,o){let u=0;for(const h of s)u+=Math.max(r,Math.min(o,h[1]))-Math.max(r,Math.min(o,h[0]));return u}function wD(s,r,o){const u=[{fixed:-wu,stretch:0}];for(const[h,m]of s){const g=u[u.length-1];u.push({fixed:h-g.stretch,stretch:g.stretch}),u.push({fixed:h-g.stretch,stretch:g.stretch+(m-h)})}return u.push({fixed:r+wu,stretch:o}),u}function mx(s,r,o,u){return s/r*o+u}function gx(s,r,o,u){return s-r*o/u}function u9(s,r,o,u){const h=r+s.positionedLines[u].lineOffset;return u===0?o+h/2:o+(h+(r+s.positionedLines[u-1].lineOffset))/2}function h9(s,r=1,o=!1){let u=1/0,h=1/0,m=-1/0,g=-1/0;const b=s[0];for(let B=0;B<b.length;B++){const U=b[B];(!B||U.x<u)&&(u=U.x),(!B||U.y<h)&&(h=U.y),(!B||U.x>m)&&(m=U.x),(!B||U.y>g)&&(g=U.y)}const S=Math.min(m-u,g-h);let E=S/2;const O=new Hd([],d9);if(S===0)return new wt(u,h);for(let B=u;B<m;B+=S)for(let U=h;U<g;U+=S)O.push(new Xf(B+E,U+E,E,s));let D=(function(B){let U=0,X=0,Q=0;const ee=B[0];for(let ue=0,he=ee.length,pe=he-1;ue<he;pe=ue++){const Ae=ee[ue],Ee=ee[pe],Oe=Ae.x*Ee.y-Ee.x*Ae.y;X+=(Ae.x+Ee.x)*Oe,Q+=(Ae.y+Ee.y)*Oe,U+=3*Oe}return new Xf(X/U,Q/U,0,B)})(s),N=O.length;for(;O.length;){const B=O.pop();(B.d>D.d||!D.d)&&(D=B,o&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,N)),B.max-D.d<=r||(E=B.h/2,O.push(new Xf(B.p.x-E,B.p.y-E,E,s)),O.push(new Xf(B.p.x+E,B.p.y-E,E,s)),O.push(new Xf(B.p.x-E,B.p.y+E,E,s)),O.push(new Xf(B.p.x+E,B.p.y+E,E,s)),N+=4)}return o&&(console.log(`num probes: ${N}`),console.log(`best distance: ${D.d}`)),D.p}function d9(s,r){return r.max-s.max}class Xf{constructor(r,o,u,h){this.p=new wt(r,o),this.h=u,this.d=(function(m,g){let b=!1,S=1/0;for(let E=0;E<g.length;E++){const O=g[E];for(let D=0,N=O.length,B=N-1;D<N;B=D++){const U=O[D],X=O[B];U.y>m.y!=X.y>m.y&&m.x<(X.x-U.x)*(m.y-U.y)/(X.y-U.y)+U.x&&(b=!b),S=Math.min(S,qn(m,U,X))}}return(b?1:-1)*Math.sqrt(S)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const f9=Object.keys,uS=Number.POSITIVE_INFINITY,p9=Math.sqrt(2);function SD(s,[r,o]){let u=0,h=0;if(o===uS){r<0&&(r=0);const m=r/p9;switch(s){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-r;break;case"top":h=r-7}switch(s){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),o=Math.abs(o),s){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(s){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,h]}function _x(s,r,o,u,h,m,g,b,S){if(!r||!r.usvg)return;const E=cD(u),O=cD(h),D=m!=="both"&&m!=="width"||!sD(u)?1:O.width/E.width,N=m!=="both"&&m!=="height"||!lD(u)?1:O.height/E.height;o.scaleSelf(D,N);const B=o.toString();g.set(B,o),b.set(B,r);const{imagePosition:U}=lS(B,r,Vh);S.set(B,U)}function TD(s,r,o,u,h,m,g,b,S){if(!s)return;const E=(function(O,D,N,B,U,X){if(O.kind==="camera")return O.maxSize;if(O.kind==="composite"){const Q=D.possiblyEvaluate(new Cn(O.maxZoom,{worldview:X}),N).evaluate(U,{},N),ee=D.possiblyEvaluate(new Cn(O.minZoom,{worldview:X}),N).evaluate(U,{},N);return Math.max(Q,ee)}return D.possiblyEvaluate(new Cn(B,{worldview:X})).evaluate(U,{},N)})(r,o,u,h,m,S);return s.scaleSelf(E*b*g)}function AD(s,r,o,u,h,m,g,b,S){return{iconPrimary:TD(s.getPrimary(),r,o,u,h,m,g,b,S),iconSecondary:TD(s.getSecondary(),r,o,u,h,m,g,b,S)}}function m9(s,r,o){if(!r)return;const u=o.get(s.toString()),h=o.get(r.toString());u&&h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||Vr(`Mismatch in icon variant sizes: ${s.toString()} and ${r.toString()}`),u.usvg!==h.usvg&&Vr(`Mismatch in icon variant image types: ${s.id} and ${r.id}`))}function ED(s,r,o,u){if(!s)return;const h=r.get(o.toString());if(s.imagePrimary=h,u){const m=r.get(u.toString());s.imageSecondary=m}}function g9(s,r){for(const o in s.horizontal)PD(s.horizontal[o],r);PD(s.vertical,r)}function PD(s,r){if(s){for(const o of s.positionedLines)for(const u of o.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=r.get(h).paddedRect}}}function hS(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _9(s,r,o,u,h,m,g,b,S){const E=dS(m.horizontal)||m.vertical,O=o.get("icon-text-fit-padding").evaluate(u,{},h);let D,N=r;return r&&S!=="none"&&(s.allowVerticalPlacement&&m.vertical&&(D=aD(r,m.vertical,S,O,b,g)),E&&(N=aD(r,E,S,O,b,g))),{defaultShapedIcon:N,verticallyShapedIcon:D}}function y9(s,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee,ue,he){let pe=g.textMaxSize.evaluate(r,{},N);pe===void 0?pe=b*g.textScaleFactor:pe*=g.textScaleFactor;const Ae=s.layers[0].layout,Ee=dS(o.horizontal)||o.vertical,Oe=B.name==="globe",De=Gi,Le=s.tilePixelRatio*pe/De,ct=(bt=s.overscaling,s.zoom>18&&bt>2&&(bt>>=1),Math.max(Mt/(512*bt),1)*Ae.get("symbol-spacing")),Ue=Ae.get("text-padding")*s.tilePixelRatio,ut=Ae.get("icon-padding")*s.tilePixelRatio,_t=Fe(Ae.get("text-max-angle")),ht=Ae.get("icon-rotation-alignment")==="map"&&he!=="point",ft=ct/2;var bt;s.hasAnyIconTextFit===!1&&Q!=="none"&&(s.hasAnyIconTextFit=!0);const st=r.properties?+r.properties[Cr]:null,mt=st&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get(st):65535,Ke=(Ge,St,vt)=>{if(St.x<0||St.x>=Mt||St.y<0||St.y>=Mt)return;let Qt=null;if(Oe){const{x:zt,y:Gt,z:Ct}=B.projectTilePoint(St.x,St.y,vt);Qt={anchor:new dc(zt,Gt,Ct,0,void 0),up:B.upVector(vt,St.x,St.y)}}(function(zt,Gt,Ct,Yt,_r,kt,Zt,cr,xr,kr,Sr,$t,wr,Wr,ge,_e,Xe,lt,Dt,Rt,Vt,ir,Nr,Lr,Rr,fn,Vn,Mr,On){const gn=zt.addToLineVertexArray(Gt,Yt);let en,Rn,Dn,Pn,Mn,_n,jr,vn=0,Wn=0,dr=0,Kr=0,kn=-1,Yn=-1;const Fn={};let Ti=Rd("");const wn=Ct?Ct.anchor:Gt,_i=Mr!=="none";let Uo=0,to=0;if(xr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ai=xr.layout.get("text-offset").evaluate(Vt,{},Rr);Uo=Ai[0]*Gi,to=Ai[1]*Gi}else Uo=xr.layout.get("text-radial-offset").evaluate(Vt,{},Rr)*Gi,to=uS;if(zt.allowVerticalPlacement&&_r.vertical){const Ai=_r.vertical;if(ge)_n=fS(Ai),cr&&(jr=fS(cr));else{const Fi=xr.layout.get("text-rotate").evaluate(Vt,{},Rr)+90;Dn=yx(kr,wn,Gt,Sr,$t,wr,Ai,Wr,Fi,_e),cr&&(Pn=yx(kr,wn,Gt,Sr,$t,wr,cr,lt,Fi))}}if(kt){const Ai=zt.iconSizeData,Fi=xr.layout.get("icon-rotate").evaluate(Vt,{},Rr),ro=bD(kt,Fi,Nr,_i,ir.iconScaleFactor),Ao=cr?bD(cr,Fi,Nr,_i,ir.iconScaleFactor):void 0;Rn=yx(kr,wn,Gt,Sr,$t,wr,kt,lt,Fi,null),vn=4*ro.length;let co=null;Ai.kind==="source"?(co=[xl*xr.layout.get("icon-size").evaluate(Vt,{},Rr)*ir.iconScaleFactor],co[0]>Su&&Vr(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Xg}. Reduce your "icon-size".`)):Ai.kind==="composite"&&(co=[xl*ir.compositeIconSizes[0].evaluate(Vt,{},Rr)*ir.iconScaleFactor,xl*ir.compositeIconSizes[1].evaluate(Vt,{},Rr)*ir.iconScaleFactor],(co[0]>Su||co[1]>Su)&&Vr(`${zt.layerIds[0]}: Value for "icon-size" is >= ${Xg}. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,ro,co,Rt,Dt,Vt,void 0,Ct,Gt,gn.lineStartIndex,gn.lineLength,-1,Lr,Rr,fn,Vn),kn=zt.icon.placedSymbolArray.length-1,Ao&&(Wn=4*Ao.length,zt.addSymbols(zt.icon,Ao,co,Rt,Dt,Vt,aa.vertical,Ct,Gt,gn.lineStartIndex,gn.lineLength,-1,Lr,Rr,fn,Vn),Yn=zt.icon.placedSymbolArray.length-1)}for(const Ai in _r.horizontal){const Fi=Ai,ro=_r.horizontal[Fi];en||(Ti=Rd(ro.text),ge?Mn=fS(ro):en=yx(kr,wn,Gt,Sr,$t,wr,ro,Wr,xr.layout.get("text-rotate").evaluate(Vt,{},Rr),_e));const Ao=ro.positionedLines.length===1;if(dr+=ID(zt,Ct,Gt,ro,Zt,xr,ge,Vt,_e,gn,_r.vertical?aa.horizontal:aa.horizontalOnly,Ao?f9(_r.horizontal):[Fi],Fn,kn,ir,Lr,Rr,fn),Ao)break}_r.vertical&&(Kr+=ID(zt,Ct,Gt,_r.vertical,Zt,xr,ge,Vt,_e,gn,aa.vertical,["vertical"],Fn,Yn,ir,Lr,Rr,fn));let Yi=-1;const Vo=(Ai,Fi)=>Ai?Math.max(Ai,Fi):Fi;Yi=Vo(Mn,Yi),Yi=Vo(_n,Yi),Yi=Vo(jr,Yi);const bl=Yi>-1?1:0;zt.glyphOffsetArray.length>=65535&&Vr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vt.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,Vt.sortKey),zt.symbolInstances.emplaceBack(Gt.x,Gt.y,wn.x,wn.y,wn.z,Fn.right>=0?Fn.right:-1,Fn.center>=0?Fn.center:-1,Fn.left>=0?Fn.left:-1,Fn.vertical>=0?Fn.vertical:-1,kn,Yn,Ti,en!==void 0?en:zt.collisionBoxArray.length,en!==void 0?en+1:zt.collisionBoxArray.length,Dn!==void 0?Dn:zt.collisionBoxArray.length,Dn!==void 0?Dn+1:zt.collisionBoxArray.length,Rn!==void 0?Rn:zt.collisionBoxArray.length,Rn!==void 0?Rn+1:zt.collisionBoxArray.length,Pn||zt.collisionBoxArray.length,Pn?Pn+1:zt.collisionBoxArray.length,Sr,dr,Kr,vn,Wn,bl,0,Uo,to,Yi,0,_i?1:0,On)})(s,St,Qt,Ge,o,u,m,h,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,Ue,ue,E,0,ut,ht,ee,r,g,O,D,N,U,X,Q,mt)};if(he==="line")for(const Ge of ix(r.geometry,0,0,Mt,Mt)){const St=c9(Ge,ct,_t,o.vertical||Ee,u,De,Le,s.overscaling,Mt);for(const vt of St)Ee&&v9(s,Ee.text,ft,vt)||Ke(Ge,vt,N)}else if(he==="line-center"){for(const Ge of r.geometry)if(Ge.length>1){const St=l9(Ge,_t,o.vertical||Ee,u,De,Le);St&&Ke(Ge,St,N)}}else if(r.type==="Polygon")for(const Ge of Mg(r.geometry,0)){const St=h9(Ge,16);Ke(Ge[0],new dc(St.x,St.y,0,0,void 0),N)}else if(r.type==="LineString")for(const Ge of r.geometry)Ke(Ge,new dc(Ge[0].x,Ge[0].y,0,0,void 0),N);else if(r.type==="Point")for(const Ge of r.geometry)for(const St of Ge)Ke([St],new dc(St.x,St.y,0,0,void 0),N)}const Xg=255,Su=Xg*xl;function ID(s,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q,ee){const ue=(function(Ae,Ee,Oe,De,Le,ct,Ue,ut){const _t=[];if(Ee.positionedLines.length===0)return _t;const ht=De.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,ft=(function(Ge){const St=Ge[0],vt=Ge[1],Qt=St*vt;return Qt>0?[St,-vt]:Qt<0?[-St,vt]:St===0?[vt,St]:[vt,-St]})(Oe);let bt=Math.abs(Ee.top-Ee.bottom);for(const Ge of Ee.positionedLines)bt-=Ge.lineOffset;const st=Ee.positionedLines.length,mt=bt/st;let Ke=Ee.top-Oe[1];for(let Ge=0;Ge<st;++Ge){const St=Ee.positionedLines[Ge];Ke=u9(Ee,mt,Ke,Ge);for(const vt of St.positionedGlyphs){if(!vt.rect)continue;const Qt=vt.rect||{};let zt=QR+1,Gt=!0,Ct=1,Yt=0;if(vt.image){const Vt=Ue.get(vt.image.toString());if(!Vt)continue;if(Vt.sdf){Vr("SDF images are not supported in formatted text and will be ignored.");continue}Gt=!1,Ct=Vt.pixelRatio,zt=Vh/Ct}const _r=(Le||ut)&&vt.vertical,kt=vt.metrics.advance*vt.scale/2,Zt=vt.metrics,cr=vt.rect;if(cr===null)continue;ut&&Ee.verticalizable&&(Yt=vt.image?kt-vt.metrics.width*vt.scale/2:0);const xr=Le?[vt.x+kt,vt.y]:[0,0];let kr=[0,0],Sr=[0,0],$t=!1;Le||(_r?(Sr=[vt.x+kt+ft[0],vt.y+ft[1]-Yt],$t=!0):kr=[vt.x+kt+Oe[0],vt.y+Oe[1]-Yt]);const wr=cr.w*vt.scale/(Ct*(vt.localGlyph?Ms:1)),Wr=cr.h*vt.scale/(Ct*(vt.localGlyph?Ms:1));let ge,_e,Xe,lt;if(_r){const Vt=vt.y-Ke,ir=new wt(-kt,kt-Vt),Nr=-Math.PI/2,Lr=new wt(...Sr);ge=new wt(-kt+kr[0],kr[1]),ge._rotateAround(Nr,ir)._add(Lr),ge.x+=-Vt+kt,ge.y-=(Zt.left-zt)*vt.scale;const Rr=vt.image?Zt.advance*vt.scale:Gi*vt.scale,fn=String.fromCodePoint(vt.glyph);GW(fn)?ge.x+=(1-zt)*vt.scale:HW(fn)?ge.x+=Rr-Zt.height*vt.scale+(-zt-1)*vt.scale:ge.x+=vt.image||Zt.width+2*zt===cr.w&&Zt.height+2*zt===cr.h?(Rr-Wr)/2:(Rr-(Zt.height+2*zt)*vt.scale)/2,_e=new wt(ge.x,ge.y-wr),Xe=new wt(ge.x+Wr,ge.y),lt=new wt(ge.x+Wr,ge.y-wr)}else{const Vt=(Zt.left-zt)*vt.scale-kt+kr[0],ir=(-Zt.top-zt)*vt.scale+kr[1],Nr=Vt+wr,Lr=ir+Wr;ge=new wt(Vt,ir),_e=new wt(Nr,ir),Xe=new wt(Vt,Lr),lt=new wt(Nr,Lr)}if(ht){let Vt;Vt=Le?new wt(0,0):$t?new wt(ft[0],ft[1]):new wt(Oe[0],Oe[1]),ge._rotateAround(ht,Vt),_e._rotateAround(ht,Vt),Xe._rotateAround(ht,Vt),lt._rotateAround(ht,Vt)}const Dt=new wt(0,0),Rt=new wt(0,0);_t.push({tl:ge,tr:_e,bl:Xe,br:lt,texPrimary:Qt,texSecondary:void 0,writingMode:Ee.writingMode,glyphOffset:xr,sectionIndex:vt.sectionIndex,isSDF:Gt,pixelOffsetTL:Dt,pixelOffsetBR:Rt,minFontScaleX:0,minFontScaleY:0})}}return _t})(0,u,S,m,g,b,h,s.allowVerticalPlacement),he=s.textSizeData;let pe=null;he.kind==="source"?(pe=[xl*m.layout.get("text-size").evaluate(b,{},Q)*U.textScaleFactor],pe[0]>Su&&Vr(`${s.layerIds[0]}: Value for "text-size" is >= ${Xg}. Reduce your "text-size".`)):he.kind==="composite"&&(pe=[xl*U.compositeTextSizes[0].evaluate(b,{},Q)*U.textScaleFactor,xl*U.compositeTextSizes[1].evaluate(b,{},Q)*U.textScaleFactor],(pe[0]>Su||pe[1]>Su)&&Vr(`${s.layerIds[0]}: Value for "text-size" is >= ${Xg}. Reduce your "text-size".`)),s.addSymbols(s.text,ue,pe,S,g,b,O,r,o,E.lineStartIndex,E.lineLength,B,X,Q,ee,!1);for(const Ae of D)N[Ae]=s.text.placedSymbolArray.length-1;return 4*ue.length}function dS(s){for(const r in s)return s[r];return null}function yx(s,r,o,u,h,m,g,b,S,E){let O=g.top,D=g.bottom,N=g.left,B=g.right;if(oD(g)&&g.collisionPadding){const U=g.collisionPadding;N-=U[0],O-=U[1],B+=U[2],D+=U[3]}if(S){const U=new wt(N,O),X=new wt(B,O),Q=new wt(N,D),ee=new wt(B,D),ue=Fe(S);let he=new wt(0,0);E&&(he=new wt(E[0],E[1])),U._rotateAround(ue,he),X._rotateAround(ue,he),Q._rotateAround(ue,he),ee._rotateAround(ue,he),N=Math.min(U.x,X.x,Q.x,ee.x),B=Math.max(U.x,X.x,Q.x,ee.x),O=Math.min(U.y,X.y,Q.y,ee.y),D=Math.max(U.y,X.y,Q.y,ee.y)}return s.emplaceBack(r.x,r.y,r.z,o.x,o.y,N,O,B,D,b,u,h,m),s.length-1}function fS(s){oD(s)&&s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function v9(s,r,o,u){const h=s.compareText;if(r in h){const m=h[r];for(let g=m.length-1;g>=0;g--)if(u.dist(m[g])<o)return!0}else h[r]=[];return h[r].push(u),!1}function CD(s,r){const o=s.fovAboveCenter,u=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,h=(s._camera.position[2]*s.worldSize-u)/Math.cos(s._pitch),m=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-s._pitch-o,.01));let g=Math.sin(s._pitch)*m+h;const b=h*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let S=Math.max(s.zoom-17,0);s.isOrthographic&&(S/=10),g*=1+S}return Math.min(1.01*g,b)}function Kg(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const o=Math.pow(2,-s.z),u=s.x*o,h=(s.x+1)*o,m=s.y*o,g=(s.y+1)*o,b=Se(u),S=Se(h),E=be(m),O=be(g),D=r.project(b,E),N=r.project(S,E),B=r.project(S,O),U=r.project(b,O);let X=Math.min(D.x,N.x,B.x,U.x),Q=Math.min(D.y,N.y,B.y,U.y),ee=Math.max(D.x,N.x,B.x,U.x),ue=Math.max(D.y,N.y,B.y,U.y);const he=o/16;function pe(Ee,Oe,De,Le,ct,Ue){const ut=(De+ct)/2,_t=(Le+Ue)/2,ht=r.project(Se(ut),be(_t)),ft=Math.max(0,X-ht.x,Q-ht.y,ht.x-ee,ht.y-ue);X=Math.min(X,ht.x),ee=Math.max(ee,ht.x),Q=Math.min(Q,ht.y),ue=Math.max(ue,ht.y),ft>he&&(pe(Ee,ht,De,Le,ut,_t),pe(ht,Oe,ut,_t,ct,Ue))}pe(D,N,u,m,h,m),pe(N,B,h,m,h,g),pe(B,U,h,g,u,g),pe(U,D,u,g,u,m),X-=he,Q-=he,ee+=he,ue+=he;const Ae=1/Math.max(ee-X,ue-Q);return{scale:Ae,x:X*Ae,y:Q*Ae,x2:ee*Ae,y2:ue*Ae,projection:r}}function OD(s,{x:r,y:o},u=0){return new wt(((r-u)*s.scale-s.x)*Mt,(o*s.scale-s.y)*Mt)}const x9=j(new Float32Array(16));class Tu{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,o){return{x:0,y:0,z:0}}unproject(r,o){return new Z(0,0)}projectTilePoint(r,o,u){return{x:r,y:o,z:0}}locationPoint(r,o,u,h=!0){return r._coordinatePoint(r.locationCoordinate(o,u),h)}pixelsPerMeter(r,o){return xe(1,r)*o}pixelSpaceConversion(r,o,u){return 1}farthestPixelDistance(r){return CD(r,r.pixelsPerMeter)}pointCoordinate(r,o,u,h){const m=r.horizonLineFromTop(!1),g=new wt(o,Math.max(m,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(g,h))}pointCoordinate3D(r,o,u){const h=new wt(o,u);if(r.elevation)return r.elevation.pointCoordinate(h);{const m=this.pointCoordinate(r,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(r,o){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,o.x,o.y);const u=r.horizonLineFromTop();return o.y<u}createInversionMatrix(r,o){return x9}createTileMatrix(r,o,u){let h,m,g;const b=u.canonical,S=j(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Kg(b,this);h=1,m=E.x+u.wrap*E.scale,g=E.y,re(S,S,[h/E.scale,h/E.scale,r.pixelsPerMeter/o])}else h=o/r.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*u.wrap)*h,g=b.y*h;return K(S,S,[m,g,0]),re(S,S,[h/Mt,h/Mt,1]),S}upVector(r,o,u){return[0,0,1]}upVectorScale(r,o,u){return{metersToTile:1}}}class b9 extends Tu{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[o,u]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(Fe(o));this.n=(h+Math.sin(Fe(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,o){const{n:u,c:h,r0:m}=this,g=Fe(r-this.center[0]),b=Fe(o),S=Math.sqrt(h-2*u*Math.sin(b))/u;return{x:S*Math.sin(g*u),y:S*Math.cos(g*u)-m,z:0}}unproject(r,o){const{n:u,c:h,r0:m}=this,g=m+o;let b=Math.atan2(r,Math.abs(g))*Math.sign(g);g*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(g));const S=Fe(this.center[0])*u;b=ze(b,-Math.PI-S,Math.PI-S);const E=Ie(ne(b/u)+this.center[0],-180,180),O=Math.asin(Ie((h-(r*r+g*g)*u*u)/(2*u),-1,1)),D=Ie(ne(O),-Te,Te);return new Z(E,D)}}const Yg=1.340264,Jg=-.081106,Qg=893e-6,e_=.003796,vx=Math.sqrt(3)/2;class w9 extends Tu{project(r,o){o=o/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(vx*Math.sin(o)),h=u*u,m=h*h*h;return{x:.5*(r*Math.cos(u)/(vx*(Yg+3*Jg*h+m*(7*Qg+9*e_*h)))/Math.PI+.5),y:1-.5*(u*(Yg+Jg*h+m*(Qg+e_*h))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=u*u,m=h*h*h;for(let O,D,N,B=0;B<12&&(D=u*(Yg+Jg*h+m*(Qg+e_*h))-o,N=Yg+3*Jg*h+m*(7*Qg+9*e_*h),O=D/N,u=Ie(u-O,-Math.PI/3,Math.PI/3),h=u*u,m=h*h*h,!(Math.abs(O)<1e-12));++B);const g=vx*r*(Yg+3*Jg*h+m*(7*Qg+9*e_*h))/Math.cos(u),b=Math.asin(Math.sin(u)/vx),S=Ie(180*g/Math.PI,-180,180),E=Ie(180*b/Math.PI,-Te,Te);return new Z(S,E)}}class S9 extends Tu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){return{x:.5+r/360,y:.5-o/360,z:0}}unproject(r,o){const u=360*(r-.5),h=Ie(360*(.5-o),-Te,Te);return new Z(u,h)}}const Kf=Math.PI/2;function xx(s){return Math.tan((Kf+s)/2)}class T9 extends Tu{constructor(r){super(r),this.center=r.center||[0,30];const[o,u]=this.parallels=r.parallels||[30,30];let h=Fe(o),m=Fe(u);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const g=Math.cos(h),b=xx(h);this.n=h===m?Math.sin(h):Math.log(g/Math.cos(m))/Math.log(xx(m)/b),this.f=g*Math.pow(xx(h),this.n)/this.n}project(r,o){o=Fe(o),this.southernCenter&&(o=-o),r=Fe(r-this.center[0]);const u=1e-6,{n:h,f:m}=this;m>0?o<-Kf+u&&(o=-Kf+u):o>Kf-u&&(o=Kf-u);const g=m/Math.pow(xx(o),h);let b=g*Math.sin(h*r),S=m-g*Math.cos(h*r);return b=.5*(b/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:b,y:this.southernCenter?S:1-S,z:0}}unproject(r,o){r=(2*r-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:h}=this,m=h-o,g=Math.sign(m),b=Math.sign(u)*Math.sqrt(r*r+m*m);let S=Math.atan2(r,Math.abs(m))*g;m*u<0&&(S-=Math.PI*Math.sign(r)*g);const E=Ie(ne(S/u)+this.center[0],-180,180),O=Ie(ne(2*Math.atan(Math.pow(h/b,1/u))-Kf),-Te,Te);return new Z(E,this.southernCenter?-O:O)}}class MD extends Tu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,o){return{x:me(r),y:we(o),z:0}}unproject(r,o){const u=Se(r),h=be(o);return new Z(u,h)}}const RD=Fe(Te);class A9 extends Tu{project(r,o){const u=(o=Fe(o))*o,h=u*u;return{x:.5*((r=Fe(r))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=25,m=0,g=u*u;do{g=u*u;const E=g*g;m=(u*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-o)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),u=Ie(u-m,-RD,RD)}while(Math.abs(m)>1e-6&&--h>0);g=u*u;const b=Ie(ne(r/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),S=ne(u);return new Z(b,S)}}const DD=Fe(Te);class E9 extends Tu{project(r,o){o=Fe(o),r=Fe(r);const u=Math.cos(o),h=2/Math.PI,m=Math.acos(u*Math.cos(r/2)),g=Math.sin(m)/m,b=.5*(r*h+2*u*Math.sin(r/2)/g)||0,S=.5*(o+Math.sin(o)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(r,o){let u=r=(2*r-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,m=25;const g=1e-6;let b=0,S=0;do{const E=Math.cos(h),O=Math.sin(h),D=2*O*E,N=O*O,B=E*E,U=Math.cos(u/2),X=Math.sin(u/2),Q=2*U*X,ee=X*X,ue=1-B*U*U,he=ue?1/ue:0,pe=ue?Math.acos(E*U)*Math.sqrt(1/ue):0,Ae=.5*(2*pe*E*X+2*u/Math.PI)-r,Ee=.5*(pe*O+h)-o,Oe=.5*he*(B*ee+pe*E*U*N)+1/Math.PI,De=he*(Q*D/4-pe*O*X),Le=.125*he*(D*X-pe*O*B*Q),ct=.5*he*(N*U+pe*ee*E)+.5,Ue=De*Le-ct*Oe;b=(Ee*De-Ae*ct)/Ue,S=(Ae*Le-Ee*Oe)/Ue,u=Ie(u-b,-Math.PI,Math.PI),h=Ie(h-S,-DD,DD)}while((Math.abs(b)>g||Math.abs(S)>g)&&--m>0);return new Z(ne(u),ne(h))}}class kD extends Tu{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){const{scale:u,cosPhi:h}=this;return{x:Fe(r)*h*u+.5,y:-Math.sin(Fe(o))/h*u+.5,z:0}}unproject(r,o){const{scale:u,cosPhi:h}=this,m=-(o-.5)/u,g=Ie(ne((r-.5)/u)/h,-180,180),b=Math.asin(Ie(m*h,-1,1)),S=Ie(ne(b),-Te,Te);return new Z(g,S)}}class P9 extends MD{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,o,u){const h=Ag(r,o,u);return or(h,h,Xv(yl(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(r,o,u){const h=z(o.lat,o.lng),m=Fr([],h),g=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(o),r._centerAltitude):r._centerAltitude;rr(h,h,m,xe(1,0)*Mt*g);const b=j(new Float64Array(16));return Y(b,r.pixelMatrix,r.globeMatrix),or(h,h,b),new wt(h[0],h[1])}pixelsPerMeter(r,o){return xe(1,0)*o}pixelSpaceConversion(r,o,u){const h=xe(1,r)*o,m=lr(xe(1,45)*o,h,u);return this.pixelsPerMeter(r,o)/m}createTileMatrix(r,o,u){const h=b1(yl(u.canonical));return Y(new Float64Array(16),r.globeMatrix,h)}createInversionMatrix(r,o){const{center:u}=r,h=Xv(yl(o));return J(h,h,Fe(u.lng)),se(h,h,Fe(u.lat)),re(h,h,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(r,o,u,h){return iM(r,o,u,!0)||new et(0,0)}pointCoordinate3D(r,o,u){const h=this.pointCoordinate(r,o,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(r,o){return!iM(r,o.x,o.y,!1)}farthestPixelDistance(r){const o=(function(h,m){const g=h.cameraToCenterDistance,b=h._centerAltitude*m,S=h._camera,E=h._camera.forward(),O=it([],qt([],E,-g),[0,0,b]),D=h.worldSize/(2*Math.PI),N=[0,0,-D],B=h.width/h.height,U=Math.tan(h.fovAboveCenter),X=qt([],S.up(),U),Q=qt([],S.right(),U*B),ee=Fr([],it([],it([],E,X),Q)),ue=[];let he;if(new Qr(O,ee).closestPointOnSphere(N,D,ue)){const pe=it([],ue,N),Ae=Zr([],pe,O);he=Math.cos(h.fovAboveCenter)*nt(Ae)}else{const pe=Zr([],O,N),Ae=Zr([],N,O);Fr(Ae,Ae);const Ee=nt(pe)-D;he=Math.sqrt(Ee*(Ee+2*D));const Oe=Math.acos(he/(D+Ee))-Math.acos(nr(E,Ae));he*=Math.cos(Oe)}return 1.01*he})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=yu(r.zoom);if(u>0){const h=CD(r,xe(1,r.center.lat)*r.worldSize),m=r.worldSize/(2*Math.PI),g=Math.max(r.width,r.height)/r.worldSize*Math.PI;return lr(o,h+m*(1-Math.cos(g)),Math.pow(u,10))}return o}upVector(r,o,u){return Ag(o,u,r,1)}upVectorScale(r){return{metersToTile:Hv(Zv(yl(r)))}}}function ND(s){const r=s.parallels,o=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new MD(s);case"equirectangular":return new S9(s);case"naturalEarth":return new A9(s);case"equalEarth":return new w9(s);case"winkelTripel":return new E9(s);case"albers":return o?new kD(s):new b9(s);case"lambertConformalConic":return o?new kD(s):new T9(s);case"globe":return new P9(s)}throw new Error(`Invalid projection name: ${s.name}`)}const I9=gt.types,C9=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bx(s,r,o,u,h,m,g,b,S,E,O,D,N){const B=b?Math.min(Su,Math.round(b[0])):0,U=b?Math.min(Su,Math.round(b[1])):0;s.emplaceBack(r,o,Math.round(32*u),Math.round(32*h),m,g,(B<<1)+(S?1:0),U,16*E,16*O,256*D,256*N)}function wx(s,r,o){s.emplaceBack(r,o)}function Sx(s,r,o,u,h,m,g){s.emplaceBack(r,o,u,h,m,g)}const Tx=(s,r,o,u)=>{for(let h=0;h<r;h++)s.emplaceBack(o[0],o[1],o[2],u[0],u[1],u[2])};function Ax(s,r,o,u,h){s.emplaceBack(r,o,u,h),s.emplaceBack(r,o,u,h),s.emplaceBack(r,o,u,h),s.emplaceBack(r,o,u,h)}function O9(s){for(const r of s.sections)if(l1(r.text))return!0;return!1}class pS{constructor(r){this.layoutVertexArray=new pg,this.indexArray=new Oi,this.programConfigurations=r,this.segments=new Hn,this.dynamicLayoutVertexArray=new Pa,this.opacityVertexArray=new du,this.placedSymbolArray=new kf,this.iconTransitioningVertexArray=new wi,this.globeExtVertexArray=new mg,this.zOffsetVertexArray=new fl,this.orientationVertexArray=new Ph}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,o,u,h,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,NW.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,jW.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,C9,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,BW.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,LW.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,zW.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,FW.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ut(pS,"SymbolBuffers");class mS{constructor(r,o,u){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Hn,this.collisionVertexArray=new _g,this.collisionVertexArrayExt=new Pa}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,UW.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,VW.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ut(mS,"CollisionBuffers");class Ex{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((g=>g.fqid)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=j([]),this.placementViewportMatrix=j([]);const o=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.textSizeData=uD(this.zoom,o["text-size"],this.worldview),this.iconSizeData=uD(this.zoom,o["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.lut=r.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map((g=>aa[g])),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new pS(new Ia(this.layers,{zoom:this.zoom,lut:this.lut},(r=>r.startsWith("text")||r.startsWith("symbol")))),this.icon=new pS(new Ia(this.layers,{zoom:this.zoom,lut:this.lut},(r=>r.startsWith("icon")||r.startsWith("symbol")))),this.glyphOffsetArray=new jv,this.lineVertexArray=new zv,this.symbolInstances=new Lv}calculateGlyphDependencies(r,o,u,h,m){for(const g of r){const b=g.codePointAt(0);if(b===void 0)break;if(o[b]=!0,h&&m&&b<=65535){const S=qg[g];S&&(o[S.charCodeAt(0)]=!0)}}}updateFootprints(r,o){}updateReplacement(r,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!tx(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(r,o,u,h){const m=this.layers[0],g=m.layout,b=this.projection.name==="globe",S=g.get("text-font"),E=g.get("text-field"),O=g.get("icon-image"),[D,N]=g.get("icon-size-scale-range"),B=Ie(o.scaleFactor||1,D,N),U=(E.value.kind!=="constant"||E.value.value instanceof xo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),X=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,Q=g.get("symbol-sort-key");if(this.features=[],!U&&!X)return;const ee=o.iconDependencies,ue=o.glyphDependencies,he=o.availableImages,pe=new Cn(this.zoom,{worldview:this.worldview});for(const{feature:Ae,id:Ee,index:Oe,sourceLayerIndex:De}of r){const Le=m._featureFilter.needGeometry,ct=xt(Ae,Le);if(!m._featureFilter.filter(pe,ct,u))continue;if(Le||(ct.geometry=Lt(Ae,u,h)),b&&Ae.type!==1&&u.z<=5){const ft=ct.geometry,bt=.98078528056,st=(mt,Ke)=>nr(Ag(mt.x,mt.y,u,1),Ag(Ke.x,Ke.y,u,1))<bt;for(let mt=0;mt<ft.length;mt++)ft[mt]=at(ft[mt],st)}let Ue,ut;if(U){const ft=m.getValueAndResolveTokens("text-field",ct,u,he),bt=xo.factory(ft);O9(bt)&&(this.hasRTLText=!0),(!this.hasRTLText||bf()==="unavailable"||this.hasRTLText&&Ya.isParsed())&&(Ue=qW(bt,m,ct))}if(X){const ft=m.getValueAndResolveTokens("icon-image",ct,u,he);ut=typeof ft=="string"?Ro.build(ft):ft}if(!Ue&&!ut)continue;const _t=this.sortFeaturesByKey?Q.evaluate(ct,{},u):void 0,ht={id:Ee,text:Ue,icon:ut,index:Oe,sourceLayerIndex:De,geometry:ct.geometry,properties:Ae.properties,type:I9[Ae.type],sortKey:_t};if(this.features.push(ht),ut){const ft=this.layers[0]._unevaluatedLayout._values,{iconPrimary:bt,iconSecondary:st}=AD(ut,this.iconSizeData,ft["icon-size"],u,this.zoom,ht,this.pixelRatio,B,this.worldview),mt=bt.id.toString();if(ee.has(mt)?ee.get(mt).push(bt):ee.set(mt,[bt]),st){this.hasAnySecondaryIcon=!0;const Ke=st.id.toString();ee.has(Ke)?ee.get(Ke).push(st):ee.set(Ke,[st])}}if(Ue){const ft=S.evaluate(ct,{},u).join(","),bt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(aa.vertical)>=0;for(const st of Ue.sections)if(st.image){const mt=st.image.getPrimary().scaleSelf(this.pixelRatio),Ke=mt.id.toString(),Ge=ee.get(Ke)||[];Ge.push(mt),ee.set(Ke,Ge)}else{const mt=ig(Ue.toString()),Ke=st.fontStack||ft,Ge=ue[Ke]=ue[Ke]||{};this.calculateGlyphDependencies(st.text,Ge,bt,this.allowVerticalPlacement,mt)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(Ae){const Ee={},Oe={},De=[];let Le=0;function ct(ht){De.push(Ae[ht]),Le++}function Ue(ht,ft,bt){const st=Oe[ht];return delete Oe[ht],Oe[ft]=st,De[st].geometry[0].pop(),De[st].geometry[0]=De[st].geometry[0].concat(bt[0]),st}function ut(ht,ft,bt){const st=Ee[ft];return delete Ee[ft],Ee[ht]=st,De[st].geometry[0].shift(),De[st].geometry[0]=bt[0].concat(De[st].geometry[0]),st}function _t(ht,ft,bt){const st=bt?ft[0][ft[0].length-1]:ft[0][0];return`${ht}:${st.x}:${st.y}`}for(let ht=0;ht<Ae.length;ht++){const ft=Ae[ht],bt=ft.geometry,st=ft.text?ft.text.toString():null;if(!st){ct(ht);continue}const mt=_t(st,bt),Ke=_t(st,bt,!0);if(mt in Oe&&Ke in Ee&&Oe[mt]!==Ee[Ke]){const Ge=ut(mt,Ke,bt),St=Ue(mt,Ke,De[Ge].geometry);delete Ee[mt],delete Oe[Ke],Oe[_t(st,De[St].geometry,!0)]=St,De[Ge].geometry=null}else mt in Oe?Ue(mt,Ke,bt):Ke in Ee?ut(mt,Ke,bt):(ct(ht),Ee[mt]=Le-1,Oe[Ke]=Le-1)}return De.filter((ht=>ht.geometry))})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ae of o.elevationFeatures)this.elevationFeatureIdToIndex.set(Ae.id,this.elevationFeatures.length),this.elevationFeatures.push(Ae)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ae,Ee)=>Ae.sortKey-Ee.sortKey))}update(r,o,u,h,m,g,b){this.text.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,o,m,u,h,g,b,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;const u=Ve(r),h=1/u;let m=!1,g=!1;for(let b=0;b<this.symbolInstances.length;b++){const S=this.symbolInstances.get(b),E=Je(1,0,0),O=Je(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:N,numIconVertices:B,numVerticalIconVertices:U}=S,X=D>0||N>0,Q=B>0,ee=this.elevationFeatures[S.elevationFeatureIndex];if(ee){const ue=new wt(S.tileAnchorX,S.tileAnchorY),he=.075+ee.pointElevation(ue);S.zOffset!==he&&(o=!0,S.zOffset=he);const pe=ee.computeSlopeNormal(ue,h),Ae=Lc(oo(),Je(0,0,1),pe);jt(E,E,Ae),jt(O,O,Ae),E[2]*=u,O[2]*=u,E[0]===1&&E[1]===0&&E[2]===0&&O[0]===0&&O[1]===1&&O[2]===0||(m=m||X,g=g||Q)}if(X&&(Tx(this.text.orientationVertexArray,D,E,O),Tx(this.text.orientationVertexArray,N,E,O)),Q){const{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:he}=S;ue>=0&&Tx(this.icon.orientationVertexArray,B,E,O),he>=0&&Tx(this.icon.orientationVertexArray,U,E,O)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(m,g,b)=>{u+=g,u>m.length&&m.resize(u);for(let S=-g;S<0;S++)m.emplace(S+u,b)},o=(m,g,b)=>{h+=g,h>m.length&&m.resize(h);for(let S=-g;S<0;S++)m.emplace(S+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:S,numIconVertices:E}=g,O=g.zOffset,D=E>0;if((b>0||S>0)&&(r(this.text.zOffsetVertexArray,b,O),r(this.text.zOffsetVertexArray,S,O)),D){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:B}=g;N>=0&&o(this.icon.zOffsetVertexArray,E,O),B>=0&&o(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ND(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:h,y:m}of o)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,o,u,h,m,g,b,S,E,O,D,N,B,U,X,Q){const ee=r.indexArray,ue=r.layoutVertexArray,he=r.globeExtVertexArray,pe=r.segments.prepareSegment(4*o.length,ue,ee,this.canOverlap?g.sortKey:void 0),Ae=this.glyphOffsetArray.length,Ee=pe.vertexLength,Oe=this.allowVerticalPlacement&&b===aa.vertical?Math.PI/2:0,De=g.text&&g.text.sections;for(let ct=0;ct<o.length;ct++){const{tl:Ue,tr:ut,bl:_t,br:ht,texPrimary:ft,texSecondary:bt,pixelOffsetTL:st,pixelOffsetBR:mt,minFontScaleX:Ke,minFontScaleY:Ge,glyphOffset:St,isSDF:vt,sectionIndex:Qt}=o[ct],zt=pe.vertexLength,Gt=St[1];if(bx(ue,E.x,E.y,Ue.x,Gt+Ue.y,ft.x,ft.y,u,vt,st.x,st.y,Ke,Ge),bx(ue,E.x,E.y,ut.x,Gt+ut.y,ft.x+ft.w,ft.y,u,vt,mt.x,st.y,Ke,Ge),bx(ue,E.x,E.y,_t.x,Gt+_t.y,ft.x,ft.y+ft.h,u,vt,st.x,mt.y,Ke,Ge),bx(ue,E.x,E.y,ht.x,Gt+ht.y,ft.x+ft.w,ft.y+ft.h,u,vt,mt.x,mt.y,Ke,Ge),S){const{x:Ct,y:Yt,z:_r}=S.anchor,[kt,Zt,cr]=S.up;Sx(he,Ct,Yt,_r,kt,Zt,cr),Sx(he,Ct,Yt,_r,kt,Zt,cr),Sx(he,Ct,Yt,_r,kt,Zt,cr),Sx(he,Ct,Yt,_r,kt,Zt,cr),Ax(r.dynamicLayoutVertexArray,Ct,Yt,_r,Oe)}else Ax(r.dynamicLayoutVertexArray,E.x,E.y,E.z,Oe);if(Q){const Ct=bt||ft;wx(r.iconTransitioningVertexArray,Ct.x,Ct.y),wx(r.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y),wx(r.iconTransitioningVertexArray,Ct.x,Ct.y+Ct.h),wx(r.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y+Ct.h)}ee.emplaceBack(zt,zt+1,zt+2),ee.emplaceBack(zt+1,zt+2,zt+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),ct!==o.length-1&&Qt===o[ct+1].sectionIndex||r.programConfigurations.populatePaintArrays(ue.length,g,g.index,{},B,U,X,De&&De[Qt],this.worldview)}const Le=S?S.anchor:E;r.placedSymbolArray.emplaceBack(Le.x,Le.y,Le.z,E.x,E.y,Ae,this.glyphOffsetArray.length-Ae,Ee,O,D,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],b,0,0,0,N,0)}_commitLayoutVertex(r,o,u,h,m,g,b){r.emplaceBack(o,u,h,m,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,o,u,h,m,g,b){const S=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=S.vertexLength,O=b.tileAnchorX,D=b.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,r.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,O,D,new wt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,O,D,new wt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,O,D,new wt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,m,g,O,D,new wt(r.x1,r.y2)),S.vertexLength+=4;const N=u.indexArray;N.emplaceBack(E,E+1),N.emplaceBack(E+1,E+2),N.emplaceBack(E+2,E+3),N.emplaceBack(E+3,E),S.primitiveLength+=4}_addTextDebugCollisionBoxes(r,o,u,h,m,g){for(let b=h;b<m;b++){const S=u.get(b),E=this.getSymbolInstanceTextSize(r,g,o,b);this._addCollisionDebugVertices(S,E,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(r,o,u,h,m,g){for(let b=h;b<m;b++){const S=u.get(b),E=this.getSymbolInstanceIconSize(r,o,g.placedIconSymbolIndex);this._addCollisionDebugVertices(S,E,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}generateCollisionDebugBuffers(r,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mS(Cf,XR.members,wi),this.iconCollisionBox=new mS(Cf,XR.members,wi);const h=Hg(this.iconSizeData,r),m=Hg(this.textSizeData,r,u);for(let g=0;g<this.symbolInstances.length;g++){const b=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,r,o,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(m,r,o,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,o,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,o,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(r,o,u,h){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),g=sS(this.textSizeData,r,m)/Gi;return this.tilePixelRatio*g}getSymbolInstanceIconSize(r,o,u){const h=this.icon.placedSymbolArray.get(u),m=sS(this.iconSizeData,r,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,o,u,h){r.emplaceBack(o,-u,-u,h),r.emplaceBack(o,u,-u,h),r.emplaceBack(o,u,u,h),r.emplaceBack(o,-u,u,h)}_updateTextDebugCollisionBoxes(r,o,u,h,m,g,b){for(let S=h;S<m;S++){const E=u.get(S),O=this.getSymbolInstanceTextSize(r,g,o,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,E.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(r,o,u,h,m,g,b){for(let S=h;S<m;S++){const E=u.get(S),O=this.getSymbolInstanceIconSize(r,o,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,E.padding,g.zOffset)}}updateCollisionDebugBuffers(r,o,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=Hg(this.iconSizeData,r,h),g=Hg(this.textSizeData,r,u);for(let b=0;b<this.symbolInstances.length;b++){const S=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(g,r,o,S.textBoxStartIndex,S.textBoxEndIndex,S,u),this._updateTextDebugCollisionBoxes(g,r,o,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,u),this._updateIconDebugCollisionBoxes(m,r,o,S.iconBoxStartIndex,S.iconBoxEndIndex,S,h),this._updateIconDebugCollisionBoxes(m,r,o,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,o,u,h,m,g,b,S,E){const O={};if(o<u){const{x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe,featureIndex:Ae}=r.get(o);O.textBox={x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe},O.textFeatureIndex=Ae}if(h<m){const{x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe,featureIndex:Ae}=r.get(h);O.verticalTextBox={x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe},O.verticalTextFeatureIndex=Ae}if(g<b){const{x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe,featureIndex:Ae}=r.get(g);O.iconBox={x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe},O.iconFeatureIndex=Ae}if(S<E){const{x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe,featureIndex:Ae}=r.get(S);O.verticalIconBox={x1:D,y1:N,x2:B,y2:U,padding:X,projectedAnchorX:Q,projectedAnchorY:ee,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:pe},O.verticalIconFeatureIndex=Ae}return O}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,o){const u=r.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<h;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),u=Math.cos(r),h=[],m=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const S=this.symbolInstances.get(b);h.push(0|Math.round(o*S.tileAnchorX+u*S.tileAnchorY)),m.push(S.featureIndex)}return g.sort(((b,S)=>h[b]-h[S]||m[S]-m[b])),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((r,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(r).zOffset))}addToSortKeyRanges(r,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let LD,jD,gS;Ut(Ex,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ex.addDynamicAttributes=Ax;class zD{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Za,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut(zD,"FormatSectionOverride",{omit:["defaultValue"]});const _S=()=>gS||(gS={layout:LD||(LD=new Xn({"symbol-placement":new Tt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(Be.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(Be.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(Be.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(Be.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Nt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(Be.layout_symbol["icon-image"]),"icon-image-use-theme":new Tt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Nt(Be.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Nt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(Be.layout_symbol["text-field"]),"text-font":new Nt(Be.layout_symbol["text-font"]),"text-size":new Nt(Be.layout_symbol["text-size"]),"text-size-scale-range":new Tt(Be.layout_symbol["text-size-scale-range"]),"text-max-width":new Nt(Be.layout_symbol["text-max-width"]),"text-line-height":new Nt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Nt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new Nt(Be.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(Be.layout_symbol["text-rotate"]),"text-padding":new Tt(Be.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Be.layout_symbol["text-keep-upright"]),"text-transform":new Nt(Be.layout_symbol["text-transform"]),"text-offset":new Nt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Be.layout_symbol["text-optional"]),visibility:new Tt(Be.layout_symbol.visibility)})),paint:jD||(jD=new Xn({"icon-opacity":new Nt(Be.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Nt(Be.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Nt(Be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Nt(Be.paint_symbol["text-emissive-strength"]),"icon-color":new Nt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Nt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt(Be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Nt(Be.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Nt(Be.paint_symbol["text-occlusion-opacity"]),"text-color":new Nt(Be.paint_symbol["text-color"],{runtimeType:jo,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Nt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(Be.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(Be.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(Be.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(Be.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(Be.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Nt(Be.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},gS);class Px extends lo{constructor(r,o,u,h){super(r,_S(),o,u,h,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=j([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,o){super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const m of u)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,o,u,h){return this._saturation===r&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(m,g,b,S){m=Zo(m),g=yo(g);const E=H(),O=m/3,D=1-2*O,N=[D,O,O,0,O,D,O,0,O,O,D,0,0,0,0,1],B=.5-.5*g,U=S-b;return Y(E,[U,0,0,0,0,U,0,0,0,0,U,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,B,B,B,1]),Y(E,E,N),E})(r,o,u,h),this._saturation=r,this._contrast=o,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,o,u,h){const m=this.layout.get(r).evaluate(o,{},u,h),g=this._unevaluatedLayout._values[r];return g.isDataDriven()||tg(g.value)||!m?m:(function(b,S){return S.replace(/{([^{}]+)}/g,((E,O)=>O in b?String(b[O]):""))})(o.properties,m)}createBucket(r){return new Ex(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of _S().paint.overridableProperties){if(!Px.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),u=new zD(o),h=new pf(u,o.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new wh("source",h):new sl("composite",h,o.value.zoomStops,o.value.interpolationType),this.paint._values[r]=new rc(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&Px.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const u=r.get("text-field"),h=_S().paint.properties[o];let m=!1;const g=b=>{for(const S of b)if(h.overrides&&h.overrides.hasOverride(S))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof xo)g(u.value.value.sections);else if(u.value.kind==="source"){const b=E=>{m||(E instanceof Ir&&Li(E.value)===Qs?g(E.value.sections):E instanceof $l?g(E.sections):E.eachChild(b))},S=u.value;S._styleExpression&&b(S._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,o,u){return{config:new cc(this,{zoom:o,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let FD,BD,UD,VD;var yS=qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ix(s,r,o,u,h,m,g,b){const S=[s,r,1,o,u,1,h,m,1],E=[g,b,1],O=F([],S),[D,N,B]=br(E,E,O);return q(S,S,[D,0,0,0,N,0,0,0,B])}function $D(s,r,o,u,h,m,g,b){const S=(function(E,O,D,N,B,U,X,Q){const ee=Ix(0,0,1,0,1,1,0,1),ue=Ix(E,O,D,N,B,U,X,Q);return q(ue,ue,F([],ee))})(s,r,o,u,h,m,g,b);return[S[2]/S[8]/Mt,S[5]/S[8]/Mt]}function Cx(s){return[s[0],Math.min(Math.max(s[1],-Te),Te)]}class qD extends Ul{constructor(r,o,u,h){super(),this.id=r,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(r,o){if(this._loaded=o||!1,this.fire(new wa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=$c(this.map._requestManager.transformRequest(this.url,Id.Image),((u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ah(u)):h&&(this.image=h instanceof HTMLImageElement?Wa.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())}))}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ug(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new wa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ug||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=r[0][1],u=r[0][1];for(const m of r)m[1]>u&&(u=m[1]),m[1]<o&&(o=m[1]);const h=(u+o)/2;if(h>Te?this.onNorthPole=!0:h<-Te&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=r.map(et.fromLngLat);this.tileID=(function(g){let b=1/0,S=1/0,E=-1/0,O=-1/0;for(const X of g)b=Math.min(b,X.x),S=Math.min(S,X.y),E=Math.max(E,X.x),O=Math.max(O,X.y);const D=Math.max(E-b,O-S),N=Math.max(0,Math.floor(-Math.log2(D))),B=Math.pow(2,N);let U=Math.floor((b+E)/2*B);return U>1&&(U-=1),new Cs(N,U,Math.floor((S+O)/2*B))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new wa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Ug||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const ee in this.tiles){const ue=this.tiles[ee];ue.state!=="loaded"&&(ue.state="loaded",ue.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Kg(new Cs(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(ee){const ue=ee[1].x-ee[0].x,he=ee[1].y-ee[0].y,pe=ee[2].x-ee[1].x,Ae=ee[2].y-ee[1].y,Ee=ee[3].x-ee[2].x,Oe=ee[3].y-ee[2].y,De=ee[0].x-ee[3].x,Le=ee[0].y-ee[3].y,ct=ue*Ae-pe*he,Ue=pe*Oe-Ee*Ae,ut=Ee*Le-De*Oe,_t=De*he-ue*Le;return ct>0&&Ue>0&&ut>0&&_t>0||ct<0&&Ue<0&&ut<0&&_t<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Kg(this.tileID,this.map.transform.projection),[m,g,b,S]=this.coordinates.map((ee=>{const ue=h.projection.project(ee[0],ee[1]);return OD(h,ue)._round()}));this.perspectiveTransform=$D(m.x,m.y,g.x,g.y,b.x,b.y,S.x,S.y);const E=this._boundsArray=new ac;E.emplaceBack(m.x,m.y,0,0),E.emplaceBack(g.x,g.y,Mt,0),E.emplaceBack(S.x,S.y,0,Mt),E.emplaceBack(b.x,b.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(E,yS.members),this.boundsSegments=Hn.simpleSegment(0,0,4,2);const O=[],D=[Cx((N=this.coordinates)[0]),Cx(N[1]),Cx(N[2]),Cx(N[3])];var N;const[B,U,X,Q]=(function(ee){let ue=ee[0][0],he=ue,pe=ee[0][1],Ae=pe;for(let Ee=1;Ee<ee.length;Ee++)ee[Ee][0]<ue?ue=ee[Ee][0]:ee[Ee][0]>he&&(he=ee[Ee][0]),ee[Ee][1]<pe?pe=ee[Ee][1]:ee[Ee][1]>Ae&&(Ae=ee[Ee][1]);return[ue,pe,he-ue,Ae-pe]})(D);{const ee=new ac,[ue,he,pe,Ae]=(function(st){let mt=st[0].x,Ke=mt,Ge=st[0].y,St=Ge;for(let vt=1;vt<st.length;vt++)st[vt].x<mt?mt=st[vt].x:st[vt].x>Ke&&(Ke=st[vt].x),st[vt].y<Ge?Ge=st[vt].y:st[vt].y>St&&(St=st[vt].y);return[mt,Ge,Ke-mt,St-Ge]})(u),Ee=st=>[(st.x-ue)/pe,(st.y-he)/Ae],[Oe,De,Le,ct]=u.map(Ee),Ue=(function(st,mt,Ke,Ge,St,vt,Qt,zt){const Gt=Ix(0,0,1,0,1,1,0,1);return q(Gt,Gt,F([],Ix(st,mt,Ke,Ge,St,vt,Qt,zt)))})(Oe[0],Oe[1],De[0],De[1],Le[0],Le[1],ct[0],ct[1]);this.elevatedGlobePerspectiveTransform=$D(Oe[0],Oe[1],De[0],De[1],Le[0],Le[1],ct[0],ct[1]);const ut=(st,mt)=>{O.push(st.lng);const Ke=Math.round((st.lng-B)/X*Mt),Ge=Math.round((st.lat-U)/Q*Mt),St=Ee(mt),vt=br([],[St[0],St[1],1],Ue),Qt=Math.round(vt[0]/vt[2]*Mt),zt=Math.round(vt[1]/vt[2]*Mt);ee.emplaceBack(Ke,Ge,Qt,zt)},_t=u[3].x-u[0].x,ht=u[3].y-u[0].y,ft=u[2].x-u[1].x,bt=u[2].y-u[1].y;for(let st=0;st<65;st++){const mt=st/64,Ke=[u[0].x+mt*_t,u[0].y+mt*ht],Ge=[u[1].x+mt*ft,u[1].y+mt*bt],St=Ge[0]-Ke[0],vt=Ge[1]-Ke[1];for(let Qt=0;Qt<65;Qt++){const zt=Qt/64,Gt={x:Ke[0]+St*zt,y:Ke[1]+vt*zt};ut(o.projection.unproject(Gt.x,Gt.y),Gt)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(ee,yS.members)}{this.maxLongitudeTriangleSize=0;let ee=[],ue=new Oi;const he=(pe,Ae,Ee)=>{ue.emplaceBack(pe,Ae,Ee);const Oe=O[pe],De=O[Ae],Le=O[Ee],ct=Math.min(Math.min(Oe,De),Le),Ue=Math.max(Math.max(Oe,De),Le)-ct;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),ee.push(ct+Ue/2)};for(let pe=0;pe<64;pe++)for(let Ae=0;Ae<64;Ae++){const Ee=65*pe+Ae,Oe=Ee+1,De=Ee+65,Le=De+1;he(Ee,De,Oe),he(Oe,De,Le)}[ee,ue]=(function(pe,Ae){const Ee=Array.from({length:pe.length},((Le,ct)=>ct));Ee.sort(((Le,ct)=>pe[Le]-pe[ct]));const Oe=[],De=new Oi;for(let Le=0;Le<Ee.length;Le++){const ct=Ee[Le];Oe.push(pe[ct]);const Ue=3*ct,ut=Ue+1;De.emplaceBack(Ae.uint16[Ue],Ae.uint16[ut],Ae.uint16[ut+1])}return[Oe,De]})(ee,ue),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(ue)}this.elevatedGlobeSegments=Hn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/Mt,0,Q/Mt,0,0,U,B,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof Ug||(this.texture?this.texture.update(this.image):(this.texture=new H1(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(o)}loadTile(r,o){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},o(null)):(r.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(m=r+180)+360*Math.round((u[0]-m)/360);var m;const g=new Hn,b=(D,N)=>{g.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:o.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=S){const D=Xi(u,0,u.length,h+S);return D===u.length||b(D,Ln(u,D+1,u.length,h+360-S)-D),g}h<u[0]&&(h+=360);const E=Ln(u,0,u.length,h-S);if(E===u.length)return b(0,u.length),g;b(0,E-0);const O=Xi(u,E+1,u.length,h+S);return O!==u.length&&b(O,u.length-O),g}}const M9=(Math.pow(256,2)-1)/16907520;class GD extends lo{constructor(r,o,u,h){super(r,{layout:UD||(UD=new Xn({visibility:new Tt(Be.layout_raster.visibility)})),paint:VD||(VD=new Xn({"raster-opacity":new Tt(Be.paint_raster["raster-opacity"]),"raster-color":new su(Be.paint_raster["raster-color"]),"raster-color-mix":new Tt(Be.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(Be.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Be.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Be.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(Be.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(Be.paint_raster["raster-array-band"]),"raster-elevation":new Tt(Be.paint_raster["raster-elevation"]),"raster-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof qD&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Eg({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let HD,WD,ZD,XD,KD;class YD extends lo{constructor(r,o,u,h){super(r,{layout:HD||(HD=new Xn({visibility:new Tt(Be["layout_raster-particle"].visibility)})),paint:WD||(WD=new Xn({"raster-particle-array-band":new Tt(Be["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(Be["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new su(Be["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(Be["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(Be["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(Be["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(Be["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(Be["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,h),this._updateColorRamp(),this.lastInvalidatedAt=Wa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Eg({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Wa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class R9 extends lo{constructor(r,o){super(r,{},o,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function vS(s,r,o){const u=[0,0,1],h=Ho([]);return Ga(h,h,o?-Fe(s)+Math.PI:Fe(s)),qa(h,h,-Fe(r)),jt(u,u,h),Fr(u,u)}const JD={None:0,Model:1,Symbol:2,FillExtrusion:4};class Ox{constructor(r,o,u,h){this.message=(r?`${r}: `:"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}function xS(s,r){const o=s.indexOf("://")===-1;try{return new URL(s,o&&r?"http://example.com":void 0),!0}catch{return!1}}class QD{constructor(r,o){this.feature=r,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ek{constructor(){this.instancedDataArray=new xg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class bS{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs}updateFootprints(r,o){}populate(r,o,u,h){this.tileToMeter=Ve(u);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:b,index:S,sourceLayerIndex:E}of r){const O=b??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),D=xt(g,m);if(!this.layers[0]._featureFilter.filter(new Cn(this.zoom,{worldview:this.worldview}),D,u))continue;const N={id:O,sourceLayerIndex:E,index:S,geometry:m?D.geometry:Lt(g,u,h),properties:g.properties,type:g.type,patterns:{}},B=this.addFeature(N,N.geometry,D);B&&o.featureIndex.insert(g,N.geometry,S,E,this.index,this.instancesPerModel[B].instancedDataArray.length,Mt/32)}this.lookup=null}update(r,o,u,h){for(const m in this.instancesPerModel){const g=this.instancesPerModel[m];for(const b in r)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],r[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const h of u.features){const m=this.layers[0],g=h.feature,b=this.canonical,S=m.paint.get("model-rotation").evaluate(g,{},b),E=m.paint.get("model-scale").evaluate(g,{},b),O=m.paint.get("model-translation").evaluate(g,{},b);Hr(h.rotation,S)&&Hr(h.scale,E)&&Hr(h.translation,O)||(this.evaluate(h,h.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,o,u,h){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const m=o.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(tx(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(const b in this.instancesPerModel){const S=this.instancesPerModel[b],E=S.instancedDataArray;for(const O of S.features){const D=O.instancedDataOffset,N=O.instancedDataCount;for(let B=0;B<N;B++){const U=16*(B+D);let X=E.float32[U+0];const Q=X>Mt;X=Q?X-Mt:X;const ee=Math.floor(X),ue=E.float32[U+1];let he=!1;for(const pe of this.activeReplacements)if(!BM(pe,u,JD.Model,h)&&!(pe.min.x>ee||ee>pe.max.x||pe.min.y>ue||ue>pe.max.y)&&(he=k1(qM(ee,ue,r.canonical,pe.footprintTileId.canonical),pe.footprint),he))break;E.float32[U]=he?X+Mt:X,g=g||he!==Q}}}return g}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,sW.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris&&this.modelsRequested)for(const o of this.modelUris)r.removeModel(o,"",!0)}addFeature(r,o,u){const h=this.layers[0],m=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!m)return Vr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;(xS(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new ek);const g=this.instancesPerModel[m],b=g.instancedDataArray,S=new QD(u,b.length);for(const E of o)for(const O of E){if(O.x<0||O.x>=Mt||O.y<0||O.y>=Mt)continue;if(this.lookupDim!==0){const N=(this.lookupDim-1)/Mt,B=this.lookupDim*(O.y*N|0)+O.x*N|0;if(this.lookup){if(this.lookup[B]!==0)continue;this.lookup[B]=1}}this.instanceCount++;const D=b.length;b.resize(D+1),g.instancesEvaluatedElevation.push(0),b.float32[16*D]=O.x,b.float32[16*D+1]=O.y}return S.instancedDataCount=g.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(r.id&&(g.idToFeaturesIndex[r.id]=g.features.length),g.features.push(S),this.evaluate(S,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(r,o,u,h){const m=this.layers[0],g=r.feature,b=this.canonical,S=r.rotation=m.paint.get("model-rotation").evaluate(g,o,b),E=r.scale=m.paint.get("model-scale").evaluate(g,o,b),O=r.translation=m.paint.get("model-translation").evaluate(g,o,b),D=m.paint.get("model-color").evaluate(g,o,b);D.a=m.paint.get("model-color-mix-intensity").evaluate(g,o,b);const N=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),AR(N,S,E);const B=Math.round(100*D.a)+D.b/1.05;for(let U=0;U<r.instancedDataCount;++U){const X=r.instancedDataOffset+U,Q=16*X,ee=u.instancedDataArray.float32;let ue=0;h&&(ue=ee[Q+6]-u.instancesEvaluatedElevation[X]);const he=0|ee[Q+1];ee[Q]=(0|ee[Q])+D.r/1.05,ee[Q+1]=he+D.g/1.05,ee[Q+2]=B,ee[Q+3]=1/(b.z>10?this.tileToMeter:Ve(b,he)),ee[Q+4]=O[0],ee[Q+5]=O[1],ee[Q+6]=O[2]+ue,ee[Q+7]=N[0],ee[Q+8]=N[1],ee[Q+9]=N[2],ee[Q+10]=N[4],ee[Q+11]=N[5],ee[Q+12]=N[6],ee[Q+13]=N[8],ee[Q+14]=N[9],ee[Q+15]=N[10],u.instancesEvaluatedElevation[X]=O[2]}}}let tk,rk;Ut(bS,"ModelBucket",{omit:["layers"]}),Ut(ek,"PerModelAttributes"),Ut(QD,"ModelFeature");class Yf{constructor(r,o,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(r,o,u){const h=u||r.findDEMTileFor(o);if(!h||!h.dem)return;const m=h.dem,g=h.tileID,b=1<<o.canonical.z-g.canonical.z;return new Yf(h,m.dim/Mt/b,[(o.canonical.x/b-g.canonical.x)*m.dim,(o.canonical.y/b-g.canonical.y)*m.dim])}tileCoordToPixel(r,o){const u=o*this._scale+this._offset[1];return new wt(Math.floor(r*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(r,o,u,h){const m=r*this._scale+this._offset[0],g=o*this._scale+this._offset[1],b=Math.floor(m),S=Math.floor(g),E=this._dem;return h=!!h,u?lr(lr(E.get(b,S,h),E.get(b,S+1,h),g-S),lr(E.get(b+1,S,h),E.get(b+1,S+1,h),g-S),m-b):E.get(b,S,h)}getElevationAtPixel(r,o,u){return this._dem.get(r,o,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*xe(1,r)*this._dem.stride}}const wS=new Float32Array(262144),$h=new Uint8Array(262144);function nk(s){let r=0;if(s.meshes)for(const o of s.meshes)r=Math.max(r,o.aabb.max[2]);if(s.children)for(const o of s.children)r=Math.max(r,nk(o));return r}function ik(s,r,o){if(s.meshes)for(const u of s.meshes){if(u.aabb.min[0]===1/0)continue;const h=hr.applyTransform(u.aabb,s.matrix);o.insert(r,h.min[0],h.min[1],h.max[0],h.max[1])}if(s.children)for(const u of s.children)ik(u,r,o)}const ok=["","wall","door","roof","window","lamp","logo"];class ak{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:nk(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const o=new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=hr.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),r++;this.aabb=o}return this.aabb}}class Mx{constructor(r,o,u,h,m,g,b,S){this.id=u,this.layers=r,this.layerIds=this.layers.map((E=>E.fqid)),this.stateDependentLayerIds=this.layers.filter((E=>E.isStateDependent())).map((E=>E.id)),this.modelTraits|=Gf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Gf.HasMapboxMeshFeatures),m&&(this.modelTraits|=Gf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of o)this.nodesInfo.push(new ak(E)),ik(E,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(r,o){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&o.push({footprint:h.footprint,id:r})}}update(r){const o=Object.keys(r).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!vs(r,this.states))for(const h of u)this.evaluate(h,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const h=u.node;this.uploaded?this.updatePbrBuffer(h):X1(h,r,!0)}for(const u of o)hx(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let o=!1;if(!r.meshes)return o;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(r,o,u){const h=r.transform.projectionOptions,m=r.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||h.name!==this.projection.name||t_(u.paint.get("model-color").value,g)||t_(u.paint.get("model-color-mix-intensity").value,g)||t_(u.paint.get("model-roughness").value,g)||t_(u.paint.get("model-emissive-strength").value,g)||t_(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=m;const b=this.getNodesInfo();for(const S of b)S.state=null;return!0}return!1}evaluateTransform(r,o){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const m of u){const g=m.feature;m.evaluatedTranslation=o.paint.get("model-translation").evaluate(g,{},h),m.evaluatedScale=o.paint.get("model-scale").evaluate(g,{},h)}}evaluate(r,o){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const m=h.feature,g=o&&o[m.id];if(vs(g,h.state))continue;h.state=structuredClone(g);const b=h.node.meshes&&h.node.meshes[0].featureData,S=h.evaluatedColor[2],E=h.evaluatedRMEA[2],O=this.id.canonical;if(h.hasTranslucentParts=!1,b){for(let D=0;D<ok.length;D++){const N=ok[D];N.length&&(m.properties.part=N);const B=r.paint.get("model-color").evaluate(m,g,O).toPremultipliedRenderColor(null),U=r.paint.get("model-color-mix-intensity").evaluate(m,g,O);h.evaluatedColor[D]=[B.r,B.g,B.b,U],h.evaluatedRMEA[D][0]=r.paint.get("model-roughness").evaluate(m,g,O),h.evaluatedRMEA[D][2]=r.paint.get("model-emissive-strength").evaluate(m,g,O),h.evaluatedRMEA[D][3]=B.a,h.emissionHeightBasedParams[D]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,O),!h.hasTranslucentParts&&B.a<1&&(h.hasTranslucentParts=!0)}delete m.properties.part,k9(h,S!==h.evaluatedColor[2]||E!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(m,g,O);h.evaluatedTranslation=r.paint.get("model-translation").evaluate(m,g,O),h.evaluatedScale=r.paint.get("model-scale").evaluate(m,g,O),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,o,u,h){const m=r.findDEMTileFor(u);if(m&&(m.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const g=Yf.create(r,u,m);if(!g)return;this.modelTraits&Gf.HasMapboxMeshFeatures&&this.updateDEM(r,g,u,h);for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const E=S.footprint.vertices;let O=g.getElevationAt(E[0].x,E[0].y,!0,!0);for(let D=1;D<E.length;D++)O=Math.min(O,g.getElevationAt(E[D].x,E[D].y,!0,!0));S.elevation=O}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=o}}updateDEM(r,o,u,h){let m=o._dem._modifiedForSources[h];if(m===void 0&&(o._dem._modifiedForSources[h]=[],m=o._dem._modifiedForSources[h]),m.includes(u.canonical))return;const g=o._dem.dim;m.push(u.canonical);let b=!1;for(const S of this.getNodesInfo()){const E=S.node;if(!E.footprint||!E.footprint.grid)continue;const O=E.footprint.grid,D=o.tileCoordToPixel(O.min.x,O.min.y),N=o.tileCoordToPixel(O.max.x,O.max.y),B=Math.min(Math.min(g-N.y,D.x),Math.min(D.y,g-N.x));if(B<0)continue;const U=Ie(B,2,5);let X=Math.max(0,D.x-U),Q=Math.max(0,D.y-U),ee=Math.min(N.x+U,g-1),ue=Math.min(N.y+U,g-1);for(let Ee=Q;Ee<=ue;++Ee)for(let Oe=X;Oe<=ee;++Oe)$h[Ee*g+Oe]=255;let he=0,pe=0;for(let Ee=0;Ee<O.cellsY;++Ee)for(let Oe=0;Oe<O.cellsX;++Oe){if(!O.cells[Ee*O.cellsX+Oe])continue;const De=o.tileCoordToPixel(O.min.x+Oe/O.xScale,O.min.y+Ee/O.yScale),Le=o.tileCoordToPixel(O.min.x+(Oe+1)/O.xScale,O.min.y+(Ee+1)/O.yScale);for(let ct=De.y;ct<=Math.min(Le.y+1,g-1);++ct)for(let Ue=De.x;Ue<=Math.min(Le.x+1,g-1);++Ue)$h[ct*g+Ue]===255&&($h[ct*g+Ue]=0,he+=o.getElevationAtPixel(Ue,ct),pe++)}const Ae=he/pe;X=Math.max(1,D.x-U),Q=Math.max(1,D.y-U),ee=Math.min(N.x+U,g-2),ue=Math.min(N.y+U,g-2),b=!0;for(let Ee=Q;Ee<=ue;++Ee)for(let Oe=X;Oe<=ee;++Oe)$h[Ee*g+Oe]===0&&(wS[Ee*g+Oe]=o._dem.set(Oe,Ee,Ae));for(let Ee=1;Ee<U;++Ee){X=Math.max(1,D.x-Ee),Q=Math.max(1,D.y-Ee),ee=Math.min(N.x+Ee,g-2),ue=Math.min(N.y+Ee,g-2);for(let Oe=Q;Oe<=ue;++Oe)for(let De=X;De<=ee;++De){const Le=Oe*g+De;if($h[Le]===255){let ct=0,Ue=0,ut=-1,_t=-1;for(let ht=-1;ht<=1;++ht)for(let ft=-1;ft<=1;++ft){const bt=(Oe+ht)*g+De+ft;if($h[bt]>=Ee)continue;const st=wS[bt],mt=Math.abs(st);mt>Ue&&(ct=st,Ue=mt,ut=ft,_t=ht)}if(Ue>.1){const ht=1-(Ee+.5*Math.abs(ut*_t))/U;let ft=o._dem.get(De,Oe)+ct*ht;const bt=o._dem.get(De+ut,Oe+_t),st=o._dem.get(De-ut,Oe-_t,!0);(ft-bt)*(ft-st)>0&&(ft=(bt+st)/2),wS[Le]=o._dem.set(De,Oe,ft),$h[Le]=Ee}}}}}b&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Wa.now())}setFilter(r){this.filter=r?Th(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((r=>this.filter.filter(new Cn(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical))):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const o of r)hx(o.node),K1(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(r.toUnwrapped());for(const h of this.getNodesInfo()){const m=h.node.footprint;h.hiddenByReplacement=!!m&&!u.find((g=>g.footprint===m))}}getHeightAtTileCoord(r,o){const u=[],h=[0,0,0],m=j([]);for(const g of this.getNodesInfo()){const b=g.node.meshes[0],S=b.transformedAabb;if(r<S.min[0]||o<S.min[1]||r>S.max[0]||o>S.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};$(m,g.node.matrix),h[0]=r,h[1]=o,or(h,h,m);const E=(h[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*Bh|0,O=Math.min(63,(h[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*Bh|0)*Bh+Math.min(63,E),D=b.heightmap[O];if(!(D<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:D,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new wt(r,o),new wt(r,o),u),u.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function t_(s,r){return s instanceof wh&&!s.isLightConstant&&r}function D9(s,r,o,u,h,m,g,b){let S=(61440&r|(61440&r)>>4)>>8,E=(3840&r|(3840&r)>>4)>>4,O=240&r|(240&r)>>4;o[3]>0&&(S=lr(S,255*o[0],o[3]),E=lr(E,255*o[1],o[3]),O=lr(O,255*o[2],o[3]));const D=S<<8|E,N=O<<8|Math.floor(255*u[3]),B=(function(Ee){const Oe=Ie(Ee,0,2);return Math.min(Math.round(.5*Oe*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],U=Ie(h[0],0,1),X=Ie(h[1],0,1),Q=Ie(h[2],0,1),ee=Ie(h[3],0,1);let ue,he,pe,Ae;if(U!==X&&g!==m&&X!==U){const Ee=g-m;he=1/(Ee*(X-U)),pe=-(m+Ee*U)/(Ee*(X-U));const Oe=Ie(h[4],-1,1);Ae=Math.pow(10,Oe),ue=255*Q<<8|255*ee}else ue=65535,he=0,pe=1,Ae=1;if(s.emplaceBack(D,N,B,ue,he,pe,Ae),b){const Ee=b.length;b.clear();for(let Oe=0;Oe<Ee;Oe++)b.emplaceBack(D,N,B,ue,he,pe,Ae)}}function k9(s,r,o){const u=s.node;let h=0;const m=o&Gf.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new mu,g.featureArray.reserve(g.featureData.length);let b=r;for(const S of g.featureData){const E=m?65535&S:S>>16&65535,O=m?S>>16&65535:65535&S,D=(15&O)<8?15&O:0,N=s.evaluatedRMEA[D],B=s.evaluatedColor[D],U=s.emissionHeightBasedParams[D];let X;if(b&&D===2&&u.lights&&(X=new mu,X.resize(10*u.lights.length)),D9(g.featureArray,E,B,N,U,g.aabb.min[2],g.aabb.max[2],X),X&&b){b=!1;const Q=u.meshes[u.lightMeshIndex];Q.featureArray=X,Q.featureArray._trim()}}g.featureArray._trim(),h++}}function sk(s,r,o,u){const h=1<<s.z;r.lat=be((u/Mt+s.y)/h),r.lng=Se((o/Mt+s.x)/h)}function N9(s,r,o,u){const h=s.getNodesInfo()[r];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let m=Number.MAX_VALUE;const g=h.node,b=o.tile,S=u.calculatePosMatrix(b.tileID.toUnwrapped(),u.worldSize),E=h.evaluatedScale;let O=0;u.elevation&&g.elevation&&(O=g.elevation*u.elevation.exaggeration()),K(S,S,[(g.anchor?g.anchor[0]:0)*(E[0]-1),(g.anchor?g.anchor[1]:0)*(E[1]-1),O]),re(S,S,E);const D=o.queryGeometry,N=D.isPointQuery()?D.screenBounds:D.screenGeometry,B=function(X){const Q=Y([],S,X.matrix);Y(Q,u.expandedFarZProjMatrix,Q);for(let ee=0;ee<X.meshes.length;++ee){const ue=X.meshes[ee];if(ee===X.lightMeshIndex)continue;const he=ER(N,u,Q,ue.aabb);he!=null&&(m=Math.min(he,m))}if(X.children)for(const ee of X.children)B(ee)};if(B(g),m===Number.MAX_VALUE)return;const U=new Z(0,0);return sk(b.tileID.canonical,U,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:m,position:U,feature:h.feature}}Ut(Mx,"Tiled3dModelBucket",{omit:["layers"]}),Ut(ak,"Tiled3dModelFeature");const L9={circle:class extends lo{constructor(s,r,o,u){super(s,{layout:_u||(_u=new Xn({"circle-sort-key":new Nt(Be.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(Be.layout_circle["circle-elevation-reference"]),visibility:new Tt(Be.layout_circle.visibility)})),paint:Is||(Is=new Xn({"circle-radius":new Nt(Be.paint_circle["circle-radius"]),"circle-color":new Nt(Be.paint_circle["circle-color"]),"circle-blur":new Nt(Be.paint_circle["circle-blur"]),"circle-opacity":new Nt(Be.paint_circle["circle-opacity"]),"circle-translate":new Tt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(Be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(Be.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}createBucket(s){return new qi(s)}queryRadius(s){const r=s;return Oa("circle-radius",this,r)+Oa("circle-stroke-width",this,r)+gl(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,o,u,h,m,g,b){const S=ts(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o);return fM(s,u,m,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,r,o){const u=dM(this);return{config:new cc(this,{zoom:r,lut:o}),defines:u,overrideFog:!1}}is3D(s){return!s&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends lo{createBucket(s){return new mM(s)}constructor(s,r,o,u){super(s,{layout:gM||(gM=new Xn({visibility:new Tt(Be.layout_heatmap.visibility)})),paint:_M||(_M=new Xn({"heatmap-radius":new Nt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new su(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Be.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Eg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(s){return Oa("heatmap-radius",this,s)}queryIntersectsFeature(s,r,o,u,h,m,g,b){const S=this.paint.get("heatmap-radius").evaluate(r,o);return fM(s,u,m,g,b,!0,!0,new wt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,r,o){return s==="heatmap"?{config:new cc(this,{zoom:r,lut:o}),overrideFog:!1}:{}}},hillshade:class extends lo{constructor(s,r,o,u){super(s,{layout:yM||(yM=new Xn({visibility:new Tt(Be.layout_hillshade.visibility)})),paint:vM||(vM=new Xn({"hillshade-illumination-direction":new Tt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(Be.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,r,o){return{overrideFog:!1}}},fill:class extends lo{constructor(s,r,o,u){super(s,{layout:kM||(kM=new Xn({"fill-sort-key":new Nt(Be.layout_fill["fill-sort-key"]),visibility:new Tt(Be.layout_fill.visibility),"fill-elevation-reference":new Tt(Be.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Nt(Be.layout_fill["fill-construct-bridge-guard-rail"])})),paint:NM||(NM=new Xn({"fill-antialias":new Tt(Be.paint_fill["fill-antialias"]),"fill-opacity":new Nt(Be.paint_fill["fill-opacity"]),"fill-color":new Nt(Be.paint_fill["fill-color"]),"fill-outline-color":new Nt(Be.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nt(Be.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Tt(Be.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Tt(Be.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Nt(Be.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Nt(Be.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Nt(Be.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),o=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(s,r,o){return{config:new cc(this,{zoom:r,lut:o}),overrideFog:!1}}recalculate(s,r){super.recalculate(s,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new M1(s)}queryRadius(){return gl(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,o,u,h,m){return!s.queryGeometry.isAboveHorizon&&Fo(_l(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?r&&!s:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends lo{constructor(s,r,o,u){super(s,{layout:iR||(iR=new Xn({visibility:new Tt(Be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oR||(oR=new Xn({"fill-extrusion-opacity":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Nt(Be["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new nx(s)}queryRadius(){return gl(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,r,o,u,h,m,g,b,S){const E=ts(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(r,o),D=this.paint.get("fill-extrusion-base").evaluate(r,o),N=[0,0],B=b&&m.elevation,U=m.elevation?m.elevation.exaggeration():1,X=s.tile.getBucket(this);if(B&&X instanceof nx){const pe=X.centroidVertexArray,Ae=S+1;Ae<pe.length&&(N[0]=pe.geta_centroid_pos0(Ae),N[1]=pe.geta_centroid_pos1(Ae))}if(N[0]===0&&N[1]===1)return!1;m.projection.name==="globe"&&(u=nR([u],[new wt(0,0),new wt(Mt,Mt)],s.tileID.canonical).map((pe=>pe.polygon)).flat());const Q=B?b:null,[ee,ue]=(function(pe,Ae,Ee,Oe,De,Le,ct,Ue,ut,_t,ht){return pe.projection.name==="globe"?(function(ft,bt,st,mt,Ke,Ge,St,vt,Qt,zt,Gt){const Ct=[],Yt=[],_r=ft.projection.upVectorScale(Gt,ft.center.lat,ft.worldSize).metersToTile,kt=[0,0,0,1],Zt=[0,0,0,1],cr=(kr,Sr,$t,wr)=>{kr[0]=Sr,kr[1]=$t,kr[2]=wr,kr[3]=1},xr=rR();st>0&&(st+=xr),mt+=xr;for(const kr of bt){const Sr=[],$t=[];for(const wr of kr){const Wr=wr.x+Ke.x,ge=wr.y+Ke.y,_e=ft.projection.projectTilePoint(Wr,ge,Gt),Xe=ft.projection.upVector(Gt,wr.x,wr.y);let lt=st,Dt=mt;if(St){const Rt=hR(Wr,ge,st,mt,St,vt,Qt,zt);lt+=Rt.base,Dt+=Rt.top}st!==0?cr(kt,_e.x+Xe[0]*_r*lt,_e.y+Xe[1]*_r*lt,_e.z+Xe[2]*_r*lt):cr(kt,_e.x,_e.y,_e.z),cr(Zt,_e.x+Xe[0]*_r*Dt,_e.y+Xe[1]*_r*Dt,_e.z+Xe[2]*_r*Dt),or(kt,kt,Ge),or(Zt,Zt,Ge),Sr.push(new zh(kt[0],kt[1],kt[2])),$t.push(new zh(Zt[0],Zt[1],Zt[2]))}Ct.push(Sr),Yt.push($t)}return[Ct,Yt]})(pe,Ae,Ee,Oe,De,Le,ct,Ue,ut,_t,ht):ct?(function(ft,bt,st,mt,Ke,Ge,St,vt,Qt){const zt=[],Gt=[],Ct=[0,0,0,1];for(const Yt of ft){const _r=[],kt=[];for(const Zt of Yt){const cr=Zt.x+mt.x,xr=Zt.y+mt.y,kr=hR(cr,xr,bt,st,Ge,St,vt,Qt);Ct[0]=cr,Ct[1]=xr,Ct[2]=kr.base,Ct[3]=1,Ni(Ct,Ct,Ke),Ct[3]=Math.max(Ct[3],1e-5);const Sr=new zh(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ct[0]=cr,Ct[1]=xr,Ct[2]=kr.top,Ct[3]=1,Ni(Ct,Ct,Ke),Ct[3]=Math.max(Ct[3],1e-5);const $t=new zh(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);_r.push(Sr),kt.push($t)}zt.push(_r),Gt.push(kt)}return[zt,Gt]})(Ae,Ee,Oe,De,Le,ct,Ue,ut,_t):(function(ft,bt,st,mt,Ke){const Ge=[],St=[],vt=Ke[8]*bt,Qt=Ke[9]*bt,zt=Ke[10]*bt,Gt=Ke[11]*bt,Ct=Ke[8]*st,Yt=Ke[9]*st,_r=Ke[10]*st,kt=Ke[11]*st;for(const Zt of ft){const cr=[],xr=[];for(const kr of Zt){const Sr=kr.x+mt.x,$t=kr.y+mt.y,wr=Ke[0]*Sr+Ke[4]*$t+Ke[12],Wr=Ke[1]*Sr+Ke[5]*$t+Ke[13],ge=Ke[2]*Sr+Ke[6]*$t+Ke[14],_e=Ke[3]*Sr+Ke[7]*$t+Ke[15],Xe=wr+vt,lt=Wr+Qt,Dt=ge+zt,Rt=Math.max(_e+Gt,1e-5),Vt=wr+Ct,ir=Wr+Yt,Nr=ge+_r,Lr=Math.max(_e+kt,1e-5);cr.push(new zh(Xe/Rt,lt/Rt,Dt/Rt)),xr.push(new zh(Vt/Lr,ir/Lr,Nr/Lr))}Ge.push(cr),St.push(xr)}return[Ge,St]})(Ae,Ee,Oe,De,Le)})(m,u,D,O,E,g,Q,N,U,m.center.lat,s.tileID.canonical),he=s.queryGeometry;return(function(pe,Ae,Ee){let Oe=1/0;Fo(Ee,Ae)&&(Oe=uR(Ee,Ae[0]));for(let De=0;De<Ae.length;De++){const Le=Ae[De],ct=pe[De];for(let Ue=0;Ue<Le.length-1;Ue++){const ut=Le[Ue],_t=[ut,Le[Ue+1],ct[Ue+1],ct[Ue],ut];na(Ee,_t)&&(Oe=Math.min(Oe,uR(Ee,_t)))}}return Oe!==1/0&&Oe})(ee,ue,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends lo{constructor(s,r,o,u){super(s,{layout:LR||(LR=new Xn({visibility:new Tt(Be.layout_building.visibility),"building-facade":new Nt(Be.layout_building["building-facade"]),"building-facade-floors":new Nt(Be.layout_building["building-facade-floors"]),"building-facade-unit-width":new Nt(Be.layout_building["building-facade-unit-width"]),"building-facade-window":new Nt(Be.layout_building["building-facade-window"]),"building-roof-shape":new Nt(Be.layout_building["building-roof-shape"]),"building-height":new Nt(Be.layout_building["building-height"]),"building-base":new Nt(Be.layout_building["building-base"]),"building-flood-light-wall-radius":new Nt(Be.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Nt(Be.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Nt(Be.layout_building["building-flip-roof-orientation"])})),paint:jR||(jR=new Xn({"building-opacity":new Tt(Be.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Tt(Be.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Tt(Be.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Tt(Be.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Tt(Be.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Tt(Be.paint_building["building-vertical-scale"]),"building-cast-shadows":new Tt(Be.paint_building["building-cast-shadows"]),"building-color":new Nt(Be.paint_building["building-color"]),"building-emissive-strength":new Nt(Be.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Tt(Be.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Tt(Be.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Tt(Be.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Tt(Be.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Tt(Be.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new NR(s)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(s){return!0}},line:class extends lo{constructor(s,r,o,u){const h=WR();super(s,h,r,o,u),h.layout&&(this.layout=new nc(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof yh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=(()=>{if($g)return $g;const o=WR();return $g=new kW(o.paint.properties["line-width"].specification),$g.useIntegerZoom=!0,$g})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new eS(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,r,o){const u=GR(this);return{config:new cc(this,{zoom:r,lut:o}),defines:u,overrideFog:!1}}queryRadius(s){const r=s,o=ZR(Oa("line-width",this,r),Oa("line-gap-width",this,r)),u=Oa("line-offset",this,r);return o/2+Math.abs(u)+gl(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,o,u,h,m){if(s.queryGeometry.isAboveHorizon)return!1;const g=_l(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),b=s.pixelToTileUnitsFactor/2*ZR(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),S=this.paint.get("line-offset").evaluate(r,o);return S&&(u=(function(E,O){const D=[],N=new wt(0,0);for(let B=0;B<E.length;B++){const U=E[B],X=[];for(let Q=0;Q<U.length;Q++){const ee=U[Q],ue=U[Q+1],he=Q===0?N:ee.sub(U[Q-1])._unit()._perp(),pe=Q===U.length-1?N:ue.sub(ee)._unit()._perp(),Ae=he._add(pe)._unit();Ae._mult(1/(Ae.x*pe.x+Ae.y*pe.y)),X.push(Ae._mult(O)._add(ee))}D.push(X)}return D})(u,S*s.pixelToTileUnitsFactor)),(function(E,O,D){for(let N=0;N<O.length;N++){const B=O[N];if(E.length>=3){for(let U=0;U<B.length;U++)if(zi(E,B[U]))return!0}if(Bo(E,B,D))return!0}return!1})(g,u,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Px,background:class extends lo{constructor(s,r,o,u){super(s,{layout:FD||(FD=new Xn({visibility:new Tt(Be.layout_background.visibility)})),paint:BD||(BD=new Xn({"background-pitch-alignment":new Tt(Be.paint_background["background-pitch-alignment"]),"background-color":new Tt(Be.paint_background["background-color"]),"background-pattern":new Tt(Be.paint_background["background-pattern"]),"background-opacity":new Tt(Be.paint_background["background-opacity"]),"background-emissive-strength":new Tt(Be.paint_background["background-emissive-strength"]),"background-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,r,o){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:GD,"raster-particle":YD,sky:class extends lo{constructor(s,r,o,u){super(s,{layout:ZD||(ZD=new Xn({visibility:new Tt(Be.layout_sky.visibility)})),paint:XD||(XD=new Xn({"sky-type":new Tt(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new su(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(Be.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Eg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,m=s.style.light,g=m.properties.get("position");return h&&m.properties.get("anchor")==="viewport"&&Vr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?vS(g.azimuthal,90-g.polar,r):vS(u[0],90-u[1],r)}const o=this.paint.get("sky-gradient-center");return vS(o[0],90-o[1],r)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends lo{constructor(s,r,o,u){super(s,{paint:KD||(KD=new Xn({}))},r,null)}},model:class extends lo{constructor(s,r,o,u){super(s,{layout:tk||(tk=new Xn({visibility:new Tt(Be.layout_model.visibility),"model-id":new Nt(Be.layout_model["model-id"])})),paint:rk||(rk=new Xn({"model-opacity":new Nt(Be.paint_model["model-opacity"]),"model-rotation":new Nt(Be.paint_model["model-rotation"]),"model-scale":new Nt(Be.paint_model["model-scale"]),"model-translation":new Nt(Be.paint_model["model-translation"]),"model-color":new Nt(Be.paint_model["model-color"]),"model-color-mix-intensity":new Nt(Be.paint_model["model-color-mix-intensity"]),"model-type":new Tt(Be.paint_model["model-type"]),"model-cast-shadows":new Tt(Be.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(Be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(Be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Nt(Be.paint_model["model-emissive-strength"]),"model-roughness":new Nt(Be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Nt(Be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(Be.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(Be.paint_model["model-front-cutoff"]),"model-elevation-reference":new Tt(Be.paint_model["model-elevation-reference"]),"model-color-use-theme":new Nt({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new bS(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof Mx?Mt-1:0}queryIntersectsFeature(s,r,o,u,h,m){if(!this.modelManager)return!1;const g=this.modelManager,b=s.tile.getBucket(this);if(!(b&&b instanceof bS))return!1;for(const S in b.instancesPerModel){const E=b.instancesPerModel[S],O=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(O)){const D=E.features[E.idToFeaturesIndex[O]],N=g.getModel(S,this.scope);if(!N)return!1;let B=H();const U=new Z(0,0),X=b.canonical;let Q=Number.MAX_VALUE;for(let ee=0;ee<D.instancedDataCount;++ee){const ue=16*(D.instancedDataOffset+ee),he=E.instancedDataArray.float32,pe=[he[ue+4],he[ue+5],he[ue+6]];sk(X,U,he[ue],0|he[ue+1]),PR(B,N,m,U,D.rotation,D.scale,pe,!1,!1,!1),m.projection.name==="globe"&&(B=Z1(B,m));const Ae=Y([],m.projMatrix,B),Ee=s.queryGeometry,Oe=ER(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,m,Ae,N.aabb);Oe!=null&&(Q=Math.min(Oe,Q))}return Q!==Number.MAX_VALUE&&Q}}return!1}_handleOverridablePaintPropertyUpdate(s,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const r=this._transitionablePaint._values[s];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof sl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends lo{constructor(s,r,o,u){super(s,{layout:LM||(LM=new Xn({"clip-layer-types":new Tt(Be.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(Be.layout_clip["clip-layer-scope"])})),paint:jM||(jM=new Xn({}))},r,o,u)}recalculate(s,r){super.recalculate(s,r)}createBucket(s){return new zM(s)}is3D(s){return!0}}},SS=new cn(0,0,0),TS={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},AS={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Rx={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},j9={PAINT_ORDER_FILL_AND_STROKE:1},r_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},lk={MASK_TYPE_LUMINANCE:1};function z9(s,r,o){s===1&&r.icons.push((function(u,h){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:g}=m;if(g.content_area){const{content_area:b}=g;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=m.usvg_tree.width),b.height==null&&(b.height=b.width)}if(g.text_placeholder){const{text_placeholder:b}=g;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return g.stretch_x&&g.stretch_x.length&&ck(g,"x"),g.stretch_y&&g.stretch_y.length&&ck(g,"y"),m})(u.readFields(F9,{name:void 0},h))})(o,o.readVarint()+o.pos))}function ck(s,r){const o=[],u=s[`stretch_${r}`];let h=null;for(let m=0;m<u.length;m++)h===null?h=o.length===0?u[0]:o[o.length-1][1]+u[m]:(o.push([h,h+u[m]]),h=null);s[`stretch_${r}_areas`]=o}function F9(s,r,o){s===1?r.name=o.readString():s===2?r.metadata=(function(u,h){return u.readFields(B9,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(o,o.readVarint()+o.pos):s===3&&(r.usvg_tree=(function(u,h){return u.readFields($9,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(o,o.readVarint()+o.pos),r.data="usvg_tree")}function B9(s,r,o){s===1?r.stretch_x=o.readPackedVarint():s===2?r.stretch_y=o.readPackedVarint():s===3?r.content_area=uk(o,o.readVarint()+o.pos):s===4?r.variables.push((function(u,h){return u.readFields(V9,{name:void 0},h)})(o,o.readVarint()+o.pos)):s===5&&(r.text_placeholder=uk(o,o.readVarint()+o.pos))}function uk(s,r){return s.readFields(U9,{},r)}function U9(s,r,o){s===1?r.left=o.readVarint():s===2?r.width=o.readVarint():s===3?r.top=o.readVarint():s===4&&(r.height=o.readVarint())}function V9(s,r,o){s===1?r.name=o.readString():s===2&&(r.rgb_color=Nx(o.readVarint()),r.value="rgb_color")}function $9(s,r,o){s===1?r.width=r.height=o.readVarint():s===2?r.height=o.readVarint():s===3?r.children.push(Dx(o,o.readVarint()+o.pos)):s===4?r.linear_gradients.push((function(u,h){return u.readFields(K9,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(o,o.readVarint()+o.pos)):s===5?r.radial_gradients.push((function(u,h){return u.readFields(J9,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(o,o.readVarint()+o.pos)):s===7?r.clip_paths.push((function(u,h){return u.readFields(Q9,{children:[]},h)})(o,o.readVarint()+o.pos)):s===8&&r.masks.push((function(u,h){const m=u.readFields(e7,{left:0,width:20,mask_type:lk.MASK_TYPE_LUMINANCE,children:[]},h);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(o,o.readVarint()+o.pos))}function Dx(s,r){return s.readFields(q9,{},r)}function q9(s,r,o){s===1?(r.group=(function(u,h){return u.readFields(G9,{opacity:255,children:[]},h)})(o,o.readVarint()+o.pos),r.node="group"):s===2&&(r.path=(function(u,h){return u.readFields(W9,{paint_order:1,commands:[],step:1,diffs:[],rule:TS.PATH_RULE_NON_ZERO},h)})(o,o.readVarint()+o.pos),r.node="path")}function G9(s,r,o){s===1?r.transform=kx(o,o.readVarint()+o.pos):s===2?r.opacity=o.readVarint():s===5?r.clip_path_idx=o.readVarint():s===6?r.mask_idx=o.readVarint():s===7&&r.children.push(Dx(o,o.readVarint()+o.pos))}function kx(s,r){return s.readFields(H9,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function H9(s,r,o){s===1?r.sx=o.readFloat():s===2?r.ky=o.readFloat():s===3?r.kx=o.readFloat():s===4?r.sy=o.readFloat():s===5?r.tx=o.readFloat():s===6&&(r.ty=o.readFloat())}function W9(s,r,o){s===1?r.fill=(function(u,h){return u.readFields(Z9,{rgb_color:SS,paint:"rgb_color",opacity:255},h)})(o,o.readVarint()+o.pos):s===2?r.stroke=(function(u,h){return u.readFields(X9,{rgb_color:SS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(o,o.readVarint()+o.pos):s===3?r.paint_order=o.readVarint():s===5?o.readPackedVarint(r.commands):s===6?r.step=o.readFloat():s===7?o.readPackedSVarint(r.diffs):s===8&&(r.rule=o.readVarint())}function Z9(s,r,o){s===1?(r.rgb_color=Nx(o.readVarint()),r.paint="rgb_color"):s===2?(r.linear_gradient_idx=o.readVarint(),r.paint="linear_gradient_idx"):s===3?(r.radial_gradient_idx=o.readVarint(),r.paint="radial_gradient_idx"):s===5&&(r.opacity=o.readVarint())}function Nx(s){return new cn((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function X9(s,r,o){s===1?(r.rgb_color=Nx(o.readVarint()),r.paint="rgb_color"):s===2?(r.linear_gradient_idx=o.readVarint(),r.paint="linear_gradient_idx"):s===3?(r.radial_gradient_idx=o.readVarint(),r.paint="radial_gradient_idx"):s===5?o.readPackedFloat(r.dasharray):s===6?r.dashoffset=o.readFloat():s===7?r.miterlimit=o.readFloat():s===8?r.opacity=o.readVarint():s===9?r.width=o.readFloat():s===10?r.linecap=o.readVarint():s===11&&(r.linejoin=o.readVarint())}function K9(s,r,o){s===1?r.transform=kx(o,o.readVarint()+o.pos):s===2?r.spread_method=o.readVarint():s===3?r.stops.push(hk(o,o.readVarint()+o.pos)):s===4?r.x1=o.readFloat():s===5?r.y1=o.readFloat():s===6?r.x2=o.readFloat():s===7&&(r.y2=o.readFloat())}function hk(s,r){return s.readFields(Y9,{offset:0,opacity:255,rgb_color:SS},r)}function Y9(s,r,o){s===1?r.offset=o.readFloat():s===2?r.opacity=o.readVarint():s===3&&(r.rgb_color=Nx(o.readVarint()))}function J9(s,r,o){s===1?r.transform=kx(o,o.readVarint()+o.pos):s===2?r.spread_method=o.readVarint():s===3?r.stops.push(hk(o,o.readVarint()+o.pos)):s===4?r.cx=o.readFloat():s===5?r.cy=o.readFloat():s===6?r.r=o.readFloat():s===7?r.fx=o.readFloat():s===8?r.fy=o.readFloat():s===9&&(r.fr=o.readFloat())}function Q9(s,r,o){s===1?r.transform=kx(o,o.readVarint()+o.pos):s===2?r.clip_path_idx=o.readVarint():s===3&&r.children.push(Dx(o,o.readVarint()+o.pos))}function e7(s,r,o){s===1?r.left=r.top=o.readFloat():s===2?r.width=r.height=o.readFloat():s===3?r.top=o.readFloat():s===4?r.height=o.readFloat():s===5?r.mask_type=o.readVarint():s===6?r.mask_idx=o.readVarint():s===7&&r.children.push(Dx(o,o.readVarint()+o.pos))}class t7{static calculate(r={},o=[]){const u=new Map,h=new Map;if(Object.keys(r).length===0)return u;o.forEach((m=>{h.set(m.name,m.rgb_color||new cn(0,0,0))}));for(const[m,g]of Object.entries(r))h.has(m)?u.set(h.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return u}}function Jf(s,r=255,o){const u=r/255,h=s.toString(),m=o.has(h)?o.get(h).clone():s.clone();return m.a*=u,m.toString()}function n_(s,r){if(!mm()){const o=document.createElement("canvas");return o.width=s,o.height=r,o}return new OffscreenCanvas(s,r)}function r7(s,r){const o=t7.calculate(r.params,s.metadata?s.metadata.variables:[]),u=s.usvg_tree,h=u.width,m=u.height,g=r.transform?r.transform:new DOMMatrix,b=Math.max(1,Math.round(h*g.a)),S=Math.max(1,Math.round(m*g.d)),E=new DOMMatrix([b/h,0,0,S/m,0,0]),O=n_(b,S).getContext("2d");return ES(O,E,u,u,o),O.getImageData(0,0,b,S)}function ES(s,r,o,u,h){for(const m of u.children)dk(s,r,o,m,h)}function dk(s,r,o,u,h){u.group?(s.save(),(function(m,g,b,S,E){const O=S.mask_idx!=null?b.masks[S.mask_idx]:null,D=S.clip_path_idx!=null?b.clip_paths[S.clip_path_idx]:null;if(S.transform&&(g=Qf(S.transform).preMultiplySelf(g)),!(function(U,X,Q){return U.opacity!==255||X||Q})(S,D!=null,O!=null))return void ES(m,g,b,S,E);const N=n_(m.canvas.width,m.canvas.height),B=N.getContext("2d");ES(B,g,b,S,E),D&&vk(B,g,b,D),O&&xk(B,g,b,O,E),m.globalAlpha=S.opacity/255,m.drawImage(N,0,0)})(s,r,o,u.group,h),s.restore()):u.path&&(s.save(),(function(m,g,b,S,E){m.setTransform(g),S.paint_order===j9.PAINT_ORDER_FILL_AND_STROKE?(fk(m,b,S,E),mk(m,b,S,E)):(mk(m,b,S,E),fk(m,b,S,E))})(s,r,o,u.path,h),s.restore())}function fk(s,r,o,u){const h=o.fill;if(!h)return;const m=h.opacity/255;switch(s.save(),s.beginPath(),bk(o,s),h.paint){case"rgb_color":s.fillStyle=Jf(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const g=r.linear_gradients[h.linear_gradient_idx];g.transform&&s.setTransform(Qf(g.transform).preMultiplySelf(s.getTransform())),s.fillStyle=gk(s,g,m,u);break}case"radial_gradient_idx":{const g=r.radial_gradients[h.radial_gradient_idx];g.transform&&s.setTransform(Qf(g.transform).preMultiplySelf(s.getTransform())),s.fillStyle=_k(s,g,m,u)}}s.fill(pk(o)),s.restore()}function pk(s){return s.rule===TS.PATH_RULE_NON_ZERO?"nonzero":s.rule===TS.PATH_RULE_EVEN_ODD?"evenodd":void 0}function mk(s,r,o,u){const h=o.stroke;if(!h)return;const m=wk(o);s.lineWidth=h.width,s.miterLimit=h.miterlimit,s.setLineDash(h.dasharray),s.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":s.strokeStyle=Jf(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":s.strokeStyle=gk(s,r.linear_gradients[h.linear_gradient_idx],g,u,!0);break;case"radial_gradient_idx":s.strokeStyle=_k(s,r.radial_gradients[h.radial_gradient_idx],g,u,!0)}switch(h.linejoin){case Rx.LINE_JOIN_MITER_CLIP:case Rx.LINE_JOIN_MITER:s.lineJoin="miter";break;case Rx.LINE_JOIN_ROUND:s.lineJoin="round";break;case Rx.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(h.linecap){case AS.LINE_CAP_BUTT:s.lineCap="butt";break;case AS.LINE_CAP_ROUND:s.lineCap="round";break;case AS.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(m)}function gk(s,r,o,u,h=!1){if(r.stops.length===1){const N=r.stops[0];return Jf(N.rgb_color,N.opacity*o,u)}const{x1:m,y1:g,x2:b,y2:S}=r;let E=new DOMPoint(m,g),O=new DOMPoint(b,S);if(h){const N=Qf(r.transform);E=N.transformPoint(E),O=N.transformPoint(O)}const D=s.createLinearGradient(E.x,E.y,O.x,O.y);for(const N of r.stops)D.addColorStop(N.offset,Jf(N.rgb_color,N.opacity*o,u));return D}function _k(s,r,o,u,h=!1){if(r.stops.length===1){const ee=r.stops[0];return Jf(ee.rgb_color,ee.opacity*o,u)}const m=Qf(r.transform),{fx:g,fy:b,fr:S,cx:E,cy:O,r:D}=r;let N=new DOMPoint(g,b),B=new DOMPoint(E,O),U=S,X=D;if(h){N=m.transformPoint(N),B=m.transformPoint(B);const ee=(m.a+m.d)/2;U=S*ee,X=r.r*ee}const Q=s.createRadialGradient(N.x,N.y,U,B.x,B.y,X);for(const ee of r.stops)Q.addColorStop(ee.offset,Jf(ee.rgb_color,ee.opacity*o,u));return Q}function yk(s,r,o,u){const h=u.transform?Qf(u.transform).preMultiplySelf(r):r,m=n_(s.canvas.width,s.canvas.height),g=m.getContext("2d");for(const S of u.children)if(S.group)yk(g,h,o,S.group);else if(S.path){const E=S.path,O=new Path2D;O.addPath(wk(E),h),g.fill(O,pk(E))}const b=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;b&&vk(g,h,o,b),s.globalCompositeOperation="source-over",s.drawImage(m,0,0)}function vk(s,r,o,u){const h=n_(s.canvas.width,s.canvas.height);yk(h.getContext("2d"),r,o,u),s.globalCompositeOperation="destination-in",s.drawImage(h,0,0)}function xk(s,r,o,u,h){if(u.children.length===0)return;const m=u.mask_idx!=null?o.masks[u.mask_idx]:null;m&&xk(s,r,o,m,h);const g=s.canvas.width,b=s.canvas.height,S=n_(g,b),E=S.getContext("2d"),O=u.width,D=u.height,N=u.left,B=u.top,U=new Path2D,X=new Path2D;X.rect(N,B,O,D),U.addPath(X,r),E.clip(U);for(const ue of u.children)dk(E,r,o,ue,h);const Q=E.getImageData(0,0,g,b),ee=Q.data;if(u.mask_type===lk.MASK_TYPE_LUMINANCE)for(let ue=0;ue<ee.length;ue+=4)ee[ue+3]=ee[ue+3]/255*(.2126*ee[ue]+.7152*ee[ue+1]+.0722*ee[ue+2]);E.putImageData(Q,0,0),s.globalCompositeOperation="destination-in",s.drawImage(S,0,0)}function Qf(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function bk(s,r){const o=s.step;let u=s.diffs[0]*o,h=s.diffs[1]*o;r.moveTo(u,h);for(let m=0,g=2;m<s.commands.length;m++)switch(s.commands[m]){case r_.PATH_COMMAND_MOVE:u+=s.diffs[g++]*o,h+=s.diffs[g++]*o,r.moveTo(u,h);break;case r_.PATH_COMMAND_LINE:u+=s.diffs[g++]*o,h+=s.diffs[g++]*o,r.lineTo(u,h);break;case r_.PATH_COMMAND_QUAD:{const b=u+s.diffs[g++]*o,S=h+s.diffs[g++]*o;u=b+s.diffs[g++]*o,h=S+s.diffs[g++]*o,r.quadraticCurveTo(b,S,u,h);break}case r_.PATH_COMMAND_CUBIC:{const b=u+s.diffs[g++]*o,S=h+s.diffs[g++]*o,E=b+s.diffs[g++]*o,O=S+s.diffs[g++]*o;u=E+s.diffs[g++]*o,h=O+s.diffs[g++]*o,r.bezierCurveTo(b,S,E,O,u,h);break}case r_.PATH_COMMAND_CLOSE:r.closePath()}return r}function wk(s){return bk(s,new Path2D)}class Lx{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const o=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,o),o}put(r,o){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,o)}delete(r){this.cache.delete(r)}}Ut(Lx,"LRUCache");class PS{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new eo(r,r.data)}getFromCache(r,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new Lx(150)),this.cacheMap.get(u).get(cu(r.toString(),o))}setInCache(r,o,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Lx(150));const m=this.cacheDependenciesMap.get(h),g=cu(r.id.toString(),u);m.get(g)||m.set(g,new Set);const b=this.cacheMap.get(h),S=r.toString();m.get(g).add(S),b.put(cu(r.toString(),u),o)}removeImagesFromCacheByIds(r,o,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),m=this.cacheDependenciesMap.get(u);for(const g of r){const b=cu(g.toString(),o);if(m.has(b)){for(const S of m.get(b))h.delete(S);m.delete(b)}}}rasterize(r,o,u,h,m=r7){const g=this.getFromCache(r,u,h);if(g)return g.clone();const b=m(o.icon,r.options),S=PS._getImage(b);return this.setInCache(r,S,u,h),S.clone()}}class Sk{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,o){const u=this.toIdx(r,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,o){return this.leaves[this.toIdx(r,o)]}toIdx(r,o){return o*this.size+r}}function Tk(s,r,o,u){let h=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(o[g]<s[g]||o[g]>r[g])return null}else{const b=1/u[g];let S=(s[g]-o[g])*b,E=(r[g]-o[g])*b;if(S>E){const O=S;S=E,E=O}if(S>h&&(h=S),E<m&&(m=E),h>m)return null}return h}function Ak(s,r,o,u,h,m,g,b,S,E,O){const D=u-s,N=h-r,B=m-o,U=g-s,X=b-r,Q=S-o,ee=O[1]*Q-O[2]*X,ue=O[2]*U-O[0]*Q,he=O[0]*X-O[1]*U,pe=D*ee+N*ue+B*he;if(Math.abs(pe)<1e-15)return null;const Ae=1/pe,Ee=E[0]-s,Oe=E[1]-r,De=E[2]-o,Le=(Ee*ee+Oe*ue+De*he)*Ae;if(Le<0||Le>1)return null;const ct=Oe*B-De*N,Ue=De*D-Ee*B,ut=Ee*N-Oe*D,_t=(O[0]*ct+O[1]*Ue+O[2]*ut)*Ae;return _t<0||Le+_t>1?null:(U*ct+X*Ue+Q*ut)*Ae}function Ek(s,r,o){return(s-r)/(o-r)}function Pk(s,r,o,u,h,m,g,b,S){const E=1<<o,O=m-u,D=g-h,N=(s+1)/E*O+u,B=(r+0)/E*D+h,U=(r+1)/E*D+h;b[0]=(s+0)/E*O+u,b[1]=B,S[0]=N,S[1]=U}class Ik{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=(function(m){const g=Math.ceil(Math.log2(m.dim/8)),b=[];let S=Math.ceil(Math.pow(2,g));const E=1/S,O=(B,U,X,Q,ee)=>{const ue=Q?1:0,he=(B+1)*X-ue,pe=U*X,Ae=(U+1)*X-ue;ee[0]=B*X,ee[1]=pe,ee[2]=he,ee[3]=Ae};let D=new Sk(S);const N=[];for(let B=0;B<S*S;B++){O(B%S,Math.floor(B/S),E,!1,N);const U=Au(N[0],N[1],m),X=Au(N[2],N[1],m),Q=Au(N[2],N[3],m),ee=Au(N[0],N[3],m);D.minimums.push(Math.min(U,X,Q,ee)),D.maximums.push(Math.max(U,X,Q,ee)),D.leaves.push(1)}for(b.push(D),S/=2;S>=1;S/=2){const B=b[b.length-1];D=new Sk(S);for(let U=0;U<S*S;U++){O(U%S,Math.floor(U/S),2,!0,N);const X=B.getElevation(N[0],N[1]),Q=B.getElevation(N[2],N[1]),ee=B.getElevation(N[2],N[3]),ue=B.getElevation(N[0],N[3]),he=B.isLeaf(N[0],N[1]),pe=B.isLeaf(N[2],N[1]),Ae=B.isLeaf(N[2],N[3]),Ee=B.isLeaf(N[0],N[3]),Oe=Math.min(X.min,Q.min,ee.min,ue.min),De=Math.max(X.max,Q.max,ee.max,ue.max),Le=he&&pe&&Ae&&Ee;D.maximums.push(De),D.minimums.push(Oe),D.leaves.push(De-Oe<=5&&Le?1:0)}b.push(D)}return b})(this.dem),u=o.length-1,h=o[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(r,o,u,h,m,g,b=1){return Tk([r,o,-100],[u,h,this.maximums[0]*b],m,g)}raycast(r,o,u,h,m,g,b=1){if(!this.nodeCount)return null;const S=this.raycastRoot(r,o,u,h,m,g,b);if(S==null)return null;const E=[],O=[],D=[],N=[],B=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:U,t:X,nodex:Q,nodey:ee,depth:ue}=B.pop();if(this.leaves[U]){Pk(Q,ee,ue,r,o,u,h,D,N);const pe=1<<ue,Ae=(Q+0)/pe,Ee=(Q+1)/pe,Oe=(ee+0)/pe,De=(ee+1)/pe,Le=Au(Ae,Oe,this.dem)*b,ct=Au(Ee,Oe,this.dem)*b,Ue=Au(Ee,De,this.dem)*b,ut=Au(Ae,De,this.dem)*b,_t=Ak(D[0],D[1],Le,N[0],D[1],ct,N[0],N[1],Ue,m,g),ht=Ak(N[0],N[1],Ue,D[0],N[1],ut,D[0],D[1],Le,m,g),ft=Math.min(_t!==null?_t:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(ft!==Number.MAX_VALUE)return ft;{const bt=rr([],m,g,X);if(Ck(Le,ct,ut,Ue,Ek(bt[0],D[0],N[0]),Ek(bt[1],D[1],N[1]))>=bt[2])return X}continue}let he=0;for(let pe=0;pe<this._siblingOffset.length;pe++){Pk((Q<<1)+this._siblingOffset[pe][0],(ee<<1)+this._siblingOffset[pe][1],ue+1,r,o,u,h,D,N),D[2]=-100,N[2]=this.maximums[this.childOffsets[U]+pe]*b;const Ae=Tk(D,N,m,g);if(Ae!=null){const Ee=Ae;E[pe]=Ee;let Oe=!1;for(let De=0;De<he&&!Oe;De++)Ee>=E[O[De]]&&(O.splice(De,0,pe),Oe=!0);Oe||(O[he]=pe),he++}}for(let pe=0;pe<he;pe++){const Ae=O[pe];B.push({idx:this.childOffsets[U]+Ae,t:E[Ae],nodex:(Q<<1)+this._siblingOffset[Ae][0],nodey:(ee<<1)+this._siblingOffset[Ae][1],depth:ue+1})}}return null}_addNode(r,o,u){return this.minimums.push(r),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,o,u,h,m){if(r[h].isLeaf(o,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=h-1,b=r[g];let S=0,E=0;for(let O=0;O<this._siblingOffset.length;O++){const D=2*o+this._siblingOffset[O][0],N=2*u+this._siblingOffset[O][1],B=b.getElevation(D,N),U=b.isLeaf(D,N),X=this._addNode(B.min,B.max,U);U&&(S|=1<<O),E||(E=X)}for(let O=0;O<this._siblingOffset.length;O++)S&1<<O||this._construct(r,2*o+this._siblingOffset[O][0],2*u+this._siblingOffset[O][1],g,E+O)}}function Ck(s,r,o,u,h,m){return lr(lr(s,o,m),lr(r,u,m),h)}function Au(s,r,o){const u=o.dim,h=Ie(s*u-.5,0,u-1),m=Ie(r*u-.5,0,u-1),g=Math.floor(h),b=Math.floor(m),S=Math.min(g+1,u-1),E=Math.min(b+1,u-1);return Ck(o.get(g,b),o.get(S,b),o.get(g,E),o.get(S,E),h-g,m-b)}const n7={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function i7(s,r,o){return(256*s*256+256*r+o)/10-1e4}function o7(s,r,o){return 256*s+r+o/256-32768}class jx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,o,u,h=!1){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Vr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const m=this.dim=o.height-2,g=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let S=0;S<m;S++)g[this._idx(-1,S)]=g[this._idx(0,S)],g[this._idx(m,S)]=g[this._idx(m-1,S)],g[this._idx(S,-1)]=g[this._idx(S,0)],g[this._idx(S,m)]=g[this._idx(S,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}const b=u==="terrarium"?o7:i7;for(let S=0;S<g.length;++S){const E=4*S;this.floatView[S]=b(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=Wa.now()}_buildQuadTree(){this._tree=new Ik(this)}get(r,o,u=!1){u&&(r=Ie(r,-1,this.dim),o=Ie(o,-1,this.dim));const h=this._idx(r,o);return this.floatView[h]}set(r,o,u){const h=this._idx(r,o),m=this.floatView[h];return this.floatView[h]=u,u-m}static getUnpackVector(r){return n7[r]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}static pack(r,o){const u=[0,0,0,0],h=jx.getUnpackVector(o);let m=Math.floor((r+h[3])/h[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new wM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,o,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,m=o*this.dim+this.dim,g=u*this.dim,b=u*this.dim+this.dim;switch(o){case-1:h=m-1;break;case 1:m=h+1}switch(u){case-1:g=b-1;break;case 1:b=g+1}const S=-o*this.dim,E=-u*this.dim;for(let O=g;O<b;O++)for(let D=h;D<m;D++){const N=4*this._idx(D,O),B=4*this._idx(D+S,O+E);this.pixels[N+0]=r.pixels[B+0],this.pixels[N+1]=r.pixels[B+1],this.pixels[N+2]=r.pixels[B+2],this.pixels[N+3]=r.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function a7(s,r,o){s===1?r.headerLength=o.readFixed32():s===2?r.x=o.readVarint():s===3?r.y=o.readVarint():s===4?r.z=o.readVarint():s===5&&r.layers.push((function(u,h){return u.readFields(h7,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(o,o.readVarint()+o.pos))}function s7(s,r,o){s===1?(r.delta_filter=(function(u,h){return u.readFields(l7,{blockSize:0},h)})(o,o.readVarint()+o.pos),r.filter="delta_filter"):s===2?(o.readVarint(),r.filter="zigzag_filter"):s===3?(o.readVarint(),r.filter="bitshuffle_filter"):s===4&&(o.readVarint(),r.filter="byteshuffle_filter")}function l7(s,r,o){s===1&&(r.blockSize=o.readVarint())}function c7(s,r,o){s===1?(o.readVarint(),r.codec="gzip_data"):s===2?(o.readVarint(),r.codec="jpeg_image"):s===3?(o.readVarint(),r.codec="webp_image"):s===4&&(o.readVarint(),r.codec="png_image")}function u7(s,r,o){let u=0,h=0;s===1?r.firstByte=o.readFixed64():s===2?r.lastByte=o.readFixed64():s===3?r.filters.push((function(m,g){return m.readFields(s7,{},g)})(o,o.readVarint()+o.pos)):s===4?r.codec=(function(m,g){return m.readFields(c7,{},g)})(o,o.readVarint()+o.pos):s===5?h=o.readFloat():s===6?u=o.readFloat():s===7?r.bands.push(o.readString()):s===8?r.offset=o.readDouble():s===9&&(r.scale=o.readDouble()),r.offset===0&&(r.offset=h),r.scale===0&&(r.scale=u)}function h7(s,r,o){s===1?r.version=o.readVarint():s===2?r.name=o.readString():s===3?r.units=o.readString():s===4?r.tileSize=o.readVarint():s===5?r.buffer=o.readVarint():s===6?r.pixelFormat=o.readVarint():s===7&&r.dataIndex.push((function(u,h){return u.readFields(u7,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(o,o.readVarint()+o.pos))}function d7(s,r,o){if(s===2)(function(u,h,m){u.readFields(f7,m,h)})(o,o.readVarint()+o.pos,r);else if(s===3)throw new Error("Not implemented")}function f7(s,r,o){if(s===1){let u=0;const h=o.readVarint()+o.pos;for(;o.pos<h;)r[u++]=o.readVarint()}}function p7(s,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let o=r[3];for(let u=2;u>=1;u--){const h=u===1?1:0,m=u===2?1:0;for(let g=0;g<r[0];g++){const b=r[1]*g;for(let S=h;S<r[1];S++){const E=r[2]*(S+b);for(let O=m;O<r[2];O++){const D=r[3]*(O+E);for(let N=0;N<r[3];N++){const B=D+N;s[B]+=s[B-o]}}}}o*=r[u]}return s}function m7(s){for(let r=0,o=s.length;r<o;r++)s[r]=s[r]>>>1^-(1&s[r]);return s}function g7(s,r){switch(r){case"uint32":return s;case"uint16":for(let o=0;o<s.length;o+=2){const u=s[o],h=s[o+1];s[o]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,s[o+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return s;case"uint8":for(let o=0;o<s.length;o+=4){const u=s[o],h=s[o+1],m=s[o+2],g=s[o+3];s[o+0]=(192&u)>>6|(192&h)>>4|(192&m)>>2|192&g,s[o+1]=(48&u)>>4|(48&h)>>2|48&m|(48&g)<<2,s[o+2]=(12&u)>>2|12&h|(12&m)<<2|(12&g)<<4,s[o+3]=3&u|(3&h)<<2|(3&m)<<4|(3&g)<<6}return s;default:throw new Error(`Invalid pixel format, "${r}"`)}}Ut(jx,"DEMData"),Ut(Ik,"DemMinMaxQuadTree",{omit:["dem"]});var Ma=Uint8Array,i_=Uint16Array,_7=Int32Array,Ok=new Ma([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Mk=new Ma([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),y7=new Ma([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rk=function(s,r){for(var o=new i_(31),u=0;u<31;++u)o[u]=r+=1<<s[u-1];var h=new _7(o[30]);for(u=1;u<30;++u)for(var m=o[u];m<o[u+1];++m)h[m]=m-o[u]<<5|u;return{b:o,r:h}},Dk=Rk(Ok,2),kk=Dk.b,v7=Dk.r;kk[28]=258,v7[258]=28;for(var x7=Rk(Mk,0).b,Nk=new i_(32768),Mi=0;Mi<32768;++Mi){var ep=(43690&Mi)>>1|(21845&Mi)<<1;Nk[Mi]=((65280&(ep=(61680&(ep=(52428&ep)>>2|(13107&ep)<<2))>>4|(3855&ep)<<4))>>8|(255&ep)<<8)>>1}var o_=function(s,r,o){for(var u=s.length,h=0,m=new i_(r);h<u;++h)s[h]&&++m[s[h]-1];var g,b=new i_(r);for(h=1;h<r;++h)b[h]=b[h-1]+m[h-1]<<1;g=new i_(1<<r);var S=15-r;for(h=0;h<u;++h)if(s[h])for(var E=h<<4|s[h],O=r-s[h],D=b[s[h]-1]++<<O,N=D|(1<<O)-1;D<=N;++D)g[Nk[D]>>S]=E;return g},a_=new Ma(288);for(Mi=0;Mi<144;++Mi)a_[Mi]=8;for(Mi=144;Mi<256;++Mi)a_[Mi]=9;for(Mi=256;Mi<280;++Mi)a_[Mi]=7;for(Mi=280;Mi<288;++Mi)a_[Mi]=8;var Lk=new Ma(32);for(Mi=0;Mi<32;++Mi)Lk[Mi]=5;var b7=o_(a_,9),w7=o_(Lk,5),IS=function(s){for(var r=s[0],o=1;o<s.length;++o)s[o]>r&&(r=s[o]);return r},Rs=function(s,r,o){var u=r/8|0;return(s[u]|s[u+1]<<8)>>(7&r)&o},CS=function(s,r){var o=r/8|0;return(s[o]|s[o+1]<<8|s[o+2]<<16)>>(7&r)},S7=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ds=function(s,r,o){var u=new Error(r||S7[s]);if(u.code=s,Error.captureStackTrace&&Error.captureStackTrace(u,Ds),!o)throw u;return u},T7=new Ma(0),A7=typeof TextDecoder<"u"&&new TextDecoder;try{A7.decode(T7,{stream:!0})}catch{}const E7={gzip_data:"gzip"};class ns extends Error{constructor(r){super(r),this.name="MRTError"}}const P7={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},jk={uint32:1,uint16:2,uint8:4},I7={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let OS;class zx{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const o=this.layers[r];if(!o)throw new ns(`Layer '${r}' not found`);return o}getHeaderLength(r){const o=new Uint8Array(r),u=new DataView(r);if(o[0]!==13)throw new ns("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const o=new Uint8Array(r),u=this.getHeaderLength(r);if(o.length<u)throw new ns(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const h=new OS(o.subarray(0,u)).readFields(a7,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new ns(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const m of h.layers)this.layers[m.name]=new zk(m,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const o=[],u=this.getLayer(r.layerName);for(let h of r.blockIndices){const m=u.dataIndex[h],g=m.firstByte-r.firstByte,b=m.lastByte-r.firstByte;if(u._blocksInProgress.has(h))continue;const S={layerName:u.name,firstByte:g,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(u.bandShape),buffer:u.buffer,codec:m.codec.codec,filters:m.filters.map((E=>E.filter))};u._blocksInProgress.add(h),o.push(S)}return new Fk(o,(()=>{o.forEach((h=>u._blocksInProgress.delete(h.blockIndex)))}),((h,m)=>{if(o.forEach((g=>u._blocksInProgress.delete(g.blockIndex))),h)throw h;m.forEach((g=>{this.getLayer(g.layerName).processDecodedData(g)}))}))}}class zk{constructor({version:r,name:o,units:u,tileSize:h,pixelFormat:m,buffer:g,dataIndex:b},S){if(this.version=r,this.version!==1)throw new ns(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=o,this.units=u,this.tileSize=h,this.buffer=g,this.pixelFormat=P7[m],this.dataIndex=b,this.bandShape=[h+2*g,h+2*g,jk[this.pixelFormat]],this._decodedBlocks=new Lx(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return jk[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:r})=>r)).flat()}processDecodedData(r){const o=r.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,r.data)}getBlockForBand(r){let o=0;switch(typeof r){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[m,g]of h.bands.entries())if(g===r)return{bandIndex:o+m,blockIndex:u,blockBandIndex:m};o+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(r>=o&&r<o+h.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-o};o+=h.bands.length}break;default:throw new ns(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let o=1/0,u=-1/0;const h=[],m=new Set;for(const g of r){const{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new ns(`Invalid band: ${JSON.stringify(g)}`);const S=this.dataIndex[b];h.includes(b)||h.push(b),m.add(b),o=Math.min(o,S.firstByte),u=Math.max(u,S.lastByte)}if(m.size>this.cacheSize)throw new ns(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:h}}hasBand(r){const{blockIndex:o}=this.getBlockForBand(r);return o>=0}hasDataForBand(r){const{blockIndex:o}=this.getBlockForBand(r);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(r){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(r);if(o<0)throw new ns(`Band not found: ${JSON.stringify(r)}`);const h=this._decodedBlocks.get(o.toString());if(!h)throw new ns(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[o],g=this.bandShape.reduce(((E,O)=>E*O),1),b=u*g,S=h.subarray(b,b+g);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}zx.setPbf=function(s){OS=s};class Fk{constructor(r,o,u){this.tasks=r,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,o){this._finalized||(this._onComplete(r,o),this._finalized=!0)}}zx.performDecoding=function(s,r){const o=new Uint8Array(s);return Promise.all(r.tasks.map((u=>{const{layerName:h,firstByte:m,lastByte:g,pixelFormat:b,blockShape:S,blockIndex:E,filters:O,codec:D}=u,N=o.subarray(m,g+1),B=new Uint32Array(S[0]*S[1]*S[2]);let U;if(D!=="gzip_data")throw new ns(`Unhandled codec: ${D}`);return U=(function(X,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve(((pe=(function(Oe){Oe[0]==31&&Oe[1]==139&&Oe[2]==8||Ds(6,"invalid gzip data");var De=Oe[3],Le=10;4&De&&(Le+=2+(Oe[10]|Oe[11]<<8));for(var ct=(De>>3&1)+(De>>4&1);ct>0;ct-=!Oe[Le++]);return Le+(2&De)})(he=X))+8>he.length&&Ds(6,"invalid gzip data"),(function(Oe,De,Le,ct){var Ue=Oe.length;if(!Ue||De.f&&!De.l)return Le||new Ma(0);var ut=!Le,_t=ut||De.i!=2,ht=De.i;ut&&(Le=new Ma(3*Ue));var ft,bt,st=function(Rn){var Dn=Le.length;if(Rn>Dn){var Pn=new Ma(Math.max(2*Dn,Rn));Pn.set(Le),Le=Pn}},mt=De.f||0,Ke=De.p||0,Ge=De.b||0,St=De.l,vt=De.d,Qt=De.m,zt=De.n,Gt=8*Ue;do{if(!St){mt=Rs(Oe,Ke,1);var Ct=Rs(Oe,Ke+1,3);if(Ke+=3,!Ct){var Yt=Oe[(ge=4+((Ke+7)/8|0))-4]|Oe[ge-3]<<8,_r=ge+Yt;if(_r>Ue){ht&&Ds(0);break}_t&&st(Ge+Yt),Le.set(Oe.subarray(ge,_r),Ge),De.b=Ge+=Yt,De.p=Ke=8*_r,De.f=mt;continue}if(Ct==1)St=b7,vt=w7,Qt=9,zt=5;else if(Ct==2){var kt=Rs(Oe,Ke,31)+257,Zt=Rs(Oe,Ke+10,15)+4,cr=kt+Rs(Oe,Ke+5,31)+1;Ke+=14;for(var xr=new Ma(cr),kr=new Ma(19),Sr=0;Sr<Zt;++Sr)kr[y7[Sr]]=Rs(Oe,Ke+3*Sr,7);Ke+=3*Zt;var $t=IS(kr),wr=(1<<$t)-1,Wr=o_(kr,$t);for(Sr=0;Sr<cr;){var ge,_e=Wr[Rs(Oe,Ke,wr)];if(Ke+=15&_e,(ge=_e>>4)<16)xr[Sr++]=ge;else{var Xe=0,lt=0;for(ge==16?(lt=3+Rs(Oe,Ke,3),Ke+=2,Xe=xr[Sr-1]):ge==17?(lt=3+Rs(Oe,Ke,7),Ke+=3):ge==18&&(lt=11+Rs(Oe,Ke,127),Ke+=7);lt--;)xr[Sr++]=Xe}}var Dt=xr.subarray(0,kt),Rt=xr.subarray(kt);Qt=IS(Dt),zt=IS(Rt),St=o_(Dt,Qt),vt=o_(Rt,zt)}else Ds(1);if(Ke>Gt){ht&&Ds(0);break}}_t&&st(Ge+131072);for(var Vt=(1<<Qt)-1,ir=(1<<zt)-1,Nr=Ke;;Nr=Ke){var Lr=(Xe=St[CS(Oe,Ke)&Vt])>>4;if((Ke+=15&Xe)>Gt){ht&&Ds(0);break}if(Xe||Ds(2),Lr<256)Le[Ge++]=Lr;else{if(Lr==256){Nr=Ke,St=null;break}var Rr=Lr-254;Lr>264&&(Rr=Rs(Oe,Ke,(1<<(Mr=Ok[Sr=Lr-257]))-1)+kk[Sr],Ke+=Mr);var fn=vt[CS(Oe,Ke)&ir],Vn=fn>>4;if(fn||Ds(3),Ke+=15&fn,Rt=x7[Vn],Vn>3){var Mr=Mk[Vn];Rt+=CS(Oe,Ke)&(1<<Mr)-1,Ke+=Mr}if(Ke>Gt){ht&&Ds(0);break}_t&&st(Ge+131072);var On=Ge+Rr;if(Ge<Rt){var gn=0-Rt,en=Math.min(Rt,On);for(gn+Ge<0&&Ds(3);Ge<en;++Ge)Le[Ge]=(void 0)[gn+Ge]}for(;Ge<On;++Ge)Le[Ge]=Le[Ge-Rt]}}De.l=St,De.p=Nr,De.b=Ge,De.f=mt,St&&(mt=1,De.m=Qt,De.d=vt,De.n=zt)}while(!mt);return Ge!=Le.length&&ut?(ft=Le,((bt=Ge)==null||bt>ft.length)&&(bt=ft.length),new Ma(ft.subarray(0,bt))):Le.subarray(0,Ge)})(he.subarray(pe,-8),{i:2},new Ma(((ee=he)[(ue=ee.length)-4]|ee[ue-3]<<8|ee[ue-2]<<16|ee[ue-1]<<24)>>>0))));var ee,ue,he,pe;const Ae=E7[Q];if(!Ae)throw new Error(`Unhandled codec: ${Q}`);const Ee=new globalThis.DecompressionStream(Ae);return new Response(new Blob([X]).stream().pipeThrough(Ee)).arrayBuffer().then((Oe=>new Uint8Array(Oe)))})(N,D).then((X=>((function(Q,ee){Q.readFields(d7,ee)})(new OS(X),B),new I7[b](B.buffer)))),U.then((X=>{for(let Q=O.length-1;Q>=0;Q--)switch(O[Q]){case"delta_filter":p7(X,S);break;case"zigzag_filter":m7(X);break;case"bitshuffle_filter":g7(X,b);break;default:throw new ns(`Unhandled filter "${O[Q]}"`)}return{layerName:h,blockIndex:E,data:X}})).catch((X=>{throw X}))})))},Ut(Fk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ut(zx,"MapboxRasterTile"),Ut(zk,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Bk{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const u=r[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const C7=["id","tile","layer","source","sourceLayer","state"];class tp{constructor(r,o,u,h,m){this.type="Feature",this._vectorTileFeature=r,this._z=o,this._x=u,this._y=h,this.properties=r.properties,this.id=m}clone(){const r=new tp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of C7)this[o]!==void 0&&(r[o]=this[o]);return r}}class Uk{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Jl(Mt,16,0),this.featureIndexArray=new Fv,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,o,u,h,m,g=0,b=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,m,g);const E=this.grid;for(let O=0;O<o.length;O++){const D=o[O],N=[1/0,1/0,-1/0,-1/0];for(let B=0;B<D.length;B++){const U=D[B];N[0]=Math.min(N[0],U.x),N[1]=Math.min(N[1],U.y),N[2]=Math.max(N[2],U.x),N[3]=Math.max(N[3],U.y)}b!==0&&(N[0]-=b,N[1]-=b,N[2]+=b,N[3]+=b),N[0]<Mt&&N[1]<Mt&&N[2]>=0&&N[3]>=0&&E.insert(S,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gr(new dx(this.rawTileData)).layers,this.sourceLayerCoder=new Bk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,o){const{tilespaceGeometry:u,transform:h,tileTransform:m,pixelPosMatrix:g,availableImages:b,worldview:S}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const E=u.bufferedTilespaceBounds,O=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,((U,X,Q,ee)=>fi(u.bufferedTilespaceGeometry,U,X,Q,ee)));O.sort(O7);let D=null;h.elevation&&O.length>0&&(D=Yf.create(h.elevation,this.tileID));const N={};let B;for(let U=0;U<O.length;U++){const X=O[U];if(X===B)continue;B=X;const Q=this.featureIndexArray.get(X);let ee=null;this.is3DTile?this.loadMatchingModelFeature(N,Q,r,u,h,S):this.loadMatchingFeature(N,Q,r,b,S,((ue,he,pe,Ae=0)=>(ee||(ee=Lt(ue,this.tileID.canonical,m)),he.queryIntersectsFeature(u,ue,pe,ee,this.z,h,g,D,Ae))))}return N}loadMatchingFeature(r,o,u,h,m,g){const{featureIndex:b,bucketIndex:S,sourceLayerIndex:E,layoutVertexArrayOffset:O}=o,D=this.bucketLayerIDs[S],N=u.layers,B=Object.keys(N);if(B.length&&!Gr(B,D))return;const U=u.sourceCache,X=this.sourceLayerCoder.decode(E),Q=this.vtLayers[X].feature(b),ee=this.getId(Q,X);for(let ue=0;ue<D.length;ue++){const he=D[ue];if(!N[he])continue;const{styleLayer:pe,targets:Ae}=N[he];let Ee={};ee!==void 0&&(Ee=U.getFeatureState(pe.sourceLayer,ee));const Oe=!g||g(Q,pe,Ee,O);if(!Oe)continue;const De=new tp(Q,this.z,this.x,this.y,ee);De.tile=this.tileID.canonical,De.state=Ee;let Le=this.serializedLayersCache.get(he);Le||(Le=pe.serialize(),Le.id=he,this.serializedLayersCache.set(he,Le)),De.source=Le.source,De.sourceLayer=Le["source-layer"],De.layer=Object.assign({},Le),De.layer.paint=Vk(Le.paint,pe.paint,Q,Ee,h),De.layer.layout=Vk(Le.layout,pe.layout,Q,Ee,h);let ct=!1;for(const Ue of Ae){this.updateFeatureProperties(De,Ue);const{filter:ut}=Ue;if(ut){if(Q.properties=De.properties,ut.needGeometry){const _t=xt(Q,!0);if(!ut.filter(new Cn(this.tileID.overscaledZ,{worldview:m}),_t,this.tileID.canonical))continue}else if(!ut.filter(new Cn(this.tileID.overscaledZ,{worldview:m}),Q))continue}ct=!0,Ue.targetId&&this.addFeatureVariant(De,Ue)}ct&&this.appendToResult(r,he,b,De,Oe)}}loadMatchingModelFeature(r,o,u,h,m,g){const{featureIndex:b,bucketIndex:S}=o,E=this.bucketLayerIDs[S],O=u.layers,D=Object.keys(O);if(!D.length||Gr(D,E))for(let N=0;N<E.length;N++){const B=E[N],{styleLayer:U,targets:X}=O[B];if(U.type!=="model")continue;const Q=h.tile,ee=Q.getBucket(U);if(!(ee&&ee instanceof Mx))continue;const ue=N9(ee,b,h,m);if(!ue)continue;const{z:he,x:pe,y:Ae}=Q.tileID.canonical,{feature:Ee,intersectionZ:Oe,position:De}=ue;let Le={};Ee.id!==void 0&&(Le=u.sourceCache.getFeatureState(U.sourceLayer,Ee.id));const ct=new tp({},he,pe,Ae,Ee.id);ct.tile=this.tileID.canonical,ct.state=Le,ct.properties=Ee.properties,ct.geometry={type:"Point",coordinates:[De.lng,De.lat]};let Ue=this.serializedLayersCache.get(B);Ue||(Ue=U.serialize(),Ue.id=B,this.serializedLayersCache.set(B,Ue)),ct.source=Ue.source,ct.sourceLayer=Ue["source-layer"],ct.layer=Object.assign({},Ue);let ut=!1;for(const _t of X){this.updateFeatureProperties(ct,_t);const{filter:ht}=_t;if(ht){if(Ee.properties=ct.properties,ht.needGeometry){if(!ht.filter(new Cn(this.tileID.overscaledZ,{worldview:g}),Ee,this.tileID.canonical))continue}else if(!ht.filter(new Cn(this.tileID.overscaledZ,{worldview:g}),Ee))continue}ut=!0,_t.targetId&&this.addFeatureVariant(ct,_t)}ut&&this.appendToResult(r,B,b,ct,Oe)}}updateFeatureProperties(r,o,u){if(o.properties){const h={};for(const m in o.properties){const g=o.properties[m].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);g!=null&&(h[m]=g)}r.properties=h}}addFeatureVariant(r,o,u){const h={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(h.properties=r.properties),r.variants=r.variants||{},r.variants[o.targetId]=r.variants[o.targetId]||[],r.variants[o.targetId].push(h)}appendToResult(r,o,u,h,m){let g=r[o];g===void 0&&(g=r[o]=[]),g.push({featureIndex:u,feature:h,intersectionZ:m})}lookupSymbolFeatures(r,o,u,h,m,g){const b={};this.loadVTLayers();for(const S of r)this.loadMatchingFeature(b,{bucketIndex:o,sourceLayerIndex:u,featureIndex:S,layoutVertexArrayOffset:0},h,m,g);return b}loadFeature(r){const{featureIndex:o,sourceLayerIndex:u}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),m=this.vtFeatures[h];if(m[o])return m[o];const g=this.vtLayers[h].feature(o);return m[o]=g,g}hasLayer(r){for(const o of this.bucketLayerIDs)for(const u of o)if(r===u)return!0;return!1}getId(r,o){let u=r.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const m=Ka(h);if(m.result!=="success"){const g=m.value.map((b=>`${b.key}: ${b.message}`)).join(", ");return void Vr(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ws),u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function Vk(s,r,o,u,h){return yr(s,((m,g)=>{const b=r instanceof nc?r.get(g):null;return b&&b.evaluate?b.evaluate(o,u,void 0,h):b}))}function O7(s,r){return r-s}Ut(Uk,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const $k=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class MS{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=$k[15&u];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new MS(b,g,m,r)}constructor(r,o=64,u=Float64Array,h){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const m=$k.indexOf(this.ArrayType),g=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+S,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+S),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+S,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=o,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return RS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:b}=this,S=[0,m.length-1,0],E=[];for(;S.length;){const O=S.pop()||0,D=S.pop()||0,N=S.pop()||0;if(D-N<=b){for(let Q=N;Q<=D;Q++){const ee=g[2*Q],ue=g[2*Q+1];ee>=r&&ee<=u&&ue>=o&&ue<=h&&E.push(m[Q])}continue}const B=N+D>>1,U=g[2*B],X=g[2*B+1];U>=r&&U<=u&&X>=o&&X<=h&&E.push(m[B]),(O===0?r<=U:o<=X)&&(S.push(N),S.push(B-1),S.push(1-O)),(O===0?u>=U:h>=X)&&(S.push(B+1),S.push(D),S.push(1-O))}return E}within(r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:g}=this,b=[0,h.length-1,0],S=[],E=u*u;for(;b.length;){const O=b.pop()||0,D=b.pop()||0,N=b.pop()||0;if(D-N<=g){for(let Q=N;Q<=D;Q++)Gk(m[2*Q],m[2*Q+1],r,o)<=E&&S.push(h[Q]);continue}const B=N+D>>1,U=m[2*B],X=m[2*B+1];Gk(U,X,r,o)<=E&&S.push(h[B]),(O===0?r-u<=U:o-u<=X)&&(b.push(N),b.push(B-1),b.push(1-O)),(O===0?r+u>=U:o+u>=X)&&(b.push(B+1),b.push(D),b.push(1-O))}return S}}function RS(s,r,o,u,h,m){if(h-u<=o)return;const g=u+h>>1;qk(s,r,g,u,h,m),RS(s,r,o,u,g-1,1-m),RS(s,r,o,g+1,h,1-m)}function qk(s,r,o,u,h,m){for(;h>u;){if(h-u>600){const E=h-u+1,O=o-u+1,D=Math.log(E),N=.5*Math.exp(2*D/3),B=.5*Math.sqrt(D*N*(E-N)/E)*(O-E/2<0?-1:1);qk(s,r,o,Math.max(u,Math.floor(o-O*N/E+B)),Math.min(h,Math.floor(o+(E-O)*N/E+B)),m)}const g=r[2*o+m];let b=u,S=h;for(s_(s,r,u,o),r[2*h+m]>g&&s_(s,r,u,h);b<S;){for(s_(s,r,b,S),b++,S--;r[2*b+m]<g;)b++;for(;r[2*S+m]>g;)S--}r[2*u+m]===g?s_(s,r,u,S):(S++,s_(s,r,S,h)),S<=o&&(u=S+1),o<=S&&(h=S-1)}}function s_(s,r,o,u){DS(s,o,u),DS(r,2*o,2*u),DS(r,2*o+1,2*u+1)}function DS(s,r,o){const u=s[r];s[r]=s[o],s[o]=u}function Gk(s,r,o,u){const h=s-o,m=r-u;return h*h+m*m}i.$=Pm,i.A=Ta,i.B=cu,i.C=2,i.D=Uf,i.E=Ul,i.F=Wg,i.G=gD,i.H=Em,i.I=Jo,i.J=wf,i.K=mr,i.L=fh,i.M=hf,i.N=uf,i.O=Qm,i.P=wt,i.Q=tg,i.R=Id,i.S=ic,i.T=H1,i.U=Ka,i.V=Ox,i.W=rg,i.X=tu,i.Y=eu,i.Z=Yd,i._=bo,i.a=function(s){return ao.API_CDN_URL_REGEX.test(s)},i.a$=be,i.a0=dh,i.a1=wm,i.a2=Sf,i.a3=class extends Ox{},i.a4=df,i.a5=Jm,i.a6=Be,i.a7=function(s){const r=s.value;return r?dh(r)?xS(r,!0)?[]:[new Ox(s.key,r,`invalid url "${r}"`)]:[new Ox(s.key,r,`string expected, "${mr(r)}" found`)]:[]},i.a8=Sv,i.a9=Xn,i.aA=Ie,i.aB=Y,i.aC=Ni,i.aD=f,i.aE=zi,i.aF=me,i.aG=$e,i.aH=function(s,r){const o={};for(let u=0;u<r.length;u++){const h=r[u];h in s&&(o[h]=s[h])}return o},i.aI=oe,i.aJ=we,i.aK=class{constructor(s){this.entries={},this.scheduler=s}request(s,r,o,u){const h=this.entries[s]=this.entries[s]||{callbacks:[]};if(h.result){const[m,g]=h.result;return this.scheduler?this.scheduler.add((()=>{u(m,g)}),r):u(m,g),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=o(((m,g)=>{h.result=[m,g];for(const b of h.callbacks)this.scheduler?this.scheduler.add((()=>{b(m,g)}),r):b(m,g);setTimeout((()=>delete this.entries[s]),3e3)}))),()=>{h.result||(h.callbacks=h.callbacks.filter((m=>m!==u)),h.callbacks.length||(h.cancel(),delete this.entries[s]))}}},i.aL=function(s,r,o){const u=JSON.stringify(s.request);return s.data&&(this.deduped.entries[u]={result:[null,s.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},(h=>{const m=Vc(s.request,((g,b,S,E)=>{g?h(g):b&&h(null,{vectorTile:o?void 0:new gr(new dx(b)),rawData:b,cacheControl:S,expires:E})}));return()=>{m.cancel(),h()}}),r)},i.aM=function(s){Ys++,Ys>bs&&(s.getActor().send("enforceCacheSizeLimit",xa),Ys=0)},i.aN=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log2(s)))},i.aO=To,i.aP=GD,i.aQ=YD,i.aR=Z,i.aS=qD,i.aT=function(s,r){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){r(null,o)};for(let u=0;u<s.length;u++){const h=document.createElement("source");Wy(s[u])||(o.crossOrigin="Anonymous"),h.src=s[u],o.appendChild(h)}return{cancel:()=>{}}},i.aU=Ug,i.aV=function(s){return fetch(s).then((r=>r.arrayBuffer())).then((r=>bR(r,0,s)))},i.aW=CR,i.aX=class{constructor(s,r,o,u){this.id=s,this.position=r!=null?new Z(r[0],r[1]):new Z(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new hr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,r){if(Y(s.matrix,r,s.matrix),s.meshes)for(const o of s.meshes){const u=hr.applyTransformFast(o.aabb,s.matrix);this.aabb.encapsulate(u)}if(s.children)for(const o of s.children)this._applyTransformations(o,s.matrix)}computeBoundsAndApplyParent(){const s=j([]);for(const r of this.nodes)this._applyTransformations(r,s)}computeModelMatrix(s,r,o,u,h,m,g=!1){PR(this.matrix,this,s.transform,this.position,r,o,u,h,m,g)}upload(s){if(!this.uploaded){for(const r of this.nodes)X1(r,s);for(const r of this.nodes)hx(r);this.uploaded=!0}}destroy(){for(const s of this.nodes)K1(s)}},i.aY=pr,i.aZ=Kg,i.a_=Se,i.aa=Tt,i.ab=class{constructor(s){this.specification=s}possiblyEvaluate(s,r){return xi(s.expression.evaluate(r))}interpolate(s,r,o){return{x:lr(s.x,r.x,o),y:lr(s.y,r.y,o),z:lr(s.z,r.z,o),azimuthal:lr(s.azimuthal,r.azimuthal,o),polar:lr(s.polar,r.polar,o)}}},i.ac=Cn,i.ad=sl,i.ae=et,i.af=or,i.ag=nt,i.ah=Ye,i.ai=nc,i.aj=yu,i.ak=lr,i.al=Mt,i.am=Tm,i.an=Fe,i.ao=cn,i.ap=class{constructor(s){this.specification=s}possiblyEvaluate(s,r){return(function([o,u]){const h=xi([1,o,u]);return{x:h.x,y:h.y,z:h.z}})(s.expression.evaluate(r))}interpolate(s,r,o){return{x:lr(s.x,r.x,o),y:lr(s.y,r.y,o),z:lr(s.z,r.z,o)}}},i.aq=function(s,r,o=0,u=!0){const h=new wt(o,o),m=s.sub(h),g=r.add(h),b=[m,new wt(g.x,m.y),g,new wt(m.x,g.y)];return u&&b.push(m.clone()),b},i.ar=function(s,r){const o=[];for(let u=0;u<s.length;u++){const h=ze(u-1,-1,s.length-1),m=ze(u+1,-1,s.length-1),g=s[u],b=s[m],S=s[h].sub(g).unit(),E=b.sub(g).unit(),O=E.angleWithSep(S.x,S.y),D=S.add(E).unit().mult(-1*r/Math.sin(O/2));o.push(g.add(D))}return o},i.as=OD,i.at=fi,i.au=function(s,r,o=0){return Je(((r.x-o)*s.scale-s.x)*Mt,(r.y*s.scale-s.y)*Mt,ve(r.z,r.y))},i.av=Zr,i.aw=Fr,i.ax=Qr,i.ay=UR,i.az=function(s){let r=1/0,o=1/0,u=-1/0,h=-1/0;for(const m of s)r=Math.min(r,m.x),o=Math.min(o,m.y),u=Math.max(u,m.x),h=Math.max(h,m.y);return{min:new wt(r,o),max:new wt(u,h)}},i.b=function(s){return ao.API_FONTS_REGEX.test(s)},i.b$=k1,i.b0=ac,i.b1=Oi,i.b2=pt,i.b3=bg,i.b4=Ex,i.b5=function(){Ya.isLoading()||Ya.isLoaded()||bf()!=="deferred"||Ql()},i.b6=Th,i.b7=xt,i.b8=tp,i.b9=sn,i.bA=j,i.bB=ae,i.bC=H,i.bD=function(s,r){const{x:o,y:u}=s.point,h=cM(o,u,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Y(h,h,b1(yl(r)))},i.bE=M,i.bF=bn,i.bG=function(s,r){var o=r[0]-s[0],u=r[1]-s[1],h=r[2]-s[2];return Math.sqrt(o*o+u*u+h*h)},i.bH=rr,i.bI=Dr,i.bJ=nr,i.bK=Hg,i.bL=aa,i.bM=sS,i.bN=function(s,r,o,u,h){const m=5*r+2;s.float32[m+0]=o,s.float32[m+1]=u,s.float32[m+2]=h},i.bO=Ax,i.bP=ya,i.bQ=ys,i.bR=Zs,i.bS=va,i.bT=ze,i.bU=function(s,r,o,u){var h=new I(4);return h[0]=s,h[1]=r,h[2]=o,h[3]=u,h},i.bV=ix,i.bW=na,i.bX=Gi,i.bY=BM,i.bZ=JD,i.b_=qM,i.ba=eS,i.bb=M1,i.bc=Lt,i.bd=dl,i.be=Rf,i.bf=nM,i.bg=Hn,i.bh=Ff,i.bi=yS,i.bj=function(s,r){const o=yu(r.zoom);if(o===0)return yl(s);const u=Wv(s),h=x1(u),m=me(u.getWest())*r.worldSize,g=me(u.getEast())*r.worldSize,b=we(u.getNorth())*r.worldSize,S=we(u.getSouth())*r.worldSize,E=[m,b,0],O=[g,b,0],D=[m,S,0],N=[g,S,0],B=$([],r.globeMatrix);return or(E,E,B),or(O,O,B),or(D,D,B),or(N,N,B),h[0]=uc(h[0],D,o),h[1]=uc(h[1],N,o),h[2]=uc(h[2],O,o),h[3]=uc(h[3],E,o),hr.fromPoints(h)},i.bk=Xv,i.bl=$,i.bm=Ag,i.bn=uc,i.bo=oc,i.bp=iH,i.bq=de,i.br=K,i.bs=zx,i.bt=dx,i.bu=Vc,i.bv=function(s,r){const o=[];for(const u in s)u in r||o.push(u);return o},i.bw=Qe,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=vs,i.bz=function(s){var r=new I(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},i.c=Hy,i.c$=function(s){return s*s*s*s*s},i.c0=aS,i.c1=SD,i.c2=hS,i.c3=MS,i.c4=qt,i.c5=hi,i.c6=Ho,i.c7=function(s,r,o){o*=.5;var u=r[0],h=r[1],m=r[2],g=r[3],b=Math.sin(o),S=Math.cos(o);return s[0]=u*S+h*b,s[1]=h*S-u*b,s[2]=m*S+g*b,s[3]=g*S-m*b,s},i.c8=qa,i.c9=Qn,i.cA=Or,i.cB=SR,i.cC=Cs,i.cD=aM,i.cE=function(s,r,o,u,h,m,g,b,S){if(S.name==="globe")return aM(s,r,new Cs(o,u,h),!1);const E=Kg({z:o,x:u,y:h},S);return new hr([(m+E.x/E.scale)*r,r*(E.y/E.scale),g],[(m+E.x2/E.scale)*r,r*(E.y2/E.scale),b])},i.cF=function(s,r,o){return s[0]=Math.min(r[0],o[0]),s[1]=Math.min(r[1],o[1]),s[2]=Math.min(r[2],o[2]),s[3]=Math.min(r[3],o[3]),s},i.cG=function(s,r,o){return s[0]=Math.max(r[0],o[0]),s[1]=Math.max(r[1],o[1]),s[2]=Math.max(r[2],o[2]),s[3]=Math.max(r[3],o[3]),s},i.cH=function(s){const r=Math.round((s+45+360)%360/90)%4;return ce[r]},i.cI=Te,i.cJ=ki,i.cK=x,i.cL=function(s){const r=j(new Float64Array(16));Y(r,s.pixelMatrix,s.globeMatrix);const o=[0,k,0],u=[0,L,0];return or(o,o,r),or(u,u,r),[o[0]>0&&o[0]<=s.width&&o[1]>0&&o[1]<=s.height&&!S1(s,new Z(s.center.lat,90)),u[0]>0&&u[0]<=s.width&&u[1]>0&&u[1]<=s.height&&!S1(s,new Z(s.center.lat,-90))]},i.cM=function(s,r){const{scale:o}=s.tileTransform,u=o*Mt/(s.tileSize*Math.pow(2,r.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return(function(h,m,g){var b=m[1],S=m[2],E=m[3],O=g[0],D=g[1];return h[0]=m[0]*O,h[1]=b*O,h[2]=S*D,h[3]=E*D,h})(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},i.cN=cx,i.cO=rt,i.cP=wR,i.cQ=function(s){const r=wR(s,!0);return M([],[r[0],r[1],r[4],r[5]])},i.cR=re,i.cS=on,i.cT=se,i.cU=function(s){const{x:r,y:o}=s.point,{lng:u,lat:h}=s._center;return cM(r,o,s.worldSize,u,h)},i.cV=Ot,i.cW=ne,i.cX=zf,i.cY=Qi,i.cZ=y,i.c_=function(s,r,o){let u=0;for(let h=0;h<2;++h)s[h]>0&&(u+=(s[h]-0)*(s[h]-0)),r[h]<0&&(u+=(0-r[h])*(0-r[h]));return u},i.ca=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},i.cb=Ne,i.cc=function(s,r,o,u,h){var m=1/Math.tan(r/2);if(s[0]=m/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=m,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,h!=null&&h!==1/0){var g=1/(u-h);s[10]=(h+u)*g,s[14]=2*h*u*g}else s[10]=-1,s[14]=-2*u;return s},i.cd=function(s,r,o,u,h,m,g){var b=1/(r-o),S=1/(u-h),E=1/(m-g);return s[0]=-2*b,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*E,s[11]=0,s[12]=(r+o)*b,s[13]=(h+u)*S,s[14]=(g+m)*E,s[15]=1,s},i.ce=xe,i.cf=function(s,r,o){s[4*r+0]=o[0],s[4*r+1]=o[1],s[4*r+2]=o[2],s[4*r+3]=o[3]},i.cg=Rh,i.ch=Dh,i.ci=di,i.cj=Qa,i.ck=Nh,i.cl=ND,i.cm=function(){var s=new I(4);return I!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},i.cn=function(s,r,o){var u=r[0],h=r[1],m=r[2],g=r[3],b=Math.sin(o),S=Math.cos(o);return s[0]=u*S+m*b,s[1]=h*S+g*b,s[2]=u*-b+m*S,s[3]=h*-b+g*S,s},i.co=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},i.cp=Hr,i.cq=function(s){var r=s[0],o=s[1],u=s[2],h=s[3];return Math.sqrt(r*r+o*o+u*u+h*h)},i.cr=_s,i.cs=jt,i.ct=jf,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=er,i.cz=ke,i.d=function(s){return ao.API_TILEJSON_REGEX.test(s)},i.d$=GR,i.d0=fe,i.d1=45,i.d2=kh,i.d3=function(s,r,o){const u=Math.sqrt(s*s+r*r+o*o),h=u>0?Math.acos(o/u)*jc:0;let m=s!==0||r!==0?Math.atan2(-r,-s)*jc+90:0;return m<0&&(m+=360),[u,m,h]},i.d4=Je,i.d5=xi,i.d6=Ve,i.d7=it,i.d8=hr,i.d9=Pt,i.dA=function(s,r,o){const u=yu(o.zoom),h=s.style.map._antialias,m=s.terrain&&s.terrain.exaggeration()>0;return u===0&&!h&&!m},i.dB=function(s){const r=s.pixelsPerMeter,o=r/xe(1,s.center.lat),u=j(new Float64Array(16));return K(u,u,[s.point.x,s.point.y,0]),re(u,u,[o,o,r]),Float32Array.from(u)},i.dC=Wv,i.dD=function(s){const r=Te-5;s=Ie(s,-r,r)/r*90;const o=Math.pow(Math.abs(Math.sin(Fe(s))),3);return Math.round(o*(C.length-1))},i.dE=function(s,r,o,u){const h=r.getNorth(),m=r.getSouth(),g=r.getWest(),b=r.getEast(),S=1<<s.z,E=b-g,O=h-m,D=E/A,N=-O/C[o],B=[0,D,0,N,0,0,h,g,0];if(s.z>0){const U=180/u;q(B,B,[U/E+1,0,0,0,U/O+1,0,-.5*U/D,.5*U/N,1])}return B[2]=S,B[5]=s.x,B[8]=s.y,B},i.dF=yl,i.dG=function(s,r,o){const u=j(new Float64Array(16)),h=(r/(1<<s)-.5)*Math.PI*2;return J(u,o.globeMatrix,h),Float32Array.from(u)},i.dH=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const o=r.getSource().maxzoom,u=1<<o,h=Math.floor(s.x),m=Math.floor((s.x-h)*u),g=Math.floor(s.y*u),b=this.findDEMTileFor(new To(o,h,o,m,g));return!(!b||!b.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,o=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||s.y<0||s.y>1)return r;const h=u.getSource().maxzoom,m=1<<h,g=Math.floor(s.x),b=s.x-g,S=new To(h,g,h,Math.floor(b*m),Math.floor(s.y*m)),E=this.findDEMTileFor(S);if(!E||!E.dem)return r;const O=E.dem,D=1<<E.tileID.canonical.z,N=(b*D-E.tileID.canonical.x)*O.dim,B=(s.y*D-E.tileID.canonical.y)*O.dim,U=Math.floor(N),X=Math.floor(B);return(o?this.exaggeration():1)*lr(lr(O.get(U,X),O.get(U,X+1),B-X),lr(O.get(U+1,X),O.get(U+1,X+1),B-X),N-U)}getAtTileOffset(s,r,o){const u=1<<s.canonical.z;return this.getAtPointOrZero(new et(s.wrap+(s.canonical.x+r/Mt)/u,(s.canonical.y+o/Mt)/u))}getAtTileOffsetFunc(s,r,o,u){return h=>{const m=this.getAtTileOffset(s,h.x,h.y),g=u.upVector(s.canonical,h.x,h.y);return qt(g,g,m*u.upVectorScale(s.canonical,r,o).metersToTile),g}}getForTilePoints(s,r,o,u){if(this.isUsingMockSource())return!1;const h=Yf.create(this,s,u);return!!h&&(r.forEach((m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],o)})),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const o=r.dem.tree,u=r.tileID,h=1<<s.canonical.z-u.canonical.z;let m=s.canonical.x/h-u.canonical.x,g=s.canonical.y/h-u.canonical.y,b=0;for(let S=0;S<s.canonical.z-u.canonical.z&&!o.leaves[b];S++){m*=2,g*=2;const E=2*Math.floor(g)+Math.floor(m);b=o.childOffsets[b]+E,m%=1,g%=1}return{min:this.exaggeration()*o.minimums[b],max:this.exaggeration()*o.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,o){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let r=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of s){const m=this.getMinMaxForTile(h.tileID);m&&(o=Math.min(o,m.min),u=Math.max(u,m.max),r=!0)}return r?{min:o,max:u}:null}},i.dI=wM,i.dJ=Hv,i.dK=function(s,r){return[Math.pow(s[0],2.2)*r,Math.pow(s[1],2.2)*r,Math.pow(s[2],2.2)*r]},i.dL=R,i.dM=function(s,r){var o=Math.sin(r),u=Math.cos(r);return s[0]=u,s[1]=o,s[2]=0,s[3]=-o,s[4]=u,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},i.dN=br,i.dO=lM,i.dP=yo,i.dQ=Zo,i.dR=256,i.dS=function(s,r){const o=[0,0,0];return or(o,o,Xv(yl(r.canonical))),or(o,o,s),o},i.dT=s=>({u_matrix:new Nh(s),u_texsize:new Qa(s),u_pixels_to_tile_units:new Lf(s),u_device_pixel_ratio:new di(s),u_width_scale:new di(s),u_floor_width_scale:new di(s),u_image:new Rh(s),u_units_to_pixels:new Qa(s),u_tile_units_to_pixels:new di(s),u_alpha_discard_threshold:new di(s),u_trim_offset:new Qa(s),u_trim_fade_range:new Qa(s),u_trim_color:new kh(s),u_emissive_strength:new di(s),u_zbias_factor:new di(s),u_tile_to_meter:new di(s),u_ground_shadow_factor:new Dh(s),u_pattern_transition:new di(s)}),i.dU=s=>({u_matrix:new Nh(s),u_pixels_to_tile_units:new Lf(s),u_device_pixel_ratio:new di(s),u_width_scale:new di(s),u_floor_width_scale:new di(s),u_units_to_pixels:new Qa(s),u_dash_image:new Rh(s),u_gradient_image:new Rh(s),u_image_height:new di(s),u_texsize:new Qa(s),u_tile_units_to_pixels:new di(s),u_alpha_discard_threshold:new di(s),u_trim_offset:new Qa(s),u_trim_fade_range:new Qa(s),u_trim_color:new kh(s),u_emissive_strength:new di(s),u_zbias_factor:new di(s),u_tile_to_meter:new di(s),u_ground_shadow_factor:new Dh(s)}),i.dV=s=>({u_camera_to_center_distance:new di(s),u_extrude_scale:new Lf(s),u_device_pixel_ratio:new di(s),u_matrix:new Nh(s),u_inv_rot_matrix:new Nh(s),u_merc_center:new Qa(s),u_tile_id:new Dh(s),u_zoom_transition:new di(s),u_up_dir:new Dh(s),u_emissive_strength:new di(s)}),i.dW=gg,i.dX=$W,i.dY=class{constructor(s,r,o,u){this.context=s,this.format=u,this.size=o,this.texture=s.gl.createTexture();const[h,m,g]=this.size,{gl:b}=s;b.bindTexture(b.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,h,m,g,0,q1(this.format),G1(this.format),r.data)}bind(s,r){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),s!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,s),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,s),this.minFilter=s),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},i.dZ=dM,i.d_=(s,r,o,u,h,m)=>{const g=s.transform,b=g.projection.name==="globe";let S;if(m.paint.get("circle-pitch-alignment")==="map")if(b){const O=lM(g.zoom,r.canonical)*g._pixelsPerMercatorPixel;S=Float32Array.from([O,0,0,O])}else S=g.calculatePixelsToTileUnitsMatrix(o);else S=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(g.projection),u_matrix:s.translatePosMatrix(r.projMatrix,o,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Wa.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:cH,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(b){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],E.u_zoom_transition=yu(g.zoom);const O=h[0]*Mt,D=h[1]*Mt;E.u_up_dir=g.projection.upVector(new Cs(0,0,0),O,D)}return E},i.da=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},i.db=xS,i.dc=function(s,r){return s.readFields(z9,{icons:[]},r)},i.dd=ox,i.de=Zf,i.df=cS,i.dg=Cd,i.dh=wv,i.di=Ed,i.dj=Rd,i.dk=Br,i.dl=function(s){const r=s.indexOf(Ah);return r>=0?s.slice(0,r):s},i.dm=function(s){return s.indexOf(Ah)>=0},i.dn=function(s){const r=s.lastIndexOf(Ah);return r>=0?s.slice(r+1):""},i.dp=function(s){const r=[],o=s.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},i.dq=function(s,r,o,u){return s.type==="custom"?new R9(s,r):new L9[s.type](s,r,o,u)},i.dr=Ur,i.ds=function(s){const r=s.indexOf(Ah);return r>=0?s.slice(r+1):""},i.dt=class extends tp{constructor(s,r){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},i.du=sg,i.dv=Xr,i.dw=function(s){return s({pluginStatus:wo,pluginURL:ul}),sg.on("pluginStateChange",s),s},i.dx=$v,i.dy=class extends Ja{constructor(s){super(s),this.current=_1}set(s,r,o){if(this.fetchUniformLocation(s,r)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},i.dz=ye,i.e=ao,i.e$=function(){const s=zg;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(F1),zg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.e0=Ro,i.e1=(s,r,o,u,h,m,g,b,S,E)=>{const O=s.transform,D=O.pitch<15?VR(.07,.7,Ie((14-O.zoom)/5,0,1)):.07,N=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:qR(s,r,o,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:h,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:$R(r,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:Ve(r.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:E}},i.e2=(s,r,o,u,h,m,g,b,S,E)=>{const O=s.transform,D=O.calculatePixelsToTileUnitsMatrix(r),N=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=O.pitch<15?VR(.07,.7,Ie((14-O.zoom)/5,0,1)):.07;return{u_matrix:qR(s,r,o,u),u_pixels_to_tile_units:D,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:b,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:HR(o)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$R(r,s.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:Ve(r.tileID.canonical,0),u_ground_shadow_factor:E}},i.e3=tr,i.e4=Eg,i.e5=ve,i.e6=rH,i.e7=nx,i.e8=rR,i.e9=xu,i.eA=wi,i.eB=pu,i.eC=function(s,r,o,u,h,m,g,b,S,E,O,D,N,B,U,X){var Q=new I(16);return Q[0]=s,Q[1]=r,Q[2]=o,Q[3]=u,Q[4]=h,Q[5]=m,Q[6]=g,Q[7]=b,Q[8]=S,Q[9]=E,Q[10]=O,Q[11]=D,Q[12]=N,Q[13]=B,Q[14]=U,Q[15]=X,Q},i.eD=G,i.eE=Ih,i.eF=Of,i.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new wt(1/0,1/0),max:new wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,r=!1){const o=VM(new wt(0,0),new wt(Mt,Mt),s),u=[];if(r&&!R1(o,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!R1(o,h))continue;const m=jH(h.min,h.max,s);u.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(s){this._setSources(s.map((r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const o=[];for(const u of r.cache.getVisibleCoordinates()){const h=r.cache.getTile(u).buckets[r.layer];h&&h.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope}))))}_addSource(s){const r=s.getFootprints();if(r.length===0)return;const o=s.getOrder(),u=s.getClipMask(),h=s.getClipScope();for(const m of r){if(!m.footprint)continue;const g=VM(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:o,clipMask:u,clipScope:h})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort(((r,o)=>r.priority-o.priority||ex(r.min,o.min)||ex(r.max,o.max)||r.order-o.order||r.clipMask-o.clipMask||(function(u,h){const m=(g,b)=>g+b;return u.length-h.length||u.reduce(m,"").localeCompare(h.reduce(m,""))})(r.clipScope,o.clipScope)));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let r=0;for(;!s&&r!==this._activeRegions.length;){const o=this._activeRegions[r],u=this._prevRegions[r];s=o.priority!==u.priority||!UM(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!vs(o.clipScope,u.clipScope),++r}}if(s){++this._updateTime;for(const o of this._activeRegions)o.order!==Rg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const r=o=>{const u=this._activeRegions;if(o>=u.length)return o;const h=u[o].priority;for(;o<u.length&&u[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,u=r(o);for(;o!==u;){let h=o;const m=o;for(;h!==u;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let b=0;b<m;b++){const S=this._activeRegions[b];if(!S.hiddenByOverlap&&g.order===Rg&&R1(g,S)&&(g.hiddenByOverlap=$M(g.footprint,g.tileId,S.footprint,S.tileId),g.hiddenByOverlap))break}++h}o=u,u=r(o)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=s.length-1;r>=0;r--)this._addSource(s[r]);this._computeReplacement()}},i.eH=Rg,i.eI=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,r){const o=new dl,u=new Oi,h=[],m=s+1+2,g=r[0]+1,b=r[0]+1+(1+r.length),S=(E,O,D)=>{let N=E===m-1?E-2:E===0?E:E-1;return N+=D?24575:0,[N,O]};for(let E=0;E<m;++E)o.emplaceBack(...S(E,0,!0));for(let E=0;E<g;++E)for(let O=0;O<m;++O)o.emplaceBack(...S(O,E,(O===0||O===m-1)&&!0));for(let E=0;E<r.length;++E){const O=r[E];for(let D=0;D<m;++D)o.emplaceBack(...S(D,O,!0))}for(let E=0;E<r.length;++E){const O=u.length,D=r[E]+1+2,N=new Oi;for(let X=0;X<D-1;X++){const Q=X===D-2,ee=Q?m*(b-r.length+E-X):m;for(let ue=0;ue<m-1;ue++){const he=X*m+ue;X===0||Q||ue===0||ue===m-2?(N.emplaceBack(he+1,he,he+ee),N.emplaceBack(he+ee,he+ee+1,he+1)):(u.emplaceBack(he+1,he,he+ee),u.emplaceBack(he+ee,he+ee+1,he+1))}}const B=Hn.simpleSegment(0,O,o.length,u.length-O);for(let X=0;X<N.uint16.length;X+=3)u.emplaceBack(N.uint16[X],N.uint16[X+1],N.uint16[X+2]);const U=Hn.simpleSegment(0,O,o.length,u.length-O);h.push({withoutSkirts:B,withSkirts:U})}return{vertices:o,indices:u,segments:h}}_createGrid(s){const r=this._fillGridMeshWithLods(A,C);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,nM.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new Oi;for(let g=0;g<=A;g++)r.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const o=new sc,u=new sc,h=new sc,m=new sc;this._poleSegments=[];for(let g=0,b=0;g<y;g++){const S=360/(1<<g);o.emplaceBack(0,-f,0,.5,0),u.emplaceBack(0,-f,0,.5,1),h.emplaceBack(0,-f,0,.5,.5),m.emplaceBack(0,-f,0,.5,.5);for(let E=0;E<=A;E++){let O=E/A,D=0;const N=lr(0,S,O),[B,U,X]=V(sH,lH,N,f);o.emplaceBack(B,U,X,O,D),u.emplaceBack(B,U,X,O,1-D);const Q=Fe(N);O=.5+.5*Math.sin(Q),D=.5+.5*Math.cos(Q),h.emplaceBack(B,U,X,O,D),m.emplaceBack(B,U,X,O,1-D)}this._poleSegments.push(Hn.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(o,Gv,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(u,Gv,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(h,Gv,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(m,Gv,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},i.eJ=FM,i.eK=Me,i.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eM=Ce,i.eN=tt,i.eO=function(s,r,o){return s[0]=r[0]/o[0],s[1]=r[1]/o[1],s[2]=r[2]/o[2],s},i.eP=ni,i.eQ=z,i.eR=an,i.eS=ot,i.eT=function([s,r,o]){const u=Math.hypot(s,r,o),h=Math.atan2(s,o),m=.5*Math.PI-Math.acos(-r/u);return new Z(ne(h),ne(m))},i.eU=Go,i.eV=W1,i.eW=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!(function(o){if(Jn==null){const u=o.navigator?o.navigator.userAgent:null;Jn=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Jn})(s)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eX=function(s,r){xa=s,bs=r},i.eY=S1,i.eZ=uM,i.e_=function(s){const r=[0,0,0],o=j(new Float64Array(16));return Y(o,s.pixelMatrix,s.globeMatrix),or(r,r,o),new wt(r[0],r[1])},i.ea=450,i.eb=7,i.ec=je,i.ed=function(s,r){if(s===r){var o=r[1],u=r[2],h=r[3],m=r[6],g=r[7],b=r[11];s[1]=r[4],s[2]=r[8],s[3]=r[12],s[4]=o,s[6]=r[9],s[7]=r[13],s[8]=u,s[9]=m,s[11]=r[14],s[12]=h,s[13]=g,s[14]=b}else s[0]=r[0],s[1]=r[4],s[2]=r[8],s[3]=r[12],s[4]=r[1],s[5]=r[5],s[6]=r[9],s[7]=r[13],s[8]=r[2],s[9]=r[6],s[10]=r[10],s[11]=r[14],s[12]=r[3],s[13]=r[7],s[14]=r[11],s[15]=r[15];return s},i.ee=M9,i.ef=qr,i.eg=gu,i.eh=256,i.ei=b1,i.ej=ko,i.ek=J,i.el=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},i.em=sc,i.en=vg,i.eo=Zm,i.ep=function(s,r,o,u,h){return Ie((s-r)/(o-r)*(h-u)+u,u,h)},i.eq=Ga,i.er=function(s,r){var o=r[0],u=r[1],h=r[2],m=r[3],g=r[4],b=r[5],S=r[6],E=r[7],O=r[8],D=O*g-b*E,N=-O*m+b*S,B=E*m-g*S,U=o*D+u*N+h*B;return U?(s[0]=D*(U=1/U),s[1]=(-O*u+h*E)*U,s[2]=(b*u-h*g)*U,s[3]=N*U,s[4]=(O*o-h*S)*U,s[5]=(-b*o+h*m)*U,s[6]=B*U,s[7]=(-E*o+u*S)*U,s[8]=(g*o-u*m)*U,s):null},i.es=2,i.et=An,i.eu=Z1,i.ev=[1,1,1],i.ew=Yf,i.ex=Lo,i.ey=function(s,r,o,u){var h=r[0],m=r[1],g=r[2],b=r[3];return s[0]=h+u*(o[0]-h),s[1]=m+u*(o[1]-m),s[2]=g+u*(o[2]-g),s[3]=b+u*(o[3]-b),s},i.ez=Gf,i.f=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,((r,o)=>String.fromCharCode(+("0x"+o)))))},i.f0=function(){ox().acquire(F1)},i.f1=bf,i.f2=function(s,r,o=!1){if(wo===zo.deferred||wo===zo.loading||wo===zo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ul=Wa.resolveURL(s),wo=zo.deferred,og=r,ag(),o||Ql()},i.f3=function(s){Vf=Wa.resolveURL(s),$f||($f=new Uf(ox(),new Ul)),$f.broadcast("setMeshoptUrl",Vf)},i.f4=mR,i.f5=function(s){U1=Wa.resolveURL(s),$f||($f=new Uf(ox(),new Ul)),$f.broadcast("setDracoUrl",U1)},i.f6=pR,i.f7=jg,i.f8=function(s){const r=_m();if(!r)return;const o=r.delete(Xo);s&&o.then((()=>s())).catch(s)},i.f9=Fh,i.fA=function(s){rh(),vo?.then((r=>{r.keys().then((o=>{for(let u=0;u<o.length-s;u++)r.delete(o[u]).catch((h=>Vr(h.message)))})).catch((o=>Vr(o.message)))})).catch((r=>Vr(r.message)))},i.fa=Ut,i.fb=vu,i.fc=Ms,i.fd=Bk,i.fe=Uk,i.ff=zR,i.fg=Cr,i.fh="hd_road_elevation",i.fi=$n,i.fj=yr,i.fk=hc,i.fl=lS,i.fm=Vh,i.fn=function(s,r,o,u,h,m,g,b=1,S,E,O){s.createArrays(),s.tilePixelRatio=Mt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const D=s.layers[0].layout,N=s.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=b,B.textSizeScaleRange=D.get("text-size-scale-range"),B.iconSizeScaleRange=D.get("icon-size-scale-range");const[U,X]=B.textSizeScaleRange,[Q,ee]=B.iconSizeScaleRange;B.textScaleFactor=Ie(B.scaleFactor,U,X),B.iconScaleFactor=Ie(B.scaleFactor,Q,ee);const ue=N["text-size"],he=N["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:Le,maxZoom:ct}=s.textSizeData;B.compositeTextSizes=[ue.possiblyEvaluate(new Cn(Le,{worldview:O}),m),ue.possiblyEvaluate(new Cn(ct,{worldview:O}),m)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Le,maxZoom:ct}=s.iconSizeData;B.compositeIconSizes=[he.possiblyEvaluate(new Cn(Le,{worldview:O}),m),he.possiblyEvaluate(new Cn(ct,{worldview:O}),m)]}B.layoutTextSize=ue.possiblyEvaluate(new Cn(g+1,{worldview:O}),m),B.layoutIconSize=he.possiblyEvaluate(new Cn(g+1,{worldview:O}),m),B.textMaxSize=ue.possiblyEvaluate(new Cn(18,{worldview:O}),m);const pe=D.get("symbol-placement"),Ae=D.get("text-rotation-alignment")==="map"&&pe!=="point",Ee=D.get("text-size");let Oe=!1;const De=[];for(const Le of s.features){const ct=D.get("text-font").evaluate(Le,{},m).join(","),Ue=Ee.evaluate(Le,{},m)*B.textScaleFactor,ut=B.layoutTextSize.evaluate(Le,{},m)*B.textScaleFactor,_t=B.layoutIconSize.evaluate(Le,{},m)*B.iconScaleFactor,ht={horizontal:{},vertical:void 0},ft=Le.text;let bt,st=[0,0];if(ft){const Zt=ft.toString(),cr=D.get("text-letter-spacing").evaluate(Le,{},m)*Gi,xr=D.get("text-line-height").evaluate(Le,{},m)*Gi,kr=xv(Zt)?cr:0,Sr=D.get("text-anchor").evaluate(Le,{},m),$t=D.get("text-variable-anchor");if(!$t){const Xe=D.get("text-radial-offset").evaluate(Le,{},m);if(Xe)st=SD(Sr,[Xe*Gi,uS]);else{const lt=D.get("text-offset").evaluate(Le,{},m);st=[lt[0]*Gi,lt[1]*Gi]}}let wr=Ae?"center":D.get("text-justify").evaluate(Le,{},m);const Wr=pe==="point",ge=Wr?D.get("text-max-width").evaluate(Le,{},m)*Gi:1/0,_e=Xe=>{s.allowVerticalPlacement&&ig(Zt)&&(ht.vertical=oS(ft,r,o,h,ct,ge,xr,Sr,Xe,kr,st,aa.vertical,!0,ut,Ue,S))};if(!Ae&&$t){const Xe=wr==="auto"?$t.map((Dt=>hS(Dt))):[wr];let lt=!1;for(let Dt=0;Dt<Xe.length;Dt++){const Rt=Xe[Dt];if(!ht.horizontal[Rt])if(lt)ht.horizontal[Rt]=ht.horizontal[0];else{const Vt=oS(ft,r,o,h,ct,ge,xr,"center",Rt,kr,st,aa.horizontal,!1,ut,Ue,S);Vt&&(ht.horizontal[Rt]=Vt,lt=Vt.positionedLines.length===1)}}_e("left")}else{if(wr==="auto"&&(wr=hS(Sr)),Wr||D.get("text-writing-mode").indexOf("horizontal")>=0||!ig(Zt)){const Xe=oS(ft,r,o,h,ct,ge,xr,Sr,wr,kr,st,aa.horizontal,!1,ut,Ue,S);Xe&&(ht.horizontal[wr]=Xe)}_e(Wr?"left":wr)}}let mt,Ke,Ge,St,vt,Qt,zt=!1;const Gt=D.get("icon-text-fit").evaluate(Le,{},m);if(Le.icon&&Le.icon.hasPrimary()){const Zt=AD(Le.icon,s.iconSizeData,N["icon-size"],m,s.zoom,Le,S,B.iconScaleFactor,O);mt=Zt.iconPrimary,Ge=Zt.iconSecondary;const cr=mt.toString();if(Ke=u.get(cr),Ke&&(vt=D.get("icon-offset").evaluate(Le,{},m),Qt=D.get("icon-anchor").evaluate(Le,{},m),bt=s9(h.get(cr),Ge?h.get(Ge.toString()):void 0,vt,Qt),zt=Ke.sdf,s.sdfIcons===void 0?s.sdfIcons=Ke.sdf:s.sdfIcons!==Ke.sdf&&Vr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==s.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0)),Ge){const xr=Ge.toString();St=u.get(xr)}}Oe=Oe||!(!Le.icon||!Le.icon.hasSecondary());const Ct=dS(ht.horizontal)||ht.vertical;s.iconsInText||(s.iconsInText=!!Ct&&Ct.iconsInText);const Yt=ut*B.textScaleFactor/Gi,{defaultShapedIcon:_r,verticallyShapedIcon:kt}=_9(s,bt,D,Le,m,ht,Yt,vt,Gt);Gt!=="none"&&bt&&(sD(bt)||lD(bt))&&(_x(0,Ke,mt,bt,_r,Gt,E,u,h),_x(0,St,Ge,bt,_r,Gt,E,u,h),kt&&(_x(0,Ke,mt,bt,kt,Gt,E,u,h),_x(0,St,Ge,bt,kt,Gt,E,u,h))),bt=_r,De.push({feature:Le,shapedTextOrientations:ht,shapedText:Ct,shapedIcon:bt,iconPrimary:mt,iconSecondary:Ge,iconOffset:vt,iconAnchor:Qt,verticallyShapedIcon:kt,layoutTextSize:ut,layoutIconSize:_t,textOffset:st,isSDFIcon:zt,iconTextFit:Gt})}return{featureData:De,sizes:B,hasAnySecondaryIcon:Oe,textAlongLine:Ae,symbolPlacement:pe}},i.fo=_D,i.fp=function(s,r,o,u,h,m,g,b,S,E){const{featureData:O,hasAnySecondaryIcon:D,sizes:N,textAlongLine:B,symbolPlacement:U}=r;for(const X of O){const{shapedIcon:Q,verticallyShapedIcon:ee,feature:ue,shapedTextOrientations:he,shapedText:pe,layoutTextSize:Ae,textOffset:Ee,isSDFIcon:Oe,iconPrimary:De,iconSecondary:Le,iconTextFit:ct,iconOffset:Ue}=X;ED(Q,E.iconPositions,De,Le),ED(ee,E.iconPositions,De,Le),g9(he,E.iconPositions),m9(De,Le,E.iconPositions),(pe||Q)&&y9(s,ue,he,Q,ee,S,N,Ae,0,Ee,Oe,u,h,g,b,D,ct,Ue,B,U)}o&&s.generateCollisionDebugBuffers(m,s.collisionBoxArray,N.textScaleFactor)},i.fq=gr,i.fr=jx,i.fs=gt,i.ft=function(s){let r=0;if(new Uint32Array(s,0,1)[0]!==_R){const o=new Uint32Array(s,0,7),[,,u,h,m,g]=o;r=o.byteLength+h+m+g+m,(u!==s.byteLength||r>=s.byteLength)&&Vr("Invalid b3dm header information.")}return bR(s,r)},i.fu=function(s,r){const o=CR(s);for(const u of o){for(const h of u.meshes)pW(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(mW(u.lights,r)))}return o},i.fv=Mx,i.fw=Tn,i.fx=dR,i.fy=Ya,i.fz=zo,i.g=function(s,r){return Xr(Object.assign(s,{method:"GET"}),r)},i.h=function(s){return s.indexOf("mapbox:")===0},i.i=function(s){return ao.API_STYLE_REGEX.test(s)&&!Hy(s)},i.j=zc,i.k=nh,i.l=function(s){return decodeURIComponent(atob(s).split("").map((r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2))).join(""))},i.m=function(s,r){return Xr(Object.assign(s,{type:"json"}),r)},i.n=$c,i.o=Wa,i.p=function(s,r){return Xr(Object.assign(s,{method:"POST"}),r)},i.q=eo,i.r=mm,i.s=function(s){try{const r=self[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return B1||(B1=new Fh),B1},i.u=function(){return(function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)})()},i.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},i.w=Vr,i.x=PS,i.y=ah,i.z=wa})),_(["./shared"],(function(i){function P(Fe){const ne=Fe?Fe.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function I(Fe){if(typeof Fe=="number"||typeof Fe=="boolean"||typeof Fe=="string"||Fe==null)return JSON.stringify(Fe);if(Array.isArray(Fe)){let ce="[";for(const ye of Fe)ce+=`${I(ye)},`;return`${ce}]`}let ne="{";for(const ce of Object.keys(Fe).sort())ne+=`${ce}:${I(Fe[ce])},`;return`${ne}}`}function M(Fe){let ne="";for(const ce of i.bx)ne+=`/${I(Fe[ce])}`;return ne}class R{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ce){this._layerConfigs={},this._layers={},this.update(ne,[],ce)}update(ne,ce,ye){this._options=ye;for(const Ce of ne)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=i.dq(Ce,this.scope,null,this._options)).compileFilter(ye),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of ce)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Me=(function(Ce,Ie){const Ye={};for(let Qe=0;Qe<Ce.length;Qe++){const It=Ce[Qe];let pt=Ie&&Ie[It.id];pt||(It.type==="symbol"?pt=It.id:(pt=M(It),It.type==="line"&&It.paint&&(function pr(yr){return typeof yr=="string"&&yr==="line-progress"||(Array.isArray(yr)?yr.some(pr):!(!yr||typeof yr!="object")&&Object.values(yr).some(pr))})(It.paint["line-width"])&&(pt+=`/${I(It.paint["line-width"])}`))),Ie&&(Ie[It.id]=pt);let tr=Ye[pt];tr||(tr=Ye[pt]=[]),tr.push(It)}const ze=[];for(const Qe in Ye)ze.push(Ye[Qe]);return ze})(Object.values(this._layerConfigs),this.keyCache);for(const Ce of Me){const Ie=Ce.map((tr=>this._layers[tr.id])),Ye=Ie[0];if(Ye.visibility==="none")continue;const ze=Ye.source||"";let Qe=this.familiesBySource[ze];Qe||(Qe=this.familiesBySource[ze]={});const It=Ye.sourceLayer||"_geojsonTileLayer";let pt=Qe[It];pt||(pt=Qe[It]=[]),pt.push(Ie)}}}const F=1*i.fc;class q{constructor(ne){const ce={},ye=[];for(const Ye in ne){const ze=ne[Ye],Qe=ce[Ye]={};for(const It in ze.glyphs){const pt=ze.glyphs[+It];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const tr=pt.metrics.localGlyph?F:1,pr={x:0,y:0,w:pt.bitmap.width+2*tr,h:pt.bitmap.height+2*tr};ye.push(pr),Qe[It]=pr}}const{w:Me,h:Ce}=i.G(ye),Ie=new i.fb({width:Me||1,height:Ce||1});for(const Ye in ne){const ze=ne[Ye];for(const Qe in ze.glyphs){const It=ze.glyphs[+Qe];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const pt=ce[Ye][Qe],tr=It.metrics.localGlyph?F:1;i.fb.copy(It.bitmap,Ie,{x:0,y:0},{x:pt.x+tr,y:pt.y+tr},It.bitmap)}}this.image=Ie,this.positions=ce}}i.fa(q,"GlyphAtlas");class H{constructor(ne){this.tileID=new i.aO(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview}parse(ne,ce,ye,Me,Ce,Ie){this.status="parsing",this.data=ne,this.collisionBoxArray=new i.b3;const Ye=new i.fd(Object.keys(ne.layers).sort()),ze=new i.fe(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Qe={},It=new i.ff(256,256),pt={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:It,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},tr=[],pr=ce.familiesBySource[this.source];for(const Ur in pr){const Br=ne.layers[Ur];if(!Br)continue;let Gr=!1,En=!1,Vr=!1;for(const Tn of pr[Ur])Tn[0].type==="symbol"?Gr=!0:En=!0,Tn[0].is3D()&&Tn[0].type!=="model"&&(Vr=!0);if(this.extraShadowCaster&&!Vr||this.isSymbolTile===!0&&!Gr||this.isSymbolTile===!1&&!En)continue;Br.version===1&&i.w(`Vector tile source "${this.source}" layer "${Ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ii=Ye.encode(Ur),vi=[];let xi=!1;for(let Tn=0,sn=0;Tn<Br.length;Tn++){const Jn=Br.feature(Tn),Qn=ze.getId(Jn,Ur);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ur)){const Ln=Jn.properties?Jn.properties.worldview:null;if(this.worldview&&typeof Ln=="string")if(Ln==="all")Jn.properties.$localized=!0;else{if(!Ln.split(",").includes(this.worldview))continue;Jn.properties.$localized=!0,Jn.properties.worldview=this.worldview}}!xi&&Jn.properties&&Jn.properties.hasOwnProperty(i.fg)&&(xi=!0),vi.push({feature:Jn,id:Qn,index:sn,sourceLayerIndex:ii}),sn++}xi&&!pt.elevationFeatures&&ne.layers.hasOwnProperty(i.fh)&&(pt.elevationFeatures=i.fi.parseFrom(ne.layers[i.fh],this.canonical));for(const Tn of pr[Ur]){const sn=Tn[0];if(this.extraShadowCaster&&(!sn.is3D()||sn.type==="model")||this.isSymbolTile!==void 0&&sn.type==="symbol"!==this.isSymbolTile||sn.minzoom&&this.zoom<Math.floor(sn.minzoom)||sn.maxzoom&&this.zoom>=sn.maxzoom||sn.visibility==="none")continue;j(Tn,this.zoom,pt.brightness,ye,this.worldview);const Jn=Qe[sn.id]=sn.createBucket({index:ze.bucketLayerIDs.length,layers:Tn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview});ze.bucketLayerIDs.push(Tn.map((Ln=>i.B(Ln.id,Ln.scope))));let Qn=Jn.prepare?Jn.prepare():null;Qn!=null?(Qn=Qn.then((()=>Jn.populate(vi,pt,this.tileID.canonical,this.tileTransform))),tr.push(Qn)):Jn.populate(vi,pt,this.tileID.canonical,this.tileTransform)}}const yr=()=>{let Ur,Br,Gr,En,Vr,ii;It.trim();const vi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xi=()=>{if(Ur)return this.status="done",Ie(Ur);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(Qe).filter((sn=>!sn.isEmpty())),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:pt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Br&&Gr&&En){const sn=new q(Br),Jn=new Map;for(const[Xi,yo]of Gr.entries()){const{imagePosition:Zo}=i.fl(Xi,yo,i.fm);Jn.set(Xi,Zo)}const Qn={};for(const Xi in Qe){const yo=Qe[Xi];yo instanceof i.b4&&(j(yo.layers,this.zoom,pt.brightness,ye,this.worldview),Qn[Xi]=i.fn(yo,Br,sn.positions,Gr,Jn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Vr,this.worldview))}const Ln={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ce,Gr,Vr,(()=>{Ln.iconsPending=!1,Tn(Qn,sn,Ln)})),this.rasterizeIfNeeded(Ce,En,ii,(()=>{Ln.patternsPending=!1,Tn(Qn,sn,Ln)}))}},Tn=(sn,Jn,Qn,Ln)=>{if(Qn.iconsPending||Qn.patternsPending)return;const Xi=new i.fo(Gr,En,this.lut);for(const yo in Qe){const Zo=Qe[yo];if(yo in sn)i.fp(Zo,sn[yo],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Gr,Xi);else if(Zo.hasPattern&&(Zo instanceof i.ba||Zo instanceof i.bb||Zo instanceof i.e7)){j(Zo.layers,this.zoom,pt.brightness,ye,this.worldview);const xs=Object.fromEntries(Xi.patternPositions);Zo.addFeatures(pt,this.tileID.canonical,xs,ye,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(Qe).filter((yo=>!yo.isEmpty())),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Jn.image,lineAtlas:It,imageAtlas:Xi,brightness:pt.brightness})};if(!this.extraShadowCaster){const sn=i.fj(pt.glyphDependencies,(Ln=>Object.keys(Ln).map(Number)));Object.keys(sn).length?Ce.send("getGlyphs",{uid:this.uid,stacks:sn},((Ln,Xi)=>{Ur||(Ur=Ln,Br=Xi,xi())}),void 0,!1,vi):Br={};const Jn=Array.from(pt.iconDependencies.keys()).map((Ln=>i.I.parse(Ln)));Jn.length?Ce.send("getImages",{images:Jn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Ln,Xi)=>{Ur||(Ur=Ln,Gr=new Map,Vr=this.updateImageMapAndGetImageTaskQueue(Gr,Xi,pt.iconDependencies),xi())}),void 0,!1,vi):(Gr=new Map,Vr=new Map);const Qn=Array.from(pt.patternDependencies.keys()).map((Ln=>i.I.parse(Ln)));Qn.length?Ce.send("getImages",{images:Qn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Ln,Xi)=>{Ur||(Ur=Ln,En=new Map,ii=this.updateImageMapAndGetImageTaskQueue(En,Xi,pt.patternDependencies),xi())}),void 0,!1,vi):(En=new Map,ii=new Map)}if(pt.elevationFeatures&&pt.elevationFeatures.length>0){const sn=[];for(const Qn of Object.values(Qe))if(Qn instanceof i.bb){const Ln=Qn.getUnevaluatedPortalGraph();Ln&&sn.push(Ln)}const Jn=i.fk.evaluate(sn);for(const Qn of Object.values(Qe))if(Qn instanceof i.bb){const Ln=ne.layers[Ye.decode(Qn.sourceLayerIndex)];Qn.setEvaluatedPortalGraph(Jn,Ln,this.tileID.canonical,pt.availableImages,pt.brightness)}}xi()};tr.length>0?Promise.allSettled(tr).then(yr).catch(Ie):yr()}rasterizeIfNeeded(ne,ce,ye,Me){Array.from(ce.values()).some((Ce=>Ce.usvg))?this.rasterize(ne,ce,ye,Me):Me()}updateImageMapAndGetImageTaskQueue(ne,ce,ye){const Me=new Map;for(const Ce of ce.keys()){const Ie=ye.get(Ce)||[];for(const Ye of Ie){const ze=Ye.toString(),Qe=ce.get(Ye.id.toString());Qe.usvg?Me.has(ze)||(Me.set(ze,Ye),ne.set(ze,Object.assign({},Qe))):ne.set(ze,Qe)}}return Me}rasterize(ne,ce,ye,Me){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ye},((Ce,Ie)=>{if(!Ce)for(const[Ye,ze]of Ie.entries()){const Qe=Object.assign(ce.get(Ye),{data:ze});ce.set(Ye,Qe)}Me()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function j(Fe,ne,ce,ye,Me){const Ce=new i.ac(ne,{brightness:ce,worldview:Me});for(const Ie of Fe)Ie.recalculate(Ce,ye)}class $ extends i.E{constructor(ne,ce,ye,Me,Ce,Ie,Ye){super(),this.actor=ne,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Me,this.loadVectorData=Ie||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(ne.scheduler),this.isSpriteLoaded=Ce,this.scheduler=ne.scheduler,this.brightness=Ye}loadTile(ne,ce){const ye=ne.uid,Me=ne&&ne.request,Ce=Me&&Me.collectResourceTiming,Ie=this.loading[ye]=new H(ne);Ie.abort=this.loadVectorData(ne,((Ye,ze)=>{const Qe=!this.loading[ye];if(delete this.loading[ye],Ie.cancelRasterize(),Qe||Ye||!ze)return Ie.status="done",Qe||(this.loaded[ye]=Ie),ce(Ye);const It=ze.rawData,pt={};ze.expires&&(pt.expires=ze.expires),ze.cacheControl&&(pt.cacheControl=ze.cacheControl),Ie.vectorTile=ze.vectorTile||new i.fq(new i.bt(It));const tr=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((pr,yr)=>{if(pr||!yr)return ce(pr);const Ur={};if(Ce){const Br=P(Me);Br.length>0&&(Ur.resourceTiming=JSON.parse(JSON.stringify(Br)))}ce(null,Object.assign({rawTileData:It.slice(0)},yr,pt,Ur))}))};this.isSpriteLoaded?tr():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(tr,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):tr()})),this.loaded=this.loaded||{},this.loaded[ye]=Ie}))}reloadTile(ne,ce){const ye=this.loaded,Me=ne.uid;if(ye&&ye[Me]){const Ce=ye[Me];Ce.scaleFactor=ne.scaleFactor,Ce.showCollisionBoxes=ne.showCollisionBoxes,Ce.projection=ne.projection,Ce.brightness=ne.brightness,Ce.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),Ce.extraShadowCaster=ne.extraShadowCaster,Ce.lut=ne.lut,Ce.worldview=ne.worldview;const Ie=(Ye,ze)=>{const Qe=Ce.reloadCallback;Qe&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Qe)),ce(Ye,ze)};Ce.status==="parsing"?Ce.reloadCallback=Ie:Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else ce(null,void 0)}abortTile(ne,ce){const ye=ne.uid,Me=this.loading[ye];Me&&(Me.abort&&Me.abort(),delete this.loading[ye]),ce()}removeTile(ne,ce){const ye=this.loaded,Me=ne.uid;ye&&ye[Me]&&delete ye[Me],ce()}}class Y{loadTile(ne,ce){const{uid:ye,encoding:Me,rawImageData:Ce,padding:Ie}=ne,Ye=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,Ie):Ce;ce(null,new i.fr(ye,Ye,Me,Ie<1))}reloadTile(ne,ce){ce(null,null)}abortTile(ne,ce){ce()}removeTile(ne,ce){ce()}getImageData(ne,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ye=this.offscreenCanvasContext.getImageData(-ce,-ce,ne.width+2*ce,ne.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}i.bs.setPbf(i.bt);class K{constructor(ne){this._mrt=new i.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ce){const ye=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ye.parseHeader(ne),this._isHeaderLoaded=!0;const Me=[];for(const Ce in ye.layers){const Ie=ye.getLayer(Ce),Ye=Ie.getDataRange(Ie.getBandList()),ze=ye.createDecodingTask(Ye),Qe=ne.slice(Ye.firstByte,Ye.lastByte+1),It=i.bs.performDecoding(Qe,ze).then((pt=>ze.complete(null,pt))).catch((pt=>ze.complete(pt,null)));Me.push(It)}Promise.allSettled(Me).then((()=>ce(null,ye))).catch((Ce=>ce(Ce)))}catch(Me){ce(Me)}}}class re{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ce){const ye=ne.uid,Me=ne.request,Ce=this.loading[ye]=new K(ne),{cancel:Ie}=i.bu(Me,((Ye,ze,Qe,It)=>{const pt=!this.loading[ye];if(delete this.loading[ye],pt||Ye||!ze)return Ce.status="done",pt||(this.loaded[ye]=Ce),ce(Ye);Ce.parse(ze,((tr,pr)=>{if(tr||!pr)return ce(tr);ce(null,pr,Qe,It)})),this.loaded[ye]=Ce}));Ce.abort=Ie}reloadTile(ne,ce){ce(null,void 0)}abortTile(ne,ce){const ye=ne.uid,Me=this.loading[ye];Me&&(Me.abort&&Me.abort(),delete this.loading[ye]),ce()}removeTile(ne,ce){const ye=ne.uid;this.loaded[ye]&&delete this.loaded[ye],ce()}decodeRasterArray(ne,ce){i.bs.performDecoding(ne.buffer,ne.task).then((ye=>ce(null,ye))).catch((ye=>ce(ye)))}}const se=i.fs.prototype.toGeoJSON;class J{constructor(ne){this._feature=ne,this.extent=i.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ce of this._feature.geometry)ne.push([new i.P(ce[0],ce[1])]);return ne}{const ne=[];for(const ce of this._feature.geometry){const ye=[];for(const Me of ce)ye.push(new i.P(Me[0],Me[1]));ne.push(ye)}return ne}}toGeoJSON(ne,ce,ye){return se.call(this,ne,ce,ye)}}class ae{constructor(ne,ce){this.name=ne,this.extent=i.al,this.length=ce.length,this._jsonFeatures=ce}feature(ne){return new J(this._jsonFeatures[ne])}}class de{constructor(ne){this.layers={},this.extent=i.al;for(const ce of Object.keys(ne))this.layers[ce]=new ae(ce,ne[ce])}}const Pe=64/4096,Ne=128;class rt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ce){for(const ye of ne){const Me=ye.id;if(Me==null)continue;let Ce=this.features.get(Me);Ce&&this.updateCache(Ce,ce),ye.geometry?(Ce=Ze(ye),this.updateCache(Ce,ce),this.features.set(Me,Ce)):this.features.delete(Me),this.updateCache(Ce,ce)}}updateCache(ne,ce){for(const{canonical:ye,uid:Me}of Object.values(ce)){const{z:Ce,x:Ie,y:Ye}=ye;ke(ne,Math.pow(2,Ce),Ie,Ye)&&delete ce[Me]}}getTile(ne,ce,ye){const Me=Math.pow(2,ne),Ce=[];for(const Ie of this.features.values())ke(Ie,Me,ce,ye)&&Ce.push(it(Ie,Me,ce,ye));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function ke({minX:Fe,minY:ne,maxX:ce,maxY:ye},Me,Ce,Ie){return Fe<(Ce+1+Pe)/Me&&ne<(Ie+1+Pe)/Me&&ce>(Ce-Pe)/Me&&ye>(Ie-Pe)/Me}function Ze(Fe){const{id:ne,geometry:ce,properties:ye}=Fe;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:Ce}=ce,Ie={id:ne,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Ie.geometry;if(Me==="Point")nt(Ce,Ye,Ie);else if(Me==="MultiPoint")for(const ze of Ce)nt(ze,Ye,Ie);else if(Me==="LineString")Ie.type=2,Je(Ce,Ye,Ie);else if(Me==="MultiLineString")Ie.type=2,ot(Ce,Ye,Ie);else if(Me==="Polygon")Ie.type=3,ot(Ce,Ye,Ie,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const ze of Ce)ot(ze,Ye,Ie,!0)}return Ie}function nt([Fe,ne],ce,ye){const Me=i.aF(Fe);let Ce=i.aJ(ne);Ce=Ce<0?0:Ce>1?1:Ce,ce.push(Me,Ce),ye.minX=Math.min(ye.minX,Me),ye.minY=Math.min(ye.minY,Ce),ye.maxX=Math.max(ye.maxX,Me),ye.maxY=Math.max(ye.maxY,Ce)}function Je(Fe,ne,ce,ye=!1,Me=!1){const Ce=[];for(const Ie of Fe)nt(Ie,Ce,ce);ne.push(Ce),ye&&(function(Ie,Ye){let ze=0;for(let Qe=0,It=Ie.length,pt=It-2;Qe<It;pt=Qe,Qe+=2)ze+=(Ie[Qe]-Ie[pt])*(Ie[Qe+1]+Ie[pt+1]);if(ze>0===Ye)for(let Qe=0,It=Ie.length;Qe<It/2;Qe+=2){const pt=Ie[Qe],tr=Ie[Qe+1];Ie[Qe]=Ie[It-2-Qe],Ie[Qe+1]=Ie[It-1-Qe],Ie[It-2-Qe]=pt,Ie[It-1-Qe]=tr}})(Ce,Me)}function ot(Fe,ne,ce,ye=!1){for(let Me=0;Me<Fe.length;Me++)Je(Fe[Me],ne,ce,ye,Me===0)}function it(Fe,ne,ce,ye){const{id:Me,type:Ce,geometry:Ie,tags:Ye}=Fe,ze=[];if(Ce===1)(function(Qe,It,pt,tr,pr){for(let yr=0;yr<Qe.length;yr+=2){const Ur=Math.round(i.al*(Qe[yr+0]*It-pt)),Br=Math.round(i.al*(Qe[yr+1]*It-tr));pr.push([Ur,Br])}})(Ie,ne,ce,ye,ze);else for(const Qe of Ie)Pt(Qe,ne,ce,ye,ze);return{id:Me,type:Ce,geometry:ze,tags:Ye}}function Pt(Fe,ne,ce,ye,Me){const Ce=-Ne,Ie=i.al+Ne;let Ye;for(let ze=0;ze<Fe.length-2;ze+=2){let Qe=Math.round(i.al*(Fe[ze+0]*ne-ce)),It=Math.round(i.al*(Fe[ze+1]*ne-ye)),pt=Math.round(i.al*(Fe[ze+2]*ne-ce)),tr=Math.round(i.al*(Fe[ze+3]*ne-ye));const pr=pt-Qe,yr=tr-It;Qe<Ce&&pt<Ce||(Qe<Ce?(It+=Math.round(yr*((Ce-Qe)/pr)),Qe=Ce):pt<Ce&&(tr=It+Math.round(yr*((Ce-Qe)/pr)),pt=Ce),It<Ce&&tr<Ce||(It<Ce?(Qe+=Math.round(pr*((Ce-It)/yr)),It=Ce):tr<Ce&&(pt=Qe+Math.round(pr*((Ce-It)/yr)),tr=Ce),Qe>=Ie&&pt>=Ie||(Qe>=Ie?(It+=Math.round(yr*((Ie-Qe)/pr)),Qe=Ie):pt>=Ie&&(tr=It+Math.round(yr*((Ie-Qe)/pr)),pt=Ie),It>=Ie&&tr>=Ie||(It>=Ie?(Qe+=Math.round(pr*((Ie-It)/yr)),It=Ie):tr>=Ie&&(pt=Qe+Math.round(pr*((Ie-It)/yr)),tr=Ie),Ye&&Qe===Ye[Ye.length-1][0]&&It===Ye[Ye.length-1][1]||(Ye=[[Qe,It]],Me.push(Ye)),Ye.push([pt,tr])))))}}function Ot({name:Fe,features:ne},ce){ce.writeStringField(1,Fe),ce.writeVarintField(5,i.al);const ye=new Map,Me=new Map,Ce={keys:ye,values:Me,feature:null};for(const Ie of ne)Ce.feature=Ie,ce.writeMessage(2,yt,Ce);for(const Ie of ye.keys())ce.writeStringField(3,Ie);for(const Ie of Me.keys())ce.writeMessage(4,an,Ie)}function yt(Fe,ne){const ce=Fe.feature;ce.id!==void 0&&Number.isSafeInteger(+ce.id)&&ne.writeVarintField(1,+ce.id),ce.tags&&ne.writeMessage(2,ar,Fe),ne.writeVarintField(3,ce.type),ne.writeMessage(4,Tr,ce)}function ar({keys:Fe,values:ne,feature:ce},ye){for(const Me of Object.keys(ce.tags)){let Ce=ce.tags[Me];if(Ce===null)continue;let Ie=Fe.get(Me);Ie===void 0&&(Ie=Fe.size,Fe.set(Me,Ie)),ye.writeVarint(Ie);const Ye=typeof Ce;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(Ce=JSON.stringify(Ce));let ze=ne.get(Ce);ze===void 0&&(ze=ne.size,ne.set(Ce,ze)),ye.writeVarint(ze)}}function qt(Fe,ne){return(ne<<3)+(7&Fe)}function rr(Fe){return Fe<<1^Fe>>31}function Tr(Fe,ne){const{geometry:ce,type:ye}=Fe;let Me=0,Ce=0;if(ye===1){ne.writeVarint(qt(1,ce.length));for(const Ie of ce){const Ye=Ie[0]-Me,ze=Ie[1]-Ce;ne.writeVarint(rr(Ye)),ne.writeVarint(rr(ze)),Me+=Ye,Ce+=ze}}else for(const Ie of ce){ne.writeVarint(qt(1,1));const Ye=Ie.length-(ye===3?1:0);for(let ze=0;ze<Ye;ze++){ze===1&&ne.writeVarint(qt(2,Ye-1));const Qe=Ie[ze][0]-Me,It=Ie[ze][1]-Ce;ne.writeVarint(rr(Qe)),ne.writeVarint(rr(It)),Me+=Qe,Ce+=It}ye===3&&ne.writeVarint(qt(7,1))}}function an(Fe,ne){const ce=typeof Fe;ce==="string"?ne.writeStringField(1,Fe):ce==="boolean"?ne.writeBooleanField(7,Fe):ce==="number"&&(Fe%1!=0?ne.writeDoubleField(3,Fe):Fe<0?ne.writeSVarintField(6,Fe):ne.writeVarintField(5,Fe))}const An={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Fe=>Fe},Fr=Math.fround||(nr=new Float32Array(1),Fe=>(nr[0]=+Fe,nr[0]));var nr;const Dr=3,er=5,or=6;class br{constructor(ne){this.options=Object.assign(Object.create(An),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:ye,maxZoom:Me}=this.options;ce&&console.time("total time");const Ce=`prepare ${ne.length} points`;ce&&console.time(Ce),this.points=ne;const Ie=[];for(let ze=0;ze<ne.length;ze++){const Qe=ne[ze];if(!Qe.geometry)continue;const[It,pt]=Qe.geometry.coordinates,tr=Fr(Hr(It)),pr=Fr(Zr(pt));Ie.push(tr,pr,1/0,ze,-1,1),this.options.reduce&&Ie.push(0)}let Ye=this.trees[Me+1]=this._createTree(Ie);ce&&console.timeEnd(Ce);for(let ze=Me;ze>=ye;ze--){const Qe=+Date.now();Ye=this.trees[ze]=this._createTree(this._cluster(Ye,ze)),ce&&console.log("z%d: %d clusters in %dms",ze,Ye.numItems,+Date.now()-Qe)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let ye=((ne[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,ne[1]));let Ce=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ye=-180,Ce=180;else if(ye>Ce){const pt=this.getClusters([ye,Me,180,Ie],ce),tr=this.getClusters([-180,Me,Ce,Ie],ce);return pt.concat(tr)}const Ye=this.trees[this._limitZoom(ce)],ze=Ye.range(Hr(ye),Zr(Ie),Hr(Ce),Zr(Me)),Qe=Ye.data,It=[];for(const pt of ze){const tr=this.stride*pt;It.push(Qe[tr+er]>1?jt(Qe,tr,this.clusterProps):this.points[Qe[tr+Dr]])}return It}getChildren(ne){const ce=this._getOriginId(ne),ye=this._getOriginZoom(ne),Me="No cluster with the specified id.",Ce=this.trees[ye];if(!Ce)throw new Error(Me);const Ie=Ce.data;if(ce*this.stride>=Ie.length)throw new Error(Me);const Ye=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),ze=Ce.within(Ie[ce*this.stride],Ie[ce*this.stride+1],Ye),Qe=[];for(const It of ze){const pt=It*this.stride;Ie[pt+4]===ne&&Qe.push(Ie[pt+er]>1?jt(Ie,pt,this.clusterProps):this.points[Ie[pt+Dr]])}if(Qe.length===0)throw new Error(Me);return Qe}getLeaves(ne,ce,ye){const Me=[];return this._appendLeaves(Me,ne,ce=ce||10,ye=ye||0,0),Me}getTile(ne,ce,ye){const Me=this.trees[this._limitZoom(ne)],Ce=Math.pow(2,ne),{extent:Ie,radius:Ye}=this.options,ze=Ye/Ie,Qe=(ye-ze)/Ce,It=(ye+1+ze)/Ce,pt={features:[]};return this._addTileFeatures(Me.range((ce-ze)/Ce,Qe,(ce+1+ze)/Ce,It),Me.data,ce,ye,Ce,pt),ce===0&&this._addTileFeatures(Me.range(1-ze/Ce,Qe,1,It),Me.data,Ce,ye,Ce,pt),ce===Ce-1&&this._addTileFeatures(Me.range(0,Qe,ze/Ce,It),Me.data,-1,ye,Ce,pt),pt.features.length?pt:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const ye=this.getChildren(ne);if(ce++,ye.length!==1)break;ne=ye[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,ye,Me,Ce){const Ie=this.getChildren(ce);for(const Ye of Ie){const ze=Ye.properties;if(ze&&ze.cluster?Ce+ze.point_count<=Me?Ce+=ze.point_count:Ce=this._appendLeaves(ne,ze.cluster_id,ye,Me,Ce):Ce<Me?Ce++:ne.push(Ye),ne.length===ye)break}return Ce}_createTree(ne){const ce=new i.c3(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<ne.length;ye+=this.stride)ce.add(ne[ye],ne[ye+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,ye,Me,Ce,Ie){for(const Ye of ne){const ze=Ye*this.stride,Qe=ce[ze+er]>1;let It,pt,tr;if(Qe)It=bn(ce,ze,this.clusterProps),pt=ce[ze],tr=ce[ze+1];else{const Ur=this.points[ce[ze+Dr]];It=Ur.properties;const[Br,Gr]=Ur.geometry.coordinates;pt=Hr(Br),tr=Zr(Gr)}const pr={type:1,geometry:[[Math.round(this.options.extent*(pt*Ce-ye)),Math.round(this.options.extent*(tr*Ce-Me))]],tags:It};let yr;yr=Qe||this.options.generateId?ce[ze+Dr]:this.points[ce[ze+Dr]].id,yr!==void 0&&(pr.id=yr),Ie.features.push(pr)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:ye,extent:Me,reduce:Ce,minPoints:Ie}=this.options,Ye=ye/(Me*Math.pow(2,ce)),ze=ne.data,Qe=[],It=this.stride;for(let pt=0;pt<ze.length;pt+=It){if(ze[pt+2]<=ce)continue;ze[pt+2]=ce;const tr=ze[pt],pr=ze[pt+1],yr=ne.within(ze[pt],ze[pt+1],Ye),Ur=ze[pt+er];let Br=Ur;for(const Gr of yr){const En=Gr*It;ze[En+2]>ce&&(Br+=ze[En+er])}if(Br>Ur&&Br>=Ie){let Gr,En=tr*Ur,Vr=pr*Ur,ii=-1;const vi=(pt/It<<5)+(ce+1)+this.points.length;for(const xi of yr){const Tn=xi*It;if(ze[Tn+2]<=ce)continue;ze[Tn+2]=ce;const sn=ze[Tn+er];En+=ze[Tn]*sn,Vr+=ze[Tn+1]*sn,ze[Tn+4]=vi,Ce&&(Gr||(Gr=this._map(ze,pt,!0),ii=this.clusterProps.length,this.clusterProps.push(Gr)),Ce(Gr,this._map(ze,Tn)))}ze[pt+4]=vi,Qe.push(En/Br,Vr/Br,1/0,vi,-1,Br),Ce&&Qe.push(ii)}else{for(let Gr=0;Gr<It;Gr++)Qe.push(ze[pt+Gr]);if(Br>1)for(const Gr of yr){const En=Gr*It;if(!(ze[En+2]<=ce)){ze[En+2]=ce;for(let Vr=0;Vr<It;Vr++)Qe.push(ze[En+Vr])}}}}return Qe}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,ye){if(ne[ce+er]>1){const Ie=this.clusterProps[ne[ce+or]];return ye?Object.assign({},Ie):Ie}const Me=this.points[ne[ce+Dr]].properties,Ce=this.options.map(Me);return ye&&Ce===Me?Object.assign({},Ce):Ce}}function jt(Fe,ne,ce){return{type:"Feature",id:Fe[ne+Dr],properties:bn(Fe,ne,ce),geometry:{type:"Point",coordinates:[(ye=Fe[ne],360*(ye-.5)),ni(Fe[ne+1])]}};var ye}function bn(Fe,ne,ce){const ye=Fe[ne+er],Me=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,Ce=Fe[ne+or],Ie=Ce===-1?{}:Object.assign({},ce[Ce]);return Object.assign(Ie,{cluster:!0,cluster_id:Fe[ne+Dr],point_count:ye,point_count_abbreviated:Me})}function Hr(Fe){return Fe/360+.5}function Zr(Fe){const ne=Math.sin(Fe*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function ni(Fe){const ne=(180-360*Fe)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function hi(Fe,ne,ce,ye){let Me=ye;const Ce=ne+(ce-ne>>1);let Ie,Ye=ce-ne;const ze=Fe[ne],Qe=Fe[ne+1],It=Fe[ce],pt=Fe[ce+1];for(let tr=ne+3;tr<ce;tr+=3){const pr=Lo(Fe[tr],Fe[tr+1],ze,Qe,It,pt);if(pr>Me)Ie=tr,Me=pr;else if(pr===Me){const yr=Math.abs(tr-Ce);yr<Ye&&(Ie=tr,Ye=yr)}}Me>ye&&(Ie-ne>3&&hi(Fe,ne,Ie,ye),Fe[Ie+2]=Me,ce-Ie>3&&hi(Fe,Ie,ce,ye))}function Lo(Fe,ne,ce,ye,Me,Ce){let Ie=Me-ce,Ye=Ce-ye;if(Ie!==0||Ye!==0){const ze=((Fe-ce)*Ie+(ne-ye)*Ye)/(Ie*Ie+Ye*Ye);ze>1?(ce=Me,ye=Ce):ze>0&&(ce+=Ie*ze,ye+=Ye*ze)}return Ie=Fe-ce,Ye=ne-ye,Ie*Ie+Ye*Ye}function ki(Fe,ne,ce,ye){const Me={id:Fe??null,type:ne,geometry:ce,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Go(Me,ce);else if(ne==="Polygon")Go(Me,ce[0]);else if(ne==="MultiLineString")for(const Ce of ce)Go(Me,Ce);else if(ne==="MultiPolygon")for(const Ce of ce)Go(Me,Ce[0]);return Me}function Go(Fe,ne){for(let ce=0;ce<ne.length;ce+=3)Fe.minX=Math.min(Fe.minX,ne[ce]),Fe.minY=Math.min(Fe.minY,ne[ce+1]),Fe.maxX=Math.max(Fe.maxX,ne[ce]),Fe.maxY=Math.max(Fe.maxY,ne[ce+1])}function Ni(Fe,ne,ce,ye){if(!ne.geometry)return;const Me=ne.geometry.coordinates;if(Me&&Me.length===0)return;const Ce=ne.geometry.type,Ie=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let Ye=[],ze=ne.id;if(ce.promoteId?ze=ne.properties[ce.promoteId]:ce.generateId&&(ze=ye||0),Ce==="Point")oo(Me,Ye);else if(Ce==="MultiPoint")for(const Qe of Me)oo(Qe,Ye);else if(Ce==="LineString")Ho(Me,Ye,Ie,!1);else if(Ce==="MultiLineString"){if(ce.lineMetrics){for(const Qe of Me)Ye=[],Ho(Qe,Ye,Ie,!1),Fe.push(ki(ze,"LineString",Ye,ne.properties));return}qa(Me,Ye,Ie,!1)}else if(Ce==="Polygon")qa(Me,Ye,Ie,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const Qe of ne.geometry.geometries)Ni(Fe,{id:ze,geometry:Qe,properties:ne.properties},ce,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Me){const It=[];qa(Qe,It,Ie,!0),Ye.push(It)}}Fe.push(ki(ze,Ce,Ye,ne.properties))}function oo(Fe,ne){ne.push(Ga(Fe[0]),Mo(Fe[1]),0)}function Ho(Fe,ne,ce,ye){let Me,Ce,Ie=0;for(let ze=0;ze<Fe.length;ze++){const Qe=Ga(Fe[ze][0]),It=Mo(Fe[ze][1]);ne.push(Qe,It,0),ze>0&&(Ie+=ye?(Me*It-Qe*Ce)/2:Math.sqrt(Math.pow(Qe-Me,2)+Math.pow(It-Ce,2))),Me=Qe,Ce=It}const Ye=ne.length-3;ne[2]=1,hi(ne,0,Ye,ce),ne[Ye+2]=1,ne.size=Math.abs(Ie),ne.start=0,ne.end=ne.size}function qa(Fe,ne,ce,ye){for(let Me=0;Me<Fe.length;Me++){const Ce=[];Ho(Fe[Me],Ce,ce,ye),ne.push(Ce)}}function Ga(Fe){return Fe/360+.5}function Mo(Fe){const ne=Math.sin(Fe*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function Wo(Fe,ne,ce,ye,Me,Ce,Ie,Ye){if(ye/=ne,Ce>=(ce/=ne)&&Ie<ye)return Fe;if(Ie<ce||Ce>=ye)return null;const ze=[];for(const Qe of Fe){const It=Qe.geometry;let pt=Qe.type;const tr=Me===0?Qe.minX:Qe.minY,pr=Me===0?Qe.maxX:Qe.maxY;if(tr>=ce&&pr<ye){ze.push(Qe);continue}if(pr<ce||tr>=ye)continue;let yr=[];if(pt==="Point"||pt==="MultiPoint")Zu(It,yr,ce,ye,Me);else if(pt==="LineString")_s(It,yr,ce,ye,Me,!1,Ye.lineMetrics);else if(pt==="MultiLineString")Zi(It,yr,ce,ye,Me,!1);else if(pt==="Polygon")Zi(It,yr,ce,ye,Me,!0);else if(pt==="MultiPolygon")for(const Ur of It){const Br=[];Zi(Ur,Br,ce,ye,Me,!0),Br.length&&yr.push(Br)}if(yr.length){if(Ye.lineMetrics&&pt==="LineString"){for(const Ur of yr)ze.push(ki(Qe.id,pt,Ur,Qe.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(yr.length===1?(pt="LineString",yr=yr[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=yr.length===3?"Point":"MultiPoint"),ze.push(ki(Qe.id,pt,yr,Qe.tags))}}return ze.length?ze:null}function Zu(Fe,ne,ce,ye,Me){for(let Ce=0;Ce<Fe.length;Ce+=3){const Ie=Fe[Ce+Me];Ie>=ce&&Ie<=ye&&ya(ne,Fe[Ce],Fe[Ce+1],Fe[Ce+2])}}function _s(Fe,ne,ce,ye,Me,Ce,Ie){let Ye=Lc(Fe);const ze=Me===0?Xu:Zs;let Qe,It,pt=Fe.start;for(let Br=0;Br<Fe.length-3;Br+=3){const Gr=Fe[Br],En=Fe[Br+1],Vr=Fe[Br+2],ii=Fe[Br+3],vi=Fe[Br+4],xi=Me===0?Gr:En,Tn=Me===0?ii:vi;let sn=!1;Ie&&(Qe=Math.sqrt(Math.pow(Gr-ii,2)+Math.pow(En-vi,2))),xi<ce?Tn>ce&&(It=ze(Ye,Gr,En,ii,vi,ce),Ie&&(Ye.start=pt+Qe*It)):xi>ye?Tn<ye&&(It=ze(Ye,Gr,En,ii,vi,ye),Ie&&(Ye.start=pt+Qe*It)):ya(Ye,Gr,En,Vr),Tn<ce&&xi>=ce&&(It=ze(Ye,Gr,En,ii,vi,ce),sn=!0),Tn>ye&&xi<=ye&&(It=ze(Ye,Gr,En,ii,vi,ye),sn=!0),!Ce&&sn&&(Ie&&(Ye.end=pt+Qe*It),ne.push(Ye),Ye=Lc(Fe)),Ie&&(pt+=Qe)}let tr=Fe.length-3;const pr=Fe[tr],yr=Fe[tr+1],Ur=Me===0?pr:yr;Ur>=ce&&Ur<=ye&&ya(Ye,pr,yr,Fe[tr+2]),tr=Ye.length-3,Ce&&tr>=3&&(Ye[tr]!==Ye[0]||Ye[tr+1]!==Ye[1])&&ya(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&ne.push(Ye)}function Lc(Fe){const ne=[];return ne.size=Fe.size,ne.start=Fe.start,ne.end=Fe.end,ne}function Zi(Fe,ne,ce,ye,Me,Ce){for(const Ie of Fe)_s(Ie,ne,ce,ye,Me,Ce,!1)}function ya(Fe,ne,ce,ye){Fe.push(ne,ce,ye)}function Xu(Fe,ne,ce,ye,Me,Ce){const Ie=(Ce-ne)/(ye-ne);return ya(Fe,Ce,ce+(Me-ce)*Ie,1),Ie}function Zs(Fe,ne,ce,ye,Me,Ce){const Ie=(Ce-ce)/(Me-ce);return ya(Fe,ne+(ye-ne)*Ie,Ce,1),Ie}function Ha(Fe,ne){const ce=[];for(let ye=0;ye<Fe.length;ye++){const Me=Fe[ye],Ce=Me.type;let Ie;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Ie=ys(Me.geometry,ne);else if(Ce==="MultiLineString"||Ce==="Polygon"){Ie=[];for(const Ye of Me.geometry)Ie.push(ys(Ye,ne))}else if(Ce==="MultiPolygon"){Ie=[];for(const Ye of Me.geometry){const ze=[];for(const Qe of Ye)ze.push(ys(Qe,ne));Ie.push(ze)}}ce.push(ki(Me.id,Ce,Ie,Me.tags))}return ce}function ys(Fe,ne){const ce=[];ce.size=Fe.size,Fe.start!==void 0&&(ce.start=Fe.start,ce.end=Fe.end);for(let ye=0;ye<Fe.length;ye+=3)ce.push(Fe[ye]+ne,Fe[ye+1],Fe[ye+2]);return ce}function jl(Fe,ne){if(Fe.transformed)return Fe;const ce=1<<Fe.z,ye=Fe.x,Me=Fe.y;for(const Ce of Fe.features){const Ie=Ce.geometry,Ye=Ce.type;if(Ce.geometry=[],Ye===1)for(let ze=0;ze<Ie.length;ze+=2)Ce.geometry.push(Zn(Ie[ze],Ie[ze+1],ne,ce,ye,Me));else for(let ze=0;ze<Ie.length;ze++){const Qe=[];for(let It=0;It<Ie[ze].length;It+=2)Qe.push(Zn(Ie[ze][It],Ie[ze][It+1],ne,ce,ye,Me));Ce.geometry.push(Qe)}}return Fe.transformed=!0,Fe}function Zn(Fe,ne,ce,ye,Me,Ce){return[Math.round(ce*(Fe*ye-Me)),Math.round(ce*(ne*ye-Ce))]}function $i(Fe,ne,ce,ye,Me){const Ce=ne===Me.maxZoom?0:Me.tolerance/((1<<ne)*Me.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:Fe.length,source:null,x:ce,y:ye,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Fe)Ku(Ie,Ye,Ce,Me);return Ie}function Ku(Fe,ne,ce,ye){const Me=ne.geometry,Ce=ne.type,Ie=[];if(Fe.minX=Math.min(Fe.minX,ne.minX),Fe.minY=Math.min(Fe.minY,ne.minY),Fe.maxX=Math.max(Fe.maxX,ne.maxX),Fe.maxY=Math.max(Fe.maxY,ne.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ye=0;Ye<Me.length;Ye+=3)Ie.push(Me[Ye],Me[Ye+1]),Fe.numPoints++,Fe.numSimplified++;else if(Ce==="LineString")zl(Ie,Me,Fe,ce,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ye=0;Ye<Me.length;Ye++)zl(Ie,Me[Ye],Fe,ce,Ce==="Polygon",Ye===0);else if(Ce==="MultiPolygon")for(let Ye=0;Ye<Me.length;Ye++){const ze=Me[Ye];for(let Qe=0;Qe<ze.length;Qe++)zl(Ie,ze[Qe],Fe,ce,!0,Qe===0)}if(Ie.length){let Ye=ne.tags||null;if(Ce==="LineString"&&ye.lineMetrics){Ye={};for(const Qe in ne.tags)Ye[Qe]=ne.tags[Qe];Ye.mapbox_clip_start=Me.start/Me.size,Ye.mapbox_clip_end=Me.end/Me.size}const ze={geometry:Ie,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ye};ne.id!==null&&(ze.id=ne.id),Fe.features.push(ze)}}function zl(Fe,ne,ce,ye,Me,Ce){const Ie=ye*ye;if(ye>0&&ne.size<(Me?Ie:ye))return void(ce.numPoints+=ne.length/3);const Ye=[];for(let ze=0;ze<ne.length;ze+=3)(ye===0||ne[ze+2]>Ie)&&(ce.numSimplified++,Ye.push(ne[ze],ne[ze+1])),ce.numPoints++;Me&&(function(ze,Qe){let It=0;for(let pt=0,tr=ze.length,pr=tr-2;pt<tr;pr=pt,pt+=2)It+=(ze[pt]-ze[pr])*(ze[pt+1]+ze[pr+1]);if(It>0===Qe)for(let pt=0,tr=ze.length;pt<tr/2;pt+=2){const pr=ze[pt],yr=ze[pt+1];ze[pt]=ze[tr-2-pt],ze[pt+1]=ze[tr-1-pt],ze[tr-2-pt]=pr,ze[tr-1-pt]=yr}})(Ye,Ce),Fe.push(Ye)}const va={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Yu{constructor(ne,ce){const ye=(ce=this.options=(function(Ce,Ie){for(const Ye in Ie)Ce[Ye]=Ie[Ye];return Ce})(Object.create(va),ce)).debug;if(ye&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=(function(Ce,Ie){const Ye=[];if(Ce.type==="FeatureCollection")for(let ze=0;ze<Ce.features.length;ze++)Ni(Ye,Ce.features[ze],Ie,ze);else Ni(Ye,Ce.type==="Feature"?Ce:{geometry:Ce},Ie);return Ye})(ne,ce);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=(function(Ce,Ie){const Ye=Ie.buffer/Ie.extent;let ze=Ce;const Qe=Wo(Ce,1,-1-Ye,Ye,0,-1,2,Ie),It=Wo(Ce,1,1-Ye,2+Ye,0,-1,2,Ie);return(Qe||It)&&(ze=Wo(Ce,1,-Ye,1+Ye,0,-1,2,Ie)||[],Qe&&(ze=Ha(Qe,1).concat(ze)),It&&(ze=ze.concat(Ha(It,-1)))),ze})(Me,ce),Me.length&&this.splitTile(Me,0,0,0),ye&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ce,ye,Me,Ce,Ie,Ye){const ze=[ne,ce,ye,Me],Qe=this.options,It=Qe.debug;for(;ze.length;){Me=ze.pop(),ye=ze.pop(),ce=ze.pop(),ne=ze.pop();const pt=1<<ce,tr=Ju(ce,ye,Me);let pr=this.tiles[tr];if(!pr&&(It>1&&console.time("creation"),pr=this.tiles[tr]=$i(ne,ce,ye,Me,Qe),this.tileCoords.push({z:ce,x:ye,y:Me}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ye,Me,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));const sn=`z${ce}`;this.stats[sn]=(this.stats[sn]||0)+1,this.total++}if(pr.source=ne,Ce==null){if(ce===Qe.indexMaxZoom||pr.numPoints<=Qe.indexMaxPoints)continue}else{if(ce===Qe.maxZoom||ce===Ce)continue;if(Ce!=null){const sn=Ce-ce;if(ye!==Ie>>sn||Me!==Ye>>sn)continue}}if(pr.source=null,ne.length===0)continue;It>1&&console.time("clipping");const yr=.5*Qe.buffer/Qe.extent,Ur=.5-yr,Br=.5+yr,Gr=1+yr;let En=null,Vr=null,ii=null,vi=null,xi=Wo(ne,pt,ye-yr,ye+Br,0,pr.minX,pr.maxX,Qe),Tn=Wo(ne,pt,ye+Ur,ye+Gr,0,pr.minX,pr.maxX,Qe);ne=null,xi&&(En=Wo(xi,pt,Me-yr,Me+Br,1,pr.minY,pr.maxY,Qe),Vr=Wo(xi,pt,Me+Ur,Me+Gr,1,pr.minY,pr.maxY,Qe),xi=null),Tn&&(ii=Wo(Tn,pt,Me-yr,Me+Br,1,pr.minY,pr.maxY,Qe),vi=Wo(Tn,pt,Me+Ur,Me+Gr,1,pr.minY,pr.maxY,Qe),Tn=null),It>1&&console.timeEnd("clipping"),ze.push(En||[],ce+1,2*ye,2*Me),ze.push(Vr||[],ce+1,2*ye,2*Me+1),ze.push(ii||[],ce+1,2*ye+1,2*Me),ze.push(vi||[],ce+1,2*ye+1,2*Me+1)}}getTile(ne,ce,ye){ne=+ne,ce=+ce,ye=+ye;const Me=this.options,{extent:Ce,debug:Ie}=Me;if(ne<0||ne>24)return null;const Ye=1<<ne,ze=Ju(ne,ce=ce+Ye&Ye-1,ye);if(this.tiles[ze])return jl(this.tiles[ze],Ce);Ie>1&&console.log("drilling down to z%d-%d-%d",ne,ce,ye);let Qe,It=ne,pt=ce,tr=ye;for(;!Qe&&It>0;)It--,pt>>=1,tr>>=1,Qe=this.tiles[Ju(It,pt,tr)];return Qe&&Qe.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",It,pt,tr),console.time("drilling down")),this.splitTile(Qe.source,It,pt,tr,ne,ce,ye),Ie>1&&console.timeEnd("drilling down"),this.tiles[ze]?jl(this.tiles[ze],Ce):null):null}}function Ju(Fe,ne,ce){return 32*((1<<Fe)*ce+ne)+Fe}function Ad(Fe,ne){const ce=Fe.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ye=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ye)return void ne(null,null);const Me=Qe=>Qe.tags&&"3d_elevation_id"in Qe.tags&&"source"in Qe.tags&&Qe.tags.source==="elevation",Ce=ye.features.filter((Qe=>Me(Qe)));let Ie={_geojsonTileLayer:ye.features};Ce.length>0&&(Ie={_geojsonTileLayer:ye.features.filter((Qe=>!Me(Qe))),hd_road_elevation:Ce});const Ye=new de(Ie),ze=(function(Qe){const It=new i.bt;for(const pt of Object.keys(Qe))It.writeMessage(3,Ot,{name:pt,features:Qe[pt]});return It.finish()})(Ie).buffer;ne(null,{vectorTile:Ye,rawData:ze})}class wt extends ${constructor(ne,ce,ye,Me,Ce,Ie,Ye){super(ne,ce,ye,Me,Ce,Ad,Ye),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new rt}loadData(ne,ce){const ye=ne&&ne.request,Me=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,((Ce,Ie)=>{if(Ce||!Ie)return ce(Ce);if(typeof Ie!="object")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const ze=i.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map((Qe=>`${Qe.key}: ${Qe.message}`)).join(", "));Ie.features=Ie.features.filter((Qe=>ze.value.evaluate({zoom:0},Qe)))}ne.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),ne.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new br((function({superclusterOptions:ze,clusterProperties:Qe}){if(!Qe||!ze)return ze;const It={},pt={},tr={accumulated:null,zoom:0},pr={properties:null},yr=Object.keys(Qe);for(const Ur of yr){const[Br,Gr]=Qe[Ur],En=i.U(Gr),Vr=i.U(typeof Br=="string"?[Br,["accumulated"],["get",Ur]]:Br);It[Ur]=En.value,pt[Ur]=Vr.value}return ze.map=Ur=>{pr.properties=Ur;const Br={};for(const Gr of yr)Br[Gr]=It[Gr].evaluate(tr,pr);return Br},ze.reduce=(Ur,Br)=>{pr.properties=Br;for(const Gr of yr)tr.accumulated=Ur[Gr],Ur[Gr]=pt[Gr].evaluate(tr,pr)},ze})(ne)).load(Ie.features):ne.dynamic?this._dynamicIndex:(function(ze,Qe){return new Yu(ze,Qe)})(Ie,ne.geojsonVtOptions)}catch(ze){return ce(ze)}const Ye={};if(Me){const ze=P(ye);ze&&(Ye.resourceTiming={},Ye.resourceTiming[ne.source]=JSON.parse(JSON.stringify(ze)))}ce(null,Ye)}}))}reloadTile(ne,ce){const ye=this.loaded;return ye&&ye[ne.uid]?ne.partial?ce(null,void 0):super.reloadTile(ne,ce):this.loadTile(ne,ce)}loadGeoJSON(ne,ce){if(ne.request)i.m(ne.request,ce);else{if(typeof ne.data!="string")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return ce(null,JSON.parse(ne.data))}catch{return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(ne,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ye){ce(ye)}}getClusterChildren(ne,ce){try{ce(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ye){ce(ye)}}getClusterLeaves(ne,ce){try{ce(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ye){ce(ye)}}}class vs{constructor(ne,ce,ye){this.tileID=new i.aO(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ce,this.worldview=ye}parse(ne,ce,ye,Me){this.status="parsing";const Ce=new i.aO(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Ie=[],Ye=ce.familiesBySource[ye.source],ze=new i.fe(Ce,ye.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,i.ft(ne).then((Qe=>{if(!Qe)return Me(new Error("Could not parse tile"));const It=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qe.json.asset.extras&&Qe.json.asset.extras.MAPBOX_mesh_features,pt=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("EXT_meshopt_compression"),tr=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const pr in Ye)for(const yr of Ye[pr]){const Ur=yr[0];ze.bucketLayerIDs.push(yr.map((En=>i.B(En.id,En.scope)))),Ur.recalculate(tr,[]);const Br=i.fu(Qe,1/i.d6(ye.tileID.canonical)),Gr=new i.fv(yr,Br,Ce,It,pt,this.brightness,ze,this.worldview);It||(Gr.needsUpload=!0),Ie.push(Gr),Gr.evaluate(Ur)}this.status="done",Me(null,{buckets:Ie,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Qe=>Me(new Error(Qe.message))))}}class pm{constructor(ne,ce,ye,Me,Ce,Ie,Ye,ze){this.actor=ne,this.layerIndex=ce,this.availableImages=ye,this.availableModels=Me,this.brightness=Ye,this.loading={},this.loaded={},this.worldview=ze}loadTile(ne,ce){const ye=ne.uid,Me=this.loading[ye]=new vs(ne,this.brightness,this.worldview);i.bu(ne.request,((Ce,Ie)=>{const Ye=!this.loading[ye];return delete this.loading[ye],Ye||Ce?(Me.status="done",Ye||(this.loaded[ye]=Me),ce(Ce)):Ie&&Ie.byteLength!==0?void Me.parse(Ie,this.layerIndex,ne,((ze,Qe)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Me,ze||!Qe?ce(ze):ce(null,Qe)})):(Me.status="done",this.loaded[ye]=Me,ce())}))}reloadTile(ne,ce){const ye=this.loaded,Me=ne.uid;if(ye&&ye[Me]){const Ce=ye[Me];Ce.projection=ne.projection,Ce.brightness=ne.brightness;const Ie=(Ye,ze)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(ne,ce)),ce(Ye,ze)};Ce.status==="parsing"?Ce.reloadCallback=Ie:Ce.status==="done"&&this.loadTile(ne,ce)}}abortTile(ne,ce){const ye=ne.uid;this.loading[ye]&&delete this.loading[ye],ce()}removeTile(ne,ce){const ye=this.loaded,Me=ne.uid;ye&&ye[Me]&&delete ye[Me],ce()}}class jc{constructor(ne){this.self=ne,this.actor=new i.fx(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:$,geojson:wt,"raster-dem":Y,"raster-array":re,"batched-model":pm},this.workerSources={},this.self.registerWorkerSource=(ce,ye)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=ye},this.self.registerRTLTextPlugin=ce=>{if(i.fy.isParsed())throw new Error("RTL text plugin already registered.");i.fy.setState({pluginStatus:i.fz.parsed,pluginURL:i.fy.getPluginURL()}),i.fy.applyArabicShaping=ce.applyArabicShaping,i.fy.processBidirectionalText=ce.processBidirectionalText,i.fy.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ce,ye){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ye()}checkIfReady(ne,ce,ye){ye()}setReferrer(ne,ce){this.referrer=ce}spriteLoaded(ne,ce){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ye,isLoaded:Me}=ce;if(this.isSpriteLoaded[ne][ye]=Me,this.workerSources[ne]&&this.workerSources[ne][ye])for(const Ce in this.workerSources[ne][ye]){const Ie=this.workerSources[ne][ye][Ce];for(const Ye in Ie){const ze=Ie[Ye];ze instanceof $&&(ze.isSpriteLoaded=Me,ze.fire(new i.z("isSpriteLoaded")))}}}setImages(ne,ce,ye){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:Me,images:Ce}=ce;if(this.availableImages[ne][Me]=Ce,this.workerSources[ne]&&this.workerSources[ne][Me]){for(const Ie in this.workerSources[ne][Me]){const Ye=this.workerSources[ne][Me][Ie];for(const ze in Ye)Ye[ze].availableImages=Ce}ye()}else ye()}setModels(ne,{scope:ce,models:ye},Me){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ce]=ye,this.workerSources[ne]&&this.workerSources[ne][ce]){for(const Ce in this.workerSources[ne][ce]){const Ie=this.workerSources[ne][ce][Ce];for(const Ye in Ie)Ie[Ye].availableModels=ye}Me()}else Me()}setProjection(ne,ce){this.projections[ne]=i.cl(ce)}setBrightness(ne,ce,ye){this.brightness=ce,ye()}setWorldview(ne,ce,ye){this.worldview=ce,ye()}setLayers(ne,ce,ye){this.getLayerIndex(ne,ce.scope).replace(ce.layers,ce.options),ye()}updateLayers(ne,ce,ye){this.getLayerIndex(ne,ce.scope).update(ce.layers,ce.removedIds,ce.options),ye()}loadTile(ne,ce,ye){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).loadTile(ce,ye)}decodeRasterArray(ne,ce,ye){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).decodeRasterArray(ce,ye)}reloadTile(ne,ce,ye){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).reloadTile(ce,ye)}abortTile(ne,ce,ye){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).abortTile(ce,ye)}removeTile(ne,ce,ye){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).removeTile(ce,ye)}removeSource(ne,ce,ye){if(!(this.workerSources[ne]&&this.workerSources[ne][ce.scope]&&this.workerSources[ne][ce.scope][ce.type]&&this.workerSources[ne][ce.scope][ce.type][ce.source]))return;const Me=this.workerSources[ne][ce.scope][ce.type][ce.source];delete this.workerSources[ne][ce.scope][ce.type][ce.source],Me.removeSource!==void 0?Me.removeSource(ce,ye):ye()}loadWorkerSource(ne,ce,ye){try{this.self.importScripts(ce.url),ye()}catch(Me){ye(Me.toString())}}syncRTLPluginState(ne,ce,ye){if(i.fy.isParsed())ye(null,!0);else if(i.fy.isParsing())this.rtlPluginParsingListeners.push(ye);else try{i.fy.setState(ce);const Me=i.fy.getPluginURL();!i.fy.isLoaded()||i.fy.isParsed()||i.fy.isParsing()||Me==null||(i.fy.setState({pluginStatus:i.fz.parsing,pluginURL:i.fy.getPluginURL()}),this.self.importScripts(Me),i.fy.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Me){ye(Me.toString())}}setDracoUrl(ne,ce){this.dracoUrl=ce}getAvailableImages(ne,ce){this.availableImages[ne]||(this.availableImages[ne]={});let ye=this.availableImages[ne][ce];return ye||(ye=[]),ye}getAvailableModels(ne,ce){this.availableModels[ne]||(this.availableModels[ne]={});let ye=this.availableModels[ne][ce];return ye||(ye={}),ye}getLayerIndex(ne,ce){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ye=this.layerIndexes[ne][ce];return ye||(ye=this.layerIndexes[ne][ce]=new R,ye.scope=ce),ye}getWorkerSource(ne,ce,ye,Me){const Ce=this.workerSources;return Ce[ne]||(Ce[ne]={}),Ce[ne][Me]||(Ce[ne][Me]={}),Ce[ne][Me][ce]||(Ce[ne][Me][ce]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),Ce[ne][Me][ce][ye]||(Ce[ne][Me][ce][ye]=new this.workerSourceTypes[ce]({send:(Ie,Ye,ze,Qe,It,pt)=>this.actor.send(Ie,Ye,ze,ne,It,pt),scheduler:this.actor.scheduler},this.getLayerIndex(ne,Me),this.getAvailableImages(ne,Me),this.getAvailableModels(ne,Me),this.isSpriteLoaded[ne][Me],void 0,this.brightness,this.worldview)),Ce[ne][Me][ce][ye]}rasterizeImagesWorker(ne,ce,ye){const Me=new Map;for(const[Ce,{image:Ie,imageVariant:Ye}]of ce.tasks.entries()){const ze=this.imageRasterizer.rasterize(Ye,Ie,ce.scope,ne);Me.set(Ce,ze)}ye(void 0,Me)}removeRasterizedImages(ne,ce,ye){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,ne),ye()}enforceCacheSizeLimit(ne,ce){i.fA(ce)}getWorkerPerformanceMetrics(ne,ce,ye){ye(void 0,void 0)}}return i.fw(self)&&(self.worker=new jc(self)),jc})),_(["./shared"],(function(i){var P="3.15.0";const I={create:"create",load:"load",fullLoad:"fullLoad"},M={mark(p){performance.mark(p)},measure(p,n,c){performance.measure(p,n,c)}};function R(p){const n=p.name.split("?")[0];return i.a(n)&&n.includes("mapbox-gl.js")?"javascript":i.a(n)&&n.includes("mapbox-gl.css")?"css":i.b(n)?"fontRange":i.c(n)?"sprite":i.i(n)?"style":i.d(n)?"tilejson":"other"}var F,q={},H=(function(){if(F)return q;function p(f){return!n(f)}function n(f){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,w,A=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(A);try{w=new Worker(C),x=!0}catch{x=!1}return w&&w.terminate(),URL.revokeObjectURL(C),x})()?(function(){var x=document.createElement("canvas");x.width=x.height=1;var w=x.getContext("2d");if(!w)return!1;var A=w.getImageData(0,0,1,1);return A&&A.width===x.width})()?(c[y=f&&f.failIfMajorPerformanceCaveat]===void 0&&(c[y]=(function(x){var w,A=(function(C){var k=document.createElement("canvas"),L=Object.create(p.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=C,k.getContext("webgl2",L)})(x);if(!A)return!1;try{w=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!w||A.isContextLost())&&(A.shaderSource(w,"void main() {}"),A.compileShader(w),A.getShaderParameter(w,A.COMPILE_STATUS)===!0)})(y)),c[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}F=1,q.supported=p,q.notSupportedReason=n;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},q})();function j(p,n,c){const f=document.createElement(p);return n!=null&&(f.className=n),c&&c.appendChild(f),f}function $(p,n,c){const f=document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(n))f.setAttributeNS(null,y,String(n[y]));return c&&c.appendChild(f),f}const Y=typeof document<"u"?document.documentElement&&document.documentElement.style:null,K=Y&&Y.userSelect!==void 0?"userSelect":"WebkitUserSelect";let re;function se(){Y&&K&&(re=Y[K],Y[K]="none")}function J(){Y&&K&&(Y[K]=re)}function ae(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",ae,!0)}function de(){window.addEventListener("click",ae,!0),window.setTimeout((()=>{window.removeEventListener("click",ae,!0)}),0)}function Pe(p,n){const c=p.getBoundingClientRect();return ke(p,c,n)}function Ne(p,n){const c=p.getBoundingClientRect(),f=[];for(let y=0;y<n.length;y++)f.push(ke(p,c,n[y]));return f}function rt(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function ke(p,n,c){const f=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new i.P((c.clientX-n.left)*f,(c.clientY-n.top)*f)}const Ze="01",nt="NO_ACCESS_TOKEN";class Je{constructor(n,c,f){this._transformRequestFn=n,this._customAccessToken=c,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const n=(function(){let c="";for(let f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ze,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,c){return this._transformRequestFn&&this._transformRequestFn(n,c)||{url:n}}normalizeStyleURL(n,c){if(!i.h(n))return n;const f=it(n);return f.params.push(`sdk=js-${P}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeGlyphsURL(n,c){if(!i.h(n))return n;const f=it(n);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeModelURL(n,c){if(!i.h(n))return n;const f=it(n);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeSourceURL(n,c,f,y){if(!i.h(n))return n;const x=it(n);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),f&&x.params.push(`language=${f}`),y&&x.params.push(`worldview=${y}`),this._makeAPIURL(x,this._customAccessToken||c)}normalizeIconsetURL(n,c){const f=it(n);return i.h(n)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||c)):Pt(f)}normalizeSpriteURL(n,c,f,y){const x=it(n);return i.h(n)?(x.path=`/styles/v1${x.path}/sprite${c}${f}`,this._makeAPIURL(x,this._customAccessToken||y)):(x.path+=`${c}${f}`,Pt(x))}normalizeTileURL(n,c,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!i.h(n))return n;const y=it(n);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||f&&y.authority!=="raster"&&f===512?"@2x":""}${i.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${i.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${i.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${i.e.TILE_URL_VERSION}${y.path}`);const x=this._customAccessToken||(function(w){for(const A of w){const C=A.match(/^access_token=(.*)$/);if(C)return C[1]}return null})(y.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,x)}canonicalizeTileURL(n,c){const f=it(n);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return n;let y="mapbox://";f.path.match(/^\/raster\/v1\//)?y+=`raster/${f.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${f.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${f.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let x=f.params;return c&&(x=x.filter((w=>!w.match(/^access_token=/)))),x.length&&(y+=`?${x.join("&")}`),y}canonicalizeTileset(n,c){const f=!!c&&i.h(c),y=[];for(const x of n.tiles||[])i.j(x)?y.push(this.canonicalizeTileURL(x,f)):y.push(x);return y}_makeAPIURL(n,c){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=it(i.e.API_URL);if(n.protocol=y.protocol,n.authority=y.authority,n.protocol==="http"){const x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(y.path!=="/"&&(n.path=`${y.path}${n.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Pt(n);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return n.params=n.params.filter((x=>x.indexOf("access_token")===-1)),n.params.push(`access_token=${c||""}`),Pt(n)}}const ot=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(p){const n=p.match(ot);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Pt(p){const n=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${n}`}const Ot="mapbox.eventData";function yt(p){if(!p)return null;const n=p.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(i.l(n[1]))}catch{return null}}class ar{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const c=yt(i.e.ACCESS_TOKEN);let f="";return f=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",n?`${Ot}.${n}:${f}`:`${Ot}:${f}`}fetchEventData(){const n=i.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid");if(n)try{const y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));const x=localStorage.getItem(f);x&&(this.anonId=x)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const n=i.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),y=this.anonId;if(n&&y)try{localStorage.setItem(f,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,c,f,y){if(!i.e.EVENTS_URL)return;const x=it(i.e.EVENTS_URL);x.params.push(`access_token=${y||i.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(n).toISOString()},A=c?Object.assign(w,c):w,C={url:Pt(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=i.p(C,(k=>{this.pendingRequest=null,f(k),this.saveEventData(),this.processRequests(y)}))}queueRequest(n,c){this.queue.push(n),this.processRequests(c)}}const qt=new class extends ar{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,n){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some((c=>i.h(c)||i.j(c)))&&this.queueRequest(Date.now(),n)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=yt(i.e.ACCESS_TOKEN),c=n?n.u:i.e.ACCESS_TOKEN;let f=c!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),f=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(y),A=(y-this.eventData.lastSuccess)/864e5;f=f||A>=1||A<-1||x.getDate()!==w.getDate()}else f=!0;f?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Ze,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=y,this.eventData.tokenU=c)}),p):this.processRequests()}},rr=qt.postTurnstileEvent.bind(qt),Tr=new class extends ar{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,n,c,f){this.skuToken=n,this.errorCb=f,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(nt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Ze,skuToken:this.skuToken,userId:this.anonId},(f=>{f?this.errorCb(f):n&&(this.success[n]=!0)}),p))}remove(){this.errorCb=null}},an=Tr.postMapLoadEvent.bind(Tr),An=new class extends ar{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let n=this.mapInstanceIdMap.get(p);return n||(n=i.u(),this.mapInstanceIdMap.set(p,n)),n}getEventId(p){const n=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,n+1),n}postStyleLoadEvent(p,n){const{map:c,style:f,importedStyles:y}=n;if(!i.e.EVENTS_URL||!p&&!i.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(c),w={mapInstanceId:x,eventId:this.getEventId(x),style:f};y.length&&(w.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:w},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,(()=>{}),p)}},Fr=An.postStyleLoadEvent.bind(An),nr=new class extends ar{constructor(){super("gljs.performance")}postPerformanceEvent(p,n){i.e.EVENTS_URL&&(p||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:c}=this.queue.shift(),f=(function(y){const x=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),A=(function(G){const W={};if(G){for(const Z in G)if(Z!=="other")for(const oe of G[Z]){const te=`${Z}ResolveRangeMin`,le=`${Z}ResolveRangeMax`,fe=`${Z}RequestCount`,me=`${Z}RequestCachedCount`;W[te]=Math.min(W[te]||1/0,oe.startTime),W[le]=Math.max(W[le]||-1/0,oe.responseEnd);const we=xe=>{W[xe]===void 0&&(W[xe]=0),++W[xe]};oe.transferSize!==void 0&&oe.transferSize===0&&we(me),we(fe)}}return W})((function(G,W){const Z={};if(G)for(const oe of G){const te=W(oe);Z[te]===void 0&&(Z[te]=[]),Z[te].push(oe)}return Z})(x,R)),C=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=k?k.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},z=(G,W,Z)=>{Z!=null&&G.push({name:W,value:Z.toString()})};for(const G in A)z(V.counters,G,A[G]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(z(V.counters,"interactionRangeMin",y.interactionRange[0]),z(V.counters,"interactionRangeMax",y.interactionRange[1])),w)for(const G of Object.keys(I)){const W=I[G],Z=w.find((oe=>oe.name===W));Z&&z(V.counters,W,Z.startTime)}return z(V.counters,"visibilityHidden",y.visibilityHidden),z(V.attributes,"style",(function(G){if(G)for(const W of G){const Z=W.name.split("?")[0];if(i.i(Z)){const oe=Z.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}})(x)),z(V.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),z(V.attributes,"fogEnabled",y.fogEnabled?"true":"false"),z(V.attributes,"projection",y.projection),z(V.attributes,"zoom",y.zoom),z(V.metadata,"devicePixelRatio",C),z(V.metadata,"connectionEffectiveType",L),z(V.metadata,"navigatorUserAgent",navigator.userAgent),z(V.metadata,"screenWidth",window.screen.width),z(V.metadata,"screenHeight",window.screen.height),z(V.metadata,"windowWidth",window.innerWidth),z(V.metadata,"windowHeight",window.innerHeight),z(V.metadata,"mapWidth",y.width/C),z(V.metadata,"mapHeight",y.height/C),z(V.metadata,"webglRenderer",y.renderer),z(V.metadata,"webglVendor",y.vendor),z(V.metadata,"sdkVersion",P),z(V.metadata,"sdkIdentifier","mapbox-gl-js"),V})(c);for(const y of f.metadata);for(const y of f.counters);for(const y of f.attributes);this.postEvent(n,f,(()=>{}),p)}},Dr=nr.postPerformanceEvent.bind(nr),er=new class extends ar{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,n,c,f){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const y=it(i.e.API_URL+i.e.SESSION_PATH);y.params.push(`sku=${n||""}`),y.params.push(`access_token=${f||i.e.ACCESS_TOKEN||""}`);const x={url:Pt(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(x,(w=>{this.pendingRequest=null,c(w),this.saveEventData(),this.processRequests(f)}))}getSessionAPI(p,n,c,f){this.skuToken=n,this.errorCb=f,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(nt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||this.getSession(c,this.skuToken,(f=>{f?this.errorCb(f):n&&(this.success[n]=!0)}),p)}remove(){this.errorCb=null}},or=er.getSessionAPI.bind(er),br=new Set;function jt(p,n){n?br.add(p):br.delete(p)}class bn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,c){this._updatedSourceCaches[n]=c,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const c=n.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(n.id),this.setDirty()}removeLayer(n){const c=n.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][n.id]=n,this._updatedLayers[c].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const c in this._updatedLayers)n[c]=n[c]||{},n[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)n[c]=n[c]||{},n[c].removedIds=Object.keys(this._removedLayers[c]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Hr(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class Zr extends i.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new i.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const c=this.atlasTexture.get(n);c&&(c.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(n.id,n)}removeImageProvider(n,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(n)}getPendingImageProviders(){const n=[];for(const c of this.imageProviders.values())for(const f of c.values())f.hasPendingRequests()&&n.push(f);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,c){if(this.loaded.get(c)!==n&&(this.loaded.set(c,n),n)){for(const{ids:f,callback:y}of this.requestors)this._notify(f,c,y);this.requestors=[]}}hasImage(n,c){return!!this.getImage(n,c)}getImage(n,c){return this.images.get(c).get(n.toString())}addImage(n,c,f){this._validate(n,f)&&this.images.get(c).set(n.toString(),f)}_validate(n,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new i.y(new Error(`Image "${n.name}" has invalid "content" value`))),f=!1),f}_validateStretch(n,c){if(!n)return!0;let f=0;for(const y of n){if(y[0]<f||y[1]<y[0]||c<y[1])return!1;f=y[1]}return!0}_validateContent(n,c){return n?n.length!==4||!c.usvg&&(n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,c,f){const y=this.images.get(c).get(n.toString());f.version=y.version+1,this.images.get(c).set(n.toString(),f),this.updatedImages.get(c).add(n),this.removeFromImageRasterizerCache(n,c)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,c){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([n],c))}removeImage(n,c){const f=this.images.get(c),y=f.get(n.toString());f.delete(n.toString()),this.patterns.get(c).delete(n.toString()),this.removeFromImageRasterizerCache(n,c),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map((c=>i.I.from(c)))}getImages(n,c,f){const y=[],x=[],w=this.imageProviders.get(c);for(const L of n){if(!L.iconsetId){y.push(L);continue}const V=w.get(L.iconsetId);V&&(this.getImage(L,c)?x.push(L):V.addPendingRequest(L))}if(y.length===0)return void this._notify(x,c,f);let A=!0;const C=!!this.loaded.get(c),k=this.images.get(c);if(!C)for(const L of y)k.has(L.toString())||(A=!1);C||A?this._notify(y,c,f):this.requestors.push({ids:y,scope:c,callback:f})}rasterizeImages(n,c){const f=new Map,{tasks:y,scope:x}=n;for(const[w,A]of y.entries()){const C=this.getImage(A.id,x);C&&f.set(w,{image:C,imageVariant:A})}this._rasterizeImages(x,f,c)}_rasterizeImages(n,c,f){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:n},f);else{const y=new Map;for(const[x,{image:w,imageVariant:A}]of c.entries())y.set(x,this.imageRasterizer.rasterize(A,w,n,0));f(void 0,y)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,c,f){const y=this.images.get(c),x=new Map;for(const w of n){if(!y.get(w.toString())){if(w.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:w.name}))}const A=y.get(w.toString());if(!A){i.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:A.usvg?null:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,usvg:A.usvg,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)};A.usvg&&Object.assign(C,{width:A.icon.usvg_tree.width,height:A.icon.usvg_tree.height}),x.set(i.I.toString(w),C)}f(null,x)}getPixelSize(n){const{width:c,height:f}=this.atlasImage.get(n);return{width:c,height:f}}getPattern(n,c,f){const y=n.toString(),x=this.patterns.get(c),w=x.get(y),A=this.getImage(n,c);if(!A)return null;if(w){if(w.position.version===A.version)return w.position;w.position.version=A.version}else{if(A.usvg&&!A.data){const C=this.getPatternInFlightId(y,c);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const k=new i.A(n).scaleSelf(i.o.devicePixelRatio),L=new Map([[k.toString(),{image:A,imageVariant:k}]]);return this._rasterizeImages(c,L,((V,z)=>this.storePatternImage(k,c,A,f,z))),null}this.storePattern(n,c,A)}return this._updatePatternAtlas(c,f),x.get(y).position}getPatternInFlightId(n,c){return i.B(n,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,c,f,y,x){const w=n.toString(),A=x?x.get(w):void 0;A&&(f.data=A,this.storePattern(n.id,c,f),this._updatePatternAtlas(c,y),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),c)))}storePattern(n,c,f){const y={w:f.data.width+2*i.C,h:f.data.height+2*i.C,x:0,y:0},x=new i.F(y,f,i.C);this.patterns.get(c).set(n.toString(),{bin:y,position:x})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,c){const f=n.gl;let y=this.atlasTexture.get(c);y?this.dirty&&(y.update(this.atlasImage.get(c)),this.dirty=!1):(y=new i.T(n,this.atlasImage.get(c),f.RGBA8),this.atlasTexture.set(c,y)),y.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(n,c){const f=this.patterns.get(n),y=Array.from(f.values()).map((({bin:k})=>k)),{w:x,h:w}=i.G(y),A=this.atlasImage.get(n);A.resize({width:x||1,height:w||1});const C=this.images.get(n);for(const[k,{bin:L,position:V}]of f.entries()){let z=V.padding;const G=L.x+z,W=L.y+z,Z=C.get(k).data,oe=Z.width,te=Z.height;z=z>1?z-1:z,i.q.copy(Z,A,{x:0,y:0},{x:G,y:W},{width:oe,height:te},c),i.q.copy(Z,A,{x:0,y:te-z},{x:G,y:W-z},{width:oe,height:z},c),i.q.copy(Z,A,{x:0,y:0},{x:G,y:W+te},{width:oe,height:z},c),i.q.copy(Z,A,{x:oe-z,y:0},{x:G-z,y:W},{width:z,height:te},c),i.q.copy(Z,A,{x:0,y:0},{x:G+oe,y:W},{width:z,height:te},c),i.q.copy(Z,A,{x:oe-z,y:te-z},{x:G-z,y:W-z},{width:z,height:z},c),i.q.copy(Z,A,{x:0,y:te-z},{x:G+oe,y:W-z},{width:z,height:z},c),i.q.copy(Z,A,{x:0,y:0},{x:G+oe,y:W+te},{width:z,height:z},c),i.q.copy(Z,A,{x:oe-z,y:0},{x:G-z,y:W+te},{width:z,height:z},c)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,c){const f=this.images.get(c);for(const y of n){if(this.callbackDispatchedThisFrame.get(c).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(y.toString());const x=f.get(y.toString());Hr(x)&&this.updateImage(y,c,x)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function ni(p){const n=p.value,c=p.valueSpec,f=p.style,y=p.styleSpec,x=p.key,w=p.arrayElementValidator||Zn;if(!Array.isArray(n))return[new i.V(x,n,`array expected, ${i.K(n)} found`)];if(c.length&&n.length!==c.length)return[new i.V(x,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new i.V(x,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let A={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};y.$version<7&&(A.function=c.function),i.H(c.value)&&(A=c.value);let C=[];for(let k=0;k<n.length;k++)C=C.concat(w({array:n,arrayIndex:k,value:n[k],valueSpec:A,style:f,styleSpec:y,key:`${x}[${k}]`},!0));return C}function hi(p){const n=p.key,c=p.value,f=p.valueSpec;if(!i.L(c))return[new i.V(n,c,`number expected, ${i.K(c)} found`)];if(c!=c)return[new i.V(n,c,"number expected, NaN found")];if("minimum"in f){let y=f.minimum;if(Array.isArray(f.minimum)&&(y=f.minimum[p.arrayIndex]),c<y)return[new i.V(n,c,`${c} is less than the minimum value ${y}`)]}if("maximum"in f){let y=f.maximum;if(Array.isArray(f.maximum)&&(y=f.maximum[p.arrayIndex]),c>y)return[new i.V(n,c,`${c} is greater than the maximum value ${y}`)]}return[]}function Lo(p){const n=p.key,c=p.value;if(!i.H(c))return[new i.V(n,c,`object expected, ${i.K(c)} found`)];const f=p.valueSpec,y=i.J(c.type);let x,w,A,C={};const k=y!=="categorical"&&c.property===void 0,L=!k,V=(function(Z){const oe=Z.stops;return Array.isArray(oe)&&Array.isArray(oe[0])&&i.H(oe[0][0])})(c),z=$i({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(Z){if(y==="identity")return[new i.V(Z.key,Z.value,'identity function may not have a "stops" property')];let oe=[];const te=Z.value;return oe=oe.concat(ni({key:Z.key,value:te,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:G})),Array.isArray(te)&&te.length===0&&oe.push(new i.V(Z.key,te,"array must have at least one stop")),oe},default:function(Z){return Zn({key:Z.key,value:Z.value,valueSpec:f,style:Z.style,styleSpec:Z.styleSpec})}}});return y==="identity"&&k&&z.push(new i.V(p.key,p.value,'missing required property "property"')),y==="identity"||c.stops||z.push(new i.V(p.key,p.value,'missing required property "stops"')),y==="exponential"&&f.expression&&!i.M(f)&&z.push(new i.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(L&&!i.N(f)?z.push(new i.V(p.key,p.value,"property functions not supported")):k&&!i.O(f)&&z.push(new i.V(p.key,p.value,"zoom functions not supported"))),y!=="categorical"&&!V||c.property!==void 0||z.push(new i.V(p.key,p.value,'"property" property is required')),z;function G(Z){let oe=[];const te=Z.value,le=Z.key;if(!Array.isArray(te))return[new i.V(le,te,`array expected, ${i.K(te)} found`)];if(te.length!==2)return[new i.V(le,te,`array length 2 expected, length ${te.length} found`)];if(V){if(!i.H(te[0]))return[new i.V(le,te,`object expected, ${i.K(te[0])} found`)];const fe=te[0];if(fe.zoom===void 0)return[new i.V(le,te,"object stop key must have zoom")];if(fe.value===void 0)return[new i.V(le,te,"object stop key must have value")];const me=i.J(fe.zoom);if(typeof me!="number")return[new i.V(le,fe.zoom,"stop zoom values must be numbers")];if(A&&A>me)return[new i.V(le,fe.zoom,"stop zoom values must appear in ascending order")];me!==A&&(A=me,w=void 0,C={}),oe=oe.concat($i({key:`${le}[0]`,value:te[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:hi,value:W}}))}else oe=oe.concat(W({key:`${le}[0]`,value:te[0],style:Z.style,styleSpec:Z.styleSpec},te));return i.Q(i.S(te[1]))?oe.concat([new i.V(`${le}[1]`,te[1],"expressions are not allowed in function stops.")]):oe.concat(Zn({key:`${le}[1]`,value:te[1],valueSpec:f,style:Z.style,styleSpec:Z.styleSpec}))}function W(Z,oe){const te=i.K(Z.value),le=i.J(Z.value),fe=Z.value!==null?Z.value:oe;if(x){if(te!==x)return[new i.V(Z.key,fe,`${te} stop domain type must match previous stop domain type ${x}`)]}else x=te;if(te!=="number"&&te!=="string"&&te!=="boolean"&&typeof le!="number"&&typeof le!="string"&&typeof le!="boolean")return[new i.V(Z.key,fe,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&y!=="categorical"){let me=`number expected, ${te} found`;return i.N(f)&&y===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(Z.key,fe,me)]}return y!=="categorical"||te!=="number"||typeof le=="number"&&isFinite(le)&&Math.floor(le)===le?y!=="categorical"&&te==="number"&&typeof le=="number"&&typeof w=="number"&&w!==void 0&&le<w?[new i.V(Z.key,fe,"stop domain values must appear in ascending order")]:(w=le,y==="categorical"&&le in C?[new i.V(Z.key,fe,"stop domain values must be unique")]:(C[le]=!0,[])):[new i.V(Z.key,fe,`integer expected, found ${String(le)}`)]}}function ki(p){const n=(p.expressionContext==="property"?i.W:i.U)(i.S(p.value),p.valueSpec);if(n.result==="error")return n.value.map((f=>new i.V(`${p.key}${f.key}`,p.value,f.message)));const c=n.value.expression||n.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!i.Z(c))return[new i.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Go(c,p);if(p.expressionContext==="appearance")return Ni(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!i.X(c,["zoom","feature-state"]))return[new i.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!i.Y(c))return[new i.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Go(p,n){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)c.delete(y);if(c.size===0)return[];const f=[];return p instanceof i._&&c.has(p.name)?[new i.V(n.key,n.value,`["${p.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(p.eachChild((y=>{f.push(...Go(y,n))})),f)}function Ni(p,n){const c=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)c.add(y);if(c.size===0)return[];const f=[];return p instanceof i._&&!c.has(p.name)?[new i.V(n.key,n.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild((y=>{f.push(...Ni(y,n))})),f)}function oo(p){const n=p.key,c=p.value,f=p.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(i.J(c))===-1&&y.push(new i.V(n,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(i.J(c))===-1&&y.push(new i.V(n,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),y}function Ho(p){return i.a2(i.S(p.value))?ki(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):qa(p)}function qa(p){const n=p.value,c=p.key;if(!Array.isArray(n))return[new i.V(c,n,`array expected, ${i.K(n)} found`)];if(n.length<1)return[new i.V(c,n,"filter array must have at least 1 element")];const f=p.styleSpec;let y=oo({key:`${c}[0]`,value:n[0],valueSpec:f.filter_operator});switch(i.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&i.J(n[1])==="$type"&&y.push(new i.V(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new i.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(i.a0(n[1])||y.push(new i.V(`${c}[1]`,n[1],`string expected, ${i.K(n[1])} found`)));for(let x=2;x<n.length;x++)i.J(n[1])==="$type"?y=y.concat(oo({key:`${c}[${x}]`,value:n[x],valueSpec:f.geometry_type})):i.a0(n[x])||i.L(n[x])||i.$(n[x])||y.push(new i.V(`${c}[${x}]`,n[x],`string, number, or boolean expected, ${i.K(n[x])} found.`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)y=y.concat(qa({key:`${c}[${x}]`,value:n[x],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":n.length!==2?y.push(new i.V(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):i.a0(n[1])||y.push(new i.V(`${c}[1]`,n[1],`string expected, ${i.K(n[1])} found`))}return y}function Ga(p,n){const c=p.key,f=p.style,y=p.layer,x=p.styleSpec,w=p.value,A=p.objectKey,C=x[`${n}_${p.layerType}`];if(!C)return[];const k=A.match(/^(.*)-use-theme$/);if(k&&C[k[1]])return i.Q(w)?[].concat(Zn({key:p.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:A})):Zn({key:c,value:w,valueSpec:{type:"string"},style:f,styleSpec:x});const L=A.match(/^(.*)-transition$/);if(n==="paint"&&L&&C[L[1]]&&C[L[1]].transition)return Zn({key:c,value:w,valueSpec:x.transition,style:f,styleSpec:x});const V=p.valueSpec||C[A];if(!V)return[new i.a3(c,w,`unknown property "${A}"`)];let z;if(i.a0(w)&&i.N(V)&&!V.tokens&&(z=/^{([^}]+)}$/.exec(w))){const W=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new i.V(c,w,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const G=[];if(p.layerType==="symbol")A!=="text-field"||!f||f.glyphs||f.imports||G.push(new i.V(c,w,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&i.a4(i.S(w))&&i.J(w.type)==="identity"&&G.push(new i.V(c,w,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&n==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&i.N(V)&&(i.a5(V)||i.O(V))){const W=i.W(i.S(w),V),Z=W.value.expression||W.value._styleExpression.expression;Z&&!i.X(Z,["measure-light"])&&(A==="model-emissive-strength"&&i.Y(Z)&&i.Z(Z)||G.push(new i.V(c,w,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(Zn({key:p.key,value:w,valueSpec:V,style:f,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:A}))}function Mo(p){return Ga(p,"paint")}function Wo(p){return Ga(p,"layout")}function Zu(p){let n=[];const c=p.value,f=p.key,y=p.style,x=p.styleSpec;if(!i.H(c))return[new i.V(f,c,"object expected")];c.type||c.ref||n.push(new i.V(f,c,'either "type" or "ref" is required'));let w=i.J(c.type);const A=i.J(c.ref);if(c.id){const C=i.J(c.id);for(let k=0;k<p.arrayIndex;k++){const L=y.layers[k];i.J(L.id)===C&&n.push(new i.V(f,c.id,`duplicate layer id "${C}", previously used at line ${L.id.__line__}`))}}if("ref"in c){let C;["type","source","source-layer","filter","layout"].forEach((k=>{k in c&&n.push(new i.V(f,c[k],`"${k}" is prohibited for ref layers`))})),y.layers.forEach((k=>{i.J(k.id)===A&&(C=k)})),C?C.ref?n.push(new i.V(f,c.ref,"ref cannot reference another ref layer")):w=i.J(C.type):typeof A=="string"&&n.push(new i.V(f,c.ref,`ref layer "${A}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(c.source)if(i.a0(c.source)){const C=y.sources&&y.sources[c.source],k=C&&i.J(C.type);C?k==="vector"&&w==="raster"?n.push(new i.V(f,c.source,`layer "${c.id}" requires a raster source`)):k==="raster"&&w!=="raster"?n.push(new i.V(f,c.source,`layer "${c.id}" requires a vector source`)):k!=="vector"||c["source-layer"]?k==="raster-dem"&&w!=="hillshade"?n.push(new i.V(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&k==="geojson"&&!C.lineMetrics?n.push(new i.V(f,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&k!=="raster-array"&&n.push(new i.V(f,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):n.push(new i.V(f,c.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new i.V(f,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new i.V(f,c.source,`source "${c.source}" not found`))}else n.push(new i.V(`${f}.source`,c.source,'"source" must be a string'));else n.push(new i.V(f,c,'missing required property "source"'));return n=n.concat($i({key:f,value:c,valueSpec:x.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zn({key:`${f}.type`,value:c.type,valueSpec:x.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:C=>Ho(Object.assign({layerType:w},C)),layout:C=>$i({layer:c,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>Wo(Object.assign({layerType:w},k))}}),paint:C=>$i({layer:c,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>Mo(Object.assign({layerType:w,layer:c},k))}}),appearances(C){const k=ni({key:C.key,value:C.value,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:z=>(function(G){const{key:W,layer:Z,layerType:oe}=G,te=i.J(G.value),le=i.J(te.name),fe=i.J(te.condition),me=$i({key:W,value:te,valueSpec:G.styleSpec.appearance,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{condition:we=>(function(xe){const Se=[];return Se.push(...ki({key:xe.key,value:xe.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Se})(Object.assign({layer:Z,layerType:oe},we)),properties:we=>(function(xe){const Se=[],{styleSpec:be,layer:ve,layerType:Te}=xe,qe=be[`paint_${Te}`],je=be[`layout_${Te}`],tt=xe.object[xe.objectKey];for(const Ve in tt){const et=Ve in qe?"paint":Ve in je?"layout":void 0;if(!et){Se.push(new i.V(xe.key,Ve,`unknown property "${Ve}" for layer type "${Te}"`));continue}const Et=Object.assign({},xe,{key:`${xe.key}.${Ve}`,object:tt,objectKey:Ve,layer:ve,layerType:Te,value:tt[Ve],valueSpec:et==="paint"?qe[Ve]:je[Ve]});Se.push(...Ga(Et,et))}return Se})(Object.assign({layer:Z,layerType:oe},we))}});return le==="hidden"||fe||me.push(new i.V(G.key,"name",'Appearance with name different than "hidden" must have a condition')),me})(Object.assign({layerType:w,layer:c},z))}),L=Array.isArray(C.value)?C.value:[],V=new Set;return L.forEach(((z,G)=>{const W=i.J(z.name);if(W)if(V.has(W)){const Z=i.J(c.id);k.push(new i.V(C.key,W,`Duplicated appearance name "${W}" for layer "${Z}"`))}else V.add(W)})),k}}})),n}function _s({key:p,value:n}){return i.a0(n)?[]:[new i.V(p,n,`string expected, ${i.K(n)} found`)]}const Lc={promoteId:function p({key:n,value:c}){if(i.a0(c))return _s({key:n,value:c});if(Array.isArray(c)){const y=[],x=i.S(c),w=i.U(x);return w.result==="error"&&w.value.forEach((A=>{y.push(new i.V(`${n}${A.key}`,null,`${A.message}`))})),i.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new i.V(`${n}`,null,"promoteId expression should be only feature dependent")),y}if(!i.H(c))return[new i.V(n,c,`string, expression or object expected, "${i.K(c)}" found`)];const f=[];for(const y in c)f.push(...p({key:`${n}.${y}`,value:c[y]}));return f}};function Zi(p){const n=p.value,c=p.key,f=p.styleSpec,y=p.style;if(!i.H(n))return[new i.V(c,n,`object expected, ${i.K(n)} found`)];if(!("type"in n))return[new i.V(c,n,'"type" is required')];const x=i.J(n.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&("url"in n||"tiles"in n||w.push(new i.a3(c,n,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat($i({key:c,value:n,valueSpec:f[`source_${x.replace("-","_")}`],style:p.style,styleSpec:f,objectElementValidators:Lc})),w;case"geojson":if(w=$i({key:c,value:n,valueSpec:f.source_geojson,style:y,styleSpec:f,objectElementValidators:Lc}),"cluster"in n&&"clusterProperties"in n){if(!i.H(n.clusterProperties))return[new i.V(`${c}.clusterProperties`,n,`object expected, ${i.K(n)} found`)];for(const A in n.clusterProperties){const C=n.clusterProperties[A];if(!Array.isArray(C))return[new i.V(`${c}.clusterProperties.${A}`,C,"array expected")];const[k,L]=C,V=typeof k=="string"?[k,["accumulated"],["get",A]]:k;w.push(...ki({key:`${c}.${A}.map`,value:L,expressionContext:"cluster-map"})),w.push(...ki({key:`${c}.${A}.reduce`,value:V,expressionContext:"cluster-reduce"}))}}return w;case"video":return $i({key:c,value:n,valueSpec:f.source_video,style:y,styleSpec:f});case"image":return $i({key:c,value:n,valueSpec:f.source_image,style:y,styleSpec:f});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oo({key:`${c}.type`,value:n.type,valueSpec:{values:ya(f)}})}}function ya(p){return p.source.reduce(((n,c)=>{const f=p[c];return f.type.type==="enum"&&(n=n.concat(Object.keys(f.type.values))),n}),[])}function Xu(p){const n=p.value,c=p.styleSpec,f=c.light,y=p.style;if(n===void 0)return[];if(!i.H(n))return[new i.V("light",n,`object expected, ${i.K(n)} found`)];let x=[];for(const w in n){const A=w.match(/^(.*)-transition$/),C=w.match(/^(.*)-use-theme$/);x=x.concat(C&&f[C[1]]?Zn({key:w,value:n[w],valueSpec:{type:"string"},style:y,styleSpec:c}):A&&f[A[1]]&&f[A[1]].transition?Zn({key:w,value:n[w],valueSpec:c.transition,style:y,styleSpec:c}):f[w]?Zn({key:w,value:n[w],valueSpec:f[w],style:y,styleSpec:c}):[new i.V(w,n[w],`unknown property "${w}"`)])}return x}function Zs(p){const n=p.value;if(!n)return[];const c=p.key;if(!i.H(n))return[new i.V(c,n,`object expected, ${i.K(n)} found`)];let f=[];const y=p.styleSpec,x=y["light-3d"],w=p.style,A=p.style.lights;for(const L of["type","id"])if(!(L in n))return f=f.concat([new i.V(c,n,`missing property "${L}"`)]),f;if(!i.a0(n.type))return f=f.concat([new i.V(`${c}.type`,n.type,"string expected")]),f;if(A)for(let L=0;L<p.arrayIndex;L++){const V=i.J(n.type),z=A[L];i.J(z.type)===V&&f.push(new i.V(c,n.id,`duplicate light type "${n.type}", previously defined at line ${z.id.__line__}`))}const C=`properties_light_${n.type}`;if(!(C in y))return f=f.concat([new i.V(`${c}.type`,n,`Invalid light type ${n.type}`)]),f;const k=y[C];for(const L in n)if(L==="properties"){const V=n[L];if(!i.H(V))return f=f.concat([new i.V("properties",V,`object expected, ${i.K(V)} found`)]),f;for(const z in V){const G=z.match(/^(.*)-transition$/),W=z.match(/^(.*)-use-theme$/);f=f.concat(W&&k[W[1]]?Zn({key:L,value:V[z],valueSpec:{type:"string"},style:w,styleSpec:y}):G&&k[G[1]]&&k[G[1]].transition?Zn({key:L,value:n[L],valueSpec:y.transition,style:w,styleSpec:y}):k[z]?Zn({key:z,value:V[z],valueSpec:k[z],style:w,styleSpec:y}):[new i.a3(p.key,V[z],`unknown property "${z}"`)])}}else f=f.concat(x[L]?Zn({key:L,value:n[L],valueSpec:x[L],style:w,styleSpec:y}):[new i.a3(L,n[L],`unknown property "${L}"`)]);return f}function Ha(p){const n=p.value,c=p.key,f=p.style,y=p.styleSpec,x=y.terrain;if(n==null)return[];if(!i.H(n))return[new i.V("terrain",n,`object expected, ${i.K(n)} found`)];let w=[];for(const A in n){const C=A.match(/^(.*)-transition$/),k=A.match(/^(.*)-use-theme$/);w=w.concat(k&&x[k[1]]?Zn({key:A,value:n[A],valueSpec:{type:"string"},style:f,styleSpec:y}):C&&x[C[1]]&&x[C[1]].transition?Zn({key:A,value:n[A],valueSpec:y.transition,style:f,styleSpec:y}):x[A]?Zn({key:A,value:n[A],valueSpec:x[A],style:f,styleSpec:y}):[new i.a3(A,n[A],`unknown property "${A}"`)])}if(n.source)if(i.a0(n.source)){const A=f.sources&&f.sources[n.source],C=A&&i.J(A.type);A?C!=="raster-dem"&&w.push(new i.V(`${c}.source`,n.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):w.push(new i.V(`${c}.source`,n.source,`source "${n.source}" not found`))}else w.push(new i.V(`${c}.source`,n.source,"source must be a string"));else w.push(new i.V(c,n,'terrain is missing required property "source"'));return w}function ys(p){const n=p.value,c=p.style,f=p.styleSpec,y=f.fog;if(n===void 0)return[];if(!i.H(n))return[new i.V("fog",n,`object expected, ${i.K(n)} found`)];let x=[];for(const w in n){const A=w.match(/^(.*)-transition$/),C=w.match(/^(.*)-use-theme$/);x=x.concat(C&&y[C[1]]?Zn({key:w,value:n[w],valueSpec:{type:"string"},style:c,styleSpec:f}):A&&y[A[1]]&&y[A[1]].transition?Zn({key:w,value:n[w],valueSpec:f.transition,style:c,styleSpec:f}):y[w]?Zn({key:w,value:n[w],valueSpec:y[w],style:c,styleSpec:f}):[new i.a3(w,n[w],`unknown property "${w}"`)])}return x}const jl={"*":()=>[],array:ni,boolean:function(p){const n=p.value,c=p.key;return i.$(n)?[]:[new i.V(c,n,`boolean expected, ${i.K(n)} found`)]},number:hi,color:function({key:p,value:n}){return i.a0(n)?i.a1.parseCSSColor(n)===null?[new i.V(p,n,`color expected, "${n}" found`)]:[]:[new i.V(p,n,`color expected, ${i.K(n)} found`)]},enum:oo,filter:Ho,function:Lo,layer:Zu,object:$i,source:Zi,model:i.a7,light:Xu,"light-3d":Zs,terrain:Ha,fog:ys,string:_s,formatted:function(p){return _s(p).length===0?[]:ki(p)},resolvedImage:function(p){return _s(p).length===0?[]:ki(p)},projection:function(p){const n=p.value,c=p.styleSpec,f=c.projection,y=p.style;if(i.H(n)){let x=[];for(const w in n)x=x.concat(Zn({key:w,value:n[w],valueSpec:f[w],style:y,styleSpec:c}));return x}return i.a0(n)?[]:[new i.V("projection",n,`object or string expected, ${i.K(n)} found`)]},import:function(p){const n=p.key,{value:c,styleSpec:f}=p;if(!i.H(c))return[new i.V(n,c,"import must be an object")];const{data:y,...x}=c;Object.defineProperty(x,"__line__",{value:c.__line__,enumerable:!1});let w=$i(Object.assign({},p,{value:x,valueSpec:f.import}));return i.J(x.id)===""&&w.push(new i.V(`${p.key}.id`,x,"import id can't be an empty string")),y&&(w=w.concat(zl(y,f,{key:`${p.key}.data`}))),w},iconset:function(p){const n=p.value,c=p.key,f=p.styleSpec,y=p.style;if(!i.H(n))return[new i.V(c,n,"object expected")];if(!n.type)return[new i.V(c,n,'"type" is required')];const x=i.J(n.type);let w=[];if(w=w.concat($i({key:c,value:n,valueSpec:f[`iconset_${x}`],style:y,styleSpec:f})),(function(A,C){return!(A!=="source"||!C.source)})(x,n)){const A=y.sources&&y.sources[n.source],C=A&&i.J(A.type);A?C!=="raster-array"&&w.push(new i.V(c,n.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):w.push(new i.V(c,n.source,`source "${n.source}" not found`))}return w}};function Zn(p,n=!1){const c=p.value,f=p.valueSpec,y=p.styleSpec;if(f.expression){if(i.a4(i.J(c)))return Lo(p);if(i.Q(i.S(c)))return ki(p)}if(f.type&&jl[f.type]){const x=jl[f.type](p);return n===!0&&x.length>0&&Array.isArray(p.value)?ki(p):x}return $i(Object.assign({},p,{valueSpec:f.type?y[f.type]:f}))}function $i(p){const n=p.key,c=p.value,f=p.valueSpec||{},y=p.objectElementValidators||{},x=p.style,w=p.styleSpec;if(!i.H(c))return[new i.V(n,c,`object expected, ${i.K(c)} found`)];let A=[];for(const C in c){const k=C.split(".")[0];let L;y[k]?L=y[k]:f[k]?L=Zn:y["*"]?L=y["*"]:f["*"]&&(L=Zn),L?A=A.concat(L({key:(n&&`${n}.`)+C,value:c[C],valueSpec:f[k]||f["*"],style:x,styleSpec:w,object:c,objectKey:C},c)):A.push(new i.a3(n,c[C],`unknown property "${C}"`))}for(const C in f)y[C]||f[C].required&&f[C].default===void 0&&c[C]===void 0&&A.push(new i.V(n,c,`missing required property "${C}"`));return A}function Ku({key:p,value:n}){const c=_s({key:p,value:n});if(c.length)return c;const f=n;return f.indexOf("{fontstack}")===-1&&c.push(new i.V(p,n,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&c.push(new i.V(p,n,'"glyphs" url must include a "{range}" token')),c}function zl(p,n=i.a6,c={}){return $i({key:c.key||"",value:p,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:p,objectElementValidators:{glyphs:Ku}})}function va(p,n=i.a6){return Ce(zl(p,n))}const Yu=p=>Ce(Zi(p)),Ju=p=>Ce(Xu(p)),Ad=p=>Ce(Zs(p)),wt=p=>Ce(Ha(p)),vs=p=>Ce(ys(p)),pm=p=>Ce((function(n){const c=n.value,f=n.style,y=n.styleSpec,x=y.snow;if(c===void 0)return[];if(!i.H(c))return[new i.V("snow",c,`object expected, ${i.K(c)} found`)];let w=[];for(const A in c){const C=A.match(/^(.*)-transition$/);w=w.concat(C&&x[C[1]]&&x[C[1]].transition?Zn({key:A,value:c[A],valueSpec:y.transition,style:f,styleSpec:y}):x[A]?Zn({key:A,value:c[A],valueSpec:x[A],style:f,styleSpec:y}):[new i.a3(A,c[A],`unknown property "${A}"`)])}return w})(p)),jc=p=>Ce((function(n){const c=n.value,f=n.style,y=n.styleSpec,x=y.rain;if(c===void 0)return[];if(!i.H(c))return[new i.V("rain",c,`object expected, ${i.K(c)} found`)];let w=[];for(const A in c){const C=A.match(/^(.*)-transition$/);w=w.concat(C&&x[C[1]]&&x[C[1]].transition?Zn({key:A,value:c[A],valueSpec:y.transition,style:f,styleSpec:y}):x[A]?Zn({key:A,value:c[A],valueSpec:x[A],style:f,styleSpec:y}):[new i.a3(A,c[A],`unknown property "${A}"`)])}return w})(p)),Fe=p=>Ce(Zu(p)),ne=p=>Ce(Ho(p)),ce=p=>Ce(Mo(p)),ye=p=>Ce(Wo(p)),Me=p=>Ce(i.a7(p));function Ce(p){return p.slice().sort(((n,c)=>n.line&&c.line?n.line-c.line:0))}function Ie(p,n){let c=!1;if(n&&n.length)for(const f of n)f instanceof i.a3?i.w(f.message):(p.fire(new i.y(new Error(f.message))),c=!0);return c}let Ye;class ze extends i.E{constructor(n,c="flat"){super(),this._transitionable=new i.a8(Ye||(Ye=new i.a9({anchor:new i.aa(i.a6.light.anchor),position:new i.ab(i.a6.light.position),color:new i.aa(i.a6.light.color),intensity:new i.aa(i.a6.light.intensity)}))),this.setLight(n,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c,f={}){this._validate(Ju,n,f)||(this._transitionable.setTransitionOrValue(n),this.id=c)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,f){return(!f||f.validate!==!1)&&Ie(this,n.call(va,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let Qe=class extends i.E{constructor(p,n,c,f,y){super(),this.scope=c,this._transitionable=new i.a8(new i.a9({source:new i.aa(i.a6.terrain.source),exaggeration:new i.aa(i.a6.terrain.exaggeration)}),c,f),this._transitionable.setTransitionOrValue(p,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=y}get(){return this._transitionable.serialize()}set(p,n){this._transitionable.setTransitionOrValue(p,n)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new i.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const n=p.value.expression;if(!n)return null;let c=-1,f=-1,y=1;for(const x of n.zoomStops)y=n.evaluate(new i.ac(x,{worldview:this.worldview})),y>.01?(c=x,f=-1):f=x;return y<.01&&c>0&&f>c?[c,f]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof i.ad}};const It=45,pt=65,tr=.05;function pr(p,n,c,f){const y=i.ah(It,pt,c),[x,w]=yr(p,f);let A=1-Math.min(1,Math.exp((n-x)/(w-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*p.alpha}function yr(p,n){const c=.5/Math.tan(.5*n);return[p.range[0]+c,p.range[1]+c]}function Ur(p,n,c,f,y){const x=i.af([],[n,c,f],y.mercatorFogMatrix);return pr(p,i.ag(x),y.pitch,y._fov)}function Br(p,n,c,f,y,x,w){const A=[[c,f,0],[y,f,0],[y,x,0],[c,x,0]];let C=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const L of A){const V=i.af([],L,n),z=i.ag(V);C=Math.min(C,z),k=Math.max(k,z)}return[pr(p,C,w.pitch,w._fov),pr(p,k,w.pitch,w._fov)]}class Gr extends i.E{constructor(n,c,f,y){super();const x=new i.a9({range:new i.aa(i.a6.fog.range),color:new i.aa(i.a6.fog.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(i.a6.fog["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(i.a6.fog["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(i.a6.fog["horizon-blend"]),"star-intensity":new i.aa(i.a6.fog["star-intensity"]),"vertical-range":new i.aa(i.a6.fog["vertical-range"])});this._transitionable=new i.a8(x,f,new Map(y)),this.set(n,y),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ai(x),this.scope=f}get state(){const n=this._transform,c=n.projection.name==="globe",f=i.aj(n.zoom),y=this.properties.get("range"),x=[.5,3];return{range:c?[i.ak(x[0],y[0],f),i.ak(x[1],y[1],f)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c,f={}){if(this._validate(vs,n,f))return;const y=Object.assign({},n);for(const x of Object.keys(i.a6.fog))y[x]===void 0&&(y[x]=i.a6.fog[x].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(It,pt,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?(function(f,y,x){const w=i.ae.fromLngLat(y),A=x.elevation?x.elevation.getAtPointOrZero(w):0;return Ur(f,w.x,w.y,A,x)})(this.state,n,c):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Br(this.state,c,0,0,i.al,i.al,this._transform)}getOpacityForBounds(n,c,f,y,x){return this._transform.projection.supportsFog?Br(this.state,n,c,f,y,x,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?yr(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const f of c){const y=n.points[f];let x;if(y[2]>=0)x=y;else{const w=n.points[f-4];x=i.am(w,y,w[2]/(w[2]-y[2]))}if(Ur(this.state,x[0],x[1],0,this._transform)>=tr)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,f){return(!f||f.validate!==!1)&&Ie(this,n.call(va,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let En,Vr,ii,vi,xi=class extends i.E{constructor(p,n,c,f){super();const y=En||(En=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(y,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(y),this.scope=c}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),f=i.an(c[0]),y=-Math.max(i.an(c[1]),.01),x=[Math.cos(f)*Math.cos(y),Math.sin(f)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette"),A=this.properties.get("vignette-color");return A.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(n.r,n.g,n.b,n.a*p),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(p,n,c={}){if(this._validate(pm,p,c))return;const f=Object.assign({},p);for(const y of Object.keys(i.a6.snow))f[y]===void 0&&(f[y]=i.a6.snow[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,c){return(!c||c.validate!==!1)&&Ie(this,p.call(va,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},Tn=class extends i.E{constructor(p,n,c,f){super();const y=Vr||(Vr=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(y,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(y),this.scope=c}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),f=i.an(c[0]),y=-Math.max(i.an(c[1]),.01),x=[Math.cos(f)*Math.cos(y),Math.sin(f)*Math.cos(y),Math.sin(y)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(n.r,n.g,n.b,n.a*p),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(p,n,c={}){if(this._validate(jc,p,c))return;const f=Object.assign({},p);for(const y of Object.keys(i.a6.rain))f[y]===void 0&&(f[y]=i.a6.rain[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,c){return(!c||c.validate!==!1)&&Ie(this,p.call(va,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class sn extends i.E{constructor(n,c,f,y){super(),this.scope=f,this._options=n,this.properties=new i.ai(c),this._transitionable=new i.a8(c,f,new Map(y)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,c){this._options=n,this._transitionable.setTransitionOrValue(n.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Jn{constructor(n,c,f){this.screenBounds=n,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(n,c){let f,y;if(n instanceof i.P||typeof n[0]=="number"){const x=i.P.convert(n);f=[x],y=c.isPointAboveHorizon(x)}else{const x=i.P.convert(n[0]),w=i.P.convert(n[1]),A=x.add(w)._div(2);f=[x,w],y=i.aq(x,w).every((C=>c.isPointAboveHorizon(C)))&&c.isPointAboveHorizon(A)}return new Jn(f,y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],y=i.aq(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),i.ar(y,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],y=i.aq(c,f,n),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>f.y))+((x.x>c.x)+(x.x>f.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(n,c,f,y=0){const x=n.queryPadding/c._pixelsPerMercatorPixel+1,w=f?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let A=n.tileID.wrap+(w.unwrapped?y:0);const C=w.polygon.map((oe=>i.as(n.tileTransform,oe,A)));if(!i.at(C,0,0,i.al,i.al))return;A=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const k=this.screenGeometryMercator.polygon.map((oe=>i.au(n.tileTransform,oe,A))),L=k.map((oe=>new i.P(oe[0],oe[1]))),V=c.getFreeCameraOptions().position||new i.ae(0,0,0),z=i.au(n.tileTransform,V,A),G=k.map((oe=>{const te=i.av(oe,oe,z);return i.aw(te,te),new i.ax(z,te)})),W=i.ay(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:G,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Z=i.az(C),Z.min.x=i.aA(Z.min.x,0,i.al),Z.min.y=i.aA(Z.min.y,0,i.al),Z.max.x=i.aA(Z.max.x,0,i.al),Z.max.y=i.aA(Z.max.y,0,i.al),Z),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:W};var Z}_bufferedScreenMercator(n,c){const f=Xi(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map((x=>c.pointCoordinate3D(x))),unwrapped:!0},this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(n,c){const f=Xi(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map((x=>c.pointCoordinate3D(x))),unwrapped:!0},this._cameraRaycastCache[f]=y,y}}_projectAndResample(n,c){const f=(function(x,w){const A=i.aB([],w.pixelMatrix,w.globeMatrix),C=[0,-i.aD,0,1],k=[0,i.aD,0,1],L=[0,0,0,1];i.aC(C,C,A),i.aC(k,k,A),i.aC(L,L,A);const V=new i.P(C[0]/C[3],C[1]/C[3]),z=new i.P(k[0]/k[3],k[1]/k[3]),G=i.aE(x,V)&&C[3]<L[3],W=i.aE(x,z)&&k[3]<L[3];if(!G&&!W)return null;const Z=(function(Se,be,ve){for(let Te=1;Te<Se.length;Te++){const qe=Ln(be.pointCoordinate3D(Se[Te-1]).x),je=Ln(be.pointCoordinate3D(Se[Te]).x);if(ve<0){if(qe<je)return{idx:Te,t:-qe/(je-1-qe)}}else if(je<qe)return{idx:Te,t:(1-qe)/(je+1-qe)}}return null})(x,w,G?-1:1);if(!Z)return null;const{idx:oe,t:te}=Z;let le=oe>1?Qn(x.slice(0,oe),w):[],fe=oe<x.length?Qn(x.slice(oe),w):[];le=le.map((Se=>new i.P(Ln(Se.x),Se.y))),fe=fe.map((Se=>new i.P(Ln(Se.x),Se.y)));const me=[...le];me.length===0&&me.push(fe[fe.length-1]);const we=i.ak(me[me.length-1].y,(fe.length===0?le[0]:fe[0]).y,te);let xe;return xe=G?[new i.P(0,we),new i.P(0,0),new i.P(1,0),new i.P(1,we)]:[new i.P(1,we),new i.P(1,1),new i.P(0,1),new i.P(0,we)],me.push(...xe),fe.length===0?me.push(le[0]):me.push(...fe),{polygon:me.map((Se=>new i.ae(Se.x,Se.y))),unwrapped:!1}})(n,c);if(f)return f;const y=(function(x,w){let A=!1,C=-1/0,k=0;for(let V=0;V<x.length-1;V++)x[V].x>C&&(C=x[V].x,k=V);for(let V=0;V<x.length-1;V++){const z=(k+V)%(x.length-1),G=x[z],W=x[z+1];Math.abs(G.x-W.x)>.5&&(G.x<W.x?(G.x+=1,z===0&&(x[x.length-1].x+=1)):(W.x+=1,z+1===x.length-1&&(x[0].x+=1)),A=!0)}const L=i.aF(w.center.lng);return A&&L<Math.abs(L-1)&&x.forEach((V=>{V.x-=1})),{polygon:x,unwrapped:A}})(Qn(n,c).map((x=>new i.P(Ln(x.x),x.y))),c);return{polygon:y.polygon.map((x=>new i.ae(x.x,x.y))),unwrapped:y.unwrapped}}}function Qn(p,n){return i.aG(p,(c=>{const f=n.pointCoordinate3D(c);c.x=f.x,c.y=f.y}),1/256)}function Ln(p){return p<0?1+p%1:p%1}function Xi(p){return 100*p|0}function yo(p,n,c,f,y){const x=function(A,C){if(A)return y(A);if(C){if(p.url&&C.tiles&&p.tiles&&delete p.tiles,C.variants){if(!Array.isArray(C.variants))return y(new Error("variants must be an array"));for(const L of C.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return y(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){C=Object.assign(C,L);break}}}const k=i.aH(Object.assign({},C,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=n.canonicalizeTileset(k,p.url),y(null,k)}},w=(function(A,C,k){if(!A)return null;if(!C&&!k)return A;k=k||A.worldview_default;const L=Object.values(A.language||{});if(L.length===0)return null;const V=Object.values(A.worldview||{});if(V.length===0)return null;const z=L.every((W=>W===C)),G=V.every((W=>W===k));return z&&G?A:C in(A.language_options||{})||k in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null})(p.data,c,f);return w?i.o.frame((()=>x(null,w))):p.url?i.m(n.transformRequest(n.normalizeSourceURL(p.url,null,c,f),i.R.Source),x):i.o.frame((()=>{const{data:A,...C}=p;x(null,C)}))}function Zo(p,n){const c=Math.pow(2,n.z),f=Math.floor(i.aF(p.getWest())*c),y=Math.floor(i.aJ(p.getNorth())*c),x=Math.ceil(i.aF(p.getEast())*c),w=Math.ceil(i.aJ(p.getSouth())*c);return n.x>=f&&n.x<x&&n.y>=y&&n.y<w}class xs{constructor(n,c,f){this.bounds=n?i.aI.convert(this.validateBounds(n)):null,this.minzoom=c||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const c of n)this.extraBounds.push(i.aI.convert(this.validateBounds(c)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Zo(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Zo(c,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const c=new xs(n.bounds,n.minzoom,n.maxzoom);return c.addExtraBounds(n.extra_bounds),c}}class ao extends i.E{constructor(n,c,f,y){if(super(),this.id=n,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new i.aK}load(n){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=yo(this._options,this.map._requestManager,c,f,((y,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.y(y));else if(x){if(Object.assign(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of x.vector_layers)this.vectorLayerIds.push(w.id),x.worldview&&x.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=xs.fromTileJSON(x),rr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(y)}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,c){const f=n.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(f),x=this.map._requestManager.transformRequest(y,i.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,A=w?{image:w.image.clone()}:null,C={request:x,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:A,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&i.h(f)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",C,k.bind(this));else if(n.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",C,k.bind(this),void 0,!0);else{const L=i.aL.call({deduped:this._deduped},C,((V,z)=>{V||!z?k.call(this,V):(C.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},n.actor&&n.actor.send("loadTile",C,k.bind(this),void 0,!0))}),!0);n.request={cancel:L}}function k(L,V){return delete n.request,n.aborted?c(null):L&&L.status!==404?c(L):(V&&V.resourceTiming&&(n.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&n.setExpiryData(V),n.loadVectorData(V,this.map.painter),i.aM(this.dispatcher),c(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class zc extends i.E{constructor(n,c,f,y){super(),this.id=n,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,i.aH(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=yo(this._options,this.map._requestManager,null,c,((f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new i.y(f)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map((x=>x.id))),this.tileBounds=xs.fromTileJSON(y),rr(y.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(f)}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const f=i.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=i.n(this.map._requestManager.transformRequest(y,i.R.Tile),((x,w,A,C)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):x?(n.state="errored",c(x)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:C}),n.setTexture(w,this.map.painter),n.state="loaded",i.aM(this.dispatcher),void c(null)):c(null))))}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c&&c()}unloadTile(n,c){n.texture&&n.texture instanceof i.T?(n.destroy(!0),n.texture&&n.texture instanceof i.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Hy([p,n],c,f,{scaled:y=!0}={}){const{tileSize:x,buffer:w}=f,{x:A,y:C,z:k}=c;if(!isFinite(A)||!isFinite(C)||!isFinite(k))throw new Error("Invalid MRT header");const L=2**k,V=L*i.aF(p),z=L*i.aJ(n);return(function([G,W],Z,{scaled:oe=!0}={}){if(!Z)throw new Error("bandView is undefined");const{data:te,tileSize:le,buffer:fe,offset:me,scale:we,dimension:xe}=Z;if(G<-fe||G>le+fe||W<-fe||W>le+fe)throw new Error(`Point (${G}, ${W}) out of bounds for tileSize=${le}, buffer=${fe}`);const Se=(W+fe)*(le+2*fe)+(G+fe);if(new Uint32Array(te.buffer)[Se]===4294967295)return null;let be=[];be=oe?[]:new Z.data.constructor(xe);for(let ve=0;ve<xe;ve++)be[ve]=Math.round(1e12*(te[xe*Se+ve]*we+me))/1e12;return be})([Math.min(Math.max(-w,Math.floor((V-A)*x)),x-1+w),Math.min(Math.max(-w,Math.floor((z-C)*x)),x-1+w)],f,{scaled:y})}class Xs extends zc{constructor(n,c,f,y){super(n,c,f,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(n){const c=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);c&&c.enabled&&f&&c._clearRenderCacheForTile(f.id,n.tileID),this.map.triggerRepaint()}loadTile(n,c){const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(f,i.R.Tile),x={request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=y,n.actor||(n.actor=this.dispatcher.getActor());const w=(A,C,k,L)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(A)return A.name==="AbortError"?void 0:(n.state="errored",c(A));if(this.map._refreshExpiredTiles&&C&&n.setExpiryData({cacheControl:k,expires:L}),this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!C)return c(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=C}c(null)};n.request=this.partial?n.fetchHeader(void 0,w.bind(this)):n.actor.send("loadTile",x,w.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){const f=n.texturePerLayer;if(n.flushAllQueues(),f.size){n.destroy(!0);for(const y of f.values())this.map.painter.saveTileTexture(y)}else n.destroy()}prepareTile(n,c,f,y){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(c,f,y,((x,w)=>{if(x)return n.state="errored",this.fire(new i.y(x)),void this.triggerRepaint(n);w&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(f,w,this.map.painter),n.state="loaded",this.triggerRepaint(n))})))}getInitialBand(n){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find((({id:x})=>x===n)),f=c&&c.fields,y=f&&f.bands&&f.bands;return y?y[0]:0}getTextureDescriptor(n,c,f){if(!n)return;const y=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let x=null;c instanceof i.aP?x=c.paint.get("raster-array-band"):c instanceof i.aQ&&(x=c.paint.get("raster-particle-array-band"));const w=x||this.getInitialBand(y);if(w==null)return;if(!n.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(n,y,c.id,w);if(n.updateNeeded(c.id,w)&&!f)return;const A=n.textureDescriptorPerLayer.get(c.id);return Object.assign({},A,{texture:n.texturePerLayer.get(c.id)})}getImages(n,c){const f=new Map;for(const y of n)for(const x of c){const[w,A]=x.split("/"),C=y.getLayer(w);if(!C||!C.hasBand(A)||!C.hasDataForBand(A))continue;const{bytes:k,tileSize:L,buffer:V}=C.getBandView(A),z=L+2*V,G={data:new i.q({width:z,height:z},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(x,G)}return f}queryRasterArrayValueByBandId(n,c,f){const y=c._mrt;return new Promise((x=>{const w={},A=new Set;for(const[C,k]of Object.entries(y.layers)){if(f.layerName&&C!==f.layerName)continue;const L={};w[C]=L;for(const{bands:V}of k.dataIndex)for(const z of V)f.bands&&!f.bands.includes(z)||(A.add(i.B(C,z)),c.fetchBand(C,null,z,(G=>{i.o.frame((()=>{L[z]=G?null:Hy([n.lng,n.lat],y,k.getBandView(z)),A.delete(i.B(C,z)),A.size===0&&x(w)}))}),!1))}A.size===0&&x(w)}))}_loadTileForQuery(n,c){if(this._loadTileLoaded[n.uid])return void c(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(c);this._loadTilePending[n.uid]=[c];const f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(f,i.R.Tile);n.actor.send("loadTile",{request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((x,w,A,C)=>x?(this._loadTilePending[n.uid].forEach((k=>k(x,null))),void delete this._loadTilePending[n.uid]):w?(this.map._refreshExpiredTiles&&w&&n.setExpiryData({cacheControl:A,expires:C}),n._mrt=w,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach((k=>k(null,w))),this._loadTileLoaded[n.uid]=!0,void delete this._loadTilePending[n.uid]):(this._loadTilePending[n.uid].forEach((k=>k(null,null))),void delete this._loadTilePending[n.uid])),void 0,!0)}queryRasterArrayValueByAllBands(n,c,f){return new Promise(((y,x)=>{this._loadTileForQuery(c,((w,A)=>{w?x(w):y(A?this.queryRasterArrayValueByBandId(n,c,f):null)}))}))}queryRasterArrayValue(n,c){const f=i.aR.convert(n),y=this.findLoadedParent(f);return y&&y._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(f,y,c):this.queryRasterArrayValueByAllBands(f,y,c):Promise.resolve(null)}findLoadedParent(n){const c=i.ae.fromLngLat(n,this.map.transform.tileSize),f=this.maxzoom+1,y=1<<f,x=Math.floor(c.x),w=Math.floor((c.x-x)*y),A=Math.floor(c.y*y),C=this.map.style.getSourceCache(this.id),k=new i.aO(f,x,f,w,A);return C.findLoadedParent(k,this.minzoom)}}const Fc={vector:ao,raster:zc,"raster-dem":class extends zc{constructor(p,n,c,f){super(p,n,c,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,x){y&&(p.state="errored",n(y)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=i.n(this.map._requestManager.transformRequest(c,i.R.Tile),(function(y,x,w,A){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(y)p.state="errored",n(y);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:w,expires:A});const C=ImageBitmap&&x instanceof ImageBitmap&&i.r(),k=1-(x.width-i.aN(x.width))/2;k<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=C?x:i.o.getImageData(x,k),V={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:k};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",V,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,c=Math.pow(2,n.z),f=(n.x-1+c)%c,y=n.x===0?p.wrap-1:p.wrap,x=(n.x+1+c)%c,w=n.x+1===c?p.wrap+1:p.wrap,A={};return A[new i.aO(p.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},A[new i.aO(p.overscaledZ,w,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(A[new i.aO(p.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1},A[new i.aO(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new i.aO(p.overscaledZ,w,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<c&&(A[new i.aO(p.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1},A[new i.aO(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new i.aO(p.overscaledZ,w,n.z,x,n.y+1).key]={backfilled:!1}),A}},"raster-array":Xs,geojson:class extends i.E{constructor(p,n,c,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:i.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:i.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const c of this._data.features)n.set(c.id,c);for(const c of p.features)n.set(c.id,c);this._data.features=[...n.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterLeaves(p,n,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:n,offset:c},f),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:p},this.workerOptions);n.scope=this.scope;const c=this._data;typeof c=="string"?(n.request=this.map._requestManager.transformRequest(i.o.resolveURL(c),i.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,((f,y)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new i.y(f));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x.resourceTiming=y.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new i.z("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const p=i.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,n){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,y=f?{image:f.image.clone()}:null,x=this._partialReload,w={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview()};p.request=this.actor.send(c,w,((A,C)=>x&&!C?(p.state="loaded",n(null)):(delete p.request,p.destroy(),p.aborted?n(null):A?n(A):(p.loadVectorData(C,this.map.painter,c==="reloadTile"),n(null)))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,n){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aS{constructor(p,n,c,f){super(p,n,c,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,i.R.Source).url);i.aT(this.urls,((n,c)=>{this._loaded=!0,n?this.fire(new i.y(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(p,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aS,model:class extends i.E{constructor(p,n,c,f){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const p=[];for(const n in this._options.models){const c=this._options.models[n],f=i.aV(this.map._requestManager.transformRequest(c.uri,i.R.Model).url).then((y=>{if(!y)return;const x=i.aW(y),w=new i.aX(n,c.position,c.orientation,x);w.computeBoundsAndApplyParent(),this.models.push(w)})).catch((y=>{this.fire(new i.y(new Error(`Could not load model ${n} from ${c.uri}: ${y.message}`)))}));p.push(f)}Promise.allSettled(p).then((()=>{this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((n=>{this._loaded=!0,this.fire(new i.y(new Error(`Could not load models: ${n.message}`)))}))}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,n){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(p,n,c,f){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(p)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=yo(this._options,this.map._requestManager,n,c,((f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.y(f))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new xs(y.bounds,this.minzoom,this.maxzoom)),rr(y.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(f)}))}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=n;else{if(p.buckets){const x=Object.values(p.buckets);for(const w of x)w.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",f,y.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",f,y.bind(this),void 0,!0);function y(x,w){return p.aborted?n(null):x&&x.status!==404?n(x):(this.map._refreshExpiredTiles&&w&&p.setExpiryData(w),p.loadModelData(w,this.map.painter),p.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aS{constructor(p,n,c,f){super(p,n,c,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((x=>typeof x!="number"))))||this.fire(new i.y(new i.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof i.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends i.E{constructor(p,n,c,f){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xs(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:n,y:c,z:f}=p.canonical;return this._implementation.hasTile({x:n,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,n){const{x:c,y:f,z:y}=p.tileID.canonical,x=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:y},{signal:x.signal})).then((function(w){return delete p.request,p.aborted?(p.state="unloaded",n(null)):w===void 0?(p.state="errored",n(null)):w===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",n(null)):(function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement})(w)?(this.loadTileData(p,w),p.state="loaded",void n(null)):(p.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((w=>{w.name!=="AbortError"&&(p.state="errored",n(w))})),p.request.cancel=()=>x.abort()}loadTileData(p,n){p.setTexture(n,this.map.painter)}unloadTile(p,n){if(p.texture&&p.texture instanceof i.T?(p.destroy(!0),p.texture&&p.texture instanceof i.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:f,z:y}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:y})}n&&n()}abortTile(p,n){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z})))}_clearTiles(){const p=i.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},Qu=function(p,n,c,f){const y=new Fc[n.type](p,n,c,f);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return i.aY(["load","abort","unload","serialize","prepare"],y),y};function eh(p,n,c=""){return`${c}:${n.id||""}:${n.layer.id}:${(function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:y,importId:x}=f;return`featureset:${y}${x?`:import:${x}`:""}`}})(p.target)}`}function Ks(p,n,c,f=""){if(p.uniqueFeatureID){const y=eh(p,n,f);if(c.has(y))return!0;c.add(y)}return!1}function th(p,n,c,f,y=!1){const x=n.sourceCache.transform,w=n.sourceCache.tilesIn(p,n.has3DLayers,y);w.sort(gm);const A=[];for(const C of w){const k=C.tile.queryRenderedFeatures(n,C,c,f,x,y);Object.keys(k).length&&A.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:k})}return A.length===0?{}:(function(C){const k={},L={};for(const V of C){const z=V.queryResults,G=V.wrappedTileID,W=L[G]=L[G]||{};for(const Z in z){const oe=z[Z],te=W[Z]=W[Z]||{},le=k[Z]=k[Z]||[];for(const fe of oe)te[fe.featureIndex]||(te[fe.featureIndex]=!0,le.push(fe))}}return k})(A)}function mm(p,n,c,f,y,x){const w={},A=f.queryRenderedSymbols(p),C=[];for(const k of Object.keys(A).map(Number))C.push(y[k]);C.sort(gm);for(const k of C){const L=k.featureIndex.lookupSymbolFeatures(A[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,n,c,x);for(const V in L){const z=w[V]=w[V]||[],G=L[V];G.sort(((W,Z)=>{const oe=k.featureSortOrder;if(oe){const te=oe.indexOf(W.featureIndex);return oe.indexOf(Z.featureIndex)-te}return Z.featureIndex-W.featureIndex}));for(const W of G)z.push(W)}}return w}function Wa(p,n){const c=p.getRenderableIds().map((x=>p.getTileByID(x))),f=[],y={};for(let x=0;x<c.length;x++){const w=c[x],A=w.tileID.canonical.key;y[A]||(y[A]=!0,w.querySourceFeatures(f,n))}return f}function gm(p,n){const c=p.tileID,f=n.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function Ed(p,n){const c={};if(!n)return c;for(const f of p){const y=f.layerIds.map((x=>n.getLayer(x))).filter(Boolean);if(y.length!==0){f.layers=y,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map((x=>y.filter((w=>w.id===x))[0])));for(const x of y)c[x.fqid]=f}}return c}const Xo=32,xa=33,bs=new Uint16Array(8184);for(let p=0;p<2046;p++){let n=p+2,c=0,f=0,y=0,x=0,w=0,A=0;for(1&n?y=x=w=Xo:c=f=A=Xo;(n>>=1)>1;){const k=c+y>>1,L=f+x>>1;1&n?(y=c,x=f,c=w,f=A):(c=y,f=x,y=w,x=A),w=k,A=L}const C=4*p;bs[C+0]=c,bs[C+1]=f,bs[C+2]=y,bs[C+3]=x}const ba=new Uint16Array(2178),vo=new Uint8Array(1089),Fl=new Uint16Array(1089);function _m(p){return p===0?-.03125:p===32?.03125:0}const rh={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Ys{constructor(n,c,f,y,x,w){this.tileID=n,this.uid=i.b2(),this.uses=0,this.tileSize=c,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=w}registerFadeDuration(n){const c=n+this.timeAdded;c<i.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,c,f){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Ed(n.buckets,c.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof i.b4){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof i.b4&&x.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y],w=c.style.getOwnLayer(y);if(!w)continue;const A=w.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,A)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,c,f){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Ed(n.buckets,c.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(n)}const c=n.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new i.T(n,f.image,c.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(n,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(n,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(n,c,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,f),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=c.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(n,c,f,y,x,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const A=(function(C,k){const L=i.bq([],[.5*C.width,.5*-C.height,1]);return i.br(L,L,[1,-1,0]),i.aB(L,L,C.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(L)})(x,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:c,pixelPosMatrix:A,transform:y,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,c){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const y=f.loadVTLayers(),x=c?c.sourceLayer:"",w=y._geojsonTileLayer||y[x];if(!w)return;const A=i.b6(c&&c.filter),{z:C,x:k,y:L}=this.tileID.canonical,V={z:C,x:k,y:L};for(let z=0;z<w.length;z++){const G=w.feature(z);if(A.needGeometry){const oe=i.b7(G,!0);if(!A.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),oe,this.tileID.canonical))continue}else if(!A.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),G))continue;const W=f.getId(G,x),Z=new i.b8(G,C,k,L,W);Z.tile=V,n.push(Z)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const c=this.expirationTime;if(n.cacheControl){const f=i.b9(n.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const f=Date.now();let y=!1;if(this.expirationTime>f)y=!1;else if(c)if(this.expirationTime<c)y=!0;else{const x=this.expirationTime-c;x?this.expirationTime=f+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,c){if(!this.latestFeatureIndex||!n.style)return;const f=this.latestFeatureIndex.loadVTLayers(),y=n.style.listImages(),x=n.style.getBrightness();for(const w in this.buckets){if(!n.style.hasLayer(w))continue;const A=this.buckets[w],C=A.layers[0],k=C.sourceLayer||"_geojsonTileLayer",L=f[k],V=n.style.getLayerSourceCache(C);let z={};V&&(z=V._state.getState(k,void 0));const G=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},W=Object.keys(z).length>0&&!c;(W&&A.stateDependentLayers.length!==0||c)&&A.update(z,L,y,G,W?A.stateDependentLayers:A.layers,c,x),(A instanceof i.ba||A instanceof i.bb)&&n._terrain&&n._terrain.enabled&&V&&A.uploadPending()&&n._terrain._clearRenderCacheForTile(V.id,this.tileID);const Z=n&&n.style&&n.style.getOwnLayer(w);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=i.o.now()+n}setTexture(n,c){const f=c.context,y=f.gl;this.texture=this.texture||c.getTileTexture(n.width),this.texture&&this.texture instanceof i.T?this.texture.update(n):(this.texture=new i.T(f,n,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(n,c){const f={};for(const y of c)f[y]=!0;this.dependencies[n]=f}hasDependency(n,c){for(const f of n){const y=this.dependencies[f];if(y){for(const x of c)if(y[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const f=i.bc(rh,this.tileID.canonical,this.tileTransform)[0],y=new i.bd,x=new i.be;for(let w=0;w<f.length;w++){const{x:A,y:C}=f[w];y.emplaceBack(A,C),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(y,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,y.length,x.length)}_makeTileBoundsBuffers(n,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const f=i.bc(rh,this.tileID.canonical,this.tileTransform)[0];let y,x;if(this.isRaster){const w=(function(A,C){const k=i.aZ(A,C),L=Math.pow(2,A.z);for(let oe=0;oe<xa;oe++)for(let te=0;te<xa;te++){const le=i.a_((A.x+(te+_m(te))/Xo)/L),fe=i.a$((A.y+(oe+_m(oe))/Xo)/L),me=C.project(le,fe),we=oe*xa+te;ba[2*we+0]=Math.round((me.x*k.scale-k.x)*i.al),ba[2*we+1]=Math.round((me.y*k.scale-k.y)*i.al)}vo.fill(0),Fl.fill(0);for(let oe=2045;oe>=0;oe--){const te=4*oe,le=bs[te+0],fe=bs[te+1],me=bs[te+2],we=bs[te+3],xe=le+me>>1,Se=fe+we>>1,be=xe+Se-fe,ve=Se+le-xe,Te=fe*xa+le,qe=we*xa+me,je=Se*xa+xe,tt=Math.hypot((ba[2*Te+0]+ba[2*qe+0])/2-ba[2*je+0],(ba[2*Te+1]+ba[2*qe+1])/2-ba[2*je+1])>=16;vo[je]=vo[je]||(tt?1:0),oe<1022&&(vo[je]=vo[je]||vo[(fe+ve>>1)*xa+(le+be>>1)]||vo[(we+ve>>1)*xa+(me+be>>1)])}const V=new i.b0,z=new i.b1;let G=0;function W(oe,te){const le=te*xa+oe;return Fl[le]===0&&(V.emplaceBack(ba[2*le+0],ba[2*le+1],oe*i.al/Xo,te*i.al/Xo),Fl[le]=++G),Fl[le]-1}function Z(oe,te,le,fe,me,we){const xe=oe+le>>1,Se=te+fe>>1;if(Math.abs(oe-me)+Math.abs(te-we)>1&&vo[Se*xa+xe])Z(me,we,oe,te,xe,Se),Z(le,fe,me,we,xe,Se);else{const be=W(oe,te),ve=W(le,fe),Te=W(me,we);z.emplaceBack(be,ve,Te)}}return Z(0,0,Xo,Xo,Xo,0),Z(Xo,Xo,0,0,0,Xo),{vertices:V,indices:z}})(this.tileID.canonical,c);y=w.vertices,x=w.indices}else{y=new i.b0,x=new i.b1;for(const{x:A,y:C}of f)y.emplaceBack(A,C,0,0);const w=i.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let A=0;A<w.length;A+=3)x.emplaceBack(w[A],w[A+1],w[A+2])}this._tileBoundsBuffer=n.createVertexBuffer(y,i.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(x),this._tileBoundsSegments=i.bg.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugBuffers(n,c){const f=c.projection;if(!f||f.name!=="globe"||c.freezeTileCoverage)return;const y=this.tileID.canonical,x=i.bj(y,c),w=i.bk(x),A=i.aj(c.zoom);let C;A>0&&(C=i.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,y,c,w,C,A),this._makeGlobeTileDebugTextBuffer(n,y,c,w,C,A)}_globePoint(n,c,f,y,x,w,A){let C=i.bm(n,c,f);if(w){const k=1<<f.z,L=i.aF(y.center.lng),V=i.aJ(y.center.lat),z=(f.x+.5)/k-L;let G=0;z>.5?G=-1:z<-.5&&(G=1);let W=(n/i.al+f.x)/k+G,Z=(c/i.al+f.y)/k;W=(W-L)*y._pixelsPerMercatorPixel+L,Z=(Z-V)*y._pixelsPerMercatorPixel+V;const oe=[W*y.worldSize,Z*y.worldSize,0];i.af(oe,oe,w),C=i.bn(C,oe,A)}return i.af(C,C,x)}_makeGlobeTileDebugBorderBuffer(n,c,f,y,x,w){const A=new i.bd,C=new i.be,k=new i.bo,L=(z,G,W,Z,oe)=>{const te=(W-z)/(oe-1),le=(Z-G)/(oe-1),fe=A.length;for(let me=0;me<oe;me++){const we=z+me*te,xe=G+me*le;A.emplaceBack(we,xe);const Se=this._globePoint(we,xe,c,f,y,x,w);k.emplaceBack(Se[0],Se[1],Se[2]),C.emplaceBack(fe+me)}},V=i.al;L(0,0,V,0,16),L(V,0,V,V,16),L(V,V,0,V,16),L(0,V,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(C),this._tileDebugBuffer=n.createVertexBuffer(A,i.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(k,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,A.length,C.length)}_makeGlobeTileDebugTextBuffer(n,c,f,y,x,w){const A=i.al/4,C=new i.bd,k=new i.b1,L=new i.bo,V=25;k.reserve(32),C.reserve(V),L.reserve(V);const z=(G,W)=>V*G+W;for(let G=0;G<V;G++){const W=G*A;for(let Z=0;Z<V;Z++){const oe=Z*A;C.emplaceBack(oe,W);const te=this._globePoint(oe,W,c,f,y,x,w);L.emplaceBack(te[0],te[1],te[2])}}for(let G=0;G<4;G++)for(let W=0;W<4;W++){const Z=z(G,W),oe=z(G,W+1),te=z(G+1,W),le=z(G+1,W+1);k.emplaceBack(Z,oe,te),k.emplaceBack(te,oe,le)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(k),this._tileDebugTextBuffer=n.createVertexBuffer(C,i.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(L,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,V,32)}destroy(n=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class nh extends Ys{constructor(n,c,f,y,x){super(n,c,f,y,x),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,c,f){const y=f.context,x=y.gl;let w=this.texturePerLayer.get(n)||f.getTileTexture(c.width);w&&w instanceof i.T?w.update(c,{premultiply:!1}):w=new i.T(y,c,x.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,w)}flushQueues(n){const c=this._workQueuePerLayer.get(n)||[],f=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(n)||[];for(;c.length;)c.pop()()}}fetchHeader(n=16384,c){const f=this._mrt=new i.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=i.bu(y,((x,w,A,C)=>{if(x)c(x);else try{const k=f.getHeaderLength(w);if(k>n)return void(this.request=this.fetchHeader(k,c));f.parseHeader(w),this._isHeaderLoaded=!0;let L=0;for(const V of Object.values(f.layers))L=Math.max(L,V.dataIndex[V.dataIndex.length-1].lastByte);w.byteLength>=L&&(this.entireBuffer=w),c(null,this.entireBuffer||w,A,C)}catch(k){c(k)}})),this.request}fetchBandForRender(n,c,f,y){this.fetchBand(n,c,f,(x=>{if(x)return void y(x);this.updateTextureDescriptor(n,c,f);const w=this.textureDescriptorPerLayer.get(c);y(null,w?w.img:null)}))}fetchBand(n,c,f,y,x=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void y(new Error("Tile header is not ready"));const A=this.actor;if(!A)return void y(new Error("Can't fetch tile band without an actor"));let C;const k=i.B(String(f),i.B(this.tileID.key,n));let L=this._taskQueue.get(k);L?L.add(y):(L=new Set,L.add(y),this._taskQueue.set(k,L));const V=(Z,oe)=>{C.complete(Z,oe),Z?y(Z):(L.values().forEach((te=>te(null,oe))),this._taskQueue.delete(k))},z=(Z,oe)=>{if(Z)return y(Z);const te=A.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:oe,task:C},V,void 0,!0);if(c!==null){const le=this._workQueuePerLayer.get(c)||[];le.push((()=>{te&&te.cancel(),C.cancel()})),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,le)}};let G;try{G=w.getLayer(n)}catch(Z){if(this.state==="reloading")return;throw Z}if(!G)return void y(new Error(`Unknown sourceLayer "${n}"`));if(G.hasDataForBand(f))return L.values().forEach((Z=>Z(null,null))),void this._taskQueue.delete(k);const W=G.getDataRange([f]);if(C=w.createDecodingTask(W),!C||C.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)z(null,this.entireBuffer.slice(W.firstByte,W.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${W.firstByte}-${W.lastByte}`}}),oe=i.bu(Z,z);if(c!==null){const te=this._fetchQueuePerLayer.get(c)||[];te.push((()=>{oe.cancel(),C.cancel()})),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,te)}}}updateNeeded(n,c){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,c,f){if(!this._mrt)return;const y=this._mrt.getLayer(n);if(!y||!y.hasBand(f)||!y.hasDataForBand(f))return;const{bytes:x,tileSize:w,buffer:A,offset:C,scale:k}=y.getBandView(f),L=w+2*A,V=new i.q({width:L,height:L},x),z=this.texturePerLayer.get(c);z&&z instanceof i.T&&z.update(V,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:n,band:f,img:V,buffer:A,offset:C,tileSize:w,format:y.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const c of this.texturePerLayer.values())c&&c instanceof i.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ih{constructor(n,c){this.max=n,this.onRemove=c,this.reset()}reset(){for(const n in this.data)for(const c of this.data[n])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(n,c,f){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const x={value:c,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout((()=>{this.remove(n,x)}),f)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const c=this.data[n].shift();return c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),c.value}getByKey(n){const c=this.data[n];return c?c[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,c){if(!this.has(n))return this;const f=n.wrapped().key,y=c===void 0?0:this.data[f].indexOf(c),x=this.data[f][y];return this.data[f].splice(y,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(n){const c=[];for(const f in this.data)for(const y of this.data[f])n(y.value)||c.push(y);for(const f of c)this.remove(f.value.tileID,f)}}class Bc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,c,f){const y=String(c);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},Object.assign(this.stateChanges[n][y],f),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==y&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const x in this.state[n][y])f[x]||(this.deletedStates[n][y][x]=null)}else for(const x in f)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][x]===null&&delete this.deletedStates[n][y][x]}removeFeatureState(n,c,f){if(this.deletedStates[n]===null)return;const y=String(c);if(this.deletedStates[n]=this.deletedStates[n]||{},f&&c!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][f]=null);else if(c!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(f in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][f]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,c){const f=this.state[n]||{},y=this.stateChanges[n]||{},x=this.deletedStates[n];if(x===null)return{};if(c!==void 0){const A=String(c),C=Object.assign({},f[A],y[A]);if(x){const k=x[c];if(k===null)return{};for(const L in k)delete C[L]}return C}const w=Object.assign({},f,y);if(x)for(const A in x)delete w[A];return w}initializeTileState(n,c){n.refreshFeatureState(c)}coalesceChanges(n,c){const f={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const w in this.stateChanges[y])this.state[y][w]||(this.state[y][w]={}),Object.assign(this.state[y][w],this.stateChanges[y][w]),x[w]=this.state[y][w];f[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(this.deletedStates[y]===null)for(const w in this.state[y])x[w]={},this.state[y][w]={};else for(const w in this.deletedStates[y]){if(this.deletedStates[y][w]===null)this.state[y][w]={};else if(this.state[y][w])for(const A of Object.keys(this.deletedStates[y][w]))delete this.state[y][w][A];x[w]=this.state[y][w]}f[y]=f[y]||{},Object.assign(f[y],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const y in n)n[y].refreshFeatureState(c)}}class Ko extends i.E{constructor(n,c,f){super(),this.id=n,this._onlySymbols=f,c.on("data",(y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),c.on("error",(()=>{this._sourceErrored=!0})),this._source=c,this._tiles={},this._cache=new ih(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Bc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,c){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,c)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const f=this._tiles[c];f.upload(n),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((n=>n.tileID)).sort(ym).map((n=>n.key))}getRenderableIds(n,c){const f=[];for(const y in this._tiles)this._isIdRenderable(+y,n,c)&&f.push(this._tiles[y]);return n?f.sort(((y,x)=>{const w=y.tileID,A=x.tileID,C=new i.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),k=new i.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-A.overscaledZ||k.y-C.y||k.x-C.x})).map((y=>y.tileID.key)):f.map((y=>y.tileID)).sort(ym).map((y=>y.key))}hasRenderableParent(n){const c=this.findLoadedParent(n,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(n,c,f){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(c||!this._tiles[n].holdingForFade())&&(f||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,c){const f=this._tiles[n];f&&(f.state!=="loading"&&(f.state=c),this._loadTile(f,this._tileLoaded.bind(this,f,n,c)))}_tileLoaded(n,c,f,y){if(y)if(n.state="errored",y.status!==404)this._source.fire(new i.y(y,{tile:n}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=i.o.now(),f==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(c,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new i.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const c=this.getRenderableIds();for(let y=0;y<c.length;y++){const x=c[y];if(n.neighboringTiles&&n.neighboringTiles[x]){const w=this.getTileByID(x);f(n,w),f(w,n)}}function f(y,x){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-y.tileID.canonical.x;const A=x.tileID.canonical.y-y.tileID.canonical.y,C=Math.pow(2,y.tileID.canonical.z),k=x.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+C)===1?w+=C:Math.abs(w-C)===1&&(w-=C)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,w,A),y.neighboringTiles&&y.neighboringTiles[k]&&(y.neighboringTiles[k].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,c,f,y){for(const x in this._tiles){let w=this._tiles[x];if(y[x]||!w.hasData()||w.tileID.overscaledZ<=c||w.tileID.overscaledZ>f)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>c+1;){const k=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[k.key],w&&w.hasData()&&(A=k)}let C=A;for(;C.overscaledZ>c;)if(C=C.scaledTo(C.overscaledZ-1),n[C.key]){y[A.key]=A;break}}}findLoadedParent(n,c){if(n.key in this._loadedParentTiles){const f=this._loadedParentTiles[n.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=n.overscaledZ-1;f>=c;f--){const y=n.scaledTo(f),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(n){const c=this._tiles[n.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,c){c=c||this._source.tileSize;const f=Math.ceil(n.width/c)+1,y=Math.ceil(n.height/c)+1,x=Math.floor(f*y*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)}handleWrapJump(n){const c=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,c){const f={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),f[x.tileID.key]=x}this._tiles=f;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(n,c,f,y,x){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(n,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let A,C=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const z=k.attenuationRange()[0],G=Math.floor(z)-Math.log2(k.getDemUpscale());C>G&&(C=G)}if(this.used||this.usedForTerrain){if(this._source.tileID)A=n.getVisibleUnwrappedCoordinates(this._source.tileID).map((z=>new i.aO(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)));else if(this.tileCoverLift!==0){const z=n.clone();z.tileCoverLift=this.tileCoverLift,A=z.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&n.projection.name==="globe"&&(A.push(new i.aO(1,0,1,0,0)),A.push(new i.aO(1,0,1,1,0)),A.push(new i.aO(1,0,1,0,1)),A.push(new i.aO(1,0,1,1,1)))}else if(A=n.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);A=A.filter((G=>z(G)))}}else A=[];if(A.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Pd(this._source.type)){const z=n.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),G=Math.min(z,this._source.maxzoom);if(w){const W=n.extendTileCover(A,G);for(const Z of W)A.push(Z)}else if(x){const W=n.extendTileCoverToNearPlane(A,this.transform.getFrustum(G),G);for(const Z of W)A.push(Z)}else if(this.castsShadows&&y){const W=n.extendTileCover(A,G,y);for(const Z of W)this._shadowCasterTiles[Z.key]=!0,A.push(Z)}}const L=this._updateRetainedTiles(A);if(Pd(this._source.type)&&A.length!==0){const z={},G={},W=Object.keys(L);for(const oe of W){const te=L[oe],le=this._tiles[oe];if(!le||le.fadeEndTime&&le.fadeEndTime<=i.o.now())continue;const fe=this.findLoadedParent(te,Math.max(te.overscaledZ-Ko.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),z[fe.tileID.key]=fe.tileID),G[oe]=te}const Z=A[A.length-1].overscaledZ;for(const oe in this._tiles){const te=this._tiles[oe];if(L[oe]||!te.hasData())continue;let le=te.tileID;for(;le.overscaledZ>Z;){le=le.scaledTo(le.overscaledZ-1);const fe=this._tiles[le.key];if(fe&&fe.hasData()&&G[le.key]){L[oe]=te.tileID;break}}}for(const oe in z)L[oe]||(this._coveredTiles[oe]=!0,L[oe]=z[oe])}for(const z in L)this._tiles[z].clearFadeHold();const V=i.bv(this._tiles,L);for(const z of V){const G=this._tiles[z];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const c={};if(n.length===0)return c;const f={},y=n.reduce(((k,L)=>Math.min(k,L.overscaledZ)),1/0),x=n[0].overscaledZ,w=Math.max(x-Ko.maxOverzooming,this._source.minzoom),A=Math.max(x+Ko.maxUnderzooming,this._source.minzoom),C={};for(const k of n){const L=this._addTile(k);c[k.key]=k,L.hasData()||y<this._source.maxzoom&&(C[k.key]=k)}this._retainLoadedChildren(C,y,A,c);for(const k of n){let L=this._tiles[k.key];if(L.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const z=k.children(this._source.maxzoom)[0],G=this.getTile(z);if(G&&G.hasData()){c[z.key]=z;continue}}else{const z=k.children(this._source.maxzoom);if(c[z[0].key]&&c[z[1].key]&&c[z[2].key]&&c[z[3].key])continue}let V=L.wasRequested();for(let z=k.overscaledZ-1;z>=w;--z){const G=k.scaledTo(z);if(f[G.key]||(f[G.key]=!0,L=this.getTile(G),!L&&V&&(L=this._addTile(G)),L&&(c[G.key]=G,V=L.wasRequested(),L.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const c=[];let f,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){f=this._loadedParentTiles[y.key];break}c.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;y=x}for(const x of c)this._loadedParentTiles[x]=f}}_addTile(n){let c=this._tiles[n.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),c;c=this._cache.getAndRemove(n),c&&(this._setTileReloadTimer(n.key,c),c.tileID=n,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,c)));const f=!!c;if(!f){const y=this.map?this.map.painter:null,x=this._source.tileSize*n.overscaleFactor();c=this._source.type==="raster-array"?new nh(n,x,this.transform.tileZoom,y,this._isRaster):new Ys(n,x,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,n.key,c.state))}return c.uses++,this._tiles[n.key]=c,f||this._source.fire(new i.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(n,c){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const f=c.getExpiryTimeout();f&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),f))}_removeTile(n){const c=this._tiles[n];c&&(c.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,c,f){const y=[],x=this.transform;if(!x)return y;const w=x.projection.name==="globe",A=i.aF(x.center.lng);for(const C in this._tiles){const k=this._tiles[C];if(f&&k.clearQueryDebugViz(),k.holdingForFade())continue;let L;if(w){const V=k.tileID.canonical;if(V.z===0){const z=[Math.abs(i.aA(A,...Uc(V,-1))-A),Math.abs(i.aA(A,...Uc(V,1))-A)];L=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(i.aA(A,...Uc(V,-1))-A),Math.abs(i.aA(A,...Uc(V,0))-A),Math.abs(i.aA(A,...Uc(V,1))-A)];L=[z.indexOf(Math.min(...z))-1]}}else L=[0];for(const V of L){const z=n.containsTile(k,x,c,V);z&&y.push(z)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,c){const f=this.getRenderableIds(n,c).map((x=>this._tiles[x].tileID)),y=this.transform.projection.name==="globe";for(const x of f)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=y?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return f}sortCoordinatesByDistance(n){const c=n.slice(),f=this.transform._camera.position,y=this.transform._camera.forward(),x={};for(const w of c){const A=1/(1<<w.canonical.z);x[w.key]=((w.canonical.x+.5)*A+w.wrap-f[0])*y[0]+((w.canonical.y+.5)*A-f[1])*y[1]-f[2]*y[2]}return c.sort(((w,A)=>x[w.key]-x[A.key])),c}hasTransition(){if(this._source.hasTransition())return!0;if(Pd(this._source.type))for(const n in this._tiles){const c=this._tiles[n];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(n,c,f){this._state.updateState(n=n||"_geojsonTileLayer",c,f)}removeFeatureState(n,c,f){this._state.removeFeatureState(n=n||"_geojsonTileLayer",c,f)}getFeatureState(n,c){return this._state.getState(n=n||"_geojsonTileLayer",c)}setDependencies(n,c,f){const y=this._tiles[n];y&&y.setDependencies(c,f)}reloadTilesForDependencies(n,c){for(const f in this._tiles)this._tiles[f].hasDependency(n,c)&&this._reloadTile(+f,"reloading");this._cache.filter((f=>!f.hasDependency(n,c)))}_preloadTiles(n,c){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(n,c))};return void this._source.on("data",C)}const f=new Map,y=Array.isArray(n)?n:[n],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const C of y){const k=C.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of k)f.set(L.key,L);this.usedForTerrain&&C.updateElevation(!1)}const A=Array.from(f.values());i.bw(A,((C,k)=>{const L=new Ys(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,(V=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),k(V,L)}))}),c)}}function ym(p,n){const c=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*n.wrap)-+(n.wrap<0);return p.overscaledZ-n.overscaledZ||f-c||n.canonical.y-p.canonical.y||n.canonical.x-p.canonical.x}function Pd(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function Uc(p,n){const c=1<<p.z;return[p.x/c+n,(p.x+1)/c+n]}Ko.maxOverzooming=10,Ko.maxUnderzooming=3;class Id{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,c=!1;for(const f in this.style._mergedLayers){const y=this.style._mergedLayers[f];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:n,visibilityChanged:c});else if(y.type==="model"){const x=this.style.getLayerSource(y);x&&x.type==="batched-model"&&this.layers.push({layer:y,visible:n,visibilityChanged:c})}}}onNewFrame(n){this.layersGotHidden=!1;for(const c of this.layers){const f=c.layer;let y=!1;f.type==="fill-extrusion"?y=!f.isHidden(n)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?y=!f.isHidden(n)&&f.paint.get("building-opacity")>0:f.type==="model"&&(y=!f.isHidden(n)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&c.visible,c.visible=y}}updateZOffset(n,c){this.currentBuildingBuckets=[];for(const y of this.layers){const x=y.layer,w=this.style.getLayerSourceCache(x);let A=1;x.type==="fill-extrusion"?A=y.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(A=y.visible?x.paint.get("building-vertical-scale"):0);let C=w?w.getTile(c):null;if(!C&&w)for(const k in w._tiles){const L=w._tiles[k];if(c.canonical.isChildOf(L.tileID.canonical)){C=L;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(x):null,tileID:C?C.tileID:c,verticalScale:A})}n.hasAnyZOffset=!1;let f=!1;for(let y=0;y<n.symbolInstances.length;y++){const x=n.symbolInstances.get(y),w=x.zOffset,A=this._getHeightAtTileOffset(c,x.tileAnchorX,x.tileAnchorY);x.zOffset=A!==Number.NEGATIVE_INFINITY?A:w,f||w===x.zOffset||(f=!0),n.hasAnyZOffset||x.zOffset===0||(n.hasAnyZOffset=!0)}f&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,c,f,y){let x=c,w=f;if(n.canonical.z!==y.canonical.z){const A=y.canonical,C=1/(1<<n.canonical.z-A.z);x=(c+n.canonical.x*i.al)*C-A.x*i.al|0,w=(f+n.canonical.y*i.al)*C-A.y*i.al|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(n,c,f){let y,x;for(let w=0;w<this.layers.length;++w){const A=this.layers[w].layer;if(A.type!=="fill-extrusion"&&A.type!=="building")continue;const{bucket:C,tileID:k,verticalScale:L}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:V,tileY:z}=this._mapCoordToOverlappingTile(n,c,f,k),G=C.getHeightAtTileCoord(V,z);G&&G.height!==void 0&&(G.hidden?y=G.height:x=Math.max(G.height*L,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){const A=this.layers[w];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:C,tileID:k}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:L,tileY:V}=this._mapCoordToOverlappingTile(n,c,f,k),z=C.getHeightAtTileCoord(L,V);if(z&&!z.hidden)return z.height===void 0&&y!==void 0?Math.min(z.maxHeight,y)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vm(p,n){const c={};for(const f in p)f!=="ref"&&(c[f]=p[f]);return i.bx.forEach((f=>{f in n&&(c[f]=n[f])})),c}function Cd(p){p=p.slice();const n=Object.create(null);for(let c=0;c<p.length;c++)n[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=vm(p[c],n[p[c].ref]));return p}const Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Vc(p,n,c){c.push({command:Xr.addSource,args:[p,n[p]]})}function Wy(p,n,c){n.push({command:Xr.removeSource,args:[p]}),c[p]=!0}function Zy(p,n,c,f){Wy(p,c,f),Vc(p,n,c)}function Od(p,n,c){let f;for(f in p[c])if(p[c].hasOwnProperty(f)&&f!=="data"&&!i.by(p[c][f],n[c][f]))return!1;for(f in n[c])if(n[c].hasOwnProperty(f)&&f!=="data"&&!i.by(p[c][f],n[c][f]))return!1;return!0}function Js(p,n,c,f,y,x){let w;for(w in n=n||{},p=p||{})p.hasOwnProperty(w)&&(i.by(p[w],n[w])||c.push({command:x,args:[f,w,n[w],y]}));for(w in n)n.hasOwnProperty(w)&&!p.hasOwnProperty(w)&&(i.by(p[w],n[w])||c.push({command:x,args:[f,w,n[w],y]}))}function $c(p){return p.id}function oh(p,n){return p[n.id]=n,p}function Md(p,n,c){const f=n.createTileMatrix(p,p.worldSize,c.toUnwrapped());return i.aB(new Float32Array(16),p.projMatrix,f)}function Xy(p,n,c){if(n.projection.name===c.projection.name)return p.projMatrix;const f=c.clone();return f.setProjection(n.projection),Md(f,n.getProjection(),p)}function Bl(p,n,c){return n.name===c.projection.name?p.projMatrix:Md(c,n,p)}class Ky{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=i.aA(n,0,1);let c=1,f=this._distances[c];const y=n*this.paddedLength+this.padding;for(;f<y&&c<this._distances.length;)f=this._distances[++c];const x=c-1,w=this._distances[x],A=f-w,C=A>0?(y-w)/A:0;return this.points[x].mult(1-C).add(this.points[c].mult(C))}}class xm{constructor(n,c,f){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(c/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,f,y,x){this._forEachCell(c,f,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(n,c,f,y){this._forEachCell(c-y,f-y,c+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(f),this.circles.push(y)}_insertBoxCell(n,c,f,y,x,w){this.boxCells[x].push(w)}_insertCircleCell(n,c,f,y,x,w){this.circleCells[x].push(w)}_query(n,c,f,y,x,w){if(f<0||n>this.width||y<0||c>this.height)return!x&&[];const A=[];if(n<=0&&c<=0&&this.width<=f&&this.height<=y){if(x)return!0;for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],L=this.circles[3*C+1],V=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:k-V,y1:L-V,x2:k+V,y2:L+V})}return w?A.filter(w):A}return this._forEachCell(n,c,f,y,this._queryCell,A,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?A.length>0:A}_queryCircle(n,c,f,y,x){const w=n-f,A=n+f,C=c-f,k=c+f;if(A<0||w>this.width||k<0||C>this.height)return!y&&[];const L=[];return this._forEachCell(w,C,A,k,this._queryCellCircle,L,{hitTest:y,circle:{x:n,y:c,radius:f},seenUids:{box:{},circle:{}}},x),y?L.length>0:L}query(n,c,f,y,x){return this._query(n,c,f,y,!1,x)}hitTest(n,c,f,y,x){return this._query(n,c,f,y,!0,x)}hitTestCircle(n,c,f,y){return this._queryCircle(n,c,f,!0,y)}_queryCell(n,c,f,y,x,w,A,C){const k=A.seenUids,L=this.boxCells[x];if(L!==null){const z=this.bboxes;for(const G of L)if(!k.box[G]){k.box[G]=!0;const W=4*G;if(n<=z[W+2]&&c<=z[W+3]&&f>=z[W+0]&&y>=z[W+1]&&(!C||C(this.boxKeys[G]))){if(A.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[G],x1:z[W],y1:z[W+1],x2:z[W+2],y2:z[W+3]})}}}const V=this.circleCells[x];if(V!==null){const z=this.circles;for(const G of V)if(!k.circle[G]){k.circle[G]=!0;const W=3*G;if(this._circleAndRectCollide(z[W],z[W+1],z[W+2],n,c,f,y)&&(!C||C(this.circleKeys[G]))){if(A.hitTest)return w.push(!0),!0;{const Z=z[W],oe=z[W+1],te=z[W+2];w.push({key:this.circleKeys[G],x1:Z-te,y1:oe-te,x2:Z+te,y2:oe+te})}}}}}_queryCellCircle(n,c,f,y,x,w,A,C){const k=A.circle,L=A.seenUids,V=this.boxCells[x];if(V!==null){const G=this.bboxes;for(const W of V)if(!L.box[W]){L.box[W]=!0;const Z=4*W;if(this._circleAndRectCollide(k.x,k.y,k.radius,G[Z+0],G[Z+1],G[Z+2],G[Z+3])&&(!C||C(this.boxKeys[W])))return w.push(!0),!0}}const z=this.circleCells[x];if(z!==null){const G=this.circles;for(const W of z)if(!L.circle[W]){L.circle[W]=!0;const Z=3*W;if(this._circlesCollide(G[Z],G[Z+1],G[Z+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[W])))return w.push(!0),!0}}}_forEachCell(n,c,f,y,x,w,A,C){const k=this._convertToXCellCoord(n),L=this._convertToYCellCoord(c),V=this._convertToXCellCoord(f),z=this._convertToYCellCoord(y);for(let G=k;G<=V;G++)for(let W=L;W<=z;W++)if(x.call(this,n,c,f,y,this.xCellCount*W+G,w,A,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,f,y,x,w){const A=y-n,C=x-c,k=f+w;return k*k>A*A+C*C}_circleAndRectCollide(n,c,f,y,x,w,A){const C=(w-y)/2,k=Math.abs(n-(y+C));if(k>C+f)return!1;const L=(A-x)/2,V=Math.abs(c-(x+L));if(V>L+f)return!1;if(k<=C||V<=L)return!0;const z=k-C,G=V-L;return z*z+G*G<=f*f}}const qc={unknown:0,flipRequired:1,flipNotRequired:2},Rd=Math.tan(85*Math.PI/180);function wa(p,n,c,f,y,x,w){const A=i.bC();if(c)if(x.name==="globe"){const C=i.bD(y,n);i.aB(A,A,C)}else{const C=i.bE([],w);A[0]=C[0],A[1]=C[1],A[4]=C[2],A[5]=C[3],f||i.bB(A,A,y.angle)}else i.aB(A,y.labelPlaneMatrix,p);return A}function ah(p,n,c,f,y,x,w){const A=wa(p,n,c,f,y,x,w);return x.name==="globe"&&c||(A[2]=A[6]=A[10]=A[14]=0),A}function Dd(p,n,c,f,y,x,w){if(c){if(x.name==="globe"){const A=wa(p,n,c,f,y,x,w);return i.bl(A,A),i.aB(A,p,A),A}{const A=i.bz(p),C=i.bA([]);return C[0]=w[0],C[1]=w[1],C[4]=w[2],C[5]=w[3],i.aB(A,A,C),f||i.bB(A,A,-y.angle),A}}return y.glCoordMatrix}function Yo(p,n,c,f){const y=[p,n,c,1];c?i.aC(y,y,f):Tm(y,y,f);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function Ul(p,n){return Math.min(.5+p/n*.5,1.5)}function Jo(p,n){const c=p[0]/p[3],f=p[1]/p[3];return c>=-n[0]&&c<=n[0]&&f>=-n[1]&&f<=n[1]}function bm(p,n,c,f,y,x,w,A,C,k){const L=c.transform,V=f?p.textSizeData:p.iconSizeData,z=i.bK(V,c.transform.zoom),G=L.projection.name==="globe",W=[256/c.width*2+1,256/c.height*2+1],Z=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Z.clear();let oe=null;G&&(oe=f?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const te=p.lineVertexArray,le=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,fe=c.transform.width/c.transform.height;let me,we=!1;for(let xe=0;xe<le.length;xe++){const Se=le.get(xe),{numGlyphs:be,writingMode:ve}=Se;if(ve!==i.bL.vertical||we||me===i.bL.horizontal||(we=!0),me=ve,(Se.hidden||ve===i.bL.vertical)&&!we){lr(be,Z);continue}we=!1;const Te=new i.P(Se.tileAnchorX,Se.tileAnchorY);let{x:qe,y:je,z:tt}=L.projection.projectTilePoint(Te.x,Te.y,k.canonical);if(C){const[gt,Kt,Wt]=C(Te);qe+=gt,je+=Kt,tt+=Wt}const Ve=[qe,je,tt,1];if(i.aC(Ve,Ve,n),!Jo(Ve,W)){lr(be,Z);continue}const et=Ve[3],Et=Ul(c.transform.getCameraToCenterDistance(L.projection),et),$e=i.bM(V,z,Se),Re=w?$e/Et:$e*Et,at=Yo(qe,je,tt,y);if(at[3]<=0){lr(be,Z);continue}let We={};const dt=i.an(p.layers[0].layout.get("text-max-angle")),At=Math.cos(dt),Lt=w?null:C,xt=cn(Se,Re,!1,A,n,y,x,p.glyphOffsetArray,te,Z,oe,at,Te,We,fe,Lt,L.projection,k,w,At);we=xt.useVertical,Lt&&xt.needsFlipping&&(We={}),(xt.notEnoughRoom||we||xt.needsFlipping&&cn(Se,Re,!0,A,n,y,x,p.glyphOffsetArray,te,Z,oe,at,Te,We,fe,Lt,L.projection,k,w,At).notEnoughRoom)&&lr(be,Z)}f?(p.text.dynamicLayoutVertexBuffer.updateData(Z),oe&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(oe)):(p.icon.dynamicLayoutVertexBuffer.updateData(Z),oe&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(oe))}function kd(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe){const{lineStartIndex:te,glyphStartIndex:le,segment:fe}=A,me=le+A.numGlyphs,we=te+A.lineLength,xe=n.getoffsetX(le),Se=n.getoffsetX(me-1),be=Nd(p*xe,c,f,y,x,w,fe,te,we,C,k,L,V,z,!0,G,W,Z,oe);if(!be)return null;const ve=Nd(p*Se,c,f,y,x,w,fe,te,we,C,k,L,V,z,!0,G,W,Z,oe);return ve?{first:be,last:ve}:null}function wm(p,n,c,f){return p===i.bL.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:p===i.bL.vertical?f>0?{needsFlipping:!0}:null:n!==qc.unknown&&(function(y,x){return y===0||Math.abs(x/y)>Rd})(c,f)?n===qc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function cn(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te,le,fe){const me=n/24,we=p.lineOffsetX*me,xe=p.lineOffsetY*me,{lineStartIndex:Se,glyphStartIndex:be,numGlyphs:ve,segment:Te,writingMode:qe,flipState:je}=p,tt=Se+p.lineLength,Ve=et=>{if(L){const[at,We,dt]=et.up,At=k.length;i.bN(L,At+0,at,We,dt),i.bN(L,At+1,at,We,dt),i.bN(L,At+2,at,We,dt),i.bN(L,At+3,at,We,dt)}const[Et,$e,Re]=et.point;i.bO(k,Et,$e,Re,et.angle)};if(ve>1){const et=kd(me,A,we,xe,c,V,z,p,C,x,G,Z,!1,oe,te,le,fe);if(!et)return{notEnoughRoom:!0};if(f&&!c){let[Et,$e,Re]=et.first.point,[at,We,dt]=et.last.point;[Et,$e]=Yo(Et,$e,Re,w),[at,We]=Yo(at,We,dt,w);const At=wm(qe,je,(at-Et)*W,We-$e);if(p.flipState=At&&At.needsFlipping?qc.flipRequired:qc.flipNotRequired,At)return At}Ve(et.first);for(let Et=be+1;Et<be+ve-1;Et++){const $e=Nd(me*A.getoffsetX(Et),we,xe,c,V,z,Te,Se,tt,C,x,G,Z,!1,!1,oe,te,le,fe);if(!$e)return k.length-=4*(Et-be),{notEnoughRoom:!0};Ve($e)}Ve(et.last)}else{if(f&&!c){const Et=Yo(z.x,z.y,0,y),$e=Se+Te+1,Re=new i.P(C.getx($e),C.gety($e)),at=Yo(Re.x,Re.y,0,y),We=at[3]>0?at:Yy(z,Re,Et,1,y,void 0,oe,te.canonical),dt=wm(qe,je,(We[0]-Et[0])*W,We[1]-Et[1]);if(p.flipState=dt&&dt.needsFlipping?qc.flipRequired:qc.flipNotRequired,dt)return dt}const et=Nd(me*A.getoffsetX(be),we,xe,c,V,z,Te,Se,tt,C,x,G,Z,!1,!1,oe,te,le,fe);if(!et)return{notEnoughRoom:!0};Ve(et)}return{}}function Sm(p,n,c,f,y){const{x,y:w,z:A}=f.projectTilePoint(p.x,p.y,n);if(!y)return Yo(x,w,A,c);const[C,k,L]=y(p);return Yo(x+C,w+k,A+L,c)}function Yy(p,n,c,f,y,x,w,A){const C=Sm(p.sub(n)._unit()._add(p),A,y,w,x);return i.av(C,c,C),i.aw(C,C),i.bH(C,c,C,f)}function Nd(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te,le){const fe=f?p-n:p+n;let me=fe>0?1:-1,we=0;f&&(me*=-1,we=Math.PI),me<0&&(we+=Math.PI);let xe=A+w+(me>0?0:1)|0,Se=y,be=y,ve=0,Te=0;const qe=Math.abs(fe),je=[],tt=[];let Ve=x,et=Ve,Et=i.bF([]);const $e=()=>Yy(et,Ve,be,qe-ve+1,L,z,Z,oe.canonical);for(;ve+Te<=qe;){if(xe+=me,xe<A||xe>=C)return null;if(be=Se,et=Ve,je.push(be),G&&tt.push(et),Ve=new i.P(k.getx(xe),k.gety(xe)),Se=V[xe],!Se){const Wt=Sm(Ve,oe.canonical,L,Z,z);Se=Wt[3]>0?V[xe]=Wt:$e()}ve+=Te;const gt=i.av([],Se,be),Kt=i.bG(be,Se);if(c&&Kt>0&&Te>0&&i.bJ(Et,gt)/(Te*Kt)<le)return null;Te=Kt,Et=gt}W&&z&&(V[xe]&&(Se=$e(),Te=i.bG(be,Se),Et=i.av([],Se,be)),V[xe]=Se);const Re=(qe-ve)/Te,at=Ve.sub(et)._mult(Re)._add(et),We=i.bH([],be,Et,Re);let dt=[0,0,1],At=Et[0],Lt=Et[1];if(te&&(dt=Z.upVector(oe.canonical,at.x,at.y),dt[0]!==0||dt[1]!==0||dt[2]!==1)){const gt=[dt[2],0,-dt[0]],Kt=i.bI([],dt,gt);i.aw(gt,gt),i.aw(Kt,Kt),At=i.bJ(Et,gt),Lt=i.bJ(Et,Kt)}if(c){const gt=i.bI([],dt,Et);i.aw(gt,gt),i.bH(We,We,gt,c*me)}const xt=we+Math.atan2(Lt,At);return je.push(We),G&&tt.push(at),{point:We,angle:xt,path:je,tilePath:tt,up:dt}}function lr(p,n){const c=n.length,f=c+4*p;n.resize(f),n.float32.fill(-1/0,4*c,4*f)}function Tm(p,n,c){const f=n[0],y=n[1];return p[0]=c[0]*f+c[4]*y+c[12],p[1]=c[1]*f+c[5]*y+c[13],p[3]=c[3]*f+c[7]*y+c[15],p}const Qo=100;class Sa{constructor(n,c,f=new xm(n.width+200,n.height+200,25),y=new xm(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Qo,this.screenBottomBoundary=n.height+Qo,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,f,y,x,w,A,C,k,L,V){let z=f.projectedAnchorX,G=f.projectedAnchorY,W=f.projectedAnchorZ;const Z=f.tileAnchorX,oe=f.tileAnchorY,te=f.elevation,le=f.tileID,fe=n.getProjection();if(te&&le){const[tt,Ve,et]=fe.upVector(le.canonical,f.tileAnchorX,f.tileAnchorY),Et=fe.upVectorScale(le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=tt*te*Et,G+=Ve*te*Et,W+=et*te*Et}const me=n.projection.name==="globe",we=n.projection.name==="globe"?i.aj(this.transform.zoom):0;if(le&&me&&we<1&&!w){const tt=1<<le.canonical.z,Ve=i.bP(Z,oe);i.bQ(Ve,Ve,1/i.al),i.bR(Ve,Ve,i.bP(le.canonical.x,le.canonical.y)),i.bQ(Ve,Ve,1/tt),i.bS(Ve,Ve,i.bP(y[0],y[1])),Ve[0]=i.bT(Ve[0],-.5,.5),i.bQ(Ve,Ve,i.al);const et=i.bU(Ve[0],Ve[1],i.al/(2*Math.PI),1);i.aC(et,et,x),z=i.ak(z,et[0],we),G=i.ak(G,et[1],we),W=i.ak(W,et[2],we)}const xe=this.projectAndGetPerspectiveRatio(L,z,G,W,f.tileID,fe.name==="globe"||!!te||this.transform.pitch>0,fe),Se=k*xe.perspectiveRatio,be=(f.x1*c+A.x-f.padding)*Se+xe.point.x,ve=(f.y1*c+A.y-f.padding)*Se+xe.point.y,Te=(f.x2*c+A.x+f.padding)*Se+xe.point.x,qe=(f.y2*c+A.y+f.padding)*Se+xe.point.y,je=xe.perspectiveRatio<=.55||xe.occluded;return!this.isInsideGrid(be,ve,Te,qe)||!C&&this.grid.hitTest(be,ve,Te,qe,V)||je?{box:[],offscreen:!1,occluded:xe.occluded}:{box:[be,ve,Te,qe],offscreen:this.isOffscreen(be,ve,Te,qe),occluded:!1}}placeCollisionCircles(n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z){const oe=[],te=this.transform.elevation,le=n.getProjection(),fe=te?te.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,le):null,me=new i.P(f.tileAnchorX,f.tileAnchorY);let{x:we,y:xe,z:Se}=le.projectTilePoint(me.x,me.y,Z.canonical);if(fe){const[dt,At,Lt]=fe(me);we+=dt,xe+=At,Se+=Lt}const be=le.name==="globe",ve=this.projectAndGetPerspectiveRatio(A,we,xe,Se,Z,be||!!te||this.transform.pitch>0,le),{perspectiveRatio:Te}=ve,qe=(V?w/Te:w*Te)/i.bX,je=Yo(we,xe,Se,C),tt=f.lineOffsetX*qe,Ve=f.lineOffsetY*qe,et=i.an(n.layers[0].layout.get("text-max-angle")),Et=Math.cos(et),$e=ve.signedDistanceFromCamera>0?kd(qe,x,tt,Ve,!1,je,me,f,y,C,{},te&&!V?fe:null,V&&!!te,le,Z,V,Et):null;let Re=!1,at=!1,We=!0;if($e&&!ve.occluded){const dt=.5*G*Te+W,At=new i.P(-100,-100),Lt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),xt=new Ky,{first:gt,last:Kt}=$e,Wt=gt.path.length;let Xt=[];for(let Ar=Wt-1;Ar>=1;Ar--)Xt.push(gt.path[Ar]);for(let Ar=1;Ar<Kt.path.length;Ar++)Xt.push(Kt.path[Ar]);const Ht=2.5*dt;k&&(Xt=Xt.map((([Ar,Cr,hn],vr)=>(fe&&!be&&(hn=fe(vr<Wt-1?gt.tilePath[Wt-1-vr]:Kt.tilePath[vr-Wt+2])[2]),Yo(Ar,Cr,hn,k)))),Xt.some((Ar=>Ar[3]<=0))&&(Xt=[]));let gr=[];if(Xt.length>0){let Ar=1/0,Cr=-1/0,hn=1/0,vr=-1/0;for(const Yr of Xt)Ar=Math.min(Ar,Yr[0]),hn=Math.min(hn,Yr[1]),Cr=Math.max(Cr,Yr[0]),vr=Math.max(vr,Yr[1]);Cr>=At.x&&Ar<=Lt.x&&vr>=At.y&&hn<=Lt.y&&(gr=[Xt.map((Yr=>new i.P(Yr[0],Yr[1])))],(Ar<At.x||Cr>Lt.x||hn<At.y||vr>Lt.y)&&(gr=i.bV(gr,At.x,At.y,Lt.x,Lt.y)))}for(const Ar of gr){xt.reset(Ar,.25*dt);let Cr=0;Cr=xt.length<=.5*dt?1:Math.ceil(xt.paddedLength/Ht)+1;for(let hn=0;hn<Cr;hn++){const vr=hn/Math.max(Cr-1,1),Yr=xt.lerp(vr),ln=Yr.x+Qo,zn=Yr.y+Qo;oe.push(ln,zn,dt,0);const Er=ln-dt,tn=zn-dt,Qr=ln+dt,on=zn+dt;if(We=We&&this.isOffscreen(Er,tn,Qr,on),at=at||this.isInsideGrid(Er,tn,Qr,on),!c&&this.grid.hitTestCircle(ln,zn,dt,z)&&(Re=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!L&&Re||!at?[]:oe,offscreen:We,collisionDetected:Re,occluded:ve.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let f=1/0,y=1/0,x=-1/0,w=-1/0;for(const L of n){const V=new i.P(L.x+Qo,L.y+Qo);f=Math.min(f,V.x),y=Math.min(y,V.y),x=Math.max(x,V.x),w=Math.max(w,V.y),c.push(V)}const A=this.grid.query(f,y,x,w).concat(this.ignoredGrid.query(f,y,x,w)),C={},k={};for(const L of A){const V=L.key;if(C[V.bucketInstanceId]===void 0&&(C[V.bucketInstanceId]={}),C[V.bucketInstanceId][V.featureIndex])continue;const z=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.bW(c,z)&&(C[V.bucketInstanceId][V.featureIndex]=!0,k[V.bucketInstanceId]===void 0&&(k[V.bucketInstanceId]=[]),k[V.bucketInstanceId].push(V.featureIndex))}return k}insertCollisionBox(n,c,f,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,f,y,x){const w=c?this.ignoredGrid:this.grid,A={bucketInstanceId:f,featureIndex:y,collisionGroupID:x};for(let C=0;C<n.length;C+=4)w.insertCircle(A,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,c,f,y,x,w,A){const C=[c,f,y,1];let k=!1;y||this.transform.pitch>0?(i.aC(C,C,n),this.fogState&&x&&A.name!=="globe"&&(k=(function(z,G,W,Z,oe,te){const le=te.calculateFogTileMatrix(oe),fe=[G,W,Z];return i.af(fe,fe,le),pr(z,i.ag(fe),te.pitch,te._fov)})(this.fogState,c,f,y,x.toUnwrapped(),this.transform)>.9)):Tm(C,C,n);const L=C[3];return{point:new i.P((C[0]/L+1)/2*this.transform.width+Qo,(-C[1]/L+1)/2*this.transform.height+Qo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/L*.5,1.5),signedDistanceFromCamera:L,occluded:w&&C[2]>L||k}}isOffscreen(n,c,f,y){return f<Qo||n>=this.screenRightBoundary||y<Qo||c>this.screenBottomBoundary}isInsideGrid(n,c,f,y){return f>=0&&n<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=i.bA([]);return i.br(n,n,[-100,-100,0]),n}}class Ld{constructor(n,c,f,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):y&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Za{constructor(n,c,f,y,x,w=!1){this.text=new Ld(n?n.text:null,c,f,x),this.icon=new Ld(n?n.icon:null,c,y,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jt{constructor(n,c,f,y=!1){this.text=n,this.icon=c,this.skipFade=f,this.clipped=y}}class un{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class mn{constructor(n,c,f,y,x){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=x}}class jo{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[n]}}function Vl(p,n,c,f,y){const{horizontalAlign:x,verticalAlign:w}=i.c0(p),A=-(x-.5)*n,C=-(w-.5)*c,k=i.c1(p,f);return new i.P(A+k[0]*y,C+k[1]*y)}function nn(p,n,c,f,y){const x=new i.P(p,n);return c&&x._rotate(f?y:-y),x}class jd{constructor(n,c,f,y,x,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Sa(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new jo(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,f,y,x=1){const w=f.getBucket(c),A=f.latestFeatureIndex;if(!w||!A||c.fqid!==w.layerIds[0])return;const C=w.layers[0].layout,k=w.layers[0].paint,L=f.collisionBoxArray,V=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/i.al,G=f.tileID.toUnwrapped();this.transform.setProjection(w.projection);const W=(Z=f.tileID,oe=w.getProjection(),te=this.transform,oe.name===this.projection?te.calculateProjMatrix(Z.toUnwrapped()):Md(te,oe,Z));var Z,oe,te;const le=C.get("text-pitch-alignment")==="map",fe=C.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const me=c.dynamicFilter(),we=c.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(f),Se=ah(W,f.tileID.canonical,le,fe,this.transform,w.getProjection(),xe);let be=null;const ve=w.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(le){const Re=Dd(W,f.tileID.canonical,le,fe,this.transform,w.getProjection(),xe);be=i.aB([],this.transform.labelPlaneMatrix,Re)}let Te=null;me&&f.latestFeatureIndex&&(Te={unwrappedTileID:G,dynamicFilter:me,dynamicFilterNeedsFeature:we}),this.retainedQueryData[w.bucketInstanceId]=new mn(w.bucketInstanceId,A,w.sourceLayerIndex,w.index,f.tileID);const[qe,je]=w.layers[0].layout.get("text-size-scale-range"),tt=i.aA(x,qe,je),[Ve,et]=C.get("icon-size-scale-range"),Et=i.aA(x,Ve,et),$e={bucket:w,layout:C,paint:k,posMatrix:W,invMatrix:ve,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Se,labelToScreenMatrix:be,clippingData:Te,scale:V,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:i.bK(w.textSizeData,this.transform.zoom,tt),partiallyEvaluatedIconSize:i.bK(w.iconSizeData,this.transform.zoom,Et),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(y)for(const Re of w.sortKeyRanges){const{sortKey:at,symbolInstanceStart:We,symbolInstanceEnd:dt}=Re;n.push({sortKey:at,symbolInstanceStart:We,symbolInstanceEnd:dt,parameters:$e})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:$e})}attemptAnchorPlacement(n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te,le,fe,me,we){const{textOffset0:xe,textOffset1:Se,crossTileID:be}=Z,ve=[xe,Se],Te=Vl(n,w,A,ve,C),qe=this.collisionIndex.placeCollisionBox(te,C,c,f,y,x,nn(Te.x,Te.y,k,L,this.transform.angle),W,V,z,G.predicate);if(fe){const je=te.getSymbolInstanceIconSize(we,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,je,fe,f,y,x,nn(Te.x,Te.y,k,L,this.transform.angle),W,V,z,G.predicate).box.length===0)return}if(qe.box.length>0){let je;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(je=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:ve,width:w,height:A,anchor:n,textScale:C,prevAnchor:je},this.markUsedJustification(te,n,Z,le),te.allowVerticalPlacement&&(this.markUsedOrientation(te,le,Z),this.placedOrientations[be]=le),{shift:Te,placedGlyphBoxes:qe}}}placeLayerBucketPart(n,c,f,y,x=1){const{bucket:w,layout:A,paint:C,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:V,clippingData:z,textPixelRatio:G,mercatorCenter:W,invMatrix:Z,holdingForFade:oe,collisionBoxArray:te,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:fe,collisionGroup:me,latestFeatureIndex:we}=n.parameters,xe=A.get("text-optional"),Se=A.get("icon-optional"),be=A.get("text-allow-overlap"),ve=A.get("icon-allow-overlap"),Te=A.get("text-rotation-alignment")==="map",qe=A.get("icon-rotation-alignment")==="map",je=A.get("text-pitch-alignment")==="map",tt=C.get("symbol-z-offset"),Ve=A.get("symbol-elevation-reference")==="sea",et=A.get("symbol-placement"),[Et,$e]=A.get("text-size-scale-range"),[Re,at]=A.get("icon-size-scale-range"),We=i.aA(x,Et,$e),dt=i.aA(x,Re,at),At=A.get("text-variable-anchor"),Lt=Te&&et!=="point",xt=qe&&et!=="point",gt=At&&w.hasTextData(),Kt=w.hasIconTextFit()&&gt&&w.hasIconData();this.transform.setProjection(w.projection);const Wt=gt||Lt,Xt=xt||Kt;let Ht=be&&(ve||!w.hasIconData()||Se),gr=ve&&(be||!w.hasTextData()||xe);const Ar=!tt.isConstant();!w.collisionArrays&&te&&w.deserializeCollisionBoxes(te),f&&y&&w.updateCollisionDebugBuffers(this.transform.zoom,te,We,dt);const Cr=(vr,Yr,ln)=>{const{crossTileID:zn,numVerticalGlyphVertices:Er}=vr;let tn=null;if(z&&z.dynamicFilterNeedsFeature||Ar){const ei=this.retainedQueryData[w.bucketInstanceId];tn=we.loadFeature({featureIndex:vr.featureIndex,bucketIndex:ei.bucketIndex,sourceLayerIndex:ei.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},tn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new i.P(vr.tileAnchorX,vr.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[zn]=new Jt(!1,!1,!1,!0),void c.add(zn);const Qr=tt.evaluate(tn,{});if(c.has(zn))return;if(oe)return void(this.placements[zn]=new Jt(!1,!1,!1));let on=!1,Bn=!1,oi=!0,ji=!1,Un=!1,Or=null,hr={box:null,offscreen:null,occluded:null},dn={box:null},Kn=null,$n=null,mi=null,qi=0,na=0,ia=0;ln.textFeatureIndex?qi=ln.textFeatureIndex:vr.useRuntimeCollisionCircles&&(qi=vr.featureIndex),ln.verticalTextFeatureIndex&&(na=ln.verticalTextFeatureIndex);const Fo=ei=>{ei.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const ai=this.transform.elevation;ei.elevation=Ve?Qr:Qr+(ai?ai.getAtTileOffset(ei.tileID,ei.tileAnchorX,ei.tileAnchorY):0),ei.elevation+=vr.zOffset},Bo=ln.textBox;if(Bo){Fo(Bo);const ei=qn=>{let Si=i.bL.horizontal;if(w.allowVerticalPlacement&&!qn&&this.prevPlacement){const zi=this.prevPlacement.placedOrientations[zn];zi&&(this.placedOrientations[zn]=zi,Si=zi,this.markUsedOrientation(w,Si,vr))}return Si},ai=(qn,Si)=>{if(w.allowVerticalPlacement&&Er>0&&ln.verticalTextBox){for(const zi of w.writingModes)if(zi===i.bL.vertical?(hr=Si(),dn=hr):hr=qn(),hr&&hr.box&&hr.box.length)break}else hr=qn()};if(At){let qn=At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[zn]){const fi=this.prevPlacement.variableOffsets[zn];qn.indexOf(fi.anchor)>0&&(qn=qn.filter((Qi=>Qi!==fi.anchor)),qn.unshift(fi.anchor))}const Si=(fi,Qi,es)=>{const Ps=w.getSymbolInstanceTextSize(le,vr,this.transform.zoom,Yr),Oa=(fi.x2-fi.x1)*Ps+2*fi.padding,gl=(fi.y2-fi.y1)*Ps+2*fi.padding,_l=vr.hasIconTextFit&&!ve?Qi:null;_l&&Fo(_l);let ts={box:[],offscreen:!1,occluded:!1};const _u=be?2*qn.length:qn.length;for(let Is=0;Is<_u;++Is){const rs=this.attemptAnchorPlacement(qn[Is%qn.length],fi,W,Z,Wt,Oa,gl,Ps,Te,je,G,k,me,Is>=qn.length,vr,Yr,w,es,_l,le,fe);if(rs&&(ts=rs.placedGlyphBoxes,ts&&ts.box&&ts.box.length)){on=!0,Or=rs.shift;break}}return ts};ai((()=>Si(Bo,ln.iconBox,i.bL.horizontal)),(()=>{const fi=ln.verticalTextBox;return fi&&Fo(fi),w.allowVerticalPlacement&&!(hr&&hr.box&&hr.box.length)&&Er>0&&fi?Si(fi,ln.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}})),hr&&(on=hr.box,oi=hr.offscreen,ji=hr.occluded);const zi=ei(!(!hr||!hr.box));if(!on&&this.prevPlacement){const fi=this.prevPlacement.variableOffsets[zn];fi&&(this.variableOffsets[zn]=fi,this.markUsedJustification(w,fi.anchor,vr,zi))}}else{const qn=(Si,zi)=>{const fi=w.getSymbolInstanceTextSize(le,vr,this.transform.zoom,Yr),Qi=this.collisionIndex.placeCollisionBox(w,fi,Si,W,Z,Wt,new i.P(0,0),be,G,k,me.predicate);return Qi&&Qi.box&&Qi.box.length&&(this.markUsedOrientation(w,zi,vr),this.placedOrientations[zn]=zi),Qi};ai((()=>qn(Bo,i.bL.horizontal)),(()=>{const Si=ln.verticalTextBox;return w.allowVerticalPlacement&&Er>0&&Si?(Fo(Si),qn(Si,i.bL.vertical)):{box:null,offscreen:null,occluded:null}})),ei(!!(hr&&hr.box&&hr.box.length))}}if(Kn=hr,on=Kn&&Kn.box&&Kn.box.length>0,oi=Kn&&Kn.offscreen,ji=Kn&&Kn.occluded,vr.useRuntimeCollisionCircles){const ei=w.text.placedSymbolArray.get(vr.centerJustifiedTextSymbolIndex>=0?vr.centerJustifiedTextSymbolIndex:vr.verticalPlacedTextSymbolIndex),ai=i.bM(w.textSizeData,le,ei),qn=A.get("text-padding");$n=this.collisionIndex.placeCollisionCircles(w,be,ei,w.lineVertexArray,w.glyphOffsetArray,ai,k,L,V,f,je,me.predicate,vr.collisionCircleDiameter*ai/i.bX,qn,this.retainedQueryData[w.bucketInstanceId].tileID),on=be||$n.circles.length>0&&!$n.collisionDetected,oi=oi&&$n.offscreen,ji=$n.occluded}if(ln.iconFeatureIndex&&(ia=ln.iconFeatureIndex),ln.iconBox){const ei=ai=>{Fo(ai);const qn=vr.hasIconTextFit&&Or?nn(Or.x,Or.y,Te,je,this.transform.angle):new i.P(0,0),Si=w.getSymbolInstanceIconSize(fe,this.transform.zoom,vr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Si,ai,W,Z,Xt,qn,ve,G,k,me.predicate)};dn&&dn.box&&dn.box.length&&ln.verticalIconBox?(mi=ei(ln.verticalIconBox),Bn=mi.box.length>0):(mi=ei(ln.iconBox),Bn=mi.box.length>0),oi=oi&&mi.offscreen,Un=mi.occluded}const So=xe||vr.numHorizontalGlyphVertices===0&&Er===0,pa=Se||vr.numIconVertices===0;if(So||pa?pa?So||(Bn=Bn&&on):on=Bn&&on:Bn=on=Bn&&on,on&&Kn&&Kn.box&&this.collisionIndex.insertCollisionBox(Kn.box,A.get("text-ignore-placement"),w.bucketInstanceId,dn&&dn.box&&na?na:qi,me.ID),Bn&&mi&&this.collisionIndex.insertCollisionBox(mi.box,A.get("icon-ignore-placement"),w.bucketInstanceId,ia,me.ID),$n&&(on&&this.collisionIndex.insertCollisionCircles($n.circles,A.get("text-ignore-placement"),w.bucketInstanceId,qi,me.ID),f)){const ei=w.bucketInstanceId;let ai=this.collisionCircleArrays[ei];ai===void 0&&(ai=this.collisionCircleArrays[ei]=new un);for(let qn=0;qn<$n.circles.length;qn+=4)ai.circles.push($n.circles[qn+0]),ai.circles.push($n.circles[qn+1]),ai.circles.push($n.circles[qn+2]),ai.circles.push($n.collisionDetected?1:0)}const Ca=w.projection.name!=="globe";Ht=Ht&&(Ca||!ji),gr=gr&&(Ca||!Un),this.placements[zn]=new Jt(on||Ht,Bn||gr,oi||w.justReloaded),c.add(zn)},hn=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,hn),w.elevationType==="road"&&w.updateRoadElevation(hn.canonical),w.updateZOffset(),w.sortFeaturesByY){const vr=w.getSortedSymbolIndexes(this.transform.angle);for(let Yr=vr.length-1;Yr>=0;--Yr){const ln=vr[Yr];Cr(w.symbolInstances.get(ln),ln,w.collisionArrays[ln])}w.hasAnyZOffset&&i.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const vr=w.getSortedIndexesByZOffset();for(let Yr=0;Yr<vr.length;++Yr){const ln=vr[Yr];Cr(w.symbolInstances.get(ln),ln,w.collisionArrays[ln])}}else for(let vr=n.symbolInstanceStart;vr<n.symbolInstanceEnd;vr++)Cr(w.symbolInstances.get(vr),vr,w.collisionArrays[vr]);if(f&&w.bucketInstanceId in this.collisionCircleArrays){const vr=this.collisionCircleArrays[w.bucketInstanceId];i.bl(vr.invProjMatrix,k),vr.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,c,f,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:C,crossTileID:k}=f,L=i.c2(c),V=y===i.bL.vertical?C:L==="left"?x:L==="center"?w:L==="right"?A:-1;x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=V>=0&&x!==V?0:k),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=V>=0&&w!==V?0:k),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=V>=0&&A!==V?0:k),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=V>=0&&C!==V?0:k)}markUsedOrientation(n,c,f){const y=c===i.bL.horizontal||c===i.bL.horizontalOnly?c:0,x=c===i.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k}=f,L=n.text.placedSymbolArray;w>=0&&(L.get(w).placedOrientation=y),A>=0&&(L.get(A).placedOrientation=y),C>=0&&(L.get(C).placedOrientation=y),k>=0&&(L.get(k).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(n):1,x=c?c.opacities:{},w=c?c.variableOffsets:{},A=c?c.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],L=x[C];L?(this.opacities[C]=new Za(L,y,k.text,k.icon,null,k.clipped),f=f||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[C]=new Za(null,y,k.text,k.icon,k.skipFade,k.clipped),f=f||k.text||k.icon)}for(const C in x){const k=x[C];if(!this.opacities[C]){const L=new Za(k,y,!1,!1);L.isHidden()||(this.opacities[C]=L,f=f||k.text.placed||k.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in A)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=A[C]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c,f,y){const x=new Set;for(const w of c){const A=w.getBucket(n);A&&w.latestFeatureIndex&&n.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,x,w,w.collisionBoxArray,f,y,w.tileID,n.scope),A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,w.tileID),A.elevationType==="road"&&A.updateRoadElevation(w.tileID.canonical),A.updateZOffset())}}updateBucketOpacities(n,c,f,y,x,w,A,C){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const k=n.layers[0].layout,L=n.layers[0].paint,V=!!n.layers[0].dynamicFilter(),z=new Za(null,0,!1,!1,!0),G=k.get("text-allow-overlap"),W=k.get("icon-allow-overlap"),Z=k.get("text-variable-anchor"),oe=k.get("text-rotation-alignment")==="map",te=k.get("text-pitch-alignment")==="map",le=L.get("symbol-z-offset"),fe=k.get("symbol-elevation-reference")==="sea",me=!le.isConstant(),we=new Za(null,0,G&&(W||!n.hasIconData()||k.get("icon-optional")),W&&(G||!n.hasTextData()||k.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const xe=(be,ve,Te)=>{for(let qe=0;qe<ve/4;qe++)be.opacityVertexArray.emplaceBack(Te)};let Se=0;w&&n.updateReplacement(A,w);for(let be=0;be<n.symbolInstances.length;be++){const ve=n.symbolInstances.get(be),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:qe,crossTileID:je,numIconVertices:tt,tileAnchorX:Ve,tileAnchorY:et}=ve;let Et=null;const $e=this.retainedQueryData[n.bucketInstanceId];me&&ve&&$e&&(Et=f.latestFeatureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:$e.bucketIndex,sourceLayerIndex:$e.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=le.evaluate(Et,{}),at=c.has(je);let We=this.opacities[je];at?We=z:We||(We=we,this.opacities[je]=We),c.add(je);const dt=Te>0||qe>0,At=tt>0,Lt=this.placedOrientations[je],xt=Lt===i.bL.vertical,gt=Lt===i.bL.horizontal||Lt===i.bL.horizontalOnly;!dt&&!At||We.isHidden()||Se++;let Kt=!1;if((dt||At)&&w)for(const Wt of n.activeReplacements){if(i.bY(Wt,x,i.bZ.Symbol,C)||Wt.min.x>Ve||Ve>Wt.max.x||Wt.min.y>et||et>Wt.max.y)continue;const Xt=i.b_(Ve,et,A.canonical,Wt.footprintTileId.canonical);if(Kt=i.b$(Xt,Wt.footprint),Kt)break}if(dt){const Wt=Kt?el:uh(We.text);xe(n.text,Te,xt?el:Wt),xe(n.text,qe,gt?el:Wt);const Xt=We.text.isHidden(),{leftJustifiedTextSymbolIndex:Ht,centerJustifiedTextSymbolIndex:gr,rightJustifiedTextSymbolIndex:Ar,verticalPlacedTextSymbolIndex:Cr}=ve,hn=n.text.placedSymbolArray,vr=Xt||xt?1:0;Ht>=0&&(hn.get(Ht).hidden=vr),gr>=0&&(hn.get(gr).hidden=vr),Ar>=0&&(hn.get(Ar).hidden=vr),Cr>=0&&(hn.get(Cr).hidden=Xt||gt?1:0);const Yr=this.variableOffsets[je];Yr&&this.markUsedJustification(n,Yr.anchor,ve,Lt);const ln=this.placedOrientations[je];ln&&(this.markUsedJustification(n,"left",ve,ln),this.markUsedOrientation(n,ln,ve))}if(At){const Wt=Kt?el:uh(We.icon),{placedIconSymbolIndex:Xt,verticalPlacedIconSymbolIndex:Ht}=ve,gr=n.icon.placedSymbolArray,Ar=We.icon.isHidden()?1:0;Xt>=0&&(xe(n.icon,tt,xt?el:Wt),gr.get(Xt).hidden=Ar),Ht>=0&&(xe(n.icon,ve.numVerticalIconVertices,gt?el:Wt),gr.get(Ht).hidden=Ar)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Wt=n.collisionArrays[be];if(Wt){let Xt=new i.P(0,0),Ht=!0;if(Wt.textBox||Wt.verticalTextBox){if(Z){const Ar=this.variableOffsets[je];Ar?(Xt=Vl(Ar.anchor,Ar.width,Ar.height,Ar.textOffset,Ar.textScale),oe&&Xt._rotate(te?this.transform.angle:-this.transform.angle)):Ht=!1}V&&(Ht=!We.clipped),Wt.textBox&&Qs(n.textCollisionBox.collisionVertexArray,We.text.placed,!Ht||xt,Re,fe,Xt.x,Xt.y),Wt.verticalTextBox&&Qs(n.textCollisionBox.collisionVertexArray,We.text.placed,!Ht||gt,Re,fe,Xt.x,Xt.y)}const gr=Ht&&!!(!gt&&Wt.verticalIconBox);Wt.iconBox&&Qs(n.iconCollisionBox.collisionVertexArray,We.icon.placed,gr,Re,fe,ve.hasIconTextFit?Xt.x:0,ve.hasIconTextFit?Xt.y:0),Wt.verticalIconBox&&Qs(n.iconCollisionBox.collisionVertexArray,We.icon.placed,!gr,Re,fe,ve.hasIconTextFit?Xt.x:0,ve.hasIconTextFit?Xt.y:0)}}}if(n.fullyClipped=Se===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=be.invProjMatrix,n.placementViewportMatrix=be.viewportMatrix,n.collisionCircleArray=be.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function Qs(p,n,c,f,y,x,w){p.emplaceBack(n?1:0,c?1:0,x||0,w||0,f,y?1:0),p.emplaceBack(n?1:0,c?1:0,x||0,w||0,f,y?1:0),p.emplaceBack(n?1:0,c?1:0,x||0,w||0,f,y?1:0),p.emplaceBack(n?1:0,c?1:0,x||0,w||0,f,y?1:0)}const sh=Math.pow(2,25),so=Math.pow(2,24),bi=Math.pow(2,17),Lw=Math.pow(2,16),lh=Math.pow(2,9),Am=Math.pow(2,8),ch=Math.pow(2,1);function uh(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,c=Math.floor(127*p.opacity);return c*sh+n*so+c*bi+n*Lw+c*lh+n*Am+c*ch+n}const el=0;class zd{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,f,y,x,w){const A=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(A,y,n[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(((C,k)=>C.sortKey-k.sortKey)));this._currentPartIndex<A.length;){const C=A[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,f,C.symbolInstanceStart===0,w),this._currentPartIndex++,x())return!0}return!1}}class xo{constructor(n,c,f,y,x,w,A,C,k){this.placement=new jd(n,x,w,A,C,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,c,f,y,x){const w=i.o.now(),A=()=>{const C=i.o.now()-w;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=c[n[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const L=C,V=L.layout.get("symbol-z-elevate"),z=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=L.layout.get("symbol-z-order"),W=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&z),Z=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),oe=W&&Z,te=this._inProgressLayer=this._inProgressLayer||new zd(L),le=i.B(C.source,C.scope);if(te.continuePlacement(V||oe?y[le]:f[le],this.placement,this._showCollisionBoxes,C,A,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ta=512/i.al/2;class Ro{constructor(n,c,f){this.tileID=n,this.bucketInstanceId=f,this.index=new i.c3(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*i.al,x=n.canonical.y*i.al;for(let w=0;w<c.length;w++){const{key:A,crossTileID:C,tileAnchorX:k,tileAnchorY:L}=c.get(w),V=Math.floor((y+k)*Ta),z=Math.floor((x+L)*Ta);this.index.add(V,z),this.keys.push(A),this.crossTileIDs.push(C)}this.index.finish()}findMatches(n,c,f){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=Ta/Math.pow(2,c.canonical.z-this.tileID.canonical.z),w=c.canonical.x*i.al,A=c.canonical.y*i.al;for(let C=0;C<n.length;C++){const k=n.get(C);if(k.crossTileID)continue;const{key:L,tileAnchorX:V,tileAnchorY:z}=k,G=Math.floor((w+V)*x),W=Math.floor((A+z)*x),Z=this.index.range(G-y,W-y,G+y,W+y).sort(((oe,te)=>oe-te));for(const oe of Z){const te=this.crossTileIDs[oe];if(this.keys[oe]===L&&!f.has(te)){f.add(te),k.crossTileID=te;break}}}}}class Jy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const f in this.indexes){const y=this.indexes[f],x={};for(const w in y){const A=y[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+c),x[A.tileID.key]=A}this.indexes[f]=x}this.lng=n}addBucket(n,c,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>n.overscaledZ)for(const A in w){const C=w[A];C.tileID.isChildOf(n)&&C.findMatches(c.symbolInstances,n,y)}else{const A=w[n.scaledTo(Number(x)).key];A&&A.findMatches(c.symbolInstances,n,y)}}for(let x=0;x<c.symbolInstances.length;x++){const w=c.symbolInstances.get(x);w.crossTileID||(w.crossTileID=f.generate(),y.add(w.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ro(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const f of c.crossTileIDs)this.usedCrossTileIDs[n].delete(f)}removeStaleBuckets(n){let c=!1;for(const f in this.indexes){const y=this.indexes[f];for(const x in y)n[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[x]),delete y[x],c=!0)}return c}}class Li{constructor(){this.layerIndexes={},this.crossTileIDs=new Jy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,f,y){let x=this.layerIndexes[n.fqid];x===void 0&&(x=this.layerIndexes[n.fqid]=new Gc);let w=!1;const A={};y.name!=="globe"&&x.handleWrapJump(f);for(const C of c){const k=C.getBucket(n);k&&n.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(C.tileID,k,this.crossTileIDs)&&(w=!0),A[k.bucketInstanceId]=!0)}return x.removeStaleBuckets(A)&&(w=!0),w}pruneUnusedLayers(n){const c={};n.forEach((f=>{c[f]=!0}));for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const Do=771;class Ir{constructor(n,c,f,y){this.blendFunction=n,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=y}}Ir.Replace=[1,0,1,0],Ir.disabled=new Ir(Ir.Replace,i.ao.transparent,[!1,!1,!1,!1]),Ir.unblended=new Ir(Ir.Replace,i.ao.transparent,[!0,!0,!0,!0]),Ir.alphaBlended=new Ir([1,Do,1,Do],i.ao.transparent,[!0,!0,!0,!0]),Ir.alphaBlendedNonPremultiplied=new Ir([770,Do,770,Do],i.ao.transparent,[!0,!0,!0,!0]),Ir.multiply=new Ir([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]);class Bt{constructor(n,c,f){this.func=n,this.mask=c,this.range=f}}Bt.ReadOnly=!1,Bt.ReadWrite=!0,Bt.disabled=new Bt(519,Bt.ReadOnly,[0,1]);const hh=7680;class ur{constructor(n,c,f,y,x,w){this.test=n,this.ref=c,this.mask=f,this.fail=y,this.depthFail=x,this.pass=w}}ur.disabled=new ur({func:519,mask:0},0,0,hh,hh,hh);const $l=1029,Hc=2305;class mr{constructor(n,c,f){this.enable=n,this.mode=c,this.frontFace=f}}function Em(p,n){const c=i.c9(p,3);i.cb(p,n),i.cf(p,3,c)}function dh(p,n){const c=i.c6([]);return i.c7(c,c,-n),i.c8(c,c,-p),c}function fh(p,n){const c=[p[0],p[1],0],f=[n[0],n[1],0];if(i.ag(c)>=1e-15){const w=i.aw([],c);i.c4(f,w,i.bJ(f,w)),n[0]=f[0],n[1]=f[1]}const y=i.bI([],n,p);if(i.c5(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return dh(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}mr.disabled=new mr(!1,$l,Hc),mr.backCCW=new mr(!0,$l,Hc),mr.backCW=new mr(!0,$l,2304),mr.frontCW=new mr(!0,1028,2304),mr.frontCCW=new mr(!0,1028,Hc);class Pm{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof i.ae?n:new i.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=i.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const f=this.position,y=this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(n)):0,x=i.ae.fromLngLat(n,y),w=[x.x-f.x,x.y-f.y,x.z-f.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=fh(w,c)}setPitchBearing(n,c){this.orientation=dh(i.an(n),i.an(-c))}}class Fd{constructor(n,c){this._transform=i.bA([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new i.ae(n[0],n[1],n[2])}get position(){const n=i.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&i.cf(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||i.c6([]),n&&Em(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=dh(n,c),Em(this._transform,this._orientation)}forward(){const n=i.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=i.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=i.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const f=new Float64Array(16);return i.bl(f,this.getWorldToCamera(n,c)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,c,f){const y=this.position;i.c4(y,y,-n);const x=new Float64Array(16);return i.bq(x,[f,f,f]),i.br(x,x,y),x[10]*=c,x}getWorldToCamera(n,c){const f=new Float64Array(16),y=new Float64Array(4),x=this.position;return i.ca(y,this._orientation),i.c4(x,x,-n),i.cb(f,y),i.br(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(n,c,f,y){const x=new Float64Array(16);return i.cc(x,n,c,f,y),x}getCameraToClipOrthographic(n,c,f,y,x,w){const A=new Float64Array(16);return i.cd(A,n,c,f,y,x,w),A}getDistanceToElevation(n,c=!1){const f=n===0?0:i.ce(n,c?i.a$(this.position[1]):this.position[1]),y=this.forward();return(f-this.position[2])/y[2]}clone(){return new Fd([...this.position],[...this.orientation])}}const pi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Im{constructor(n=0,c=0,f=0,y=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=f,this.right=y}interpolate(n,c,f){return c.top!=null&&n.top!=null&&(this.top=i.ak(n.top,c.top,f)),c.bottom!=null&&n.bottom!=null&&(this.bottom=i.ak(n.bottom,c.bottom,f)),c.left!=null&&n.left!=null&&(this.left=i.ak(n.left,c.left,f)),c.right!=null&&n.right!=null&&(this.right=i.ak(n.right,c.right,f)),this}getCenter(n,c){const f=i.aA((this.left+n-this.right)/2,0,n),y=i.aA((this.top+c-this.bottom)/2,0,c);return new i.P(f,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Im(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ws=15;class bo{constructor(n,c,f,y,x,w,A){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=y??60,this.setProjection(w),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new i.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Im,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Fd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new bo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ws}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,c=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(n||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const f=this.getProjection(),y=!i.by(c,f);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=i.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=i.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,x=0;for(let w=0;w<c.length;w++){const A=new i.P(c[w][0]*this.width,f+c[w][1]*(this.height-f)),C=n.pointCoordinate(A);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);y+=C[3]*k,x+=k}return x===0?NaN:y/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(y-f,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const y=i.ag(i.av([],this._camera.position,f));return i.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!i.co(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];i.cp(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new Pm;return c.position=new i.ae(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!i.cq(n))return!1;i.cr(n,n);const c=i.cs([],[0,0,-1],n),f=i.cs([],[0,-1,0],n);if(f[2]<0)return!1;const y=fh(c,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=i.aA(n[2],y/f,y/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,f){this._unmodified=!1,this._edgeInsets.interpolate(n,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new i.ct(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new i.P(0,0)),y=this.pointCoordinate(new i.P(this.width,0)),x=this.pointCoordinate(new i.P(this.width,this.height)),w=this.pointCoordinate(new i.P(0,this.height)),A=Math.floor(Math.min(f.x,y.x,x.x,w.x)),C=Math.floor(Math.max(f.x,y.x,x.x,w.x)),k=1;for(let L=A-k;L<=C+k;L++)L!==0&&c.push(new i.ct(L,n))}return c}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,c,f){let y=[];const x=f!=null,w=!x;if(w&&this.zoom<c||x&&f[0]===0&&f[1]===0)return y;const A=new Set,C=(L,V,z,G,W)=>{const Z=i.cX(V,L,z,G,W);A.has(Z)||(y.push(new i.aO(L,V,z,G,W)),A.add(Z))};for(let L=0;L<n.length;L++){const V=n[L];if(w&&V.canonical.z!==c)continue;const z=V.canonical,G=V.overscaledZ,W=V.wrap,Z=1<<z.z,oe=z.x+1<Z,te=z.x>0,le=z.y+1<Z,fe=z.y>0,me=V.wrap-(te?0:1),we=V.wrap+(oe?0:1),xe=te?z.x-1:Z-1,Se=oe?z.x+1:0;if(x)f[0]<0?(C(G,we,z.z,Se,z.y),f[1]<0&&le&&(C(G,W,z.z,z.x,z.y+1),C(G,we,z.z,Se,z.y+1)),f[1]>0&&fe&&(C(G,W,z.z,z.x,z.y-1),C(G,we,z.z,Se,z.y-1))):f[0]>0?(C(G,me,z.z,xe,z.y),f[1]<0&&le&&(C(G,W,z.z,z.x,z.y+1),C(G,me,z.z,xe,z.y+1)),f[1]>0&&fe&&(C(G,W,z.z,z.x,z.y-1),C(G,me,z.z,xe,z.y-1))):f[1]<0&&le?C(G,W,z.z,z.x,z.y+1):fe&&C(G,W,z.z,z.x,z.y-1);else{const be=V.visibleQuadrants;1&be&&(C(G,me,z.z,xe,z.y),fe&&(C(G,W,z.z,z.x,z.y-1),C(G,me,z.z,xe,z.y-1))),2&be&&(C(G,we,z.z,Se,z.y),fe&&(C(G,W,z.z,z.x,z.y-1),C(G,we,z.z,Se,z.y-1))),4&be&&(C(G,me,z.z,xe,z.y),le&&(C(G,W,z.z,z.x,z.y+1),C(G,me,z.z,xe,z.y+1))),8&be&&(C(G,we,z.z,Se,z.y),le&&(C(G,W,z.z,z.x,z.y+1),C(G,we,z.z,Se,z.y+1)))}}const k=[];for(const L of y)y.some((V=>L.isChildOf(V)))||k.push(L);if(y=k.filter((L=>!n.some((V=>!!(L.overscaledZ<c&&V.isChildOf(L))||L.equals(V)||L.isChildOf(V))))),w){const L=1<<c,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[L*V.x,L*V.y],G=4,W=G*G;y=y.filter((Z=>{const oe=Z.canonical.x+.5-z[0],te=Z.canonical.y+.5-z[1];return oe*oe+te*te<W}))}return y}extendTileCoverToNearPlane(n,c,f){const y=[],x=new Set;for(const le of n)x.add(le.key);const w=(le,fe,me,we,xe)=>{const Se=i.cX(fe,le,me,we,xe);x.has(Se)||(y.push(new i.aO(le,fe,me,we,xe)),x.add(Se))},A=n.reduce(((le,fe)=>Math.max(le,fe.overscaledZ)),f),C=1<<f,k=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],L=new i.P(0,0),V=new i.P(0,0),z=(le,fe)=>{const me=Math.floor(le[0]),we=Math.floor(le[1]),xe=(le[0]-me)*i.al,Se=(le[1]-we)*i.al,be=Math.floor(fe[0]),ve=Math.floor(fe[1]),Te=(fe[0]-be)*i.al,qe=(fe[1]-ve)*i.al;for(let je=-1;je<=1;je++){const tt=me+je;if(!(tt<0||tt>=C)){L.x=xe-je*i.al,V.x=Te-(tt-be)*i.al;for(let Ve=-1;Ve<=1;Ve++){const et=we+Ve;L.y=Se-Ve*i.al,V.y=qe-(et-ve)*i.al,i.cY(L,V,k)&&w(A,0,f,tt,et)}}}},G=c.points,W=G[i.cu],Z=G[i.cv],oe=this._projectToGround(W,G[i.cw]),te=this._projectToGround(Z,G[i.cx]);return z(W,oe),z(Z,te),y}_projectToGround(n,c){return i.cy(i.cz(),n,c,n[2]/(n[2]-c[2]))}coveringTiles(n){let c=this.coveringZoomLevel(n);const f=c,y=this.elevation&&this.elevation.exaggeration(),x=y&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const A=this.locationCoordinate(this.center),C=this.center.lat,k=1<<c,L=[k*A.x,k*A.y,0],V=this.projection.name==="globe",z=!V,G=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,z),W=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=k*i.ce(1,this.center.lat),oe=this._camera.position[2]/i.ce(1,this.center.lat),te=[k*W.x,k*W.y,oe*(z?1:Z)],le=V||y,fe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),me=this.isLODDisabled(!0)?c:0;let we;if(this._elevation&&n.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();we=Re?Re.max:this._centerAltitude}else we=this._centerAltitude;const xe=n.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?i.cB(this):1,be=Re=>{const We=new i.ae(Re.x+25e-6,Re.y,Re.z),dt=new i.ae(Re.x,Re.y+25e-6,Re.z),At=Re.toLngLat(),Lt=We.toLngLat(),xt=dt.toLngLat(),gt=this.locationCoordinate(At),Kt=this.locationCoordinate(Lt),Wt=this.locationCoordinate(xt),Xt=Math.hypot(Kt.x-gt.x,Kt.y-gt.y),Ht=Math.hypot(Wt.x-gt.x,Wt.y-gt.y);return Math.sqrt(Xt*Ht)*Se/25e-6},ve=Re=>{const at=we,We=xe;return{aabb:i.cE(this,k,0,0,0,Re,We,at,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:at,wrap:Re,fullyVisible:!1}},Te=[];let qe=[];const je=c,tt=n.reparseOverscaled?f:c,Ve=(oe-this._centerAltitude)*Z,et=Re=>{if(!this._elevation||!Re.tileID||!w)return;const at=this._elevation.getMinMaxForTile(Re.tileID),We=Re.aabb;at?(We.min[2]=at.min,We.max[2]=at.max,We.center[2]=(We.min[2]+We.max[2])/2):(Re.shouldSplit=$e(Re),Re.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},Et=(Re,at)=>{if(.707*at<Re)return 1;const We=at/Re;return We/(1.4144271570014144+(Math.pow(1.1,We-1.4144271570014144+1)-1)/(1.1-1)-1)},$e=Re=>{if(Re.zoom<me)return!0;if(Re.zoom===je)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const at=Re.aabb.distanceX(te),We=Re.aabb.distanceY(te);let dt=Ve,At=1;if(V){dt=Re.aabb.distanceZ(te);const Ht=Math.pow(2,Re.zoom),gr=i.a$((Re.y+1)/Ht),Ar=i.a$(Re.y/Ht),Cr=Math.min(Math.max(C,gr),Ar),hn=i.d0(Cr)/i.d0(C);if(At=Cr===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,hn/this._mercatorScaleRatio),this.zoom<=i.cZ&&Re.zoom===je-1&&hn>=.9)return!0}else if(x&&(dt=Re.aabb.distanceZ(te)*Z),this.projection.isReprojectedInTileSpace&&f<=5){const Ht=Math.pow(2,Re.zoom),gr=be(new i.ae((Re.x+.5)/Ht,(Re.y+.5)/Ht));At=gr>.85?1:gr}if(!w){const Ht=Math.sqrt(at*at+We*We+dt*dt);let gr=(1<<je-Re.zoom)*fe*At;return gr*=Et(Math.max(dt,Ve),Ht),Ht<gr}let Lt=Number.MAX_VALUE,xt=0;const gt=Re.aabb.getCorners(),Kt=[];for(const Ht of gt){i.av(Kt,Ht,te),V||(x?Kt[2]*=Z:Kt[2]=Ve);const gr=i.bJ(Kt,this._camera.forward());gr<Lt&&(Lt=gr,xt=Math.abs(Kt[2]))}let Wt=(1<<je-Re.zoom)*fe*At;if(Wt*=Et(Math.max(xt,Ve),Lt),Lt<Wt)return!0;const Xt=Re.aabb.closestPoint(L);return Xt[0]===L[0]&&Xt[1]===L[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Te.push(ve(-Re)),Te.push(ve(Re));for(Te.push(ve(0));Te.length>0;){const Re=Te.pop(),at=Re.x,We=Re.y;let dt=Re.fullyVisible;const At=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!dt){let Lt=le?Re.aabb.intersects(G):Re.aabb.intersectsFlat(G);if(Lt===0&&At()){const xt=new i.cC(Re.zoom,at,We);Lt=i.cD(this,k,xt,!0).intersects(G)}if(Lt===0)continue;dt=Lt===2}if(Re.zoom!==je&&$e(Re))for(let Lt=0;Lt<4;Lt++){const xt=(at<<1)+Lt%2,gt=(We<<1)+(Lt>>1),Kt={aabb:w?Re.aabb.quadrant(Lt):i.cE(this,k,Re.zoom+1,xt,gt,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:xt,y:gt,wrap:Re.wrap,fullyVisible:dt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};x&&!V&&(Kt.tileID=new i.aO(Re.zoom+1===je?tt:Re.zoom+1,Re.wrap,Re.zoom+1,xt,gt),et(Kt)),Te.push(Kt)}else{const Lt=Re.zoom===je?tt:Re.zoom;if(n.minzoom&&n.minzoom>Lt)continue;let xt=0;if(!dt){let Xt=le?Re.aabb.intersectsPrecise(G):Re.aabb.intersectsPreciseFlat(G);if(Xt===0&&At()){const Ht=new i.cC(Re.zoom,at,We);Xt=i.cD(this,k,Ht,!0).intersectsPrecise(G)}if(Xt===0)continue;if(n.calculateQuadrantVisibility)if(G.containsPoint(Re.aabb.center))xt=15;else for(let Ht=0;Ht<4;Ht++)Re.aabb.quadrant(Ht).intersects(G)!==0&&(xt|=1<<Ht)}const gt=L[0]-(.5+at+(Re.wrap<<Re.zoom))*(1<<c-Re.zoom),Kt=L[1]-.5-We,Wt=Re.tileID?Re.tileID:new i.aO(Lt,Re.wrap,Re.zoom,at,We);n.calculateQuadrantVisibility&&(Wt.visibleQuadrants=xt),qe.push({tileID:Wt,distanceSq:gt*gt+Kt*Kt})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,at=this.horizonLineFromTop();qe=qe.filter((We=>{const dt=[0,0,0,1],At=[i.al,i.al,0,1],Lt=this.calculateFogTileMatrix(We.tileID.toUnwrapped());i.aC(dt,dt,Lt),i.aC(At,At,Lt);const xt=i.cF([],dt,At),gt=i.cG([],dt,At),Kt=i.c_(xt,gt);if(Kt===0)return!0;let Wt=!1;const Xt=this._elevation;if(Xt&&Kt>Re&&at!==0){const Ht=this.calculateProjMatrix(We.tileID.toUnwrapped());let gr;n.isTerrainDEM||(gr=Xt.getMinMaxForTile(We.tileID)),gr||(gr={min:xe,max:we});const Ar=i.cH(this.rotation),Cr=[Ar[0]*i.al,Ar[1]*i.al,gr.max];i.af(Cr,Cr,Ht),Wt=(1-Cr[1])*this.height*.5<at}return Kt<Re||Wt}))}return qe.sort(((Re,at)=>Re.distanceSq-at.distanceSq)).map((Re=>Re.tileID))}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const c=i.aA(n.lat,-i.cI,i.cI),f=this.projection.project(n.lng,c);return new i.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let f,y;const x=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;f=(c.x-x.x)/A,y=(c.y-x.y)/A}else{const A=this.pointCoordinate(c),C=this.pointCoordinate(x);f=A.x-C.x,y=A.y-C.y}const w=this.locationCoordinate(n);this.setLocation(new i.ae(w.x-f,w.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,c){return this.projection.locationPoint(this,n,c)}locationPoint3D(n,c){return this.projection.locationPoint(this,n,c,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,c){return this.coordinateLocation(this.pointCoordinate3D(n,c))}locationCoordinate(n,c){const f=c?i.ce(c,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new i.ae(y.x,y.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const f=c??this._centerAltitude,y=[n.x,n.y,0,1],x=[n.x,n.y,1,1];i.aC(y,y,this.pixelMatrixInverse),i.aC(x,x,this.pixelMatrixInverse);const w=x[3];i.cJ(y,y,1/y[3]),i.cJ(x,x,1/w);const A=y[2],C=x[2];return{p0:y,p1:x,t:A===C?0:(f-A)/(C-A)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return i.aC(c,c,this.pixelMatrixInverse),i.aC(f,f,this.pixelMatrixInverse),i.cJ(c,c,1/c[3]),i.cJ(f,f,1/f[3]),c[2]=i.ce(c[2],this._center.lat)*this.worldSize,f[2]=i.ce(f[2],this._center.lat)*this.worldSize,i.cJ(c,c,1/this.worldSize),i.cJ(f,f,1/this.worldSize),new i.ax([c[0],c[1],c[2]],i.aw([],i.av([],f,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:f,t:y}=n,x=i.ce(c[2],this._center.lat),w=i.ce(f[2],this._center.lat);return new i.ae(i.ak(c[0],f[0],y)/this.worldSize,i.ak(c[1],f[1],y)/this.worldSize,i.ak(x,w,y))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n,c){if(!this.elevation)return this.pointCoordinate(n,c);let f=this.projection.pointCoordinate3D(this,n.x,n.y);if(f)return new i.ae(f[0],f[1],f[2]);let y=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n,c);const w=.02*x,A=n.clone();for(let C=0;C<10&&x-y>w;C++){A.y=i.ak(y,x,.66);const k=this.projection.pointCoordinate3D(this,A.x,A.y);k?(x=A.y,f=k):y=A.y}return f?new i.ae(f[0],f[1],f[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const f=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return i.aC(y,y,this.pixelMatrix),y[3]>0?new i.P(y[0]/y[3],y[1]/y[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new i.P(c,n)),w=this.pointLocation3D(new i.P(y,n)),A=this.pointLocation3D(new i.P(y,f)),C=this.pointLocation3D(new i.P(c,f));let k=Math.min(x.lng,w.lng,A.lng,C.lng),L=Math.max(x.lng,w.lng,A.lng,C.lng),V=Math.min(x.lat,w.lat,A.lat,C.lat),z=Math.max(x.lat,w.lat,A.lat,C.lat);const G=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,Z=(oe,te,le,fe,me)=>{const we=(oe+le)/2,xe=(te+fe)/2,Se=new i.P(we,xe),{lng:be,lat:ve}=this.pointLocation3D(Se),Te=Math.max(0,k-be,V-ve,be-L,ve-z);k=Math.min(k,be),L=Math.max(L,be),V=Math.min(V,ve),z=Math.max(z,ve),(me<W||Te>G)&&(Z(oe,te,we,xe,me+1),Z(we,xe,le,fe,me+1))};if(Z(c,n,y,n,1),Z(y,n,y,f,1),Z(y,f,c,f,1),Z(c,f,c,n,1),this.projection.name==="globe"){const[oe,te]=i.cL(this);oe?(z=90,L=180,k=-180):te&&(V=-90,L=180,k=-180)}return new i.aI(new i.aR(k,V),new i.aR(L,z))}_getBoundsRectangular(n,c){const{top:f,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,A=new i.P(y,f),C=new i.P(w,f),k=new i.P(w,x),L=new i.P(y,x);let V=this.pointCoordinate(A,n),z=this.pointCoordinate(C,n);const G=this.pointCoordinate(k,c),W=this.pointCoordinate(L,c),Z=(oe,te)=>(te.y-oe.y)/(te.x-oe.x);return V.y>1&&z.y>=0?V=new i.ae((1-W.y)/Z(W,V)+W.x,1):V.y<0&&z.y<=1&&(V=new i.ae(-W.y/Z(W,V)+W.x,0)),z.y>1&&V.y>=0?z=new i.ae((1-G.y)/Z(G,z)+G.x,1):z.y<0&&V.y<=1&&(z=new i.ae(-G.y/Z(G,z)+G.x,0)),new i.aI().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce(((f,y)=>{if(y.dem){const x=y.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,f=this._distanceTileDataCache;if(f[c])return f[c];const y=n.canonical,x=1/this.height,w=this.cameraWorldSize,A=w/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*n.wrap)*A,k=y.y*A,L=this.point;L.x*=w/this.worldSize,L.y*=w/this.worldSize;const V=this.angle,z=Math.sin(-V),G=-Math.cos(-V);return f[c]={bearing:[z,G],center:[(L.x-C)*x,(L.y-k)*x],scale:A/i.al*x},f[c]}calculateFogTileMatrix(n){const c=n.key,f=this._fogTileMatrixCache;if(f[c])return f[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return i.aB(y,this.worldToFogMatrix,y),f[c]=new Float32Array(y),f[c]}calculateProjMatrix(n,c=!1,f=!1){const y=n.key;let x;if(x=f?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,x[y])return x[y];const w=this.calculatePosMatrix(n,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.aB(w,A,w),x[y]=new Float32Array(w),x[y]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];const y=i.cM(n,this);return f[c]=y,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=i.bq([],[n,n,n]);return i.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=i.ce(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),y=this._camera.forward(),x=i.ce(1,this._center.lat);f[2]/=x,y[2]/=x,i.aw(y,y);const w=n.raycast(f,y,n.exaggeration());if(w){const A=i.bH([],f,y,w),C=new i.ae(A[0],A[1],i.ce(A[2],i.a$(A[1]))),k=(C.z+i.ag([C.x-f[0],C.y-f[1],C.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,f=i.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),x=c.getAtPointOrZero(new i.ae(...y)),w=this.pixelsPerMeter/this.worldSize*x,A=this._minimumHeightOverTerrain(),C=y[2]-w;if(C<=A)if(C<0||n){const k=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],k.z-y[2]],V=i.ag(L);L[2]-=(A-C)/this._pixelsPerMercatorPixel;const z=i.ag(L);if(z===0)return;i.c4(L,L,V/z*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],k.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const z=this.center;return z.lat=i.aA(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(z.lng=i.aA(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const c=this._unmodified,{x:f,y}=this.point;let x=0,w=f,A=y;const C=this.width/2,k=this.height/2,L=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(y-k<L&&(A=L+k),y+k>V&&(A=V-k),V-L<this.height&&(x=Math.max(x,this.height/(V-L)),A=(V+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,W=this.worldSize/2-(z+G)/2;w=(f+W+this.worldSize)%this.worldSize-W,w-C<z&&(w=z+C),w+C>G&&(w=G-C),G-z<this.width&&(x=Math.max(x,this.width/(G-z)),w=(G+z)/2)}w===f&&A===y||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(w,A))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const y=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,w=this._camera.getWorldToCamera(this.worldSize,x);let A;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height,this.isOrthographic){let ve=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Te=ve*this.aspect,qe=-Te,je=-ve;Te-=n.x,qe-=n.x,ve+=n.y,je+=n.y,A=this._camera.getCameraToClipOrthographic(qe,Te,je,ve,this._nearZ,this._farZ),((tt,Ve,et,Et)=>{for(let $e=0;$e<16;$e++)tt[$e]=i.ak(Ve[$e],et[$e],Et)})(A,A,C,i.c$(this.pitch>=ws?1:this.pitch/ws))}else A=C;const k=i.cO([],C,w);let L=i.cO([],A,w);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),Te=i.bA([]);i.br(Te,Te,[ve.x*this.worldSize,ve.y*this.worldSize,0]),i.aB(Te,Te,i.cP(this)),i.br(Te,Te,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),i.aB(L,L,Te),i.aB(k,k,Te),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),c){const ve=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ve[8]=2*-n.x/this.width,ve[9]=2*n.y/this.height,this.expandedFarZProjMatrix=i.cO([],ve,w)}else this.expandedFarZProjMatrix=this.projMatrix;const V=i.bl([],A);this.frustumCorners=i.cS.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const z=new Float32Array(16);i.bA(z),i.cR(z,z,[1,-1,1]),i.cT(z,z,this._pitch),i.bB(z,z,this.angle);const G=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(G);const W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-n.x/this.width,G[9]=2*(n.y+W)/this.height,this.skyboxMatrix=i.aB(z,G,z);const Z=this.point,oe=Z.x,te=Z.y,le=this.width%2/2,fe=this.height%2/2,me=Math.cos(this.angle),we=Math.sin(this.angle),xe=oe-Math.round(oe)+me*le+we*fe,Se=te-Math.round(te)+me*fe+we*le,be=new Float64Array(L);if(i.br(be,be,[xe>.5?xe-1:xe,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=be,L=i.bC(),i.cR(L,L,[this.width/2,-this.height/2,1]),i.br(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.bC(),i.cR(L,L,[1,-1,1]),i.br(L,L,[-1,-1,0]),i.cR(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.bl(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(ve,ve,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[n,n,c];i.c4(x,x,y),i.c4(f,f,-1),i.cV(f,f,x);const w=i.bC();i.br(w,w,f),i.cR(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,y)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-f[0]*x,y.y/this.worldSize-f[1]*x,n/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],y=n[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((c-f)/y,1)),this._camera.position=i.bH([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),x=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),A=Math.max((n[2]-x)/Math.cos(f),w),C=this._zoomFromMercatorZ(A);i.bH(n,n,c,A),this._pitch=i.aA(f,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(y,-Math.PI,Math.PI),this._setZoom(i.aA(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,f=i.cK,y=0,x=1/0;for(;f-c>1e-6&&f>c;){const w=c+.5*(f-c),A=this.tileSize*Math.pow(2,w),C=this.getCameraToCenterDistance(this.projection,w,A),k=this.scaleZoom(C/(Math.max(0,n)*this.tileSize)),L=Math.abs(w-k);L<x&&(x=L,y=w),w<k?c=w:f=w}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const f=Math.min(n.x,c.x),y=Math.max(n.x,c.x),x=Math.min(n.y,c.y),w=Math.max(n.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new i.P(f,x),new i.P(y,w),new i.P(f,w),new i.P(y,x)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const L of A){const V=this.pointRayIntersection(L);if(V.t<0)return!0;const z=this.rayIntersectionCoordinate(V);if(z.x<C||z.y<0||z.x>k||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(n,c){const f=i.ag(i.av([],this._camera.position,n)),y=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([c,f,y],x){const w=[c,f,y,1];i.aC(w,w,x);const A=w[3]=Math.max(w[3],1e-6);return w[0]/=A,w[1]/=A,w[2]/=A,w})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,n))}}getCameraToCenterDistance(n,c=this.zoom,f=this.worldSize){const y=i.cN(n,c,this.width,this.height,1024),x=n.pixelSpaceConversion(this.center.lat,f,y);let w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=i.ak(1,w,i.c$(this.pitch>=ws?1:this.pitch/ws))),w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(n,n,this.globeMatrix),n}getFrustum(n){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const tl=(p,n)=>{if(n>0&&p.terrain&&i.w("Cutoff is currently disabled on terrain"),n<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,f=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),y=c.isLODDisabled(!1)?i.ah(60,45,c.pitch):i.ah(30,15,c.pitch),x=c._farZ-c._nearZ,w=n*c.height,A=((1-(C=y))*c.cameraToCenterDistance+C*(c._farZ+w))*f;var C;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(A-c._nearZ)/x,(A-w-c._nearZ)/x]}}},Ki={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Qy{constructor(n,c){this.aabb=n,this.lastCascade=c}}class ph{add(n,c){const f=this.receivers[n.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],c.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],c.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],c.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],c.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],c.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],c.max[2])):this.receivers[n.key]=new Qy(c,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,c,f){const y=i.d8.fromPoints(n.points);let x=0;for(const w in this.receivers){const A=this.receivers[w];if(!A||!y.intersectsAabb(A.aabb))continue;A.aabb.min=y.closestPoint(A.aabb.min),A.aabb.max=y.closestPoint(A.aabb.max);const C=A.aabb.getCorners();for(let k=0;k<f.length;k++){let L=!0;for(const V of C){const z=[V[0]*c,V[1]*c,V[2]];if(i.af(z,z,f[k].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){L=!1;break}}if(A.lastCascade=k,x=Math.max(x,k),L)break}}return x+1}}class jw{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ph,this._depthMode=new Bt(n.context.gl.LEQUAL,Bt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),n.tp.registerParameter(Ki,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Ki,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(Ki,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,c){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const y=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||y<=0||(this._shadowLayerCount=f.style.order.reduce(((W,Z)=>{const oe=f.style._mergedLayers[Z];return W+(oe.hasShadowPass()&&!oe.isHidden(n.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=f.context,w=Ki.shadowMapResolution,A=Ki.shadowMapResolution;if(this._cascades.length===0||Ki.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<Ki.cascadeCount;++W){const Z=f._shadowMapDebug,oe=x.gl,te=x.createFramebuffer(w,A,Z,"texture"),le=new i.T(x,{width:w,height:A,data:null},oe.DEPTH_COMPONENT16);if(te.depthAttachment.set(le.texture),Z){const fe=new i.T(x,{width:w,height:A,data:null},oe.RGBA8);te.colorAttachment.set(fe.texture)}this._cascades.push({framebuffer:te,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=Wc(c);let C=0;if(n.elevation){const W=n.elevation,Z=[1e4,-1e4];W.visibleDemTiles.filter((oe=>oe.dem)).forEach((oe=>{const te=oe.dem.tree;Z[0]=Math.min(Z[0],te.minimums[0]),Z[1]=Math.max(Z[1],te.maximums[0])})),Z[0]!==1e4&&(C=(Z[1]-Z[0])*W.exaggeration())}const k=1.5*n.cameraToCenterDistance,L=3*k,V=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){const Z=this._cascades[W];let oe=n.height/50,te=1;Ki.cascadeCount===1?te=L:W===0?te=k:(oe=k,te=L);const[le,fe]=zw(n,this.shadowDirection,oe,te,Ki.shadowMapResolution,C);Z.scale=n.scale,Z.matrix=le,Z.boundingSphereRadius=fe,i.bl(V,Z.matrix),Z.frustum=i.cA.fromInvProjectionMatrix(V,1,0,!0),Z.far=te}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ki.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ki.shadowMapResolution,this._uniformValues.u_shadowmap_0=pi.ShadowMap0,this._uniformValues.u_shadowmap_1=pi.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=f.transform.elevation;for(const W of this._groundShadowTiles){let Z={min:0,max:0};if(G){const oe=G.getMinMaxForTile(W);oe&&(Z=oe)}this.addShadowReceiver(W.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,c){if(!this.enabled)return;const f=this.painter,y=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),y.viewport.set([0,0,Ki.shadowMapResolution,Ki.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){f.currentShadowCascade=x,y.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),y.clear({color:i.ao.white,depth:1});for(const w of n.order){const A=n._mergedLayers[w];if(!A.hasShadowPass()||A.isHidden(f.transform.zoom))continue;const C=n.getLayerSourceCache(A),k=C?c[C.id]:void 0;(A.type==="model"||k&&k.length)&&f.renderLayer(f,C,A,k)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,c=n.style,f=n.context,y=f.gl,x=c.directionalLight,w=c.ambientLight;if(!x||!w)return;const A=[],C=tl(n,n.longestCutoffRange);C.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),A.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&A.push("NORMAL_OFFSET");const k=Aa(c,x,w),L=new Bt(y.LEQUAL,Bt.ReadOnly,n.depthRangeFor3D),V=new ur({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const z of this._groundShadowTiles){const G=z.toUnwrapped(),W=n.isTileAffectedByFog(z),Z=n.getOrCreateProgram("groundShadow",{defines:A,overrideFog:W});this.setupShadows(G,Z),n.uploadCommonUniforms(f,Z,G,null,C);const oe={u_matrix:n.transform.calculateProjMatrix(G),u_ground_shadow_factor:k};Z.draw(n,y.TRIANGLES,L,V,Ir.multiply,mr.disabled,oe,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ir.unblended:Ir.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const c=this.painter.transform,f=c.calculatePosMatrix(n,c.worldSize);return i.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(n){return i.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,c,f){if(!this.enabled)return;const y=this.painter.transform,x=this.painter.context,w=x.gl,A=this._uniformValues,C=new Float64Array(16),k=y.calculatePosMatrix(n,y.worldSize);for(let L=0;L<this._cascades.length;L++)i.aB(C,this._cascades[L].matrix,k),A[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(w.TEXTURE0+pi.ShadowMap0+L),this._cascades[L].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){const L=i.d6(n.canonical),V=2/y.tileSize*i.al/Ki.shadowMapResolution,z=V*this._cascades[0].boundingSphereRadius,G=V*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(f==="vector-tile"?1:3)*(function(Z,oe,te,le,fe){const me=i.aA((Z-22)/-22,0,1);return .125*(1-me)+4*me})(y.zoom);A.u_shadow_normal_offset=[L,z*W,G*W],A.u_shadow_bias=[1e-4,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,A)}setupShadowsFromMatrix(n,c,f=!1){if(!this.enabled)return;const y=this.painter.context,x=y.gl,w=this._uniformValues,A=new Float64Array(16);for(let C=0;C<Ki.cascadeCount;C++)i.aB(A,this._cascades[C].matrix,n),w[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),y.activeTexture.set(x.TEXTURE0+pi.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=f,f){const C=Ki.normalOffset;w.u_shadow_normal_offset=[1,C,C],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,c,f,y){if(y[2]>=0)return{};const x=(function(C,k,L){const V=L/(1<<C.canonical.z);return new i.d8([C.canonical.x*V+C.wrap*L,C.canonical.y*V+C.wrap*L,0],[(C.canonical.x+1)*V+C.wrap*L,(C.canonical.y+1)*V+C.wrap*L,k])})(n,c,f).getCorners(),w=c/-y[2];y[0]<0?(i.d7(x[0],x[0],[y[0]*w,0,0]),i.d7(x[3],x[3],[y[0]*w,0,0])):y[0]>0&&(i.d7(x[1],x[1],[y[0]*w,0,0]),i.d7(x[2],x[2],[y[0]*w,0,0])),y[1]<0?(i.d7(x[0],x[0],[0,y[1]*w,0]),i.d7(x[1],x[1],[0,y[1]*w,0])):y[1]>0&&(i.d7(x[2],x[2],[0,y[1]*w,0]),i.d7(x[3],x[3],[0,y[1]*w,0]));const A={};return A.vertices=x,A.planes=[Bd(x[1],x[0],x[4]),Bd(x[2],x[1],x[5]),Bd(x[3],x[2],x[6]),Bd(x[0],x[3],x[7])],A}addShadowReceiver(n,c,f){this._receivers.add(n,i.d8.fromTileIdAndHeight(n,c,f))}getMaxCascadeForTile(n){const c=this._receivers.get(n);return c&&c.lastCascade?c.lastCascade:0}}function Bd(p,n,c){const f=i.av([],c,n),y=i.av([],p,n),x=i.bI([],f,y),w=i.ag(x);return w===0?[0,0,1,0]:(i.c4(x,x,1/w),[x[0],x[1],x[2],-i.bJ(x,n)])}function Wc(p){const n=p.properties.get("direction"),c=i.d3(n.x,n.y,n.z);c[2]=i.aA(c[2],0,75);const f=i.d5([c[0],c[1],c[2]]);return i.d4(f.x,f.y,f.z)}function Aa(p,n,c){const f=n.properties.get("color-use-theme")==="none",y=n.properties.get("color"),x=n.properties.get("intensity"),w=n.properties.get("direction"),A=[w.x,w.y,w.z],C=c.properties.get("color-use-theme")==="none",k=c.properties.get("color"),L=c.properties.get("intensity"),V=Math.max(i.bJ([0,0,1],A),0),z=[0,0,0];i.c4(z,k.toPremultipliedRenderColor(C?null:p.getLut(n.scope)).toArray01Linear().slice(0,3),L);const G=[0,0,0];return i.c4(G,y.toPremultipliedRenderColor(f?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),V*x),i.da([z[0]>0?z[0]/(z[0]+G[0]):0,z[1]>0?z[1]/(z[1]+G[1]):0,z[2]>0?z[2]/(z[2]+G[2]):0])}function zw(p,n,c,f,y,x){const w=p.zoom,A=p.scale,C=p.worldSize,k=1/C,L=p.aspect,V=Math.sqrt(1+L*L)*Math.tan(.5*p.fovX),z=V*V,G=f-c,W=f+c;let Z,oe;z>G/W?(Z=f,oe=f*V):(Z=.5*W*(1+z),oe=.5*Math.sqrt(G*G+2*(f*f+c*c)*z+W*W*z*z));const te=p.projection.pixelsPerMeter(p.center.lat,C),le=p._camera.getCameraToWorldMercator(),fe=[0,0,-Z*k];i.af(fe,fe,le);let me=oe*k;const we=p._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const dt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?te:1),At=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,f);At[8]=2*-p.centerOffset.x/p.width,At[9]=2*p.centerOffset.y/p.height;const Lt=new Float64Array(16);i.cO(Lt,At,dt);const xt=new Float64Array(16);i.bl(xt,Lt);const gt=i.cA.fromInvProjectionMatrix(xt,C,w,!0);for(const Kt of gt.points){const Wt=((xe=Kt)[0]/=A,xe[1]/=A,xe[2]=i.ce(xe[2],p._center.lat),xe);me=Math.max(me,i.c5(i.d9([],fe,Wt)))}}var xe;me*=y/(y-1);const Se=Math.acos(n[2]),be=Math.atan2(-n[0],-n[1]),ve=new Fd;ve.position=fe,ve.setPitchBearing(Se,be);const Te=ve.getWorldToCamera(C,te),qe=me*C,je=Math.min(p._mercatorZfromZoom(17)*C*-2,-2*qe),tt=ve.getCameraToClipOrthographic(-qe,qe,-qe,qe,je,(qe+x*te)/n[2]),Ve=new Float64Array(16);i.aB(Ve,tt,Te);const et=i.d4(Math.floor(1e6*fe[0])/1e6*C,Math.floor(1e6*fe[1])/1e6*C,0),Et=.5*y,$e=[0,0,0];i.af($e,et,Ve),i.c4($e,$e,Et);const Re=[Math.floor($e[0]),Math.floor($e[1]),Math.floor($e[2])],at=[0,0,0];i.av(at,$e,Re),i.c4(at,at,-1/Et);const We=new Float64Array(16);return i.bA(We),i.br(We,We,at),i.aB(Ve,We,Ve),[Ve,qe]}class Zc extends i.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,c){return i.aV(this.requestManager.transformRequest(c,i.R.Model).url).then((f=>{if(!f)return;const y=i.aW(f),x=new i.aX(n,void 0,void 0,y);return x.computeBoundsAndApplyParent(),x})).catch((f=>{if(f&&f.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${n} from ${c}: ${f.message}`)))}))}load(n,c,f={forceReload:!1}){this.models[c]||(this.models[c]={});const y=Object.keys(n),x=[],w=[];for(const A of y){const C=n[A];this.hasURLBeenRequested(C)&&!f.forceReload||(this.modelByURL[C]={modelId:A,scope:c},x.push(this.loadModel(A,C)),w.push(A)),this.models[c][A]||(this.models[c][A]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+w.length,Promise.allSettled(x).then((A=>{for(let C=0;C<A.length;C++){const{status:k}=A[C];if(k==="rejected")continue;const{value:L}=A[C];this.models[c][w[C]]||(this.models[c][w[C]]={model:null,numReferences:1}),this.models[c][w[C]].model=L}this.numModelsLoading[c]-=w.length,this.fire(new i.z("data",{dataType:"style"}))})).catch((A=>{this.fire(new i.y(new Error(`Could not load models: ${A.message}`)))}))}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,c,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(n,c):this.getModelByURL(this.modelUris[c][n]))}getModel(n,c){return this.models[c]||(this.models[c]={}),this.models[c][n]?this.models[c][n].model:void 0}getModelByURL(n){if(!n)return null;const c=this.modelByURL[n];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(n,c){return this.models[c]&&this.models[c][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,c,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const y=this.requestManager.normalizeModelURL(c);if((this.hasModel(n,f,{exactIdMatch:!0})||this.hasModelBeenAdded(n,f))&&this.modelUris[f][n]===y)this.models[f][n].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:x,modelId:w}=this.modelByURL[y];this.models[x][w].numReferences++}else this.modelUris[f][n]=y,this.load({[n]:this.modelUris[f][n]},f)}addModelURLs(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const f=this.modelUris[c];for(const y in n)f[y]=this.requestManager.normalizeModelURL(n[y])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const f={};for(const y of n)this.hasModel(y,c,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[c][y].numReferences++:this.modelUris[c][y]&&!this.hasURLBeenRequested(y)?f[y]=this.modelUris[c][y]:!this.hasURLBeenRequested(y)&&i.db(y,!1)&&(this.modelUris[c][y]=this.requestManager.normalizeModelURL(y),f[y]=this.modelUris[c][y]);this.load(f,c)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,c,f=!1,y=!1){if(this.models[c]&&this.models[c][n]&&(this.models[c][n].numReferences--,this.models[c][n].numReferences===0||y)){const x=this.modelUris[c][n];f||delete this.modelUris[c][n],delete this.modelByURL[x];const w=this.models[c][n].model;if(!w)return;delete this.models[c][n],w.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const c of Object.keys(this.models[n])){const f=this.models[n][c].model;delete this.models[n][c],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,c){this.models[c]||(this.models[c]={});for(const f in this.models[c])this.models[c][f].model&&this.models[c][f].model.upload(n.context)}}const ev=new i.a9({data:new i.aa(i.a6.colorTheme.data)});function Ud(p){if(!p.metadata||!p.metadata.content_area)return;const n=i.o.devicePixelRatio,{left:c,top:f,width:y,height:x}=p.metadata.content_area,w=c*n,A=f*n;return[w,A,w+y*n,A+x*n]}function Vd(p){if(p)return p.map((([n,c])=>[n*i.o.devicePixelRatio,c*i.o.devicePixelRatio]))}class rl{constructor(n,c,f){this.id=n,this.scope=c,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return n;const f=this.sourceCache.getSource();if(!(f instanceof Xs))return n;const y=c.map((w=>this.sourceCache.getTile(w))),x=f.getImages(y,Array.from(this.pendingRequests));for(const[w,A]of x)n.set(i.I.from({name:w,iconsetId:this.id}),A),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),n}}const ql=(p,n)=>Ie(p,n&&n.filter((c=>c.identifier!=="source.canvas"))),Fw=i.aH(Xr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Bw=i.aH(Xr,["setCenter","setZoom","setBearing","setPitch"]),$d=new Set(["background","sky","slot","custom"]),tv={version:8,layers:[],sources:{}},qd={duration:300,delay:0};class da extends i.E{constructor(n,c={}){super(),this.map=n,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},qd),this._buildingIndex=new Id(this),this.crossTileSymbolIndex=new Li,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new bn,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.dd(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Zr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.de(n._requestManager,c.localFontFamily?i.df.all:c.localIdeographFontFamily?i.df.ideographs:i.df.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Zc(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.dg());const f=this;this._rtlTextPluginCallback=da.registerForPluginStateChange((y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((x,w)=>{if(i.dh(x),w&&w.every((A=>A)))for(const A in f._sourceCaches){const C=f._sourceCaches[A],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getOwnSource(y.sourceId);if(x&&x.vectorLayerIds)for(const w in this._layers){const A=this._layers[w];A.source===x.id&&this._validateLayer(A)}}))}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(i.h(n))return n;const c=i.di(n);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.dj(JSON.stringify(n))}`}_diffStyle(n,c,f){this.globalId=this._getGlobalId(n);const y=(x,w)=>{try{w(null,this.setState(x,f))}catch(A){w(A,!1)}};if(typeof n=="string"){const x=this.map._requestManager.normalizeStyleURL(n),w=this.map._requestManager.transformRequest(x,i.R.Style);i.m(w,((A,C)=>{A?this.fire(new i.y(A)):C&&y(C,c)}))}else typeof n=="object"&&y(n,c)}loadURL(n,c={}){this.fire(new i.z("dataloading",{dataType:"style"}));const f=typeof c.validate=="boolean"?c.validate:!i.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,c.accessToken),this.resolvedImports.add(n);const y=this.importsCache.get(n);if(y)return this._load(y,f);const x=this.map._requestManager.transformRequest(n,i.R.Style);this._request=i.m(x,((w,A)=>{if(this._request=null,w)this.fire(new i.y(w));else if(A)return this.importsCache.set(n,A),this._load(A,f)}))}loadJSON(n,c={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=i.o.frame((()=>{this._request=null,this._load(n,c.validate!==!1)}))}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(tv,!1)}_loadImports(n,c,f){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const x of n){const w=this._createFragmentStyle(x),A=new Promise((L=>{w.once("style.import.load",L),w.once("error",L)})).then((()=>this.mergeAll()));if(y.push(A),this.resolvedImports.has(x.url)){w.loadEmpty();continue}const C=x.data||this.importsCache.get(x.url);C?(w.loadJSON(C,{validate:c}),this._isInternalStyle(C)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:c}):w.loadEmpty();const k={style:w,id:x.id,config:x.config};if(f){const L=this.fragments.findIndex((({id:V})=>V===f));this.fragments=this.fragments.slice(0,L).concat(k).concat(this.fragments.slice(L))}else this.fragments.push(k)}return Promise.allSettled(y)}getImportGlobalIds(n=this,c=new Set){for(const f of n.fragments)f.style.globalId&&c.add(f.style.globalId),this.getImportGlobalIds(f.style,c);return[...c.values()]}_createFragmentStyle(n){const c=this.scope?i.B(n.id,this.scope):n.id;let f;const y=this._initialConfig&&this._initialConfig[c];(n.config||y)&&(f=Object.assign({},n.config,y));const x=new da(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,c){if(this._isInternalStyle(n)){const x=Object.assign({},tv,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(x,c)}if(this.updateConfig(this._config,n.schema),c&&ql(this,va(n)))return;this._loaded=!0,this.stylesheet=i.dk(n);const f=()=>{for(const C in n.sources)this.addSource(C,n.sources[C],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const C in n.iconsets)this.addIconset(C,n.iconsets[C]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const x=Cd(this.stylesheet.layers);if(this._order=x.map((C=>C.id)),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new ze(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ze(this.stylesheet.light)),this._layers={};for(const C of x){const k=i.dq(C,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const L=this.getOwnLayerSourceCache(k),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&k.canCastShadows()&&V&&(L.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const A=this.isRootStyle();n.imports?this._loadImports(n.imports,c).then((()=>{this._reloadImports(),this.fire(new i.z(A?"style.load":"style.import.load"))})).catch((C=>{this.fire(new i.y(new Error("Failed to load imports",C))),this.fire(new i.z(A?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new i.z(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const x=this._evaluateColorThemeData(y);this._loadColorTheme(x).then((()=>{f()})).catch((w=>{i.w(`Couldn't load color theme from the stylesheet: ${w}`),f()}))}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,c,f,y,x,w,A,C,k,L;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((z=>{if(z.stylesheet){if(z.light!=null&&(n=z.light),z.stylesheet.lights)for(const G of z.stylesheet.lights)G.type==="ambient"&&z.ambientLight!=null&&(c=z.ambientLight),G.type==="directional"&&z.directionalLight!=null&&(f=z.directionalLight);y=this._prioritizeTerrain(y,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(x=z.fog),z.stylesheet.snow&&z.snow!=null&&(w=z.snow),z.stylesheet.rain&&z.rain!=null&&(A=z.rain),z.stylesheet.camera!=null&&(L=z.stylesheet.camera),z.stylesheet.projection!=null&&(C=z.stylesheet.projection),z.stylesheet.transition!=null&&(k=z.stylesheet.transition),V[z.scope]=z._styleColorTheme}})),this.light=n,this.ambientLight=c,this.directionalLight=f,this.fog=x,this.snow=w,this.rain=A,this._styleColorThemeForScope=V,y===null?delete this.terrain:this.terrain=y,this.camera=L||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=Object.assign({},qd,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const c=f=>{for(const y of f.fragments)c(y.style);n(f)};c(this)}_prioritizeTerrain(n,c,f){const y=n&&n.drapeRenderMode===0;return f===null?c&&c.drapeRenderMode===0?c:y?n:null:c!=null&&(!n||y||c&&c.drapeRenderMode===1)?c:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((c=>{n=this._prioritizeTerrain(n,c.terrain,c.stylesheet.terrain)})),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle((c=>{c.stylesheet.projection!=null&&(n=c.stylesheet.projection)})),this.projection=n||{name:"mercator"}}mergeSources(){const n={},c={},f={};this.forEachFragmentStyle((y=>{for(const x in y._sourceCaches){const w=i.B(x,y.scope);n[w]=y._sourceCaches[x]}for(const x in y._otherSourceCaches){const w=i.B(x,y.scope);c[w]=y._otherSourceCaches[x]}for(const x in y._symbolSourceCaches){const w=i.B(x,y.scope);f[w]=y._symbolSourceCaches[x]}})),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=f}mergeLayers(){const n={},c=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((w=>{for(const A of w._order){const C=w._layers[A];if(C.type==="slot"){const k=i.dl(A);if(n[k])continue;n[k]=[]}C.slot&&n[C.slot]?n[C.slot].push(C):c.push(C)}})),this._mergedOrder=[];let y=-1;const x=(w=[])=>{for(const A of w)if(A.type==="slot"){const C=i.dl(A.id);n[C]&&x(n[C]),this._mergedSlots.push(C)}else{const C=i.B(A.id,A.scope);this._mergedOrder.push(C),f[C]=A,A.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&(this._clipLayerPresent=!0)}};if(x(c),this._has3DLayers){const w={};for(let A=0;A<this._mergedOrder.length;++A){const C=this._mergedOrder[A];w[C]=A===y?1:A<y?f[C].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((A,C)=>w[A]-w[C]))}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(c,f,y,x){const w=Object.assign({},f);for(const C of Object.keys(i.a6.colorTheme))w[C]===void 0&&(w[C]=i.a6.colorTheme[C].default);const A=new i.a8(ev,c,new Map(y));return A.setTransitionOrValue(w,y),A.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((f,y)=>{const x="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let w=n;w.startsWith(x)||(w=x+w);const A=i.I.from("mapbox-reserved-lut"),C=new Image;C.src=w,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void f();this._styleColorTheme.lutLoading=!1;const{width:k,height:L,data:V}=i.o.getImageData(C);if(L>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==L*L)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new i.q({width:k,height:L},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const z=this.imageManager.getImage(A,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:n},f()):y(new Error("Missing LUT image."))}}))}getLut(n){const c=this._styleColorThemeForScope[n];return c?c.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(c,f,y){let x,w,A;const C=i.o.devicePixelRatio>1?"@2x":"";let k=i.m(f.transformRequest(f.normalizeSpriteURL(c,C,".json"),i.R.SpriteJSON),((z,G)=>{k=null,A||(A=z,x=G,V())})),L=i.n(f.transformRequest(f.normalizeSpriteURL(c,C,".png"),i.R.SpriteImage),((z,G)=>{L=null,A||(A=z,w=G,V())}));function V(){if(A)y(A);else if(x&&w){const z=i.o.getImageData(w),G={};for(const W in x){const{width:Z,height:oe,x:te,y:le,sdf:fe,pixelRatio:me,stretchX:we,stretchY:xe,content:Se}=x[W],be=new i.q({width:Z,height:oe});i.q.copy(z,be,{x:te,y:le},{x:0,y:0},{width:Z,height:oe},null),G[W]={data:be,pixelRatio:me!==void 0?me:1,sdf:fe!==void 0&&fe,stretchX:we,stretchY:xe,content:Se,usvg:!1,version:0}}y(null,G)}}return{cancel(){k&&(k.cancel(),k=null),L&&(L.cancel(),L=null)}}})(n,this.map._requestManager,((c,f)=>{if(this._spriteRequest=null,c)this.fire(new i.y(c));else if(f){const y=new Map;for(const x in f)y.set(i.I.from(x),f[x]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))}))}addIconset(n,c){if(c.type==="sprite")return void this._loadSprite(c.url);const f=this.getOwnSourceCache(c.source);if(!f)return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const y=f.getSource();if(y.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const x=new rl(n,this.scope,f);this.imageManager.addImageProvider(x,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!i.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const c=this.map._spriteFormat==="auto";var f,y;this._spriteRequest=(y=(x,w)=>{if(this._spriteRequest=null,x)c?this._loadSprite(n):this.fire(new i.y(x));else if(w){const A=new Map;for(const C in w)A.set(i.I.from(C),w[C]);this.addImages(A)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(n),i.R.Iconset),((x,w)=>{if(x)return void y(x);const A={},C=i.dc(new i.bt(w));for(const k of C.icons){const L={version:1,pixelRatio:i.o.devicePixelRatio,content:Ud(k),stretchX:k.metadata?Vd(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?Vd(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};A[k.name]=L}y(null,A)})))}_validateLayer(n){const c=this.getOwnSource(n.source);if(!c)return;const f=n.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new i.y(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((n,c)=>{const f=this.fragments[c];return f&&f.style&&(n.data=f.style.serialize()),n}))}_serializeSources(){const n={};for(const c in this._sourceCaches){const f=this._sourceCaches[c].getSource();n[f.id]||(n[f.id]=f.serialize())}return n}_serializeLayers(n){const c=[];for(const f of n){const y=this._layers[f];y&&y.type!=="custom"&&c.push(y.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const c=this.getOwnLayer(n);if(c)return c;this.fire(new i.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const c=this.getOwnSource(n);if(c)return c;this.fire(new i.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,c){const f=this.map.painter;if(f)for(let y=n.minzoom||0;y<(n.maxzoom||25.5);y++){const x=n.getProgramIds();if(x)for(const w of x){const A=n.getDefaultProgramParams(w,c.zoom,this._styleColorTheme.lut);A&&(f.style=this,this.fog&&(f._fogVisible=!0,A.overrideFog=!0,f.getOrCreateProgram(w,A)),f._fogVisible=!1,A.overrideFog=!1,f.getOrCreateProgram(w,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,f.getOrCreateProgram(w,A)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const c=this.calculateLightsBrightness();n.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const f=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const A=this._changes.getLayerUpdatesByScope();for(const C in A){const{updatedIds:k,removedIds:L}=A[C];(k||L)&&(this._updateWorkerLayers(C,k,L),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const x={};for(const A in this._mergedSourceCaches){const C=this._mergedSourceCaches[A];x[A]=C.used,C.used=!1,C.tileCoverLift=0}for(const A of this._mergedOrder){const C=this._mergedLayers[A];if(C.recalculate(n,this._availableImages),!C.isHidden(n.zoom)){const k=this.getLayerSourceCache(C);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(C,n)})):this.precompilePrograms(C,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const A of w)A.sourceCache.used=!0;for(const A in x){const C=this._mergedSourceCaches[A];x[A]!==C.used&&C.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const c of n){const f=c.resolvePendingRequests(),y=this.getFragmentStyle(c.scope);y&&y.addImages(f)}}_updateTilesForChangedImages(){const n={};for(const c in this._mergedSourceCaches){const f=this._mergedSourceCaches[c].getSource().scope;n[f]=n[f]||this._changes.getUpdatedImages(f),n[f].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n[f])}for(const c in n)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(n,c,f){const y=this.getFragmentStyle(n);y&&this.dispatcher.broadcast("updateLayers",{layers:c?y._serializeLayers(c):[],scope:n,removedIds:f||[],options:y.options})}setState(n,c){if(this._checkLoaded(),ql(this,va(n)))return!1;(n=i.dk(n)).layers=Cd(n.layers);const f=(function(w,A){if(!w)return[{command:Xr.setStyle,args:[A]}];let C=[];try{if(!i.by(w.version,A.version))return[{command:Xr.setStyle,args:[A]}];if(i.by(w.center,A.center)||C.push({command:Xr.setCenter,args:[A.center]}),i.by(w.zoom,A.zoom)||C.push({command:Xr.setZoom,args:[A.zoom]}),i.by(w.bearing,A.bearing)||C.push({command:Xr.setBearing,args:[A.bearing]}),i.by(w.pitch,A.pitch)||C.push({command:Xr.setPitch,args:[A.pitch]}),i.by(w.sprite,A.sprite)||C.push({command:Xr.setSprite,args:[A.sprite]}),i.by(w.glyphs,A.glyphs)||C.push({command:Xr.setGlyphs,args:[A.glyphs]}),i.by(w.imports,A.imports)||(function(G=[],W=[],Z){W=W||[];const oe=(G=G||[]).map($c),te=W.map($c),le=G.reduce(oh,{}),fe=W.reduce(oh,{}),me=oe.slice();let we,xe,Se,be;for(we=0,xe=0;we<oe.length;we++)Se=oe[we],fe.hasOwnProperty(Se)?xe++:(Z.push({command:Xr.removeImport,args:[Se]}),me.splice(me.indexOf(Se,xe),1));for(we=0,xe=0;we<te.length;we++)Se=te[te.length-1-we],me[me.length-1-we]!==Se&&(le.hasOwnProperty(Se)?(Z.push({command:Xr.removeImport,args:[Se]}),me.splice(me.lastIndexOf(Se,me.length-xe),1)):xe++,be=me[me.length-we],Z.push({command:Xr.addImport,args:[fe[Se],be]}),me.splice(me.length-we,0,Se));for(const ve of W){const Te=le[ve.id];Te&&(delete Te.data,i.by(Te,ve)||Z.push({command:Xr.updateImport,args:[ve.id,ve]}))}})(w.imports,A.imports,C),i.by(w.transition,A.transition)||C.push({command:Xr.setTransition,args:[A.transition]}),i.by(w.light,A.light)||C.push({command:Xr.setLight,args:[A.light]}),i.by(w.fog,A.fog)||C.push({command:Xr.setFog,args:[A.fog]}),i.by(w.snow,A.snow)||C.push({command:Xr.setSnow,args:[A.snow]}),i.by(w.rain,A.rain)||C.push({command:Xr.setRain,args:[A.rain]}),i.by(w.projection,A.projection)||C.push({command:Xr.setProjection,args:[A.projection]}),i.by(w.lights,A.lights)||C.push({command:Xr.setLights,args:[A.lights]}),i.by(w.camera,A.camera)||C.push({command:Xr.setCamera,args:[A.camera]}),i.by(w.iconsets,A.iconsets)||(function(G,W,Z){let oe;for(oe in W=W||{},G=G||{})G.hasOwnProperty(oe)&&(W.hasOwnProperty(oe)||Z.push({command:Xr.removeIconset,args:[oe]}));for(oe in W){if(!W.hasOwnProperty(oe))continue;const te=W[oe];G.hasOwnProperty(oe)?i.by(G[oe],te)||(Z.push({command:Xr.removeIconset,args:[oe]}),Z.push({command:Xr.addIconset,args:[oe,te]})):Z.push({command:Xr.addIconset,args:[oe,te]})}})(w.iconsets,A.iconsets,C),!i.by(w["color-theme"],A["color-theme"]))return[{command:Xr.setStyle,args:[A]}];const k={},L=[];(function(G,W,Z,oe){let te;for(te in W=W||{},G=G||{})G.hasOwnProperty(te)&&(W.hasOwnProperty(te)||Wy(te,Z,oe));for(te in W){if(!W.hasOwnProperty(te))continue;const le=W[te];G.hasOwnProperty(te)?i.by(G[te],le)||(G[te].type==="geojson"&&le.type==="geojson"&&Od(G,W,te)?Z.push({command:Xr.setGeoJSONSourceData,args:[te,le.data]}):Zy(te,W,Z,oe)):Vc(te,W,Z)}})(w.sources,A.sources,L,k);const V=[];w.layers&&w.layers.forEach((G=>{G.source&&k[G.source]?C.push({command:Xr.removeLayer,args:[G.id]}):V.push(G)}));let z=w.terrain;z&&k[z.source]&&(C.push({command:Xr.setTerrain,args:[void 0]}),z=void 0),C=C.concat(L),i.by(z,A.terrain)||C.push({command:Xr.setTerrain,args:[A.terrain]}),(function(G,W,Z){W=W||[];const oe=(G=G||[]).map($c),te=W.map($c),le=G.reduce(oh,{}),fe=W.reduce(oh,{}),me=oe.slice(),we=Object.create(null);let xe,Se,be,ve,Te,qe,je;for(xe=0,Se=0;xe<oe.length;xe++)be=oe[xe],fe.hasOwnProperty(be)?Se++:(Z.push({command:Xr.removeLayer,args:[be]}),me.splice(me.indexOf(be,Se),1));for(xe=0,Se=0;xe<te.length;xe++)be=te[te.length-1-xe],me[me.length-1-xe]!==be&&(le.hasOwnProperty(be)?(Z.push({command:Xr.removeLayer,args:[be]}),me.splice(me.lastIndexOf(be,me.length-Se),1)):Se++,qe=me[me.length-xe],Z.push({command:Xr.addLayer,args:[fe[be],qe]}),me.splice(me.length-xe,0,be),we[be]=!0);for(xe=0;xe<te.length;xe++)if(be=te[xe],ve=le[be],Te=fe[be],!we[be]&&!i.by(ve,Te))if(i.by(ve.source,Te.source)&&i.by(ve["source-layer"],Te["source-layer"])&&i.by(ve.type,Te.type)){for(je in Js(ve.layout,Te.layout,Z,be,null,Xr.setLayoutProperty),Js(ve.paint,Te.paint,Z,be,null,Xr.setPaintProperty),i.by(ve.slot,Te.slot)||Z.push({command:Xr.setSlot,args:[be,Te.slot]}),i.by(ve.filter,Te.filter)||Z.push({command:Xr.setFilter,args:[be,Te.filter]}),i.by(ve.minzoom,Te.minzoom)&&i.by(ve.maxzoom,Te.maxzoom)||Z.push({command:Xr.setLayerZoomRange,args:[be,Te.minzoom,Te.maxzoom]}),ve)ve.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Js(ve[je],Te[je],Z,be,je.slice(6),Xr.setPaintProperty):i.by(ve[je],Te[je])||Z.push({command:Xr.setLayerProperty,args:[be,je,Te[je]]}));for(je in Te)Te.hasOwnProperty(je)&&!ve.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Js(ve[je],Te[je],Z,be,je.slice(6),Xr.setPaintProperty):i.by(ve[je],Te[je])||Z.push({command:Xr.setLayerProperty,args:[be,je,Te[je]]}))}else Z.push({command:Xr.removeLayer,args:[be]}),qe=me[me.lastIndexOf(be)+1],Z.push({command:Xr.addLayer,args:[Te,qe]})})(V,A.layers,C)}catch(k){console.warn("Unable to compute style diff:",k),C=[{command:Xr.setStyle,args:[A]}]}return C})(this.serialize(),n).filter((w=>!(w.command in Bw)));if(f.length===0)return!1;const y=f.filter((w=>!(w.command in Fw)));if(y.length>0)throw new Error(`Unimplemented: ${y.map((w=>w.command)).join(", ")}.`);const x=[];return f.forEach((w=>{x.push(this[w.command](...w.args))})),c&&Promise.all(x).then(c).catch(c),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[c,f]of n.entries()){if(this.getImage(c))return this.fire(new i.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,f),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(n,c){return this.getImage(n)?this.fire(new i.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(n,c,f=!1){this.imageManager.updateImage(n,this.scope,c),f&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(n,c,f={}){return this._checkLoaded(),this._validate(Me,`models.${n}`,c,null,f)||(this.modelManager.addModel(n,c,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,c,f={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Yu,`sources.${n}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=Qu(n,c,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id})));const x=w=>{const A=(w?"symbol:":"other:")+y.id,C=i.B(A,this.scope),k=this._sourceCaches[A]=new Ko(C,y,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=k,k.onAdd(this.map)};x(!1),c.type!=="vector"&&c.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const c=this.getOwnSource(n);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new i.y(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new i.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find((([x,w])=>w.type==="source"&&w.source===n));if(y)return this.fire(new i.y(new Error(`Source "${n}" cannot be removed while iconset "${y[0]}" is using it.`)))}const f=this.getOwnSourceCaches(n);for(const y of f){const x=i.dl(y.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(y.id),y.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getOwnSource(n).setData(c),this._changes.setDirty()}getOwnSource(n){const c=this.getOwnSourceCache(n);return c&&c.getSource()}getOwnSources(){const n=[];for(const c in this._otherSourceCaches){const f=this.getOwnSourceCache(c);f&&n.push(f.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const c in n){const f=n[c]._tiles;for(const y in f){const x=f[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const x of n){if(this._validate(Ad,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(c)}else this.ambientLight=new sn(x,ii||(ii=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(c)}else this.directionalLight=new sn(x,vi||(vi=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=Object.assign(c,{worldview:this.map.getWorldview()}),y=new i.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,c=this.ambientLight;if(!n||!c)return;const f=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),y=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=n.properties.get("intensity"),w=n.properties.get("direction"),A=1-i.d3(w.x,w.y,w.z)[2]/90,C=f(y)*x*A,k=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=c.properties.get("intensity"),V=f(k)*L;return Number(((C+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(i.dm(n)){const c=i.dn(n),f=this.fragments.find((({id:x})=>x===c));if(!f)return;const y=i.dl(n);return f.style.getFragmentStyle(y)}{const c=this.fragments.find((({id:f})=>f===n));return c?c.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const c={},f=(y,x="")=>`${y}::${x}`;this._featuresetSelectors={};for(const y in n){const x=this._featuresetSelectors[y]=[];for(const w of n[y].selectors){if(w.featureNamespace){const C=this.getOwnLayer(w.layer);if(!C){i.w(`Layer is undefined for selector: ${w.layer}`);continue}const k=f(C.source,C.sourceLayer);if(k in c&&c[k]!==w.featureNamespace){i.w(`"featureNamespace ${w.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}c[k]=w.featureNamespace}let A;if(w.properties)for(const C in w.properties){const k=i.U(w.properties[C]);k.result==="success"&&(A=A||{},A[C]=k.value)}x.push({layerId:w.layer,namespace:w.featureNamespace,properties:A,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const c=this.getFragmentStyle(n);if(!c||!c.stylesheet.featuresets)return[];const f=[];for(const y in c.stylesheet.featuresets)f.push({featuresetId:y,importId:c.scope?c.scope:void 0});return f}getFeaturesetLayers(n,c){const f=this.getFragmentStyle(c),y=f.stylesheet.featuresets;if(!y||!y[n])return this.fire(new i.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const w of y[n].selectors){const A=f.getOwnLayer(w.layer);A&&x.push(A)}return x}getConfigProperty(n,c){const f=this.getFragmentStyle(n);if(!f)return null;const y=i.B(c,f.scope),x=f.options.get(y),w=x?x.value||x.default:null;return w?w.serialize():null}setConfigProperty(n,c,f){const y=this.getFragmentStyle(n);if(!y)return;const x=y.stylesheet.schema;if(!x||!x[c])return;const w=i.U(f);if(w.result!=="success")return void ql(this,w.value);const A=w.value.expression,C=i.B(c,y.scope),k=y.options.get(C);if(!k)return;let L;const{minValue:V,maxValue:z,stepValue:G,type:W,values:Z}=x[c],oe=i.U(x[c].default);oe.result==="success"&&(L=oe.value.expression),L?(this.options.set(C,Object.assign({},k,{value:A,default:L,minValue:V,maxValue:z,stepValue:G,type:W,values:Z})),this.updateConfigDependencies(c)):this.fire(new i.y(new Error(`No schema defined for the config option "${c}" in the "${n}" fragment.`)))}getConfig(n){const c=this.getFragmentStyle(n);if(!c)return null;const f=c.stylesheet.schema;if(!f)return null;const y={};for(const x in f){const w=i.B(x,c.scope),A=c.options.get(w),C=A?A.value||A.default:null;y[x]=C?C.serialize():null}return y}setConfig(n,c){const f=this.getFragmentStyle(n);f&&(f.updateConfig(c,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const c=this.getFragmentStyle(n);return c?c.stylesheet.schema:null}setSchema(n,c){const f=this.getFragmentStyle(n);f&&(f.stylesheet.schema=c,f.updateConfig(f._config,c),this.updateConfigDependencies())}updateConfig(n,c){if(this._config=n,n||c)if(c)for(const f in c){let y,x;const w=i.U(c[f].default);if(w.result==="success"&&(y=w.value.expression),n&&n[f]!==void 0){const z=i.U(n[f]);z.result==="success"&&(x=z.value.expression)}const{minValue:A,maxValue:C,stepValue:k,type:L,values:V}=c[f];if(y){const z=i.B(f,this.scope);this.options.set(z,{default:y,value:x,minValue:A,maxValue:C,stepValue:k,type:L,values:V})}else this.fire(new i.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const c of this._configDependentLayers){const f=this.getLayer(c);if(f){if(n&&!f.configDependencies.has(n))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((c=>{const f=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(f){const y=c._evaluateColorThemeData(f);(!c._styleColorTheme.lut&&y!==""||c._styleColorTheme.lut&&y!==c._styleColorTheme.lut.data)&&c.setColorTheme(f)}})),this._changes.setDirty()}addLayer(n,c,f={}){this._checkLoaded();const y=n.id;if(this._layers[y])return void this.fire(new i.y(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(n.type==="custom"){if(ql(this,i.dp(n)))return;x=i.dq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=i.dk(n),n=Object.assign(n,{source:y})),this._validate(Fe,`layers.${y}`,n,{arrayIndex:-1},f))return;x=i.dq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let w=this._order.length;if(c){const L=this._order.indexOf(c);if(L===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));x.slot===this._layers[c].slot?w=L:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const A=this.getOwnLayerSourceCache(x),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&x.canCastShadows()&&C&&(A.castsShadows=!0);const k=this._changes.getRemovedLayer(x);if(k&&x.source&&A&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const L=i.B(x.source,x.scope);k.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),A.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(n,c){this._checkLoaded();const f=this._checkLayer(n);if(!f||n===c)return;const y=this._order.indexOf(n);this._order.splice(y,1);let x=this._order.length;if(c){const w=this._order.indexOf(c);if(w===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));f.slot===this._layers[c].slot?x=w:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const c=this._checkLayer(n);if(!c)return;c.setEventedParent(null);const f=this._order.indexOf(n);this._order.splice(f,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const y=this.getOwnLayerSourceCache(c);if(y&&y.castsShadows){let x=!1;for(const w in this._layers)if(this._layers[w].source===c.source&&this._layers[w].canCastShadows()){x=!0;break}y.castsShadows=x}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,f){this._checkLoaded();const y=this._checkLayer(n);y&&(y.minzoom===c&&y.maxzoom===f||(c!=null&&(y.minzoom=c),f!=null&&(y.maxzoom=f),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,c){this._checkLoaded();const f=this._checkLayer(n);f&&f.slot!==c&&(f.slot=c,this._updateLayer(f))}setFilter(n,c,f={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!i.by(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(ne,`layers.${y.id}.filter`,c,{layerType:y.type},f)||(y.filter=i.dk(c),this._updateLayer(y)))}getFilter(n){const c=this._checkLayer(n);if(c)return i.dk(c.filter)}setLayoutProperty(n,c,f,y={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!i.by(x.getLayoutProperty(c),f)){if(f!=null&&(!y||y.validate!==!1)&&ql(x,ye.call(va,{key:`layers.${n}.layout.${c}`,layerType:x.type,objectKey:c,value:f,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(c,f),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(n,c){const f=this._checkLayer(n);if(f)return f.getLayoutProperty(c)}setPaintProperty(n,c,f,y={}){this._checkLoaded();const x=this._checkLayer(n);if(!x||i.by(x.getPaintProperty(c),f)||f!=null&&(!y||y.validate!==!1)&&ql(x,ce.call(va,{key:`layers.${n}.paint.${c}`,layerType:x.type,objectKey:c,value:f,styleSpec:i.a6})))return;const w=x.setPaintProperty(c,f);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(n,c){const f=this._checkLayer(n);if(f)return f.getPaintProperty(c)}setFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:C,importId:k}=n.target,L=this.getFragmentStyle(k),V=L.getFeaturesetLayers(C);for(const{source:z,sourceLayer:G}of V)L.setFeatureState({id:n.id,source:z,sourceLayer:G},c)}else if("layerId"in n.target){const{layerId:C}=n.target,k=this.getLayer(C);this.setFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const f=n.source,y=n.sourceLayer,x=this._checkSource(f);if(!x)return;const w=x.type;if(w==="geojson"&&y)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!y)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(f);for(const C of A)C.setFeatureState(y,n.id,c)}removeFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:C,importId:k}=n.target,L=this.getFragmentStyle(k),V=L.getFeaturesetLayers(C);for(const{source:z,sourceLayer:G}of V)L.removeFeatureState({id:n.id,source:z,sourceLayer:G},c)}else if("layerId"in n.target){const{layerId:C}=n.target,k=this.getLayer(C);this.removeFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const f=n.source,y=this._checkSource(f);if(!y)return;const x=y.type,w=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(f);for(const C of A)C.removeFeatureState(w,n.id,c)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let x;if("featuresetId"in n.target){const{featuresetId:w,importId:A}=n.target,C=this.getFragmentStyle(A),k=C.getFeaturesetLayers(w);for(const{source:L,sourceLayer:V}of k){const z=C.getFeatureState({id:n.id,source:L,sourceLayer:V});if(z&&!x)x=z;else if(!i.by(x,z))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:w}=n.target,A=this.getLayer(w);x=this.getFeatureState({id:n.id,source:A.source,sourceLayer:A.sourceLayer})}return x}const c=n.source,f=n.sourceLayer,y=this._checkSource(c);if(y){if(y.type!=="vector"||f)return n.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(f,n.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),c=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return i.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(f=>f!==void 0))}_updateFilteredLayers(n){for(const c of Object.values(this._mergedLayers))n(c)&&this._updateLayer(c)}_updateLayer(n){this._changes.updateLayer(n);const c=this.getLayerSourceCache(n),f=i.B(n.source,n.scope),y=this._changes.getUpdatedSourceCaches();n.source&&!y[f]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),c.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=A=>this._mergedLayers[A].is3D(!!this.terrain),f=this.order,y={},x=[];for(let A=f.length-1;A>=0;A--){const C=f[A];if(c(C)){y[C]=A;for(const k of n){const L=k[C];if(L)for(const V of L)x.push(V)}}}x.sort(((A,C)=>C.intersectionZ-A.intersectionZ));const w=[];for(let A=f.length-1;A>=0;A--){const C=f[A];if(c(C))for(let k=x.length-1;k>=0;k--){const L=x[k].feature;if(L.layer&&y[L.layer.id]<A)break;w.push(L),x.pop()}else for(const k of n){const L=k[C];if(L)for(const V of L)w.push(V.feature)}}return w}queryRasterValue(n,c,f){const y=this.getOwnSource(n);return y?y.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(c,f):(this.fire(new i.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,c,f){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),y=i.b6(c.filter));const x={},w=L=>{if($d.has(L.type))return;const V=this.getOwnLayerSourceCache(L),z=x[V.id]=x[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(z.has3DLayers=!0),z.layers[L.fqid]=z.layers[L.fqid]||{styleLayer:L,targets:[]},z.layers[L.fqid].targets.push({filter:y})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const L of c.layers){const V=this._layers[L];if(!V)return this.fire(new i.y(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];w(V)}}else for(const L in this._layers)w(this._layers[L]);const A=this._queryRenderedFeatures(n,x,f),C=this._flattenAndSortRenderedFeatures(A),k=[];for(const L of C)i.ds(L.layer.id)===this.scope&&k.push(L);return k}queryRenderedFeatureset(n,c,f){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(ne,"queryRenderedFeatures.filter",c.filter,null,c),y=i.b6(c.filter));const x="mock",w=[];if(c&&c.target)w.push(Object.assign({},c,{targetId:x,filter:y}));else{const L=this.getFeaturesetDescriptors();for(const V of L)w.push({targetId:x,filter:y,target:V});for(const{style:V}of this.fragments){const z=V.getFeaturesetDescriptors();for(const G of z)w.push({targetId:x,filter:y,target:G})}}const A=this.queryRenderedTargets(n,w,f),C=[],k=new Set;for(const L of A)for(const V of L.variants[x])Ks(V,L,k)||C.push(new i.dt(L,V));return C}queryRenderedTargets(n,c,f){const y={},x=(A,C,k,L)=>{const V=y[C.id]=y[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(V.layers[A.fqid]=V.layers[A.fqid]||{styleLayer:A,targets:[]},A.is3D(!!this.terrain)&&(V.has3DLayers=!0),!L)return k.uniqueFeatureID=!1,void V.layers[A.fqid].targets.push(k);V.layers[A.fqid].targets.push(Object.assign({},k,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const A of c)if("featuresetId"in A.target){const{featuresetId:C,importId:k}=A.target,L=this.getFragmentStyle(k);if(!L||!L._featuresetSelectors)continue;const V=L._featuresetSelectors[C];if(!V){this.fire(new i.y(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const z of V){const G=L.getOwnLayer(z.layerId);G&&!$d.has(G.type)&&x(G,L.getOwnLayerSourceCache(G),A,z)}}else if("layerId"in A.target){const{layerId:C}=A.target,k=this.getLayer(C);if(!k||$d.has(k.type))continue;x(k,this.getLayerSourceCache(k),A)}const w=this._queryRenderedFeatures(n,y,f);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(n,c,f){const y=[],x=!!this.map._showQueryGeometry,w=Jn.createFromScreenPoints(n,f);for(const A in c){const C=th(w,c[A],this._availableImages,f,x);Object.keys(C).length&&y.push(C)}if(this.placement)for(const A in c){if(!c[A].sourceCache._onlySymbols)continue;const C=mm(w.screenGeometry,c[A],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&y.push(C)}return y}querySourceFeatures(n,c){const f=c&&c.filter;f&&this._validate(ne,"querySourceFeatures.filter",f,null,c);let y=[];const x=this.getOwnSourceCaches(n);for(const w of x)y=y.concat(Wa(w,c));return y}addSourceType(n,c,f){return da.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(da.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,c,f={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const A in n)if(!i.by(n[A],y[A])){x=!0;break}if(!x)return;const w=this._getTransitionParameters();this.light.setLight(n,c,f),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,c=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=n;const y=n.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const A="terrain-dem-src";this.addSource(A,f.source),f=i.dk(f),f=Object.assign(f,{source:A})}const x=Object.assign({},f),w={};if(this.terrain&&y){x.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(w.style=A.serialize())}if(this._validate(wt,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&c!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,c),this.fire(new i.z("data",{dataType:"style"}))}else{const x=this.terrain,w=x.get();for(const A of Object.keys(i.a6.terrain))!f.hasOwnProperty(A)&&i.a6.terrain[A].default&&(f[A]=i.a6.terrain[A].default);for(const A in n)if(!i.by(n[A],w[A])){x.set(n,this.options),this.stylesheet.terrain=n;const C=this._getTransitionParameters({duration:0});x.updateTransitions(C),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Gr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createSnow(n){const c=this.snow=new xi(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createRain(n){const c=this.rain=new Tn(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const n of this.map._markers)n._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.by(c.get(),n)){c.set(n,this.options),this.stylesheet.fog=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.by(c.get(),n)){c.set(n,this.options),this.stylesheet.snow=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.by(c.get(),n)){c.set(n,this.options),this.stylesheet.rain=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void n();const f=this._evaluateColorThemeData(c);this._loadColorTheme(f).then((()=>{this.fire(new i.z("colorthemeset")),n()})).catch((y=>{i.w(`Couldn't set color theme: ${y}`)}))}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,c){const f=this.getFragmentStyle(n);f&&(f._styleColorTheme.colorThemeOverride=c,f._reloadColorTheme())}_getTransitionParameters(n){return{now:i.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],c=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?n.push(f):c.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const f=this.terrain=new Qe(n,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,f,y,x={}){if(x&&x.validate===!1)return!1;const w=Object.assign({},this.serialize());return ql(this,n.call(va,Object.assign({key:c,style:w,value:f,styleSpec:i.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const c=this.getSourceCaches(n);for(const f of c)f.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const c=this._mergedLayers[n];c._clear&&c._clear()}}reloadSource(n){const c=this.getSourceCaches(n);for(const f of c)f.resume(),f.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((n=>{n.modelManager.reloadModels(n.scope)}))}updateSources(n){let c;this.directionalLight&&(c=Wc(this.directionalLight));const f=new Set;for(const y in this._mergedLayers){const x=this._mergedLayers[y];x.hasElevation()&&!f.has(x.source)&&f.add(x.source)}for(const y in this._mergedSourceCaches){const x=this._mergedSourceCaches[y],w=f.has(x._source.id);x.update(n,void 0,void 0,c,w)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,f,y,x,w,A=!1){let C=!1,k=!1;const L={},V={};for(const z of this._mergedOrder){const G=this._mergedLayers[z];if(G.type!=="symbol")continue;const W=i.B(G.source,G.scope);let Z=L[W];if(!Z){const te=this.getLayerSourceCache(G);if(!te)continue;const le=te.getRenderableIds(!0).map((fe=>te.getTileByID(fe)));V[W]=le.slice(),Z=L[W]=le.sort(((fe,me)=>me.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(me.tileID)?-1:1)))}const oe=this.crossTileSymbolIndex.addLayer(G,Z,c.center.lng,c.projection);C=C||oe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),c.zoom))&&(this.pauseablePlacement=new xo(c,this._mergedOrder,A,f,y,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),k=!0),C&&this.pauseablePlacement.placement.setStale()),k||C){this._buildingIndex.onNewFrame(c.zoom);for(let z=0;z<this._mergedOrder.length;z++){const G=this._mergedLayers[this._mergedOrder[z]];if(G.type!=="symbol")continue;const W=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,L[i.B(G.source,G.scope)],z,W?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,c){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex((({id:x})=>x===n.id))!==-1)return void this.fire(new i.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!c)return f.push(n),this._loadImports([n],!0);const y=f.findIndex((({id:x})=>x===c));return y===-1&&this.fire(new i.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,y).concat(n).concat(f.slice(y)),this._loadImports([n],!0,c)}updateImport(n,c){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(n);return y===-1?this:typeof c=="string"?(this.setImportUrl(n,c),this):(c.url&&c.url!==f[y].url&&this.setImportUrl(n,c.url),i.by(c.config,f[y].config)||this.setImportConfig(n,c.config,c.data.schema),i.by(c.data,f[y].data)||this.setImportData(n,c.data),this)}moveImport(n,c){this._checkLoaded();let f=this.stylesheet.imports||[];const y=this.getImportIndex(n);if(y===-1)return this;const x=this.getImportIndex(c);if(x===-1)return this;const w=f[y],A=this.fragments[y];return f=f.filter((({id:C})=>C!==n)),this.fragments=this.fragments.filter((({id:C})=>C!==n)),this.stylesheet.imports=f.slice(0,x).concat(w).concat(f.slice(x)),this.fragments=this.fragments.slice(0,x).concat(A).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(n,c){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(n);if(y===-1)return this;f[y].url=c;const x=this.fragments[y];return x.style=this._createFragmentStyle(f[y]),x.style.on("style.import.load",(()=>this.mergeAll())),x.style.loadURL(c),this}setImportData(n,c){this._checkLoaded();const f=this.getImportIndex(n),y=this.stylesheet.imports||[];return f===-1?this:c?(this.fragments[f].style.setState(c),this._reloadImports(),this):(delete y[f].data,this.setImportUrl(n,y[f].url))}setImportConfig(n,c,f){this._checkLoaded();const y=this.getImportIndex(n),x=this.stylesheet.imports||[];if(y===-1)return this;c?x[y].config=c:delete x[y].config;const w=this.fragments[y];f&&w.style.stylesheet&&(w.style.stylesheet.schema=f);const A=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=c,w.style.updateConfig(c,A),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(n);f!==-1&&(c.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(n){const c=(this.stylesheet.imports||[]).findIndex((f=>f.id===n));return c===-1&&this.fire(new i.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),c}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const c in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[c];f&&n.push(f.getSource())}return n}getSource(n,c){const f=this.getSourceCache(n,c);return f&&f.getSource()}getLayerSource(n){const c=this.getLayerSourceCache(n);return c&&c.getSource()}getSourceCache(n,c){const f=i.B(n,c);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(n){const c=i.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[n]&&c.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&c.push(this._mergedSymbolSourceCaches[n]),c}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const c in n){const f=n[c];f==="reload"?this.reloadSource(c):f==="clear"&&this.clearSource(c)}}updateLayers(n){const c=this._changes.getUpdatedPaintProperties();for(const f of c){const y=this.getLayer(f);y&&y.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,c,f){this.imageManager.getImages(c.images,c.scope,f),this._updateTilesForChangedImages();const y=w=>{if(w){const A=c.images.map((C=>i.I.toString(C)));w.setDependencies(c.tileID.key,c.type,A)}},x=i.B(c.source,c.scope);y(this._mergedOtherSourceCaches[x]),y(this._mergedSymbolSourceCaches[x]),c.images.some((w=>w.iconsetId))&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(n,c,f){this.imageManager.rasterizeImages(c,f)}getGlyphs(n,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(n,c,f){return i.dv(c,f)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this.getOwnSourceCaches(n);return c.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${n}'`))),!1):c.every((f=>f.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,c){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const f=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),y=n.type==="building";if(n.is3D(!!this.terrain)){if(f||y||c&&c.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((n=>{n.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}da.getSourceType=function(p){return Fc[p]},da.setSourceType=function(p,n){Fc[p]=n},da.registerForPluginStateChange=i.dw;class rv{execute(n){const c=this._makeBuildingsQueryArea(n),f=this._makeFloorsQueryArea(n),y=n.queryRenderedFeatures(c).reduce(((k,L)=>{const V=L.properties.id;return L.properties.type!=="building"||k.some((z=>z.properties.id===V))||k.push(L),k}),[]),x=n.queryRenderedFeatures(f).reduce(((k,L)=>{const V=L.properties.id;return L.properties.type!=="floor"||k.some((z=>z.properties.id===V))||k.push(L),k}),[]),w=[n.getCenter().lng,n.getCenter().lat],A=this._findBuildingAtCenter(w,y),C=y.length>0?y[0]:null;return{floors:x.map((k=>({id:k.properties.id,name:k.properties.name,isDefault:k.properties.is_default,zIndex:k.properties.z_index,connectedFloorIds:k.properties.connected_floor_ids,conflictedFloorIds:k.properties.conflicted_floor_ids,buildingIds:k.properties.building_ids}))),building:A?{id:A.properties.id,name:A.properties.name}:{id:C.properties.id,name:C.properties.name}}}_makeBuildingsQueryArea(n){const c=n.transform.width,f=n.transform.height,y=Math.min(c,f)*(1/8),x=.5*(c-y),w=.5*(f-y);return[new i.P(x,w),new i.P(x+y,w+y)]}_makeFloorsQueryArea(n){const c=n.transform.width,f=n.transform.height;return[new i.P(0,0),new i.P(c,f)]}_findBuildingAtCenter(n,c){for(const f of c)if(f.geometry.type==="Polygon"&&this._pointInPolygon(n,f.geometry.coordinates[0]))return f;return null}_pointInPolygon(n,c){let f=!1;for(let y=0,x=c.length-1;y<c.length;x=y++){const w=c[y][0],A=c[y][1],C=c[x][1];A>n[1]!=C>n[1]&&n[0]<(c[x][0]-w)*(n[1]-A)/(C-A)+w&&(f=!f)}return f}}class nv{constructor(){this._floors=new Map,this._buildings=new Map}append(n){const c=n.building;let f=!1;if(c){const y=c.id;y&&(this._buildings.set(y,c),f||this._buildings.has(y)||(f=!0))}return n.floors.forEach((y=>{const x=y.id;f||this._floors.has(x)||(f=!0),this._floors.set(x,y)})),f}clear(){this._floors.clear(),this._buildings.clear()}getFloors(n=null){const c=Array.from(this._floors.values());return n?c.filter((f=>{const y=f.buildingIds;return!!y&&y.split(";").includes(n)})):c}}class iv{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new nv}setIndoorData(n){const c=this._featuresStorage.append(n);return this._selectedBuildingId=n.building?n.building.id:null,c}setFloorId(n){const c=this._selectedFloorId!==n;return c&&(this._selectedFloorId=n),c}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const n=this._featuresStorage.getFloors(this._selectedBuildingId),c=this.getActiveFloors().find((f=>{const y=f.buildingIds;if(!y)return!1;const x=y.split(";");return!!this._selectedBuildingId&&x.includes(this._selectedBuildingId)}));return{selectedFloorId:c?c.id:null,floors:n}}getActiveFloors(n=!1){const c=this._featuresStorage.getFloors(),f=c.find((C=>C.id===this._selectedFloorId)),y=c.filter((C=>C.isDefault===!0));let x=[];if(f)return x=this._calculateCurrentActiveFloors(c,f,y,n),x;if(y.length===0){const C=this._featuresStorage.getFloors(this._selectedBuildingId);x=C.length>0?[C[0]]:[]}else x=y;const w=this._getNonConflictingLastActiveFloors(x),A=[...x,...w];return this._lastActiveFloors=A,A}hasBuildingChanged(n){return this._selectedBuildingId!==(n.building?n.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(n,c,f,y){if(!c)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,f);const x=this._getConnectedFloors(c,n);return y?this._buildExplicitSelectionFloors(c,x,f):this._buildImplicitSelectionFloors(x,f)}_getConnectedFloors(n,c){const f=n.connectedFloorIds;if(!f)return[];const y=new Set(f.split(";"));return c.filter((x=>y.has(x.id)))}_buildExplicitSelectionFloors(n,c,f){const y=[n,...c],x=this._getNonConflictingLastActiveFloors(y),w=[...y,...x],A=this._deduplicateFloors(w),C=this._getConflictingFloorIdsFrom(A),k=f.filter((V=>!C.has(V.id))),L=[...A,...k];return this._lastActiveFloors=L,L}_buildImplicitSelectionFloors(n,c){const f=this._getConflictingFloorIdsFrom(this._lastActiveFloors),y=c.filter((w=>!f.has(w.id))),x=this._deduplicateFloors([...this._lastActiveFloors,...y]);return this._lastActiveFloors=x,x}_getNonConflictingDefaultFloors(n,c){const f=this._getConflictingFloorIdsFrom(n),y=c.filter((w=>!f.has(w.id))),x=this._deduplicateFloors([...n,...y]);return this._lastActiveFloors=x,x}_deduplicateFloors(n){const c=new Set;return n.filter((f=>{const y=f.id;return!c.has(y)&&(c.add(y),!0)}))}_getConflictingFloorIdsFrom(n){const c=new Set;return n.forEach((f=>{const y=f.conflictedFloorIds;y&&y.split(";").forEach((x=>c.add(x)))})),c}_getNonConflictingLastActiveFloors(n){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const c=new Set(n.map((y=>y.id))),f=this._getConflictingFloorIdsFrom(n);return this._lastActiveFloors.filter((y=>{const x=y.id;return!c.has(x)&&!f.has(x)}))}_isFloorConflicted(n,c){const f=n.id;return c.some((y=>{const x=y.conflictedFloorIds;return!!x&&x.split(";").includes(f)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class Gl extends i.E{constructor(n){super(),i.aY(["_onLoad","_onMove"],this),this._map=n,this._floorSelectionState=new iv,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(n){this._floorSelectionState.setFloorId(n)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((n=>{n.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new i.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=n.scope,this._indoorDataQuery=new rv))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const n=this._indoorDataQuery.execute(this._map);if(!n||n.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(n)){if(!n.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(n),n.building&&this._updateIndoorSelector()}else this._setIndoorData(n)}_setIndoorData(n){this._floorSelectionState.setIndoorData(n)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const n=this._floorSelectionState.getCurrentBuildingSelection(),c=n.floors.map((f=>({id:f.id,name:f.name,shortName:f.zIndex.toString(),levelOrder:f.zIndex})));this.fire(new i.z("indoorupdate",{selectedFloorId:n.selectedFloorId,floors:c}))}_updateIndoorConfig(n=!1){const c=this._floorSelectionState.getActiveFloors(n).map((f=>f.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",c])}}var mh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Cm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Om=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Xc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Mm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Gd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ea=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Mt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Rm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Yc=[];fa(mh,Yc),fa(Om,Yc),fa(Cm,Yc);const Jc={"_prelude_fog.vertex.glsl":Mm,"_prelude_terrain.vertex.glsl":Kc,"_prelude_shadow.vertex.glsl":Mt,"_prelude_fog.fragment.glsl":Gd,"_prelude_shadow.fragment.glsl":Rm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ea,"_prelude_raster_particle.glsl":Hd},gh={};$r("",Kc),$r(Gd,Mm),$r(Rm,Mt),$r(ea,""),$r(Hd,"");const _h=$r(Cm,Om),Xa=mh;var Wd={background:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:$r(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:$r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$r("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$r(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$r(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$r("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$r("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$r("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:$r(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:$r(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:$r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:$r(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:$r(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:$r(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:$r("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:$r("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$r(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:$r(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:$r("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:$r(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xc),skyboxGradient:$r(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xc),skyboxCapture:$r(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$r(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:$r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:$r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:$r(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:$r("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:$r("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:$r("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:$r("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function fa(p,n){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of c)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=f.split(" ");for(const x of y)n.includes(x)||n.push(x)}}function $r(p,n){const c=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y={},x=[],w=[];if(p=p.replace(c,((C,k)=>(w.push(k),""))),(n=n.replace(c,((C,k)=>(x.push(k),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...Yc];fa(p,A),fa(n,A);for(const C of[...x,...w])Jc[C]||console.error(`Undefined include: ${C}`),gh[C]||(gh[C]=[],fa(Jc[C],gh[C])),A=[...A,...gh[C]];return{fragmentSource:p=p.replace(f,((C,k,L,V,z)=>(y[z]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${L} ${V} ${z};
#else
uniform ${L} ${V} u_${z};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${L} ${V} ${z} = u_${z};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${L} ${V} ${z};
#endif
`:k==="initialize-attribute"?"":void 0))),vertexSource:n=n.replace(f,((C,k,L,V,z)=>{const G=V==="float"?"vec2":V,W=z.match(/color/)?"color":G;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${L} ${V} a_${z};
#endif
`:y[z]?k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${L} ${G} a_${z};
out ${L} ${V} ${z};
#else
uniform ${L} ${V} u_${z};
#endif
`:k==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${L} ${V} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${W}(a_${z}, u_${z}_t);
#else
    ${L} ${V} ${z} = u_${z};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${L} ${V} a_${z};
    out ${L} ${V} ${z};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${L} ${G} a_${z};
#else
uniform ${L} ${V} u_${z};
#endif
`:k==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${L} ${V} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${L} ${G} a_${z};
#else
uniform ${L} ${V} u_${z};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${L} ${V} ${z} = a_${z};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${L} ${V} ${z} = a_${z};
#else
    ${L} ${V} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${L} ${V} ${z} = unpack_mix_${W}(a_${z}, u_${z}_t);
#else
    ${L} ${V} ${z} = u_${z};
#endif
`})),usedDefines:A,vertexIncludes:x,fragmentIncludes:w}}class Qc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,f,y,x,w,A,C){this.context=n;let k=this.boundPaintVertexBuffers.length!==y.length;for(let V=0;!k&&V<y.length;V++)this.boundPaintVertexBuffers[V]!==y[V]&&(k=!0);let L=this.boundDynamicVertexBuffers.length!==A.length;for(let V=0;!L&&V<A.length;V++)this.boundDynamicVertexBuffers[V]!==A[V]&&(L=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||k||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(c,f,y,x,w,A,C);else{n.bindVertexArrayOES.set(this.vao);for(const V of A)V&&(V.bind(),C&&V.instanceCount&&V.setVertexAttribDivisor(n.gl,c,C));x&&x.dynamicDraw&&x.bind()}}freshBind(n,c,f,y,x,w,A){const C=this.context,k=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,c.enableAttributes(k,n),c.bind(),c.setVertexAttribPointers(k,n,x);for(const L of f)L.enableAttributes(k,n),L.bind(),L.setVertexAttribPointers(k,n,x);for(const L of w)L&&(L.enableAttributes(k,n),L.bind(),L.setVertexAttribPointers(k,n,x),A&&L.instanceCount&&L.setVertexAttribDivisor(k,n,A));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Uw(p,n){const c=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new i.ae(0,f/c).toLngLat().lat,new i.ae(0,(f+1)/c).toLngLat().lat]}function Vw(p,n,c,f,y,x,w){const A=p.context,C=A.gl,k=c.hillshadeFBO;if(!k)return;p.prepareDrawTile();const L=p.isTileAffectedByFog(n),V=p.getOrCreateProgram("hillshade",{overrideFog:L});A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const z=((oe,te,le,fe)=>{const me=le.paint.get("hillshade-shadow-color"),we=le.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",xe=le.paint.get("hillshade-highlight-color"),Se=le.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=le.paint.get("hillshade-accent-color"),ve=le.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Te=le.paint.get("hillshade-emissive-strength");let qe=i.an(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")qe-=oe.transform.angle;else if(oe.style&&oe.style.enable3dLights()&&oe.style.directionalLight){const tt=oe.style.directionalLight.properties.get("direction"),Ve=i.d3(tt.x,tt.y,tt.z);qe=i.an(Ve[1])}const je=!oe.options.moving;return{u_matrix:fe||oe.transform.calculateProjMatrix(te.tileID.toUnwrapped(),je),u_image:0,u_latrange:Uw(0,te.tileID),u_light:[le.paint.get("hillshade-exaggeration"),qe],u_shadow:me.toPremultipliedRenderColor(we?null:le.lut),u_highlight:xe.toPremultipliedRenderColor(Se?null:le.lut),u_emissive_strength:Te,u_accent:be.toPremultipliedRenderColor(ve?null:le.lut)}})(p,c,f,p.terrain?n.projMatrix:null);p.uploadCommonUniforms(A,V,n.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:W,tileBoundsSegments:Z}=p.getTileBoundsBuffers(c);V.draw(p,C.TRIANGLES,y,x,w,mr.disabled,z,f.id,G,W,Z)}function Zd(p,n,c){if(!n.needsDEMTextureUpload)return;const f=p.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(c.stride);const x=c.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new i.T(f,x,y.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function $w(p,n,c){const f=p.context,y=f.gl;if(!n.dem)return;const x=n.dem;if(f.activeTexture.set(y.TEXTURE1),Zd(p,n,x),!n.demTexture)return;n.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const w=x.dim;f.activeTexture.set(y.TEXTURE0);let A=n.hillshadeFBO;if(!A){const z=new i.T(f,{width:w,height:w,data:null},y.RGBA8);z.bind(y.LINEAR,y.CLAMP_TO_EDGE),A=n.hillshadeFBO=f.createFramebuffer(w,w,!0,"renderbuffer"),A.colorAttachment.set(z.texture)}f.bindFramebuffer.set(A.framebuffer),f.viewport.set([0,0,w,w]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:k,tileBoundsSegments:L}=p.getMercatorTileBoundsBuffers(),V=[];p.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(p,y.TRIANGLES,Bt.disabled,ur.disabled,Ir.unblended,mr.disabled,((z,G)=>{const W=G.stride,Z=i.bC();return i.cd(Z,0,i.al,-i.al,0,0,1),i.br(Z,Z,[0,-i.al,0]),{u_matrix:Z,u_image:1,u_dimension:[W,W],u_zoom:z.overscaledZ}})(n.tileID,x),c.id,C,k,L),n.needsHillshadePrepare=!1}class Gn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ov extends Gn{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Dm extends Gn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class qw extends Gn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Gw extends Gn{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Hw extends Gn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ww extends Gn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class av extends Gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Zw extends Gn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Xd extends Gn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class Xw extends Gn{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class sv extends Gn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class km extends Gn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Kd extends Gn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class Nm extends Gn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Hl extends Gn{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class eu extends Gn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Yd extends Gn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Jd extends Gn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class tu extends Gn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let lv=class extends Gn{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Lm extends Gn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class cv extends Gn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ru extends Gn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Qd extends Gn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ef extends Gn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class jm extends Gn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class tf extends Gn{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class yh extends Gn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class uv extends Gn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class hv extends Gn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class dv extends Gn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class nl extends Gn{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class fv extends nl{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class pv extends nl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Kw extends nl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Yw extends pv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const zm=(p,n,c)=>({u_matrix:p,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:c}),rf=(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:A,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:L,u_globe_radius:V,u_viewport:z,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:W});function nf(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const il=new class{constructor(){this.operations={}}newMorphing(p,n,c,f,y){if(p in this.operations){const x=this.operations[p];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[p]={startTime:f,phase:0,duration:y,from:n,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const c=this.operations[n];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Fm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bm(p,n,c){if(n===0)return 0;const f=n<1&&c===514?.25/n:1;return 6*Math.pow(1.5,22-p)*Math.max(n,1)*f}function Jw(p,n){const c=1<<p.z;return!n&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const Wl=p=>({u_matrix:p});function Zl(p,n,c,f,y){if(y>0){const x=i.o.now(),w=(x-p.timeAdded)/y,A=n?(x-n.timeAdded)/y:-1,C=c.getSource(),k=f.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(p.tileID.overscaledZ-k),V=L&&p.refreshedUponExpiration?1:i.aA(L?w:1-A,0,1);return n?{opacity:1,mix:1-V,isFading:w<1}:{opacity:V,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class mv extends Ko{constructor(n){const c=Qu("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class ta extends Ko{constructor(n){const c=Qu("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,f){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){const A=new Ys(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);A.state="loaded",this._tiles[w.key]=A}return x}),{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach((n=>n.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class of extends i.aO{constructor(n,c,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class vh extends i.dH{constructor(n,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,x]=(function(C){const k=new i.bd,L=new i.b1,V=131;k.reserve(17161),L.reserve(33800);const z=i.al/128,G=i.al+z/2,W=G+z;for(let oe=-z;oe<W;oe+=z)for(let te=-z;te<W;te+=z){const le=te<0||te>G||oe<0||oe>G?24575:0,fe=i.aA(Math.round(te),0,i.al),me=i.aA(Math.round(oe),0,i.al);k.emplaceBack(fe+le,me)}const Z=(oe,te)=>{const le=te*V+oe;L.emplaceBack(le+1,le,le+V),L.emplaceBack(le+V,le+V+1,le+1)};for(let oe=1;oe<129;oe++)for(let te=1;te<129;te++)Z(te,oe);return[0,129].forEach((oe=>{for(let te=0;te<130;te++)Z(te,oe),Z(oe,te)})),[k,L,32768]})(),w=n.context;this.gridBuffer=w.createVertexBuffer(f,i.bf.members),this.gridIndexBuffer=w.createIndexBuffer(y),this.gridSegments=i.bg.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ta(c.map),this.orthoMatrix=i.bC(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const A=w.gl;this._overlapStencilMode=new ur({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new mv(c.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(n,c,f){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const y=n.terrain.properties,x=n.terrain.drapeRenderMode===0,w=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const A=n.terrain&&n.terrain.scope,C=y.get("source"),k=x?this._mockSourceCache:n.getSourceCache(C,A);if(!k)return void i.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=k,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(c):y.get("exaggeration"),!c.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(c,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const c=this._previousCameraAltitude,f=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=f;const y=c!=null?f-c:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const x=n.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let A=x-this._previousZoom;const C=this._previousUpdateTimestamp;let k=x;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(x-k)>.5&&(A=.5*(x-k+A)),A*y<0&&(k+=A)),this._evaluationZoom=k;const L=w.getExaggeration(k),V=L===w.getExaggeration(Math.max(0,k-.1));if(V&&Math.abs(L-this._exaggeration)<.01)return L;let z=Math.min(.1,.00375*(this._updateTimestamp-C));return(V||L<.1||Math.abs(A)<1e-4)&&(z=Math.min(.2,4*z)),i.ak(this._exaggeration,L,z)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((n=>n.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map((C=>{const k=c.getTileByID(C).tileID;return k.projMatrix=f.calculateProjMatrix(k.toUnwrapped()),k}));(function(C,k){const L=k.transform.pointCoordinate(k.transform.getCameraPoint()),V=new i.P(L.x,L.y);C.sort(((z,G)=>{if(G.overscaledZ-z.overscaledZ)return G.overscaledZ-z.overscaledZ;const W=new i.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),Z=new i.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),oe=V.mult(1<<z.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(W)-oe.distSqr(Z)}))})(y,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},y.forEach((C=>{this.proxyToSource[C.key]={}})),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const C in w){const k=w[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[C],x),k.usedForTerrain))continue;const L=n[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map((C=>new of(C,C.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const L=k.tileID.key;L in A||(this._visibleDemTiles.push(k),A[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach((c=>{if(this.terrainTileForTile[c.key])return;const f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)}))}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Zd(this.painter,y,x))}}_prepareDemTileUniforms(n,c,f,y){if(!c||c.demTexture==null)return!1;const x=n.tileID.canonical,w=Math.pow(2,c.tileID.canonical.z-x.z),A=y||"";return f[`u_dem_tl${A}`]=[x.x*w%1,x.y*w%1],f[`u_dem_scale${A}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const c=this._visibleDemTiles.reduce(((f,y)=>{if(!y.dem)return f;const x=y.dem.tree.minimums[0];return x>0&&n++,f+x}),0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const f=this._getLoadedAreaMinimum(),y=new i.dI({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new i.T(n,y,c.R32F,{premultiply:!1}),x}setupElevationDraw(n,c,f){const y=this.painter.context,x=y.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let A=null,C=null,k=1;if(f&&f.morphing&&this._useVertexMorphing){const G=f.morphing.srcDemTile,W=f.morphing.dstDemTile;k=f.morphing.phase,G&&W&&(this._prepareDemTileUniforms(n,G,w,"_prev")&&(C=G),this._prepareDemTileUniforms(n,W,w)&&(A=W))}const L=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let V=null;var z;if(this.enabled?C&&A?(V=A.demTexture,y.activeTexture.set(x.TEXTURE4),C.demTexture.bind(L(C),x.CLAMP_TO_EDGE),w.u_dem_lerp=k):(A=this.terrainTileForTile[n.tileID.key],V=this._prepareDemTileUniforms(n,A,w)?A.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,y.activeTexture.set(x.TEXTURE2),V&&(w.u_dem_size=(z=V).size[0]===1?1:z.size[0]-2,V.bind(L(A),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,c,w),f&&f.useMeterToDem&&A){const G=(1<<A.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=G}if(f&&f.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(y,w),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,n.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,G)}}globeUniformValues(n,c,f){const y=n.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,i.al,0),u_tile_br_up:y.upVector(c,i.al,i.al),u_tile_bl_up:y.upVector(c,0,i.al),u_tile_up_scale:f?i.dJ(1):y.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,x,w,A,C){if(y.transform.projection.name==="globe")(function(k,L,V,z,G){const W=k.context,Z=W.gl;let oe,te;const le=k.transform,fe=i.dA(k,W,le),me=(tt,Ve)=>{if(te===Ve)return;const et=[Fm[Ve],"PROJECTION_GLOBE_VIEW"];fe&&et.push("CUSTOM_ANTIALIASING");const Et=k.isTileAffectedByFog(tt);oe=k.getOrCreateProgram("globeRaster",{defines:et,overrideFog:Et}),te=Ve},we=k.colorModeForRenderPass(),xe=new Bt(Z.LEQUAL,Bt.ReadWrite,k.depthRangeFor3D);il.update(G);const Se=i.dB(le),be=[i.aF(le.center.lng),i.aJ(le.center.lat)],ve=k.globeSharedBuffers,Te=[le.width*i.o.devicePixelRatio,le.height*i.o.devicePixelRatio],qe=Float32Array.from(le.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const tt=k.transform,Ve=Bm(tt.zoom,L.exaggeration(),L.sourceCache._source.tileSize);te=-1;const et=Z.TRIANGLES;for(const Et of z){const $e=V.getTile(Et),Re=ur.disabled,at=L.prevTerrainTileForTile[Et.key],We=L.terrainTileForTile[Et.key];nf(at,We)&&il.newMorphing(Et.key,at,We,G,250),W.activeTexture.set(Z.TEXTURE0),$e.texture&&$e.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const dt=il.getMorphValuesForProxy(Et.key),At=dt?1:0;dt&&Object.assign(je,{morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:i.dz(dt.phase)}});const Lt=i.dC(Et.canonical),xt=i.dD(Lt.getCenter().lat),gt=i.dE(Et.canonical,Lt,xt,tt.worldSize/tt._pixelsPerMercatorPixel),Kt=i.bk(i.dF(Et.canonical)),Wt=rf(tt.expandedFarZProjMatrix,qe,Se,Kt,i.aj(tt.zoom),be,tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.globeCenterInViewSpace,tt.globeRadius,Te,Ve,tt._farZ,gt);if(me(Et,At),oe&&(L.setupElevationDraw($e,oe,je),k.uploadCommonUniforms(W,oe,Et.toUnwrapped()),ve)){const[Xt,Ht,gr]=ve.getGridBuffers(xt,Ve!==0);oe.draw(k,et,xe,Re,we,mr.backCCW,Wt,"globe_raster",Xt,Ht,gr)}}}if(ve&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const tt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&tt.push("CUSTOM_ANTIALIASING"),oe=k.getOrCreateProgram("globeRaster",{defines:tt});for(const Ve of z){const{x:et,y:Et,z:$e}=Ve.canonical,Re=Et===0,at=Et===(1<<$e)-1,[We,dt,At,Lt]=ve.getPoleBuffers($e,!1);if(Lt&&(Re||at)){const xt=V.getTile(Ve);W.activeTexture.set(Z.TEXTURE0),xt.texture&&xt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let gt=i.dG($e,et,le);const Kt=i.bk(i.dF(Ve.canonical)),Wt=(Xt,Ht)=>Xt.draw(k,Z.TRIANGLES,xe,ur.disabled,we,mr.disabled,rf(le.expandedFarZProjMatrix,gt,gt,Kt,0,be,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,Te,0,le._farZ),"globe_pole_raster",Ht,At,Lt);L.setupElevationDraw(xt,oe,je),k.uploadCommonUniforms(W,oe,Ve.toUnwrapped()),Re&&k.renderDefaultNorthPole&&Wt(oe,We),at&&k.renderDefaultSouthPole&&(gt=i.cR(i.bC(),gt,[1,-1,1]),Wt(oe,dt))}}}})(y,x,w,A,C);else{const k=y.context,L=k.gl;let V,z;const G=y.shadowRenderer,W=tl(y,y.longestCutoffRange),Z=we=>{if(z===we)return;const xe=[];xe.push(Fm[we]),W.shouldRenderCutoff&&xe.push("RENDER_CUTOFF"),G&&(xe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&xe.push("NORMAL_OFFSET")),V=y.getOrCreateProgram("terrainRaster",{defines:xe}),z=we},oe=y.colorModeForRenderPass(),te=new Bt(L.LEQUAL,Bt.ReadWrite,y.depthRangeFor3D);il.update(C);const le=y.transform,fe=Bm(le.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let me=[0,0,0];if(G){const we=y.style.directionalLight,xe=y.style.ambientLight;we&&xe&&(me=Aa(y.style,we,xe))}{z=-1;const we=L.TRIANGLES,[xe,Se]=[x.gridIndexBuffer,x.gridSegments];for(const be of A){const ve=w.getTile(be),Te=ur.disabled,qe=x.prevTerrainTileForTile[be.key],je=x.terrainTileForTile[be.key];nf(qe,je)&&il.newMorphing(be.key,qe,je,C,250),k.activeTexture.set(L.TEXTURE0),ve.texture&&ve.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const tt=il.getMorphValuesForProxy(be.key),Ve=tt?1:0;let et;tt&&(et={morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:i.dz(tt.phase)}});const Et=zm(be.projMatrix,Jw(be.canonical,le.renderWorldCopies)?fe/10:fe,me);if(Z(Ve),!V)continue;x.setupElevationDraw(ve,V,et);const $e=be.toUnwrapped();G&&G.setupShadows($e,V),y.uploadCommonUniforms(k,V,$e,null,W),V.draw(y,we,te,Te,oe,mr.backCCW,Et,"terrain_raster",x.gridBuffer,xe,Se)}}}})(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,f=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],w=this._drapedRenderBatches.shift(),A=c.style.order,C=[];let k=0;for(const L of x){const V=y.getTileByID(L.proxyTileKey),z=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][n]:void 0,G=z!==void 0?y.renderCache[z]:this.pool[k++],W=z!==void 0;if(V.texture=G.tex,W&&!G.dirty){C.push(V.tileID);continue}let Z;f.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(f.clear({color:i.ao.transparent,stencil:0}),G.dirty=!1);for(let oe=w.start;oe<=w.end;++oe){const te=c.style._mergedLayers[A[oe]];if(te.isHidden(c.transform.zoom))continue;const le=c.style.getLayerSourceCache(te),fe=le?this.proxyToSource[L.key][le.id]:[L];if(!fe)continue;const me=fe;f.viewport.set([0,0,G.fb.width,G.fb.height]),Z!==(le?le.id:null)&&(this._setupStencil(G,fe,te,le),Z=le?le.id:null),c.renderLayer(c,le,te,me)}if(this._drapedRenderBatches.length===0)for(const oe of this._pendingGroundEffectLayers){const te=c.style._mergedLayers[A[oe]];if(te.isHidden(c.transform.zoom))continue;const le=c.style.getLayerSourceCache(te),fe=le?this.proxyToSource[L.key][le.id]:[L];if(!fe)continue;const me=fe;f.viewport.set([0,0,G.fb.width,G.fb.height]),Z!==(le?le.id:null)&&(this._setupStencil(G,fe,te,le),Z=le?le.id:null),c.renderLayer(c,le,te,me)}this.renderedToTile?(G.dirty=!0,C.push(V.tileID)):W||--k,k===5&&(k=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),w.end+1}postRender(){}isLayerOrderingCorrect(n){const c=n.order.length;let f=-1,y=c;for(let x=0;x<c;++x)this._style.isLayerDraped(n._mergedLayers[n.order[x]])?f=Math.max(f,x):y=Math.min(y,x);return y>f}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter((c=>c.dem)).forEach((c=>{n=Math.min(n,c.dem.tree.minimums[0])})),n===0?n:(n-30)*this._exaggeration}raycast(n,c,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((x=>x.dem)).map((x=>{const w=x.tileID,A=1<<w.overscaledZ,{x:C,y:k}=w.canonical,L=C/A,V=(C+1)/A,z=k/A,G=(k+1)/A;return{minx:L,miny:z,maxx:V,maxy:G,t:x.dem.tree.raycastRoot(L,z,V,G,n,c,f),tile:x}}));y.sort(((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE)));for(const x of y){if(x.t==null)return null;const w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,c,f);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,c=n.gl,f=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const y=new i.T(n,{width:f[0],height:f[1],data:null},c.RGBA8);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=n.createFramebuffer(f[0],f[1],!0,null);return x.colorAttachment.set(y.texture),x.depthAttachment=new Yw(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some((n=>{const c=this._style._mergedLayers[n],f=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()}))}_clearLineLayersFromRenderCache(){let n=!1;for(const f of this._style.getSources())if(f instanceof ao){n=!0;break}if(!n)return;const c={};for(let f=0;f<this._style.order.length;++f){const y=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(y);if(x&&!c[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof i.ad){c[x.id]=!0;for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][x.id];if(A)for(const C of A)this._clearRenderCacheForTile(x.id,C)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof zc){n=!0;break}if(!n)return;const c={};for(let f=0;f<this._style.order.length;++f){const y=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(y);if(!x||c[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const w=y.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][x.id];if(C)for(const k of C){const L=Zl(x.getTile(k),x.findLoadedParent(k,0),x,this.painter.transform,w);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,c=n.length;if(c===0)return;const f=[];this._pendingGroundEffectLayers=[];let y,x=0,w=this._style._mergedLayers[n[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<c;)w=this._style._mergedLayers[n[x]];for(;x<c;++x){const A=this._style._mergedLayers[n[x]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?y===void 0&&(y=x):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),y!==void 0&&(f.push({start:y,end:x-1}),y=void 0)))}if(y!==void 0&&f.push({start:y,end:x-1}),f.length!==0){const A=f[f.length-1];this._pendingGroundEffectLayers.every((C=>C>A.end))||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const w=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let A=0;A<w.length;++A){const C=Object.values(w[A]);c.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let w=f.length-1;w>=0;w--){const A=f[w];if(c.getTileByID(A.key),c.proxyCachedFBO[A.key]!==void 0){const C=n[A.key],k=this.proxyToSource[A.key];let L=0;for(const V in k){const z=k[V],G=C[V];if(!G||G.length!==z.length||z.some(((W,Z)=>W!==G[Z]||y[V]&&y[V].hasOwnProperty(W.key)))){L=-1;break}++L}for(const V in c.proxyCachedFBO[A.key])c.renderCache[c.proxyCachedFBO[A.key][V]].dirty=L<0||L!==Object.values(C).length}}const x=[...this._drapedRenderBatches];x.sort(((w,A)=>A.end-A.start-(w.end-w.start)));for(const w of x)for(const A of f){if(c.proxyCachedFBO[A.key])continue;let C=c.renderCachePool.pop();C===void 0&&c.renderCache.length<50&&(C=c.renderCache.length,c.renderCache.push(this._createFBO())),C!==void 0&&(c.proxyCachedFBO[A.key]={},c.proxyCachedFBO[A.key][w.start]=C,c.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,w=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let A;if(f.isTileClipped())A=c.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):ur.disabled}_renderTileClippingMasks(n,c){const f=this.painter,y=this.painter.context,x=y.gl;f._tileClippingMaskIDs={},y.setColorMode(Ir.disabled),y.setDepthMode(Bt.disabled);const w=f.getOrCreateProgram("clippingMask");for(const A of n){const C=f._tileClippingMaskIDs[A.key]=--c;w.draw(f,x.TRIANGLES,Bt.disabled,new ur({func:x.ALWAYS,mask:0},C,255,x.KEEP,x.KEEP,x.REPLACE),Ir.disabled,mr.disabled,Wl(A.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const f=[n.x,n.y,1,1];i.aC(f,f,c.pixelMatrixInverse),i.cJ(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;const y=c._camera.position,x=i.ce(1,c.center.lat),w=[y[0],y[1],y[2]/x,0],A=i.d9([],f.slice(0,3),w);i.aw(A,A);const C=this.raycast(w,A,this._exaggeration);return C!==null&&C?(i.bH(w,w,A,C),w[3]=w[2],w[2]*=x,w):null}_setupProxiedCoordsForOrtho(n,c,f){if(n.getSource()instanceof i.aS)return this._setupProxiedCoordsForImageSource(n,c,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const k=x[C],L=this._findTileCoveringTileID(k,n);if(L){const V=this._createProxiedId(k,L,f[k.key]&&f[k.key][n.id]);y.push(V),this.proxyToSource[k.key][n.id]=[V]}}let w=!1;const A=new Set;for(let C=0;C<c.length;C++){const k=n.getTile(c[C]);if(!k||!k.hasData())continue;const L=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==k.tileID.canonical.z){const V=this.proxyToSource[L.tileID.key][n.id],z=this._createProxiedId(L.tileID,k,f[L.tileID.key]&&f[L.tileID.key][n.id]);V?V.splice(V.length-1,0,z):this.proxyToSource[L.tileID.key][n.id]=[z];const G=this.proxyToSource[L.tileID.key][n.id];A.has(G)||A.add(G),y.push(z),w=!0}}if(this._sourceTilesOverlap[n.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const C of A)C.sort(((k,L)=>L.overscaledZ-k.overscaledZ))}_setupProxiedCoordsForImageSource(n,c,f){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],x=this.proxyCoords,w=n.getSource(),A=w.tileID;if(!A)return;const C=new i.P(A.x,A.y)._div(1<<A.z),k=w.coordinates.map(i.ae.fromLngLat).reduce(((V,z)=>(V.min.x=Math.min(V.min.x,z.x-C.x),V.min.y=Math.min(V.min.y,z.y-C.y),V.max.x=Math.max(V.max.x,z.x-C.x),V.max.y=Math.max(V.max.y,z.y-C.y),V)),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(V,z)=>{const G=V.wrap+V.canonical.x/(1<<V.canonical.z),W=V.canonical.y/(1<<V.canonical.z),Z=i.al/(1<<V.canonical.z),oe=z.wrap+z.canonical.x/(1<<z.canonical.z),te=z.canonical.y/(1<<z.canonical.z);return G+Z<oe+k.min.x||G>oe+k.max.x||W+Z<te+k.min.y||W>te+k.max.y};for(let V=0;V<x.length;V++){const z=x[V];for(let G=0;G<c.length;G++){const W=n.getTile(c[G]);if(!W||!W.hasData()||L(z,W.tileID))continue;const Z=this._createProxiedId(z,W,f[z.key]&&f[z.key][n.id]),oe=this.proxyToSource[z.key][n.id];oe?oe.push(Z):this.proxyToSource[z.key][n.id]=[Z],y.push(Z)}}}_createProxiedId(n,c,f){let y=this.orthoMatrix;if(f){const x=f.find((w=>w.key===c.tileID.key));if(x)return x}if(c.tileID.key!==n.key){const x=n.canonical.z-c.tileID.canonical.z;let w,A,C;y=i.bC();const k=c.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(w=i.al>>x,A=w*((c.tileID.canonical.x<<x)-n.canonical.x+k),C=w*((c.tileID.canonical.y<<x)-n.canonical.y)):(w=i.al<<-x,A=i.al*(c.tileID.canonical.x-(n.canonical.x+k<<-x)),C=i.al*(c.tileID.canonical.y-(n.canonical.y<<-x))),i.cd(y,0,w,0,w,0,1),i.br(y,y,[A,C,0])}return new of(c.tileID,n.key,y)}_findTileCoveringTileID(n,c){let f=c.getTile(n);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[c.id],x=y[n.key];if(f=x?c.getTileByID(x):null,f&&f.hasData()||x===null)return f;let w=f?f.tileID:n,A=w.overscaledZ;const C=c.getSource().minzoom,k=[];if(!x){const V=c.getSource().maxzoom;if(n.canonical.z>=V){const z=n.canonical.z-V;c.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,c.transform.tileZoom),w=new i.aO(A,n.wrap,V,n.canonical.x>>z,n.canonical.y>>z)):z!==0&&(A=V,w=new i.aO(A,n.wrap,V,n.canonical.x>>z,n.canonical.y>>z))}w.key!==n.key&&(k.push(w.key),f=c.getTile(w))}const L=V=>{k.forEach((z=>{y[z]=V})),k.length=0};for(A-=1;A>=C&&(!f||!f.hasData());A--){f&&L(f.tileID.key);const V=w.calculateScaledKey(A);if(f=c.getTileByID(V),f&&f.hasData())break;const z=y[V];if(z===null)break;z===void 0?k.push(V):f=c.getTileByID(z)}return L(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[c.key]=!0}}function af(p,n,c){const f=(function(A,C,k){const L=i.bJ(C,A),V=i.bJ(k,[.2126,.7152,.0722]),z=(W,Z,oe)=>(1-oe)*W+oe*Z,G=z(1-.3*Math.min(V,1),1,Math.min(L+1,1));return z(.92,1,Math.asin(i.aA(C[2],-1,1))/Math.PI+.5)*G})(p,[0,0,1],n),y=[0,0,0];i.c4(y,c.slice(0,3),f);const x=[0,0,0];i.c4(x,n.slice(0,3),p[2]);const w=[0,0,0];return i.d7(w,y,x),i.da(w)}const Um=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Vm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class sf{static cacheKey(n,c,f,y){let x=`${c}${y?y.cacheKey:""}`;for(const w of f)n.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(n,c,f,y,x,w){const A=n.gl;this.program=A.createProgram(),this.configuration=y,this.name=c,this.fixedDefines=[...w];let C=y?y.defines():[];C=C.concat(w.map((W=>`#define ${W}`)));const k=`#version 300 es
`;let L=k+C.concat("precision mediump float;",Xa,_h.fragmentSource).join(`
`);for(const W of f.fragmentIncludes)L+=`
${Jc[W]}`;L+=`
${f.fragmentSource}`;let V=k+C.concat("precision highp float;",Xa,_h.vertexSource).join(`
`);for(const W of f.vertexIncludes)V+=`
${Jc[W]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(V+=`
uniform int u_instanceID;
`),V+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(V=V.replaceAll("gl_InstanceID","u_instanceID"));const z=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(z,L),A.compileShader(z),A.attachShader(this.program,z);const G=A.createShader(A.VERTEX_SHADER);A.isContextLost()?this.failedToCreate=!0:(A.shaderSource(G,V),A.compileShader(G),A.attachShader(this.program,G),this.attributes={},A.linkProgram(this.program),A.deleteShader(G),A.deleteShader(z),this.fixedUniforms=x(n),this.binderUniforms=y?y.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(W=>({u_instanceID:new i.cg(W)}))(n)),(w.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(W=>({u_dem:new i.cg(W),u_dem_prev:new i.cg(W),u_dem_tl:new i.cj(W),u_dem_scale:new i.ci(W),u_dem_tl_prev:new i.cj(W),u_dem_scale_prev:new i.ci(W),u_dem_size:new i.ci(W),u_dem_lerp:new i.ci(W),u_exaggeration:new i.ci(W),u_depth:new i.cg(W),u_depth_size_inv:new i.cj(W),u_depth_range_unpack:new i.cj(W),u_occluder_half_size:new i.ci(W),u_occlusion_depth_offset:new i.ci(W),u_meter_to_dem:new i.ci(W),u_label_plane_matrix_inv:new i.ck(W)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new i.ch(W),u_tile_tr_up:new i.ch(W),u_tile_br_up:new i.ch(W),u_tile_bl_up:new i.ch(W),u_tile_up_scale:new i.ci(W)}))(n)),w.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new i.ck(W),u_fog_range:new i.cj(W),u_fog_color:new i.d2(W),u_fog_horizon_blend:new i.ci(W),u_fog_vertical_limit:new i.cj(W),u_fog_temporal_offset:new i.ci(W),u_frustum_tl:new i.ch(W),u_frustum_tr:new i.ch(W),u_frustum_br:new i.ch(W),u_frustum_bl:new i.ch(W),u_globe_pos:new i.ch(W),u_globe_radius:new i.ci(W),u_globe_transition:new i.ci(W),u_is_globe:new i.cg(W),u_viewport:new i.cj(W)}))(n)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(W=>({u_cutoff_params:new i.d2(W)}))(n)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(W=>({u_lighting_ambient_color:new i.ch(W),u_lighting_directional_dir:new i.ch(W),u_lighting_directional_color:new i.ch(W),u_ground_radiance:new i.ch(W)}))(n)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(W=>({u_light_matrix_0:new i.ck(W),u_light_matrix_1:new i.ck(W),u_fade_range:new i.cj(W),u_shadow_normal_offset:new i.ch(W),u_shadow_intensity:new i.ci(W),u_shadow_texel_size:new i.ci(W),u_shadow_map_resolution:new i.ci(W),u_shadow_direction:new i.ch(W),u_shadow_bias:new i.ch(W),u_shadowmap_0:new i.cg(W),u_shadowmap_1:new i.cg(W)}))(n)))}getAttributeLocation(n,c){let f=this.attributes[c];return f===void 0&&(f=this.attributes[c]=n.getAttribLocation(this.program,c)),f}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y]&&f[y].set(this.program,y,c[y])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y]&&f[y].set(this.program,y,c[y])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}}setCutoffUniformValues(n,c){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}}setLightsUniformValues(n,c){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}}setShadowUniformValues(n,c){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;n.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}_drawDebugWireframe(n,c,f,y,x,w,A,C,k,L){const V=n.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const z=n.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||n._terrain&&n._terrain.renderingToTexture||!Um.includes(this.name))||!(!V.layers3D||!Vm.includes(this.name))))return;const G=z.gl,W=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,x,z);if(!W)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const oe=n.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});z.program.set(oe.program);const te=(me,we,xe)=>{if(we[me]&&xe[me])for(const Se in we[me])xe[me][Se]&&xe[me][Se].set(xe.program,Se,we[me][Se].current)};k&&k.setUniforms(oe.program,z,oe.binderUniforms,A,{zoom:C}),te("fixedUniforms",this,oe),te("terrainUniforms",this,oe),te("globeUniforms",this,oe),te("fogUniforms",this,oe),te("lightsUniforms",this,oe),te("shadowUniforms",this,oe),W.bind(),z.setColorMode(new Ir([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],i.ao.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Bt(c.func===G.LESS?G.LEQUAL:c.func,Bt.ReadOnly,c.range)),z.setStencilMode(ur.disabled);const le=3*w.primitiveLength*2,fe=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const me=L||1;for(let we=0;we<me;++we)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),G.drawElements(G.LINES,le,G.UNSIGNED_SHORT,fe)}else L&&L>1?G.drawElementsInstanced(G.LINES,le,G.UNSIGNED_SHORT,fe,L):G.drawElements(G.LINES,le,G.UNSIGNED_SHORT,fe);x.bind(),z.program.set(this.program),z.setDepthMode(c),z.setStencilMode(f),z.setColorMode(y)}checkUniforms(n,c,f){if(this.fixedDefines.includes(c)){for(const y of Object.keys(f))if(!f[y].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${y} not set but required by ${c} being defined`)}}draw(n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe){const te=n.context,le=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(f),te.setStencilMode(y),te.setColorMode(x),te.setCullFace(w);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,A[we]);W&&W.setUniforms(this.program,te,this.binderUniforms,z,{zoom:G});const fe={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[c];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const me=oe&&oe>0?1:void 0;for(const we of V.get()){const xe=we.vaos||(we.vaos={});if((xe[C]||(xe[C]=new Qc)).bind(te,this,k,W?W.getPaintVertexBuffers():[],L,we.vertexOffset,Z||[],me),this.forceManualRenderingForInstanceIDShaders){const Se=oe||1;for(let be=0;be<Se;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),L?le.drawElements(c,we.primitiveLength*fe,le.UNSIGNED_SHORT,we.primitiveOffset*fe*2):le.drawArrays(c,we.vertexOffset,we.vertexLength)}else oe&&oe>1?le.drawElementsInstanced(c,we.primitiveLength*fe,le.UNSIGNED_SHORT,we.primitiveOffset*fe*2,oe):L?le.drawElements(c,we.primitiveLength*fe,le.UNSIGNED_SHORT,we.primitiveOffset*fe*2):le.drawArrays(c,we.vertexOffset,we.vertexLength);c===le.TRIANGLES&&L&&this._drawDebugWireframe(n,f,y,x,L,we,z,G,W,oe)}}}function xh(p,n,c=0){const f=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,p.transform.tileZoom)/f,x=y*(n.tileID.canonical.x+n.tileID.wrap*f),w=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(n,1,p.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w],u_pattern_transition:c}}const nu={terrain:0,flat:1},$m=i.bC(),bh=(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te)=>{const le=n.style.light,fe=le.properties.get("position"),me=[fe.x,fe.y,fe.z],we=i.dL();le.properties.get("anchor")==="viewport"&&(i.dM(we,-n.transform.angle),i.dN(me,me,we));const xe=le.properties.get("color").toPremultipliedRenderColor(null),Se=n.transform,be={u_matrix:p,u_lightpos:me,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$m,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:nu[k],u_base_type:nu[L],u_ao:y,u_edge_radius:x,u_width_scale:w,u_flood_light_color:W,u_vertical_scale:Z,u_flood_light_intensity:oe,u_ground_shadow_factor:te};return Se.projection.name==="globe"&&(be.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],be.u_zoom_transition=V,be.u_inv_rot_matrix=G,be.u_merc_center=z,be.u_up_dir=Se.projection.upVector(new i.cC(0,0,0),z[0]*i.al,z[1]*i.al),be.u_height_lift=C),be},qm=(p,n,c,f,y,x)=>({u_matrix:p,u_edge_radius:n,u_width_scale:c,u_vertical_scale:f,u_height_type:nu[y],u_base_type:nu[x]}),gv=(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te)=>{const le=bh(p,n,c,f,y,x,w,A,k,L,V,z,G,W,Z,oe,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return Object.assign(le,xh(n,C,te),fe)},Gm=(p,n,c)=>({u_matrix:p,u_emissive_strength:n,u_ground_shadow_factor:c}),Xl=(p,n,c,f,y,x=0)=>Object.assign(Gm(p,n,y),xh(c,f,x)),Qw=(p,n,c,f)=>({u_matrix:p,u_world:c,u_emissive_strength:n,u_ground_shadow_factor:f}),e1=(p,n,c,f,y,x,w=0)=>Object.assign(Xl(p,n,c,f,x,w),{u_world:y}),t1=(p,n)=>({u_matrix:p,u_ground_shadow_factor:n}),lf=(p,n,c,f,y)=>({u_matrix:p,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:c,u_height_scale:f,u_reset_depth:y}),r1=(p,n,c,f,y,x,w)=>({u_matrix:p,u_normal_matrix:n,u_opacity:c,u_faux_facade_ao_intensity:f,u_camera_pos:y,u_tile_to_meter:x,u_facade_emissive_chance:w}),n1=p=>({u_matrix:p}),Hm=p=>({u_matrix:p}),Wm=(p,n,c,f,y,x,w,A)=>{const C=i.al/x.tileSize;return{u_matrix:p,u_inv_rot_matrix:n,u_camera_to_center_distance:c.getCameraToCenterDistance(A),u_extrude_scale:[c.pixelsToGLUnits[0]/C,c.pixelsToGLUnits[1]/C],u_zoom_transition:f,u_tile_id:w,u_merc_center:y}},Zm=(p,n,c=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:c}),iu=i.bC(),_v=(p,n,c,f,y,x,w)=>{const A=p.transform,C=A.projection.name==="globe",k=C?i.dO(A.zoom,n.canonical)*A._pixelsPerMercatorPixel:i.ay(c,1,x),L={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:w,u_inv_rot_matrix:iu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){L.u_inv_rot_matrix=f,L.u_merc_center=y,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=i.aj(A.zoom);const V=y[0]*i.al,z=y[1]*i.al;L.u_up_dir=A.projection.upVector(new i.cC(0,0,0),V,z)}return L};function Xm(p,[n,c,f,y],[x,w]){if(x===w)return[0,0,0,0];const A=255*(p-1)/(p*(w-x));return[n*A,c*A,f*A,y*A]}function Km(p,n,[c,f]){return c===f?0:.5/p+(n-c)*(p-1)/(p*(f-c))}const cf=(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te,le,fe,me)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:i.dQ(V.paint.get("raster-saturation")),u_contrast_factor:i.dP(V.paint.get("raster-contrast")),u_spin_weights:Kl(V.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:G,u_zoom_transition:w,u_merc_center:A,u_cutoff_params:C,u_colorization_mix:Xm(i.dR,Z,te),u_colorization_offset:Km(i.dR,oe,te),u_color_ramp:W,u_texture_offset:[fe/(le+2*fe),le/(le+2*fe)],u_texture_res:[le+2*fe,le+2*fe],u_emissive_strength:me});function Kl(p){p*=Math.PI/180;const n=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Yl=.05,ol=(p,n,c,f,y,x,w,A,C,k,L,V)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:w,u_merc_center:A,u_cutoff_params:C}),Ym=(p,n,c,f,y,x,w,A,C,k)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_tile_offset:c,u_velocity:f,u_color_ramp:x,u_velocity_res:y,u_max_speed:w,u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Yl,Yl]}),uf=(p,n,c,f,y,x,w,A,C,k)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_velocity:c,u_velocity_res:f,u_max_speed:y,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Yl,Yl]}),Jm=i.bC(),Qm=(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te,le,fe,me,we,xe,Se)=>{const be=y.transform,ve={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(le),u_rotate_symbol:+c,u_aspect_ratio:be.width/be.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:A,u_is_text:+k,u_elevation_from_sea:C?1:0,u_pitch_with_map:+f,u_texsize:L,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Jm,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:xe||0,u_gamma_scale:f?y.transform.getCameraToCenterDistance(le)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Se||1,u_ground_shadow_factor:fe,u_inv_matrix:i.bl(i.bC(),w),u_normal_scale:me,u_lutTexture:pi.LUT};return le.name==="globe"&&(ve.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],ve.u_zoom_transition=W,ve.u_inv_rot_matrix=oe,ve.u_merc_center=Z,ve.u_camera_forward=be._camera.forward(),ve.u_ecef_origin=i.dS(be.globeMatrix,G.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(be.globeMatrix),ve.u_up_vector=te),ve},hf=(p,n,c,f)=>({u_matrix:p,u_emissive_strength:n,u_opacity:c,u_color:f}),df=(p,n,c,f,y,x,w,A,C)=>Object.assign((function(k,L,V,z,G,W){const{width:Z,height:oe}=z.imageManager.getPixelSize(L),te=Math.pow(2,W.tileID.overscaledZ),le=W.tileSize*Math.pow(2,z.transform.tileZoom)/te,fe=le*(W.tileID.canonical.x+W.tileID.wrap*te),me=le*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[Z,oe],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:G?[z.transform.width,-1*z.transform.height]:[1/i.ay(W,1,z.transform.tileZoom),1/i.ay(W,1,z.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,me>>16],u_pixel_coord_lower:[65535&fe,65535&me]}})(0,x,w,f,A,C),{u_matrix:p,u_emissive_strength:n,u_opacity:c}),eg=new Float32Array(i.bA([])),ff=(p,n,c,f,y,x,w,A,C,k,L,V,z,G=[0,0,0],W)=>{const Z=y.style.light,oe=Z.properties.get("position"),te=[-oe.x,-oe.y,oe.z],le=i.dL();Z.properties.get("anchor")==="viewport"&&(i.dM(le,-y.transform.angle),i.dN(te,te,le));const fe=L.alphaMode==="MASK",me=Z.properties.get("color").toNonPremultipliedRenderColor(null),we=z.paint.get("model-ambient-occlusion-intensity"),xe=z.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return xe.a=z.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:p,u_lighting_matrix:n,u_normal_matrix:c,u_node_matrix:f||eg,u_lightpos:te,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[me.r,me.g,me.b],u_camera_pos:G,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+fe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:k,u_baseColorTexture:pi.BaseColor,u_metallicRoughnessTexture:pi.MetallicRoughness,u_normalTexture:pi.Normal,u_occlusionTexture:pi.Occlusion,u_emissionTexture:pi.Emission,u_lutTexture:pi.LUT,u_color_mix:xe.toArray01(),u_aoIntensity:we,u_emissive_strength:V,u_occlusionTextureTransform:W||[0,0,0,0]}},ou=(p,n=eg,c=eg)=>({u_matrix:p,u_instance:n,u_node_matrix:c}),i1={fillExtrusion:p=>({u_matrix:new i.ck(p),u_lightpos:new i.ch(p),u_lightintensity:new i.ci(p),u_lightcolor:new i.ch(p),u_vertical_gradient:new i.ci(p),u_opacity:new i.ci(p),u_edge_radius:new i.ci(p),u_width_scale:new i.ci(p),u_ao:new i.cj(p),u_height_type:new i.cg(p),u_base_type:new i.cg(p),u_tile_id:new i.ch(p),u_zoom_transition:new i.ci(p),u_inv_rot_matrix:new i.ck(p),u_merc_center:new i.cj(p),u_up_dir:new i.ch(p),u_height_lift:new i.ci(p),u_flood_light_color:new i.ch(p),u_vertical_scale:new i.ci(p),u_flood_light_intensity:new i.ci(p),u_ground_shadow_factor:new i.ch(p)}),fillExtrusionDepth:p=>({u_matrix:new i.ck(p),u_edge_radius:new i.ci(p),u_width_scale:new i.ci(p),u_vertical_scale:new i.ci(p),u_height_type:new i.cg(p),u_base_type:new i.cg(p)}),fillExtrusionPattern:p=>({u_matrix:new i.ck(p),u_lightpos:new i.ch(p),u_lightintensity:new i.ci(p),u_lightcolor:new i.ch(p),u_vertical_gradient:new i.ci(p),u_height_factor:new i.ci(p),u_edge_radius:new i.ci(p),u_width_scale:new i.ci(p),u_ao:new i.cj(p),u_height_type:new i.cg(p),u_base_type:new i.cg(p),u_tile_id:new i.ch(p),u_zoom_transition:new i.ci(p),u_inv_rot_matrix:new i.ck(p),u_merc_center:new i.cj(p),u_up_dir:new i.ch(p),u_height_lift:new i.ci(p),u_image:new i.cg(p),u_texsize:new i.cj(p),u_pixel_coord_upper:new i.cj(p),u_pixel_coord_lower:new i.cj(p),u_tile_units_to_pixels:new i.ci(p),u_opacity:new i.ci(p),u_pattern_transition:new i.ci(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new i.ck(p),u_opacity:new i.ci(p),u_ao_pass:new i.ci(p),u_meter_to_tile:new i.ci(p),u_ao:new i.cj(p),u_flood_light_intensity:new i.ci(p),u_flood_light_color:new i.ch(p),u_attenuation:new i.ci(p),u_edge_radius:new i.ci(p),u_fb:new i.cg(p),u_fb_size:new i.ci(p),u_dynamic_offset:new i.ci(p)}),fill:p=>({u_matrix:new i.ck(p),u_emissive_strength:new i.ci(p),u_ground_shadow_factor:new i.ch(p)}),fillPattern:p=>({u_matrix:new i.ck(p),u_emissive_strength:new i.ci(p),u_image:new i.cg(p),u_texsize:new i.cj(p),u_pixel_coord_upper:new i.cj(p),u_pixel_coord_lower:new i.cj(p),u_tile_units_to_pixels:new i.ci(p),u_ground_shadow_factor:new i.ch(p),u_pattern_transition:new i.ci(p)}),fillOutline:p=>({u_matrix:new i.ck(p),u_emissive_strength:new i.ci(p),u_world:new i.cj(p),u_ground_shadow_factor:new i.ch(p)}),fillOutlinePattern:p=>({u_matrix:new i.ck(p),u_emissive_strength:new i.ci(p),u_world:new i.cj(p),u_image:new i.cg(p),u_texsize:new i.cj(p),u_pixel_coord_upper:new i.cj(p),u_pixel_coord_lower:new i.cj(p),u_tile_units_to_pixels:new i.ci(p),u_ground_shadow_factor:new i.ch(p),u_pattern_transition:new i.ci(p)}),building:p=>({u_matrix:new i.ck(p),u_normal_matrix:new i.ck(p),u_opacity:new i.ci(p),u_faux_facade_ao_intensity:new i.ci(p),u_camera_pos:new i.ch(p),u_tile_to_meter:new i.ci(p),u_facade_emissive_chance:new i.ci(p)}),buildingBloom:p=>({u_matrix:new i.ck(p)}),buildingDepth:p=>({u_matrix:new i.ck(p)}),elevatedStructuresDepth:p=>({u_matrix:new i.ck(p),u_depth_bias:new i.ci(p)}),elevatedStructures:p=>({u_matrix:new i.ck(p),u_ground_shadow_factor:new i.ch(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new i.ck(p),u_camera_pos:new i.ch(p),u_depth_bias:new i.ci(p),u_height_scale:new i.ci(p),u_reset_depth:new i.ci(p)}),circle:i.dV,collisionBox:p=>({u_matrix:new i.ck(p),u_inv_rot_matrix:new i.ck(p),u_camera_to_center_distance:new i.ci(p),u_extrude_scale:new i.cj(p),u_zoom_transition:new i.ci(p),u_merc_center:new i.cj(p),u_tile_id:new i.ch(p)}),collisionCircle:p=>({u_matrix:new i.ck(p),u_inv_matrix:new i.ck(p),u_camera_to_center_distance:new i.ci(p),u_viewport_size:new i.cj(p)}),debug:p=>({u_color:new i.dx(p),u_matrix:new i.ck(p),u_overlay:new i.cg(p),u_overlay_scale:new i.ci(p)}),clippingMask:p=>({u_matrix:new i.ck(p)}),heatmap:p=>({u_extrude_scale:new i.ci(p),u_intensity:new i.ci(p),u_matrix:new i.ck(p),u_inv_rot_matrix:new i.ck(p),u_merc_center:new i.cj(p),u_tile_id:new i.ch(p),u_zoom_transition:new i.ci(p),u_up_dir:new i.ch(p)}),heatmapTexture:p=>({u_image:new i.cg(p),u_color_ramp:new i.cg(p),u_opacity:new i.ci(p)}),hillshade:p=>({u_matrix:new i.ck(p),u_image:new i.cg(p),u_latrange:new i.cj(p),u_light:new i.cj(p),u_shadow:new i.dx(p),u_highlight:new i.dx(p),u_emissive_strength:new i.ci(p),u_accent:new i.dx(p)}),hillshadePrepare:p=>({u_matrix:new i.ck(p),u_image:new i.cg(p),u_dimension:new i.cj(p),u_zoom:new i.ci(p)}),line:i.dU,linePattern:i.dT,raster:p=>({u_matrix:new i.ck(p),u_normalize_matrix:new i.ck(p),u_globe_matrix:new i.ck(p),u_merc_matrix:new i.ck(p),u_grid_matrix:new i.dy(p),u_tl_parent:new i.cj(p),u_scale_parent:new i.ci(p),u_fade_t:new i.ci(p),u_opacity:new i.ci(p),u_image0:new i.cg(p),u_image1:new i.cg(p),u_brightness_low:new i.ci(p),u_brightness_high:new i.ci(p),u_saturation_factor:new i.ci(p),u_contrast_factor:new i.ci(p),u_spin_weights:new i.ch(p),u_perspective_transform:new i.cj(p),u_raster_elevation:new i.ci(p),u_zoom_transition:new i.ci(p),u_merc_center:new i.cj(p),u_cutoff_params:new i.d2(p),u_colorization_mix:new i.d2(p),u_colorization_offset:new i.ci(p),u_color_ramp:new i.cg(p),u_texture_offset:new i.cj(p),u_texture_res:new i.cj(p),u_emissive_strength:new i.ci(p)}),rasterParticle:p=>({u_matrix:new i.ck(p),u_normalize_matrix:new i.ck(p),u_globe_matrix:new i.ck(p),u_merc_matrix:new i.ck(p),u_grid_matrix:new i.dy(p),u_tl_parent:new i.cj(p),u_scale_parent:new i.ci(p),u_fade_t:new i.ci(p),u_opacity:new i.ci(p),u_image0:new i.cg(p),u_image1:new i.cg(p),u_raster_elevation:new i.ci(p),u_zoom_transition:new i.ci(p),u_merc_center:new i.cj(p),u_cutoff_params:new i.d2(p)}),rasterParticleTexture:p=>({u_texture:new i.cg(p),u_opacity:new i.ci(p)}),rasterParticleDraw:p=>({u_particle_texture:new i.cg(p),u_particle_texture_side_len:new i.ci(p),u_tile_offset:new i.cj(p),u_velocity:new i.cg(p),u_color_ramp:new i.cg(p),u_velocity_res:new i.cj(p),u_max_speed:new i.ci(p),u_uv_offset:new i.cj(p),u_data_scale:new i.cj(p),u_data_offset:new i.ci(p),u_particle_pos_scale:new i.ci(p),u_particle_pos_offset:new i.cj(p)}),rasterParticleUpdate:p=>({u_particle_texture:new i.cg(p),u_particle_texture_side_len:new i.ci(p),u_velocity:new i.cg(p),u_velocity_res:new i.cj(p),u_max_speed:new i.ci(p),u_speed_factor:new i.ci(p),u_reset_rate:new i.ci(p),u_rand_seed:new i.ci(p),u_uv_offset:new i.cj(p),u_data_scale:new i.cj(p),u_data_offset:new i.ci(p),u_particle_pos_scale:new i.ci(p),u_particle_pos_offset:new i.cj(p)}),symbol:p=>({u_is_size_zoom_constant:new i.cg(p),u_is_size_feature_constant:new i.cg(p),u_size_t:new i.ci(p),u_size:new i.ci(p),u_camera_to_center_distance:new i.ci(p),u_rotate_symbol:new i.cg(p),u_aspect_ratio:new i.ci(p),u_fade_change:new i.ci(p),u_matrix:new i.ck(p),u_label_plane_matrix:new i.ck(p),u_coord_matrix:new i.ck(p),u_is_text:new i.cg(p),u_elevation_from_sea:new i.cg(p),u_pitch_with_map:new i.cg(p),u_texsize:new i.cj(p),u_texsize_icon:new i.cj(p),u_texture:new i.cg(p),u_texture_icon:new i.cg(p),u_gamma_scale:new i.ci(p),u_device_pixel_ratio:new i.ci(p),u_tile_id:new i.ch(p),u_zoom_transition:new i.ci(p),u_inv_rot_matrix:new i.ck(p),u_merc_center:new i.cj(p),u_camera_forward:new i.ch(p),u_tile_matrix:new i.ck(p),u_up_vector:new i.ch(p),u_ecef_origin:new i.ch(p),u_is_halo:new i.cg(p),u_icon_transition:new i.ci(p),u_color_adj_mat:new i.ck(p),u_scale_factor:new i.ci(p),u_ground_shadow_factor:new i.ch(p),u_inv_matrix:new i.ck(p),u_normal_scale:new i.ci(p),u_lutTexture:new i.cg(p)}),background:p=>({u_matrix:new i.ck(p),u_emissive_strength:new i.ci(p),u_opacity:new i.ci(p),u_color:new i.dx(p)}),backgroundPattern:p=>({u_matrix:new i.ck(p),u_emissive_strength:new i.ci(p),u_opacity:new i.ci(p),u_image:new i.cg(p),u_pattern_tl:new i.cj(p),u_pattern_br:new i.cj(p),u_texsize:new i.cj(p),u_pattern_size:new i.cj(p),u_pixel_coord_upper:new i.cj(p),u_pixel_coord_lower:new i.cj(p),u_pattern_units_to_pixels:new i.cj(p)}),terrainRaster:p=>({u_matrix:new i.ck(p),u_image0:new i.cg(p),u_skirt_height:new i.ci(p),u_ground_shadow_factor:new i.ch(p)}),skybox:p=>({u_matrix:new i.ck(p),u_sun_direction:new i.ch(p),u_cubemap:new i.cg(p),u_opacity:new i.ci(p),u_temporal_offset:new i.ci(p)}),skyboxGradient:p=>({u_matrix:new i.ck(p),u_color_ramp:new i.cg(p),u_center_direction:new i.ch(p),u_radius:new i.ci(p),u_opacity:new i.ci(p),u_temporal_offset:new i.ci(p)}),skyboxCapture:p=>({u_matrix_3f:new i.dy(p),u_sun_direction:new i.ch(p),u_sun_intensity:new i.ci(p),u_color_tint_r:new i.d2(p),u_color_tint_m:new i.d2(p),u_luminance:new i.ci(p)}),globeRaster:p=>({u_proj_matrix:new i.ck(p),u_globe_matrix:new i.ck(p),u_normalize_matrix:new i.ck(p),u_merc_matrix:new i.ck(p),u_zoom_transition:new i.ci(p),u_merc_center:new i.cj(p),u_image0:new i.cg(p),u_grid_matrix:new i.dy(p),u_skirt_height:new i.ci(p),u_far_z_cutoff:new i.ci(p),u_frustum_tl:new i.ch(p),u_frustum_tr:new i.ch(p),u_frustum_br:new i.ch(p),u_frustum_bl:new i.ch(p),u_globe_pos:new i.ch(p),u_globe_radius:new i.ci(p),u_viewport:new i.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new i.ch(p),u_frustum_tr:new i.ch(p),u_frustum_br:new i.ch(p),u_frustum_bl:new i.ch(p),u_horizon:new i.ci(p),u_transition:new i.ci(p),u_fadeout_range:new i.ci(p),u_atmosphere_fog_color:new i.d2(p),u_high_color:new i.d2(p),u_space_color:new i.d2(p),u_temporal_offset:new i.ci(p),u_horizon_angle:new i.ci(p)}),model:p=>({u_matrix:new i.ck(p),u_lighting_matrix:new i.ck(p),u_normal_matrix:new i.ck(p),u_node_matrix:new i.ck(p),u_lightpos:new i.ch(p),u_lightintensity:new i.ci(p),u_lightcolor:new i.ch(p),u_camera_pos:new i.ch(p),u_opacity:new i.ci(p),u_baseColorFactor:new i.d2(p),u_emissiveFactor:new i.d2(p),u_metallicFactor:new i.ci(p),u_roughnessFactor:new i.ci(p),u_baseTextureIsAlpha:new i.cg(p),u_alphaMask:new i.cg(p),u_alphaCutoff:new i.ci(p),u_baseColorTexture:new i.cg(p),u_metallicRoughnessTexture:new i.cg(p),u_normalTexture:new i.cg(p),u_occlusionTexture:new i.cg(p),u_emissionTexture:new i.cg(p),u_lutTexture:new i.cg(p),u_color_mix:new i.d2(p),u_aoIntensity:new i.ci(p),u_emissive_strength:new i.ci(p),u_occlusionTextureTransform:new i.d2(p)}),modelDepth:p=>({u_matrix:new i.ck(p),u_instance:new i.ck(p),u_node_matrix:new i.ck(p)}),groundShadow:p=>({u_matrix:new i.ck(p),u_ground_shadow_factor:new i.ch(p)}),stars:p=>({u_matrix:new i.ck(p),u_up:new i.ch(p),u_right:new i.ch(p),u_intensity_multiplier:new i.ci(p)}),snowParticle:p=>({u_modelview:new i.ck(p),u_projection:new i.ck(p),u_time:new i.ci(p),u_cam_pos:new i.ch(p),u_velocityConeAperture:new i.ci(p),u_velocity:new i.ci(p),u_horizontalOscillationRadius:new i.ci(p),u_horizontalOscillationRate:new i.ci(p),u_boxSize:new i.ci(p),u_billboardSize:new i.ci(p),u_simpleShapeParameters:new i.cj(p),u_screenSize:new i.cj(p),u_thinningCenterPos:new i.cj(p),u_thinningShape:new i.ch(p),u_thinningAffectedRatio:new i.ci(p),u_thinningParticleOffset:new i.ci(p),u_particleColor:new i.d2(p),u_direction:new i.ch(p)}),rainParticle:p=>({u_modelview:new i.ck(p),u_projection:new i.ck(p),u_time:new i.ci(p),u_cam_pos:new i.ch(p),u_texScreen:new i.cg(p),u_velocityConeAperture:new i.ci(p),u_velocity:new i.ci(p),u_boxSize:new i.ci(p),u_rainDropletSize:new i.cj(p),u_distortionStrength:new i.ci(p),u_rainDirection:new i.ch(p),u_color:new i.d2(p),u_screenSize:new i.cj(p),u_thinningCenterPos:new i.cj(p),u_thinningShape:new i.ch(p),u_thinningAffectedRatio:new i.ci(p),u_thinningParticleOffset:new i.ci(p),u_shapeDirectionalPower:new i.ci(p),u_shapeNormalPower:new i.ci(p),u_mode:new i.ci(p)}),vignette:p=>({u_vignetteShape:new i.ch(p),u_vignetteColor:new i.d2(p)}),occlusion:p=>({u_matrix:new i.ck(p),u_anchorPos:new i.ch(p),u_screenSizePx:new i.cj(p),u_occluderSizePx:new i.cj(p),u_color:new i.d2(p)})};class al{constructor(n,c,f,y){this.id=al.uniqueIdxCounter,al.uniqueIdxCounter++,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=al.uniqueIdxCounter,al.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}al.uniqueIdxCounter=0;const yv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class o1{constructor(n,c,f,y,x,w){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.instanceCount=w,this.context=n;const A=n.gl;this.buffer=A.createBuffer(),n.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let f=0;f<this.attributes.length;f++){const y=c.getAttributeLocation(n,this.attributes[f].name);y!==-1&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,c,f){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],w=c.getAttributeLocation(n,x.name);w!==-1&&n.vertexAttribPointer(w,x.components,n[yv[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(n,c,f){for(let y=0;y<this.attributes.length;y++){const x=c.getAttributeLocation(n,this.attributes[y].name);x!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(x,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pf{constructor(n,c,f,y,x){this.context=n,this.width=c,this.height=f;const w=this.framebuffer=n.gl.createFramebuffer();y&&(this.colorAttachment=new fv(n,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new pv(n,w):new Kw(n,w))}destroy(){const n=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&n.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&n.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&n.deleteTexture(c)}n.deleteFramebuffer(this.framebuffer)}}class tg{constructor(n,c){this.gl=n,this.clearColor=new ov(this),this.clearDepth=new Dm(this),this.clearStencil=new qw(this),this.colorMask=new Gw(this),this.depthMask=new Hw(this),this.stencilMask=new Ww(this),this.stencilFunc=new av(this),this.stencilOp=new Zw(this),this.stencilTest=new Xd(this),this.depthRange=new Xw(this),this.depthTest=new sv(this),this.depthFunc=new km(this),this.blend=new Kd(this),this.blendFunc=new Nm(this),this.blendColor=new Hl(this),this.blendEquation=new eu(this),this.cullFace=new Yd(this),this.cullFaceSide=new Jd(this),this.frontFace=new tu(this),this.program=new lv(this),this.activeTexture=new Lm(this),this.viewport=new cv(this),this.bindFramebuffer=new ru(this),this.bindRenderbuffer=new Qd(this),this.bindTexture=new ef(this),this.bindVertexBuffer=new jm(this),this.bindElementBuffer=new tf(this),this.bindVertexArrayOES=new yh(this),this.pixelStoreUnpack=new uv(this),this.pixelStoreUnpackPremultiplyAlpha=new hv(this),this.pixelStoreUnpackFlipY=new dv(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c,f){return new al(this,n,c,f)}createVertexBuffer(n,c,f,y,x){return new o1(this,n,c,f,y,x)}createRenderbuffer(n,c,f){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,n,c,f),this.bindRenderbuffer.set(null),x}createFramebuffer(n,c,f,y){return new pf(this,n,c,f,y)}clear({color:n,depth:c,stencil:f,colorMask:y}){const x=this.gl;let w=0;n&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),c!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){i.by(n.blendFunction,Ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ka;function wh(p,n,c,f,y,x,w){const A=p.context,C=A.gl,k=p.transform,L=[i.aF(k.center.lng),i.aJ(k.center.lat)],V=c.layout.get("symbol-placement"),z=c.layout.get("text-variable-anchor"),G=c.layout.get("icon-rotation-alignment")==="map",W=c.layout.get("text-rotation-alignment")==="map",Z=V!=="point",oe=[];let te=0,le=0;for(let ve=0;ve<f.length;ve++){const Te=f[ve],qe=n.getTile(Te),je=qe.getBucket(c);if(!je)continue;const tt=je.getProjection().createInversionMatrix(k,Te.canonical),Ve=[],et=Xy(Te,je,k),Et=!w&&G&&Z,$e=w&&W&&Z,Re=z&&je.hasTextData(),at=je.hasIconTextFit()&&Re&&je.hasIconData(),We=Et||$e||w&&Re||at,dt=je.projection.name==="globe",At=dt?i.aj(k.zoom):0;dt&&(Ve.push("PROJECTION_GLOBE_VIEW"),We&&Ve.push("PROJECTED_POS_ON_VIEWPORT"));const Lt=p.getOrCreateProgram("collisionBox",{defines:Ve});let xt=et;y[0]===0&&y[1]===0||(xt=p.translatePosMatrix(et,qe,y,x));const gt=w?je.textCollisionBox:je.iconCollisionBox,Kt=je.collisionCircleArray;if(Kt.length>0){const Xt=i.bC(),Ht=xt;i.cO(Xt,je.placementInvProjMatrix,k.glCoordMatrix),i.cO(Xt,Xt,je.placementViewportMatrix),oe.push({circleArray:Kt,circleOffset:le,transform:Ht,invTransform:Xt,projection:je.getProjection()}),te+=Kt.length/4,le=te}if(!gt)continue;p.terrain&&p.terrain.setupElevationDraw(qe,Lt);const Wt=dt?[Te.canonical.x,Te.canonical.y,1<<Te.canonical.z]:[0,0,0];Lt.draw(p,C.LINES,Bt.disabled,ur.disabled,p.colorModeForRenderPass(),mr.disabled,Wm(xt,tt,k,At,L,qe,Wt,je.getProjection()),c.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,k.zoom,null,[gt.collisionVertexBuffer,gt.collisionVertexBufferExt])}if(!w||!oe.length)return;const fe=p.getOrCreateProgram("collisionCircle"),me=new i.dW;me.resize(4*te),me._trim();let we=0;for(const ve of oe)for(let Te=0;Te<ve.circleArray.length/4;Te++){const qe=4*Te,je=ve.circleArray[qe+0],tt=ve.circleArray[qe+1],Ve=ve.circleArray[qe+2],et=ve.circleArray[qe+3];me.emplace(we++,je,tt,Ve,et,0),me.emplace(we++,je,tt,Ve,et,1),me.emplace(we++,je,tt,Ve,et,2),me.emplace(we++,je,tt,Ve,et,3)}(!Ka||Ka.length<2*te)&&(Ka=(function(ve){const Te=2*ve,qe=new i.b1;qe.resize(Te),qe._trim();for(let je=0;je<Te;je++){const tt=6*je;qe.uint16[tt+0]=4*je+0,qe.uint16[tt+1]=4*je+1,qe.uint16[tt+2]=4*je+2,qe.uint16[tt+3]=4*je+2,qe.uint16[tt+4]=4*je+3,qe.uint16[tt+5]=4*je+0}return qe})(te));const xe=A.createIndexBuffer(Ka,!0),Se=A.createVertexBuffer(me,i.dX.members,!0);for(const ve of oe){const Te={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(be=k).getCameraToCenterDistance(ve.projection),u_viewport_size:[be.width,be.height]};fe.draw(p,C.TRIANGLES,Bt.disabled,ur.disabled,p.colorModeForRenderPass(),mr.disabled,Te,c.id,Se,xe,i.bg.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,k.zoom)}var be;Se.destroy(),xe.destroy()}const sl=i.bC();function rg(p){const n=p._camera.getWorldToCamera(p.worldSize,1),c=i.aB([],n,p.globeMatrix);i.bl(c,c);const f=[0,0,0],y=[0,1,0,0];return i.aC(y,y,c),f[0]=y[0],f[1]=y[1],f[2]=y[2],i.aw(f,f),f}function mf({width:p,height:n,anchor:c,textOffset:f,textScale:y},x){const{horizontalAlign:w,verticalAlign:A}=i.c0(c),C=-(w-.5)*p,k=-(A-.5)*n,L=i.c1(c,f);return new i.P((C/y+L[0])*x,(k/y+L[1])*x)}function gf(p,n,c,f,y,x,w,A,C,k){const L=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,z=p.icon.dynamicLayoutVertexArray,G={},W=p.getProjection(),Z=Bl(w,W,y),oe=y.elevation,te=W.upVectorScale(w.canonical,y.center.lat,y.worldSize).metersToTile;V.clear();for(let le=0;le<L.length;le++){const fe=L.get(le),{tileAnchorX:me,tileAnchorY:we,numGlyphs:xe}=fe,Se=fe.hidden||!fe.crossTileID||p.allowVerticalPlacement&&!fe.placedOrientation?null:f[fe.crossTileID];if(Se){let be=0,ve=0,Te=0;if(oe){const at=oe?oe.getAtTileOffset(w,me,we):0,[We,dt,At]=W.upVector(w.canonical,me,we);be=at*We*te,ve=at*dt*te,Te=at*At*te}let[qe,je,tt,Ve]=Yo(fe.projectedAnchorX+be,fe.projectedAnchorY+ve,fe.projectedAnchorZ+Te,c?Z:x);const et=Ul(y.getCameraToCenterDistance(W),Ve);let Et=i.bM(p.textSizeData,C,fe)*et/i.bX;c&&(Et*=p.tilePixelRatio/A);const $e=mf(Se,Et);c?({x:qe,y:je,z:tt}=W.projectTilePoint(me+$e.x,we+$e.y,w.canonical),[qe,je,tt]=Yo(qe+be,je+ve,tt+Te,x)):(n&&$e._rotate(-y.angle),qe+=$e.x,je+=$e.y,tt=0);const Re=p.allowVerticalPlacement&&fe.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let at=0;at<xe;at++)i.bO(V,qe,je,tt,Re);k&&fe.associatedIconIndex>=0&&(G[fe.associatedIconIndex]={x:qe,y:je,z:tt,angle:Re})}else lr(xe,V)}if(k){z.clear();const le=p.icon.placedSymbolArray;for(let fe=0;fe<le.length;fe++){const me=le.get(fe),{numGlyphs:we}=me,xe=G[fe];if(me.hidden||!xe)lr(we,z);else{const{x:Se,y:be,z:ve,angle:Te}=xe;for(let qe=0;qe<we;qe++)i.bO(z,Se,be,ve,Te)}}p.icon.dynamicLayoutVertexBuffer.updateData(z)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function Sh(p,n,c,f,y,x,w={}){const A=c.paint.get("icon-translate"),C=c.paint.get("text-translate"),k=c.paint.get("icon-translate-anchor"),L=c.paint.get("text-translate-anchor"),V=c.layout.get("icon-rotation-alignment"),z=c.layout.get("text-rotation-alignment"),G=c.layout.get("icon-pitch-alignment"),W=c.layout.get("text-pitch-alignment"),Z=c.layout.get("icon-keep-upright"),oe=c.layout.get("text-keep-upright"),te=c.paint.get("icon-color-saturation"),le=c.paint.get("icon-color-contrast"),fe=c.paint.get("icon-color-brightness-min"),me=c.paint.get("icon-color-brightness-max"),we=c.layout.get("symbol-elevation-reference")==="sea",xe=c.layout.get("icon-image-use-theme")==="none",Se=p.context,be=Se.gl,ve=p.transform,Te=V==="map",qe=z==="map",je=G==="map",tt=W==="map",Ve=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let et=!1;const Et=p.depthModeForSublayer(0,Bt.ReadOnly),$e=new Bt(p.context.gl.LEQUAL,Bt.ReadOnly,p.depthRangeFor3D),Re=[i.aF(ve.center.lng),i.aJ(ve.center.lat)],at=c.layout.get("text-variable-anchor"),We=ve.projection.name==="globe",dt=[],At=[0,-1,0];for(const Lt of f){const xt=n.getTile(Lt),gt=xt.getBucket(c);if(!gt||gt.projection.name==="mercator"&&We||gt.fullyClipped)continue;const Kt=gt.projection.name==="globe",Wt=Kt?i.aj(ve.zoom):0,Xt=Bl(Lt,gt.getProjection(),ve),Ht=ve.calculatePixelsToTileUnitsMatrix(xt),gr=at&&gt.hasTextData(),Ar=gt.hasIconTextFit()&&gr&&gt.hasIconData(),Cr=gt.getProjection().createInversionMatrix(ve,Lt.canonical),hn=(1<<xt.tileID.canonical.z)*i.al/p.transform.worldSize,vr=Un=>{let Or=[0,0,0];if(Un){const hr=p.style.directionalLight,dn=p.style.ambientLight;hr&&dn&&(Or=Aa(p.style,hr,dn))}return Or},Yr=Un=>{ve.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(Un.push("DEPTH_D24"),Un.push("DEPTH_OCCLUSION"))},ln=Un=>{c.lut&&!xe&&(c.lut.texture||(c.lut.texture=new i.dY(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Se.gl.RGBA8)),Se.activeTexture.set(Se.gl.TEXTURE0+pi.LUT),c.lut.texture&&c.lut.texture.bind(Se.gl.LINEAR,Se.gl.CLAMP_TO_EDGE),Un.push("APPLY_LUT_ON_GPU"))},zn=()=>{const Un=Te&&c.layout.get("symbol-placement")!=="point",Or=[];Yr(Or),ln(Or);const hr=Un||Ar,dn=gt.elevationType==="road",Kn=p.shadowRenderer,$n=dn&&je&&!!Kn&&Kn.enabled,mi=vr($n),qi=dn&&je&&!p.terrain?$e:Et,na=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&je&&Or.push("PITCH_WITH_MAP_TERRAIN"),Kt&&(Or.push("PROJECTION_GLOBE_VIEW"),hr&&Or.push("PROJECTED_POS_ON_VIEWPORT")),na>0&&gt.hasAnySecondaryIcon&&Or.push("ICON_TRANSITION"),!gt.icon.zOffsetVertexBuffer||dn&&p.terrain||Or.push("Z_OFFSET"),te===0&&le===0&&fe===0&&me===1||Or.push("COLOR_ADJUSTMENT"),gt.sdfIcons&&Or.push("RENDER_SDF"),$n&&Or.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),dn&&je&&!p.terrain&&gt.icon.orientationVertexBuffer&&Or.push("ELEVATED_ROADS");const ia=gt.icon.programConfigurations.get(c.id),Fo=p.getOrCreateProgram("symbol",{config:ia,defines:Or}),Bo=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],So=gt.iconSizeData,pa=i.bK(So,ve.zoom),Ca=je||!ve.isOrthographic,ei=wa(Xt,xt.tileID.canonical,je,Te,ve,gt.getProjection(),Ht),ai=Dd(Xt,xt.tileID.canonical,je,Te,ve,gt.getProjection(),Ht),qn=p.translatePosMatrix(ai,xt,A,k,!0),Si=p.translatePosMatrix(Xt,xt,A,k),zi=hr?sl:ei,fi=Te&&!je&&!Un;let Qi=At;!We&&!ve.mercatorFromTransition||Te||(Qi=rg(ve));const es=Kt?Qi:At,Ps=c.getColorAdjustmentMatrix(te,le,fe,me),Oa=Qm(So.kind,pa,fi,je,p,Si,zi,qn,we,!1,Bo,[0,0],0,Lt,Wt,Re,Cr,es,gt.getProjection(),mi,hn,Ps,na,null),gl=xt.imageAtlasTexture?xt.imageAtlasTexture:null,_l=c.layout.get("icon-size").constantOr(0)!==1||gt.iconsNeedLinear,ts=gt.sdfIcons||p.options.rotating||p.options.zooming||_l||Ca?be.LINEAR:be.NEAREST,_u=gt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Is=p.terrain&&je&&Un?i.bl(i.bC(),ei):sl;if(Un&&gt.icon){const rs=ve.elevation,Cs=rs?rs.getAtTileOffsetFunc(Lt,ve.center.lat,ve.worldSize,gt.getProjection()):null,jf=ah(Xt,xt.tileID.canonical,je,Te,ve,gt.getProjection(),Ht);bm(gt,Xt,p,!1,jf,ai,je,Z,Cs,Lt)}return{program:Fo,buffers:gt.icon,uniformValues:Oa,atlasTexture:gl,atlasTextureIcon:null,atlasInterpolation:ts,atlasInterpolationIcon:null,isSDF:gt.sdfIcons,hasHalo:_u,depthMode:qi,tile:xt,renderWithShadows:$n,labelPlaneMatrixInv:Is}},Er=()=>{const Un=qe&&c.layout.get("symbol-placement")!=="point",Or=[],hr=Un||at||Ar,dn=gt.elevationType==="road",Kn=p.shadowRenderer,$n=dn&&tt&&!!Kn&&Kn.enabled,mi=vr($n),qi=dn&&tt&&!p.terrain?$e:Et;p.terrainRenderModeElevated()&&tt&&Or.push("PITCH_WITH_MAP_TERRAIN"),Kt&&(Or.push("PROJECTION_GLOBE_VIEW"),hr&&Or.push("PROJECTED_POS_ON_VIEWPORT")),!gt.text.zOffsetVertexBuffer||dn&&p.terrain||Or.push("Z_OFFSET"),gt.iconsInText&&Or.push("RENDER_TEXT_AND_SYMBOL"),Or.push("RENDER_SDF"),$n&&Or.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),dn&&tt&&!p.terrain&&gt.text.orientationVertexBuffer&&Or.push("ELEVATED_ROADS"),Yr(Or);const na=gt.text.programConfigurations.get(c.id),ia=p.getOrCreateProgram("symbol",{config:na,defines:Or});let Fo,Bo=[0,0],So=null;const pa=gt.textSizeData;gt.iconsInText&&(Bo=xt.imageAtlasTexture?xt.imageAtlasTexture.size:[0,0],So=xt.imageAtlasTexture?xt.imageAtlasTexture:null,Fo=tt||!ve.isOrthographic||p.options.rotating||p.options.zooming||pa.kind==="composite"||pa.kind==="camera"?be.LINEAR:be.NEAREST);const Ca=xt.glyphAtlasTexture?xt.glyphAtlasTexture.size:[0,0],ei=c.layout.get("text-size-scale-range"),ai=i.aA(p.scaleFactor,ei[0],ei[1]),qn=i.bK(pa,ve.zoom,ai),Si=wa(Xt,xt.tileID.canonical,tt,qe,ve,gt.getProjection(),Ht),zi=Dd(Xt,xt.tileID.canonical,tt,qe,ve,gt.getProjection(),Ht),fi=p.translatePosMatrix(zi,xt,C,L,!0),Qi=p.translatePosMatrix(Xt,xt,C,L),es=hr?sl:Si,Ps=qe&&!tt&&!Un;let Oa=At;!We&&!ve.mercatorFromTransition||qe||(Oa=rg(ve));const gl=Qm(pa.kind,qn,Ps,tt,p,Qi,es,fi,we,!0,Ca,Bo,0,Lt,Wt,Re,Cr,Kt?Oa:At,gt.getProjection(),mi,hn,null,null,ai),_l=xt.glyphAtlasTexture?xt.glyphAtlasTexture:null,ts=be.LINEAR,_u=c.paint.get("text-halo-width").constantOr(1)!==0,Is=p.terrain&&tt&&Un?i.bl(i.bC(),Si):sl;if(Un&&gt.text){const rs=ve.elevation,Cs=rs?rs.getAtTileOffsetFunc(Lt,ve.center.lat,ve.worldSize,gt.getProjection()):null,jf=ah(Xt,xt.tileID.canonical,tt,qe,ve,gt.getProjection(),Ht);bm(gt,Xt,p,!0,jf,zi,tt,oe,Cs,Lt)}return{program:ia,buffers:gt.text,uniformValues:gl,atlasTexture:_l,atlasTextureIcon:So,atlasInterpolation:ts,atlasInterpolationIcon:Fo,isSDF:!0,hasHalo:_u,depthMode:qi,tile:xt,renderWithShadows:$n,labelPlaneMatrixInv:Is}},tn=gt.icon.segments.get().length,Qr=gt.text.segments.get().length,on=tn&&!w.onlyText?zn():null,Bn=Qr&&!w.onlyIcons?Er():null,oi=c.paint.get("icon-opacity").constantOr(1),ji=c.paint.get("text-opacity").constantOr(1);if(Ve&&gt.canOverlap){et=!0;const Un=oi&&!w.onlyText?gt.icon.segments.get():[],Or=ji&&!w.onlyIcons?gt.text.segments.get():[];for(const hr of Un)dt.push({segments:new i.bg([hr]),sortKey:hr.sortKey,state:on});for(const hr of Or)dt.push({segments:new i.bg([hr]),sortKey:hr.sortKey,state:Bn})}else w.onlyText||dt.push({segments:oi?gt.icon.segments:new i.bg([]),sortKey:0,state:on}),w.onlyIcons||dt.push({segments:ji?gt.text.segments:new i.bg([]),sortKey:0,state:Bn})}et&&dt.sort(((Lt,xt)=>Lt.sortKey-xt.sortKey));for(const Lt of dt){const xt=Lt.state;if(xt)if(p.terrain?p.terrain.setupElevationDraw(xt.tile,xt.program,{useDepthForOcclusion:ve.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xt.labelPlaneMatrixInv}):p.setupDepthForOcclusion(ve.depthOcclusionForSymbolsAndCircles,xt.program),Se.activeTexture.set(be.TEXTURE0),xt.atlasTexture&&xt.atlasTexture.bind(xt.atlasInterpolation,be.CLAMP_TO_EDGE,!0),xt.atlasTextureIcon&&(Se.activeTexture.set(be.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,be.CLAMP_TO_EDGE,!0)),xt.renderWithShadows&&p.shadowRenderer.setupShadows(xt.tile.tileID.toUnwrapped(),xt.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,xt.program),xt.hasHalo){const gt=xt.uniformValues;gt.u_is_halo=1,_f(xt.buffers,Lt.segments,c,p,xt.program,xt.depthMode,y,x,gt,2),gt.u_is_halo=0}else{if(xt.isSDF){const gt=xt.uniformValues;xt.hasHalo&&(gt.u_is_halo=1,_f(xt.buffers,Lt.segments,c,p,xt.program,xt.depthMode,y,x,gt,1)),gt.u_is_halo=0}_f(xt.buffers,Lt.segments,c,p,xt.program,xt.depthMode,y,x,xt.uniformValues,1)}}}function _f(p,n,c,f,y,x,w,A,C,k){const L=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];y.draw(f,f.context.gl.TRIANGLES,x,w,A,mr.disabled,C,c.id,p.layoutVertexBuffer,p.indexBuffer,n,c.paint,f.transform.zoom,p.programConfigurations.get(c.id),L,k)}function vv(p,n){const c=1<<p.canonical.z,f=(n.x*c-p.canonical.x-p.wrap*c)*i.al,y=(n.y*c-p.canonical.y)*i.al,x=i.e5(n.z,n.y);return i.d4(f,y,x)}function Jl(p,n,c,f,y){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const x=p.context.gl,w=new Bt(p.context.gl.LEQUAL,Bt.ReadWrite,p.depthRangeFor3D),A=new Bt(p.context.gl.GREATER,Bt.ReadWrite,p.depthRangeFor3D),C=(function(G){let W=.01;return G.isOrthographic&&(W=i.ak(1e-4,W,i.c$(G.pitch>=ws?1:G.pitch/ws))),2*W})(p.transform),k=p.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",V=p.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),z=p.getOrCreateProgram(L);for(const G of f){const W=n.getTile(G),Z=W.getBucket(c);if(!Z)continue;const oe=Z.elevatedStructures;if(!oe)continue;const te=Z.elevationBufferData.heightRange,le=vv(G.toUnwrapped(),k),fe=p.translatePosMatrix(G.projMatrix,W,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let me,we,xe,Se;if(y==="initialize"){if(!te||te.min>=1||oe.depthSegments.segments[0].primitiveLength===0)continue;me=lf(fe,le,C,1,0),we=w,xe=oe.depthSegments,Se=V}else if(y==="reset"){if(!te||te.min>=0||oe.maskSegments.segments[0].primitiveLength===0)continue;me=lf(fe,le,0,0,1),we=A,xe=oe.maskSegments,Se=V}else if(y==="geometry"){if(oe.depthSegments.segments[0].primitiveLength===0)continue;me=lf(fe,le,C,1,0),we=w,xe=oe.depthSegments,Se=z}Se.draw(p,x.TRIANGLES,we,ur.disabled,Ir.disabled,mr.disabled,me,c.id,oe.vertexBuffer,oe.indexBuffer,xe,c.paint,p.transform.zoom)}}function au(p,n,c){const{painter:f,sourceCache:y,layer:x,coords:w,colorMode:A,elevationType:C,terrainEnabled:k,pass:L}=p,V=f.context.gl,z=x.paint.get("fill-pattern"),G=x.paint.get("fill-pattern-cross-fade"),W=z.constantOr(null);let Z=C;C!=="road"||n&&!k||(Z="none");const oe=Z==="road",te=p.painter.shadowRenderer,le=oe&&!!te&&te.enabled,fe=new Bt(f.context.gl.LEQUAL,Bt.ReadOnly,f.depthRangeFor3D);let me=[0,0,0];if(le){const Se=f.style.directionalLight,be=f.style.ambientLight;Se&&be&&(me=Aa(f.style,Se,be))}const we=z&&z.constantOr(1),xe=(Se,be)=>{let ve,Te,qe,je,tt;be?(ve=we&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",qe=V.LINES):(ve=we?"fillPattern":"fill",qe=V.TRIANGLES);for(const Ve of w){const et=y.getTile(Ve);if(we&&!et.patternsLoaded())continue;const Et=et.getBucket(x);if(!Et)continue;const $e=n?Et.elevationBufferData:Et.bufferData;if($e.isEmpty())continue;f.prepareDrawTile();const Re=$e.programConfigurations.get(x.id),at=f.isTileAffectedByFog(Ve),We=[],dt=[];oe&&(We.push("ELEVATED_ROADS"),dt.push($e.elevatedLayoutVertexBuffer)),le&&We.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),we&&(f.context.activeTexture.set(V.TEXTURE0),et.imageAtlasTexture&&et.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Re.updatePaintBuffers());let At=!1;if(W&&et.imageAtlas){const Wt=et.imageAtlas,Xt=i.e0.from(W),Ht=Xt.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),gr=Xt.getSecondary(),Ar=Wt.patternPositions.get(Ht),Cr=gr?Wt.patternPositions.get(gr.scaleSelf(i.o.devicePixelRatio).toString()):null;At=!!Ar&&!!Cr,Ar&&Re.setConstantPatternPositions(Ar,Cr)}G>0&&(At||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&We.push("FILL_PATTERN_TRANSITION");const Lt=f.getOrCreateProgram(ve,{config:Re,overrideFog:at,defines:We}),xt=f.translatePosMatrix(Ve.projMatrix,et,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));le&&te.setupShadows(et.tileID.toUnwrapped(),Lt,"vector-tile");const gt=x.paint.get("fill-emissive-strength");if(be){je=$e.lineIndexBuffer,tt=$e.lineSegments;const Wt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];Te=ve==="fillOutlinePattern"&&we?e1(xt,gt,f,et,Wt,me,G):Qw(xt,gt,Wt,me)}else je=$e.indexBuffer,tt=$e.triangleSegments,Te=we?Xl(xt,gt,f,et,me,G):Gm(xt,gt,me);f.uploadCommonUniforms(f.context,Lt,Ve.toUnwrapped());let Kt=Se;(C==="road"&&!k||C==="offset")&&(Kt=fe),Lt.draw(f,qe,Kt,c||f.stencilModeForClipping(Ve),A,mr.disabled,Te,x.id,$e.layoutVertexBuffer,je,tt,x.paint,f.transform.zoom,Re,dt)}};f.renderPass===L&&xe(f.depthModeForSublayer(1,f.renderPass==="opaque"?Bt.ReadWrite:Bt.ReadOnly),!1),Z==="none"&&f.renderPass==="translucent"&&x.paint.get("fill-antialias")&&xe(f.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Bt.ReadOnly),!0)}function Ut(p,n,c,f,y,x,w,A){c.resetLayerRenderingStats(p);const C=p.context,k=C.gl,L=p.transform,V=c.paint.get("fill-extrusion-pattern"),z=c.paint.get("fill-extrusion-pattern-cross-fade"),G=V.constantOr(null),W=V.constantOr(1),Z=c.paint.get("fill-extrusion-opacity"),oe=p.style.enable3dLights(),te=c.paint.get(oe&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),le=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],fe=c.layout.get("fill-extrusion-edge-radius"),me=fe>0&&!c.paint.get("fill-extrusion-rounded-roof"),we=me?0:fe,xe=L.projection.name==="globe"?i.e8():0,Se=L.projection.name==="globe",be=Se?i.aj(L.zoom):0,ve=[i.aF(L.center.lng),i.aJ(L.center.lat)],Te=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",qe=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Te?null:c.lut).toArray01().slice(0,3),je=c.paint.get("fill-extrusion-flood-light-intensity"),tt=c.paint.get("fill-extrusion-vertical-scale"),Ve=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,et=c.paint.get("fill-extrusion-height-alignment"),Et=c.paint.get("fill-extrusion-base-alignment"),$e=tl(p,c.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let at;Se&&Re.push("PROJECTION_GLOBE_VIEW"),le[0]>0&&Re.push("FAUX_AO"),me&&Re.push("ZERO_ROOF_RADIUS"),A&&Re.push("HAS_CENTROID"),je>0&&Re.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),Ve&&Re.push("RENDER_WALL_MODE");const We=p.renderPass==="shadow",dt=p.shadowRenderer,At=We&&!!dt,Lt=We?mr.disabled:mr.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let xt=[0,0,0];if(dt){const Wt=p.style.directionalLight,Xt=p.style.ambientLight;Wt&&Xt&&(xt=Aa(p.style,Wt,Xt)),We||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),dt.useNormalOffset&&Re.push("NORMAL_OFFSET")),at=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const gt=At?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",Kt=c.getLayerRenderingStats();for(const Wt of f){const Xt=n.getTile(Wt),Ht=Xt.getBucket(c);if(!Ht||Ht.projection.name!==L.projection.name)continue;let gr=!1;dt&&(gr=dt.getMaxCascadeForTile(Wt.toUnwrapped())===0);const Ar=p.isTileAffectedByFog(Wt),Cr=Ht.programConfigurations.get(c.id);let hn=!1;if(G&&Xt.imageAtlas){const Qr=Xt.imageAtlas,on=i.e0.from(G),Bn=on.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),oi=on.getSecondary(),ji=Qr.patternPositions.get(Bn),Un=oi?Qr.patternPositions.get(oi.scaleSelf(i.o.devicePixelRatio).toString()):null;hn=!!ji&&!!Un,ji&&Cr.setConstantPatternPositions(ji,Un)}z>0&&(hn||Cr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const vr=p.getOrCreateProgram(gt,{config:Cr,defines:gr?at:Re,overrideFog:Ar});if(p.terrain&&p.terrain.setupElevationDraw(Xt,vr,{useMeterToDem:!0}),!Ht.centroidVertexBuffer){const Qr=vr.getAttributeLocation(k,"a_centroid_pos");Qr!==-1&&k.vertexAttrib2f(Qr,0,0)}!We&&dt&&dt.setupShadows(Xt.tileID.toUnwrapped(),vr,"vector-tile"),W&&(p.context.activeTexture.set(k.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Cr.updatePaintBuffers());const Yr=c.paint.get("fill-extrusion-vertical-gradient"),ln=1/Ht.tileToMeter;let zn;if(We&&dt){if(xv(Xt.tileID,Ht.maxHeight,p))continue;const Qr=dt.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());zn=qm(Qr,we,ln,tt,et,Et)}else{const Qr=p.translatePosMatrix(Wt.expandedProjMatrix,Xt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),on=L.projection.createInversionMatrix(L,Wt.canonical);zn=W?gv(Qr,p,Yr,Z,le,we,ln,Wt,Xt,xe,et,Et,be,ve,on,qe,tt,z):bh(Qr,p,Yr,Z,le,we,ln,Wt,xe,et,Et,be,ve,on,qe,tt,je,xt)}p.uploadCommonUniforms(C,vr,Wt.toUnwrapped(),null,$e);let Er=Ht.segments;if(L.projection.name==="mercator"&&!We&&(Er=Ht.getVisibleSegments(Xt.tileID,p.terrain,p.transform.getFrustum(0)),!Er.get().length))continue;if(Kt)if(We)for(const Qr of Er.get())Kt.numRenderedVerticesInShadowPass+=Qr.primitiveLength;else for(const Qr of Er.get())Kt.numRenderedVerticesInTransparentPass+=Qr.primitiveLength;const tn=[];(p.terrain||A)&&tn.push(Ht.centroidVertexBuffer),Se&&tn.push(Ht.layoutVertexExtBuffer),Ve&&tn.push(Ht.wallVertexBuffer),vr.draw(p,C.gl.TRIANGLES,y,x,w,Lt,zn,c.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Er,c.paint,p.transform.zoom,Cr,tn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class ng{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ss(p,n,c,f,y,x,w,A,C,k,L,V,z,G,W,Z,oe,te,le,fe){const me=n.context,we=me.gl,xe=n.transform,Se=n.transform.zoom,be=[],ve=p.translate,Te=p.translateAnchor,qe=p.edgeRadius,je=tl(n,p.cutoffFadeRange);L==="clear"?(be.push("CLEAR_SUBPASS"),fe&&(be.push("CLEAR_FROM_TEXTURE"),me.activeTexture.set(we.TEXTURE0),fe.bind(we.LINEAR,we.CLAMP_TO_EDGE))):L==="sdf"&&be.push("SDF_SUBPASS"),te&&be.push("HAS_CENTROID"),je.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const tt=(Ve,et,Et,$e,Re)=>{const at=et.programConfigurations.get(f.id),We=n.isTileAffectedByFog(Ve),dt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:at,defines:be,overrideFog:We}),At=((xt,gt,Kt,Wt,Xt,Ht,gr,Ar,Cr,hn,vr)=>({u_matrix:gt,u_opacity:Kt,u_ao_pass:Wt?1:0,u_meter_to_tile:Xt,u_ao:Ht,u_flood_light_intensity:gr,u_flood_light_color:Ar,u_attenuation:Cr,u_edge_radius:hn,u_fb:0,u_fb_size:vr,u_dynamic_offset:1}))(0,$e,V,k,Re,[z,G*Re],W,Z,oe,Se>=17?0:qe*Re,fe?fe.size[0]:0),Lt=[];te&&Lt.push(et.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(me,dt,Ve.toUnwrapped(),null,je),dt.draw(n,me.gl.TRIANGLES,x,w,A,C,At,f.id,et.vertexBuffer,et.indexBuffer,Et,f.paint,Se,at,Lt)};for(const Ve of y){const et=c.getTile(Ve),Et=et.getBucket(f);if(!Et||Et.projection.name!==xe.projection.name||!Et.groundEffect||Et.groundEffect&&!Et.groundEffect.hasData())continue;const $e=Et.groundEffect,Re=1/Et.tileToMeter;{const at=n.translatePosMatrix(Ve.projMatrix,et,ve,Te),We=$e.getDefaultSegment();tt(Ve,$e,We,at,Re)}if(le)for(let at=0;at<4;at++){const We=i.e6[at](Ve),dt=c.getTile(We);if(!dt)continue;const At=dt.getBucket(f);if(!At||At.projection.name!==xe.projection.name||!At.groundEffect||At.groundEffect&&!At.groundEffect.hasData())continue;const Lt=At.groundEffect;let xt,gt;at===0?(xt=[-i.al,0,0],gt=1):at===1?(xt=[i.al,0,0],gt=0):at===2?(xt=[0,-i.al,0],gt=3):(xt=[0,i.al,0],gt=2);const Kt=Lt.regionSegments[gt];if(!Kt)continue;const Wt=new Float32Array(16);i.br(Wt,Ve.projMatrix,xt),tt(Ve,Lt,Kt,n.translatePosMatrix(Wt,et,ve,Te),Re)}}}function ll(p,n,c,f,y,x,w){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const A=x?x.findDEMTileFor(c):null;if(!(A&&A.dem||w))return;x&&A&&A.dem&&f.selfDEMTileTimestamp!==A.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=A.dem._timestamp);const C=te=>new i.P(Math.ceil((te+i.ea)*i.eb),0),k=te=>{const le=n.getSource().minzoom,fe=we=>{const xe=n.getTileByID(we);if(xe&&xe.hasData())return xe.getBucket(y)},me=[0,-1,1];for(const we of me){if(te.overscaledZ+we<le)continue;const xe=fe(te.calculateScaledKey(te.overscaledZ+we));if(xe)return xe}},L=[0,0,0],V=(te,le)=>(L[0]=Math.min(te.min.y,le.min.y),L[1]=Math.max(te.max.y,le.max.y),L[2]=i.al-le.min.x>te.max.x?le.min.x-i.al:te.max.x,L),z=(te,le)=>(L[0]=Math.min(te.min.x,le.min.x),L[1]=Math.max(te.max.x,le.max.x),L[2]=i.al-le.min.y>te.max.y?le.min.y-i.al:te.max.y,L),G=[(te,le)=>V(te,le),(te,le)=>V(le,te),(te,le)=>z(te,le),(te,le)=>z(le,te)],W=(te,le,fe,me,we,xe,Se)=>{if(!x)return 0;const be=[[xe?fe:te,xe?te:fe,0],[xe?fe:le,xe?le:fe,0]],ve=Se<0?i.al+Se:Se,Te=[xe?ve:(te+le)/2,xe?(te+le)/2:ve,0];return fe===0&&Se<0||fe!==0&&Se>0?x.getForTilePoints(we,[Te],!0,me):be.push(Te),x.getForTilePoints(c,be,!0,A),Math.max(be[0][2],be[1][2],Te[2])/x.exaggeration()};for(let te=0;te<4;te++){const le=f.borderFeatureIndices[te];if(le.length===0)continue;const fe=i.e6[te](c),me=k(fe);if(!(me&&me instanceof i.e7))continue;const we=x?x.findDEMTileFor(fe):null;if(!(we&&we.dem||w)||(x&&we&&we.dem&&f.borderDEMTileTimestamp[te]!==we.dem._timestamp&&(f.borderDoneWithNeighborZ[te]=-1,f.borderDEMTileTimestamp[te]=we.dem._timestamp),f.borderDoneWithNeighborZ[te]===me.canonical.z))continue;me.centroidVertexArray.length===0&&me.createCentroidsBuffer();const xe=(te<2?1:5)-te,Se=me.borderDoneWithNeighborZ[xe]!==f.canonical.z,be=me.borderFeatureIndices[xe];let ve=0;if(f.canonical.z!==me.canonical.z){for(const Te of le)f.showCentroid(f.featuresOnBorder[Te]);if(Se)for(const Te of be)me.showCentroid(me.featuresOnBorder[Te]);f.borderDoneWithNeighborZ[te]=me.canonical.z,me.borderDoneWithNeighborZ[xe]=f.canonical.z}for(const Te of le){const qe=f.featuresOnBorder[Te],je=f.centroidData[qe.centroidDataIndex],tt=qe.borders[te];let Ve;for(;ve<be.length;){Ve=me.featuresOnBorder[be[ve]];const et=Ve.borders[xe];if(et[1]>tt[0]+3||et[0]>tt[0]-3)break;me.showCentroid(Ve),ve++}if(Ve&&ve<be.length){const et=ve;let Et=0;for(;!(Ve.borders[xe][0]>tt[1]-3)&&(Et++,++ve!==be.length);)Ve=me.featuresOnBorder[be[ve]];Ve=me.featuresOnBorder[be[et]];let $e=!1;if(Et>=1){const We=Ve.borders[xe];Math.abs(tt[0]-We[0])<3&&Math.abs(tt[1]-We[1])<3&&(Et=1,$e=!0,ve=et+1)}else if(Et===0){f.showCentroid(qe);continue}const Re=me.centroidData[Ve.centroidDataIndex];w&&$e&&(((Z=je).flags|(oe=Re).flags)&i.e9?(Z.flags|=i.e9,oe.flags|=i.e9):(Z.flags&=~i.e9,oe.flags&=~i.e9));const at=qe.intersectsCount()>1||Ve.intersectsCount()>1;if(Et>1)ve=et,je.centroidXY=Re.centroidXY=new i.P(0,0);else if(we&&we.dem&&!at){const We=G[te](je,Re),dt=te%2?i.al-1:0,At=W(We[0],Math.min(i.al-1,We[1]),dt,we,fe,te<2,We[2]);je.centroidXY=Re.centroidXY=C(At)}else at?je.centroidXY=Re.centroidXY=new i.P(0,0):(je.centroidXY=f.encodeBorderCentroid(qe),Re.centroidXY=me.encodeBorderCentroid(Ve));f.writeCentroidToBuffer(je),me.writeCentroidToBuffer(Re)}else f.showCentroid(qe)}f.borderDoneWithNeighborZ[te]=me.canonical.z,me.borderDoneWithNeighborZ[xe]=f.canonical.z}var Z,oe;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}const cl=[1,0,0],sr=[0,1,0],ig=[0,0,1];function xv(p,n,c){const f=c.transform,y=c.shadowRenderer;if(!y)return!0;const x=p.toUnwrapped(),w=f.tileSize*y._cascades[c.currentShadowCascade].scale;let A=n;if(f.elevation){const Z=f.elevation.getMinMaxForTile(p);Z&&(A+=Z.max)}const C=[...y.shadowDirection];C[2]=-C[2];const k=y.computeSimplifiedTileShadowVolume(x,A,w,C);if(!k)return!1;const L=[cl,sr,ig,C,[C[0],0,C[2]],[0,C[1],C[2]]],V=f.projection.name==="globe",z=f.scaleZoom(w),G=i.cA.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,z,!V),W=y.getCurrentCascadeFrustum();return G.intersectsPrecise(k.vertices,k.planes,L)===0||W.intersectsPrecise(k.vertices,k.planes,L)===0}function yf(p){const{painter:n,source:c,layer:f,coords:y}=p;let x=p.defines;const w=n.context,A=n.renderPass==="shadow",C=n.renderPass==="light-beam",k=n.shadowRenderer,L=i.ec(n.transform.center.lat,n.transform.zoom),V=tl(n,f.paint.get("building-cutoff-fade-range"));V.shouldRenderCutoff&&(x=x.concat("RENDER_CUTOFF"));for(const z of y){const G=c.getTile(z),W=G.getBucket(f);if(!W)continue;k&&k.getMaxCascadeForTile(z.toUnwrapped())===0&&(x=x.concat("SHADOWS_SINGLE_CASCADE"));const Z=W.programConfigurations.get(f.id);let oe,te,le,fe=n.translatePosMatrix(z.expandedProjMatrix,G,[0,0],"map");if(fe=i.cR(i.bC(),fe,[1,1,p.verticalScale]),A&&k){if(xv(G.tileID,W.maxHeight*L,n))continue;let we=k.calculateShadowPassMatrixFromTile(G.tileID.toUnwrapped());we=i.cR(i.bC(),we,[1,1,p.verticalScale]),le=Hm(we),oe=te=n.getOrCreateProgram("buildingDepth",{config:Z,defines:x,overrideFog:!1})}else if(C)oe=te=n.getOrCreateProgram("buildingBloom",{config:Z,defines:x,overrideFog:!1}),le=n1(fe);else{const we=n.transform.calculatePosMatrix(z.toUnwrapped(),n.transform.worldSize);i.cR(we,we,[1,1,p.verticalScale]);const xe=i.bC();i.cR(xe,we,[1,-1,1/L]),i.bl(xe,xe),i.ed(xe,xe);const Se=n.transform.getFreeCameraOptions().position,be=1<<z.canonical.z;le=r1(fe,xe,p.opacity,p.facadeAOIntensity,[((Se.x-z.wrap)*be-z.canonical.x)*i.al,(Se.y*be-z.canonical.y)*i.al,Se.z*be*i.al],W.tileToMeter,p.facadeEmissiveChance),te=n.getOrCreateProgram("building",{config:Z,defines:x,overrideFog:!1});const ve=x.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);oe=n.getOrCreateProgram("building",{config:Z,defines:ve,overrideFog:!1}),k&&(k.setupShadowsFromMatrix(we,te,!0),k.setupShadowsFromMatrix(we,oe,!0))}const me=(we,xe)=>{if(C){const Se=we.entranceBloom;xe.draw(n,w.gl.TRIANGLES,p.depthMode,ur.disabled,p.blendMode,mr.disabled,le,f.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segmentsBucket,f.paint,n.transform.zoom,Z,[Se.layoutAttenuationBuffer,Se.layoutColorBuffer])}else{const Se=we.segmentsBucket;let be=[we.layoutNormalBuffer,we.layoutCentroidBuffer,we.layoutColorBuffer];we.layoutFacadePaintBuffer&&(be=be.concat([we.layoutFacadeDataBuffer,we.layoutFacadeVerticalRangeBuffer,we.layoutFacadePaintBuffer])),xe.draw(n,w.gl.TRIANGLES,p.depthMode,ur.disabled,p.blendMode,A?mr.disabled:mr.backCW,le,f.id,we.layoutVertexBuffer,we.indexBuffer,Se,f.paint,n.transform.zoom,Z,be)}};n.uploadCommonUniforms(w,te,z.toUnwrapped(),null,V),W.buildingWithoutFacade&&me(W.buildingWithoutFacade,te),oe!==te&&n.uploadCommonUniforms(w,oe,z.toUnwrapped(),null,V),W.buildingWithFacade&&me(W.buildingWithFacade,oe)}}function vf(p){return[p[0]*i.ee,p[1]*i.ee,p[2]*i.ee,0]}function xf(p,n,c,f,y,x,w,A,C){const k=f.getSource(),L=c.globeSharedBuffers;if(!L)return;let V,z,G;if(n&&(V=f.getTile(n)),k instanceof i.aS?(z=k.texture,G=i.dG(0,0,c.transform)):V&&n&&(z=V.texture,G=i.dG(n.canonical.z,n.canonical.x,c.transform)),!z||!G)return;p||(G=i.cR(i.bC(),G,[1,-1,1]));const W=c.context,Z=W.gl,oe=y.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,te=c.colorModeForDrapableLayerRenderPass(x),le=w.defines;le.push("GLOBE_POLES");const fe=new Bt(Z.LEQUAL,Bt.ReadWrite,c.depthRangeFor3D),me=Float32Array.from(c.transform.expandedFarZProjMatrix),we=Float32Array.from(i.bk(i.dF(new i.cC(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),W.activeTexture.set(Z.TEXTURE0),z.bind(oe,Z.CLAMP_TO_EDGE),W.activeTexture.set(Z.TEXTURE1),z.bind(oe,Z.CLAMP_TO_EDGE),"useMipmap"in z&&W.extTextureFilterAnisotropic&&c.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const[xe,Se,be,ve]=n?L.getPoleBuffers(n.canonical.z,!1):L.getPoleBuffers(0,!0),Te=y.paint.get("raster-elevation");let qe;p?(qe=xe,c.renderDefaultNorthPole=Te!==0):(qe=Se,c.renderDefaultSouthPole=Te!==0);const je=vf(w.mix),tt=((et,Et,$e,Re,at,We,dt,At,Lt,xt,gt,Kt,Wt)=>cf(et,Et,$e,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},We,[0,0],At,2,xt,gt,Kt,1,0,Wt))(me,we,G,i.aj(c.transform.zoom),0,y,0,Te,0,je,w.offset,w.range,x),Ve=c.getOrCreateProgram("raster",{defines:le});c.uploadCommonUniforms(W,Ve,null),Ve.draw(c,Z.TRIANGLES,fe,C,te,A,tt,y.id,qe,be,ve)}function a1(p){const n=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-n,y=.2*p.height,x=n+y;return[n,c,(x-y-n)/f,(x-n)/f]}function bv(p,n,c,f){if(p)return n instanceof Xs&&p instanceof nh?n.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:vf(f.mix),offset:f.offset,buffer:0,tileSize:1}}var s1=i.ef([{name:"a_index",type:"Int16",components:1}]);class l1{constructor(n,c,f,y){const x={width:f[0],height:f[1],data:null},w=n.gl;this.targetColorTexture=new i.T(n,x,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(n,x,w.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(c,y),this.lastInvalidatedAt=0}updateParticleTexture(n,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,y=c.width*c.height;this.particleTexture0=new i.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1});const x=new i.eg;x.reserve(y);for(let w=0;w<y;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,s1.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function zo(p,n,c){if(!p)return null;const f=n.getTextureDescriptor(p,c,!0);if(!f)return null;let{texture:y,mix:x,offset:w,tileSize:A,buffer:C,format:k}=f;if(!y||!k)return null;let L=!1;return k==="uint32"&&(L=!0,x[3]=0,x=Xm(i.eh,x,[0,c.paint.get("raster-particle-max-speed")]),w=Km(i.eh,w,[0,c.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[C/(A+2*C),A/(A+2*C)],tileSize:A,scalarData:L,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function og(p){const n=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-n,y=.2*p.height,x=n+y;return[n,c,(x-y-n)/f,(x-n)/f]}const wo=new i.ao(1,0,0,1),ul=new i.ao(0,1,0,1),wv=new i.ao(0,0,1,1),ag=new i.ao(1,0,1,1),sg=new i.ao(0,1,1,1);function bf(p,n,c,f,y,x){for(let w=0;w<c.length;w++)if(y){const k=new i.ao(f.r*.8,f.g*.8,f.b*.8,1);Ql(p,n,c[w],f,-1,-1,x),Ql(p,n,c[w],f,-1,1,x),Ql(p,n,c[w],f,1,1,x),Ql(p,n,c[w],f,1,-1,x),Ql(p,n,c[w],k,0,0,x)}else Ql(p,n,c[w],f,0,0,x)}function Ql(p,n,c,f,y,x,w){const A=p.context,C=p.transform,k=A.gl,L=C.projection.name==="globe",V=L?["PROJECTION_GLOBE_VIEW"]:[];let z=i.bz(c.projMatrix);if(L&&i.aj(C.zoom)>0){const je=i.bj(c.canonical,C),tt=i.ei(je);z=i.aB(new Float32Array(16),C.globeMatrix,tt),i.aB(z,C.projMatrix,z)}const G=i.bC();G[12]+=2*y/(i.o.devicePixelRatio*C.width),G[13]+=2*x/(i.o.devicePixelRatio*C.height),i.aB(z,G,z);const W=p.getOrCreateProgram("debug",{defines:V}),Z=n.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(Z,W);const oe=Bt.disabled,te=ur.disabled,le=p.colorModeForRenderPass(),fe="$debug";A.activeTexture.set(k.TEXTURE0),p.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),L?Z._makeGlobeTileDebugBuffers(p.context,C):Z._makeDebugTileBoundsBuffers(p.context,C.projection);const me=Z._tileDebugBuffer||p.debugBuffer,we=Z._tileDebugIndexBuffer||p.debugIndexBuffer,xe=Z._tileDebugSegments||p.debugSegments;if(W.draw(p,k.LINE_STRIP,oe,te,le,mr.disabled,Zm(z,f.toPremultipliedRenderColor(null)),fe,me,we,xe,null,null,null,[Z._globeTileDebugBorderBuffer]),w){const je=Z.latestRawTileData,tt=Math.floor((je&&je.byteLength||0)/1024);let Ve=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ve+=` => ${c.overscaledZ}`),Ve+=` ${Z.state}`,Ve+=` ${tt}kb`,(function(et,Et){et.initDebugOverlayCanvas();const $e=et.debugOverlayCanvas,Re=et.context.gl,at=et.debugOverlayCanvas.getContext("2d");at.clearRect(0,0,$e.width,$e.height),at.shadowColor="white",at.shadowBlur=2,at.lineWidth=1.5,at.strokeStyle="white",at.textBaseline="top",at.font="bold 36px Open Sans, sans-serif",at.fillText(Et,5,5),at.strokeText(Et,5,5),et.debugOverlayTexture.update($e),et.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)})(p,Ve)}const Se=n.getTile(c).tileSize,be=512/Math.min(Se,512)*(c.overscaledZ/C.zoom)*.5,ve=Z._tileDebugTextBuffer||p.debugBuffer,Te=Z._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,qe=Z._tileDebugTextSegments||p.debugSegments;W.draw(p,k.TRIANGLES,oe,te,Ir.alphaBlended,mr.disabled,Zm(z,i.ao.transparent.toPremultipliedRenderColor(null),be),fe,ve,Te,qe,null,null,null,[Z._globeTileDebugTextBuffer])}function Ya(p,n,c,f){ec(p,0,n+c/2,p.transform.width,c,f)}function Cn(p,n,c,f){ec(p,n-c/2,0,c,p.transform.height,f)}function ec(p,n,c,f,y,x){const w=p.context,A=w.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*i.o.devicePixelRatio,c*i.o.devicePixelRatio,f*i.o.devicePixelRatio,y*i.o.devicePixelRatio),w.clear({color:x}),A.disable(A.SCISSOR_TEST)}const lg=i.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sv}=lg;function Ts(p,n,c,f){p.emplaceBack(n,c,f)}class cg{constructor(n){this.vertexArray=new i.ej,this.indices=new i.b1,Ts(this.vertexArray,-1,-1,1),Ts(this.vertexArray,1,-1,1),Ts(this.vertexArray,-1,1,1),Ts(this.vertexArray,1,1,1),Ts(this.vertexArray,-1,-1,-1),Ts(this.vertexArray,1,-1,-1),Ts(this.vertexArray,-1,1,-1),Ts(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Sv),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function tc(p,n,c,f,y,x){const w=p.context.gl,A=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),L=((V,z,G,W,Z)=>({u_matrix_3f:V,u_sun_direction:z,u_sun_intensity:G,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(i.el(i.dL(),f),y,k,A.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),c.draw(p,w.TRIANGLES,Bt.disabled,ur.disabled,Ir.unblended,mr.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const rc=i.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class nc{constructor(n){const c=new i.em;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const f=new i.b1;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,rc.members),this.indexBuffer=n.createIndexBuffer(f),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Tt=i.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Nt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class su{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Ir([1,Do,1,Do],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ir([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new Nt,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(n){const c=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new nc(c);const f=this.params.sizeRange,y=this.params.intensityRange,x=(function(L){const V=i.eo(30),z=[];for(let G=0;G<L;++G){const W=2*Math.PI*V(),Z=Math.acos(1-2*V())-.5*Math.PI;z.push(i.d4(Math.cos(Z)*Math.cos(W),Math.cos(Z)*Math.sin(W),Math.sin(Z)))}return z})(this.params.starsCount),w=i.eo(300),A=new i.en,C=new i.b1;let k=0;for(let L=0;L<x.length;++L){const V=i.c4([],x[L],200),z=Math.max(0,1+.01*f*(1*w()-.5)),G=Math.max(0,1+.01*y*(1*w()-.5));A.emplaceBack(V[0],V[1],V[2],-1,-1,z,G),A.emplaceBack(V[0],V[1],V[2],1,-1,z,G),A.emplaceBack(V[0],V[1],V[2],1,1,z,G),A.emplaceBack(V[0],V[1],V[2],-1,1,z,G),C.emplaceBack(k+0,k+1,k+2),C.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=c.createVertexBuffer(A,Tt.members),this.starsIdx=c.createIndexBuffer(C),this.starsSegments=i.bg.simpleSegment(0,0,A.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,c){const f=n.context,y=f.gl,x=n.transform,w=new Bt(y.LEQUAL,Bt.ReadOnly,[0,1]),A=i.aj(x.zoom),C=n.style.getLut(c.scope),k=c.properties.get("color-use-theme")==="none",L=c.properties.get("color").toNonPremultipliedRenderColor(k?null:C),V=c.properties.get("high-color-use-theme")==="none",z=c.properties.get("high-color").toNonPremultipliedRenderColor(V?null:C),G=c.properties.get("space-color-use-theme")==="none",W=c.properties.get("space-color").toNonPremultipliedRenderColor(G?null:C),Z=5e-4,oe=i.ep(c.properties.get("horizon-blend"),0,1,Z,.25),te=i.dA(n,f,x)&&oe===Z?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,le=n.frameCounter/1e3%1,fe=i.ag(x.globeCenterInViewSpace),me=Math.sqrt(Math.pow(fe,2)-Math.pow(te,2)),we=Math.acos(me/fe),xe=Se=>{const be=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&be.push("ALPHA_PASS");const ve=n.getOrCreateProgram("globeAtmosphere",{defines:be}),Te=((je,tt,Ve,et,Et,$e,Re,at,We,dt,At,Lt)=>({u_frustum_tl:je,u_frustum_tr:tt,u_frustum_br:Ve,u_frustum_bl:et,u_horizon:Et,u_transition:$e,u_fadeout_range:Re,u_atmosphere_fog_color:at.toArray01(),u_high_color:We.toArray01(),u_space_color:dt.toArray01(),u_temporal_offset:At,u_horizon_angle:Lt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,A,oe,L,z,W,le,we);n.uploadCommonUniforms(f,ve);const qe=this.atmosphereBuffer;qe&&ve.draw(n,y.TRIANGLES,w,ur.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mr.backCW,Te,Se?"atmosphere_glow_alpha":"atmosphere_glow",qe.vertexBuffer,qe.indexBuffer,qe.segments)};xe(!1),xe(!0)}drawStars(n,c){const f=i.aA(c.properties.get("star-intensity"),0,1);if(f===0)return;const y=n.context,x=y.gl,w=n.transform,A=n.getOrCreateProgram("stars"),C=i.c6([]);i.c8(C,C,-w._pitch),i.c7(C,C,-w.angle),i.c8(C,C,i.an(w._center.lat)),i.eq(C,C,-i.an(w._center.lng));const k=i.cb(new Float32Array(16),C),L=i.aB([],w.starsProjMatrix,k),V=i.el([],k),z=i.er([],V),G=[0,1,0];i.dN(G,G,z),i.c4(G,G,this.params.sizeMultiplier);const W=[1,0,0];i.dN(W,W,z),i.c4(W,W,this.params.sizeMultiplier);const Z=(oe=G,te=W,le=f,{u_matrix:Float32Array.from(L),u_up:oe,u_right:te,u_intensity_multiplier:le});var oe,te,le;n.uploadCommonUniforms(y,A),this.starsVx&&this.starsIdx&&A.draw(n,x.TRIANGLES,Bt.disabled,ur.disabled,this.colorModeAlphaBlendedWriteRGB,mr.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Xn{constructor(){this.visibleTiles=[]}updateBorders(n,c){const f=[],y=[],x=n._getRenderableCoordinates(!1,!0);for(const C of x){const k=n.getTile(C);if(!k.hasData())continue;const L=k.getBucket(c);L&&(L.isEmpty()||(f.push(C.key),y.push({bucket:L,tileID:C.canonical})))}let w=f.length!==this.visibleTiles.length;if(!w){f.sort();for(let C=0;C<f.length;C++)if(f[C]!==this.visibleTiles[C]){w=!0;break}}if(!w)return;const A=new Set;this.visibleTiles=f,y.sort(((C,k)=>C.tileID.z-k.tileID.z||C.tileID.x-k.tileID.x||C.tileID.y-k.tileID.y));for(const C of y){const k=new Array,L=new Array,V=C.bucket;for(const z of V.featuresOnBorder)A.has(z.featureId)?L.push(z.footprintIndex):(A.add(z.featureId),k.push(z.footprintIndex));V.updateFootprintHiddenFlags(k,i.es,!1),V.updateFootprintHiddenFlags(L,i.es,!0)}}}function Be(p,n){const c=[...p],f=n.cameraWorldSizeForFog/n.worldSize,y=i.bA([]);return i.cR(y,y,[f,f,1]),i.aB(c,y,c),i.aB(c,n.worldToFogMatrix,c),c}function wf(p,n,c,f,y){const x=c.material,w=f.context,{baseColorTexture:A,metallicRoughnessTexture:C}=x.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:L,emissionTexture:V}=x;function z(W,Z,oe){if(W&&(p.push(Z),w.activeTexture.set(w.gl.TEXTURE0+oe),W.gfxTexture)){const{minFilter:te,magFilter:le,wrapS:fe,wrapT:me}=W.sampler;W.gfxTexture.bindExtraParam(te,le,fe,me)}}z(A,"HAS_TEXTURE_u_baseColorTexture",pi.BaseColor),z(C,"HAS_TEXTURE_u_metallicRoughnessTexture",pi.MetallicRoughness),z(k,"HAS_TEXTURE_u_normalTexture",pi.Normal),z(L,"HAS_TEXTURE_u_occlusionTexture",pi.Occlusion),z(V,"HAS_TEXTURE_u_emissionTexture",pi.Emission),y&&(y.texture||(y.texture=new i.dY(f.context,y.image,[y.image.height,y.image.height,y.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+pi.LUT),y.texture&&y.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(c.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||p.push("DIFFUSE_SHADED");const G=f.shadowRenderer;G&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&p.push("NORMAL_OFFSET"))}function ic(p,n,c,f,y,x){const w=c.paint.get("model-opacity").constantOr(1),A=n.context,C=new Bt(n.context.gl.LEQUAL,Bt.ReadWrite,n.depthRangeFor3D),k=n.transform,L=p.mesh,V=L.material,z=V.pbrMetallicRoughness,G=n.style.fog;let W;W=n.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:i.aB([],f.zScaleMatrix,p.nodeModelMatrix),i.aB(W,f.negCameraPosMatrix,W);const Z=i.bl([],W);i.ed(Z,Z);const oe=c.paint.get("model-color-use-theme").constantOr("default")==="none",te=c.paint.get("model-emissive-strength").constantOr(0),le=ff(new Float32Array(p.worldViewProjection),new Float32Array(W),new Float32Array(Z),null,n,w,z.baseColorFactor,V.emissiveFactor,z.metallicFactor,z.roughnessFactor,V,te,c),fe={defines:[]},me=[],we=n.shadowRenderer;we&&(we.useNormalOffset=!1),wf(fe.defines,me,L,n,oe?null:c.lut);let xe=null;if(G){const ve=Be(p.nodeModelMatrix,n.transform);if(xe=new Float32Array(ve),k.projection.name!=="globe"){const Te=L.aabb.min,qe=L.aabb.max,[je,tt]=G.getOpacityForBounds(ve,Te[0],Te[1],qe[0],qe[1]);fe.overrideFog=je>=tr||tt>=tr}}const Se=tl(n,c.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const be=n.getOrCreateProgram("model",fe);n.uploadCommonUniforms(A,be,null,xe,Se),n.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(p.nodeModelMatrix,be),be.draw(n,A.gl.TRIANGLES,C,y,x,L.material.doubleSided?mr.disabled:mr.backCCW,le,c.id,L.vertexBuffer,L.indexBuffer,L.segments,c.paint,n.transform.zoom,void 0,me)}function Sf(p,n,c,f,y,x,w){let A;A=p.projection.name==="globe"?i.eu(c,p):[...c],i.aB(A,A,n.matrix);const C=i.aB([],f,A);if(n.meshes)for(const k of n.meshes){if(k.material.alphaMode!=="BLEND"){w.push({mesh:k,depth:0,modelIndex:y,worldViewProjection:C,nodeModelMatrix:A});continue}const L=i.af([],k.centroid,C);!p.isOrthographic&&L[2]<=0||x.push({mesh:k,depth:L[2],modelIndex:y,worldViewProjection:C,nodeModelMatrix:A})}if(n.children)for(const k of n.children)Sf(p,k,c,f,y,x,w)}function Th(p,n,c,f){const y=c.shadowRenderer;if(!y)return;const x=y.getShadowPassDepthMode(),w=y.getShadowPassColorMode(),A=y.calculateShadowPassMatrixFromMatrix(n),C=ou(A);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,x,ur.disabled,w,mr.backCCW,C,f.id,p.vertexBuffer,p.indexBuffer,p.segments,f.paint,c.transform.zoom,void 0,void 0)}function Tv(p,n,c){const f=n.updateZoomBasedPaintProperties(),y=(function(x,w,A){let C,k,L,V=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&V>0){const z=x.terrain,G=z.findDEMTileFor(A);G&&G.dem?C=i.ew.create(z,A,G):V=0}if(V===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),V===w.validForExaggeration&&(V===0||C&&C._demTile&&C._demTile.tileID===w.validForDEMTile.id&&C._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const z in w.instancesPerModel){const G=w.instancesPerModel[z];for(let W=0;W<G.instancedDataArray.length;++W){const Z=(C?V*C.getElevationAt(0|G.instancedDataArray.float32[16*W],0|G.instancedDataArray.float32[16*W+1],!0,!0):0)+G.instancesEvaluatedElevation[W];G.instancedDataArray.float32[16*W+6]=Z,k=k?Math.min(w.terrainElevationMin,Z):Z,L=L?Math.max(w.terrainElevationMax,Z):Z}}return w.terrainElevationMin=k||0,w.terrainElevationMax=L||0,w.validForExaggeration=V,w.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0})(p,n,c);(f||y)&&(n.uploaded=!1,n.upload(p.context))}const Ea={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function lu(p,n){const c=1<<p.canonical.z,f=n.getFreeCameraOptions().position,y=n.elevation,x=p.canonical.x/c,w=(p.canonical.x+1)/c,A=p.canonical.y/c,C=(p.canonical.y+1)/c;let k=n._centerAltitude;if(y){const G=y.getMinMaxForTile(p);G&&G.max>k&&(k=G.max)}const L=i.aA(f.x,x,w)-f.x,V=i.aA(f.y,A,C)-f.y,z=i.ce(k,n.center.lat)-f.z;return n._zoomFromMercatorZ(Math.sqrt(L*L+V*V+z*z))}function Av(p,n,c,f,y,x,w){const A=p.context,C=p.renderPass==="shadow",k=p.shadowRenderer,L=C&&k?k.getShadowPassDepthMode():new Bt(A.gl.LEQUAL,Bt.ReadWrite,p.depthRangeFor3D),V=p.isTileAffectedByFog(x);if(c.meshes)for(const z of c.meshes){const G=["MODEL_POSITION_ON_GPU"],W=[];let Z,oe,te;f.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const le=tl(p,n.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),C&&k)Z=p.getOrCreateProgram("modelDepth",{defines:G}),oe=ou(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(c.matrix)),te=k.getShadowPassColorMode();else{wf(G,W,z,p,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),Z=p.getOrCreateProgram("model",{defines:G,overrideFog:V});const me=z.material,we=me.pbrMetallicRoughness,xe=n.paint.get("model-opacity").constantOr(1),Se=n.paint.get("model-emissive-strength").constantOr(0);oe=ff(x.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,p,xe,we.baseColorFactor,me.emissiveFactor,we.metallicFactor,we.roughnessFactor,me,Se,n,y),k&&(w.shadowUniformsInitialized?Z.setShadowUniformValues(A,k.getShadowUniformValues()):(k.setupShadows(x.toUnwrapped(),Z,"model-tile"),w.shadowUniformsInitialized=!0)),te=le.shouldRenderCutoff||xe<1||me.alphaMode!=="OPAQUE"?Ir.alphaBlended:Ir.unblended}p.uploadCommonUniforms(A,Z,x.toUnwrapped(),null,le);const fe=z.material.doubleSided?mr.disabled:mr.backCCW;if(f.instancedDataArray.length>20)W.push(f.instancedDataBuffer),Z.draw(p,A.gl.TRIANGLES,L,ur.disabled,te,fe,oe,n.id,z.vertexBuffer,z.indexBuffer,z.segments,n.paint,p.transform.zoom,void 0,W,f.instancedDataArray.length);else{const me=C?"u_instance":"u_normal_matrix";for(let we=0;we<f.instancedDataArray.length;++we)oe[me]=new Float32Array(f.instancedDataArray.arrayBuffer,64*we,16),Z.draw(p,A.gl.TRIANGLES,L,ur.disabled,te,fe,oe,n.id,z.vertexBuffer,z.indexBuffer,z.segments,n.paint,p.transform.zoom,void 0,W)}}if(c.children)for(const z of c.children)Av(p,n,z,f,y,x,w)}const c1=[1,-1,1];function Ev(p,n,c,f){if(!c.modelManager)return!0;const y=c.modelManager;if(!c.shadowRenderer)return!0;const x=c.shadowRenderer,w=n.aabb;let A=!0,C=p.maxHeight;if(C===0){let L=0;for(const V in p.instancesPerModel){const z=y.getModel(V,f);z?L=Math.max(L,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):A=!1}C=p.maxScale*L*1.41+p.maxVerticalOffset,A&&(p.maxHeight=C)}w.max[2]=C,w.min[2]+=p.terrainElevationMin,w.max[2]+=p.terrainElevationMax,i.af(w.min,w.min,n.tileMatrix),i.af(w.max,w.max,n.tileMatrix);const k=w.intersects(x.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=k===2),k===0}function Tf(p,n){const c=p.uniformValues.u_cutoff_params[0],f=p.uniformValues.u_cutoff_params[1],y=p.uniformValues.u_cutoff_params[2],x=p.uniformValues.u_cutoff_params[3];return f===c||x===y?1:i.aA(((n-c)/(f-c)-y)/(x-y),0,1)}function ug(p,n,c,f){if(n.pitch<20)return 1;const y=n.getWorldToCameraMatrix();i.aB(y,y,p);const x=i.bU(c.min[0],c.min[1],c.min[2],1);let w=i.aC(i.ex(),x,y),A=w,C=w;x[1]=c.max[1],w=i.aC(i.ex(),x,y),A=w[1]<A[1]?w:A,C=w[1]>C[1]?w:C,x[0]=c.max[0],w=i.aC(i.ex(),x,y),A=w[1]<A[1]?w:A,C=w[1]>C[1]?w:C,x[1]=c.min[1],w=i.aC(i.ex(),x,y),A=w[1]<A[1]?w:A,C=w[1]>C[1]?w:C;const k=i.aA(f[0],0,1),L=100*n.pixelsPerMeter*i.aA(f[1],0,1),V=i.aA(f[2],0,1),z=i.ey(i.ex(),A,C,k),G=Math.tan(.5*n.fovX),W=-z[2]*G;if(L===0)return z[1]<-Math.abs(W)?V:1;const Z=(-Math.abs(W)-z[1])/L,oe=(le,fe,me)=>(1-me)*le+me*fe,te=i.aA(oe(1,V,Z),V,1);return oe(1,te,i.aA((n.pitch-20)/20,0,1))}class Pv{}class Iv{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,c,f){{const V=this._storage.get(c.id);if(V)return V.lastUsedFrameIdx=n,V.buf}const y=f.gl,x=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),w=new ArrayBuffer(x),A=new Int16Array(w);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const C=new i.eA;for(let V=0;V<x/2;V+=3){const z=A[V],G=A[V+1],W=A[V+2];C.emplaceBack(z,G),C.emplaceBack(G,W),C.emplaceBack(W,z)}const k=f.bindVertexArrayOES.current,L=new Pv;return L.buf=new al(f,C),L.lastUsedFrameIdx=n,this._storage.set(c.id,L),f.bindVertexArrayOES.set(k),L.buf}update(n){for(const[c,f]of this._storage)n-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(c))}destroy(){for(const[n,c]of this._storage)c.buf.destroy(),this._storage.delete(n)}}class Af{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ah=i.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class cu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class hg{constructor(n,c){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Cv=i.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class u1{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,c){const f=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new i.eB,A=new i.b1;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),A.emplaceBack(0,1,2),A.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(w,Cv.members),this.vignetteIdx=n.context.createIndexBuffer(A)}const y=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,f);const w={u_vignetteShape:(x={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};f.draw(n,n.context.gl.TRIANGLES,Bt.disabled,ur.disabled,Ir.alphaBlended,mr.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,y)}var x}}class Ov{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,c){const f=n.getFreeCameraOptions().position,y=f.toAltitude(),x=f.toLngLat(),w=i.an(x.lng),A=i.an(x.lat),C=n.pixelsPerMeter/c,k=w*i.eD,L=i.eD*Math.log(Math.tan(Math.PI/4+A/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+L,z=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*C,this._accumulatedOffsetY+=V*C,this._accumulatedElevation+=z*C,this._offsetXPrev=k,this._offsetYPrev=L,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Mv(p,n){return[-(p[0]-Math.floor(p[0]/n)*n),-(p[1]-Math.floor(p[1]/n)*n),-(p[2]-Math.floor(p[2]/n)*n)]}function lo(p){const n=i.eo(1323123451230),c=[];for(let f=0;f<p;++f){const y=2*n()-1,x=2*n()-1,w=2*n()-1;c.push(i.d4(y,x,w))}return c}function hl(p,n,c,f,y){const x=i.aA((y-c)/(f-c),0,1);return(1-x)*p+x*n}class uu{constructor(n){this._movement=new Ov,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new u1,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,c){const f=n.transform;this._movement.update(f,this._ppmScaleFactor);const y=f.starsProjMatrix,x=i.c6([]);i.c8(x,x,i.an(90)-f._pitch),i.c7(x,x,-f.angle);const w=i.cb(new Float32Array(16),x),A=i.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=i.ed([],A),k=i.aB([],C,w),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*c,this._prevTime=L,{projectionMatrix:y,modelviewMatrix:k}}}class jn extends uu{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new hg(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const f=lo(this.particlesCount),y=new i.eE,x=new i.b1;let w=0;const A=i.eo(1323123451230);for(let C=0;C<f.length;++C){const k=f[C],L=[2*A()-1,A(),A(),A()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...L),y.emplaceBack(k[0],k[1],k[2],1,-1,...L),y.emplaceBack(k[0],k[1],k[2],1,1,...L),y.emplaceBack(k[0],k[1],k[2],-1,1,...L),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=c.createVertexBuffer(y,Ah.members),this.particlesIdx=c.createIndexBuffer(x)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=n.transform.zoom;if(c.revealStart>f)return;const y=hl(0,1,c.revealStart,c.revealStart+c.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let w=[-x.direction.x,x.direction.y,-100];i.aw(w,w);const A=structuredClone(this._vignetteParams);A.strength*=y,x.overrideStyleParameters||(x.intensity=n.style.rain.state.density,x.timeFactor=n.style.rain.state.intensity,x.color=structuredClone(n.style.rain.state.color),w=structuredClone(n.style.rain.state.direction),x.screenThinning.intensity=n.style.rain.state.centerThinning,x.dropletSizeX=n.style.rain.state.dropletSize[0],x.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],x.distortionStrength=100*n.style.rain.state.distortionStrength,A.strength=1,A.color=structuredClone(n.style.rain.state.vignetteColor));const C=this.updateOnRender(n,x.timeFactor),k=n.context,L=k.gl,V=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new i.T(k,{width:n.width,height:n.height,data:null},L.RGBA8)),x.distortionStrength>0&&(k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const z=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(k,z),k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const G=[x.color.r,x.color.g,x.color.b,x.color.a],W=(Z,oe)=>{const te=Mv(this._movement.getPosition(),Z),le=x.dropletSizeX,fe=x.dropletSizeX*x.dropletSizeYScale,me=n.width/2,we=n.height/2,xe=hl(0,x.screenThinning.start,0,1,x.screenThinning.intensity),Se=hl(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),be=hl(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),ve=(Te={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:Z,rainDropletSize:[le,fe],distortionStrength:x.distortionStrength,rainDirection:w,color:G,screenSize:[V.width,V.height],thinningCenterPos:[me,we],thinningShape:[xe,Se,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_texScreen:0,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_boxSize:Te.boxSize,u_rainDropletSize:Te.rainDropletSize,u_distortionStrength:Te.distortionStrength,u_rainDirection:Te.rainDirection,u_color:Te.color,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_shapeDirectionalPower:Te.shapeDirectionalPower,u_shapeNormalPower:Te.shapeNormalPower,u_mode:Te.mode});var Te;const qe=Math.round(x.intensity*this.particlesCount),je=i.bg.simpleSegment(0,0,4*qe,2*qe);z.draw(n,L.TRIANGLES,Bt.disabled,ur.disabled,Ir.alphaBlended,mr.disabled,ve,"rain_particles",this.particlesVx,this.particlesIdx,je)};x.distortionStrength>0&&W(x.boxSize,!0),W(x.boxSize,!1),this._vignette.draw(n,A)}}const qr=i.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Rv extends uu{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new hg(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const f=lo(this.particlesCount),y=new i.eF,x=new i.b1;let w=0;const A=i.eo(1323123451230);for(let C=0;C<f.length;++C){const k=f[C],L=A(),V=A(),z=A(),G=[C/f.length,L,V,z],W=[A(),A()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...G,...W),y.emplaceBack(k[0],k[1],k[2],1,-1,...G,...W),y.emplaceBack(k[0],k[1],k[2],1,1,...G,...W),y.emplaceBack(k[0],k[1],k[2],-1,1,...G,...W),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=c.createVertexBuffer(y,qr.members),this.particlesIdx=c.createIndexBuffer(x)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const c=structuredClone(this._params);let f=[-c.direction.x,c.direction.y,-100];i.aw(f,f);const y=structuredClone(this._vignetteParams),x=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=n.transform.zoom;if(x.revealStart>w)return;const A=hl(0,1,x.revealStart,x.revealStart+x.revealRange,w);y.strength*=A,c.overrideStyleParameters||(c.intensity=n.style.snow.state.density,c.timeFactor=n.style.snow.state.intensity,c.color=structuredClone(n.style.snow.state.color),f=structuredClone(n.style.snow.state.direction),c.screenThinning.intensity=n.style.snow.state.centerThinning,c.billboardSize=2.79*n.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(n.style.snow.state.vignetteColor));const C=this.updateOnRender(n,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=n.context,L=k.gl,V=n.transform,z=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(k,z),((G,W,Z)=>{const oe=Mv(this._movement.getPosition(),G),te=V.width/2,le=V.height/2,fe=hl(0,Z.screenThinning.start,0,1,Z.screenThinning.intensity),me=hl(.001,Z.screenThinning.range,0,1,Z.screenThinning.intensity),we=hl(0,Z.screenThinning.particleOffset,0,1,Z.screenThinning.intensity),xe=(Se={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:Z.velocityConeAperture,velocity:Z.velocity,horizontalOscillationRadius:Z.horizontalOscillationRadius,horizontalOscillationRate:Z.horizontalOscillationRate,boxSize:G,billboardSize:1*Z.billboardSize,simpleShapeParameters:[Z.shapeFadeStart,Z.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[te,le],thinningShape:[fe,me,Math.pow(10,Z.screenThinning.fadePower)],thinningAffectedRatio:Z.screenThinning.affectedRatio,thinningParticleOffset:we,color:[Z.color.r,Z.color.g,Z.color.b,Z.color.a],direction:f},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_horizontalOscillationRadius:Se.horizontalOscillationRadius,u_horizontalOscillationRate:Se.horizontalOscillationRate,u_boxSize:Se.boxSize,u_billboardSize:Se.billboardSize,u_simpleShapeParameters:Se.simpleShapeParameters,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_particleColor:Se.color,u_direction:Se.direction});var Se;const be=Math.round(Z.intensity*this.particlesCount),ve=i.bg.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&z.draw(n,L.TRIANGLES,Bt.disabled,ur.disabled,Ir.alphaBlended,mr.disabled,xe,"snow_particles",this.particlesVx,this.particlesIdx,ve)})(c.boxSize,0,c),this._vignette.draw(n,y)}}const dl={symbol:function(p,n,c,f,y){if(p.renderPass!=="translucent")return;const x=ur.disabled,w=p.colorModeForRenderPass(),A=c.layout.get("text-variable-anchor"),C=c.layout.get("text-size-scale-range"),k=i.aA(p.scaleFactor,C[0],C[1]);A&&(function(z,G,W,Z,oe,te,le,fe){const me=G.transform,we=oe==="map",xe=te==="map";for(const Se of z){const be=Z.getTile(Se),ve=be.getBucket(W);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const Te=i.bK(ve.textSizeData,me.zoom,fe),qe=Bl(Se,ve.getProjection(),me),je=me.calculatePixelsToTileUnitsMatrix(be),tt=wa(qe,be.tileID.canonical,xe,we,me,ve.getProjection(),je),Ve=ve.hasIconTextFit()&&ve.hasIconData();Te&&gf(ve,we,xe,le,me,tt,Se,Math.pow(2,me.zoom-be.tileID.overscaledZ),Te,Ve)}})(f,p,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y,k);const L=c.paint.get("icon-opacity").constantOr(1)!==0,V=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||V)?Sh(p,n,c,f,x,w):(L&&Sh(p,n,c,f,x,w,{onlyIcons:!0}),V&&Sh(p,n,c,f,x,w,{onlyText:!0})),n.map.showCollisionBoxes&&(wh(p,n,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),wh(p,n,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,c,f){if(p.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),w=c.paint.get("circle-stroke-opacity"),A=c.layout.get("circle-sort-key").constantOr(1)!==void 0,C=c.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;const k=p.context,L=k.gl,V=p.transform,z=!(!p.terrain||!p.terrain.enabled),G=c.layout.get("circle-elevation-reference"),W=p.depthModeForSublayer(0,Bt.ReadOnly),Z=new Bt(p.context.gl.LEQUAL,Bt.ReadOnly,p.depthRangeFor3D),oe=G==="none"||z?W:Z,te=ur.disabled,le=p.colorModeForDrapableLayerRenderPass(C),fe=V.projection.name==="globe",me=[i.aF(V.center.lng),i.aJ(V.center.lat)],we=[];for(let Se=0;Se<f.length;Se++){const be=f[Se],ve=n.getTile(be),Te=ve.getBucket(c);if(!Te||Te.projection.name!==V.projection.name)continue;const qe=Te.programConfigurations.get(c.id),je=Te.layoutVertexBuffer,tt=Te.globeExtVertexBuffer,Ve=Te.indexBuffer,et=i.dZ(c),Et=[tt],$e=p.isTileAffectedByFog(be);fe&&et.push("PROJECTION_GLOBE_VIEW"),et.push("DEPTH_D24"),p.terrain&&V.depthOcclusionForSymbolsAndCircles&&et.push("DEPTH_OCCLUSION"),Te.hasElevation&&!p.terrain&&(et.push("ELEVATED_ROADS"),Et.push(Te.elevatedLayoutVertexBuffer));const Re=p.getOrCreateProgram("circle",{config:qe,defines:et,overrideFog:$e}),at=V.projection.createInversionMatrix(V,be.canonical),We={programConfiguration:qe,program:Re,layoutVertexBuffer:je,dynamicBuffers:Et,indexBuffer:Ve,uniformValues:i.d_(p,be,ve,at,me,c),tile:ve};if(A){const dt=Te.segments.get();for(const At of dt)we.push({segments:new i.bg([At]),sortKey:At.sortKey,state:We})}else we.push({segments:Te.segments,sortKey:0,state:We})}A&&we.sort(((Se,be)=>Se.sortKey-be.sortKey));const xe={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const Se of we){const{programConfiguration:be,program:ve,layoutVertexBuffer:Te,dynamicBuffers:qe,indexBuffer:je,uniformValues:tt,tile:Ve}=Se.state,et=Se.segments;p.terrain&&p.terrain.setupElevationDraw(Ve,ve,xe),p.uploadCommonUniforms(k,ve,Ve.tileID.toUnwrapped()),ve.draw(p,L.TRIANGLES,oe,te,le,mr.disabled,tt,c.id,Te,je,et,c.paint,V.zoom,be,qe)}},heatmap:function(p,n,c,f){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const y=p.context,x=y.gl,w=ur.disabled,A=new Ir([x.ONE,x.ONE,x.ONE,x.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(G,W,Z,oe){const te=G.gl,le=W.width*oe,fe=W.height*oe;G.activeTexture.set(te.TEXTURE1),G.viewport.set([0,0,le,fe]);let me=Z.heatmapFbo;if(!me||me&&(me.width!==le||me.height!==fe)){me&&me.destroy();const we=te.createTexture();te.bindTexture(te.TEXTURE_2D,we),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),me=Z.heatmapFbo=G.createFramebuffer(le,fe,!0,null),(function(xe,Se,be,ve,Te,qe){const je=xe.gl;je.texImage2D(je.TEXTURE_2D,0,xe.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Te,qe,0,je.RGBA,xe.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),ve.colorAttachment.set(be)})(G,0,we,me,le,fe)}else te.bindTexture(te.TEXTURE_2D,me.colorAttachment.get()),G.bindFramebuffer.set(me.framebuffer)})(y,p,c,p.transform.projection.name==="globe"?.5:.25),y.clear({color:i.ao.transparent});const C=p.transform,k=C.projection.name==="globe",L=k?["PROJECTION_GLOBE_VIEW"]:[],V=k?mr.frontCCW:mr.disabled,z=[i.aF(C.center.lng),i.aJ(C.center.lat)];for(let G=0;G<f.length;G++){const W=f[G];if(n.hasRenderableParent(W))continue;const Z=n.getTile(W),oe=Z.getBucket(c);if(!oe||oe.projection.name!==C.projection.name)continue;const te=p.isTileAffectedByFog(W),le=oe.programConfigurations.get(c.id),fe=p.getOrCreateProgram("heatmap",{config:le,defines:L,overrideFog:te}),{zoom:me}=p.transform;p.terrain&&p.terrain.setupElevationDraw(Z,fe),p.uploadCommonUniforms(y,fe,W.toUnwrapped());const we=C.projection.createInversionMatrix(C,W.canonical);fe.draw(p,x.TRIANGLES,Bt.disabled,w,A,V,_v(p,W,Z,we,z,me,c.paint.get("heatmap-intensity")),c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,p.transform.zoom,le,k?[oe.globeExtVertexBuffer]:null)}y.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(y,x){const w=y.context,A=w.gl,C=x.heatmapFbo;if(!C)return;w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(A.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new i.T(w,x.colorRamp,A.RGBA8)),k.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,A.TRIANGLES,Bt.disabled,ur.disabled,y.colorModeForRenderPass(),mr.disabled,((L,V,z,G)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)})(p,c))},line:function(p,n,c,f){if(p.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const w=c.paint.get("line-emissive-strength"),A=c.paint.get("line-occlusion-opacity"),C=c.layout.get("line-elevation-reference"),k=c.layout.get("line-width-unit")==="meters",L=C==="sea",V=!(!p.terrain||!p.terrain.enabled),z=p.context,G=z.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const W=c.layout.get("line-cross-slope"),Z=W!==void 0,oe=W<1,te=p.colorModeForDrapableLayerRenderPass(w),le=p.terrain&&p.terrain.renderingToTexture,fe=le?1:i.o.devicePixelRatio,me=c.paint.get("line-dasharray"),we=me.constantOr(1),xe=c.layout.get("line-cap"),Se=me.constantOr(null),be=xe.constantOr(null),ve=c.paint.get("line-pattern"),Te=ve.constantOr(1),qe=c.paint.get("line-pattern-cross-fade"),je=ve.constantOr(null),tt=c.paint.get("line-opacity").constantOr(1);let Ve=!Te&&tt!==1||p.depthOcclusion&&A>0&&A<1;const et=c.paint.get("line-gradient"),Et=Te?"linePattern":"line",$e=i.d$(c);let Re;if(le&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(Ve=!1),A!==0&&p.depthOcclusion){const At=c.paint._values["line-opacity"];At&&At.value&&At.value.kind==="constant"?Re=At.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&$e.push("VARIABLE_LINE_WIDTH");const at=(At,Lt,xt,gt,Kt,Wt)=>{for(const Xt of At){const Ht=n.getTile(Xt);if(Te&&!Ht.patternsLoaded())continue;const gr=Ht.getBucket(c);if(!gr||gr.elevationType!=="none"&&!Kt||gr.elevationType==="none"&&Kt)continue;p.prepareDrawTile();const Ar=[...Lt],Cr=p.shadowRenderer,hn=gr.elevationType==="road"&&!!Cr&&Cr.enabled;let vr=[0,0,0];if(hn){const Or=p.style.directionalLight,hr=p.style.ambientLight;Or&&hr&&(vr=Aa(p.style,Or,hr)),Ar.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Yr=gr.programConfigurations.get(c.id);let ln=!1;if(je&&Ht.imageAtlas){const Or=i.e0.from(je),hr=Or.getPrimary().scaleSelf(fe).toString(),dn=Ht.imageAtlas.patternPositions.get(hr),Kn=Or.getSecondary(),$n=Kn?Ht.imageAtlas.patternPositions.get(Kn.scaleSelf(fe).toString()):null;ln=!!dn&&!!$n,dn&&Yr.setConstantPatternPositions(dn,$n)}qe>0&&(ln||Yr.getPatternTransitionVertexBuffer("line-pattern"))&&Ar.push("LINE_PATTERN_TRANSITION");const zn=p.isTileAffectedByFog(Xt),Er=p.getOrCreateProgram(Et,{config:Yr,defines:Ar,overrideFog:zn});if(!Te&&Se&&be&&Ht.lineAtlas){const Or=Ht.lineAtlas.getDash(Se,be);Or&&Yr.setConstantPatternPositions(Or)}hn&&Cr.setupShadows(Ht.tileID.toUnwrapped(),Er,"vector-tile");let[tn,Qr]=c.paint.get("line-trim-offset");(be==="round"||be==="square")&&tn!==Qr&&(tn===0&&(tn-=1),Qr===1&&(Qr+=1));const on=le?Xt.projMatrix:null,Bn=k?1/gr.tileToMeter/i.ay(Ht,1,p.transform.zoom):1,oi=k?1/gr.tileToMeter/i.ay(Ht,1,Math.floor(p.transform.zoom)):1,ji=Te?i.e1(p,Ht,c,on,fe,Bn,oi,[tn,Qr],vr,qe):i.e2(p,Ht,c,on,gr.lineClipsArray.length,fe,Bn,oi,[tn,Qr],vr);if(et){const Or=gr.gradients[c.id];let hr=Or.texture;if(c.gradientVersion!==Or.version){let dn=256;if(c.stepInterpolant){const Kn=n.getSource().maxzoom,$n=Xt.canonical.z===Kn?Math.ceil(1<<p.transform.maxZoom-Xt.canonical.z):1;dn=i.aA(i.e3(gr.maxLineLength/i.al*1024*$n),256,z.maxTextureSize)}Or.gradient=i.e4({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:dn,image:Or.gradient||void 0,clips:gr.lineClipsArray}),Or.texture?Or.texture.update(Or.gradient):Or.texture=new i.T(z,Or.gradient,G.RGBA8),Or.version=c.gradientVersion,hr=Or.texture}z.activeTexture.set(G.TEXTURE1),hr.bind(c.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}we&&(z.activeTexture.set(G.TEXTURE0),Ht.lineAtlasTexture&&Ht.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),Yr.updatePaintBuffers()),Te&&(z.activeTexture.set(G.TEXTURE0),Ht.imageAtlasTexture&&Ht.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Yr.updatePaintBuffers()),Kt&&!L&&p.terrain.setupElevationDraw(Ht,Er),p.uploadCommonUniforms(z,Er,Xt.toUnwrapped());const Un=Or=>{Re!=null&&(Re.value=tt*A),Er.draw(p,G.TRIANGLES,xt,Or,te,mr.disabled,ji,c.id,gr.layoutVertexBuffer,gr.indexBuffer,gr.segments,c.paint,p.transform.zoom,Yr,[gr.layoutVertexBuffer2,gr.patternVertexBuffer,gr.zOffsetVertexBuffer]),Re!=null&&(Re.value=tt)};if(Ve&&!Kt){const Or=p.stencilModeForClipping(Xt).ref;Or===0&&le&&z.clear({stencil:0});const hr={func:G.EQUAL,mask:255};ji.u_alpha_discard_threshold=.8,Un(new ur(hr,Or,255,G.KEEP,G.KEEP,G.INVERT)),ji.u_alpha_discard_threshold=0,Un(new ur(hr,Or,255,G.KEEP,G.KEEP,G.KEEP))}else ji.u_alpha_discard_threshold=Ve&&Kt&&Wt?.8:0,Un(Kt?gt:p.stencilModeForClipping(Xt))}};let We=p.depthModeForSublayer(0,Bt.ReadOnly);const dt=new Bt(p.depthOcclusion?G.GREATER:G.LEQUAL,Bt.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){const At=!le&&p.terrain;A!==0&&At?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):At?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):at(f,$e,We,ur.disabled,!1,!0)}if(c.hasElevatedBuckets){C==="hd-road-markup"?V||(We=dt,$e.push("ELEVATED_ROADS")):($e.push("ELEVATED"),We=dt,Z&&$e.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&$e.push("ELEVATION_REFERENCE_SEA"));const At=Ve?p.stencilModeFor3D():ur.disabled;p.forceTerrainMode=!0,at(f,$e,We,At,!0,!0),Ve&&at(f,$e,We,At,!0,!1),p.forceTerrainMode=!1}Ve&&(p.resetStencilClippingMasks(),le&&z.clear({stencil:0})),A===0||p.depthOcclusion||le||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,n,c,f){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const w=c.paint.get("fill-emissive-strength"),A=p.colorModeForDrapableLayerRenderPass(w),C=c.paint.get("fill-pattern"),k=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&y.constantOr(i.ao.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let L="none";c.layout.get("fill-elevation-reference")!=="none"?L="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const V=!(!p.terrain||!p.terrain.enabled),z={painter:p,sourceCache:n,layer:c,coords:f,colorMode:A,elevationType:L,terrainEnabled:V,pass:k};if(p.renderPass!=="shadow")if(L!=="offset"){if(au(z,!1),L==="road"){const G=!V&&p.renderPass==="translucent";G&&Jl(p,n,c,f,"geometry"),au(z,!0,ur.disabled),G&&(function(W){const{painter:Z,sourceCache:oe,layer:te,coords:le,colorMode:fe}=W,me=Z.context.gl,we=W.painter.shadowRenderer,xe=!!we&&we.enabled,Se=new Bt(Z.context.gl.LEQUAL,Bt.ReadOnly,Z.depthRangeFor3D);let be=[0,0,0];if(xe){const Te=Z.style.directionalLight,qe=Z.style.ambientLight;Te&&qe&&(be=Aa(Z.style,Te,qe))}const ve=Te=>{for(const qe of le){const je=oe.getTile(qe),tt=je.getBucket(te);if(!tt)continue;const Ve=tt.elevatedStructures;if(!Ve)continue;let et,Et;if(Te?(et=Ve.renderableBridgeSegments,Et=Ve.bridgeProgramConfigurations.get(te.id)):(et=Ve.renderableTunnelSegments,Et=Ve.tunnelProgramConfigurations.get(te.id)),!et||et.segments[0].primitiveLength===0)continue;Et.updatePaintBuffers(),Z.prepareDrawTile();const $e=Z.isTileAffectedByFog(qe),Re=[];xe&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const at=Z.getOrCreateProgram("elevatedStructures",{config:Et,overrideFog:$e,defines:Re}),We=Z.translatePosMatrix(qe.projMatrix,je,te.paint.get("fill-translate"),te.paint.get("fill-translate-anchor"));xe&&we.setupShadows(je.tileID.toUnwrapped(),at,"vector-tile");const dt=t1(We,be);Z.uploadCommonUniforms(Z.context,at,qe.toUnwrapped()),at.draw(Z,me.TRIANGLES,Se,ur.disabled,fe,mr.backCCW,dt,te.id,Ve.vertexBuffer,Ve.indexBuffer,et,te.paint,Z.transform.zoom,Et,[Ve.vertexBufferNormal])}};ve(!0),ve(!1)})(z)}}else au(z,!1,p.stencilModeFor3D());else p.shadowRenderer&&L==="road"&&!V&&(function(G){const{painter:W,sourceCache:Z,layer:oe,coords:te}=G,le=W.context.gl,fe=G.painter.shadowRenderer;for(const me of te){const we=Z.getTile(me),xe=we.getBucket(oe);if(!xe)continue;const Se=xe.elevatedStructures;if(!Se||!Se.shadowCasterSegments||Se.shadowCasterSegments.segments[0].primitiveLength===0)continue;W.prepareDrawTile();const be=xe.bufferData.programConfigurations.get(oe.id),ve=W.isTileAffectedByFog(me),Te=W.getOrCreateProgram("elevatedStructuresDepth",{config:be,overrideFog:ve}),qe=fe.calculateShadowPassMatrixFromTile(we.tileID.toUnwrapped());W.uploadCommonUniforms(W.context,Te,me.toUnwrapped());const je={u_matrix:qe,u_depth_bias:0};Te.draw(W,le.TRIANGLES,fe.getShadowPassDepthMode(),ur.disabled,fe.getShadowPassColorMode(),mr.disabled,je,oe.id,Se.vertexBuffer,Se.indexBuffer,Se.shadowCasterSegments,oe.paint,W.transform.zoom,be)}})(z)},"fill-extrusion":function(p,n,c,f){const y=c.paint.get("fill-extrusion-opacity"),x=p.context,w=x.gl,A=p.terrain,C=A&&A.renderingToTexture;if(y===0)return;const k=p.conflationActive&&p.style.isLayerClipped(c,n.getSource()),L=p.style.order.indexOf(c.fqid);if(k&&(function(V,z,G,W,Z){for(const oe of W){const te=z.getTile(oe).getBucket(G);te&&(te.updateReplacement(oe,V.replacementSource,Z),te.uploadCentroid(V.context))}})(p,n,c,f,L),A||k)for(const V of f){const z=n.getTile(V).getBucket(c);z&&ll(p.context,n,V,z,c,A,k)}if(p.renderPass==="shadow"&&p.shadowRenderer){const V=p.shadowRenderer;if(A&&y<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const z=V.getShadowPassDepthMode(),G=V.getShadowPassColorMode();Ut(p,n,c,f,z,ur.disabled,G,k)}else if(p.renderPass==="translucent"){const V=!c.paint.get("fill-extrusion-pattern").constantOr(1),z=c.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!C&&z.a!==0){const G=new Bt(p.context.gl.LEQUAL,Bt.ReadWrite,p.depthRangeFor3D);y===1&&V?Ut(p,n,c,f,G,ur.disabled,Ir.unblended,k):(Ut(p,n,c,f,G,ur.disabled,Ir.disabled,k),Ut(p,n,c,f,G,p.stencilModeFor3D(),p.colorModeForRenderPass(),k),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&V&&(!A&&p.transform.projection.name!=="globe"||C)){const G=c.paint.get("fill-extrusion-opacity"),W=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=c.paint.get("fill-extrusion-flood-light-intensity"),te=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",le=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(te?null:c.lut).toArray01().slice(0,3),fe=W>0&&Z>0,me=oe>0,we=(be,ve,Te)=>(1-Te)*be+Te*ve,xe=new ng;xe.translate=c.paint.get("fill-extrusion-translate"),xe.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),xe.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),xe.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Se=be=>{const ve=p.depthModeForSublayer(1,Bt.ReadOnly,w.LEQUAL,!0),Te=c.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=we(.1,3,Te),je=p._showOverdrawInspector;if(!je){const tt=new ur({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ve=new Ir([w.ONE,w.ONE,w.ONE,w.ONE],i.ao.transparent,[!1,!1,!1,!0],w.MIN);Ss(xe,p,n,c,f,ve,tt,Ve,mr.disabled,be,"sdf",G,W,Z,oe,le,qe,k,!1)}{const tt=je?ur.disabled:new ur({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ve=je?p.colorModeForRenderPass():new Ir([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],i.ao.transparent,[!0,!0,!0,!0]);Ss(xe,p,n,c,f,ve,tt,Ve,mr.disabled,be,"color",G,W,Z,oe,le,qe,k,!1)}};if(C){const be=(ve,Te,qe)=>{const je=p.depthModeForSublayer(1,Bt.ReadOnly,w.LEQUAL,!1),tt=c.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ve=we(.1,3,tt);{const et=new Ir([w.ONE,w.ONE,w.ONE,w.ONE],i.ao.transparent,[!1,!1,!1,!0]);Ss(xe,p,n,c,f,je,ur.disabled,et,mr.disabled,ve,"clear",G,W,Z,oe,le,Ve,k,Te)}{const et=new ur({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Et=new Ir([w.ONE,w.ONE,w.ONE,w.ONE],i.ao.transparent,[!1,!1,!1,!0],w.MIN);Ss(xe,p,n,c,f,je,et,Et,mr.disabled,ve,"sdf",G,W,Z,oe,le,Ve,k,Te)}{const et=ve?w.ZERO:w.ONE_MINUS_DST_ALPHA,Et=new ur({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),$e=new Ir([et,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Ss(xe,p,n,c,f,je,Et,$e,mr.disabled,ve,"color",G,W,Z,oe,le,Ve,k,Te)}{const et=new Ir([w.ONE,w.ONE,w.ONE,ve?w.ZERO:w.ONE],i.ao.transparent,[!1,!1,!1,!0],ve?w.FUNC_ADD:w.MAX);Ss(xe,p,n,c,f,je,ur.disabled,et,mr.disabled,ve,"clear",G,W,Z,oe,le,Ve,k,Te,qe)}};if(fe||me){let ve;if(p.prepareDrawTile(),A){const Te=A.drapeBufferSize[0],qe=A.drapeBufferSize[1];ve=A.framebufferCopyTexture,ve&&(!ve||ve.size[0]===Te&&ve.size[1]===qe)||(ve&&ve.destroy(),ve=A.framebufferCopyTexture=new i.T(x,new i.q({width:Te,height:qe}),w.RGBA8)),ve.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Te,qe)}fe&&be(!0,!1,ve),me&&be(!1,!0,ve)}}else fe&&Se(!0),me&&Se(!1),(fe||me)&&p.resetStencilClippingMasks()}}},building:function(p,n,c,f){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const y=c.paint.get("building-ambient-occlusion-ground-intensity"),x=c.paint.get("building-ambient-occlusion-ground-radius"),w=c.paint.get("building-ambient-occlusion-ground-attenuation"),A=c.paint.get("building-opacity");if(A<=0)return;let C=y>0&&x>0,k=!0;const L=c.paint.get("building-vertical-scale");(!p.shadowRenderer||L<1)&&(k=!1);const V=p.conflationActive&&p.style.isLayerClipped(c,n.getSource()),z=p.style.order.indexOf(c.fqid);if((function(G,W,Z,oe,te,le){for(const fe of le){const me=W.getTile(fe).getBucket(Z);me&&(te&&me.updateReplacement(fe,G.replacementSource,oe),me.uploadUpdatedIndexBuffer(G.context))}})(p,n,c,z,V,f),(function(G,W,Z,oe){for(const te of oe){const le=W.getTile(te).getBucket(Z);le&&le.needsEvaluation()&&le.uploadUpdatedColorBuffer(G.context)}})(p,n,c,f),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const G=p.shadowRenderer,W=[],Z=G.getShadowPassDepthMode();yf({painter:p,source:n,layer:c,coords:f,defines:W,blendMode:G.getShadowPassColorMode(),depthMode:Z,opacity:A,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(p.renderPass==="translucent"){let G=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];k&&(G=G.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(G=G.concat("NORMAL_OFFSET"));const W=c.paint.get("building-facade-emissive-chance"),Z=c.paint.get("building-ambient-occlusion-intensity"),oe=new Bt(p.context.gl.LEQUAL,Bt.ReadWrite,p.depthRangeFor3D);A<1&&yf({painter:p,source:n,layer:c,coords:f,defines:G,blendMode:Ir.disabled,depthMode:oe,opacity:A,verticalScale:L,facadeEmissiveChance:W,facadeAOIntensity:Z});const te=p.colorModeForRenderPass();yf({painter:p,source:n,layer:c,coords:f,defines:G,blendMode:te,depthMode:oe,opacity:A,verticalScale:L,facadeEmissiveChance:W,facadeAOIntensity:Z}),C&&(function(le,fe,me,we,xe,Se,be,ve,Te,qe,je,tt,Ve){const et=le.context.gl,Et=le.depthModeForSublayer(1,Bt.ReadOnly,et.LEQUAL,!0),$e=.1*(1-(Re=je))+3*Re;var Re;const at=le._showOverdrawInspector,We=tt,dt=new ng;at||Ss(dt,le,fe,me,we,Et,new ur({func:et.ALWAYS,mask:255},255,255,et.KEEP,et.KEEP,et.REPLACE),new Ir([et.ONE,et.ONE,et.ONE,et.ONE],i.ao.transparent,[!1,!1,!1,!0],et.MIN),mr.disabled,xe,"sdf",Se,be,ve,0,qe,$e,We,!1);{const At=at?ur.disabled:new ur({func:et.EQUAL,mask:255},255,255,et.KEEP,et.DECR,et.DECR),Lt=at?le.colorModeForRenderPass():new Ir([et.ONE_MINUS_DST_ALPHA,et.DST_ALPHA,et.ONE,et.ONE],i.ao.transparent,[!0,!0,!0,!0]);Ss(dt,le,fe,me,we,Et,At,Lt,mr.disabled,xe,"color",Se,be,ve,0,qe,$e,We,!1)}})(p,n,c,f,!0,A,y,x,0,[0,0,0],w,V)}else if(p.renderPass==="light-beam"){const G=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],W=new Bt(p.context.gl.LEQUAL,Bt.ReadOnly,p.depthRangeFor3D);yf({painter:p,source:n,layer:c,coords:f,defines:G,blendMode:Ir.alphaBlended,depthMode:W,opacity:A,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,n,c,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const y=p.context,x=p.terrain&&p.terrain.renderingToTexture,[w,A]=p.renderPass!=="translucent"||x?[{},f]:p.stencilConfigForOverlap(f);for(const C of A){const k=n.getTile(C);if(k.needsHillshadePrepare&&p.renderPass==="offscreen")$w(p,k,c);else if(p.renderPass==="translucent"){const L=p.depthModeForSublayer(0,Bt.ReadOnly),V=c.paint.get("hillshade-emissive-strength"),z=p.colorModeForDrapableLayerRenderPass(V),G=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(C):w[C.overscaledZ];Vw(p,C,k,c,L,G,z)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,c,f,y,x){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const w=p.transform.projection.name==="globe",A=c.paint.get("raster-elevation")!==0,C=A&&w;if(p.renderElevatedRasterBackface&&!C)return;const k=p.context,L=k.gl,V=n.getSource(),z=(function(xe,Se,be,ve){const Te=Se.paint.get("raster-color"),qe=xe.type==="raster-array",je=[],tt=Se.paint.get("raster-resampling"),Ve=Se.paint.get("raster-color-mix");let et=Se.paint.get("raster-color-range");const Et=[Ve[0],Ve[1],Ve[2],0],$e=Ve[3];let Re=tt==="nearest"?ve.NEAREST:ve.LINEAR;if(qe&&(je.push("RASTER_ARRAY"),Te||je.push("RASTER_COLOR"),tt==="linear"&&je.push("RASTER_ARRAY_LINEAR"),Re=ve.NEAREST,!et&&xe.rasterLayers)){const at=xe.rasterLayers.find((({id:We})=>We===Se.sourceLayer));at&&at.fields&&at.fields.range&&(et=at.fields.range)}if(et=et||[0,1],Te){je.push("RASTER_COLOR"),be.activeTexture.set(ve.TEXTURE2),Se.updateColorRamp(et);let at=Se.colorRampTexture;at||(at=Se.colorRampTexture=new i.T(be,Se.colorRamp,ve.RGBA8)),at.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}return{mix:Et,range:et,offset:$e,defines:je,resampling:Re}})(V,c,k,L);if(V instanceof i.aS&&!f.length&&!w)return;const G=c.paint.get("raster-emissive-strength"),W=p.colorModeForDrapableLayerRenderPass(G),Z=p.terrain&&p.terrain.renderingToTexture,oe=!p.options.moving,te=c.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(V instanceof i.aS&&!f.length&&(V.onNorthPole||V.onSouthPole)){const xe=A?p.stencilModeFor3D():ur.disabled;return void xf(!!V.onNorthPole,null,p,n,c,G,z,mr.disabled,xe)}if(!f.length)return;const[le,fe]=V instanceof i.aS||Z?[{},f]:p.stencilConfigForOverlap(f),me=fe[fe.length-1].overscaledZ;C&&z.defines.push("PROJECTION_GLOBE_VIEW"),A&&z.defines.push("RENDER_CUTOFF");const we=(xe,Se,be)=>{for(const ve of xe){const Te=ve.toUnwrapped(),qe=n.getTile(ve);if(Z&&(!qe||!qe.hasData()))continue;k.activeTexture.set(L.TEXTURE0);const je=bv(qe,V,c,z);if(!je||!je.texture)continue;const{texture:tt,mix:Ve,offset:et,tileSize:Et,buffer:$e}=je;let Re,at;Z?(Re=Bt.disabled,at=ve.projMatrix):A?(Re=new Bt(L.LEQUAL,Bt.ReadWrite,p.depthRangeFor3D),at=w?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Te,oe)):(Re=p.depthModeForSublayer(ve.overscaledZ-me,c.paint.get("raster-opacity")===1?Bt.ReadWrite:Bt.ReadOnly,L.LESS),at=p.transform.calculateProjMatrix(Te,oe));const We=p.terrain&&Z?p.terrain.stencilModeForRTTOverlap(ve):le[ve.overscaledZ],dt=x?0:c.paint.get("raster-fade-duration");qe.registerFadeDuration(dt);const At=n.findLoadedParent(ve,0),Lt=Zl(qe,At,n,p.transform,dt);let xt,gt;!Lt.isFading&&qe.refreshedUponExpiration&&(qe.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),k.activeTexture.set(L.TEXTURE0),tt.bind(te,L.CLAMP_TO_EDGE),k.activeTexture.set(L.TEXTURE1),At?(At.texture&&At.texture.bind(te,L.CLAMP_TO_EDGE),xt=Math.pow(2,At.tileID.overscaledZ-qe.tileID.overscaledZ),gt=[qe.tileID.canonical.x*xt%1,qe.tileID.canonical.y*xt%1]):tt.bind(te,L.CLAMP_TO_EDGE),"useMipmap"in tt&&k.extTextureFilterAnisotropic&&p.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Kt=p.transform;let Wt;const Xt=A?a1(Kt):[0,0,0,0];let Ht,gr,Ar,Cr,hn,vr=0;if(C&&V instanceof i.aS&&V.coordinates.length>3)Ht=Float32Array.from(i.bk(i.dF(new i.cC(0,0,0)))),gr=Float32Array.from(Kt.globeMatrix),Ar=Float32Array.from(i.dB(Kt)),Cr=[i.aF(Kt.center.lng),i.aJ(Kt.center.lat)],Wt=V.elevatedGlobePerspectiveTransform,hn=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Er=i.dC(ve.canonical);vr=i.dD(Er.getCenter().lat),Ht=Float32Array.from(i.bk(i.dF(ve.canonical))),gr=Float32Array.from(Kt.globeMatrix),Ar=Float32Array.from(i.dB(Kt)),Cr=[i.aF(Kt.center.lng),i.aJ(Kt.center.lat)],Wt=[0,0],hn=Float32Array.from(i.dE(ve.canonical,Er,vr,Kt.worldSize/Kt._pixelsPerMercatorPixel))}else Wt=V instanceof i.aS?V.perspectiveTransform:[0,0],Ht=new Float32Array(16),gr=new Float32Array(9),Ar=new Float32Array(16),Cr=[0,0],hn=new Float32Array(9);const Yr=cf(at,Ht,gr,Ar,hn,gt||[0,0],i.aj(p.transform.zoom),Cr,Xt,xt||1,Lt,c,Wt,A?c.paint.get("raster-elevation"):0,2,Ve,et,z.range,Et,$e,G),ln=p.isTileAffectedByFog(ve),zn=p.getOrCreateProgram("raster",{defines:z.defines,overrideFog:ln});if(p.uploadCommonUniforms(k,zn,Te),V instanceof i.aS){const Er=V.elevatedGlobeVertexBuffer,tn=V.elevatedGlobeIndexBuffer;if(Z||!w)V.boundsBuffer&&V.boundsSegments&&zn.draw(p,L.TRIANGLES,Re,ur.disabled,W,mr.disabled,Yr,c.id,V.boundsBuffer,p.quadTriangleIndexBuffer,V.boundsSegments);else if(Er&&tn){const Qr=Kt.zoom<=i.cZ?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Kt.center.lng);Qr&&zn.draw(p,L.TRIANGLES,Re,ur.disabled,W,Se,Yr,c.id,Er,tn,Qr)}}else if(C){Re=new Bt(L.LEQUAL,Bt.ReadOnly,p.depthRangeFor3D);const Er=p.globeSharedBuffers;if(Er){const[tn,Qr,on]=Er.getGridBuffers(vr,!1);zn.draw(p,L.TRIANGLES,Re,be||We,p.colorModeForRenderPass(),Se,Yr,c.id,tn,Qr,on)}}else{const{tileBoundsBuffer:Er,tileBoundsIndexBuffer:tn,tileBoundsSegments:Qr}=p.getTileBoundsBuffers(qe);zn.draw(p,L.TRIANGLES,Re,We,W,mr.disabled,Yr,c.id,Er,tn,Qr)}}if(!(V instanceof i.aS)&&C)for(const ve of xe){const Te=ve.canonical.y===(1<<ve.canonical.z)-1;ve.canonical.y===0&&xf(!0,ve,p,n,c,G,z,Se,be||ur.disabled),Te&&xf(!1,ve,p,n,c,G,z,Se===mr.frontCW?mr.backCW:mr.frontCW,be||ur.disabled)}};C?we(fe,p.renderElevatedRasterBackface?mr.backCW:mr.frontCW,p.stencilModeFor3D()):we(fe,mr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,n,c,f,y,x){p.renderPass==="offscreen"&&(function(w,A,C,k){if(!k.length)return;const L=w.context,V=L.gl,z=A.getSource();if(!(z instanceof Xs))return;const G=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let W=C.particlePositionRGBAImage;if(!W||W.width!==G){const fe=(function(me){const we=me*me,xe=new Uint8Array(4*we),Se=function(ve){return ve|=0,ve=Math.imul(2747636419^ve,2654435769),ve=Math.imul(ve^ve>>>16,2654435769),((ve=Math.imul(ve^ve>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let ve=0;ve<we;ve++){const Te=be*(Se(2*ve+0)+Yl),qe=be*(Se(2*ve+1)+Yl),je=255*Te%1,tt=255*qe%1,Ve=je,et=qe-tt/255,Et=tt;xe[4*ve+0]=255*(Te-je/255),xe[4*ve+1]=255*Ve,xe[4*ve+2]=255*et,xe[4*ve+3]=255*Et}return xe})(G);W=C.particlePositionRGBAImage=new i.q({width:G,height:G},fe)}let Z=C.particleFramebuffer;Z?Z.width!==G&&(Z.destroy(),Z=C.particleFramebuffer=L.createFramebuffer(G,G,!0,null)):Z=C.particleFramebuffer=L.createFramebuffer(G,G,!0,null);const oe=[];for(const fe of k){const me=A.getTile(fe);if(!(me instanceof nh))continue;const we=zo(me,z,C);if(!we)continue;const xe=[me.tileSize,me.tileSize];let Se=C.tileFramebuffer;Se||(Se=C.tileFramebuffer=L.createFramebuffer(xe[0],xe[1],!0,null));let be=me.rasterParticleState;be||(be=me.rasterParticleState=new l1(L,fe,xe,W));const ve=be.update(C.lastInvalidatedAt);be.particleTextureDimension!==G&&be.updateParticleTexture(fe,W);const Te=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Te;const qe=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=qe,oe.push([fe,we,be,ve])}if(oe.length===0)return;const te=i.o.now(),le=C.previousDrawTimestamp?.001*(te-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=te,C.hasColorMap()){L.activeTexture.set(V.TEXTURE0+2);let fe=C.colorRampTexture;fe||(fe=C.colorRampTexture=new i.T(L,C.colorRamp,V.RGBA8)),fe.bind(V.LINEAR,V.CLAMP_TO_EDGE)}L.bindFramebuffer.set(C.tileFramebuffer.framebuffer),(function(fe,me,we){const xe=fe.context,Se=xe.gl,be=me.tileFramebuffer;xe.activeTexture.set(Se.TEXTURE0);const ve={u_texture:0,u_opacity:1.05*(qe=me.paint.get("raster-particle-fade-opacity-factor"))/(qe+.05)},Te=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var qe;for(const je of we){const[,,tt,Ve]=je;be.colorAttachment.set(tt.targetColorTexture.texture),xe.viewport.set([0,0,be.width,be.height]),xe.clear({color:i.ao.transparent}),Ve&&(tt.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),Te.draw(fe,Se.TRIANGLES,Bt.disabled,ur.disabled,Ir.alphaBlended,mr.disabled,ve,me.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}})(w,C,oe),(function(fe,me,we,xe){const Se=fe.context,be=Se.gl,ve=we.tileFramebuffer,Te=fe.transform.projection.name==="globe",qe=we.paint.get("raster-particle-max-speed");for(const je of xe){const[tt,Ve,et]=je;Se.activeTexture.set(be.TEXTURE0+0),Ve.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),ve.colorAttachment.set(et.targetColorTexture.texture);const Et=fe.getOrCreateProgram("rasterParticleDraw",{defines:Ve.defines,overrideFog:!1});Se.activeTexture.set(be.TEXTURE0+1);const $e=Ve.scalarData?[]:[0,1,2,3].map((We=>i.e6[We](tt)));$e.push(tt);const Re=tt.canonical.x,at=tt.canonical.y;for(const We of $e){const dt=me.getTile(Te?We.wrapped():We);if(!dt)continue;const At=dt.rasterParticleState;if(!At)continue;const Lt=We.canonical.x+(1<<We.canonical.z)*(We.wrap-tt.wrap),xt=We.canonical.y;At.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const gt=Ym(1,At.particleTexture0.size[0],[Lt-Re,xt-at],0,Ve.texture.size,2,qe,Ve.textureOffset,Ve.scale,Ve.offset);Et.draw(fe,be.POINTS,Bt.disabled,ur.disabled,Ir.alphaBlended,mr.disabled,gt,we.id,At.particleIndexBuffer,void 0,At.particleSegment)}}})(w,A,C,oe),L.bindFramebuffer.set(C.particleFramebuffer.framebuffer),(function(fe,me,we,xe){const Se=fe.context,be=Se.gl,ve=me.paint.get("raster-particle-max-speed"),Te=xe*me.paint.get("raster-particle-speed-factor")*.15,qe=(function(tt){return Math.pow(tt,6)})(.01+1*me.paint.get("raster-particle-reset-rate-factor")),je=me.particleFramebuffer;Se.viewport.set([0,0,je.width,je.height]);for(const tt of we){const[,Ve,et]=tt;Se.activeTexture.set(be.TEXTURE0+0),Ve.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se.activeTexture.set(be.TEXTURE0+1);const Et=et.particleTexture0;Et.bind(be.NEAREST,be.CLAMP_TO_EDGE);const $e=uf(1,Et.size[0],0,Ve.texture.size,ve,Te,qe,Ve.textureOffset,Ve.scale,Ve.offset);je.colorAttachment.set(et.particleTexture1.texture),Se.clear({color:i.ao.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:Ve.defines}).draw(fe,be.TRIANGLES,Bt.disabled,ur.disabled,Ir.unblended,mr.disabled,$e,me.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}})(w,C,oe,le)})(p,n,c,f),p.renderPass==="translucent"&&((function(w,A,C,k,L){const V=w.context,z=V.gl,G=A.getSource().tileSize,W=5*(1-i.ah(i.cK,i.cK+1,w.transform.zoom))*G+C.paint.get("raster-particle-elevation"),Z=!w.options.moving,oe=w.transform.projection.name==="globe";if(!k.length)return;const[te,le]=w.stencilConfigForOverlap(k),fe=[];oe&&fe.push("PROJECTION_GLOBE_VIEW");const me=w.stencilModeFor3D();for(const we of le){const xe=we.toUnwrapped(),Se=A.getTile(we);if(!Se.rasterParticleState)continue;const be=Se.rasterParticleState,ve=100;Se.registerFadeDuration(ve);const Te=A.findLoadedParent(we,0),qe=Zl(Se,Te,A,w.transform,ve);let je,tt;w.terrain&&w.terrain.prepareDrawTile(),V.activeTexture.set(z.TEXTURE0),be.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),V.activeTexture.set(z.TEXTURE1),Te&&Te.rasterParticleState?(Te.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),je=Math.pow(2,Te.tileID.overscaledZ-Se.tileID.overscaledZ),tt=[Se.tileID.canonical.x*je%1,Se.tileID.canonical.y*je%1]):be.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Ve=oe?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(xe,Z),et=w.transform,Et=og(et),$e=i.dC(we.canonical),Re=i.dD($e.getCenter().lat);let at,We,dt,At,Lt;oe?(at=Float32Array.from(i.bk(i.dF(we.canonical))),We=Float32Array.from(et.globeMatrix),dt=Float32Array.from(i.dB(et)),At=[i.aF(et.center.lng),i.aJ(et.center.lat)],Lt=Float32Array.from(i.dE(we.canonical,$e,Re,et.worldSize/et._pixelsPerMercatorPixel))):(at=new Float32Array(16),We=new Float32Array(9),dt=new Float32Array(16),At=[0,0],Lt=new Float32Array(9));const xt=ol(Ve,at,We,dt,Lt,tt||[0,0],i.aj(w.transform.zoom),At,Et,je||1,qe,W),gt=w.isTileAffectedByFog(we),Kt=w.getOrCreateProgram("rasterParticle",{defines:fe,overrideFog:gt});if(w.uploadCommonUniforms(V,Kt,xe),oe){const Wt=new Bt(z.LEQUAL,Bt.ReadOnly,w.depthRangeFor3D),Xt=0,Ht=w.globeSharedBuffers;if(Ht){const[gr,Ar,Cr]=Ht.getGridBuffers(Re,Xt!==0);Kt.draw(w,z.TRIANGLES,Wt,me,Ir.alphaBlended,w.renderElevatedRasterBackface?mr.frontCCW:mr.backCCW,xt,C.id,gr,Ar,Cr)}}else{const Wt=w.depthModeForSublayer(0,Bt.ReadOnly),Xt=te[we.overscaledZ],{tileBoundsBuffer:Ht,tileBoundsIndexBuffer:gr,tileBoundsSegments:Ar}=w.getTileBoundsBuffers(Se);Kt.draw(w,z.TRIANGLES,Wt,Xt,Ir.alphaBlended,mr.disabled,xt,C.id,Ht,gr,Ar)}}w.resetStencilClippingMasks()})(p,n,c,f),p.style.map.triggerRepaint())},background:function(p,n,c,f){const y=c.paint.get("background-color"),x=c.paint.get("background-color-use-theme").constantOr("default")==="none",w=c.paint.get("background-opacity"),A=c.paint.get("background-emissive-strength"),C=c.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const k=p.context,L=k.gl,V=p.transform,z=V.tileSize,G=c.paint.get("background-pattern");let W;if(G!==void 0&&(G===null||(W=p.imageManager.getPattern(i.I.from(G.toString()),c.scope,p.style.getLut(c.scope)),!W)))return;const Z=!G&&y.a===1&&w===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==Z)return;const oe=ur.disabled,te=p.depthModeForSublayer(0,Z==="opaque"?Bt.ReadWrite:Bt.ReadOnly),le=p.colorModeForDrapableLayerRenderPass(A),fe=G?"backgroundPattern":"background";let me,we=f;if(we||(me=p.getBackgroundTiles(),we=Object.values(me).map((xe=>xe.tileID))),G&&(k.activeTexture.set(L.TEXTURE0),p.imageManager.bind(p.context,c.scope)),C){const xe=p.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0}),Se=new Float32Array(i.bA([])),be=new i.aO(0,0,0,0,0),ve=G?df(Se,A,w,p,0,c.scope,W,C,{tileID:be,tileSize:z}):hf(Se,A,w,y.toPremultipliedRenderColor(x?null:c.lut));xe.draw(p,L.TRIANGLES,te,oe,le,mr.disabled,ve,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const xe of we){const Se=p.isTileAffectedByFog(xe),be=p.getOrCreateProgram(fe,{overrideFog:Se}),ve=xe.toUnwrapped(),Te=f?xe.projMatrix:p.transform.calculateProjMatrix(ve);p.prepareDrawTile();const qe=n?n.getTile(xe):me?me[xe.key]:new Ys(xe,z,V.zoom,p),je=G?df(Te,A,w,p,0,c.scope,W,C,{tileID:xe,tileSize:z}):hf(Te,A,w,y.toPremultipliedRenderColor(x?null:c.lut));p.uploadCommonUniforms(k,be,ve);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:Ve,tileBoundsSegments:et}=p.getTileBoundsBuffers(qe);be.draw(p,L.TRIANGLES,te,oe,le,mr.disabled,je,c.id,tt,Ve,et)}},sky:function(p,n,c){const f=p._atmosphere?i.aj(p.transform.zoom):1,y=c.paint.get("sky-opacity")*f;if(y===0)return;const x=p.context,w=c.paint.get("sky-type"),A=new Bt(x.gl.LEQUAL,Bt.ReadOnly,[0,1]),C=p.frameCounter/1e3%1;w==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&((function(k,L,V,z){const G=k.context,W=G.gl;let Z=L.skyboxFbo;if(!Z){Z=L.skyboxFbo=G.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new cg(G),L.skyboxTexture=G.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,L.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let fe=0;fe<6;++fe)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(Z.framebuffer),G.viewport.set([0,0,32,32]);const oe=L.getCenter(k,!0),te=k.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);i.bA(le),i.ek(le,le,.5*-Math.PI),tc(k,L,te,le,oe,0),i.bA(le),i.ek(le,le,.5*Math.PI),tc(k,L,te,le,oe,1),i.bA(le),i.cT(le,le,.5*-Math.PI),tc(k,L,te,le,oe,2),i.bA(le),i.cT(le,le,.5*Math.PI),tc(k,L,te,le,oe,3),i.bA(le),tc(k,L,te,le,oe,4),i.bA(le),i.ek(le,le,Math.PI),tc(k,L,te,le,oe,5),G.viewport.set([0,0,k.width,k.height])})(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&(function(k,L,V,z,G){const W=k.context,Z=W.gl,oe=k.transform,te=k.getOrCreateProgram("skybox");W.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture);const le=((fe,me,we,xe,Se)=>({u_matrix:fe,u_sun_direction:me,u_cubemap:0,u_opacity:xe,u_temporal_offset:Se}))(oe.skyboxMatrix,L.getCenter(k,!1),0,z,G);k.uploadCommonUniforms(W,te),te.draw(k,Z.TRIANGLES,V,ur.disabled,k.colorModeForRenderPass(),mr.backCW,le,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)})(p,c,A,y,C):w==="gradient"&&p.renderPass==="sky"&&(function(k,L,V,z,G){const W=k.context,Z=W.gl,oe=k.transform,te=k.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new cg(W)),W.activeTexture.set(Z.TEXTURE0);let le=L.colorRampTexture;le||(le=L.colorRampTexture=new i.T(W,L.colorRamp,Z.RGBA8)),le.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const fe=((me,we,xe,Se,be)=>({u_matrix:me,u_color_ramp:0,u_center_direction:we,u_radius:i.an(xe),u_opacity:Se,u_temporal_offset:be}))(oe.skyboxMatrix,L.getCenter(k,!1),L.paint.get("sky-gradient-radius"),z,G);k.uploadCommonUniforms(W,te),te.draw(k,Z.TRIANGLES,V,ur.disabled,k.colorModeForRenderPass(),mr.backCW,fe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)})(p,c,A,y,C)},custom:function(p,n,c,f){const y=p.context,x=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(n)){if(p.renderPass==="offscreen"){const w=x.prerender;if(w){if(p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const A=p.transform.pointMerc;w.call(x,y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.aj(p.transform.zoom),[A.x,A.y],p.transform.pixelsPerMeterRatio)}else w.call(x,y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const A=x.renderToTile;if(A){const C=f[0].canonical,k={x:C.x+f[0].wrap*(x.wrapTileId?0:1<<C.z),y:C.y,z:C.z};y.setDepthMode(Bt.disabled),y.setStencilMode(ur.disabled),y.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),A.call(x,y.gl,k),y.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),y.setStencilMode(ur.disabled);const w=x.renderingMode==="3d"?new Bt(p.context.gl.LEQUAL,Bt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Bt.ReadOnly);if(y.setDepthMode(w),p.transform.projection.name==="globe"){const A=p.transform.pointMerc;x.render(y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.aj(p.transform.zoom),[A.x,A.y],p.transform.pixelsPerMeterRatio)}else x.render(y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState(),y.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,n,c,f){if(p.renderPass==="opaque")return;const y=c.paint.get("model-opacity").constantOr(1);if(y===0)return;const x=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!x||p.terrain&&y<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const w=p.shadowRenderer,A=c.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,A||(w.enabled=!1));const C=()=>{w&&(w.useNormalOffset=!0,A||(w.enabled=!0))},k=n.getSource();if(p.renderPass==="light-beam"&&k.type!=="batched-model")return;if(k.type==="vector"||k.type==="geojson")return(function(te,le,fe,me,we){const xe=te.transform;if(xe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${xe.projection.name} projection is not yet implemented`);const Se=xe.getFreeCameraOptions().position;if(!te.modelManager)return;const be=te.modelManager;fe.modelManager=be;const ve=te.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Te=fe._unevaluatedLayout._values["model-id"],qe=Object.assign({},fe.layout.get("model-id").parameters),je=te.style.order.indexOf(fe.fqid);for(const tt of me){const Ve=le.getTile(tt).getBucket(fe);if(!Ve||Ve.projection.name!==xe.projection.name)continue;const et=Ve.getModelUris();et&&!Ve.modelsRequested&&(be.addModelsFromBucket(et,we),Ve.modelsRequested=!0);const Et=lu(tt,xe);qe.zoom=Et;const $e=Te.possiblyEvaluate(qe);if(Tv(te,Ve,tt),Ea.shadowUniformsInitialized=!1,Ea.useSingleShadowCascade=!!ve&&ve.getMaxCascadeForTile(tt.toUnwrapped())===0,te.renderPass==="shadow"&&ve){if(te.currentShadowCascade===1&&Ve.isInsideFirstShadowMapFrustum)continue;const We=xe.calculatePosMatrix(tt.toUnwrapped(),xe.worldSize);if(Ea.tileMatrix.set(We),Ea.shadowTileMatrix=Float32Array.from(ve.calculateShadowPassMatrixFromMatrix(We)),Ea.aabb.min=[0,0,0],Ea.aabb.max[0]=Ea.aabb.max[1]=i.al,Ea.aabb.max[2]=0,Ev(Ve,Ea,te,fe.scope))continue}const Re=1<<tt.canonical.z,at=[((Se.x-tt.wrap)*Re-tt.canonical.x)*i.al,(Se.y*Re-tt.canonical.y)*i.al,Se.z*Re*i.al];te.conflationActive&&Object.keys(Ve.instancesPerModel).length>0&&te.style.isLayerClipped(fe,le.getSource())&&Ve.updateReplacement(tt,te.replacementSource,je,we)&&(Ve.uploaded=!1,Ve.upload(te.context));for(let We in Ve.instancesPerModel){const dt=Ve.instancesPerModel[We];dt.features.length>0&&(We=$e.evaluate(dt.features[0].feature,{}));const At=be.getModel(We,we);if(At||be.hasURLBeenRequested(We)||Ve.modelUris.includes(We)||(Ve.modelUris.push(We),Ve.modelsRequested=!1),At&&At.uploaded)for(const Lt of At.nodes)Av(te,fe,Lt,dt,at,tt,Ea)}}})(p,n,c,f,k.type==="vector"?c.scope:""),void C();if(!k.loaded())return;if(k.type==="batched-model")return(function(te,le,fe,me){fe.resetLayerRenderingStats(te);const we=te.context,xe=te.transform,Se=te.style.fog,be=te.shadowRenderer;if(xe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${xe.projection.name} projection is not yet implemented`);const ve=te.transform.getFreeCameraOptions().position,Te=i.c4([],[ve.x,ve.y,ve.z],te.transform.worldSize),qe=i.et([],Te),je=i.bA([]),tt=i.ec(xe.center.lat,xe.zoom),Ve=i.bq([],[1,1,1/tt]);i.br(je,je,qe);const et=fe.paint.get("model-opacity").constantOr(1),Et=new Bt(we.gl.LEQUAL,Bt.ReadWrite,te.depthRangeFor3D),$e=new Bt(we.gl.LEQUAL,Bt.ReadOnly,te.depthRangeFor3D),Re=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),at=te.renderPass==="shadow",We=at&&be?be.getCurrentCascadeFrustum():xe.getFrustum(xe.scaleZoom(xe.worldSize)),dt=fe.paint.get("model-front-cutoff"),At=dt[2]<1,Lt=tl(te,fe.paint.get("model-cutoff-fade-range")),xt=fe.getLayerRenderingStats();(function(gt,Kt,Wt,Xt){const Ht=gt.terrain?gt.terrain.exaggeration():0,gr=gt.transform.zoom;for(const Ar of Xt){const Cr=Kt.getTile(Ar).getBucket(Wt);Cr&&(Cr.setFilter(Wt.filter),gt.conflationActive&&Cr.updateReplacement(Ar,gt.replacementSource),Cr.evaluateTransform(gt,Wt),gt.terrain&&Ht>0&&Cr.elevationUpdate(gt.terrain,Ht,Ar,Wt.source),Cr.needsReEvaluation(gt,gr,Wt)&&Cr.evaluate(Wt))}})(te,le,fe,me),(function(){let gt,Kt,Wt;At?(gt=me.length-1,Kt=-1,Wt=-1):(gt=0,Kt=me.length,Wt=1);const Xt=new Float64Array(16),Ht=i.cz(),gr=new i.P(0,0);for(let Ar=gt;Ar!==Kt;Ar+=Wt){const Cr=me[Ar],hn=le.getTile(Cr).getBucket(fe);if(!hn||!hn.uploaded)continue;let vr=!1;be&&(vr=be.getMaxCascadeForTile(Cr.toUnwrapped())===0);const Yr=xe.calculatePosMatrix(Cr.toUnwrapped(),xe.worldSize),ln=hn.modelTraits;!at&&At&&(i.bl(Xt,Yr),i.af(Ht,Te,Xt),gr.x=Ht[0],gr.y=Ht[1]);const zn=[];hn.setFilter(fe.filter);for(const Er of hn.getNodesInfo()){if(Er.hiddenByReplacement||!Er.node.meshes)continue;const tn=Er.node;let Qr=0;te.terrain&&tn.elevation&&(Qr=tn.elevation*te.terrain.exaggeration());const on=(()=>{const qi=Er.aabb;return Re.min=[...qi.min],Re.max=[...qi.max],Re.min[2]+=Qr,Re.max[2]+=Qr,i.af(Re.min,Re.min,Yr),i.af(Re.max,Re.max,Yr),Re})(),Bn=Er.evaluatedScale;if(Bn[0]<=1&&Bn[1]<=1&&Bn[2]<=1&&on.intersects(We)===0)continue;if(!at&&At){const qi=.16666666666666666;Er.cameraCollisionOpacity=Te[0]>on.min[0]&&Te[0]<on.max[0]&&Te[1]>on.min[1]&&Te[1]<on.max[1]&&Te[2]*tt<on.max[2]&&tn.footprint&&i.b$(gr,tn.footprint)?Math.max(Er.cameraCollisionOpacity-qi,0):Math.min(1,Er.cameraCollisionOpacity+qi)}const oi=[...Yr],ji=1/i.d6(Cr.canonical),Un=tn.anchor?tn.anchor[0]:0,Or=tn.anchor?tn.anchor[1]:0;i.br(oi,oi,[Un*(Bn[0]-1)+Er.evaluatedTranslation[0]*ji,Or*(Bn[1]-1)+Er.evaluatedTranslation[1]*ji,Qr+Er.evaluatedTranslation[2]]),i.cp(Bn,i.ev)||i.cR(oi,oi,Bn);const hr=i.aB([],oi,tn.matrix),dn=i.aB([],xe.expandedFarZProjMatrix,hr),Kn=i.aB([],xe.expandedFarZProjMatrix,oi),$n=i.aC([],[Un,Or,Qr,1],dn)[2];tn.hidden=!1;let mi=et;at||(At&&(mi*=Er.cameraCollisionOpacity,mi*=ug(oi,xe,Er.aabb,dt)),mi*=Tf(Lt,$n)),mi!==0?zn.push({nodeInfo:Er,depth:$n,opacity:mi,wvpForNode:dn,wvpForTile:Kn,nodeModelMatrix:hr,tileModelMatrix:oi}):tn.hidden=!0}at||zn.sort(((Er,tn)=>!At||Er.opacity===1&&tn.opacity===1?Er.depth<tn.depth?-1:1:Er.opacity===1?-1:tn.opacity===1?1:Er.depth>tn.depth?-1:1));for(const Er of zn){const tn=Er.nodeInfo,Qr=tn.node;let on=i.aB([],Ve,Er.tileModelMatrix);i.aB(on,je,on);const Bn=i.bl([],on);i.ed(Bn,Bn),i.cR(Bn,Bn,c1),on=i.aB(on,on,Qr.matrix);const oi=te.renderPass==="light-beam",ji=fe.paint.get("model-color-use-theme").constantOr("default")==="none",Un=ln&i.ez.HasMapboxMeshFeatures,Or=Un?0:tn.evaluatedRMEA[0][2];for(let hr=0;hr<Qr.meshes.length;++hr){const dn=Qr.meshes[hr],Kn=hr===Qr.lightMeshIndex;let $n=Er.wvpForNode;if(Kn){if(!oi&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}$n=Er.wvpForTile}else if(oi)continue;const mi={defines:[]},qi=[];if(!at&&be&&(be.useNormalOffset=!!dn.normalBuffer),wf(mi.defines,qi,dn,te,ji?null:fe.lut),Un||mi.defines.push("DIFFUSE_SHADED"),vr&&mi.defines.push("SHADOWS_SINGLE_CASCADE"),xt&&(at?xt.numRenderedVerticesInShadowPass+=dn.vertexArray.length:xt.numRenderedVerticesInTransparentPass+=dn.vertexArray.length),at){Th(dn,Er.nodeModelMatrix,te,fe);continue}let na=null;if(Se){const Ca=Be(Er.nodeModelMatrix,te.transform);if(na=new Float32Array(Ca),xe.projection.name!=="globe"){const ei=dn.aabb.min,ai=dn.aabb.max,[qn,Si]=Se.getOpacityForBounds(Ca,ei[0],ei[1],ai[0],ai[1]);mi.overrideFog=qn>=tr||Si>=tr}}const ia=dn.material;let Fo;ia.occlusionTexture&&ia.occlusionTexture.offsetScale&&(Fo=ia.occlusionTexture.offsetScale,mi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Bo=te.getOrCreateProgram("model",mi);!at&&be&&be.setupShadowsFromMatrix(Er.tileModelMatrix,Bo,be.useNormalOffset),te.uploadCommonUniforms(we,Bo,null,na);const So=ia.pbrMetallicRoughness;So.metallicFactor=.9,So.roughnessFactor=.5;const pa=ff(new Float32Array($n),new Float32Array(on),new Float32Array(Bn),new Float32Array(Qr.matrix),te,Er.opacity,So.baseColorFactor,ia.emissiveFactor,So.metallicFactor,So.roughnessFactor,ia,Or,fe,[0,0,0],Fo);!Kn&&(tn.hasTranslucentParts||Er.opacity<1)&&Bo.draw(te,we.gl.TRIANGLES,Et,ur.disabled,Ir.disabled,mr.backCCW,pa,fe.id,dn.vertexBuffer,dn.indexBuffer,dn.segments,fe.paint,te.transform.zoom,void 0,qi),Bo.draw(te,we.gl.TRIANGLES,Kn?$e:Et,ur.disabled,Kn||Er.opacity<1||tn.hasTranslucentParts?Ir.alphaBlended:Ir.unblended,mr.backCCW,pa,fe.id,dn.vertexBuffer,dn.indexBuffer,dn.segments,fe.paint,te.transform.zoom,void 0,qi)}}}})()})(p,n,c,f),void C();if(k.type!=="model")return;const L=k.getModels(),V=[],z=p.transform.getFreeCameraOptions().position,G=i.c4([],[z.x,z.y,z.z],p.transform.worldSize);i.et(G,G);const W=[],Z=[];let oe=0;for(const te of L){const le=c.paint.get("model-rotation").constantOr(null),fe=c.paint.get("model-scale").constantOr(null),me=c.paint.get("model-translation").constantOr(null);te.computeModelMatrix(p,le,fe,me,!0,!0,!1);const we=i.bA([]),xe=i.ec(te.position.lat,p.transform.zoom),Se=i.bq([],[1,1,1/xe]);i.br(we,we,G),V.push({zScaleMatrix:Se,negCameraPosMatrix:we});for(const be of te.nodes)Sf(p.transform,be,te.matrix,p.transform.expandedFarZProjMatrix,oe,W,Z);oe++}if(W.sort(((te,le)=>le.depth-te.depth)),p.renderPass!=="shadow"){if(y===1)for(const te of Z)ic(te,p,c,V[te.modelIndex],ur.disabled,p.colorModeForRenderPass());else{for(const te of Z)ic(te,p,c,V[te.modelIndex],ur.disabled,Ir.disabled);for(const te of Z)ic(te,p,c,V[te.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const te of W)ic(te,p,c,V[te.modelIndex],ur.disabled,p.colorModeForRenderPass());C()}else{for(const te of Z)Th(te.mesh,te.nodeModelMatrix,p,c);for(const te of W)Th(te.mesh,te.nodeModelMatrix,p,c);C()}}},oc={line:function(p,n,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const f=n.getVisibleCoordinates();for(const y of f){const x=n.getTile(y).getBucket(p);if(x&&(x.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,n,c){const f=n.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,f.type==="vector"?p.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const y=f.getModels();for(const x of y)x.upload(c.context)},raster:function(p,n,c){const f=n.getSource();if(!(f instanceof Xs&&f.loaded()))return;const y=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!y)return;const x=p.paint.get("raster-array-band")||f.getInitialBand(y);if(x==null)return;const w=n.getIds().map((A=>n.getTileByID(A)));for(const A of w)A.updateNeeded(p.id,x)&&f.prepareTile(A,y,p.id,x)},"raster-particle":function(p,n,c){const f=n.getSource();if(!(f instanceof Xs&&f.loaded()))return;const y=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!y)return;const x=p.paint.get("raster-particle-array-band")||f.getInitialBand(y);if(x==null)return;const w=n.getIds().map((A=>n.getTileByID(A)));for(const A of w)A.updateNeeded(p.id,x)&&f.prepareTile(A,y,p.id,x)}},ac={fill:Jl},fl={fill:function(p,n,c,f){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const y=p.context.gl,x=new Bt(y.LEQUAL,Bt.ReadOnly,p.depthRangeFor3D),w=new ur({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),A=p.transform.getFreeCameraOptions().position,C=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of f){const L=n.getTile(k),V=L.getBucket(c);if(!V)continue;const z=V.elevatedStructures;if(!z||z.depthSegments.segments[0].primitiveLength===0)continue;const G=vv(k.toUnwrapped(),A),W=p.translatePosMatrix(k.projMatrix,L,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Z=lf(W,G,0,1,0);C.draw(p,y.TRIANGLES,x,w,Ir.disabled,mr.disabled,Z,c.id,z.vertexBuffer,z.indexBuffer,z.depthSegments,c.paint,p.transform.zoom)}}};class dg{constructor(n,c,f,y,x,w){this.context=new tg(n,c),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of A)this._debugParams.enabledLayers[k]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of A)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new Af(x),this.setup(),this.numSublayers=Ko.maxUnderzooming+Ko.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new jw(this),this._wireframeDebugCache=new Iv,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,C,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=w}updateTerrain(n,c){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vh(this,n));const y=this._terrain;this.transform.elevation=f?y:null,y.update(n,this.transform,c),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=c.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const x=f+.78*(y-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new vh(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,c){if(this.width=n*i.o.devicePixelRatio,this.height=c*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const n=this.context,c=new i.bd;c.emplaceBack(0,0),c.emplaceBack(i.al,0),c.emplaceBack(0,i.al),c.emplaceBack(i.al,i.al),this.tileExtentBuffer=n.createVertexBuffer(c,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const f=new i.bd;f.emplaceBack(0,0),f.emplaceBack(i.al,0),f.emplaceBack(0,i.al),f.emplaceBack(i.al,i.al),this.debugBuffer=n.createVertexBuffer(f,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const y=new i.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const x=new i.b0;x.emplaceBack(0,0,0,0),x.emplaceBack(i.al,0,i.al,0),x.emplaceBack(0,i.al,0,i.al),x.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=n.createVertexBuffer(x,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const w=new i.b1;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const A=new i.be;for(const k of[0,1,3,2,0])A.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new i.T(n,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=i.bC();const C=this.context.gl;this.stencilClearMode=new ur({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Bt.disabled,this.stencilClearMode,Ir.disabled,mr.disabled,Wl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,f){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const C of f)if(this._tileClippingMaskIDs[C.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(Ir.disabled),y.setDepthMode(Bt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of f){const C=c.getTile(A),k=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:V,tileBoundsSegments:z}=this.getTileBoundsBuffers(C);w.draw(this,x.TRIANGLES,Bt.disabled,new ur({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),Ir.disabled,mr.disabled,Wl(A.projMatrix),"$clipping",L,V,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new ur({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new ur({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,f=n.sort(((w,A)=>A.overscaledZ-w.overscaledZ)),y=f[f.length-1].overscaledZ,x=f[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let A=0;A<x;A++)w[A+y]=new ur({func:c.GEQUAL,mask:255},A+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[w,f]}return[{[y]:ur.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Ir([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ir.unblended:Ir.alphaBlended}colorModeForDrapableLayerRenderPass(n){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ir([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,c,f,y=!1){if(this.depthOcclusion)return new Bt(this.context.gl.GREATER,Bt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Bt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Bt(f||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,c=Math.ceil(this.width),f=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),x=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&f!==0&&(this.depthFBO=new pf(this.context,c,f,!1,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:f,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),n.bindTexture(n.TEXTURE_2D,x),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,c,f,0,0,c,f,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((n,c)=>n+c/this._fpsHistory.length),0))}render(n,c){const f=i.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=c;const y=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(x).filter(($e=>{const Re=y[$e];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]}));let A=w(),C=!1,k=!1,L=null;for(const $e of A){const Re=y[$e];Re.type==="circle"?C=!0:Re.type==="building"?L=Re:Re.type==="symbol"&&(Re.hasOcclusionOpacityProperties?k=!0:C=!0)}let V=A.map(($e=>y[$e]));const z=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let G=0,W=!1;for(const $e in z){const Re=z[$e];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++G)}let Z=!1;for(const $e of V)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(Z=!0),this.prepareLayer($e));const oe={},te={},le={},fe={},me={};for(const $e in z){const Re=z[$e];oe[$e]=Re.getVisibleCoordinates(),te[$e]=oe[$e].slice().reverse(),le[$e]=Re.getVisibleCoordinates(!0).reverse(),fe[$e]=Re.getShadowCasterCoordinates(),me[$e]=Re.sortCoordinatesByDistance(oe[$e])}const we=$e=>{const Re=this.style.getLayerSourceCache($e);return Re&&Re.used?Re.getSource():null};if(G||Z||this._clippingActiveLastFrame){const $e=[],Re=[];let at=0;for(const We of V)this.isSourceForClippingOrConflation(We,we(We))&&($e.push(We),Re.push(at)),at++;if($e&&(Z||$e.length>1)||this._clippingActiveLastFrame){Z=!1;const We=[];for(let dt=0;dt<$e.length;dt++){const At=$e[dt],Lt=Re[dt],xt=this.style.getLayerSourceCache(At);if(!xt||!xt.used||!xt.getSource().usedInConflation&&At.type!=="clip"&&At.type!=="building")continue;let gt=i.eH,Kt=i.bZ.None;const Wt=[];let Xt=!0;if(At.type==="building")gt=i.eJ;else if(At.type==="clip"){gt=Lt;for(const Ht of At.layout.get("clip-layer-types"))Kt|=Ht==="model"?i.bZ.Model:Ht==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const Ht of At.layout.get("clip-layer-scope"))Wt.push(Ht);At.isHidden(this.transform.zoom)?Xt=!1:Z=!0}Xt&&We.push({layer:At.fqid,cache:xt,order:gt,clipMask:Kt,clipScope:Wt})}this.replacementSource.setSources(We),W=!0}}this._clippingActiveLastFrame=Z,W||this.replacementSource.clear(),this.conflationActive=W,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<V.length;$e++){const Re=V[$e],at=Re.cutoffRange();if(this.longestCutoffRange=Math.max(at,this.longestCutoffRange),at>0){const We=we(Re);We&&(this.minCutoffZoom=Math.max(We.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=xe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(le),this.opaquePassCutoff=0,A=w(),V=A.map(($e=>y[$e])));const Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in z)for(const Re of oe[$e]){let at={min:0,max:0};this.terrain&&(at=this.terrain.getMinMaxForTile(Re)||at),Se.addShadowReceiver(Re.toUnwrapped(),at.min,at.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new su(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(be&&!this._snow&&(this._snow=new Rv(this)),!be&&this._snow&&(this._snow.destroy(),delete this._snow),ve&&!this._rain&&(this._rain=new jn(this)),!ve&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),L){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Xn);const $e=this.style.getLayerSourceCache(L);this.buildingTileBorderManager.updateBorders($e,L)}if(!br.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of V){const Re=n.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const at=Re?te[Re.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||at&&at.length)&&this.renderLayer(this,Re,$e,at)}this.depthRangeFor3D=[0,1-(V.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,fe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),qe=(()=>{if(c.showOverdrawInspector)return i.ao.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const Re=this.style.getLut($e.scope);if(!Te){const at=$e.properties.get("color-use-theme")==="none",We=$e.properties.get("color").toNonPremultipliedRenderColor(at?null:Re).toArray01();return new i.ao(...We)}if(Te){const at=$e.properties.get("space-color-use-theme")==="none",We=$e.properties.get("space-color").toNonPremultipliedRenderColor(at?null:Re).toArray01();return new i.ao(...We)}}return i.ao.transparent})();if(this.context.clear({color:qe,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const $e=V[this.currentLayer],Re=n.getLayerSourceCache($e);if($e.isSky())continue;const at=Re?($e.is3D(x)?me:te)[Re.id]:void 0;this._renderTileClippingMasks($e,Re,at),this.renderLayer(this,Re,$e,at)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const $e=V[this.currentLayer],Re=n.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,Re,$e,Re?te[Re.id]:void 0)}function je($e,Re){let at;return Re&&(at=($e.type==="symbol"?le:$e.is3D(x)?me:te)[Re.id]),at}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<A.length;){const $e=V[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const Re=n.getLayerSourceCache($e);this.renderLayer(this,Re,$e,je($e,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let tt=0;Se&&(tt=Se.getShadowCastingLayerCount());let Ve=!1,et=-1;for(let $e=0;$e<A.length;++$e){const Re=V[$e];Re.isHidden(this.transform.zoom)||Re.is3D(x)&&(et=$e)}k&&et===-1&&(C=!0);let Et=!1;for(;this.currentLayer<A.length;){const $e=V[this.currentLayer],Re=n.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Et&&$e.is3D(x)&&!x){const at=this.currentLayer,We=dt=>{for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const At=V[this.currentLayer];if(ac[At.type]){const Lt=this.style.getLayerSourceCache(At);ac[At.type](this,Lt,At,je(At,Lt),dt)}}};We("initialize"),We("reset"),this.currentLayer=at,Et=!0}if(C&&!Ve&&this.terrain&&!this.transform.isOrthographic&&(Ve=!0,this.blitDepth()),k&&et!==-1&&this.currentLayer===et+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks($e,Re,Re?oe[Re.id]:void 0),this.renderLayer(this,Re,$e,je($e,Re)),!this.terrain&&Se&&tt>0&&$e.hasShadowPass()&&--tt==0){{this.clearStencil(),this.resetStencilClippingMasks();const at=this.currentLayer;for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const We=V[this.currentLayer];if(fl[We.type]){const dt=this.style.getLayerSourceCache(We);fl[We.type](this,dt,We,je(We,dt))}}this.currentLayer=at}if(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const at=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=at;this.currentLayer++){const We=V[this.currentLayer];if(!We.hasLightBeamPass())continue;const dt=n.getLayerSourceCache(We);this.renderLayer(this,dt,We,dt?te[dt.id]:void 0)}this.currentLayer=at,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const at=this.currentLayer;this.depthOcclusion=!0;for(const We of this.layersWithOcclusionOpacity){this.currentLayer=We;const dt=V[this.currentLayer],At=n.getLayerSourceCache(dt),Lt=At?te[At.id]:void 0;this.terrain||this._renderTileClippingMasks(dt,At,At?oe[At.id]:void 0),this.renderLayer(this,At,dt,Lt)}this.depthOcclusion=!1,this.currentLayer=at,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;V.forEach((Re=>{const at=n.getLayerSourceCache(Re);at&&!Re.isHidden(this.transform.zoom)&&at.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<at.getSource().maxzoom)&&($e=at)})),$e&&this.options.showTileBoundaries&&bf(this,$e,$e.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&bf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function($e){const Re=$e.transform.padding;Ya($e,$e.transform.height-(Re.top||0),3,wo),Ya($e,Re.bottom||0,3,ul),Cn($e,Re.left||0,3,wv),Cn($e,$e.transform.width-(Re.right||0),3,ag);const at=$e.transform.centerPoint;(function(We,dt,At,Lt){ec(We,dt-1,At-10,2,20,Lt),ec(We,dt-10,At-1,20,2,Lt)})($e,at.x,$e.transform.height-at.y,sg)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),W||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:c}=this.transform.projection,f=!c||!c.includes(n.type);if(oc[n.type]&&(f||this.terrain&&n.type==="custom")){const y=this.style.getLayerSourceCache(n);oc[n.type](n,y,this)}this.gpuTimingEnd()}renderLayer(n,c,f,y){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(f.type)&&(!n.terrain||f.type!=="custom")||f.type==="clip"||dl[f.type](n,c,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,f=this.context.gl;let y=this.gpuTimers[n.id];y||(y=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:f.createQuery()}),y.calls++,f.beginQuery(c.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=this.context.gl,f=c.createQuery();this.deferredRenderGpuTimeQueries.push(f),c.beginQuery(n.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const f in n){const y=n[f],x=this.context.extTimerQuery,w=x.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(y.query),c[f]=w}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let f=0;for(const y of n)f+=c.getQueryParameter(y,c.QUERY_RESULT)/1e6,c.deleteQuery(y);return f}translatePosMatrix(n,c,f,y,x){if(!f[0]&&!f[1])return n;const w=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(w){const k=Math.sin(w),L=Math.cos(w);f=[f[0]*L-f[1]*k,f[0]*k+f[1]*L]}const A=[x?f[0]:i.ay(c,f[0],this.transform.zoom),x?f[1]:i.ay(c,f[1],this.transform.zoom),0],C=new Float32Array(16);return i.br(C,n,A),C}saveTileTexture(n){if(n.context!==this.context)return;const c=n.size[0],f=this._tileTextures[c];f?f.push(n):this._tileTextures[c]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,c,f){const y=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,x=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||y||c!==void 0&&!c||x.push("FOG","FOG_DITHERING"),y&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(n,c){this.cache=this.cache||{};const f=c&&c.defines||[],y=c&&c.config,x=this.currentGlobalDefines(n,c&&c.overrideFog,c&&c.overrideRtt).concat(f),w=sf.cacheKey(Wd[n],n,x,y);return this.cache[w]||(this.cache[w]=new sf(this.context,n,Wd[n],y,i1[n],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,c){if(this.style.enable3dLights()){const f=this.style.directionalLight,y=this.style.ambientLight;if(f&&y){const x=((w,A,C)=>{const k=w.properties.get("direction"),L=w.properties.get("color-use-theme")==="none",V=w.properties.get("color").toNonPremultipliedRenderColor(L?null:C.getLut(w.scope)).toArray01(),z=w.properties.get("intensity"),G=A.properties.get("color-use-theme")==="none",W=A.properties.get("color").toNonPremultipliedRenderColor(G?null:C.getLut(A.scope)).toArray01(),Z=A.properties.get("intensity"),oe=[k.x,k.y,k.z],te=i.dK(W,Z),le=i.dK(V,z);return{u_lighting_ambient_color:te,u_lighting_directional_dir:oe,u_lighting_directional_color:le,u_ground_radiance:af(oe,le,te)}})(f,y,this.style);c.setLightsUniformValues(n,x)}}}uploadCommonUniforms(n,c,f,y,x){if(this.uploadCommonLightUniforms(n,c),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const A=w.getOpacity(this.transform.pitch),C=((k,L,V,z,G,W,Z,oe,te,le,fe,me)=>{const we=k.transform,xe=L.properties.get("color-use-theme")==="none",Se=L.properties.get("color").toNonPremultipliedRenderColor(xe?null:k.style.getLut(L.scope)).toArray01();Se[3]=z;const be=k.frameCounter/1e3%1,[ve,Te]=L.properties.get("vertical-range");return{u_fog_matrix:V?we.calculateFogTileMatrix(V):me||k.identityMat,u_fog_range:L.getFovAdjustedRange(we._fov),u_fog_color:Se,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ve,Te),Te],u_fog_temporal_offset:be,u_frustum_tl:G,u_frustum_tr:W,u_frustum_br:Z,u_frustum_bl:oe,u_globe_pos:te,u_globe_radius:le,u_viewport:fe,u_globe_transition:i.aj(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,w,f,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],y);c.setFogUniformValues(n,C)}x&&c.setCutoffUniformValues(n,x.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const y of f)c[y.key]=n[y.key]||new Ys(y,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,c){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[n.key];return c||(this._cachedTileFogOpacities[n.key]=c=this.style.fog.getOpacityForTile(n)),c[0]>=tr||c[1]>=tr}setupDepthForOcclusion(n,c,f){const y=this.context,x=y.gl,w=!!f;var A;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(x.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE0),w||c.setTerrainUniformValues(y,f)}}function Ef(p,n){let c=!1,f=null;const y=()=>{f=null,c&&(p(),f=setTimeout(y,n),c=!1)};return()=>(c=!0,f||y(),f)}class fg{constructor(n){this._hashName=n&&encodeURIComponent(n),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ef(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=Pf(n);if(this._hashName){const f=this._hashName;let y=!1;const x=location.hash.slice(1).split("&").map((w=>{const A=w.split("=")[0];return A===f?(y=!0,`${A}=${c}`):w})).filter((w=>w));return y||x.push(`${f}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some((f=>isNaN(Number(f))))){const f=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Pf(p,n){const c=p.getCenter(),f=Math.round(100*p.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),w=Math.round(c.lng*x)/x,A=Math.round(c.lat*x)/x,C=p.getBearing(),k=p.getPitch();let L=n?`/${w}/${A}/${f}`:`${f}/${A}/${w}`;return(C||k)&&(L+="/"+Math.round(10*C)/10),k&&(L+=`/${Math.round(k)}`),L}const ko={linearity:.3,easing:i.eK(0,0,.3,1)},pl=Object.assign({deceleration:2500,maxSpeed:1400},ko),hu=Object.assign({deceleration:20,maxSpeed:1400},ko),If=Object.assign({deceleration:1e3,maxSpeed:360},ko),pg=Object.assign({deceleration:1e3,maxSpeed:90},ko);class mg{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=i.o.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=du(c.pan.mag(),f,Object.assign({},pl,n||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,Pa(y,x)}if(c.zoom){const x=du(c.zoom,f,hu);y.zoom=this._map.transform.zoom+x.amount,Pa(y,x)}if(c.bearing){const x=du(c.bearing,f,If);y.bearing=this._map.transform.bearing+i.aA(x.amount,-179,179),Pa(y,x)}if(c.pitch){const x=du(c.pitch,f,pg);y.pitch=this._map.transform.pitch+x.amount,Pa(y,x)}if(y.zoom||y.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Pa(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function du(p,n,c){const{maxSpeed:f,linearity:y,deceleration:x}=c,w=i.aA(p*y/(n/1e3),-f,f),A=Math.abs(w)/(x*y);return{easing:c.easing,duration:1e3*A,amount:w*(A/2)}}class wi extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f,y={}){const x=Pe(c.getCanvasContainer(),f),w=c.unproject(x);super(n,Object.assign({point:x,lngLat:w,originalEvent:f},y)),this._defaultPrevented=!1,this.target=c}}class fu extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f){const y=n==="touchend"?f.changedTouches:f.touches,x=Ne(c.getCanvasContainer(),y),w=x.map((C=>c.unproject(C))),A=x.reduce(((C,k,L,V)=>C.add(k.div(V.length))),new i.P(0,0));super(n,{points:x,point:A,lngLats:w,lngLat:c.unproject(A),originalEvent:f}),this._defaultPrevented=!1}}class Cf extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class gg{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Cf(this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new wi(n.type,this._map,n))}mouseup(n){this._map.fire(new wi(n.type,this._map,n))}preclick(n){const c=new MouseEvent("preclick",n);this._map.fire(new wi(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new wi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new wi(n.type,this._map,n))}mouseover(n){this._map.fire(new wi(n.type,this._map,n))}mouseout(n){this._map.fire(new wi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new fu(n.type,this._map,n))}touchmove(n){this._map.fire(new fu(n.type,this._map,n))}touchend(n){this._map.fire(new fu(n.type,this._map,n))}touchcancel(n){this._map.fire(new fu(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _g{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new wi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new wi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oi{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(se(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const f=c,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(f)||!this._box&&f.dist(y)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=j("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(y.x,f.x),A=Math.max(y.x,f.x),C=Math.min(y.y,f.y),k=Math.max(y.y,f.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${w}px,${C}px)`,this._box.style.width=A-w+"px",this._box.style.height=k-C+"px")}))}mouseupWindow(n,c){if(!this._active)return;const f=this._startPos,y=c;if(f&&n.button===0){if(this.reset(),de(),f.x!==y.x||f.y!==y.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),J(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new i.z(n,{originalEvent:c}))}}function Eh(p,n){const c={};for(let f=0;f<p.length;f++)c[p[f].identifier]=n[f];return c}class yg{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=(function(y){const x=new i.P(0,0);for(const w of y)x._add(w);return x.div(y.length)})(c),this.touches=Eh(f,c)))}touchmove(n,c,f){if(this.aborted||!this.centroid)return;const y=Eh(f,c);for(const x in this.touches){const w=y[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,c,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Ph{constructor(n){this.singleTap=new yg(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,f){this.singleTap.touchstart(n,c,f)}touchmove(n,c,f){this.singleTap.touchmove(n,c,f)}touchend(n,c,f){const y=this.singleTap.touchend(n,c,f);if(y){const x=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(y)<30;if(x&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class sc{constructor(){this._zoomIn=new Ph({numTouches:1,numTaps:2}),this._zoomOut=new Ph({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,f){this._zoomIn.touchstart(n,c,f),this._zoomOut.touchstart(n,c,f)}touchmove(n,c,f){this._zoomIn.touchmove(n,c,f),this._zoomOut.touchmove(n,c,f)}touchend(n,c,f){const y=this._zoomIn.touchend(n,c,f),x=this._zoomOut.touchend(n,c,f);return y?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(y)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const vg={0:1,2:2},Of={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ih{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const f=rt(n);this._correctButton(n,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(n,c){const f=this._lastPoint;if(f){if(n.preventDefault(),this._eventButton!=null&&(function(y,x){const w=vg[x];return y.buttons===void 0||(y.buttons&w)!==w})(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(n){this._lastPoint&&rt(n)===this._eventButton&&(this._moved&&de(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pu extends Ih{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class Mf extends Ih{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Of[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const f=.8*(c.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Rf extends Ih{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Of[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const f=-.5*(c.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class xg{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(n,c,f){return this._calculateTransform(n,c,f)}touchmove(n,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!i.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,f)}}touchend(n,c,f){this._calculateTransform(n,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,f){f.length>0&&(this._active=!0);const y=Eh(f,c),x=new i.P(0,0),w=new i.P(0,0);let A=0;for(const k in y){const L=y[k],V=this._touches[k];V&&(x._add(L),w._add(L.sub(V)),A++,y[k]=L)}if(this._touches=y,A<this._minTouches||!w.mag())return;const C=w.div(A);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class mu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,f){return{}}touchstart(n,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,f){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[x,w]=y,A=gu(f,c,x),C=gu(f,c,w);if(!A||!C)return;const k=this._aroundCenter?null:A.add(C).div(2);return this._move([A,C],k,n)}touchend(n,c,f){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,w=gu(f,c,y),A=gu(f,c,x);w&&A||(this._active&&de(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function gu(p,n,c){for(let f=0;f<p.length;f++)if(p[f].identifier===c)return n[f]}function Df(p,n){return Math.log2(p/n)}class Dv extends mu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Df(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Df(this._distance,f),pinchAround:c}}}function bg(p,n){return 180*p.angleWith(n)/Math.PI}class kv extends mu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const f=this._vector;if(this._vector=n[0].sub(n[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bg(this._vector,f),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const y=bg(n,f);return Math.abs(y)<c}}function kf(p){return Math.abs(p.y)>Math.abs(p.x)}class Nv extends mu{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,kf(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,f){const y=this._lastPoints;if(!y)return;const x=n[0].sub(y[0]),w=n[1].sub(y[1]);return this._map._cooperativeGestures&&!i.eL()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,f.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(n,c,f){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=n.y>0==c.y>0;return kf(n)&&kf(c)&&w}}const Lv={panStep:100,bearingStep:15,pitchStep:10};class jv{constructor(){const n=Lv;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,f=0,y=0,x=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:A=>{const C=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:zv,zoom:c?Math.round(C)+c*(n.shiftKey?2:1):C,bearing:A.getBearing()+f*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zv(p){return p*(2-p)}const wg=4.000244140625,Fv=1/450;class Bv{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Fv,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||i.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=i.o.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%wg==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Pe(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>wg?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&L!==0&&(L=1/L);const V=c(),z=Math.pow(2,V),G=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(G*L))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,x=this._easing;let w,A=!1;if(this._type==="wheel"&&y&&x){const k=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),L=x(k);w=i.ak(y,f,L),k<1?this._frameId||(this._frameId=!0):A=!0}else w=f,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let C=w-c();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=i.eM;if(this._prevEase){const f=this._prevEase,y=(i.o.now()-f.start)/f.duration,x=f.easing(y+.01)-f.easing(y),w=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-w*w);c=i.eK(w,A,.25,1)}return this._prevEase={start:i.o.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Uv{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class h1{constructor(){this._tap=new Ph({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,c,f))}touchmove(n,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,c,f)}touchend(n,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,c,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class d1{constructor(n,c,f){this._el=n,this._mousePan=c,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class f1{constructor(n,c,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Hn{constructor(n,c,f,y){this._el=n,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ch=p=>p.zoom||p.drag||p.pitch||p.rotate;class p1 extends i.z{}class m1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const f=i.av([],c,n);this.radius=i.ag(f[2]<0?i.eO([],f,this.constants):[f[0],f[1],0])}projectRay(n){i.eO(n,n,this.constants),i.aw(n,n),i.eP(n,n,this.constants);const c=i.c4([],n,this.radius);if(c[2]>0){const f=i.c4([],[0,0,1],i.bJ(c,[0,0,1])),y=i.c4([],i.aw([],[c[0],c[1],0]),this.radius),x=i.d7([],c,i.c4([],i.av([],i.d7([],y,f),c),2));c[0]=x[0],c[1]=x[1]}return c}}function Nf(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Oh{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mg(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new m1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aY(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,w]of this._listeners){const A=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(x,A,w)}}destroy(){for(const[n,c,f]of this._listeners){const y=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(c,y,f)}}_addDefaultHandlers(n){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new gg(c,n));const y=c.boxZoom=new Oi(c,n);this._add("boxZoom",y);const x=new sc,w=new Vv;c.doubleClickZoom=new Uv(w,x),this._add("tapZoom",x),this._add("clickZoom",w);const A=new h1;this._add("tapDragZoom",A);const C=c.touchPitch=new Nv(c);this._add("touchPitch",C);const k=new Mf(n),L=new Rf(n);c.dragRotate=new f1(n,k,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const V=new pu(n),z=new xg(c,n);c.dragPan=new d1(f,V,z),this._add("mousePan",V),this._add("touchPan",z,["touchZoom","touchRotate"]);const G=new kv,W=new Dv;c.touchZoomRotate=new Hn(f,W,G,A),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new _g(c));const Z=c.scrollZoom=new Bv(c,this);this._add("scrollZoom",Z,["mousePan"]);const oe=c.keyboard=new jv;this._add("keyboard",oe);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[te]&&c[te].enable(n[te])}_add(n,c,f){this._handlers.push({handlerName:n,handler:c,allowed:f}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ch(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,f){for(const y in n)if(y!==f&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const f of n)this._el.contains(f.target)&&c.push(f);return c}handleEvent(n,c){this._updatingCamera=!0;const f=n.type==="renderFrame",y=f?void 0:n,x={needsRenderFrame:!1},w={},A={},C=n.touches?this._getMapTouches(n.touches):void 0,k=C?Ne(this._el,C):f?void 0:Pe(this._el,n);for(const{handlerName:z,handler:G,allowed:W}of this._handlers){if(!G.isEnabled())continue;let Z;this._blockedByActive(A,W,z)?G.reset():G[c||n.type]&&(Z=G[c||n.type](n,k,C),this.mergeHandlerResult(x,w,Z,z,y),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||G.isActive())&&(A[z]=G)}const L={};for(const z in this._previousActiveHandlers)A[z]||(L[z]=y);this._previousActiveHandlers=A,(Object.keys(L).length||Nf(x))&&(this._changes.push([x,w,L]),this._triggerRenderFrame()),(Object.keys(A).length||Nf(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=x;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,c,f,y,x){if(!f)return;Object.assign(n,f);const w={handlerName:y,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(c.zoom=w),f.panDelta!==void 0&&(c.drag=w),f.pitchDelta!==void 0&&(c.pitch=w),f.bearingDelta!==void 0&&(c.rotate=w)}_applyChanges(){const n={},c={},f={};for(const[y,x,w]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new i.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),Object.assign(c,x),Object.assign(f,w);this._updateMapTransform(n,c,f),this._changes=[]}_updateMapTransform(n,c,f){const y=this._map,x=y.transform,w=le=>[le.x,le.y,le.z];if((le=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!Nf(n)){const le=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),le!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!Nf(n))return void this._fireEvents(c,f,!0);let{panDelta:A,zoomDelta:C,bearingDelta:k,pitchDelta:L,around:V,aroundCoord:z,pinchAround:G}=n;x._isCameraConstrained&&(C>0&&(C=0),x._isCameraConstrained=!1),G!==void 0&&(V=G),(C||(le=>c[le]&&!this._eventsInProgress[le])("drag"))&&V&&(this._dragOrigin=w(x.pointCoordinate3D(V)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),V=V||y.transform.centerPoint,k&&(x.bearing+=k),L&&(x.pitch+=L),x._updateCameraState();const W=[0,0,0];if(A)if(x.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V).dir),fe=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V.sub(A)).dir);W[0]=fe[0]-le[0],W[1]=fe[1]-le[1]}else{const le=x.pointCoordinate(V);if(x.projection.name==="globe"){A=A.rotate(-x.angle);const fe=x._pixelsPerMercatorPixel/x.worldSize;W[0]=-A.x*i.eN(i.a$(le.y))*fe,W[1]=-A.y*i.eN(x.center.lat)*fe}else{const fe=x.pointCoordinate(V.sub(A));le&&fe&&(W[0]=fe.x-le.x,W[1]=fe.y-le.y)}}const Z=x.zoom,oe=[0,0,0];if(C){const le=w(z||x.pointCoordinate3D(V)),fe={dir:i.aw([],i.av([],le,x._camera.position))};if(fe.dir[2]<0){const me=x.zoomDeltaToMovement(le,C);i.c4(oe,fe.dir,me)}}const te=i.d7(W,W,oe);x._translateCameraConstrained(te),C&&Math.abs(x.zoom-Z)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,f,!0)}_fireEvents(n,c,f){const y=Ch(this._eventsInProgress),x=Ch(n),w={};for(const L in n){const{originalEvent:V}=n[L];this._eventsInProgress[L]||(w[`${L}start`]=V),this._eventsInProgress[L]=n[L]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const L in w)this._fireEvent(L,w[L]);x&&this._fireEvent("move",x.originalEvent);for(const L in n){const{originalEvent:V}=n[L];this._fireEvent(L,V)}const A={};let C;for(const L in this._eventsInProgress){const{handlerName:V,originalEvent:z}=this._eventsInProgress[L];this._handlersById[V].isActive()||(delete this._eventsInProgress[L],C=c[V]||z,A[`${L}end`]=C)}for(const L in A)this._fireEvent(L,A[L]);const k=Ch(this._eventsInProgress);if(f&&(y||x)&&!k){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;L?(V(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:C})):(this._map.fire(new i.z("moveend",{originalEvent:C})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new i.z(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{this._frameId=void 0,this.handleEvent(new p1("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Sg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Tg extends i.E{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,f){return n=i.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},c),f)}panTo(n,c,f){return this.easeTo(Object.assign({center:n},c),f)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,f){return this.easeTo(Object.assign({zoom:n},c),f)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,f){return this.easeTo(Object.assign({bearing:n},c),f)}resetNorth(n,c){return this.rotateTo(0,Object.assign({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=i.aI.convert(n);const f=c&&c.bearing||0,y=c&&c.pitch||0,x=n.getNorthWest(),w=n.getSouthEast();return this._cameraForBounds(this.transform,x,w,f,y,c)}_extendPadding(n){const c={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},c,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},c,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,c){const f=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return f/y>n.aspect?f/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,f,y,x,w){const A=n.clone(),C=this._extendCameraOptions(w);A.bearing=y,A.pitch=x;const k=i.aR.convert(c),L=i.aR.convert(f),V=.5*(k.lat+L.lat),z=.5*(k.lng+L.lng),G=i.eQ(V,z),W=i.aw([],G),Z=i.aw([],i.bI([],W,[0,1,0])),oe=i.bI([],Z,W),te=[Z[0],Z[1],Z[2],0,oe[0],oe[1],oe[2],0,W[0],W[1],W[2],0,0,0,0,1],le=[G,i.eQ(k.lat,k.lng),i.eQ(L.lat,k.lng),i.eQ(L.lat,L.lng),i.eQ(k.lat,L.lng),i.eQ(V,k.lng),i.eQ(V,L.lng),i.eQ(k.lat,z),i.eQ(L.lat,z)];let fe=i.d8.fromPoints(le.map((We=>[i.bJ(Z,We),i.bJ(oe,We),i.bJ(W,We)])));const me=i.af([],fe.center,te);i.eR(me)===0&&i.eS(me,0,0,1),i.aw(me,me),i.c4(me,me,i.aD),A.center=i.eT(me);const we=A.getWorldToCameraMatrix(),xe=i.bl(new Float64Array(16),we);fe=i.d8.applyTransform(fe,i.aB([],we,te));const Se=this._extendAABB(fe,A,C,y);if(!Se)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Se,i.af(me,me,we);const be=.5*(fe.max[2]-fe.min[2]),ve=this._minimumAABBFrustumDistance(A,fe),Te=i.c4([],[0,0,1],be),qe=i.d7(Te,me,Te),je=ve+(A.pitch===0?0:i.bG(me,qe)),tt=A.globeCenterInViewSpace,Ve=i.av([],me,[tt[0],tt[1],tt[2]]);i.aw(Ve,Ve),i.c4(Ve,Ve,je);const et=i.d7([],me,Ve);i.af(et,et,xe);const Et=i.eD/i.aD,$e=i.ag(et),Re=i.ce(Math.max($e*Et-i.eD,Number.EPSILON),0),at=Math.min(A.zoomFromMercatorZAdjusted(Re),C.maxZoom);return at>.5*(i.cZ+i.cK)?(A.setProjection({name:"mercator"}),A.zoom=at,this._cameraForBounds(A,c,f,y,x,w)):{center:A.center,zoom:at,bearing:y,pitch:x}}_extendAABB(n,c,f,y){const x=.5*((f.padding.left||0)+(f.padding.right||0)),w=.5*((f.padding.top||0)+(f.padding.bottom||0)),A=w,C=x,k=x,L=w,V=c.width-(C+k),z=c.height-(A+L),G=i.av([],n.max,n.min),W=Math.min(V/G[0],z/G[1]),Z=Math.min(c.scaleZoom(c.scale*W),f.maxZoom);if(isNaN(Z))return null;const oe=c.scale/c.zoomScale(Z),te=new i.d8([n.min[0]-C*oe,n.min[1]-L*oe,n.min[2]],[n.max[0]+k*oe,n.max[1]+A*oe,n.max[2]]),le=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new i.P(f.offset.x,f.offset.y):i.P.convert(f.offset)).rotate(-i.an(y));return te.center[0]-=le.x*oe,te.center[1]+=le.y*oe,te}queryTerrainElevation(n,c){const f=this.transform.elevation;return f?(c=Object.assign({},{exaggerated:!0},c),f.getAtPoint(i.ae.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,f,y,x,w){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,f,y,x,w);const A=n.clone(),C=this._extendCameraOptions(w);A.bearing=y,A.pitch=x;const k=i.aR.convert(c),L=i.aR.convert(f),V=new i.aR(k.lng,L.lat),z=new i.aR(L.lng,k.lat),G=A.project(k),W=A.project(L),Z=this.queryTerrainElevation(k),oe=this.queryTerrainElevation(L),te=this.queryTerrainElevation(V),le=this.queryTerrainElevation(z),fe=[[G.x,G.y,Math.min(Z||0,oe||0,te||0,le||0)],[W.x,W.y,Math.max(Z||0,oe||0,te||0,le||0)]];let me=i.d8.fromPoints(fe);const we=A.getWorldToCameraMatrix(),xe=i.bl(new Float64Array(16),we);me=i.d8.applyTransform(me,we);const Se=this._extendAABB(me,A,C,y);if(!Se)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Se;const be=.5*i.av([],me.max,me.min)[2],ve=this._minimumAABBFrustumDistance(A,me),Te=[0,0,1,0];i.aC(Te,Te,we),i.eU(Te,Te);const qe=i.c4([],Te,ve+be),je=i.d7([],me.center,qe);i.af(me.center,me.center,xe),i.af(je,je,xe);const tt=A.unproject(new i.P(me.center[0],me.center[1])),Ve=i.eV(A.projection,tt),et=Math.pow(2,Ve),Et=Math.min(A._zoomFromMercatorZ(je[2]*A.pixelsPerMeter*et/A.worldSize),C.maxZoom);return A.mercatorFromTransition&&Et<.5*(i.cZ+i.cK)?(A.setProjection({name:"globe"}),A.zoom=Et,this._cameraForBounds(A,c,f,y,x,w)):{center:tt,zoom:Et,bearing:y,pitch:x}}fitBounds(n,c,f){const y=this.cameraForBounds(n,c);return this._fitInternal(y,c,f)}fitScreenCoordinates(n,c,f,y,x){const w=i.P.convert(n),A=i.P.convert(c),C=new i.P(Math.min(w.x,A.x),Math.min(w.y,A.y)),k=new i.P(Math.max(w.x,A.x),Math.max(w.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,A))return this;const L=this.transform.pointLocation3D(C),V=this.transform.pointLocation3D(k),z=this.transform.pointLocation3D(new i.P(C.x,k.y)),G=this.transform.pointLocation3D(new i.P(k.x,C.y)),W=[Math.min(L.lng,V.lng,z.lng,G.lng),Math.min(L.lat,V.lat,z.lat,G.lat)],Z=[Math.max(L.lng,V.lng,z.lng,G.lng),Math.max(L.lat,V.lat,z.lat,G.lat)],oe=y&&y.pitch?y.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,W,Z,f,oe,y);return this._fitInternal(te,y,x)}_fitInternal(n,c,f){return n?(c=Object.assign(n,c)).linear?this.easeTo(c,f):this.flyTo(c,f):this}jumpTo(n,c){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,w=!1;"zoom"in n&&f.zoom!==+n.zoom&&(y=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=i.aR.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(x=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(w=!0,f.pitch=+n.pitch);const A=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!f.isPaddingEqual(A))if(n.retainPadding===!1){const C=f.clone();C.padding=A,f.setLocationAtPoint(f.center,C.centerPoint)}else f.padding=A;return n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),y&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),x&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),w&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Sg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const f=this.transform;if(!f.projection.supportsFreeCamera)return i.w(Sg),this;this.stop();const y=f.zoom,x=f.pitch,w=f.bearing;f.setFreeCameraOptions(n);const A=y!==f.zoom,C=x!==f.pitch,k=w!==f.bearing;return this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),A&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),k&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),C&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:i.eM},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const f=this.transform,y=this.getZoom(),x=this.getBearing(),w=this.getPitch(),A=this.getPadding(),C="zoom"in n?+n.zoom:y,k="bearing"in n?this._normalizeBearing(n.bearing,x):x,L="pitch"in n?+n.pitch:w,V=this._extendPadding(n.padding),z=i.P.convert(n.offset);let G,W,Z;if(f.projection.name==="globe"){const Te=i.ae.fromLngLat(f.center),qe=z.rotate(-f.angle);Te.x+=qe.x/f.worldSize,Te.y+=qe.y/f.worldSize;const je=Te.toLngLat(),tt=i.aR.convert(n.center||je);this._normalizeCenter(tt),G=f.centerPoint.add(qe),W=new i.P(Te.x,Te.y).mult(f.worldSize),Z=new i.P(i.aF(tt.lng),i.aJ(tt.lat)).mult(f.worldSize).sub(W)}else{G=f.centerPoint.add(z);const Te=f.pointLocation(G),qe=i.aR.convert(n.center||Te);this._normalizeCenter(qe),W=f.project(Te),Z=f.project(qe).sub(W)}const oe=f.zoomScale(C-y);let te,le;n.around&&(te=i.aR.convert(n.around),le=f.locationPoint(te));const fe=this._zooming||C!==y,me=this._rotating||x!==k,we=this._pitching||L!==w,xe=!f.isPaddingEqual(V),Se=n.retainPadding===!1?f.clone():f,be=Te=>qe=>{if(fe&&(Te.zoom=i.ak(y,C,qe)),me&&(Te.bearing=i.ak(x,k,qe)),we&&(Te.pitch=i.ak(w,L,qe)),xe&&(Se.interpolatePadding(A,V,qe),G=Se.centerPoint.add(z)),te)Te.setLocationAtPoint(te,le);else{const je=Te.zoomScale(Te.zoom-y),tt=C>y?Math.min(2,oe):Math.max(.5,oe),Ve=Math.pow(tt,1-qe),et=Te.unproject(W.add(Z.mult(qe*Ve)).mult(je));Te.setLocationAtPoint(Te.renderWorldCopies?et.wrap():et,G)}return n.preloadOnly||this._fireMoveEvents(c),Te};if(n.preloadOnly){const Te=this._emulate(be,n.duration,f);return this._preloadTiles(Te),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=me,this._pitching=we,this._padding=xe,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,ve),this._ease(be(f),(Te=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(c,Te)}),n),this}_prepareEase(n,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||f.moving||this.fire(new i.z("movestart",n)),this._zooming&&!f.zooming&&this.fire(new i.z("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new i.z("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new i.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new i.z("move",n)),this._zooming&&this.fire(new i.z("zoom",n)),this._rotating&&this.fire(new i.z("rotate",n)),this._pitching&&this.fire(new i.z("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new i.z("zoomend",n)),y&&this.fire(new i.z("rotateend",n)),x&&this.fire(new i.z("pitchend",n)),this.fire(new i.z("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const We=i.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(We,c)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eM},n);const f=this.transform,y=this.getZoom(),x=this.getBearing(),w=this.getPitch(),A=this.getPadding(),C="zoom"in n?i.aA(+n.zoom,f.minZoom,f.maxZoom):y,k="bearing"in n?this._normalizeBearing(n.bearing,x):x,L="pitch"in n?+n.pitch:w,V=this._extendPadding(n.padding),z=f.zoomScale(C-y),G=i.P.convert(n.offset);let W=f.centerPoint.add(G);const Z=f.pointLocation(W),oe=i.aR.convert(n.center||Z);this._normalizeCenter(oe);const te=f.project(Z),le=f.project(oe).sub(te);let fe=n.curve;const me=Math.max(f.width,f.height),we=me/z,xe=le.mag();if("minZoom"in n){const We=i.aA(Math.min(n.minZoom,y,C),f.minZoom,f.maxZoom),dt=me/f.zoomScale(We-y);fe=Math.sqrt(dt/xe*2)}const Se=fe*fe;function be(We){const dt=(we*we-me*me+(We?-1:1)*Se*Se*xe*xe)/(2*(We?we:me)*Se*xe);return Math.log(Math.sqrt(dt*dt+1)-dt)}function ve(We){return(Math.exp(We)-Math.exp(-We))/2}function Te(We){return(Math.exp(We)+Math.exp(-We))/2}const qe=be(0);let je=function(We){return Te(qe)/Te(qe+fe*We)},tt=function(We){return me*((Te(qe)*(ve(dt=qe+fe*We)/Te(dt))-ve(qe))/Se)/xe;var dt},Ve=(be(1)-qe)/fe;if(Math.abs(xe)<1e-6||!isFinite(Ve)){if(Math.abs(me-we)<1e-6)return this.easeTo(n,c);const We=we<me?-1:1;Ve=Math.abs(Math.log(we/me))/fe,tt=function(){return 0},je=function(dt){return Math.exp(We*fe*dt)}}n.duration="duration"in n?+n.duration:1e3*Ve/("screenSpeed"in n?+n.screenSpeed/fe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const et=x!==k,Et=L!==w,$e=!f.isPaddingEqual(V),Re=n.retainPadding===!1?f.clone():f,at=We=>dt=>{const At=dt*Ve,Lt=1/je(At);We.zoom=dt===1?C:y+We.scaleZoom(Lt),et&&(We.bearing=i.ak(x,k,dt)),Et&&(We.pitch=i.ak(w,L,dt)),$e&&(Re.interpolatePadding(A,V,dt),W=Re.centerPoint.add(G));const xt=dt===1?oe:We.unproject(te.add(le.mult(tt(At))).mult(Lt));return We.setLocationAtPoint(We.renderWorldCopies?xt.wrap():xt,W),We._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),We};if(n.preloadOnly){const We=this._emulate(at,n.duration,f);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=et,this._pitching=Et,this._padding=$e,this._prepareEase(c,!1),this._ease(at(f),(()=>this._afterEase(c)),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,c,f){f.animate===!1||f.duration===0?(n(1),c()):(this._easeStart=i.o.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=i.bT(n,-180,180);const f=Math.abs(n-c);return Math.abs(n-360-c)<f&&(n-=360),Math.abs(n+360-c)<f&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const f=n.lng-c.center.lng;n.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,f){const y=Math.ceil(15*c/1e3),x=[],w=n(f.clone());for(let A=0;A<=y;A++){const C=w(A/y);x.push(C.clone())}return x}_preloadTiles(n,c){}}class Mh{constructor(n={}){this.options=n,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact,f=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const y=j("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",f),this._innerContainer=j("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(n){const f=c.reduce(((y,x,w)=>(x.value&&(y+=`${x.key}=${x.value}${w<c.length-1?"&":""}`),y)),"?");n.href=`${i.e.FEEDBACK_URL}/${f}#${Pf(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._mergedSourceCaches;for(const y in c){const x=c[y];if(x.used){const w=x.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort(((y,x)=>y.length-x.length)),n=n.filter(((y,x)=>{for(let w=x+1;w<n.length;w++)if(n[w].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ja{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=j("div","mapboxgl-ctrl");const c=j("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const f=n[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Rh{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(c=>this._onIndoorUpdate({selectedFloorId:c.selectedFloorId,floors:c.floors}))),this._container}_createButton(n,c){const f=j("button",n,this._container);return f.type="button",f.addEventListener("click",c),f}_createSeparator(){return j("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,c){this._map&&(n.setAttribute("aria-label",c),n.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return void(this._container.style.display="none");const c=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const f=n.floors.sort(((y,x)=>x.levelOrder-y.levelOrder));c?(Array.from(this._container.children).forEach((y=>y.remove())),this.addCurrentFloors(f)):this.addCurrentFloors(f)}addCurrentFloors(n){for(let c=0;c<n.length;c++){const f=n[c],y=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(f.id),this._model&&(this._model.selectedFloorId=f.id),Array.from(this._container.children).forEach((x=>{x.classList.contains("mapboxgl-ctrl-level-button")&&x.classList.remove("mapboxgl-ctrl-level-button-selected")})),y.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(y,f.shortName),this._model&&f.id===this._model.selectedFloorId&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),c<n.length-1&&this._createSeparator()}}}class di{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const y of f)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Qa{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=i.dz((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,f){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+f}}const Dh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class kh extends i.z{constructor(n,c,f,y){const{point:x,lngLat:w,originalEvent:A,target:C}=n;super(n.type,{point:x,lngLat:w,originalEvent:A,target:C}),this.preventDefault=()=>{n.preventDefault()},this.id=c,this.interaction=f,this.feature=y}}class $v{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,c){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const f=c.filter;let y=c.type;f&&this.filters.set(n,i.b6(f)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const x=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,c)):x.size===0&&this.map.on(y,this.handleType),x.size===0&&this.interactionsByType.set(y,x),x.set(n,c),this.typeById.set(n,y)}get(n){const c=this.typeById.get(n);if(!c)return;const f=this.interactionsByType.get(c);return f?f.get(n):void 0}remove(n){const c=this.typeById.get(n);if(!c)return;this.typeById.delete(n),this.filters.delete(n);const f=this.interactionsByType.get(c);f&&(f.delete(n),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(c,this.handleType))}queryTargets(n,c){const f=[];for(const[y,x]of c)x.target&&f.push({targetId:y,target:x.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(n,f,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());c.length&&(n.type="mouseenter",this.handleType(n,c));const f=new Map;for(const[y,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||f.set(x.id,x);f.size&&(n.type="mouseleave",this.handleType(n,Array.from(f.values())))}handleOut(n){const c=Array.from(this.hoveredFeatures.values()).map((({feature:f})=>f));c.length&&(n.type="mouseleave",this.handleType(n,c)),this.hoveredFeatures.clear()}handleType(n,c){const f=n.type==="mouseenter";if(f&&!this.interactionsByType.has(n.type))return void i.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(n.type)).reverse(),x=!!c;c=c||this.queryTargets(n.point,y);let w=!1;const A=new Set;for(const C of c){for(const[k,L]of y){if(!L.target)continue;const V=C.variants?C.variants[k]:null;if(V){for(const z of V){if(Ks(z,C,A,k))continue;const G=new i.dt(C,z),W=eh(z,C,k);x&&(G.state=this.map.getFeatureState(G));const Z=f?this.prevHoveredFeatures.get(W):null,oe=new kh(n,k,L,G),te=Z?Z.stop:L.handler(oe);if(f&&this.hoveredFeatures.set(W,{feature:C,stop:te}),te!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[C,k]of y){const{handler:L,target:V}=k;if(!V&&L(new kh(n,C,k,null))!==!1)break}}}function g1(p,n){if(Array.isArray(p)&&Array.isArray(n)){const c=new Set(p),f=new Set(n);return c.size===f.size&&p.every((y=>f.has(y)))}return i.by(p,n)}const Nh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},_1={showCompass:!0,showZoom:!0,visualizePitch:!1};class y1{constructor(n,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Mf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new Rf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),se()}move(n,c){const f=this.map,y=this.mouseRotate.mousemoveWindow(n,c),x=y&&y.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,c),A=w&&w.pitchDelta;A&&f.setPitch(f.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){J(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Pe(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Pe(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ne(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Ne(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Lf(p,n,c){if(p=new i.aR(p.lng,p.lat),n){const f=new i.aR(p.lng-360,p.lat),y=new i.aR(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),w=c.locationPoint3D(p).distSqr(n),A=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint3D(f).distSqr(n)<w&&(A||Math.abs(f.lng-c.center.lng)<x)?p=f:c.locationPoint3D(y).distSqr(n)<w&&(A||Math.abs(y.lng-c.center.lng)<x)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const f=c.locationPoint3D(p);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Lh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ra={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class lc extends i.E{constructor(n,c){super(),(n instanceof HTMLElement||c)&&(n=Object.assign({element:n},c)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:y="#3FB1CE",scale:x=1,draggable:w=!1,clickTolerance:A=0,rotation:C=ra.rotation,rotationAlignment:k=ra.rotationAlignment,pitchAlignment:L=ra.pitchAlignment,occludedOpacity:V=ra.occludedOpacity,altitude:z=ra.altitude}=n||{};this._anchor=f,this._color=y,this._scale=x,this._draggable=w,this._clickTolerance=A,this._rotation=C,this._rotationAlignment=k,this._pitchAlignment=L,this._occludedOpacity=V,this._altitude=z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=i.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(Z=>{Z.preventDefault()})),this._element.addEventListener("mousedown",(Z=>{Z.preventDefault()}));const G=this._element.classList;for(const Z in Lh)G.remove(`mapboxgl-marker-anchor-${Z}`);G.add(`mapboxgl-marker-anchor-${this._anchor}`);const W=n&&n.className?n.className.trim().split(/\s+/):[];G.add(...W),this._popup=null}_createDefaultMarker(){const n=j("div"),c=$("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const f=$("radialGradient",{id:"shadowGradient"},$("defs",{},c));$("stop",{offset:"10%","stop-opacity":.4},f),$("stop",{offset:"100%","stop-opacity":.05},f),$("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return $("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),$("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),$("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=i.aR.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||ra.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,f=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const f=n.unproject(c,this._altitude),y=n.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const f=n.unproject(c,this._altitude);let y;n._showingGlobe()&&i.eY(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(f),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Lh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!n||f!=="map")return"";if(!c._showingGlobe()){const C=c.getPitch();return C?`rotateX(${C}deg)`:""}const y=i.cW(i.eZ(c.transform,this._lngLat)),x=n.sub(i.e_(c.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";const A=y/w;return`rotateX(${-x.y*A}deg) rotateY(${x.x*A}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let f=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const x=c.project(new i.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=c.project(new i.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);f=i.cW(Math.atan2(w.y,w.x))-90}else f=-c.getBearing();else if(y==="horizon"){const x=i.ah(4,6,c.getZoom()),w=i.e_(c.transform);w.y+=x*c.transform.height;const A=n.sub(w),C=i.cW(Math.atan2(A.y,A.x));f=(C>90?C-270:C+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Lf(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),c._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(n){return this._offset=i.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const c=this._map;if(!c)return;const f=this._pointerdownPos,y=this._positionDelta;if(f&&y){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(n.point.dist(f)<x)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,f=this._pos;c&&f&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(f),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||ra.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||ra.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||ra.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||ra.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ml={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},As={maxWidth:100,unit:"metric"},Es={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},cc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ia=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qv(p=new i.P(0,0),n="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(n){case"top":return new i.P(0,p);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-p);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(p,0);case"right":return new i.P(-p,0)}return new i.P(0,0)}return p instanceof i.P||Array.isArray(p)?i.P.convert(p):i.P.convert(p[n]||[0,0])}return{version:P,supported:H.supported,setRTLTextPlugin:i.f2,getRTLTextPluginStatus:i.f1,Map:class extends Tg{constructor(p){M.mark(I.create);const n=p;if((p=Object.assign({},Nh,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&i.eW(window)&&(p.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new bo(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new di,this._domRenderTaskQueue=new di,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},Dh,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new Je(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new cu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Oh(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||i.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this.indoor=new Gl(this),p.hash&&(this._hash=new fg(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Mh({customAttribution:p.customAttribution})),this._logoControl=new Ja,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(c=>{this._update(c.dataType==="style"),this.fire(new i.z(`${c.dataType}data`,c))})),this.on("dataloading",(c=>{this.fire(new i.z(`${c.dataType}dataloading`,c))})),this._interactions=new $v(this)}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new i.z("movestart",p)).fire(new i.z("move",p)),this.fire(new i.z("resize",p)),n&&this.fire(new i.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(i.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((n=>n.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map((n=>n==="auto"?navigator.language:n)):p}setLanguage(p){const n=this._parseLanguage(p);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,n=p.projection.name;let c;n==="globe"&&p.zoom>=i.cK?(p.setMercatorFromTransition(),c=!0):n==="mercator"&&p.zoom<i.cK&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,n){return this._updateProjection(p||n||{name:"mercator"})}_updateProjection(p){let n;return n=p.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,n){return this.transform.locationPoint3D(i.aR.convert(p),n)}unproject(p,n){return this.transform.pointLocation3D(i.P.convert(p),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,n,c){const f=y=>{let x=[];if(Array.isArray(n)){const w=n.filter((A=>this.getLayer(A)));x=w.length?this.queryRenderedFeatures(y,{layers:w}):[]}else x=this.queryRenderedFeatures(y,{target:n});return x};if(p==="mouseenter"||p==="mouseover"){let y=!1;return{listener:c,targets:n,delegates:{mousemove:w=>{const A=f(w.point);A.length?y||(y=!0,c.call(this,new wi(p,this,w.originalEvent,{features:A}))):y=!1},mouseout:()=>{y=!1}}}}if(p==="mouseleave"||p==="mouseout"){let y=!1;return{listener:c,targets:n,delegates:{mousemove:A=>{f(A.point).length?y=!0:y&&(y=!1,c.call(this,new wi(p,this,A.originalEvent)))},mouseout:A=>{y&&(y=!1,c.call(this,new wi(p,this,A.originalEvent)))}}}}{const y=x=>{const w=f(x.point);w.length&&(x.features=w,c.call(this,x),delete x.features)};return{listener:c,targets:n,delegates:{[p]:y}}}}on(p,n,c){if(typeof n=="function"||c===void 0)return super.on(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._createDelegatedListener(p,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(p,n,c){if(typeof n=="function"||c===void 0)return super.once(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._createDelegatedListener(p,n,c);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(p,n,c){if(typeof n=="function"||c===void 0)return super.off(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(y=>{for(let x=0;x<y.length;x++){const w=y[x];if(w.listener===c&&g1(w.targets,n)){for(const A in w.delegates)this.off(A,w.delegates[A]);return y.splice(x,1),this}}})(f),this}queryRenderedFeatures(p,n){if(!this.style)return[];if(p===void 0||p instanceof i.P||Array.isArray(p)||n!==void 0||(n=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!n){const x=this.style.queryRenderedFeatures(p,void 0,this.transform),w=this.style.queryRenderedFeatureset(p,void 0,this.transform);return x.concat(w)}let c=!0;if(n.target&&(c=this._isTargetValid(n.target),c&&!n.layers))return this.style.queryRenderedFeatureset(p,n,this.transform);let f=!0;if(n.layers&&Array.isArray(n.layers)){for(const x of n.layers)if(!this._isValidId(x)){f=!1;break}if(f&&!n.target)return this.style.queryRenderedFeatures(p,n,this.transform)}let y=[];return f&&(y=y.concat(this.style.queryRenderedFeatures(p,n,this.transform))),c&&(y=y.concat(this.style.queryRenderedFeatureset(p,n,this.transform))),y}querySourceFeatures(p,n){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,n)}queryRasterValue(p,n,c){return this._isValidId(p)?this.style.queryRasterValue(p,n,c):Promise.resolve(null)}isPointOnSurface(p){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&i.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(p))}addInteraction(p,n){return this._interactions.add(p,n),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&p&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(p,((c,f)=>{if(c){const y=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(p,n)}else f&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const c=Object.assign({},n);n&&n.config&&(c.initialConfig=n.config,delete c.config),this.style=new da(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new da(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dm(p)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const n of p)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(p)}addSource(p,n){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,n,{pixelRatio:c=1,sdf:f=!1,stretchX:y,stretchY:x,content:w}={}){this._lazyInitEmptyStyle();const A=i.I.from(p);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:C,height:k,data:L}=i.o.getImageData(n);this.style.addImage(A,{data:new i.q({width:C,height:k},L),pixelRatio:c,stretchX:y,stretchY:x,content:w,sdf:f,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=n,L=n;this.style.addImage(A,{data:new i.q({width:C,height:k},new Uint8Array(L.data)),pixelRatio:c,stretchX:y,stretchY:x,content:w,sdf:f,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,p)}}updateImage(p,n){this._lazyInitEmptyStyle();const c=i.I.from(p),f=this.style.getImage(c);if(!f)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?i.o.getImageData(n):n,{width:x,height:w,data:A}=y;if(x===void 0||w===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||w!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const C=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let k=!1;f.usvg?(f.data=new i.q({width:x,height:w},new Uint8Array(A)),f.usvg=!1,f.icon=void 0,k=!0):f.data.replace(A,C),this.style.updateImage(c,f,k)}hasImage(p){return p?!!this.style&&!!this.style.getImage(i.I.from(p)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(i.I.from(p))}loadImage(p,n){i.n(this._requestManager.transformRequest(p,i.R.Image),((c,f)=>{n(c,f instanceof HTMLImageElement?i.o.getImageData(f):f)}))}listImages(){return this.style.listImages().map((p=>p.name))}addModel(p,n){this._lazyInitEmptyStyle(),this.style.addModel(p,n)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,n){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)):this}getSlot(p){const n=this.getLayer(p);return n&&n.slot||null}setSlot(p,n){return this.style.setSlot(p,n),this.style.mergeLayers(),this._update(!0)}addImport(p,n){return this.style.addImport(p,n).catch((c=>this.fire(new i.y(new Error("Failed to add import",c))))),this}updateImport(p,n){return typeof n!="string"&&n.id!==p?(this.removeImport(p),this.addImport(n)):(this.style.updateImport(p,n),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,n){return this.style.moveImport(p,n),this._update(!0)}moveLayer(p,n){return this._isValidId(p)?(this.style.moveLayer(p,n),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const n=this.style.getOwnLayer(p);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,n,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,n,c),this._update(!0)):this}setFilter(p,n,c={}){return this._isValidId(p)?(this.style.setFilter(p,n,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,n,c,f={}){return this._isValidId(p)?(this.style.setPaintProperty(p,n,c,f),this._update(!0)):this}getPaintProperty(p,n){return this._isValidId(p)?this.style.getPaintProperty(p,n):null}setLayoutProperty(p,n,c,f={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,n,c,f),this._update(!0)):this}getLayoutProperty(p,n){return this._isValidId(p)?this.style.getLayoutProperty(p,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,n){return this.style.setSchema(p,n),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,n){return this.style.setConfig(p,n),this._update(!0)}getConfigProperty(p,n){return this.style.getConfigProperty(p,n)}setConfigProperty(p,n,c){return this.style.setConfigProperty(p,n,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const n=p[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,n),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aR.convert(p),this.transform):0}setFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,n),this._update())}removeFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,n),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Rh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,f,y,x=this._container;for(;x&&(!f||!y);){const w=window.getComputedStyle(x).transform;w&&w!=="none"&&(c=w.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),x=x.parentElement}this._containerWidth=f?Math.abs(p/f):p,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=j("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=j("div","mapboxgl-canvas-container",p);this._canvas=j("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=j("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((y=>{f[y]=j("div",`mapboxgl-ctrl-${y}`,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const c=i.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const n=this._popups.indexOf(p);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const p=Object.assign({},H.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",p);n?(jt(n,!0),this.painter=new dg(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),i.k.testSupport(n)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;this.fire(new i.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,f=i.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=y.createQuery(),y.beginQuery(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=this.transform.pitch,V=i.o.now(),z=new i.ac(k,{now:V,fadeDuration:x,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(f);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,M.mark(I.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const k=i.o.now()-f;y.endQuery(c.TIME_ELAPSED_EXT),setTimeout((()=>{const L=y.getQueryParameter(n,y.QUERY_RESULT)/1e6;y.deleteQuery(n),this.fire(new i.z("gpu-timing-frame",{cpuTime:k,gpuTime:L}))}),50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout((()=>{const L=this.painter.queryGpuTimers(k);this.fire(new i.z("gpu-timing-layer",{layerTimes:L}))}),50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const L=this.painter.queryGpuTimeDeferredRender(k);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:L}))}),50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(C||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(w=this._updateAverageElevation(f,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,M.mark(I.fullLoad),this._performanceMetricsCollection&&Dr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const n of this._markers)p&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!p||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(p,n=!1){const c=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const y=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const w=Math.abs(y-x);if(w>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,p,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){or(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(p=>{if(p&&(p.message===nt||p.status===401)){const n=this.painter.context.gl;jt(n,!1),this._logoControl instanceof Ja&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),an(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Fr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,f=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const w=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,w),w}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(y(p),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(p,n,c){let f=c[1]-c[0];const y=p.length/4;for(let x=0;x<n.length;x++){const w=n[x];let A=0;for(let C=0;C<w.length;C+=4)w[C]===p[C]&&w[C+1]===p[C+1]&&w[C+2]===p[C+2]&&w[C+3]===p[C+3]&&(A+=1);f+=(c[x+2]-c[x+1])*(1-A/y)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),br.delete(this.painter.context.gl),er.remove(),Tr.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=i.o.frame((n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)})))}_preloadTiles(p){const n=this.style?this.style.getSourceCaches():[];return i.bw(n,((c,f)=>c._preloadTiles(p,f)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,n){i.eX(p,n)}get version(){return P}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},_1,p),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(n=>{this._map&&this._map.zoomIn({},{originalEvent:n})})),j("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(n=>{this._map&&this._map.zoomOut({},{originalEvent:n})})),j("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))})),this._compassIcon=j("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const n=p.getZoom(),c=n===p.getMaxZoom(),f=n===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=n)}))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new y1(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,n){const c=j("button",p,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(p,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(p={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},ml,p),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ef(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((c=>n(c.state!=="denied"))).catch((()=>n())):n()}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),c=p.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",p)),this._finish()}}_updateCamera(p){const n=new i.aR(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,f=this._map.getBearing(),y=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new i.aR(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,n=i.ce(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=j("button","mapboxgl-ctrl-geolocate",this._container),j("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j("div","mapboxgl-user-location"),this._dotElement.appendChild(j("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new lc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))}))}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((n=>{n==="granted"&&p()})).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mh,ScaleControl:class{constructor(p={}){this.options=Object.assign({},As,p),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,f=n._containerWidth/2-p/2,y=n.unproject([f,c]),x=n.unproject([f+p,c]),w=y.distanceTo(x);if(this.options.unit==="imperial"){const A=3.2808*w;A>5280?this._setScale(p,A/5280,"mile"):this._setScale(p,A,"foot")}else this.options.unit==="nautical"?this._setScale(p,w/1852,"nautical-mile"):w>=1e3?this._setScale(p,w/1e3,"kilometer"):this._setScale(p,w,"meter")}_setScale(p,n,c){this._map._requestDomTask((()=>{const f=(function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let A=x/w;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(C){const k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k})(A),w*A})(n),y=f/n;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(f):`${f}&nbsp;${Es[c]}`,this._container.style.width=p*y+"px"}))}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=j("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Rh,Popup:class extends i.E{constructor(p){super(),this.options=Object.assign(Object.create(cc),p),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=i.aR.convert(p),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const n=document.createDocumentFragment(),c=document.createElement("body");let f;for(c.innerHTML=p;f=c.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=j("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(p),this.options.closeButton){const c=this._closeButton=j("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._updateClassList(),n}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,f=this._pos;if(!n||!c||!f)return"bottom";const y=c.offsetWidth,x=c.offsetHeight,w=f.x<y/2,A=f.x>n.transform.width-y/2;if(f.y+p<x)return w?"top-left":A?"top-right":"top";if(f.y>n.transform.height-x){if(w)return"bottom-left";if(A)return"bottom-right"}return w?"left":A?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),p.className=n.join(" ")}_update(p){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=j("div","mapboxgl-popup",n.getContainer()),this._tip=j("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lf(this._lngLat,this._pos,n.transform)),!this._trackPointer||p){const y=this._pos=this._trackPointer&&p instanceof i.P?p:n.project(this._lngLat,this._altitude),x=qv(this.options.offset),w=this._anchor=this._getAnchor(x.y),A=qv(this.options.offset,w),C=y.add(A).round();n._requestDomTask((()=>{this._container&&w&&(this._container.style.transform=`${Lh[w]} translate(${C.x}px,${C.y}px)`)}))}if(!this._marker&&n._showingGlobe()){const y=i.eY(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Ia);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:lc,Style:da,LngLat:i.aR,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:Pm,Evented:i.E,config:i.e,prewarm:i.f0,clearPrewarmedResources:i.e$,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(p){i.e.ACCESS_TOKEN=p},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(p){i.e.API_URL=p},get workerCount(){return i.f9.workerCount},set workerCount(p){i.f9.workerCount=p},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){i.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){i.f8(p)},get workerUrl(){return i.f7.workerUrl},set workerUrl(p){i.f7.workerUrl=p},get workerClass(){return i.f7.workerClass},set workerClass(p){i.f7.workerClass=p},get workerParams(){return i.f7.workerParams},set workerParams(p){i.f7.workerParams=p},get dracoUrl(){return i.f6()},set dracoUrl(p){i.f5(p)},get meshoptUrl(){return i.f4()},set meshoptUrl(p){i.f3(p)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}}));var v=d;return v}))})(y0)),y0.exports}var Rye=Mye();const Fa=si(Rye);window.mapboxgl=Fa;const LG="***REMOVED***";window.mapboxDebug={tokenAvailable:!0,mapboxglAvailable:typeof Fa<"u",tokenLength:LG.length};function Dye(){const e=ie.useRef(null),t=ie.useRef(null),[a,l]=ie.useState({wifi:!0,ble:!0,bluetooth:!0,cellular:!0}),{data:d,isLoading:_}=Po({queryKey:["/api/v1/g63/visualize"],refetchInterval:3e4}),v=()=>{if(!navigator.geolocation||!t.current){console.error("Geolocation is not supported by this browser");return}navigator.geolocation.getCurrentPosition(I=>{const{latitude:M,longitude:R}=I.coords;t.current.flyTo({center:[R,M],zoom:14,duration:1e3})},I=>{console.error("Error getting location:",I)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})};ie.useEffect(()=>{if(!(!e.current||t.current)){console.log("Initializing map with token:","Token provided"),console.log("mapboxgl available:",typeof Fa<"u");try{Fa.accessToken=LG;const I=new Fa.Map({container:e.current,style:"mapbox://styles/mapbox/dark-v11",center:[-83.697,43.023],zoom:12,pitch:0,bearing:0});return console.log("Map instance created successfully"),I.addControl(new Fa.NavigationControl,"top-right"),I.addControl(new Fa.FullscreenControl,"top-right"),t.current=I,I.on("load",()=>{console.log("Map loaded successfully and ready for data")}),I.on("error",M=>{console.error("Map error:",M)}),()=>{I&&I.remove()}}catch(I){console.error("Failed to initialize map:",I)}}},[]),ie.useEffect(()=>{if(!t.current||!d)return;const I=()=>{if(!t.current)return;const F={type:"FeatureCollection",features:(d?.data?.features||[]).filter(q=>{const H=q.properties.radio_type;return a[H]})};if(t.current.getSource("networks")){t.current.getSource("networks").setData(F);return}t.current.addSource("networks",{type:"geojson",data:F}),t.current.addLayer({id:"networks-layer",type:"circle",source:"networks",paint:{"circle-radius":["case",[">=",["get","signal_strength"],-40],15,[">=",["get","signal_strength"],-60],12,[">=",["get","signal_strength"],-80],8,5],"circle-color":["case",["==",["get","radio_type"],"wifi"],"#22c55e",["==",["get","radio_type"],"ble"],"#a855f7",["==",["get","radio_type"],"bluetooth"],"#3b82f6",["==",["get","radio_type"],"cellular"],"#ef4444","#9ca3af"],"circle-opacity":.8,"circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-stroke-opacity":.6}}),t.current.addLayer({id:"networks-labels",type:"symbol",source:"networks",filter:[">",["get","signal_strength"],-50],layout:{"text-field":["get","ssid"],"text-font":["DIN Pro Medium","Arial Unicode MS Regular"],"text-size":11,"text-anchor":"bottom","text-offset":[0,-1.5],"text-allow-overlap":!1,"text-ignore-placement":!1},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":1}}),t.current.on("click","networks-layer",q=>{const H=t.current?.queryRenderedFeatures(q.point,{layers:["networks-layer"]});if(!H?.length)return;const $=H[0].properties;if(!$)return;const Y=`
          <div class="premium-card p-3 max-w-xs text-sm">
            <div class="font-medium text-slate-200 mb-1">${$.ssid||"Hidden Network"}</div>
            <div class="text-xs text-slate-400 font-mono mb-2">${$.bssid||"N/A"}</div>
            <div class="grid grid-cols-2 gap-2 text-xs">
              <div>
                <span class="text-slate-400">Type:</span>
                <div class="text-slate-300 capitalize">${$.radio_type||"Unknown"}</div>
              </div>
              <div>
                <span class="text-slate-400">Signal:</span>
                <div class="text-slate-300">${$.signal_strength||"N/A"}dBm</div>
              </div>
              <div>
                <span class="text-slate-400">Security:</span>
                <div class="text-slate-300">${$.security_level||"Unknown"}</div>
              </div>
              <div>
                <span class="text-slate-400">Freq:</span>
                <div class="text-slate-300">${$.frequency||"N/A"}MHz</div>
              </div>
            </div>
          </div>
        `;new Fa.Popup({closeButton:!1,closeOnClick:!0,className:"mapbox-popup-custom"}).setLngLat(q.lngLat).setHTML(Y).addTo(t.current)}),t.current.on("mouseenter","networks-layer",()=>{t.current&&(t.current.getCanvas().style.cursor="pointer")}),t.current.on("mouseleave","networks-layer",()=>{t.current&&(t.current.getCanvas().style.cursor="")})};t.current.loaded()?I():t.current.on("load",I)},[d,a]);const P=d?(d?.data?.features||[]).filter(M=>{const R=M.properties.radio_type;return a[R]}):[];return _?T.jsx(Mu,{className:"h-96"}):T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"premium-card",children:[T.jsx(us,{children:T.jsxs(hs,{className:"text-slate-300 flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"icon-container w-8 h-8 mr-2",children:T.jsx(L7,{className:"h-4 w-4 text-cyan-300"})}),"Enhanced SIGINT Visualization (",P.length," observations)"]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsxs(Ii,{variant:"outline",size:"sm",onClick:v,className:"gap-2 premium-card hover:scale-105",children:[T.jsx(gd,{className:"h-4 w-4"}),"GPS Center"]}),T.jsxs(DG,{children:[T.jsx(kG,{asChild:!0,children:T.jsxs(Ii,{variant:"outline",size:"sm",className:"gap-2 premium-card hover:scale-105",children:[T.jsx(tC,{className:"h-4 w-4"}),"Radio Types",T.jsx("div",{className:"silver-accent px-2 py-1 rounded-full ml-1",children:T.jsxs("span",{className:"text-xs font-semibold text-slate-700",children:[Object.values(a).filter(Boolean).length,"/4"]})})]})}),T.jsxs(UO,{align:"end",className:"w-48 premium-card",children:[T.jsx(VO,{children:"Filter by Radio Type"}),T.jsx($O,{}),T.jsx(bc,{checked:a.wifi,onCheckedChange:I=>l(M=>({...M,wifi:I})),children:T.jsxs("span",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),"WiFi Networks"]})}),T.jsx(bc,{checked:a.ble,onCheckedChange:I=>l(M=>({...M,ble:I})),children:T.jsxs("span",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500"}),"BLE Beacons"]})}),T.jsx(bc,{checked:a.bluetooth,onCheckedChange:I=>l(M=>({...M,bluetooth:I})),children:T.jsxs("span",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Bluetooth Devices"]})}),T.jsx(bc,{checked:a.cellular,onCheckedChange:I=>l(M=>({...M,cellular:I})),children:T.jsxs("span",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),"Cellular Towers"]})})]})]})]})]})}),T.jsx(Hi,{children:T.jsx("div",{className:"relative",children:T.jsx("div",{ref:e,className:"w-full h-[500px] rounded-lg overflow-hidden border border-border/30",style:{minHeight:"500px"}})})})]}),T.jsxs("div",{className:"premium-card",children:[T.jsx(us,{children:T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx("div",{className:"icon-container w-8 h-8 mr-2",children:T.jsx(id,{className:"h-4 w-4 text-green-300"})}),"Individual Observations (",P.length,")"]})}),T.jsx(Hi,{children:T.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[P.map((I,M)=>{const R=I.properties,F=I.geometry?.coordinates,q=H=>{switch(H){case"wifi":return"bg-green-500";case"ble":return"bg-purple-500";case"bluetooth":return"bg-blue-500";case"cellular":return"bg-red-500";default:return"bg-slate-500"}};return T.jsx("div",{className:"p-3 border border-border/30 rounded-lg bg-background/40 hover:bg-muted/50 transition-colors",children:T.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[T.jsxs("div",{children:[T.jsx("p",{className:"font-medium text-slate-200",children:R.ssid||"Hidden Network"}),T.jsx("p",{className:"text-xs text-slate-400 font-mono",children:R.bssid})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-slate-400",children:"Radio Type"}),T.jsxs("div",{className:"flex items-center gap-1",children:[T.jsx("div",{className:`w-2 h-2 rounded-full ${q(R.radio_type)}`}),T.jsx("span",{className:"text-xs font-medium capitalize text-slate-300",children:R.radio_type})]}),T.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Signal: ",R.signal_strength,"dBm"]})]}),T.jsxs("div",{children:[T.jsx("p",{className:"text-xs text-slate-400",children:"Location"}),T.jsx("p",{className:"text-xs font-mono text-slate-300",children:F?`${F[1]?.toFixed(4)}, ${F[0]?.toFixed(4)}`:"N/A"}),T.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Security: ",R.security_level||"Unknown"]})]})]})},M)}),P.length===0&&T.jsx("div",{className:"text-center py-8 text-slate-400",children:T.jsx("p",{children:"No observation data available"})})]})})]})]})}const b_=new Map,J5=[0,60,120,180,240,270,300,330];function eP(e){let t=0;for(let a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t),t|=0;return Math.abs(t)}function kye(e){if(!e||e.length<6)return"#999999";const t=e.replace(/[^0-9A-F]/gi,"");if(t.length<6)return"#999999";const a=t.substring(0,6),l=t.substring(6),d=J5[eP(a)%J5.length],_=50+eP(l)%41,v=40+eP(l)%31;return`hsl(${d}, ${_}%, ${v}%)`}function Nye(e,t,a){if(!e||e===null)return 50;const l=`${e}_${t}_${Math.round(a*10)}`;if(b_.has(l))return b_.get(l);let d=t;typeof d=="string"&&(d=parseFloat(d.replace(" GHz",""))*1e3),(!d||d<=0)&&(d=2437);let _;e>=-30?_=10:e>=-50?_=50:e>=-70?_=150:e>=-80?_=300:_=500,d>5e3?_*=.6:_*=.8;const v=Math.pow(2,a-12)*.1;let i=_*v;const P=Math.pow(1.15,a-10);return i*=Math.min(P,4),i=Math.max(3,Math.min(i,250)),b_.set(l,i),b_.size>1e3&&b_.clear(),i}function Lye(e){return e?e.toUpperCase().replace(/[^0-9A-F]/g,"").match(/.{1,2}/g)?.join(":")||e:""}function jye(e){return!e||e<=0?"":(e/1e3).toFixed(3).replace(/\.000$/,"")+" GHz"}function zye(e){return e>=-50?"signal-strong":e>=-70?"signal-medium":"signal-weak"}function Q5(e,t){const a=Math.abs(e),l=Math.floor(a),d=(a-l)*60,_=Math.floor(d),v=((d-_)*60).toFixed(2),i=t?e>=0?"N":"S":e>=0?"E":"W";return`${l}${_}'${v}" ${i}`}function Fye(e){if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime())){const a=e.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/);if(a){const l=new Date(parseInt(a[1]),parseInt(a[2])-1,parseInt(a[3]),parseInt(a[4]),parseInt(a[5]),parseInt(a[6]));if(!isNaN(l.getTime()))return l.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}return""}return t.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}catch(t){return console.error("Error formatting date:",t,e),""}}function Bye(e){return`<svg class="protocol-icon" viewBox="0 0 24 24" fill="${e}" stroke="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>`}function Uye({networks:e,mapboxToken:t,onNetworkClick:a}){const l=ie.useRef(null),d=ie.useRef(null),[_,v]=ie.useState(!1);return ie.useEffect(()=>{if(!(!l.current||!t)&&!d.current)return Fa.accessToken=t,d.current=new Fa.Map({container:l.current,style:"mapbox://styles/mapbox/standard",center:[-83.6875,43.0125],zoom:3,maxZoom:20}),d.current.on("error",i=>{console.error("Mapbox Error:",i.error.message)}),d.current.on("style.load",()=>{d.current&&(d.current.setProjection({type:"globe"}),d.current.setFog({}),d.current.setConfigProperty("basemap","lightPreset","day"),v(!0))}),d.current.on("load",()=>{d.current&&(d.current.addControl(new Fa.NavigationControl,"top-left"),setTimeout(()=>{d.current&&d.current.resize()},250))}),()=>{d.current&&(d.current.remove(),d.current=null)}},[t]),ie.useEffect(()=>{if(!d.current||!_||!e.length)return;const i=d.current,P=e.map(q=>{const H=i.getZoom(),j=q.properties.signal_strength||null,$=q.properties.frequency||0,Y=q.properties.bssid,K=Nye(j,$,H),re=kye(Y);return{...q,properties:{...q.properties,calculatedRadius:K,colour:re,mac:Lye(Y),freq:$?jye($):"",signal:j}}}),I={type:"FeatureCollection",features:P};i.getSource("wifi")?i.getSource("wifi").setData(I):i.addSource("wifi",{type:"geojson",data:I}),i.getLayer("hover")||i.addLayer({id:"hover",type:"circle",source:"wifi",filter:["==","uid",""],paint:{"circle-radius":["case",["!=",["get","signal"],null],["get","calculatedRadius"],20],"circle-color":["get","colour"],"circle-opacity":.15,"circle-stroke-color":["get","colour"],"circle-stroke-width":2,"circle-stroke-opacity":.4}}),i.getLayer("pts")||i.addLayer({id:"pts",type:"circle",source:"wifi",paint:{"circle-radius":5,"circle-color":["get","colour"],"circle-stroke-color":"#111","circle-stroke-width":1}});const M=q=>{if(!q.features||q.features.length===0)return;const H=q.features[0],j=H.properties,$=H.geometry.coordinates;if(!j)return;let Y='<div class="tooltip-content" style="background: #1e293b; border: 1px solid #475569; border-radius: 8px; padding: 12px; color: #e2e8f0; font-family: system-ui, -apple-system, sans-serif; min-width: 200px;">';if(Y+='<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 16px; font-weight: 600;">',Y+=`<span style="color:${j.colour}">${j.ssid||"(hidden)"}</span>`,Y+=Bye(j.colour),Y+="</div>",j.mac&&typeof j.mac=="string"&&j.mac.trim()&&(Y+=`<div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 13px;"><span style="color: #94a3b8;">MAC:</span><span style="font-family: monospace; color: #e2e8f0;">${j.mac}</span></div>`),j.freq&&typeof j.freq=="string"&&j.freq.trim()&&(Y+=`<div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 13px;"><span style="color: #94a3b8;">Frequency:</span><span style="color: #60a5fa;">${j.freq}</span></div>`),typeof j.signal=="number"&&!isNaN(j.signal)){const re=zye(j.signal);Y+=`<div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 13px;"><span style="color: #94a3b8;">Signal:</span><span style="color: ${re==="signal-strong"?"#22c55e":re==="signal-medium"?"#eab308":"#ef4444"}; font-weight: 600;">${j.signal} dBm</span></div>`}j.encryption&&typeof j.encryption=="string"&&j.encryption.trim()&&j.encryption!=="Unknown"&&(Y+=`<div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 13px;"><span style="color: #94a3b8;">Encryption:</span><span style="color: #e2e8f0;">${j.encryption.toUpperCase()}</span></div>`),(typeof j.latitude=="number"&&isFinite(j.latitude)||typeof j.longitude=="number"&&isFinite(j.longitude))&&(Y+='<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #475569; font-size: 12px;">',typeof j.latitude=="number"&&isFinite(j.latitude)&&(Y+=`<div style="margin: 2px 0; color: #94a3b8;"><span>Lat:</span> <span style="color: #e2e8f0;">${Q5(j.latitude,!0)}</span></div>`),typeof j.longitude=="number"&&isFinite(j.longitude)&&(Y+=`<div style="margin: 2px 0; color: #94a3b8;"><span>Lon:</span> <span style="color: #e2e8f0;">${Q5(j.longitude,!1)}</span></div>`),Y+="</div>");const K=j.observed_at;if(K){const re=Fye(K);re&&(Y+=`<div style="margin-top: 8px; font-size: 11px; color: #94a3b8;"><span>Seen:</span> <span style="color: #e2e8f0;">${re}</span></div>`)}Y+="</div>",new Fa.Popup({closeButton:!1,maxWidth:"350px"}).setLngLat($).setHTML(Y).addTo(i),i.setFilter("hover",["==","bssid",j.bssid]),a&&a(H)},R=q=>{if(!q.features||q.features.length===0)return;const j=q.features[0].properties;j&&j.bssid&&(i.setFilter("hover",["==","bssid",j.bssid]),i.getCanvas().style.cursor="pointer")},F=()=>{i.setFilter("hover",["==","bssid",""]),i.getCanvas().style.cursor=""};if(i.on("click","pts",M),i.on("mousemove","pts",R),i.on("mouseleave","pts",F),P.length>0){const q=P.map(H=>H.geometry.coordinates);if(q.length===1)i.flyTo({center:q[0],zoom:15,duration:800});else{const H=q.reduce((j,$)=>j.extend($),new Fa.LngLatBounds(q[0],q[0]));i.fitBounds(H,{padding:80,duration:600,maxZoom:17})}}return()=>{i.off("click","pts",M),i.off("mousemove","pts",R),i.off("mouseleave","pts",F)}},[e,_,a]),ie.useEffect(()=>{if(!d.current||!_)return;const i=()=>{if(!d.current)return;const P=d.current.getSource("wifi");if(P){const I=P._data;I&&P.setData(I)}};return d.current.on("zoomend",i),()=>{d.current&&d.current.off("zoomend",i)}},[_]),T.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[T.jsx("div",{ref:l,style:{width:"100%",height:"100%",borderRadius:"8px",overflow:"hidden"}}),!_&&T.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#94a3b8",fontSize:"14px"},children:"Loading map..."})]})}function Vye(){const{data:e}=Po({queryKey:["/api/v1/config"],queryFn:async()=>(await fetch("/api/v1/config")).json()}),{data:t,isLoading:a}=Po({queryKey:["/api/v1/g63/visualize"],queryFn:async()=>{const _=await(await fetch("/api/v1/g63/visualize?limit=500")).json();return _.ok?_.data.features:[]},refetchInterval:3e4,staleTime:15e3}),l=e?.mapboxToken||"***REMOVED***";return a?T.jsx("div",{className:"w-full h-[600px] flex items-center justify-center",children:T.jsxs("div",{className:"space-y-4 w-full max-w-2xl",children:[T.jsx(Mu,{className:"h-8 w-48"}),T.jsx(Mu,{className:"h-96 w-full"}),T.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[T.jsx(Mu,{className:"h-16"}),T.jsx(Mu,{className:"h-16"}),T.jsx(Mu,{className:"h-16"})]})]})}):!t||t.length===0?T.jsx("div",{className:"w-full h-[600px] flex items-center justify-center",children:T.jsxs("div",{className:"text-center space-y-2",children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-300",children:"No Network Data"}),T.jsx("p",{className:"text-sm text-slate-400",children:"No network observations found. Upload data to visualize."})]})}):T.jsxs("div",{className:"w-full",style:{height:"600px"},children:[T.jsx("div",{className:"mb-4 flex items-center justify-between",children:T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-300",children:"Network Map"}),T.jsxs("p",{className:"text-sm text-slate-400",children:[t.length," network",t.length!==1?"s":""," | Click for details | Hover for signal range"]})]})}),T.jsx(Uye,{networks:t,mapboxToken:l,onNetworkClick:d=>{console.log("Network clicked:",d)}})]})}function $ye(){const{toast:e}=Qp(),[t,a]=ie.useState({latitude:"",longitude:"",radius:"",limit:"50"}),[l,d]=ie.useState(null),[_,v]=ie.useState("all"),[i,P]=ie.useState("all"),{data:I}=Po({queryKey:["/api/v1/status"],queryFn:()=>po.getSystemStatus(),refetchInterval:5e3}),M=V4({mutationFn:async()=>{const j=parseFloat(t.latitude),$=parseFloat(t.longitude),Y=parseFloat(t.radius),K=parseInt(t.limit);return po.spatialQuery(j,$,Y,K)},onSuccess:j=>{d(j),e({title:"Query Successful",description:`Found ${j.count} networks within ${t.radius}m`})},onError:j=>{e({title:"Query Failed",description:j.message||"Failed to execute spatial query",variant:"destructive"})}}),R=I?.database.connected,F=I?.database.postgisEnabled,q=()=>{if(!t.latitude||!t.longitude||!t.radius){e({title:"Missing Parameters",description:"Please fill in latitude, longitude, and radius",variant:"destructive"});return}M.mutate()},H=(j,$)=>{a(Y=>({...Y,[j]:$}))};return T.jsxs("div",{className:"premium-card mb-8",children:[T.jsxs("div",{className:"p-6 border-b border-border/20",children:[T.jsxs("h3",{className:"text-lg font-semibold text-blue-300 flex items-center gap-2",children:[T.jsx("div",{className:"icon-container w-8 h-8 mr-2",children:T.jsx(gd,{className:"h-4 w-4 text-blue-300"})}),"Spatial Query Interface"]}),T.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Search for networks within geographic bounds"})]}),T.jsxs("div",{className:"p-6",children:[T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium mb-2",children:"Latitude"}),T.jsx("input",{type:"number",placeholder:"37.7749",step:"0.0001",value:t.latitude,onChange:j=>H("latitude",j.target.value),disabled:!R,className:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm font-mono focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50","data-testid":"input-latitude"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium mb-2",children:"Longitude"}),T.jsx("input",{type:"number",placeholder:"-122.4194",step:"0.0001",value:t.longitude,onChange:j=>H("longitude",j.target.value),disabled:!R,className:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm font-mono focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50","data-testid":"input-longitude"})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium mb-2",children:"Radius (meters)"}),T.jsxs("select",{value:t.radius,onChange:j=>H("radius",j.target.value),disabled:!R,className:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50","data-testid":"select-radius",children:[T.jsx("option",{value:"",children:"Select radius"}),T.jsx("option",{value:"100",children:"100m - Building"}),T.jsx("option",{value:"500",children:"500m - Block"}),T.jsx("option",{value:"1000",children:"1km - Neighborhood"}),T.jsx("option",{value:"2000",children:"2km - District"}),T.jsx("option",{value:"5000",children:"5km - City Area"}),T.jsx("option",{value:"10000",children:"10km - Metropolitan"})]})]})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium mb-2",children:"Encryption Type"}),T.jsxs("select",{value:_,onChange:j=>v(j.target.value),disabled:!R,className:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50","data-testid":"select-encryption",children:[T.jsx("option",{value:"all",children:"All Types"}),T.jsx("option",{value:"open",children:"Open Networks"}),T.jsx("option",{value:"wep",children:"WEP Encryption"}),T.jsx("option",{value:"wpa",children:"WPA/WPA2"}),T.jsx("option",{value:"wpa3",children:"WPA3"})]})]}),T.jsxs("div",{children:[T.jsx("label",{className:"block text-sm font-medium mb-2",children:"Signal Strength"}),T.jsxs("select",{value:i,onChange:j=>P(j.target.value),disabled:!R,className:"w-full px-3 py-2 bg-input border border-border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50","data-testid":"select-signal",children:[T.jsx("option",{value:"all",children:"All Strengths"}),T.jsx("option",{value:"strong",children:"Strong (-30 to -60 dBm)"}),T.jsx("option",{value:"medium",children:"Medium (-60 to -80 dBm)"}),T.jsx("option",{value:"weak",children:"Weak (-80+ dBm)"})]})]})]}),T.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[T.jsxs("button",{onClick:q,disabled:!R||!F||M.isPending,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed hover:bg-primary/90","data-testid":"execute-spatial-query-button",children:[T.jsx("i",{className:"fas fa-search mr-2"}),M.isPending?"Executing...":"Execute Spatial Query"]}),T.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[T.jsx("i",{className:`fas ${R&&F?"fa-check-circle text-accent":"fa-info-circle"}`}),T.jsx("span",{children:R?F?"Ready for spatial queries":"PostGIS extension required":"Database connection required"})]})]}),l&&T.jsxs("div",{className:"border border-border rounded-md p-4 bg-muted/50",children:[T.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Query Results"}),T.jsxs("div",{className:"text-xs font-mono space-y-1",children:[T.jsxs("div",{children:["Found: ",l.count," networks"]}),T.jsxs("div",{children:["Query: lat=",l.query?.latitude,", lon=",l.query?.longitude,", radius=",l.query?.radius,"m"]}),l.data&&l.data.length>0&&T.jsxs("div",{className:"mt-2 max-h-40 overflow-y-auto",children:[T.jsx("pre",{className:"text-xs",children:JSON.stringify(l.data.slice(0,3),null,2)}),l.data.length>3&&T.jsxs("div",{className:"text-muted-foreground",children:["... and ",l.data.length-3," more"]})]})]})]})]})]})}var Cw="Collapsible",[qye,jG]=Gs(Cw),[Gye,qO]=qye(Cw),zG=ie.forwardRef((e,t)=>{const{__scopeCollapsible:a,open:l,defaultOpen:d,disabled:_,onOpenChange:v,...i}=e,[P,I]=Il({prop:l,defaultProp:d??!1,onChange:v,caller:Cw});return T.jsx(Gye,{scope:a,disabled:_,contentId:Cl(),open:P,onOpenToggle:ie.useCallback(()=>I(M=>!M),[I]),children:T.jsx(yn.div,{"data-state":ZO(P),"data-disabled":_?"":void 0,...i,ref:t})})});zG.displayName=Cw;var FG="CollapsibleTrigger",GO=ie.forwardRef((e,t)=>{const{__scopeCollapsible:a,...l}=e,d=qO(FG,a);return T.jsx(yn.button,{type:"button","aria-controls":d.contentId,"aria-expanded":d.open||!1,"data-state":ZO(d.open),"data-disabled":d.disabled?"":void 0,disabled:d.disabled,...l,ref:t,onClick:Pr(e.onClick,d.onOpenToggle)})});GO.displayName=FG;var HO="CollapsibleContent",WO=ie.forwardRef((e,t)=>{const{forceMount:a,...l}=e,d=qO(HO,e.__scopeCollapsible);return T.jsx(Rc,{present:a||d.open,children:({present:_})=>T.jsx(Hye,{...l,ref:t,present:_})})});WO.displayName=HO;var Hye=ie.forwardRef((e,t)=>{const{__scopeCollapsible:a,present:l,children:d,..._}=e,v=qO(HO,a),[i,P]=ie.useState(l),I=ie.useRef(null),M=ui(t,I),R=ie.useRef(0),F=R.current,q=ie.useRef(0),H=q.current,j=v.open||i,$=ie.useRef(j),Y=ie.useRef(void 0);return ie.useEffect(()=>{const K=requestAnimationFrame(()=>$.current=!1);return()=>cancelAnimationFrame(K)},[]),Co(()=>{const K=I.current;if(K){Y.current=Y.current||{transitionDuration:K.style.transitionDuration,animationName:K.style.animationName},K.style.transitionDuration="0s",K.style.animationName="none";const re=K.getBoundingClientRect();R.current=re.height,q.current=re.width,$.current||(K.style.transitionDuration=Y.current.transitionDuration,K.style.animationName=Y.current.animationName),P(l)}},[v.open,l]),T.jsx(yn.div,{"data-state":ZO(v.open),"data-disabled":v.disabled?"":void 0,id:v.contentId,hidden:!j,..._,ref:M,style:{"--radix-collapsible-content-height":F?`${F}px`:void 0,"--radix-collapsible-content-width":H?`${H}px`:void 0,...e.style},children:j&&d})});function ZO(e){return e?"open":"closed"}var BG=zG,Wye=GO,Zye=WO;const Xye=BG,Kye=GO,Yye=WO;function UG(e,t={}){if(!e)return"Unknown";const a=new Date(e);if(isNaN(a.getTime()))return"Invalid Date";const{includeTime:l=!0,includeSeconds:d=!0,includeMilliseconds:_=!1,timeZone:v=Intl.DateTimeFormat().resolvedOptions().timeZone,locale:i=navigator.language}=t,P={timeZone:v,year:"numeric",month:"2-digit",day:"2-digit"};l&&(P.hour="2-digit",P.minute="2-digit",P.hour12=!1,d&&(P.second="2-digit"));let I=a.toLocaleString(i,P);if(l&&_){const M=a.getMilliseconds().toString().padStart(3,"0");I+=`.${M}`}return I}function Jye(e){if(!e)return"Unknown";const t=new Date(e);if(isNaN(t.getTime()))return"Invalid Date";const a=Intl.DateTimeFormat().resolvedOptions().timeZone,l=UG(e,{includeSeconds:!0,includeMilliseconds:!1}),d=t.toLocaleTimeString("en-US",{timeZone:a,timeZoneName:"short"}).split(" ").pop();return`${l} ${d}`}function Qye(e){if(!e)return"Unknown";const t=new Date(e);if(isNaN(t.getTime()))return"Invalid Date";const l=new Date().getTime()-t.getTime(),d=Math.floor(l/(1e3*60)),_=Math.floor(d/60),v=Math.floor(_/24);return d<1?"Just now":d<60?`${d}m ago`:_<24?`${_}h ago`:v<30?`${v}d ago`:UG(e,{includeTime:!1})}function eve(e){if(!e)return{short:"Open",full:"Open Network",level:"none",flags:["OPEN"]};const t=e.toUpperCase(),a=[];if(t.includes("SAE")||t.includes("WPA3"))return t.includes("EAP")?(a.push("WPA3-ENT"),{short:"WPA3-E",full:"WPA3 Enterprise",level:"high",auth:"EAP",cipher:w_(t),flags:[...a,...mc(t)]}):(a.push("WPA3-PSK"),{short:"WPA3-P",full:"WPA3 Personal",level:"high",auth:"PSK",cipher:w_(t),flags:[...a,...mc(t)]});if(t.includes("WPA2")||t.includes("RSN")){if(t.includes("EAP"))return a.push("WPA2-ENT"),{short:"WPA2-E",full:"WPA2 Enterprise",level:"high",auth:"EAP",cipher:w_(t),flags:[...a,...mc(t)]};if(t.includes("PSK"))return a.push("WPA2-PSK"),{short:"WPA2-P",full:"WPA2 Personal",level:"high",auth:"PSK",cipher:w_(t),flags:[...a,...mc(t)]}}return t.includes("WPA-")&&t.includes("PSK")?(a.push("WPA-PSK"),{short:"WPA-P",full:"WPA Personal",level:"medium",auth:"PSK",cipher:w_(t),flags:[...a,...mc(t)]}):t.includes("OWE")?(a.push("OWE"),{short:"OWE",full:"Opportunistic Wireless Encryption",level:"medium",flags:[...a,...mc(t)]}):t.includes("WEP")?(a.push("WEP"),{short:"WEP",full:"WEP (Deprecated)",level:"low",cipher:"WEP",flags:[...a,...mc(t)]}):t.includes("[ESS]")&&!t.includes("RSN")&&!t.includes("WPA")&&!t.includes("OWE")&&!t.includes("WEP")?(a.push("OPEN"),{short:"Open",full:"Open Network",level:"none",flags:[...a,...mc(t)]}):{short:"Unknown",full:`Unknown Security: ${e}`,level:"unknown",flags:[...a,...mc(t)]}}function tve(e,t){if(!e)return{short:"",full:"Not Applicable",level:"unknown",flags:[]};const a=e.toLowerCase();if(a.includes("lte"))return{short:"LTE",full:"LTE Encrypted",level:"high",cipher:"AES",flags:["LTE","CELLULAR"]};if(a.includes("gsm"))return{short:"GSM",full:"GSM Encrypted",level:"medium",cipher:"A5",flags:["GSM","CELLULAR"]};if(a==="misc"||a.includes("uncategorized")){const l=t?.toUpperCase()||"BLE";return{short:l,full:`${l} Device`,level:"medium",flags:[l,"PAIRING"]}}if(a.includes(";")){const[l,d]=a.split(";"),_=l.replace(/\b\w/g,v=>v.toUpperCase());return{short:_,full:`${_} Device (ID: ${d})`,level:"medium",flags:[_,"DEVICE_ID"]}}return{short:"Other",full:e,level:"unknown",flags:["OTHER"]}}function w_(e){return e.includes("CCMP")&&e.includes("TKIP")?"CCMP+TKIP":e.includes("CCMP")?"CCMP":e.includes("TKIP")?"TKIP":"Unknown"}function mc(e){const t=[];return e.includes("WPS")&&t.push("WPS"),e.includes("FT")&&t.push("FAST_TRANSITION"),e.includes("PSK-SHA256")&&t.push("SHA256"),e.includes("MFPC")&&t.push("MGMT_FRAME_PROTECTION"),e.includes("ESS")&&t.push("INFRASTRUCTURE"),e.includes("IBSS")&&t.push("AD_HOC"),t}function e4(e){switch(e){case"high":return"text-green-600";case"medium":return"text-amber-600";case"low":return"text-orange-600";case"none":return"text-red-600";default:return"text-gray-500"}}function rve(){const[e,t]=ie.useState(!0),[a,l]=ie.useState({wifi:!0,cell:!0,bluetooth:!0,ble:!0}),[d,_]=ie.useState("observed_at"),[v,i]=ie.useState("desc"),{data:P}=Po({queryKey:["/api/v1/status"],queryFn:()=>po.getSystemStatus(),refetchInterval:5e3}),{data:I,isLoading:M,error:R}=Po({queryKey:["/api/v1/networks"],queryFn:()=>po.getNetworks(20),enabled:P?.database.connected,refetchInterval:1e4}),F=P?.database.connected,q=(I?.data||[]).filter(re=>{const se=$(re);return a[se]}).sort((re,se)=>{let J,ae;switch(d){case"ssid":J=(re.ssid||"").toLowerCase(),ae=(se.ssid||"").toLowerCase();break;case"bssid":J=re.bssid||"",ae=se.bssid||"";break;case"frequency":J=re.frequency||0,ae=se.frequency||0;break;case"signal_strength":J=re.signal_strength||-100,ae=se.signal_strength||-100;break;case"observed_at":J=new Date(re.observed_at||0).getTime(),ae=new Date(se.observed_at||0).getTime();break;default:return 0}return v==="asc"?J<ae?-1:J>ae?1:0:J>ae?-1:J<ae?1:0}),H=re=>{d===re?i(v==="asc"?"desc":"asc"):(_(re),i("asc"))},j=re=>d!==re?T.jsx(F7,{className:"h-4 w-4 text-muted-foreground"}):v==="asc"?T.jsx(B7,{className:"h-4 w-4 text-primary"}):T.jsx(U7,{className:"h-4 w-4 text-primary"});function $(re){const{bssid:se,ssid:J,frequency:ae,encryption:de}=re;return/^\d+_\d+_\d+$/.test(se)||de?.includes("LTE;")?"cell":J&&(/bluetooth|bt|headphone|speaker|mouse|keyboard/i.test(J)||de?.includes("BT"))?"bluetooth":de==="Misc"||de==="Uncategorized"||de?.includes("Uncategorized;")||de?.includes("Laptop;")||de?.includes("Smartphone;")||de?.includes("Headphones;")||de?.includes("Display/Speaker;")||de?.includes("Handsfree;")||de&&/.*;[0-9]+$/.test(de)||J&&/echo|dot|alexa|dell|hp|macbook|fitbit|tile|beacon|ble|jlab|airpods|microsoft/i.test(J)||ae===0||ae>0&&ae<=500?"ble":"wifi"}const Y=Object.values(a).filter(Boolean).length,K=Object.keys(a).length;return T.jsx("div",{className:"premium-card",children:T.jsxs(Xye,{open:e,onOpenChange:t,children:[T.jsx("div",{className:"p-6 border-b border-border/20",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx(Kye,{asChild:!0,children:T.jsx(Ii,{variant:"ghost",size:"sm",className:"p-0 h-auto",children:e?T.jsx(Ib,{size:20}):T.jsx(f4,{size:20})})}),T.jsxs("div",{children:[T.jsxs("h3",{className:"text-lg font-semibold text-green-300 flex items-center gap-2",children:[T.jsx("div",{className:"icon-container w-8 h-8 mr-2",children:T.jsx(nP,{className:"h-4 w-4 text-green-300"})}),"Observed Networks"]}),T.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"All detected radio signals: WiFi, Cellular, Bluetooth"})]})]}),T.jsx("div",{className:"flex items-center gap-2",children:T.jsxs(DG,{children:[T.jsx(kG,{asChild:!0,children:T.jsxs(Ii,{variant:"outline",size:"sm",className:"gap-2",children:[T.jsx(tC,{size:16}),"Radio Types",Y<K&&T.jsx("div",{className:"silver-accent px-2 py-1 rounded-full ml-1",children:T.jsxs("span",{className:"text-xs font-semibold text-slate-700",children:[Y,"/",K]})})]})}),T.jsxs(UO,{align:"end",className:"w-48",children:[T.jsx(VO,{children:"Filter by Radio Type"}),T.jsx($O,{}),T.jsxs(bc,{checked:a.wifi,onCheckedChange:re=>l(se=>({...se,wifi:re})),children:[T.jsx(nd,{className:"h-4 w-4 mr-2 text-blue-300"}),"WiFi Networks"]}),T.jsxs(bc,{checked:a.cell,onCheckedChange:re=>l(se=>({...se,cell:re})),children:[T.jsx(oP,{className:"h-4 w-4 mr-2 text-green-300"}),"Cellular Towers"]}),T.jsxs(bc,{checked:a.bluetooth,onCheckedChange:re=>l(se=>({...se,bluetooth:re})),children:[T.jsx(iP,{className:"h-4 w-4 mr-2 text-purple-300"}),"Bluetooth"]}),T.jsxs(bc,{checked:a.ble,onCheckedChange:re=>l(se=>({...se,ble:re})),children:[T.jsx(v0,{className:"h-4 w-4 mr-2 text-purple-300"}),"Bluetooth LE"]})]})]})})]})}),T.jsx(Yye,{children:T.jsx("div",{className:"p-6",children:F?M?T.jsx("div",{className:"space-y-4",children:[...Array(5)].map((re,se)=>T.jsxs("div",{className:"animate-pulse border border-border rounded-md p-4",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("div",{className:"h-4 bg-muted rounded w-32"}),T.jsx("div",{className:"h-3 bg-muted rounded w-16"})]}),T.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[T.jsx("div",{className:"h-3 bg-muted rounded"}),T.jsx("div",{className:"h-3 bg-muted rounded"}),T.jsx("div",{className:"h-3 bg-muted rounded"}),T.jsx("div",{className:"h-3 bg-muted rounded"})]})]},se))}):R?T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4",children:T.jsx("i",{className:"fas fa-exclamation-triangle text-2xl text-destructive"})}),T.jsx("h4",{className:"text-lg font-medium mb-2 text-destructive",children:"Error Loading Networks"}),T.jsx("p",{className:"text-muted-foreground",children:R?.message||"Failed to load network observations"})]}):I&&I.data&&I.data.length>0?T.jsxs("div",{className:"space-y-4","data-testid":"networks-list",children:[T.jsxs("div",{className:"grid grid-cols-5 gap-2 px-4 py-2 bg-muted/30 rounded-lg border",children:[T.jsxs(Ii,{variant:"ghost",size:"sm",className:"justify-start text-xs font-medium hover:bg-muted",onClick:()=>H("ssid"),children:["Network ",j("ssid")]}),T.jsxs(Ii,{variant:"ghost",size:"sm",className:"justify-start text-xs font-medium hover:bg-muted",onClick:()=>H("bssid"),children:["BSSID ",j("bssid")]}),T.jsxs(Ii,{variant:"ghost",size:"sm",className:"justify-start text-xs font-medium hover:bg-muted",onClick:()=>H("frequency"),children:["Frequency ",j("frequency")]}),T.jsxs(Ii,{variant:"ghost",size:"sm",className:"justify-start text-xs font-medium hover:bg-muted",onClick:()=>H("signal_strength"),children:["Signal ",j("signal_strength")]}),T.jsxs(Ii,{variant:"ghost",size:"sm",className:"justify-start text-xs font-medium hover:bg-muted",onClick:()=>H("observed_at"),children:["Last Seen ",j("observed_at")]})]}),q.map(re=>{const se=$(re);return T.jsxs("div",{className:"border border-border rounded-md p-4 hover:bg-muted/50 transition-colors",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsxs("div",{className:"icon-container w-6 h-6 mr-2",children:[se==="wifi"&&T.jsx(nd,{className:"h-3 w-3 text-blue-300"}),se==="cell"&&T.jsx(oP,{className:"h-3 w-3 text-green-300"}),se==="bluetooth"&&T.jsx(iP,{className:"h-3 w-3 text-purple-300"}),se==="ble"&&T.jsx(v0,{className:"h-3 w-3 text-purple-300"})]}),T.jsx("h5",{className:"font-medium",children:re.ssid||"Hidden Network"}),T.jsx("div",{className:"silver-accent px-2 py-1 rounded-full",children:T.jsx("span",{className:"text-xs font-semibold text-slate-700",children:se.toUpperCase()})}),T.jsx("span",{className:"px-2 py-1 text-xs bg-primary/20 text-primary rounded font-mono",children:re.bssid})]}),T.jsxs("div",{className:"text-right",children:[T.jsx("div",{className:"text-xs text-muted-foreground",children:Jye(re.observed_at)}),T.jsx("div",{className:"text-xs text-muted-foreground/60",children:Qye(re.observed_at)})]})]}),T.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[T.jsxs("div",{className:"text-muted-foreground",children:["Frequency: ",T.jsx("span",{className:"text-foreground",children:re.frequency?`${re.frequency} MHz`:"N/A"})]}),T.jsxs("div",{className:"text-muted-foreground",children:["Signal: ",T.jsx("span",{className:"text-foreground font-mono",children:re.signal_strength!==void 0&&re.signal_strength!==null?`${re.signal_strength} dBm`:"N/A"})]}),T.jsxs("div",{className:"text-muted-foreground",children:["Security: ",(()=>{const J=se==="wifi"?eve(re.encryption):tve(re.encryption,se),ae=J.level==="high"?j7:J.level==="medium"?Us:z7;return T.jsxs("span",{className:"flex items-center gap-1",children:[T.jsx(ae,{className:`h-3 w-3 ${e4(J.level)}`}),T.jsx("span",{className:`${e4(J.level)} font-medium`,children:J.short})]})})()]}),T.jsxs("div",{className:"text-muted-foreground",children:["Location: ",T.jsx("span",{className:"text-foreground font-mono",children:re.latitude&&re.longitude?`${parseFloat(re.latitude).toFixed(6)}, ${parseFloat(re.longitude).toFixed(6)}`:"N/A"})]})]})]},re.bssid)}),T.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",q.length," of ",I.data.length," total observations",Y<K&&T.jsx("span",{className:"ml-2 text-primary",children:"(filtered by radio type)"})]})]}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"icon-container w-16 h-16 mx-auto mb-4",children:T.jsx(nP,{className:"h-8 w-8 text-muted-foreground"})}),T.jsx("h4",{className:"text-lg font-medium mb-2",children:"No Network Observations"}),T.jsx("p",{className:"text-muted-foreground mb-4",children:"No radio signals have been detected yet. Data will appear here as observations are collected."}),T.jsxs("div",{className:"flex items-center justify-center gap-4 text-xs text-muted-foreground",children:[T.jsxs("div",{className:"flex items-center gap-1",children:[T.jsx("i",{className:"fas fa-wifi text-blue-600"}),T.jsx("span",{children:"WiFi"})]}),T.jsxs("div",{className:"flex items-center gap-1",children:[T.jsx("i",{className:"fas fa-signal text-green-600"}),T.jsx("span",{children:"Cellular"})]}),T.jsxs("div",{className:"flex items-center gap-1",children:[T.jsx("i",{className:"fab fa-bluetooth text-purple-600"}),T.jsx("span",{children:"Bluetooth"})]}),T.jsxs("div",{className:"flex items-center gap-1",children:[T.jsx("i",{className:"fab fa-bluetooth-b text-purple-600"}),T.jsx("span",{children:"BLE"})]})]})]}):T.jsxs("div",{className:"text-center py-12",children:[T.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:T.jsx("i",{className:"fas fa-database text-2xl text-muted-foreground"})}),T.jsx("h4",{className:"text-lg font-medium mb-2",children:"No Database Connection"}),T.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Network observations will appear here once you restore your PostgreSQL database backup with PostGIS extension."}),T.jsxs("div",{className:"space-y-2 text-xs font-mono text-muted-foreground",children:[T.jsxs("div",{className:"flex items-center justify-center gap-2",children:[T.jsx("span",{className:"w-2 h-2 bg-destructive rounded-full"}),T.jsx("span",{children:"GET /api/v1/networks  501 Not Implemented"})]}),T.jsxs("div",{className:"flex items-center justify-center gap-2",children:[T.jsx("span",{className:"w-2 h-2 bg-destructive rounded-full"}),T.jsx("span",{children:"GET /api/v1/within  501 Not Implemented"})]})]})]})})})]})})}var Ow="Tabs",[nve]=Gs(Ow,[Tw]),VG=Tw(),[ive,XO]=nve(Ow),$G=ie.forwardRef((e,t)=>{const{__scopeTabs:a,value:l,onValueChange:d,defaultValue:_,orientation:v="horizontal",dir:i,activationMode:P="automatic",...I}=e,M=Vy(i),[R,F]=Il({prop:l,onChange:d,defaultProp:_??"",caller:Ow});return T.jsx(ive,{scope:a,baseId:Cl(),value:R,onValueChange:F,orientation:v,dir:M,activationMode:P,children:T.jsx(yn.div,{dir:M,"data-orientation":v,...I,ref:t})})});$G.displayName=Ow;var qG="TabsList",GG=ie.forwardRef((e,t)=>{const{__scopeTabs:a,loop:l=!0,...d}=e,_=XO(qG,a),v=VG(a);return T.jsx(Cq,{asChild:!0,...v,orientation:_.orientation,dir:_.dir,loop:l,children:T.jsx(yn.div,{role:"tablist","aria-orientation":_.orientation,...d,ref:t})})});GG.displayName=qG;var HG="TabsTrigger",WG=ie.forwardRef((e,t)=>{const{__scopeTabs:a,value:l,disabled:d=!1,..._}=e,v=XO(HG,a),i=VG(a),P=KG(v.baseId,l),I=YG(v.baseId,l),M=l===v.value;return T.jsx(Oq,{asChild:!0,...i,focusable:!d,active:M,children:T.jsx(yn.button,{type:"button",role:"tab","aria-selected":M,"aria-controls":I,"data-state":M?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:P,..._,ref:t,onMouseDown:Pr(e.onMouseDown,R=>{!d&&R.button===0&&R.ctrlKey===!1?v.onValueChange(l):R.preventDefault()}),onKeyDown:Pr(e.onKeyDown,R=>{[" ","Enter"].includes(R.key)&&v.onValueChange(l)}),onFocus:Pr(e.onFocus,()=>{const R=v.activationMode!=="manual";!M&&!d&&R&&v.onValueChange(l)})})})});WG.displayName=HG;var ZG="TabsContent",XG=ie.forwardRef((e,t)=>{const{__scopeTabs:a,value:l,forceMount:d,children:_,...v}=e,i=XO(ZG,a),P=KG(i.baseId,l),I=YG(i.baseId,l),M=l===i.value,R=ie.useRef(M);return ie.useEffect(()=>{const F=requestAnimationFrame(()=>R.current=!1);return()=>cancelAnimationFrame(F)},[]),T.jsx(Rc,{present:d||M,children:({present:F})=>T.jsx(yn.div,{"data-state":M?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":P,hidden:!F,id:I,tabIndex:0,...v,ref:t,style:{...e.style,animationDuration:R.current?"0s":void 0},children:F&&_})})});XG.displayName=ZG;function KG(e,t){return`${e}-trigger-${t}`}function YG(e,t){return`${e}-content-${t}`}var ove=$G,JG=GG,QG=WG,e8=XG;const t8=ove,KO=ie.forwardRef(({className:e,...t},a)=>T.jsx(JG,{ref:a,className:Nn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));KO.displayName=JG.displayName;const zs=ie.forwardRef(({className:e,...t},a)=>T.jsx(QG,{ref:a,className:Nn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));zs.displayName=QG.displayName;const Fs=ie.forwardRef(({className:e,...t},a)=>T.jsx(e8,{ref:a,className:Nn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Fs.displayName=e8.displayName;function t4(){return T.jsx("div",{className:"flex-1 flex flex-col overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:T.jsx("main",{className:"flex-1 overflow-y-auto",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[T.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 shadow-lg shadow-green-500/30",children:T.jsx(gd,{className:"h-6 w-6 text-white"})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(59,130,246,0.5)]",children:"Geospatial Intelligence"}),T.jsx("p",{className:"text-sm text-slate-400 cyber-text tracking-wide mt-1",children:"Interactive mapping and spatial analysis of network observations"})]})]}),T.jsxs(t8,{defaultValue:"mapbox",className:"w-full",children:[T.jsx("div",{className:"premium-card p-2 mb-6",children:T.jsxs(KO,{className:"grid w-full grid-cols-4 bg-transparent",children:[T.jsx(zs,{value:"mapbox","data-testid":"tab-mapbox",className:"premium-card hover:scale-105",children:"Network Map"}),T.jsx(zs,{value:"gis","data-testid":"tab-unified-gis",className:"premium-card hover:scale-105",children:"Unified GIS"}),T.jsx(zs,{value:"spatial","data-testid":"tab-spatial",className:"premium-card hover:scale-105",children:"Spatial Queries"}),T.jsx(zs,{value:"observations","data-testid":"tab-observations",className:"premium-card hover:scale-105",children:"Observations"})]})}),T.jsx(Fs,{value:"mapbox",className:"space-y-6",children:T.jsx("div",{className:"premium-card p-6",children:T.jsx(Vye,{})})}),T.jsx(Fs,{value:"gis",className:"space-y-6",children:T.jsx("div",{className:"premium-card p-6",children:T.jsx(Dye,{})})}),T.jsx(Fs,{value:"spatial",className:"space-y-6",children:T.jsx("div",{className:"premium-card p-6",children:T.jsx($ye,{})})}),T.jsx(Fs,{value:"observations",className:"space-y-6",children:T.jsx("div",{className:"premium-card p-6",children:T.jsx(rve,{})})})]})]})})})}const YO=ie.forwardRef(({className:e,type:t,...a},l)=>T.jsx("input",{type:t,className:Nn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...a}));YO.displayName="Input";function r4(e,[t,a]){return Math.min(a,Math.max(t,e))}function ave(e){const t=ie.useRef({value:e,previous:e});return ie.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var sve=[" ","Enter","ArrowUp","ArrowDown"],lve=[" ","Enter"],pd="Select",[Mw,Rw,cve]=Cy(pd),[fm]=Gs(pd,[cve,im]),Dw=im(),[uve,Hu]=fm(pd),[hve,dve]=fm(pd),r8=e=>{const{__scopeSelect:t,children:a,open:l,defaultOpen:d,onOpenChange:_,value:v,defaultValue:i,onValueChange:P,dir:I,name:M,autoComplete:R,disabled:F,required:q,form:H}=e,j=Dw(t),[$,Y]=ie.useState(null),[K,re]=ie.useState(null),[se,J]=ie.useState(!1),ae=Vy(I),[de,Pe]=Il({prop:l,defaultProp:d??!1,onChange:_,caller:pd}),[Ne,rt]=Il({prop:v,defaultProp:i,onChange:P,caller:pd}),ke=ie.useRef(null),Ze=$?H||!!$.closest("form"):!0,[nt,Je]=ie.useState(new Set),ot=Array.from(nt).map(it=>it.props.value).join(";");return T.jsx(SC,{...j,children:T.jsxs(uve,{required:q,scope:t,trigger:$,onTriggerChange:Y,valueNode:K,onValueNodeChange:re,valueNodeHasChildren:se,onValueNodeHasChildrenChange:J,contentId:Cl(),value:Ne,onValueChange:rt,open:de,onOpenChange:Pe,dir:ae,triggerPointerDownPosRef:ke,disabled:F,children:[T.jsx(Mw.Provider,{scope:t,children:T.jsx(hve,{scope:e.__scopeSelect,onNativeOptionAdd:ie.useCallback(it=>{Je(Pt=>new Set(Pt).add(it))},[]),onNativeOptionRemove:ie.useCallback(it=>{Je(Pt=>{const Ot=new Set(Pt);return Ot.delete(it),Ot})},[]),children:a})}),Ze?T.jsxs(E8,{"aria-hidden":!0,required:q,tabIndex:-1,name:M,autoComplete:R,value:Ne,onChange:it=>rt(it.target.value),disabled:F,form:H,children:[Ne===void 0?T.jsx("option",{value:""}):null,Array.from(nt)]},ot):null]})})};r8.displayName=pd;var n8="SelectTrigger",i8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,disabled:l=!1,...d}=e,_=Dw(a),v=Hu(n8,a),i=v.disabled||l,P=ui(t,v.onTriggerChange),I=Rw(a),M=ie.useRef("touch"),[R,F,q]=I8(j=>{const $=I().filter(re=>!re.disabled),Y=$.find(re=>re.value===v.value),K=C8($,j,Y);K!==void 0&&v.onValueChange(K.value)}),H=j=>{i||(v.onOpenChange(!0),q()),j&&(v.triggerPointerDownPosRef.current={x:Math.round(j.pageX),y:Math.round(j.pageY)})};return T.jsx(TC,{asChild:!0,..._,children:T.jsx(yn.button,{type:"button",role:"combobox","aria-controls":v.contentId,"aria-expanded":v.open,"aria-required":v.required,"aria-autocomplete":"none",dir:v.dir,"data-state":v.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":P8(v.value)?"":void 0,...d,ref:P,onClick:Pr(d.onClick,j=>{j.currentTarget.focus(),M.current!=="mouse"&&H(j)}),onPointerDown:Pr(d.onPointerDown,j=>{M.current=j.pointerType;const $=j.target;$.hasPointerCapture(j.pointerId)&&$.releasePointerCapture(j.pointerId),j.button===0&&j.ctrlKey===!1&&j.pointerType==="mouse"&&(H(j),j.preventDefault())}),onKeyDown:Pr(d.onKeyDown,j=>{const $=R.current!=="";!(j.ctrlKey||j.altKey||j.metaKey)&&j.key.length===1&&F(j.key),!($&&j.key===" ")&&sve.includes(j.key)&&(H(),j.preventDefault())})})})});i8.displayName=n8;var o8="SelectValue",a8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,className:l,style:d,children:_,placeholder:v="",...i}=e,P=Hu(o8,a),{onValueNodeHasChildrenChange:I}=P,M=_!==void 0,R=ui(t,P.onValueNodeChange);return Co(()=>{I(M)},[I,M]),T.jsx(yn.span,{...i,ref:R,style:{pointerEvents:"none"},children:P8(P.value)?T.jsx(T.Fragment,{children:v}):_})});a8.displayName=o8;var fve="SelectIcon",s8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,children:l,...d}=e;return T.jsx(yn.span,{"aria-hidden":!0,...d,ref:t,children:l||""})});s8.displayName=fve;var pve="SelectPortal",l8=e=>T.jsx(Rb,{asChild:!0,...e});l8.displayName=pve;var md="SelectContent",c8=ie.forwardRef((e,t)=>{const a=Hu(md,e.__scopeSelect),[l,d]=ie.useState();if(Co(()=>{d(new DocumentFragment)},[]),!a.open){const _=l;return _?em.createPortal(T.jsx(u8,{scope:e.__scopeSelect,children:T.jsx(Mw.Slot,{scope:e.__scopeSelect,children:T.jsx("div",{children:e.children})})}),_):null}return T.jsx(h8,{...e,ref:t})});c8.displayName=md;var Ns=10,[u8,Wu]=fm(md),mve="SelectContentImpl",gve=wp("SelectContent.RemoveScroll"),h8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,position:l="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:_,onPointerDownOutside:v,side:i,sideOffset:P,align:I,alignOffset:M,arrowPadding:R,collisionBoundary:F,collisionPadding:q,sticky:H,hideWhenDetached:j,avoidCollisions:$,...Y}=e,K=Hu(md,a),[re,se]=ie.useState(null),[J,ae]=ie.useState(null),de=ui(t,nr=>se(nr)),[Pe,Ne]=ie.useState(null),[rt,ke]=ie.useState(null),Ze=Rw(a),[nt,Je]=ie.useState(!1),ot=ie.useRef(!1);ie.useEffect(()=>{if(re)return Rq(re)},[re]),wq();const it=ie.useCallback(nr=>{const[Dr,...er]=Ze().map(jt=>jt.ref.current),[or]=er.slice(-1),br=document.activeElement;for(const jt of nr)if(jt===br||(jt?.scrollIntoView({block:"nearest"}),jt===Dr&&J&&(J.scrollTop=0),jt===or&&J&&(J.scrollTop=J.scrollHeight),jt?.focus(),document.activeElement!==br))return},[Ze,J]),Pt=ie.useCallback(()=>it([Pe,re]),[it,Pe,re]);ie.useEffect(()=>{nt&&Pt()},[nt,Pt]);const{onOpenChange:Ot,triggerPointerDownPosRef:yt}=K;ie.useEffect(()=>{if(re){let nr={x:0,y:0};const Dr=or=>{nr={x:Math.abs(Math.round(or.pageX)-(yt.current?.x??0)),y:Math.abs(Math.round(or.pageY)-(yt.current?.y??0))}},er=or=>{nr.x<=10&&nr.y<=10?or.preventDefault():re.contains(or.target)||Ot(!1),document.removeEventListener("pointermove",Dr),yt.current=null};return yt.current!==null&&(document.addEventListener("pointermove",Dr),document.addEventListener("pointerup",er,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Dr),document.removeEventListener("pointerup",er,{capture:!0})}}},[re,Ot,yt]),ie.useEffect(()=>{const nr=()=>Ot(!1);return window.addEventListener("blur",nr),window.addEventListener("resize",nr),()=>{window.removeEventListener("blur",nr),window.removeEventListener("resize",nr)}},[Ot]);const[ar,qt]=I8(nr=>{const Dr=Ze().filter(br=>!br.disabled),er=Dr.find(br=>br.ref.current===document.activeElement),or=C8(Dr,nr,er);or&&setTimeout(()=>or.ref.current.focus())}),rr=ie.useCallback((nr,Dr,er)=>{const or=!ot.current&&!er;(K.value!==void 0&&K.value===Dr||or)&&(Ne(nr),or&&(ot.current=!0))},[K.value]),Tr=ie.useCallback(()=>re?.focus(),[re]),an=ie.useCallback((nr,Dr,er)=>{const or=!ot.current&&!er;(K.value!==void 0&&K.value===Dr||or)&&ke(nr)},[K.value]),An=l==="popper"?ZI:d8,Fr=An===ZI?{side:i,sideOffset:P,align:I,alignOffset:M,arrowPadding:R,collisionBoundary:F,collisionPadding:q,sticky:H,hideWhenDetached:j,avoidCollisions:$}:{};return T.jsx(u8,{scope:a,content:re,viewport:J,onViewportChange:ae,itemRefCallback:rr,selectedItem:Pe,onItemLeave:Tr,itemTextRefCallback:an,focusSelectedItem:Pt,selectedItemText:rt,position:l,isPositioned:nt,searchRef:ar,children:T.jsx(DO,{as:gve,allowPinchZoom:!0,children:T.jsx(RO,{asChild:!0,trapped:K.open,onMountAutoFocus:nr=>{nr.preventDefault()},onUnmountAutoFocus:Pr(d,nr=>{K.trigger?.focus({preventScroll:!0}),nr.preventDefault()}),children:T.jsx(Oy,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:_,onPointerDownOutside:v,onFocusOutside:nr=>nr.preventDefault(),onDismiss:()=>K.onOpenChange(!1),children:T.jsx(An,{role:"listbox",id:K.contentId,"data-state":K.open?"open":"closed",dir:K.dir,onContextMenu:nr=>nr.preventDefault(),...Y,...Fr,onPlaced:()=>Je(!0),ref:de,style:{display:"flex",flexDirection:"column",outline:"none",...Y.style},onKeyDown:Pr(Y.onKeyDown,nr=>{const Dr=nr.ctrlKey||nr.altKey||nr.metaKey;if(nr.key==="Tab"&&nr.preventDefault(),!Dr&&nr.key.length===1&&qt(nr.key),["ArrowUp","ArrowDown","Home","End"].includes(nr.key)){let or=Ze().filter(br=>!br.disabled).map(br=>br.ref.current);if(["ArrowUp","End"].includes(nr.key)&&(or=or.slice().reverse()),["ArrowUp","ArrowDown"].includes(nr.key)){const br=nr.target,jt=or.indexOf(br);or=or.slice(jt+1)}setTimeout(()=>it(or)),nr.preventDefault()}})})})})})})});h8.displayName=mve;var _ve="SelectItemAlignedPosition",d8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,onPlaced:l,...d}=e,_=Hu(md,a),v=Wu(md,a),[i,P]=ie.useState(null),[I,M]=ie.useState(null),R=ui(t,de=>M(de)),F=Rw(a),q=ie.useRef(!1),H=ie.useRef(!0),{viewport:j,selectedItem:$,selectedItemText:Y,focusSelectedItem:K}=v,re=ie.useCallback(()=>{if(_.trigger&&_.valueNode&&i&&I&&j&&$&&Y){const de=_.trigger.getBoundingClientRect(),Pe=I.getBoundingClientRect(),Ne=_.valueNode.getBoundingClientRect(),rt=Y.getBoundingClientRect();if(_.dir!=="rtl"){const br=rt.left-Pe.left,jt=Ne.left-br,bn=de.left-jt,Hr=de.width+bn,Zr=Math.max(Hr,Pe.width),ni=window.innerWidth-Ns,hi=r4(jt,[Ns,Math.max(Ns,ni-Zr)]);i.style.minWidth=Hr+"px",i.style.left=hi+"px"}else{const br=Pe.right-rt.right,jt=window.innerWidth-Ne.right-br,bn=window.innerWidth-de.right-jt,Hr=de.width+bn,Zr=Math.max(Hr,Pe.width),ni=window.innerWidth-Ns,hi=r4(jt,[Ns,Math.max(Ns,ni-Zr)]);i.style.minWidth=Hr+"px",i.style.right=hi+"px"}const ke=F(),Ze=window.innerHeight-Ns*2,nt=j.scrollHeight,Je=window.getComputedStyle(I),ot=parseInt(Je.borderTopWidth,10),it=parseInt(Je.paddingTop,10),Pt=parseInt(Je.borderBottomWidth,10),Ot=parseInt(Je.paddingBottom,10),yt=ot+it+nt+Ot+Pt,ar=Math.min($.offsetHeight*5,yt),qt=window.getComputedStyle(j),rr=parseInt(qt.paddingTop,10),Tr=parseInt(qt.paddingBottom,10),an=de.top+de.height/2-Ns,An=Ze-an,Fr=$.offsetHeight/2,nr=$.offsetTop+Fr,Dr=ot+it+nr,er=yt-Dr;if(Dr<=an){const br=ke.length>0&&$===ke[ke.length-1].ref.current;i.style.bottom="0px";const jt=I.clientHeight-j.offsetTop-j.offsetHeight,bn=Math.max(An,Fr+(br?Tr:0)+jt+Pt),Hr=Dr+bn;i.style.height=Hr+"px"}else{const br=ke.length>0&&$===ke[0].ref.current;i.style.top="0px";const bn=Math.max(an,ot+j.offsetTop+(br?rr:0)+Fr)+er;i.style.height=bn+"px",j.scrollTop=Dr-an+j.offsetTop}i.style.margin=`${Ns}px 0`,i.style.minHeight=ar+"px",i.style.maxHeight=Ze+"px",l?.(),requestAnimationFrame(()=>q.current=!0)}},[F,_.trigger,_.valueNode,i,I,j,$,Y,_.dir,l]);Co(()=>re(),[re]);const[se,J]=ie.useState();Co(()=>{I&&J(window.getComputedStyle(I).zIndex)},[I]);const ae=ie.useCallback(de=>{de&&H.current===!0&&(re(),K?.(),H.current=!1)},[re,K]);return T.jsx(vve,{scope:a,contentWrapper:i,shouldExpandOnScrollRef:q,onScrollButtonChange:ae,children:T.jsx("div",{ref:P,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:se},children:T.jsx(yn.div,{...d,ref:R,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});d8.displayName=_ve;var yve="SelectPopperPosition",ZI=ie.forwardRef((e,t)=>{const{__scopeSelect:a,align:l="start",collisionPadding:d=Ns,..._}=e,v=Dw(a);return T.jsx(AC,{...v,..._,ref:t,align:l,collisionPadding:d,style:{boxSizing:"border-box",..._.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});ZI.displayName=yve;var[vve,JO]=fm(md,{}),XI="SelectViewport",f8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,nonce:l,...d}=e,_=Wu(XI,a),v=JO(XI,a),i=ui(t,_.onViewportChange),P=ie.useRef(0);return T.jsxs(T.Fragment,{children:[T.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),T.jsx(Mw.Slot,{scope:a,children:T.jsx(yn.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:Pr(d.onScroll,I=>{const M=I.currentTarget,{contentWrapper:R,shouldExpandOnScrollRef:F}=v;if(F?.current&&R){const q=Math.abs(P.current-M.scrollTop);if(q>0){const H=window.innerHeight-Ns*2,j=parseFloat(R.style.minHeight),$=parseFloat(R.style.height),Y=Math.max(j,$);if(Y<H){const K=Y+q,re=Math.min(H,K),se=K-re;R.style.height=re+"px",R.style.bottom==="0px"&&(M.scrollTop=se>0?se:0,R.style.justifyContent="flex-end")}}}P.current=M.scrollTop})})})]})});f8.displayName=XI;var p8="SelectGroup",[xve,bve]=fm(p8),wve=ie.forwardRef((e,t)=>{const{__scopeSelect:a,...l}=e,d=Cl();return T.jsx(xve,{scope:a,id:d,children:T.jsx(yn.div,{role:"group","aria-labelledby":d,...l,ref:t})})});wve.displayName=p8;var m8="SelectLabel",g8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,...l}=e,d=bve(m8,a);return T.jsx(yn.div,{id:d.id,...l,ref:t})});g8.displayName=m8;var Eb="SelectItem",[Sve,_8]=fm(Eb),y8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,value:l,disabled:d=!1,textValue:_,...v}=e,i=Hu(Eb,a),P=Wu(Eb,a),I=i.value===l,[M,R]=ie.useState(_??""),[F,q]=ie.useState(!1),H=ui(t,K=>P.itemRefCallback?.(K,l,d)),j=Cl(),$=ie.useRef("touch"),Y=()=>{d||(i.onValueChange(l),i.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return T.jsx(Sve,{scope:a,value:l,disabled:d,textId:j,isSelected:I,onItemTextChange:ie.useCallback(K=>{R(re=>re||(K?.textContent??"").trim())},[]),children:T.jsx(Mw.ItemSlot,{scope:a,value:l,disabled:d,textValue:M,children:T.jsx(yn.div,{role:"option","aria-labelledby":j,"data-highlighted":F?"":void 0,"aria-selected":I&&F,"data-state":I?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,...v,ref:H,onFocus:Pr(v.onFocus,()=>q(!0)),onBlur:Pr(v.onBlur,()=>q(!1)),onClick:Pr(v.onClick,()=>{$.current!=="mouse"&&Y()}),onPointerUp:Pr(v.onPointerUp,()=>{$.current==="mouse"&&Y()}),onPointerDown:Pr(v.onPointerDown,K=>{$.current=K.pointerType}),onPointerMove:Pr(v.onPointerMove,K=>{$.current=K.pointerType,d?P.onItemLeave?.():$.current==="mouse"&&K.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Pr(v.onPointerLeave,K=>{K.currentTarget===document.activeElement&&P.onItemLeave?.()}),onKeyDown:Pr(v.onKeyDown,K=>{P.searchRef?.current!==""&&K.key===" "||(lve.includes(K.key)&&Y(),K.key===" "&&K.preventDefault())})})})})});y8.displayName=Eb;var P_="SelectItemText",v8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,className:l,style:d,..._}=e,v=Hu(P_,a),i=Wu(P_,a),P=_8(P_,a),I=dve(P_,a),[M,R]=ie.useState(null),F=ui(t,Y=>R(Y),P.onItemTextChange,Y=>i.itemTextRefCallback?.(Y,P.value,P.disabled)),q=M?.textContent,H=ie.useMemo(()=>T.jsx("option",{value:P.value,disabled:P.disabled,children:q},P.value),[P.disabled,P.value,q]),{onNativeOptionAdd:j,onNativeOptionRemove:$}=I;return Co(()=>(j(H),()=>$(H)),[j,$,H]),T.jsxs(T.Fragment,{children:[T.jsx(yn.span,{id:P.textId,..._,ref:F}),P.isSelected&&v.valueNode&&!v.valueNodeHasChildren?em.createPortal(_.children,v.valueNode):null]})});v8.displayName=P_;var x8="SelectItemIndicator",b8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,...l}=e;return _8(x8,a).isSelected?T.jsx(yn.span,{"aria-hidden":!0,...l,ref:t}):null});b8.displayName=x8;var KI="SelectScrollUpButton",w8=ie.forwardRef((e,t)=>{const a=Wu(KI,e.__scopeSelect),l=JO(KI,e.__scopeSelect),[d,_]=ie.useState(!1),v=ui(t,l.onScrollButtonChange);return Co(()=>{if(a.viewport&&a.isPositioned){let i=function(){const I=P.scrollTop>0;_(I)};const P=a.viewport;return i(),P.addEventListener("scroll",i),()=>P.removeEventListener("scroll",i)}},[a.viewport,a.isPositioned]),d?T.jsx(T8,{...e,ref:v,onAutoScroll:()=>{const{viewport:i,selectedItem:P}=a;i&&P&&(i.scrollTop=i.scrollTop-P.offsetHeight)}}):null});w8.displayName=KI;var YI="SelectScrollDownButton",S8=ie.forwardRef((e,t)=>{const a=Wu(YI,e.__scopeSelect),l=JO(YI,e.__scopeSelect),[d,_]=ie.useState(!1),v=ui(t,l.onScrollButtonChange);return Co(()=>{if(a.viewport&&a.isPositioned){let i=function(){const I=P.scrollHeight-P.clientHeight,M=Math.ceil(P.scrollTop)<I;_(M)};const P=a.viewport;return i(),P.addEventListener("scroll",i),()=>P.removeEventListener("scroll",i)}},[a.viewport,a.isPositioned]),d?T.jsx(T8,{...e,ref:v,onAutoScroll:()=>{const{viewport:i,selectedItem:P}=a;i&&P&&(i.scrollTop=i.scrollTop+P.offsetHeight)}}):null});S8.displayName=YI;var T8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,onAutoScroll:l,...d}=e,_=Wu("SelectScrollButton",a),v=ie.useRef(null),i=Rw(a),P=ie.useCallback(()=>{v.current!==null&&(window.clearInterval(v.current),v.current=null)},[]);return ie.useEffect(()=>()=>P(),[P]),Co(()=>{i().find(M=>M.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),T.jsx(yn.div,{"aria-hidden":!0,...d,ref:t,style:{flexShrink:0,...d.style},onPointerDown:Pr(d.onPointerDown,()=>{v.current===null&&(v.current=window.setInterval(l,50))}),onPointerMove:Pr(d.onPointerMove,()=>{_.onItemLeave?.(),v.current===null&&(v.current=window.setInterval(l,50))}),onPointerLeave:Pr(d.onPointerLeave,()=>{P()})})}),Tve="SelectSeparator",A8=ie.forwardRef((e,t)=>{const{__scopeSelect:a,...l}=e;return T.jsx(yn.div,{"aria-hidden":!0,...l,ref:t})});A8.displayName=Tve;var JI="SelectArrow",Ave=ie.forwardRef((e,t)=>{const{__scopeSelect:a,...l}=e,d=Dw(a),_=Hu(JI,a),v=Wu(JI,a);return _.open&&v.position==="popper"?T.jsx(EC,{...d,...l,ref:t}):null});Ave.displayName=JI;var Eve="SelectBubbleInput",E8=ie.forwardRef(({__scopeSelect:e,value:t,...a},l)=>{const d=ie.useRef(null),_=ui(l,d),v=ave(t);return ie.useEffect(()=>{const i=d.current;if(!i)return;const P=window.HTMLSelectElement.prototype,M=Object.getOwnPropertyDescriptor(P,"value").set;if(v!==t&&M){const R=new Event("change",{bubbles:!0});M.call(i,t),i.dispatchEvent(R)}},[v,t]),T.jsx(yn.select,{...a,style:{...Z4,...a.style},ref:_,defaultValue:t})});E8.displayName=Eve;function P8(e){return e===""||e===void 0}function I8(e){const t=ga(e),a=ie.useRef(""),l=ie.useRef(0),d=ie.useCallback(v=>{const i=a.current+v;t(i),(function P(I){a.current=I,window.clearTimeout(l.current),I!==""&&(l.current=window.setTimeout(()=>P(""),1e3))})(i)},[t]),_=ie.useCallback(()=>{a.current="",window.clearTimeout(l.current)},[]);return ie.useEffect(()=>()=>window.clearTimeout(l.current),[]),[a,d,_]}function C8(e,t,a){const d=t.length>1&&Array.from(t).every(I=>I===t[0])?t[0]:t,_=a?e.indexOf(a):-1;let v=Pve(e,Math.max(_,0));d.length===1&&(v=v.filter(I=>I!==a));const P=v.find(I=>I.textValue.toLowerCase().startsWith(d.toLowerCase()));return P!==a?P:void 0}function Pve(e,t){return e.map((a,l)=>e[(t+l)%e.length])}var Ive=r8,O8=i8,Cve=a8,Ove=s8,Mve=l8,M8=c8,Rve=f8,R8=g8,D8=y8,Dve=v8,kve=b8,k8=w8,N8=S8,L8=A8;const u0=Ive,h0=Cve,I_=ie.forwardRef(({className:e,children:t,...a},l)=>T.jsxs(O8,{ref:l,className:Nn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[t,T.jsx(Ove,{asChild:!0,children:T.jsx(Ib,{className:"h-4 w-4 opacity-50"})})]}));I_.displayName=O8.displayName;const j8=ie.forwardRef(({className:e,...t},a)=>T.jsx(k8,{ref:a,className:Nn("flex cursor-default items-center justify-center py-1",e),...t,children:T.jsx(V7,{className:"h-4 w-4"})}));j8.displayName=k8.displayName;const z8=ie.forwardRef(({className:e,...t},a)=>T.jsx(N8,{ref:a,className:Nn("flex cursor-default items-center justify-center py-1",e),...t,children:T.jsx(Ib,{className:"h-4 w-4"})}));z8.displayName=N8.displayName;const C_=ie.forwardRef(({className:e,children:t,position:a="popper",...l},d)=>T.jsx(Mve,{children:T.jsxs(M8,{ref:d,className:Nn("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...l,children:[T.jsx(j8,{}),T.jsx(Rve,{className:Nn("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),T.jsx(z8,{})]})}));C_.displayName=M8.displayName;const Nve=ie.forwardRef(({className:e,...t},a)=>T.jsx(R8,{ref:a,className:Nn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Nve.displayName=R8.displayName;const Vi=ie.forwardRef(({className:e,children:t,...a},l)=>T.jsxs(D8,{ref:l,className:Nn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[T.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:T.jsx(kve,{children:T.jsx(p4,{className:"h-4 w-4"})})}),T.jsx(Dve,{children:t})]}));Vi.displayName=D8.displayName;const Lve=ie.forwardRef(({className:e,...t},a)=>T.jsx(L8,{ref:a,className:Nn("-mx-1 my-1 h-px bg-muted",e),...t}));Lve.displayName=L8.displayName;function jve(e){const t=[0,60,120,180,240,270,300,330];function a(R){let F=0;for(let q=0;q<R.length;q++)F=R.charCodeAt(q)+((F<<5)-F),F|=0;return Math.abs(F)}function l(R){return(R||"").toUpperCase().replace(/[^0-9A-F]/g,"")}const d=l(e);if(d.length<6)return{hex:"#999999",hsl:{h:0,s:0,l:60}};const _=d.slice(0,6);d.slice(6);const v=t[a(_)%t.length],i=70,P=65,I={h:v,s:i,l:P};return{hex:zve(v,i,P),hsl:I}}function F8(e){const t=e.toLowerCase().replace(/[^a-f0-9]/g,"");return t.length!==12?[]:[t.substring(0,2),t.substring(2,4),t.substring(4,6),t.substring(6,8),t.substring(8,10),t.substring(10,12)]}function n4(e){const t=F8(e);return t.length===6?t.join(":"):e}function zve(e,t,a){const l=e/360,d=t/100,_=a/100,v=(1-Math.abs(2*_-1))*d,i=v*(1-Math.abs(l*6%2-1)),P=_-v/2;let I,M,R;l*6<1?(I=v,M=i,R=0):l*6<2?(I=i,M=v,R=0):l*6<3?(I=0,M=v,R=i):l*6<4?(I=0,M=i,R=v):l*6<5?(I=i,M=0,R=v):(I=v,M=0,R=i);const F=Math.round((I+P)*255).toString(16).padStart(2,"0"),q=Math.round((M+P)*255).toString(16).padStart(2,"0"),H=Math.round((R+P)*255).toString(16).padStart(2,"0");return`#${F}${q}${H}`}function i4(){const[e,t]=ie.useState(""),[a,l]=ie.useState("bssid"),[d,_]=ie.useState("asc"),[v,i]=ie.useState("all"),[P,I]=ie.useState("all"),[M,R]=ie.useState(null),[F,q]=ie.useState(new Set),{data:H,isLoading:j}=Po({queryKey:["/api/v1/networks"],refetchInterval:3e4}),$=ie.useMemo(()=>!H||!H?.data?[]:H.data,[H]),Y=ie.useMemo(()=>{let J=$.filter(ae=>{const de=!e||ae.bssid.toLowerCase().includes(e.toLowerCase())||ae.ssid?.toLowerCase().includes(e.toLowerCase()),Pe=v==="all"||v==="encrypted"&&ae.encryption&&ae.encryption!=="OPEN"||v==="open"&&(!ae.encryption||ae.encryption==="OPEN")||v==="wpa"&&ae.encryption?.includes("WPA")||v==="wep"&&ae.encryption?.includes("WEP"),Ne=ae.radio_type||ae.type||"wifi",rt=P==="all"||P==="wifi"&&(Ne==="W"||Ne==="wifi"||Ne==="WiFi")||P==="bluetooth"&&(Ne==="BT"||Ne==="bluetooth"||Ne==="Bluetooth")||P==="ble"&&(Ne==="BLE"||Ne==="ble")||P==="cellular"&&(Ne.includes("Cell")||Ne==="cellular");return de&&Pe&&rt});return J.sort((ae,de)=>{let Pe,Ne;switch(a){case"bssid":Pe=ae.bssid,Ne=de.bssid;break;case"ssid":Pe=ae.ssid||"",Ne=de.ssid||"";break;case"signal_strength":Pe=ae.signal_strength||0,Ne=de.signal_strength||0;break;case"security":Pe=ae.encryption||"",Ne=de.encryption||"";break;case"frequency":Pe=ae.frequency||0,Ne=de.frequency||0;break;case"last_seen":Pe=ae.observed_at||"",Ne=de.observed_at||"";break;default:Pe=ae.bssid,Ne=de.bssid}return typeof Pe=="string"&&typeof Ne=="string"?d==="asc"?Pe.localeCompare(Ne):Ne.localeCompare(Pe):d==="asc"?Pe-Ne:Ne-Pe}),J},[$,e,a,d,v,P]);ie.useMemo(()=>{const J={};return Y.forEach(ae=>{const de=F8(ae.bssid);if(de.length===6){const Pe=M!==null?de[M]:de.slice(0,3).join(":");J[Pe]||(J[Pe]=[]),J[Pe].push(ae)}}),J},[Y,M]);const K=J=>!J||J==="OPEN"?"Open":J.includes("WPA")?"WPA":J.includes("WEP")?"WEP":"Other",re=J=>{const ae=new Set(F);ae.has(J)?ae.delete(J):ae.add(J),q(ae)},se=J=>J>=-40?"#16a34a":J>=-60?"#ca8a04":J>=-80?"#ea580c":"#dc2626";return j?T.jsx("div",{className:"flex items-center justify-center h-96",children:T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto mb-2"}),T.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading network data..."})]})}):T.jsx("div",{className:"flex-1 flex flex-col overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:T.jsx("main",{className:"flex-1 overflow-y-auto",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[T.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 shadow-lg shadow-purple-500/30",children:T.jsx(Xk,{className:"h-6 w-6 text-white"})}),T.jsxs("div",{className:"flex-1",children:[T.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(59,130,246,0.5)]",children:"Network Intelligence"}),T.jsx("p",{className:"text-sm text-slate-400 cyber-text tracking-wide mt-1",children:"Comprehensive network observations and forensic analysis"})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("div",{className:"silver-accent px-3 py-1 rounded-full",children:T.jsxs("span",{className:"text-xs font-semibold text-slate-700",children:[Y.length," networks"]})}),T.jsx("div",{className:"silver-accent px-3 py-1 rounded-full",children:T.jsxs("span",{className:"text-xs font-semibold text-slate-700",children:[$.reduce((J,ae)=>J+(ae.network_count||1),0)," total sightings"]})})]})]}),T.jsx("div",{className:"premium-card",children:T.jsx(Hi,{className:"p-6",children:T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[T.jsxs("div",{className:"relative",children:[T.jsx(c4,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),T.jsx(YO,{placeholder:"Search BSSID or SSID...",value:e,onChange:J=>t(J.target.value),className:"pl-9","data-testid":"input-search-networks"})]}),T.jsxs(u0,{value:v,onValueChange:i,children:[T.jsxs(I_,{"data-testid":"select-security-filter",children:[T.jsx(tC,{className:"h-4 w-4 mr-2"}),T.jsx(h0,{placeholder:"Security type"})]}),T.jsxs(C_,{children:[T.jsx(Vi,{value:"all",children:"All Security"}),T.jsx(Vi,{value:"encrypted",children:"Encrypted"}),T.jsx(Vi,{value:"open",children:"Open Networks"}),T.jsx(Vi,{value:"wpa",children:"WPA/WPA2"}),T.jsx(Vi,{value:"wep",children:"WEP"})]})]}),T.jsxs(u0,{value:P,onValueChange:I,children:[T.jsxs(I_,{"data-testid":"select-radio-filter",children:[T.jsx(oP,{className:"h-4 w-4 mr-2"}),T.jsx(h0,{placeholder:"Radio type"})]}),T.jsxs(C_,{children:[T.jsx(Vi,{value:"all",children:"All Radio Types"}),T.jsx(Vi,{value:"wifi",children:"WiFi"}),T.jsx(Vi,{value:"bluetooth",children:"Bluetooth"}),T.jsx(Vi,{value:"ble",children:"BLE"}),T.jsx(Vi,{value:"cellular",children:"Cellular"})]})]}),T.jsxs(u0,{value:M?.toString()||"oui",onValueChange:J=>R(J==="oui"?null:parseInt(J)),children:[T.jsx(I_,{"data-testid":"select-octet-group",children:T.jsx(h0,{placeholder:"Group by..."})}),T.jsxs(C_,{children:[T.jsx(Vi,{value:"oui",children:"Group by OUI"}),T.jsx(Vi,{value:"0",children:"1st Octet"}),T.jsx(Vi,{value:"1",children:"2nd Octet"}),T.jsx(Vi,{value:"2",children:"3rd Octet"}),T.jsx(Vi,{value:"3",children:"4th Octet"}),T.jsx(Vi,{value:"4",children:"5th Octet"}),T.jsx(Vi,{value:"5",children:"6th Octet"})]})]}),T.jsx("div",{className:"flex gap-2",children:T.jsxs(u0,{value:a,onValueChange:J=>l(J),children:[T.jsx(I_,{"data-testid":"select-sort-field",children:T.jsx(h0,{})}),T.jsxs(C_,{children:[T.jsx(Vi,{value:"bssid",children:"BSSID"}),T.jsx(Vi,{value:"ssid",children:"SSID"}),T.jsx(Vi,{value:"signal_strength",children:"Signal"}),T.jsx(Vi,{value:"security",children:"Security"}),T.jsx(Vi,{value:"frequency",children:"Frequency"})]})]})})]})})}),T.jsx(eV,{children:T.jsxs("div",{className:"premium-card",children:[T.jsx(us,{children:T.jsxs(hs,{className:"text-slate-300 flex items-center gap-2",children:[T.jsx("div",{className:"icon-container w-8 h-8 mr-2",children:T.jsx(nd,{className:"h-4 w-4 text-green-300"})}),"Network Directory",T.jsx("div",{className:"silver-accent px-3 py-1 rounded-full ml-auto",children:T.jsxs("span",{className:"text-xs font-semibold text-slate-700",children:[Y.length," networks"]})}),F.size>0&&T.jsx("div",{className:"gold-accent px-3 py-1 rounded-full ml-2",children:T.jsxs("span",{className:"text-xs font-semibold text-slate-800",children:[F.size," selected"]})})]})}),T.jsx(Hi,{className:"p-0",children:T.jsx("div",{className:"space-y-0",children:Y.map((J,ae)=>{const de=jve(J.bssid),Pe=K(J.encryption||""),Ne=J.signal_strength||0,rt=F.has(J.bssid);return T.jsxs(EJ,{children:[T.jsx(PJ,{asChild:!0,children:T.jsxs("div",{className:`flex items-center gap-3 p-3 border-b border-border/20 cursor-pointer transition-all duration-200 hover:bg-background/30 ${rt?"bg-background/50":""}`,style:{backgroundColor:rt?`${de.hex}10`:"transparent",borderLeft:`3px solid ${de.hex}`},onClick:()=>re(J.bssid),"data-testid":`network-${J.bssid.replace(/:/g,"-")}`,children:[T.jsx("div",{className:"w-3 h-3 rounded-full border border-border/30",style:{backgroundColor:de.hex}}),T.jsx("div",{className:"w-36",children:T.jsx("p",{className:"font-mono text-xs font-medium text-foreground",children:n4(J.bssid)})}),T.jsx("div",{className:"flex-1 min-w-0",children:T.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:J.ssid||"Hidden Network"})}),T.jsx("div",{className:"w-16",children:T.jsx(Ji,{variant:Pe==="Open"?"destructive":"secondary",className:"text-xs h-5",children:Pe})}),T.jsx("div",{className:"w-20 text-right",children:T.jsxs("p",{className:"text-xs font-medium",style:{color:se(Ne)},children:[Ne," dBm"]})}),T.jsx("div",{className:"w-16 text-right",children:T.jsx("p",{className:"text-xs text-muted-foreground",children:J.frequency>5e3?"5G":J.frequency>2e3?"2.4G":"?"})}),J.network_count&&J.network_count>1&&T.jsx("div",{className:"w-12 text-right",children:T.jsx("span",{className:"text-xs bg-muted/50 px-1.5 py-0.5 rounded",children:J.network_count})})]})}),T.jsx(tV,{side:"left",className:"max-w-80",children:T.jsxs("div",{className:"space-y-2",children:[T.jsx("div",{className:"font-medium text-sm border-b border-border/20 pb-1",children:J.ssid||"Hidden Network"}),T.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[T.jsxs("div",{children:[T.jsx("span",{className:"text-muted-foreground",children:"BSSID:"}),T.jsx("br",{}),T.jsx("span",{className:"font-mono",children:n4(J.bssid)})]}),T.jsxs("div",{children:[T.jsx("span",{className:"text-muted-foreground",children:"Security:"}),T.jsx("br",{}),T.jsx("span",{children:J.encryption||"OPEN"})]}),T.jsxs("div",{children:[T.jsx("span",{className:"text-muted-foreground",children:"Signal:"}),T.jsx("br",{}),T.jsxs("span",{style:{color:se(Ne)},children:[Ne," dBm"]})]}),T.jsxs("div",{children:[T.jsx("span",{className:"text-muted-foreground",children:"Frequency:"}),T.jsx("br",{}),T.jsx("span",{children:J.frequency?`${J.frequency} MHz`:"Unknown"})]}),J.latitude&&J.longitude&&T.jsxs("div",{className:"col-span-2",children:[T.jsx("span",{className:"text-muted-foreground",children:"Location:"}),T.jsx("br",{}),T.jsxs("span",{className:"font-mono",children:[parseFloat(J.latitude).toFixed(6),", ",parseFloat(J.longitude).toFixed(6)]})]}),J.network_count&&J.network_count>1&&T.jsxs("div",{children:[T.jsx("span",{className:"text-muted-foreground",children:"Sightings:"}),T.jsx("br",{}),T.jsx("span",{children:J.network_count})]})]})]})})]},`${J.bssid}-${ae}`)})})})]})}),Y.length===0&&T.jsx("div",{className:"premium-card",children:T.jsxs(Hi,{className:"p-8 text-center",children:[T.jsx("div",{className:"icon-container mx-auto mb-6",children:T.jsx(Xk,{className:"h-8 w-8 text-slate-300"})}),T.jsx("h3",{className:"text-lg font-medium text-slate-200 mb-2",children:"No Networks Found"}),T.jsx("p",{className:"text-slate-300",children:"Try adjusting your search terms or filters to see more results."})]})})]})})})}function Fve(){const{data:e,isLoading:t}=Po({queryKey:["/api/v1/status"],queryFn:()=>po.getSystemStatus(),refetchInterval:5e3}),{data:a}=Po({queryKey:["/api/v1/health"],queryFn:()=>po.getHealth(),refetchInterval:3e4}),l=[{title:"API Health",value:a?.ok?"Online":"Offline",icon:id,gradient:a?.ok?"from-green-500 to-emerald-600":"from-red-500 to-rose-600",shadowColor:a?.ok?"shadow-green-500/30":"shadow-red-500/30",status:a?.ok},{title:"Database Status",value:e?.database.connected?"Connected":"Disconnected",icon:Lu,gradient:e?.database.connected?"from-blue-500 to-cyan-600":"from-gray-500 to-slate-600",shadowColor:e?.database.connected?"shadow-blue-500/30":"shadow-gray-500/30",status:e?.database.connected},{title:"Memory Usage",value:e?`${e.memory.used}MB`:"0MB",icon:aP,gradient:"from-purple-500 to-pink-600",shadowColor:"shadow-purple-500/30",status:!0},{title:"PostGIS Enabled",value:e?.database.postgisEnabled?"Yes":"No",icon:gd,gradient:e?.database.postgisEnabled?"from-amber-500 to-orange-600":"from-gray-500 to-slate-600",shadowColor:e?.database.postgisEnabled?"shadow-amber-500/30":"shadow-gray-500/30",status:e?.database.postgisEnabled}];return t?T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[...Array(4)].map((d,_)=>T.jsx("div",{className:"premium-card p-6 animate-pulse loading-shimmer",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("div",{className:"h-4 bg-slate-700 rounded w-20 mb-2"}),T.jsx("div",{className:"h-8 bg-slate-700 rounded w-16"})]}),T.jsx("div",{className:"w-12 h-12 bg-slate-700 rounded-lg"})]})},_))}):T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:l.map((d,_)=>{const v=d.icon;return T.jsx("div",{className:"premium-card p-6","data-testid":`metric-card-${d.title.toLowerCase().replace(" ","-")}`,children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-slate-400 mb-2",children:d.title}),T.jsx("p",{className:`text-2xl font-bold ${d.status?"text-slate-100":"text-slate-400"}`,children:d.value})]}),T.jsx("div",{className:`icon-container w-12 h-12 bg-gradient-to-br ${d.gradient} shadow-lg ${d.shadowColor}`,children:T.jsx(v,{className:"h-6 w-6 text-white"})})]})},_)})})}function Bve(){const{toast:e}=Qp(),[t,a]=ie.useState({}),{data:l}=Po({queryKey:["/api/v1/status"],queryFn:()=>po.getSystemStatus(),refetchInterval:5e3}),d=V4({mutationFn:async v=>{let i;const P=performance.now();try{switch(v){case"health":i=await po.getHealth();break;case"version":i=await po.getVersion();break;case"networks":i=await po.getNetworks(10);break;case"status":i=await po.getSystemStatus();break;case"within":i=await fetch("/api/v1/within?lat=37.7749&lng=-122.4194&radius=5000").then(R=>R.json());break;case"g63networks":i=await fetch("/api/v1/g63/networks").then(R=>R.json());break;case"g63locations":i=await fetch("/api/v1/g63/locations").then(R=>R.json());break;case"g63visualize":i=await fetch("/api/v1/g63/visualize").then(R=>R.json());break;default:throw new Error("Unknown endpoint")}const I=performance.now(),M=Math.round(I-P);return{success:!0,data:i,duration:M}}catch(I){const M=performance.now(),R=Math.round(M-P);return{success:!1,error:I.message,status:I.status||500,duration:R}}},onSuccess:(v,i)=>{a(P=>({...P,[i]:v})),v.success?e({title:"Test Successful",description:`${i} endpoint responded in ${v.duration}ms`}):e({title:"Test Failed",description:`${i} endpoint failed: ${v.error}`,variant:"destructive"})}}),_=[{method:"GET",path:"/api/v1/health",endpoint:"health",available:!0,description:"Check system health status"},{method:"GET",path:"/api/v1/status",endpoint:"status",available:!0,description:"Get system status information"},{method:"GET",path:"/api/v1/networks",endpoint:"networks",available:l?.database.connected||!1,description:"Fetch network observations"},{method:"GET",path:"/api/v1/within",endpoint:"within",available:l?.database.connected||!1,description:"Query networks within radius"},{method:"GET",path:"/api/v1/g63/networks",endpoint:"g63networks",available:l?.database.connected||!1,description:"Get G63 network data"},{method:"GET",path:"/api/v1/g63/locations",endpoint:"g63locations",available:l?.database.connected||!1,description:"Get G63 location data"},{method:"GET",path:"/api/v1/g63/visualize",endpoint:"g63visualize",available:l?.database.connected||!1,description:"Get G63 visualization data"}];return T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 shadow-lg shadow-blue-500/30",children:T.jsx($7,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"API Endpoint Testing"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Test all system endpoints"})]})]})}),T.jsx("div",{className:"p-6 space-y-3",children:_.map(v=>T.jsxs("div",{className:"space-y-2",children:[T.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:border-slate-600/50 transition-colors",children:[T.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[T.jsx("span",{className:`px-2.5 py-1 text-xs font-mono font-semibold rounded ${v.available?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`,children:v.method}),T.jsxs("div",{className:"flex-1",children:[T.jsx("span",{className:"font-mono text-sm text-slate-300",children:v.path}),T.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:v.description})]})]}),v.available?T.jsxs("button",{onClick:()=>d.mutate(v.endpoint),disabled:d.isPending,className:"px-4 py-2 text-xs font-medium bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-md hover:from-blue-600 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-lg shadow-blue-500/20","data-testid":`test-button-${v.endpoint}`,children:[T.jsx(m4,{className:"h-3 w-3"}),d.isPending?"Testing...":"Test"]}):T.jsx("span",{className:"px-3 py-2 text-xs font-medium bg-red-500/20 text-red-400 rounded-md border border-red-500/30",children:"DB Required"})]}),t[v.endpoint]&&T.jsx("div",{className:`p-4 rounded-lg border text-xs font-mono ${t[v.endpoint].success?"bg-green-500/10 text-green-400 border-green-500/30":"bg-red-500/10 text-red-400 border-red-500/30"}`,children:t[v.endpoint].success?T.jsxs("div",{children:[T.jsxs("div",{className:"font-semibold flex items-center gap-2 mb-2",children:[T.jsx(g4,{className:"h-4 w-4"}),"Success (",t[v.endpoint].duration,"ms)"]}),T.jsxs("div",{className:"opacity-75 bg-slate-900/50 p-2 rounded overflow-x-auto",children:[JSON.stringify(t[v.endpoint].data,null,2).slice(0,200),"..."]})]}):T.jsxs("div",{children:[T.jsxs("div",{className:"font-semibold flex items-center gap-2 mb-2",children:[T.jsx(q7,{className:"h-4 w-4"}),"Error ",t[v.endpoint].status]}),T.jsx("div",{children:t[v.endpoint].error})]})})]},v.endpoint))})]})}function Uve(){const{data:e,isLoading:t}=Po({queryKey:["/api/v1/status"],queryFn:()=>po.getSystemStatus(),refetchInterval:5e3}),a=()=>{console.log("Database restoration requested")};return t?T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 shadow-lg shadow-cyan-500/30 animate-pulse",children:T.jsx(Lu,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Database Status"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"PostgreSQL + PostGIS connection"})]})]})}),T.jsx("div",{className:"p-6",children:T.jsx("div",{className:"space-y-4 animate-pulse",children:[...Array(3)].map((l,d)=>T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsx("div",{className:"h-4 bg-slate-700 rounded w-24"}),T.jsx("div",{className:"h-4 bg-slate-700 rounded w-16"})]},d))})})]}):T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:`icon-container w-10 h-10 bg-gradient-to-br ${e?.database.connected?"from-green-500 to-emerald-600 shadow-lg shadow-green-500/30":"from-red-500 to-rose-600 shadow-lg shadow-red-500/30"}`,children:T.jsx(Lu,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Database Status"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"PostgreSQL + PostGIS connection"})]})]})}),T.jsx("div",{className:"p-6",children:T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[T.jsx(rC,{className:"h-4 w-4 text-slate-400"}),T.jsx("span",{className:"text-sm font-medium",children:"Connection Pool"})]}),T.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-md border ${e?.database.connected?"bg-green-500/20 text-green-400 border-green-500/30":"bg-red-500/20 text-red-400 border-red-500/30"}`,"data-testid":"db-status",children:e?.database.connected?"Connected":"Dormant"})]}),T.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("span",{className:"text-sm text-slate-300 font-medium",children:"Active Connections"}),T.jsxs("span",{className:"text-sm font-mono text-slate-100 font-semibold","data-testid":"db-connections",children:[e?.database.activeConnections||0,"/",e?.database.maxConnections||5]})]}),T.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[T.jsx(gd,{className:"h-4 w-4 text-slate-400"}),T.jsx("span",{className:"text-sm font-medium",children:"PostGIS Extension"})]}),T.jsx("span",{className:"text-sm text-slate-100 font-semibold","data-testid":"postgis-status",children:e?.database.postgisEnabled?"Available":"Not Available"})]}),!e?.database.connected&&T.jsxs("div",{className:"pt-4 border-t border-slate-700/50",children:[T.jsxs("button",{onClick:a,className:"w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all text-sm font-medium flex items-center justify-center gap-2 shadow-lg shadow-blue-500/20","data-testid":"restore-database-button",children:[T.jsx(G7,{className:"h-4 w-4"}),"Restore Database Backup"]}),T.jsx("p",{className:"text-xs text-slate-400 mt-2 text-center",children:"Upload your PostgreSQL backup to activate spatial queries"})]}),e?.database.connected&&T.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:T.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400 bg-green-500/10 p-3 rounded-lg border border-green-500/20",children:[T.jsx(g4,{className:"h-4 w-4"}),T.jsx("span",{className:"font-medium",children:"Database ready for spatial operations"})]})})]})})]})}function Vve(){const[e,t]=ie.useState("up"),[a,l]=ie.useState(!1),[d,_]=ie.useState(null),[v,i]=ie.useState(null),{toast:P}=Qp(),I=[{label:"Service Status",query:"up"},{label:"Memory Usage",query:"shadowcheck_memory_heap_used_bytes / shadowcheck_memory_heap_total_bytes"},{label:"DB Pool Active",query:"shadowcheck_db_pool_total - shadowcheck_db_pool_idle"},{label:"Request Rate",query:"rate(shadowcheck_requests_total[5m])"},{label:"Error Rate",query:"rate(shadowcheck_errors_total[5m])"}],M=async()=>{if(!e.trim()){P({title:"Query Required",description:"Please enter a Prometheus query.",variant:"destructive"});return}l(!0),i(null),_(null);try{const F=await fetch(`http://localhost:9091/api/v1/query?query=${encodeURIComponent(e)}`);if(!F.ok)throw new Error(`HTTP ${F.status}: ${F.statusText}`);const q=await F.json();if(q.status==="success")_(q.data.result),P({title:"Query Executed",description:`Found ${q.data.result.length} result(s)`});else throw new Error("Query failed")}catch(F){const q=F instanceof Error?F.message:"Failed to execute query";i(q),P({title:"Query Failed",description:q,variant:"destructive"})}finally{l(!1)}},R=F=>{const q=parseFloat(F);return isNaN(q)?F:q>1e6?`${(q/1e6).toFixed(2)}M`:q>1e3?`${(q/1e3).toFixed(2)}K`:q<1?q.toFixed(4):q.toFixed(2)};return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"premium-card p-6",children:[T.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 shadow-lg shadow-purple-500/30",children:T.jsx(Cb,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Query Prometheus"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Execute PromQL queries against live metrics"})]})]}),T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex gap-2",children:[T.jsx(YO,{value:e,onChange:F=>t(F.target.value),placeholder:"Enter PromQL query (e.g., up, rate(http_requests_total[5m]))",className:"flex-1 bg-slate-800/50 border-slate-700 text-slate-100",onKeyDown:F=>{F.key==="Enter"&&M()}}),T.jsxs(Ii,{onClick:M,disabled:a,className:"bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700",children:[T.jsx(m4,{className:"h-4 w-4 mr-2"}),a?"Running...":"Execute"]})]}),T.jsxs("div",{className:"flex flex-wrap gap-2",children:[T.jsx("span",{className:"text-xs text-slate-400 mr-2 self-center",children:"Quick queries:"}),I.map((F,q)=>T.jsx(Ji,{variant:"outline",className:"cursor-pointer hover:bg-slate-700 transition-colors",onClick:()=>t(F.query),children:F.label},q))]})]})]}),v&&T.jsx(zu,{className:"p-4 bg-red-500/10 border-red-500/30",children:T.jsxs("div",{className:"flex items-start gap-3",children:[T.jsx(O_,{className:"h-5 w-5 text-red-400 mt-0.5"}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-semibold text-red-400",children:"Query Error"}),T.jsx("p",{className:"text-xs text-red-300 mt-1",children:v})]})]})}),d&&d.length>0&&T.jsxs("div",{className:"premium-card p-6",children:[T.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[T.jsx(_4,{className:"h-5 w-5 text-green-400"}),T.jsxs("h4",{className:"text-md font-semibold text-slate-100",children:["Query Results (",d.length,")"]})]}),T.jsx("div",{className:"space-y-2",children:d.map((F,q)=>T.jsx("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:border-slate-600/50 transition-colors",children:T.jsxs("div",{className:"flex items-start justify-between gap-4",children:[T.jsx("div",{className:"flex-1 space-y-2",children:T.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(F.metric).map(([H,j])=>T.jsxs(Ji,{variant:"secondary",className:"text-xs font-mono",children:[H,'="',j,'"']},H))})}),T.jsx("div",{className:"text-right",children:F.value&&T.jsxs("div",{children:[T.jsx("p",{className:"text-2xl font-bold metric-value",children:R(F.value[1])}),T.jsxs("p",{className:"text-xs text-slate-400 font-mono mt-1",children:["@ ",new Date(F.value[0]*1e3).toLocaleTimeString()]})]})})]})},q))})]}),d&&d.length===0&&T.jsx(zu,{className:"p-6 bg-slate-800/30 border-slate-700/50",children:T.jsx("p",{className:"text-sm text-slate-400 text-center",children:"No results found for this query."})})]})}function $ve(){const[e,t]=ie.useState([]),[a,l]=ie.useState(!1),[d,_]=ie.useState(null),[v,i]=ie.useState(null);Qp();const P=async()=>{l(!0),i(null);try{const j=await fetch("http://localhost:9091/api/v1/rules");if(!j.ok)throw new Error(`HTTP ${j.status}: ${j.statusText}`);const $=await j.json();if($.status==="success"){const Y=[];$.data.groups.forEach(K=>{K.alerts?.forEach(re=>{Y.push(re)})}),t(Y),_(new Date)}else throw new Error("Failed to fetch alerts")}catch(j){const $=j instanceof Error?j.message:"Failed to fetch alerts";i($),console.error("Alert fetch error:",j)}finally{l(!1)}};ie.useEffect(()=>{P();const j=setInterval(P,3e4);return()=>clearInterval(j)},[]);const I=j=>{switch(j.toLowerCase()){case"critical":return T.jsx(O_,{className:"h-5 w-5 text-red-400"});case"warning":return T.jsx(Kk,{className:"h-5 w-5 text-yellow-400"});case"info":return T.jsx(H7,{className:"h-5 w-5 text-blue-400"});default:return T.jsx(cp,{className:"h-5 w-5 text-slate-400"})}},M=j=>{switch(j.toLowerCase()){case"critical":return"border-red-500/50 bg-red-500/10";case"warning":return"border-yellow-500/50 bg-yellow-500/10";case"info":return"border-blue-500/50 bg-blue-500/10";default:return"border-slate-500/50 bg-slate-500/10"}},R=j=>{switch(j.toLowerCase()){case"firing":return T.jsx(Ji,{variant:"destructive",className:"text-xs",children:"Firing"});case"pending":return T.jsx(Ji,{className:"text-xs bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Pending"});case"inactive":return T.jsx(Ji,{variant:"secondary",className:"text-xs",children:"Inactive"});default:return T.jsx(Ji,{variant:"outline",className:"text-xs",children:j})}},F=e.filter(j=>j.state==="firing"),q=e.filter(j=>j.state==="pending"),H=F.length+q.length;return T.jsxs("div",{className:"space-y-6",children:[T.jsxs("div",{className:"premium-card p-6",children:[T.jsxs("div",{className:"flex items-center justify-between mb-6",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 shadow-lg shadow-orange-500/30",children:T.jsx(cp,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Live Alert Status"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Real-time monitoring from Prometheus Alert Manager"})]})]}),T.jsxs("div",{className:"flex items-center gap-3",children:[d&&T.jsxs("span",{className:"text-xs text-slate-400 flex items-center gap-1",children:[T.jsx(_4,{className:"h-3 w-3"}),d.toLocaleTimeString()]}),T.jsx(Ii,{onClick:P,disabled:a,size:"sm",variant:"outline",className:"border-slate-700",children:T.jsx(B_,{className:`h-4 w-4 ${a?"animate-spin":""}`})}),T.jsx("a",{href:"http://localhost:9091/alerts",target:"_blank",rel:"noopener noreferrer",className:"text-slate-400 hover:text-slate-200",children:T.jsx(Du,{className:"h-4 w-4"})})]})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[T.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-br from-red-500/10 to-red-600/5 border border-red-500/30",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-slate-400",children:"Firing Alerts"}),T.jsx("p",{className:"text-3xl font-bold text-red-400 mt-1",children:F.length})]}),T.jsx(O_,{className:"h-8 w-8 text-red-400 opacity-50"})]})}),T.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-br from-yellow-500/10 to-yellow-600/5 border border-yellow-500/30",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-slate-400",children:"Pending Alerts"}),T.jsx("p",{className:"text-3xl font-bold text-yellow-400 mt-1",children:q.length})]}),T.jsx(Kk,{className:"h-8 w-8 text-yellow-400 opacity-50"})]})}),T.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-br from-green-500/10 to-green-600/5 border border-green-500/30",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{children:[T.jsx("p",{className:"text-sm text-slate-400",children:"Total Active"}),T.jsx("p",{className:"text-3xl font-bold text-green-400 mt-1",children:H})]}),T.jsx(cp,{className:"h-8 w-8 text-green-400 opacity-50"})]})})]})]}),v&&T.jsx(zu,{className:"p-4 bg-red-500/10 border-red-500/30",children:T.jsxs("div",{className:"flex items-start gap-3",children:[T.jsx(O_,{className:"h-5 w-5 text-red-400 mt-0.5"}),T.jsxs("div",{children:[T.jsx("p",{className:"text-sm font-semibold text-red-400",children:"Failed to fetch alerts"}),T.jsx("p",{className:"text-xs text-red-300 mt-1",children:v}),T.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:["Make sure Prometheus is running at ",T.jsx("code",{className:"bg-slate-800 px-1 rounded",children:"localhost:9091"})]})]})]})}),!v&&e.length>0&&T.jsx("div",{className:"space-y-3",children:e.map((j,$)=>T.jsx(zu,{className:`p-4 ${M(j.labels.severity)} border`,children:T.jsxs("div",{className:"flex items-start gap-4",children:[T.jsx("div",{className:"mt-1",children:I(j.labels.severity)}),T.jsxs("div",{className:"flex-1 space-y-2",children:[T.jsxs("div",{className:"flex items-start justify-between gap-4",children:[T.jsxs("div",{children:[T.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[T.jsx("h4",{className:"text-md font-semibold text-slate-100",children:j.labels.alertname}),R(j.state),T.jsx(Ji,{variant:"outline",className:"text-xs",children:j.labels.severity}),j.labels.layer&&T.jsx(Ji,{variant:"secondary",className:"text-xs",children:j.labels.layer})]}),T.jsx("p",{className:"text-sm text-slate-300",children:j.annotations.summary}),T.jsx("p",{className:"text-xs text-slate-400 mt-1",children:j.annotations.description})]}),T.jsxs("div",{className:"text-right text-xs text-slate-400 whitespace-nowrap",children:[T.jsx("p",{children:"Since:"}),T.jsx("p",{className:"font-mono",children:new Date(j.activeAt).toLocaleString()})]})]}),T.jsx("div",{className:"flex flex-wrap gap-1 pt-2 border-t border-slate-700/30",children:Object.entries(j.labels).filter(([Y])=>!["alertname","severity","layer"].includes(Y)).map(([Y,K])=>T.jsxs(Ji,{variant:"outline",className:"text-xs font-mono",children:[Y,"=",K]},Y))})]})]})},$))}),!v&&!a&&e.length===0&&T.jsx(zu,{className:"p-8 bg-green-500/10 border-green-500/30",children:T.jsxs("div",{className:"text-center",children:[T.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-500/20 mb-4",children:T.jsx(cp,{className:"h-8 w-8 text-green-400"})}),T.jsx("h4",{className:"text-lg font-semibold text-slate-100 mb-2",children:"All Clear!"}),T.jsx("p",{className:"text-sm text-slate-400",children:"No active alerts at this time."})]})})]})}const tP="http://localhost:3000";function qve(){const[e,t]=ie.useState(null),a=[{id:"system-overview",title:"System Overview",description:"Complete system health, uptime, and resource usage",uid:"shadowcheck-overview",icon:id,color:"from-blue-500 to-cyan-600"},{id:"database-metrics",title:"Database Metrics",description:"PostgreSQL performance, connections, and query stats",uid:"shadowcheck-db",icon:Lu,color:"from-purple-500 to-pink-600"},{id:"api-performance",title:"API Performance",description:"Request rates, response times, and error rates",uid:"shadowcheck-api",icon:Cb,color:"from-green-500 to-emerald-600"},{id:"network-analysis",title:"Network Analysis",description:"WiFi network detection and location tracking",uid:"shadowcheck-networks",icon:W7,color:"from-orange-500 to-red-600"}],l=(d,_=!1)=>`${tP}/d/${d}${_?"?kiosk=tv&theme=dark&refresh=30s":"?theme=dark"}`;return T.jsxs("div",{className:"space-y-6",children:[T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map(d=>{const _=d.icon;return T.jsx(zu,{className:"premium-card overflow-hidden hover:scale-[1.02] transition-transform cursor-pointer",onClick:()=>t(d.uid),children:T.jsxs("div",{className:"p-6",children:[T.jsx("div",{className:"flex items-start justify-between mb-4",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:`icon-container w-12 h-12 bg-gradient-to-br ${d.color} shadow-lg`,children:T.jsx(_,{className:"h-6 w-6 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:d.title}),T.jsx("p",{className:"text-xs text-slate-400 mt-1",children:d.description})]})]})}),T.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[T.jsxs(Ii,{size:"sm",variant:"outline",className:"flex-1 border-slate-700 hover:bg-slate-800",onClick:v=>{v.stopPropagation(),t(d.uid)},children:[T.jsx(Z7,{className:"h-4 w-4 mr-2"}),"View Embedded"]}),T.jsxs(Ii,{size:"sm",className:`flex-1 bg-gradient-to-r ${d.color}`,onClick:v=>{v.stopPropagation(),window.open(l(d.uid,!1),"_blank")},children:[T.jsx(Du,{className:"h-4 w-4 mr-2"}),"Open in Grafana"]})]})]})},d.id)})}),e&&T.jsxs("div",{className:"premium-card p-6",children:[T.jsxs("div",{className:"flex items-center justify-between mb-4",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 shadow-lg shadow-orange-500/30",children:T.jsx(Ec,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:a.find(d=>d.uid===e)?.title}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Live dashboard from Grafana"})]})]}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsxs(Ji,{variant:"default",className:"bg-green-500/20 text-green-400 border-green-500/30",children:[T.jsx(B_,{className:"h-3 w-3 mr-1 animate-spin"}),"Auto-refresh"]}),T.jsx(Ii,{size:"sm",variant:"outline",onClick:()=>{const d=document.getElementById("grafana-iframe");d&&(d.src=d.src)},className:"border-slate-700",children:T.jsx(B_,{className:"h-4 w-4"})}),T.jsx(Ii,{size:"sm",variant:"outline",onClick:()=>window.open(l(e,!1),"_blank"),className:"border-slate-700",children:T.jsx(Du,{className:"h-4 w-4"})}),T.jsx(Ii,{size:"sm",variant:"outline",onClick:()=>t(null),className:"border-slate-700",children:"Close"})]})]}),T.jsx("div",{className:"relative w-full bg-slate-900 rounded-lg overflow-hidden border border-slate-700",children:T.jsx("div",{className:"aspect-video",children:T.jsx("iframe",{id:"grafana-iframe",src:l(e,!0),className:"w-full h-full",style:{minHeight:"600px"},frameBorder:"0",title:"Grafana Dashboard"})})}),T.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 mt-4",children:T.jsxs("p",{className:"text-sm text-blue-400",children:[T.jsx("strong",{children:"Note:"})," Dashboard auto-refreshes every 30 seconds. Open in Grafana for full interactive experience with custom time ranges and filters."]})})]}),!e&&T.jsx(zu,{className:"premium-card p-6",children:T.jsxs("div",{className:"space-y-4",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 shadow-lg shadow-cyan-500/30",children:T.jsx(Ec,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Grafana Access"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Direct access to Grafana interface"})]})]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"URL"}),T.jsx("p",{className:"text-slate-100 font-mono text-sm",children:tP})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Credentials"}),T.jsx("p",{className:"text-slate-100 font-mono text-sm",children:"admin / [see monitoring tab]"})]})]}),T.jsxs(Ii,{className:"w-full bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700",onClick:()=>window.open(tP,"_blank"),children:[T.jsx(Du,{className:"h-4 w-4 mr-2"}),"Open Grafana"]})]})})]})}var Ws="Accordion",Gve=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[QO,Hve,Wve]=Cy(Ws),[kw]=Gs(Ws,[Wve,jG]),eM=jG(),B8=He.forwardRef((e,t)=>{const{type:a,...l}=e,d=l,_=l;return T.jsx(QO.Provider,{scope:e.__scopeAccordion,children:a==="multiple"?T.jsx(Yve,{..._,ref:t}):T.jsx(Kve,{...d,ref:t})})});B8.displayName=Ws;var[U8,Zve]=kw(Ws),[V8,Xve]=kw(Ws,{collapsible:!1}),Kve=He.forwardRef((e,t)=>{const{value:a,defaultValue:l,onValueChange:d=()=>{},collapsible:_=!1,...v}=e,[i,P]=Il({prop:a,defaultProp:l??"",onChange:d,caller:Ws});return T.jsx(U8,{scope:e.__scopeAccordion,value:He.useMemo(()=>i?[i]:[],[i]),onItemOpen:P,onItemClose:He.useCallback(()=>_&&P(""),[_,P]),children:T.jsx(V8,{scope:e.__scopeAccordion,collapsible:_,children:T.jsx($8,{...v,ref:t})})})}),Yve=He.forwardRef((e,t)=>{const{value:a,defaultValue:l,onValueChange:d=()=>{},..._}=e,[v,i]=Il({prop:a,defaultProp:l??[],onChange:d,caller:Ws}),P=He.useCallback(M=>i((R=[])=>[...R,M]),[i]),I=He.useCallback(M=>i((R=[])=>R.filter(F=>F!==M)),[i]);return T.jsx(U8,{scope:e.__scopeAccordion,value:v,onItemOpen:P,onItemClose:I,children:T.jsx(V8,{scope:e.__scopeAccordion,collapsible:!0,children:T.jsx($8,{..._,ref:t})})})}),[Jve,Nw]=kw(Ws),$8=He.forwardRef((e,t)=>{const{__scopeAccordion:a,disabled:l,dir:d,orientation:_="vertical",...v}=e,i=He.useRef(null),P=ui(i,t),I=Hve(a),R=Vy(d)==="ltr",F=Pr(e.onKeyDown,q=>{if(!Gve.includes(q.key))return;const H=q.target,j=I().filter(Pe=>!Pe.ref.current?.disabled),$=j.findIndex(Pe=>Pe.ref.current===H),Y=j.length;if($===-1)return;q.preventDefault();let K=$;const re=0,se=Y-1,J=()=>{K=$+1,K>se&&(K=re)},ae=()=>{K=$-1,K<re&&(K=se)};switch(q.key){case"Home":K=re;break;case"End":K=se;break;case"ArrowRight":_==="horizontal"&&(R?J():ae());break;case"ArrowDown":_==="vertical"&&J();break;case"ArrowLeft":_==="horizontal"&&(R?ae():J());break;case"ArrowUp":_==="vertical"&&ae();break}const de=K%Y;j[de].ref.current?.focus()});return T.jsx(Jve,{scope:a,disabled:l,direction:d,orientation:_,children:T.jsx(QO.Slot,{scope:a,children:T.jsx(yn.div,{...v,"data-orientation":_,ref:P,onKeyDown:l?void 0:F})})})}),Pb="AccordionItem",[Qve,tM]=kw(Pb),q8=He.forwardRef((e,t)=>{const{__scopeAccordion:a,value:l,...d}=e,_=Nw(Pb,a),v=Zve(Pb,a),i=eM(a),P=Cl(),I=l&&v.value.includes(l)||!1,M=_.disabled||e.disabled;return T.jsx(Qve,{scope:a,open:I,disabled:M,triggerId:P,children:T.jsx(BG,{"data-orientation":_.orientation,"data-state":K8(I),...i,...d,ref:t,disabled:M,open:I,onOpenChange:R=>{R?v.onItemOpen(l):v.onItemClose(l)}})})});q8.displayName=Pb;var G8="AccordionHeader",H8=He.forwardRef((e,t)=>{const{__scopeAccordion:a,...l}=e,d=Nw(Ws,a),_=tM(G8,a);return T.jsx(yn.h3,{"data-orientation":d.orientation,"data-state":K8(_.open),"data-disabled":_.disabled?"":void 0,...l,ref:t})});H8.displayName=G8;var QI="AccordionTrigger",W8=He.forwardRef((e,t)=>{const{__scopeAccordion:a,...l}=e,d=Nw(Ws,a),_=tM(QI,a),v=Xve(QI,a),i=eM(a);return T.jsx(QO.ItemSlot,{scope:a,children:T.jsx(Wye,{"aria-disabled":_.open&&!v.collapsible||void 0,"data-orientation":d.orientation,id:_.triggerId,...i,...l,ref:t})})});W8.displayName=QI;var Z8="AccordionContent",X8=He.forwardRef((e,t)=>{const{__scopeAccordion:a,...l}=e,d=Nw(Ws,a),_=tM(Z8,a),v=eM(a);return T.jsx(Zye,{role:"region","aria-labelledby":_.triggerId,"data-orientation":d.orientation,...v,...l,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});X8.displayName=Z8;function K8(e){return e?"open":"closed"}var exe=B8,txe=q8,rxe=H8,Y8=W8,J8=X8;const nxe=exe,Q8=ie.forwardRef(({className:e,...t},a)=>T.jsx(txe,{ref:a,className:Nn("border-b",e),...t}));Q8.displayName="AccordionItem";const eH=ie.forwardRef(({className:e,children:t,...a},l)=>T.jsx(rxe,{className:"flex",children:T.jsxs(Y8,{ref:l,className:Nn("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...a,children:[t,T.jsx(Ib,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));eH.displayName=Y8.displayName;const tH=ie.forwardRef(({className:e,children:t,...a},l)=>T.jsx(J8,{ref:l,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:T.jsx("div",{className:Nn("pb-4 pt-0",e),children:t})}));tH.displayName=J8.displayName;function o4(){const[e,t]=ie.useState(!1),[a,l]=ie.useState(!1),[d,_]=ie.useState(!1),{toast:v}=Qp(),{data:i}=Po({queryKey:["/api/v1/status"],queryFn:()=>po.getSystemStatus(),refetchInterval:5e3}),P=(M,R)=>{navigator.clipboard.writeText(M),v({title:"Copied to clipboard",description:`${R} has been copied to your clipboard.`})},I=[{path:"GET /api/v1/health",active:!0},{path:"GET /api/v1/status",active:i?.database.connected||!1},{path:"GET /api/v1/networks",active:i?.database.connected||!1},{path:"GET /api/v1/within",active:i?.database.connected||!1},{path:"GET /api/v1/g63/networks",active:i?.database.connected||!1},{path:"GET /api/v1/g63/locations",active:i?.database.connected||!1},{path:"GET /api/v1/g63/visualize",active:i?.database.connected||!1}];return T.jsx("div",{className:"flex-1 flex flex-col overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:T.jsx("main",{className:"flex-1 overflow-y-auto",children:T.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[T.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 shadow-lg shadow-orange-500/30",children:T.jsx(Us,{className:"h-6 w-6 text-white"})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(59,130,246,0.5)]",children:"System Administration"}),T.jsx("p",{className:"text-sm text-slate-400 cyber-text tracking-wide mt-1",children:"Complete system health, API status, and database monitoring"})]})]}),T.jsxs(t8,{defaultValue:"system",className:"w-full",children:[T.jsx("div",{className:"premium-card p-2 mb-6",children:T.jsxs(KO,{className:"grid w-full grid-cols-6 bg-transparent gap-2",children:[T.jsxs(zs,{value:"system","data-testid":"tab-system",className:"premium-card hover:scale-105 flex items-center gap-2",children:[T.jsx(id,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden lg:inline",children:"System"})]}),T.jsxs(zs,{value:"api","data-testid":"tab-api",className:"premium-card hover:scale-105 flex items-center gap-2",children:[T.jsx(Yk,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden lg:inline",children:"API"})]}),T.jsxs(zs,{value:"database","data-testid":"tab-database",className:"premium-card hover:scale-105 flex items-center gap-2",children:[T.jsx(Lu,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden lg:inline",children:"Database"})]}),T.jsxs(zs,{value:"monitoring",className:"premium-card hover:scale-105 flex items-center gap-2",children:[T.jsx(Ec,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden lg:inline",children:"Monitoring"})]}),T.jsxs(zs,{value:"logs",className:"premium-card hover:scale-105 flex items-center gap-2",children:[T.jsx(Jk,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden lg:inline",children:"Logs"})]}),T.jsxs(zs,{value:"alerts",className:"premium-card hover:scale-105 flex items-center gap-2",children:[T.jsx(cp,{className:"h-4 w-4"}),T.jsx("span",{className:"hidden lg:inline",children:"Alerts"})]})]})}),T.jsxs(Fs,{value:"system",className:"space-y-6",children:[T.jsx(Fve,{}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"premium-card p-6",children:[T.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 shadow-lg shadow-cyan-500/30",children:T.jsx(Lu,{className:"h-6 w-6 text-white"})}),T.jsx("div",{children:T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("span",{className:`w-3 h-3 rounded-full ${i?.database.connected?"bg-green-500":"bg-red-500"} animate-pulse`}),T.jsx("span",{className:"font-semibold text-lg text-slate-100",children:"Database Connection"})]})})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsxs("p",{className:"text-sm text-slate-300",children:["Status: ",T.jsx("span",{className:"font-medium cyber-text",children:i?.database.connected?"Connected":"Disconnected"})]}),T.jsxs("p",{className:"text-xs text-slate-400 font-mono",children:["PostGIS: ",T.jsx("span",{className:"text-cyan-400",children:i?.database.postgisEnabled?"Enabled":"Disabled"})]})]})]}),T.jsxs("div",{className:"premium-card p-6",children:[T.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[T.jsx("div",{className:"icon-container w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 shadow-lg shadow-purple-500/30",children:T.jsx(aP,{className:"h-6 w-6 text-white"})}),T.jsx("div",{children:T.jsx("span",{className:"font-semibold text-lg text-slate-100",children:"Memory Usage"})})]}),T.jsxs("div",{className:"space-y-2",children:[T.jsxs("p",{className:"text-sm text-slate-300",children:["Used: ",T.jsx("span",{className:"font-medium metric-value text-xl",children:i?.memory.used||0}),T.jsx("span",{className:"text-xs text-slate-400 ml-1",children:"MB"})]}),T.jsxs("p",{className:"text-xs text-slate-400 font-mono",children:["Total: ",T.jsxs("span",{className:"text-purple-400",children:[i?.memory.total||0," MB"]})]})]})]})]}),T.jsx("div",{className:"premium-card",children:T.jsx(nxe,{type:"single",collapsible:!0,children:T.jsxs(Q8,{value:"api-endpoints",className:"border-0",children:[T.jsx(eH,{className:"px-6 py-4 hover:no-underline",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-amber-500 to-yellow-600 shadow-lg shadow-amber-500/30",children:T.jsx(Yk,{className:"h-5 w-5 text-white"})}),T.jsx("span",{className:"font-semibold text-lg text-slate-100",children:"API Endpoint Status"})]})}),T.jsx(tH,{className:"px-6 pb-4",children:T.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:I.map((M,R)=>T.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:border-slate-600/50 transition-colors",children:[T.jsx("span",{className:"text-sm font-mono text-slate-300",children:M.path}),T.jsx(Ji,{variant:M.active?"default":"destructive",className:"text-xs",children:M.active?"Active":"Inactive"})]},R))})})]})})})]}),T.jsx(Fs,{value:"api",className:"space-y-6",children:T.jsx(Bve,{})}),T.jsx(Fs,{value:"database",className:"space-y-6",children:T.jsx(Uve,{})}),T.jsxs(Fs,{value:"monitoring",className:"space-y-6",children:[T.jsx(qve,{}),T.jsx(Vve,{}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 shadow-lg shadow-orange-500/30",children:T.jsx(Ec,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Grafana Dashboard"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Metrics visualization and monitoring"})]})]}),T.jsxs("a",{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-md hover:from-orange-600 hover:to-red-700 transition-all shadow-lg shadow-orange-500/20 flex items-center gap-2",children:[T.jsx(Du,{className:"h-4 w-4"}),"Open Grafana"]})]})}),T.jsxs("div",{className:"p-6 space-y-4",children:[T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm text-slate-400",children:"Username"}),T.jsx("button",{onClick:()=>P("admin","Grafana username"),className:"text-slate-400 hover:text-slate-200 transition-colors",children:T.jsx(Bx,{className:"h-4 w-4"})})]}),T.jsx("p",{className:"text-slate-100 font-mono",children:"admin"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm text-slate-400",children:"Password"}),T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx("button",{onClick:()=>l(!a),className:"text-slate-400 hover:text-slate-200 transition-colors",children:a?T.jsx(X7,{className:"h-4 w-4"}):T.jsx(h4,{className:"h-4 w-4"})}),T.jsx("button",{onClick:()=>P("KZQvo7+1Vj5lEw9P4dVwJi40OcHYA6kJR1iCULWza4k=","Grafana password"),className:"text-slate-400 hover:text-slate-200 transition-colors",children:T.jsx(Bx,{className:"h-4 w-4"})})]})]}),T.jsx("p",{className:"text-slate-100 font-mono text-sm",children:a?"KZQvo7+1Vj5lEw9P4dVwJi40OcHYA6kJR1iCULWza4k=":""})]})]}),T.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:T.jsxs("p",{className:"text-sm text-blue-400",children:[T.jsx("strong",{children:"Available Datasources:"})," Prometheus (metrics), Loki (logs), PostgreSQL (direct DB access)"]})})]})]}),T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-red-500 to-orange-600 shadow-lg shadow-red-500/30",children:T.jsx(id,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Prometheus Metrics"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Time-series metrics collection"})]})]}),T.jsxs("a",{href:"http://localhost:9091",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-gradient-to-r from-red-500 to-orange-600 text-white rounded-md hover:from-red-600 hover:to-orange-700 transition-all shadow-lg shadow-red-500/20 flex items-center gap-2",children:[T.jsx(Du,{className:"h-4 w-4"}),"Open Prometheus"]})]})}),T.jsx("div",{className:"p-6 space-y-4",children:T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Metrics Port"}),T.jsx("p",{className:"text-slate-100 font-mono",children:":9091"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Retention"}),T.jsx("p",{className:"text-slate-100 font-mono",children:"30 days"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Scrape Interval"}),T.jsx("p",{className:"text-slate-100 font-mono",children:"15s"})]})]})})]}),T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 shadow-lg shadow-blue-500/30",children:T.jsx(K7,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"pgAdmin Database Manager"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"PostgreSQL administration interface"})]})]}),T.jsxs("a",{href:"http://localhost:8080",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-md hover:from-blue-600 hover:to-cyan-700 transition-all shadow-lg shadow-blue-500/20 flex items-center gap-2",children:[T.jsx(Du,{className:"h-4 w-4"}),"Open pgAdmin"]})]})}),T.jsxs("div",{className:"p-6 space-y-4",children:[T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm text-slate-400",children:"Email"}),T.jsx("button",{onClick:()=>P("admin@shadowcheck.local","pgAdmin email"),className:"text-slate-400 hover:text-slate-200 transition-colors",children:T.jsx(Bx,{className:"h-4 w-4"})})]}),T.jsx("p",{className:"text-slate-100 font-mono text-sm",children:"admin@shadowcheck.local"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm text-slate-400",children:"Password"}),T.jsx("button",{onClick:()=>P("admin123","pgAdmin password"),className:"text-slate-400 hover:text-slate-200 transition-colors",children:T.jsx(Bx,{className:"h-4 w-4"})})]}),T.jsx("p",{className:"text-slate-100 font-mono",children:"admin123"})]})]}),T.jsx("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-4",children:T.jsxs("p",{className:"text-sm text-amber-400",children:[T.jsx("strong",{children:"Note:"})," Start pgAdmin with ",T.jsx("code",{className:"bg-slate-800 px-2 py-1 rounded",children:"docker-compose --profile admin up -d"})]})})]})]})]})]}),T.jsx(Fs,{value:"logs",className:"space-y-6",children:T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30",children:T.jsx(Jk,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Loki Log Aggregation"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Centralized log management with Promtail"})]})]}),T.jsxs("a",{href:"http://localhost:3000/explore",target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-md hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg shadow-green-500/20 flex items-center gap-2",children:[T.jsx(Du,{className:"h-4 w-4"}),"View in Grafana"]})]})}),T.jsxs("div",{className:"p-6 space-y-4",children:[T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Loki Port"}),T.jsx("p",{className:"text-slate-100 font-mono",children:":3100"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Log Sources"}),T.jsx("p",{className:"text-slate-100 font-mono",children:"Backend, Frontend, DB"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700/50",children:[T.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"Status"}),T.jsx(Ji,{variant:"default",className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"})]})]}),T.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[T.jsx("p",{className:"text-sm text-slate-300 mb-2",children:T.jsx("strong",{children:"Log Labels Available:"})}),T.jsxs("div",{className:"flex flex-wrap gap-2",children:[T.jsx("code",{className:"bg-slate-900 px-2 py-1 rounded text-xs text-green-400",children:"service"}),T.jsx("code",{className:"bg-slate-900 px-2 py-1 rounded text-xs text-green-400",children:"app=shadowcheck"}),T.jsx("code",{className:"bg-slate-900 px-2 py-1 rounded text-xs text-green-400",children:"layer=api|database|web"})]})]})]})]})}),T.jsxs(Fs,{value:"alerts",className:"space-y-6",children:[T.jsx($ve,{}),T.jsxs("div",{className:"premium-card",children:[T.jsx("div",{className:"p-6 border-b border-slate-700/50",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"icon-container w-10 h-10 bg-gradient-to-br from-yellow-500 to-amber-600 shadow-lg shadow-yellow-500/30",children:T.jsx(cp,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Configured Alert Rules"}),T.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Monitoring alert thresholds and conditions"})]})]})}),T.jsxs("div",{className:"p-6 space-y-4",children:[T.jsxs("div",{className:"space-y-3",children:[T.jsxs("h4",{className:"text-md font-semibold text-slate-200 flex items-center gap-2",children:[T.jsx(rC,{className:"h-4 w-4 text-blue-400"}),"Service Availability"]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-red-500/30",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"ServiceDown"}),T.jsx(Ji,{variant:"destructive",className:"text-xs",children:"Critical"})]}),T.jsx("p",{className:"text-xs text-slate-400",children:"Triggers when service is down for 2+ minutes"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-yellow-500/30",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"HighErrorRate"}),T.jsx(Ji,{className:"text-xs bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Warning"})]}),T.jsx("p",{className:"text-xs text-slate-400",children:"Triggers when error rate exceeds 5% for 5 minutes"})]})]})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsxs("h4",{className:"text-md font-semibold text-slate-200 flex items-center gap-2",children:[T.jsx(Lu,{className:"h-4 w-4 text-cyan-400"}),"Database Health"]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-red-500/30",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"ConnectionPoolExhausted"}),T.jsx(Ji,{variant:"destructive",className:"text-xs",children:"Critical"})]}),T.jsx("p",{className:"text-xs text-slate-400",children:"Triggers when 10+ clients are waiting for connections"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-yellow-500/30",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"ConnectionPoolLow"}),T.jsx(Ji,{className:"text-xs bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Warning"})]}),T.jsx("p",{className:"text-xs text-slate-400",children:"Triggers when idle connections drop below 20%"})]})]})]}),T.jsxs("div",{className:"space-y-3",children:[T.jsxs("h4",{className:"text-md font-semibold text-slate-200 flex items-center gap-2",children:[T.jsx(aP,{className:"h-4 w-4 text-purple-400"}),"Memory Usage"]}),T.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-red-500/30",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"CriticalMemoryUsage"}),T.jsx(Ji,{variant:"destructive",className:"text-xs",children:"Critical"})]}),T.jsx("p",{className:"text-xs text-slate-400",children:"Triggers when memory usage exceeds 95% for 2 minutes"})]}),T.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-yellow-500/30",children:[T.jsxs("div",{className:"flex items-center justify-between mb-2",children:[T.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"HighMemoryUsage"}),T.jsx(Ji,{className:"text-xs bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Warning"})]}),T.jsx("p",{className:"text-xs text-slate-400",children:"Triggers when memory usage exceeds 90% for 5 minutes"})]})]})]}),T.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:T.jsxs("p",{className:"text-sm text-blue-400",children:[T.jsx("strong",{children:"View Active Alerts:"})," Check Grafana dashboard or Prometheus at ",T.jsx("a",{href:"http://localhost:9091/alerts",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"localhost:9091/alerts"})]})})]})]})]})]})]})})})}function ixe({children:e}){const[t]=P4(),[a,l]=ie.useState(!1),d=[{href:"/",icon:y4,label:"Home"},{href:"/dashboard",icon:Ec,label:"Dashboard"},{href:"/networks",icon:nd,label:"Observed Networks",highlight:!0},{href:"/visualization",icon:Cb,label:"Network Visualization"},{href:"/admin",icon:Us,label:"Admin Panel"}];return T.jsxs("div",{className:"flex h-screen overflow-hidden bg-background text-foreground",children:[T.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-card/95 backdrop-blur-sm border-b border-border/50 p-4 flex items-center justify-between",children:[T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg ring-1 ring-blue-500/20",children:T.jsx(rP,{className:"h-4 w-4 text-white"})}),T.jsxs("div",{children:[T.jsx("h1",{className:"text-lg font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent",children:"ShadowCheck"}),T.jsx("p",{className:"text-xs text-muted-foreground font-mono tracking-wider",children:"SIGINT FORENSICS"})]})]}),T.jsx("button",{onClick:()=>l(!a),className:"p-2 hover:bg-muted rounded-md transition-colors","data-testid":"mobile-menu-toggle",children:a?T.jsx(l4,{size:20}):T.jsx(Y7,{size:20})})]}),a&&T.jsx("div",{className:"fixed inset-0 z-40 bg-black/50",onClick:()=>l(!1)}),T.jsxs("div",{className:`fixed top-0 left-0 z-50 h-full w-64 bg-gradient-to-b from-card to-card/95 border-r border-border/50 backdrop-blur-sm transform transition-transform duration-300 ${a?"translate-x-0":"-translate-x-full"}`,children:[T.jsx("div",{className:"p-6 border-b border-border/50",children:T.jsxs("div",{className:"flex items-center gap-3",children:[T.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg ring-1 ring-blue-500/20",children:T.jsx(rP,{className:"h-5 w-5 text-white"})}),T.jsxs("div",{children:[T.jsx("div",{className:"flex items-center gap-2",children:T.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent",children:"ShadowCheck"})}),T.jsx("p",{className:"text-xs text-muted-foreground font-mono tracking-wider",children:"SIGINT FORENSICS"})]})]})}),T.jsx("nav",{className:"flex-1 p-4",children:T.jsx("div",{className:"space-y-1",children:d.map(_=>T.jsxs(ka,{href:_.href,className:`flex items-center gap-3 px-3 py-3 rounded-lg transition-all duration-200 group ${t===_.href?"bg-gradient-to-r from-primary/20 to-accent/20 text-primary border border-primary/20 shadow-sm":_.highlight?"hover:bg-gradient-to-r hover:from-slate-500/10 hover:to-blue-500/10 text-slate-600 hover:text-cyan-300 border border-slate-500/20 hover:border-slate-500/40":"hover:bg-muted/50 text-muted-foreground hover:text-foreground border border-transparent hover:border-border/50"}`,"data-testid":`nav-link-${_.label.toLowerCase().replace(/[^a-z0-9]/g,"-")}`,onClick:()=>l(!1),children:[T.jsx(_.icon,{className:`w-4 h-4 transition-colors ${t===_.href?"text-primary":_.highlight?"text-slate-600 group-hover:text-cyan-300":"group-hover:text-primary"}`}),T.jsx("span",{className:"text-sm font-medium",children:_.label}),_.highlight&&t!==_.href&&T.jsx("div",{className:"ml-auto px-1.5 py-0.5 bg-slate-500/20 text-slate-600 text-xs font-medium rounded",children:"NEW"}),t===_.href&&T.jsx("div",{className:"ml-auto w-2 h-2 bg-primary rounded-full"})]},_.href))})}),T.jsx("div",{className:"p-4 border-t border-border/50 bg-muted/20",children:T.jsxs("div",{className:"flex items-center justify-between text-xs",children:[T.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[T.jsx(rC,{className:"h-3 w-3"}),T.jsx("span",{children:"Replit Cloud"})]}),T.jsxs("div",{className:"flex items-center gap-1",children:[T.jsx("span",{className:"w-1.5 h-1.5 bg-accent rounded-full status-indicator"}),T.jsx("span",{className:"text-accent font-medium",children:"Live"})]})]})})]}),T.jsx("div",{className:"flex-1 pt-20 overflow-y-auto",children:e})]})}function oxe(){const[e]=P4(),t=[{href:"/",icon:y4,label:"Home",highlight:!0},{href:"/dashboard",icon:Ec,label:"Dashboard",highlight:!0},{href:"/networks",icon:nd,label:"Observed Networks",highlight:!0},{href:"/visualization",icon:Cb,label:"Network Visualization",highlight:!0},{href:"/admin",icon:Us,label:"Admin Panel",highlight:!0}];return T.jsxs("div",{className:"h-screen bg-slate-900/95 backdrop-blur-xl border-r border-slate-800/50 flex flex-col cyber-scan-line overflow-hidden",children:[T.jsx("div",{className:"p-6 border-b border-slate-800/50",children:T.jsx(ka,{href:"/",children:T.jsxs("div",{className:"flex flex-col items-center gap-4 cursor-pointer group",children:[T.jsxs("div",{className:"relative",children:[T.jsx("div",{className:"icon-container w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/50",children:T.jsx(Us,{className:"h-10 w-10 text-white"})}),T.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full border-2 border-slate-900 flex items-center justify-center",children:T.jsx("span",{className:"text-[10px] font-bold text-slate-900",children:""})})]}),T.jsxs("div",{className:"text-center",children:[T.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent group-hover:from-blue-400 group-hover:to-purple-500 transition-all duration-300 drop-shadow-[0_2px_8px_rgba(59,130,246,0.5)]",children:"ShadowCheck"}),T.jsx("p",{className:"text-[10px] text-slate-400 cyber-text tracking-widest mt-1",children:"SIGINT FORENSICS"})]})]})})}),T.jsxs("nav",{className:"flex-1 p-4 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:[T.jsx("div",{className:"space-y-2",children:t.map(a=>T.jsxs(ka,{href:a.href,className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 group ${e===a.href?"bg-gradient-to-r from-blue-500/20 to-purple-600/20 text-white border border-blue-500/30 shadow-lg cyber-glow":"hover:bg-slate-800/50 text-slate-400 hover:text-slate-200 border border-transparent hover:border-slate-700/50"}`,"data-testid":`nav-link-${a.label.toLowerCase().replace(/[^a-z0-9]/g,"-")}`,children:[T.jsx(a.icon,{className:`w-5 h-5 transition-colors ${e===a.href?"text-blue-400":"text-slate-500 group-hover:text-blue-400"}`}),T.jsx("span",{className:"text-sm font-medium",children:a.label}),e===a.href&&T.jsx("div",{className:"ml-auto w-2 h-2 bg-blue-400 rounded-full animate-pulse"})]},a.href))}),T.jsxs("div",{className:"mt-8",children:[T.jsxs("h3",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2 cyber-text",children:[T.jsx(d4,{className:"h-4 w-4 text-blue-400"}),"Quick Actions"]}),T.jsxs("div",{className:"space-y-2",children:[T.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-slate-800/30 border border-slate-700/30 hover:bg-slate-800/50 hover:border-blue-500/30 transition-all duration-200 text-left cyber-glow group",children:[T.jsx(B_,{className:"h-4 w-4 text-blue-400 group-hover:animate-spin"}),T.jsx("span",{className:"text-xs text-slate-400 group-hover:text-slate-300",children:"Refresh Data"})]}),T.jsxs("button",{className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-slate-800/30 border border-slate-700/30 hover:bg-slate-800/50 hover:border-purple-500/30 transition-all duration-200 text-left cyber-glow group",children:[T.jsx(v4,{className:"h-4 w-4 text-purple-400"}),T.jsx("span",{className:"text-xs text-slate-400 group-hover:text-slate-300",children:"Export Data"})]})]})]})]}),T.jsx("div",{className:"p-4 border-t border-slate-800/50 bg-slate-950/50",children:T.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[T.jsxs("div",{className:"flex items-center gap-2",children:[T.jsx(Us,{className:"h-4 w-4 text-blue-500"}),T.jsx("span",{className:"font-bold bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent",children:"ShadowCheck"})]}),T.jsx("div",{className:"text-[10px] text-slate-500 tracking-wider cyber-text",children:"WIRELESS INTELLIGENCE PLATFORM"}),T.jsx("div",{className:"mt-2 px-3 py-1 silver-accent rounded-full inline-block",children:T.jsx("span",{className:"text-[10px] font-semibold text-slate-700",children:"OPERATIONAL"})})]})})]})}function axe({children:e}){return T.jsxs("div",{className:"flex h-screen overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-foreground",children:[T.jsx("div",{className:"w-72 flex-shrink-0",children:T.jsx(oxe,{})}),T.jsx("div",{className:"flex-1 overflow-hidden",children:e})]})}function sxe({onRefresh:e,onExport:t}){return T.jsx("div",{className:"fixed bottom-4 right-4 md:hidden z-40",children:T.jsx("div",{className:"bg-slate-800 rounded-full p-2 shadow-lg border border-border/50 backdrop-blur-sm",children:T.jsxs("div",{className:"flex gap-2",children:[T.jsx("button",{onClick:e,className:"w-12 h-12 bg-primary/20 hover:bg-primary/30 rounded-full flex items-center justify-center transition-colors","data-testid":"fab-refresh",title:"Refresh Data",children:T.jsx(B_,{className:"h-4 w-4 text-primary"})}),T.jsx("button",{onClick:t,className:"w-12 h-12 bg-primary/20 hover:bg-primary/30 rounded-full flex items-center justify-center transition-colors","data-testid":"fab-export",title:"Export Data",children:T.jsx(v4,{className:"h-4 w-4 text-primary"})})]})})})}const lxe=e=>{const[t,a]=ie.useState(!1);return ie.useEffect(()=>{const l=window.matchMedia(e);a(l.matches);const d=_=>{a(_.matches)};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)},[e]),t};function cxe(){const e=lxe("(max-width: 768px)"),t=()=>{window.location.reload()},a=()=>{console.log("Export triggered")};return T.jsxs(T.Fragment,{children:[T.jsxs(zS,{children:[T.jsx(is,{path:"/",component:DJ}),T.jsx(is,{children:e?T.jsx(ixe,{children:T.jsxs(zS,{children:[T.jsx(is,{path:"/dashboard",component:F5}),T.jsx(is,{path:"/networks",component:()=>T.jsx("div",{className:"flex-1 px-3 md:px-6 py-4 overflow-y-auto",children:T.jsx(i4,{})})}),T.jsx(is,{path:"/visualization",component:t4}),T.jsx(is,{path:"/admin",component:()=>T.jsx("div",{className:"flex-1 px-3 md:px-6 py-4 overflow-y-auto",children:T.jsx(o4,{})})}),T.jsx(is,{component:FN})]})}):T.jsx(axe,{children:T.jsxs(zS,{children:[T.jsx(is,{path:"/dashboard",component:F5}),T.jsx(is,{path:"/networks",component:()=>T.jsx("div",{className:"flex-1 px-3 md:px-6 py-4 overflow-y-auto",children:T.jsx(i4,{})})}),T.jsx(is,{path:"/visualization",component:t4}),T.jsx(is,{path:"/admin",component:()=>T.jsx("div",{className:"flex-1 px-3 md:px-6 py-4 overflow-y-auto",children:T.jsx(o4,{})})}),T.jsx(is,{component:FN})]})})})]}),e&&T.jsx(sxe,{onRefresh:t,onExport:a})]})}function uxe(){return T.jsx(ZZ,{client:sX,children:T.jsxs(eV,{children:[T.jsx(FK,{}),T.jsx(cxe,{})]})})}rZ.createRoot(document.getElementById("root")).render(T.jsx(He.StrictMode,{children:T.jsx(uxe,{})}));
