"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = _interopRequireDefault(require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react"));
var _react2 = require("@testing-library/react");
var _infoHelper = _interopRequireDefault(require("../common/info-helper"));
var _cloudHeader = _interopRequireDefault(require("./cloud-components/cloud-header"));
var _loadStorageMap = _interopRequireDefault(require("./load-storage-map"));
var _componentJestUtils = require("../../../../test/helpers/component-jest-utils");
var _useCloudListProvider = require("../hooks/use-cloud-list-provider");
var _constants = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/src/constants/src");
// SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project

// @ts-nocheck

var InfoHelper = (0, _infoHelper["default"])();
var CloudHeader = (0, _cloudHeader["default"])(InfoHelper);
var LoadStorageMap = (0, _loadStorageMap["default"])(CloudHeader);
var DEFAULT_MAPS = [{
  id: '1234',
  title: 'first map',
  description: 'description 1',
  loadParams: {
    id: '1234'
  }
}, {
  id: '5678',
  title: 'second map',
  description: 'description 2',
  loadParams: {
    id: '5678'
  }
}];
var DEFAULT_PROVIDER = {
  name: 'test provider',
  icon: jest.fn(),
  getManagementUrl: jest.fn().mockImplementation(function () {
    return 'provider.url';
  }),
  listMaps: jest.fn().mockResolvedValue([])
};
var DEFAULT_PROPS = {
  onLoadCloudMap: jest.fn()
};
jest.mock("../hooks/use-cloud-list-provider", function () {
  return {
    useCloudListProvider: jest.fn().mockImplementation(function () {
      return {
        provider: null,
        setProvider: jest.fn(),
        cloudProviders: []
      };
    })
  };
});
describe('LoadStorageMap', function () {
  afterEach(function () {
    jest.clearAllMocks();
  });
  test('renders provider select and no cloud components when provider is set to null', function () {
    var _renderWithTheme = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)),
      getByTestId = _renderWithTheme.getByTestId;
    expect(getByTestId(_constants.dataTestIds.providerSelect)).toBeInTheDocument();
  });
  test('renders empty map list because fetchmaps return empty array', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
    var _renderWithTheme2, getByText;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
            return {
              provider: DEFAULT_PROVIDER,
              setProvider: jest.fn(),
              cloudProviders: []
            };
          });
          _renderWithTheme2 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme2.getByText;
          expect(DEFAULT_PROVIDER.listMaps).toHaveBeenCalled();

          // first show loading icon
          expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument();

          // show empty maps
          _context.next = 6;
          return (0, _react2.waitFor)(function () {
            expect(getByText('modal.loadStorageMap.noSavedMaps')).toBeInTheDocument();
          });
        case 6:
        case "end":
          return _context.stop();
      }
    }, _callee);
  })));
  test('renders map list because', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
    var mapProvider, _renderWithTheme3, getByText;
    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          mapProvider = {
            name: 'test provider',
            icon: jest.fn(),
            getManagementUrl: jest.fn().mockImplementation(function () {
              return 'provider.url';
            }),
            listMaps: jest.fn().mockResolvedValue(DEFAULT_MAPS)
          };
          _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
            return {
              provider: mapProvider,
              setProvider: jest.fn(),
              cloudProviders: []
            };
          });
          _renderWithTheme3 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme3.getByText;
          expect(mapProvider.listMaps).toHaveBeenCalled();

          // first show loading icon
          expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument();

          // show empty maps
          _context2.next = 7;
          return (0, _react2.waitFor)(function () {
            DEFAULT_MAPS.forEach(function (map) {
              expect(getByText(map.title)).toBeInTheDocument();
              expect(getByText(map.description)).toBeInTheDocument();
            });
          });
        case 7:
        case "end":
          return _context2.stop();
      }
    }, _callee2);
  })));
  test('trigger onLoadCLoudMap when clicking on a map', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
    var mapProvider, _renderWithTheme4, getByText;
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) switch (_context3.prev = _context3.next) {
        case 0:
          mapProvider = {
            name: 'test provider',
            icon: jest.fn(),
            getManagementUrl: jest.fn().mockImplementation(function () {
              return 'provider.url';
            }),
            listMaps: jest.fn().mockResolvedValue(DEFAULT_MAPS)
          };
          _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
            return {
              provider: mapProvider,
              setProvider: jest.fn(),
              cloudProviders: []
            };
          });
          _renderWithTheme4 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme4.getByText;
          expect(mapProvider.listMaps).toHaveBeenCalled();

          // first show loading icon
          expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument();

          // click on a map
          _context3.next = 7;
          return (0, _react2.waitFor)(function () {
            var map = DEFAULT_MAPS[0];
            // if the component doesn't exist this will throw an exception
            var mapTitleComponent = getByText(map.title);
            _react2.fireEvent.click(mapTitleComponent);
            expect(DEFAULT_PROPS.onLoadCloudMap).toHaveBeenCalled();
          });
        case 7:
        case "end":
          return _context3.stop();
      }
    }, _callee3);
  })));
  test('renders errors because fetchmaps rejects', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4() {
    var rejectableProvider, _renderWithTheme5, getByText;
    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) switch (_context4.prev = _context4.next) {
        case 0:
          rejectableProvider = {
            name: 'test provider',
            icon: jest.fn(),
            getManagementUrl: jest.fn().mockImplementation(function () {
              return 'provider.url';
            }),
            listMaps: jest.fn().mockRejectedValue(new Error('timeout'))
          };
          _useCloudListProvider.useCloudListProvider.mockImplementation(function () {
            return {
              provider: rejectableProvider,
              setProvider: jest.fn(),
              cloudProviders: []
            };
          });
          _renderWithTheme5 = (0, _componentJestUtils.renderWithTheme)( /*#__PURE__*/_react["default"].createElement(LoadStorageMap, DEFAULT_PROPS)), getByText = _renderWithTheme5.getByText;
          expect(rejectableProvider.listMaps).toHaveBeenCalled();

          // first show loading icon
          expect(getByText('modal.loadingDialog.loading')).toBeInTheDocument();

          // show empty maps
          _context4.next = 7;
          return (0, _react2.waitFor)(function () {
            expect(getByText('Error while fetching maps: timeout')).toBeInTheDocument();
          });
        case 7:
        case "end":
          return _context4.stop();
      }
    }, _callee4);
  })));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdDIiLCJfaW5mb0hlbHBlciIsIl9jbG91ZEhlYWRlciIsIl9sb2FkU3RvcmFnZU1hcCIsIl9jb21wb25lbnRKZXN0VXRpbHMiLCJfdXNlQ2xvdWRMaXN0UHJvdmlkZXIiLCJfY29uc3RhbnRzIiwiSW5mb0hlbHBlciIsIkNsb3VkSGVhZGVyIiwiTG9hZFN0b3JhZ2VNYXAiLCJERUZBVUxUX01BUFMiLCJpZCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJsb2FkUGFyYW1zIiwiREVGQVVMVF9QUk9WSURFUiIsIm5hbWUiLCJpY29uIiwiamVzdCIsImZuIiwiZ2V0TWFuYWdlbWVudFVybCIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsImxpc3RNYXBzIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJERUZBVUxUX1BST1BTIiwib25Mb2FkQ2xvdWRNYXAiLCJtb2NrIiwidXNlQ2xvdWRMaXN0UHJvdmlkZXIiLCJwcm92aWRlciIsInNldFByb3ZpZGVyIiwiY2xvdWRQcm92aWRlcnMiLCJkZXNjcmliZSIsImFmdGVyRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJ0ZXN0IiwiX3JlbmRlcldpdGhUaGVtZSIsInJlbmRlcldpdGhUaGVtZSIsImNyZWF0ZUVsZW1lbnQiLCJnZXRCeVRlc3RJZCIsImV4cGVjdCIsImRhdGFUZXN0SWRzIiwicHJvdmlkZXJTZWxlY3QiLCJ0b0JlSW5UaGVEb2N1bWVudCIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl9yZWdlbmVyYXRvciIsIm1hcmsiLCJfY2FsbGVlIiwiX3JlbmRlcldpdGhUaGVtZTIiLCJnZXRCeVRleHQiLCJ3cmFwIiwiX2NhbGxlZSQiLCJfY29udGV4dCIsInByZXYiLCJuZXh0IiwidG9IYXZlQmVlbkNhbGxlZCIsIndhaXRGb3IiLCJzdG9wIiwiX2NhbGxlZTIiLCJtYXBQcm92aWRlciIsIl9yZW5kZXJXaXRoVGhlbWUzIiwiX2NhbGxlZTIkIiwiX2NvbnRleHQyIiwiZm9yRWFjaCIsIm1hcCIsIl9jYWxsZWUzIiwiX3JlbmRlcldpdGhUaGVtZTQiLCJfY2FsbGVlMyQiLCJfY29udGV4dDMiLCJtYXBUaXRsZUNvbXBvbmVudCIsImZpcmVFdmVudCIsImNsaWNrIiwiX2NhbGxlZTQiLCJyZWplY3RhYmxlUHJvdmlkZXIiLCJfcmVuZGVyV2l0aFRoZW1lNSIsIl9jYWxsZWU0JCIsIl9jb250ZXh0NCIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvbW9kYWxzL2xvYWQtc3RvcmFnZS1tYXAuc3BlYy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuLy8gQHRzLW5vY2hlY2tcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge2ZpcmVFdmVudCwgd2FpdEZvcn0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgSW5mb0hlbHBlckZhY3RvcnkgZnJvbSAnLi4vY29tbW9uL2luZm8taGVscGVyJztcbmltcG9ydCBDbG91ZEhlYWRlckZhY3RvcnkgZnJvbSAnLi9jbG91ZC1jb21wb25lbnRzL2Nsb3VkLWhlYWRlcic7XG5pbXBvcnQgTG9hZFN0b3JhZ2VNYXBGYWN0b3J5IGZyb20gJy4vbG9hZC1zdG9yYWdlLW1hcCc7XG5pbXBvcnQge3JlbmRlcldpdGhUaGVtZX0gZnJvbSAndGVzdC9oZWxwZXJzL2NvbXBvbmVudC1qZXN0LXV0aWxzJztcbmltcG9ydCB7dXNlQ2xvdWRMaXN0UHJvdmlkZXJ9IGZyb20gJy4uL2hvb2tzL3VzZS1jbG91ZC1saXN0LXByb3ZpZGVyJztcbmltcG9ydCB7ZGF0YVRlc3RJZHN9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcblxuY29uc3QgSW5mb0hlbHBlciA9IEluZm9IZWxwZXJGYWN0b3J5KCk7XG5jb25zdCBDbG91ZEhlYWRlciA9IENsb3VkSGVhZGVyRmFjdG9yeShJbmZvSGVscGVyKTtcbmNvbnN0IExvYWRTdG9yYWdlTWFwID0gTG9hZFN0b3JhZ2VNYXBGYWN0b3J5KENsb3VkSGVhZGVyKTtcblxuY29uc3QgREVGQVVMVF9NQVBTID0gW1xuICB7XG4gICAgaWQ6ICcxMjM0JyxcbiAgICB0aXRsZTogJ2ZpcnN0IG1hcCcsXG4gICAgZGVzY3JpcHRpb246ICdkZXNjcmlwdGlvbiAxJyxcbiAgICBsb2FkUGFyYW1zOiB7XG4gICAgICBpZDogJzEyMzQnXG4gICAgfVxuICB9LFxuICB7XG4gICAgaWQ6ICc1Njc4JyxcbiAgICB0aXRsZTogJ3NlY29uZCBtYXAnLFxuICAgIGRlc2NyaXB0aW9uOiAnZGVzY3JpcHRpb24gMicsXG4gICAgbG9hZFBhcmFtczoge1xuICAgICAgaWQ6ICc1Njc4J1xuICAgIH1cbiAgfVxuXTtcblxuY29uc3QgREVGQVVMVF9QUk9WSURFUiA9IHtcbiAgbmFtZTogJ3Rlc3QgcHJvdmlkZXInLFxuICBpY29uOiBqZXN0LmZuKCksXG4gIGdldE1hbmFnZW1lbnRVcmw6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gJ3Byb3ZpZGVyLnVybCcpLFxuICBsaXN0TWFwczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKVxufTtcblxuY29uc3QgREVGQVVMVF9QUk9QUyA9IHtcbiAgb25Mb2FkQ2xvdWRNYXA6IGplc3QuZm4oKVxufTtcblxuamVzdC5tb2NrKCcuLi9ob29rcy91c2UtY2xvdWQtbGlzdC1wcm92aWRlcicsICgpID0+ICh7XG4gIHVzZUNsb3VkTGlzdFByb3ZpZGVyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgcHJvdmlkZXI6IG51bGwsXG4gICAgc2V0UHJvdmlkZXI6IGplc3QuZm4oKSxcbiAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgfSkpXG59KSk7XG5cbmRlc2NyaWJlKCdMb2FkU3RvcmFnZU1hcCcsICgpID0+IHtcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBwcm92aWRlciBzZWxlY3QgYW5kIG5vIGNsb3VkIGNvbXBvbmVudHMgd2hlbiBwcm92aWRlciBpcyBzZXQgdG8gbnVsbCcsICgpID0+IHtcbiAgICBjb25zdCB7Z2V0QnlUZXN0SWR9ID0gcmVuZGVyV2l0aFRoZW1lKDxMb2FkU3RvcmFnZU1hcCB7Li4uREVGQVVMVF9QUk9QU30gLz4pO1xuICAgIGV4cGVjdChnZXRCeVRlc3RJZChkYXRhVGVzdElkcy5wcm92aWRlclNlbGVjdCkpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlbmRlcnMgZW1wdHkgbWFwIGxpc3QgYmVjYXVzZSBmZXRjaG1hcHMgcmV0dXJuIGVtcHR5IGFycmF5JywgYXN5bmMgKCkgPT4ge1xuICAgIHVzZUNsb3VkTGlzdFByb3ZpZGVyLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgcHJvdmlkZXI6IERFRkFVTFRfUFJPVklERVIsXG4gICAgICBzZXRQcm92aWRlcjogamVzdC5mbigpLFxuICAgICAgY2xvdWRQcm92aWRlcnM6IFtdXG4gICAgfSkpO1xuXG4gICAgY29uc3Qge2dldEJ5VGV4dH0gPSByZW5kZXJXaXRoVGhlbWUoPExvYWRTdG9yYWdlTWFwIHsuLi5ERUZBVUxUX1BST1BTfSAvPik7XG4gICAgZXhwZWN0KERFRkFVTFRfUFJPVklERVIubGlzdE1hcHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgIC8vIGZpcnN0IHNob3cgbG9hZGluZyBpY29uXG4gICAgZXhwZWN0KGdldEJ5VGV4dCgnbW9kYWwubG9hZGluZ0RpYWxvZy5sb2FkaW5nJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG5cbiAgICAvLyBzaG93IGVtcHR5IG1hcHNcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgIGV4cGVjdChnZXRCeVRleHQoJ21vZGFsLmxvYWRTdG9yYWdlTWFwLm5vU2F2ZWRNYXBzJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlbmRlcnMgbWFwIGxpc3QgYmVjYXVzZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtYXBQcm92aWRlciA9IHtcbiAgICAgIG5hbWU6ICd0ZXN0IHByb3ZpZGVyJyxcbiAgICAgIGljb246IGplc3QuZm4oKSxcbiAgICAgIGdldE1hbmFnZW1lbnRVcmw6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gJ3Byb3ZpZGVyLnVybCcpLFxuICAgICAgbGlzdE1hcHM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShERUZBVUxUX01BUFMpXG4gICAgfTtcbiAgICB1c2VDbG91ZExpc3RQcm92aWRlci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHByb3ZpZGVyOiBtYXBQcm92aWRlcixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG5cbiAgICBjb25zdCB7Z2V0QnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZSg8TG9hZFN0b3JhZ2VNYXAgey4uLkRFRkFVTFRfUFJPUFN9IC8+KTtcbiAgICBleHBlY3QobWFwUHJvdmlkZXIubGlzdE1hcHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgIC8vIGZpcnN0IHNob3cgbG9hZGluZyBpY29uXG4gICAgZXhwZWN0KGdldEJ5VGV4dCgnbW9kYWwubG9hZGluZ0RpYWxvZy5sb2FkaW5nJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG5cbiAgICAvLyBzaG93IGVtcHR5IG1hcHNcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgIERFRkFVTFRfTUFQUy5mb3JFYWNoKG1hcCA9PiB7XG4gICAgICAgIGV4cGVjdChnZXRCeVRleHQobWFwLnRpdGxlKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgZXhwZWN0KGdldEJ5VGV4dChtYXAuZGVzY3JpcHRpb24pKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3RyaWdnZXIgb25Mb2FkQ0xvdWRNYXAgd2hlbiBjbGlja2luZyBvbiBhIG1hcCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtYXBQcm92aWRlciA9IHtcbiAgICAgIG5hbWU6ICd0ZXN0IHByb3ZpZGVyJyxcbiAgICAgIGljb246IGplc3QuZm4oKSxcbiAgICAgIGdldE1hbmFnZW1lbnRVcmw6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gJ3Byb3ZpZGVyLnVybCcpLFxuICAgICAgbGlzdE1hcHM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShERUZBVUxUX01BUFMpXG4gICAgfTtcbiAgICB1c2VDbG91ZExpc3RQcm92aWRlci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHByb3ZpZGVyOiBtYXBQcm92aWRlcixcbiAgICAgIHNldFByb3ZpZGVyOiBqZXN0LmZuKCksXG4gICAgICBjbG91ZFByb3ZpZGVyczogW11cbiAgICB9KSk7XG5cbiAgICBjb25zdCB7Z2V0QnlUZXh0fSA9IHJlbmRlcldpdGhUaGVtZSg8TG9hZFN0b3JhZ2VNYXAgey4uLkRFRkFVTFRfUFJPUFN9IC8+KTtcbiAgICBleHBlY3QobWFwUHJvdmlkZXIubGlzdE1hcHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgIC8vIGZpcnN0IHNob3cgbG9hZGluZyBpY29uXG4gICAgZXhwZWN0KGdldEJ5VGV4dCgnbW9kYWwubG9hZGluZ0RpYWxvZy5sb2FkaW5nJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG5cbiAgICAvLyBjbGljayBvbiBhIG1hcFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgY29uc3QgbWFwID0gREVGQVVMVF9NQVBTWzBdO1xuICAgICAgLy8gaWYgdGhlIGNvbXBvbmVudCBkb2Vzbid0IGV4aXN0IHRoaXMgd2lsbCB0aHJvdyBhbiBleGNlcHRpb25cbiAgICAgIGNvbnN0IG1hcFRpdGxlQ29tcG9uZW50ID0gZ2V0QnlUZXh0KG1hcC50aXRsZSk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2sobWFwVGl0bGVDb21wb25lbnQpO1xuICAgICAgZXhwZWN0KERFRkFVTFRfUFJPUFMub25Mb2FkQ2xvdWRNYXApLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgncmVuZGVycyBlcnJvcnMgYmVjYXVzZSBmZXRjaG1hcHMgcmVqZWN0cycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZWplY3RhYmxlUHJvdmlkZXIgPSB7XG4gICAgICBuYW1lOiAndGVzdCBwcm92aWRlcicsXG4gICAgICBpY29uOiBqZXN0LmZuKCksXG4gICAgICBnZXRNYW5hZ2VtZW50VXJsOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICdwcm92aWRlci51cmwnKSxcbiAgICAgIGxpc3RNYXBzOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCd0aW1lb3V0JykpXG4gICAgfTtcbiAgICB1c2VDbG91ZExpc3RQcm92aWRlci5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHByb3ZpZGVyOiByZWplY3RhYmxlUHJvdmlkZXIsXG4gICAgICBzZXRQcm92aWRlcjogamVzdC5mbigpLFxuICAgICAgY2xvdWRQcm92aWRlcnM6IFtdXG4gICAgfSkpO1xuXG4gICAgY29uc3Qge2dldEJ5VGV4dH0gPSByZW5kZXJXaXRoVGhlbWUoPExvYWRTdG9yYWdlTWFwIHsuLi5ERUZBVUxUX1BST1BTfSAvPik7XG4gICAgZXhwZWN0KHJlamVjdGFibGVQcm92aWRlci5saXN0TWFwcykudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgLy8gZmlyc3Qgc2hvdyBsb2FkaW5nIGljb25cbiAgICBleHBlY3QoZ2V0QnlUZXh0KCdtb2RhbC5sb2FkaW5nRGlhbG9nLmxvYWRpbmcnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcblxuICAgIC8vIHNob3cgZW1wdHkgbWFwc1xuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KGdldEJ5VGV4dCgnRXJyb3Igd2hpbGUgZmV0Y2hpbmcgbWFwczogdGltZW91dCcpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOzs7OztBQUlBLElBQUFBLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLFdBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLFlBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLGVBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLG1CQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxxQkFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sVUFBQSxHQUFBUCxPQUFBO0FBWEE7QUFDQTs7QUFFQTs7QUFVQSxJQUFNUSxVQUFVLEdBQUcsSUFBQU4sV0FBQSxXQUFpQixFQUFDLENBQUM7QUFDdEMsSUFBTU8sV0FBVyxHQUFHLElBQUFOLFlBQUEsV0FBa0IsRUFBQ0ssVUFBVSxDQUFDO0FBQ2xELElBQU1FLGNBQWMsR0FBRyxJQUFBTixlQUFBLFdBQXFCLEVBQUNLLFdBQVcsQ0FBQztBQUV6RCxJQUFNRSxZQUFZLEdBQUcsQ0FDbkI7RUFDRUMsRUFBRSxFQUFFLE1BQU07RUFDVkMsS0FBSyxFQUFFLFdBQVc7RUFDbEJDLFdBQVcsRUFBRSxlQUFlO0VBQzVCQyxVQUFVLEVBQUU7SUFDVkgsRUFBRSxFQUFFO0VBQ047QUFDRixDQUFDLEVBQ0Q7RUFDRUEsRUFBRSxFQUFFLE1BQU07RUFDVkMsS0FBSyxFQUFFLFlBQVk7RUFDbkJDLFdBQVcsRUFBRSxlQUFlO0VBQzVCQyxVQUFVLEVBQUU7SUFDVkgsRUFBRSxF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