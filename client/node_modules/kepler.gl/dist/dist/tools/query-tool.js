"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getQueryTool = getQueryTool;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _react = _interopRequireWildcard(require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react"));
var _reactRedux = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react-redux/lib");
var _actions = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/src/actions/src");
var _duckdb = require("@openassistant/duckdb");
var _utils = require("./utils");
function _getRequireWildcardCache(e) {
  if ("function" != typeof WeakMap) return null;
  var r = new WeakMap(),
    t = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {
    return e ? t : r;
  })(e);
}
function _interopRequireWildcard(e, r) {
  if (!r && e && e.__esModule) return e;
  if (null === e || "object" != _typeof(e) && "function" != typeof e) return {
    "default": e
  };
  var t = _getRequireWildcardCache(r);
  if (t && t.has(e)) return t.get(e);
  var n = {
      __proto__: null
    },
    a = Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {
    var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;
    i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];
  }
  return n["default"] = e, t && t.set(e, n), n;
}
function _createForOfIteratorHelper(r, e) {
  var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"];
  if (!t) {
    if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) {
      t && (r = t);
      var _n = 0,
        F = function F() {};
      return {
        s: F,
        n: function n() {
          return _n >= r.length ? {
            done: !0
          } : {
            done: !1,
            value: r[_n++]
          };
        },
        e: function e(r) {
          throw r;
        },
        f: F
      };
    }
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  var o,
    a = !0,
    u = !1;
  return {
    s: function s() {
      t = t.call(r);
    },
    n: function n() {
      var r = t.next();
      return a = r.done, r;
    },
    e: function e(r) {
      u = !0, o = r;
    },
    f: function f() {
      try {
        a || null == t["return"] || t["return"]();
      } finally {
        if (u) throw o;
      }
    }
  };
}
function _unsupportedIterableToArray(r, a) {
  if (r) {
    if ("string" == typeof r) return _arrayLikeToArray(r, a);
    var t = {}.toString.call(r).slice(8, -1);
    return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;
  }
}
function _arrayLikeToArray(r, a) {
  (null == a || a > r.length) && (a = r.length);
  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];
  return n;
}
function ownKeys(e, r) {
  var t = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var o = Object.getOwnPropertySymbols(e);
    r && (o = o.filter(function (r) {
      return Object.getOwnPropertyDescriptor(e, r).enumerable;
    })), t.push.apply(t, o);
  }
  return t;
}
function _objectSpread(e) {
  for (var r = 1; r < arguments.length; r++) {
    var t = null != arguments[r] ? arguments[r] : {};
    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {
      (0, _defineProperty2["default"])(e, r, t[r]);
    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {
      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));
    });
  }
  return e;
} // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
function getQueryTool(datasets, layers) {
  // context for query tools
  var getValues = /*#__PURE__*/function () {
    var _ref = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(datasetName, variableName) {
      var values;
      return _regenerator["default"].wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            values = (0, _utils.getValuesFromDataset)(datasets, layers, datasetName, variableName);
            return _context.abrupt("return", values);
          case 2:
          case "end":
            return _context.stop();
        }
      }, _callee);
    }));
    return function getValues(_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }();

  // customize a filterDataset tool from localQuery tool
  var filterDataset = _objectSpread(_objectSpread({}, _duckdb.localQuery), {}, {
    description: "filter the user dataset by using a select SQL query in duckdb and save the result as a new dataset. Please note:\n1. REQUIRED: In the SQL query, please use a sub-query to add an auto-increment column 'row_index' to the original dataset.\n2. The SQL query should return the selected row_index values.\n3. Please only use the variable user mentioned for variableNames.\nFor example: 'SELECT row_index  FROM (SELECT row_number() OVER () AS row_index, * FROM dataset_name) WHERE Count > 0'\n",
    context: _objectSpread(_objectSpread({}, _duckdb.localQuery.context), {}, {
      getValues: getValues
    }),
    component: FilterDatasetComponent
  });

  // customize a generic query tool from localQuery tool
  var genericQuery = _objectSpread(_objectSpread({}, _duckdb.localQuery), {}, {
    description: "execute a generic select SQL query in duckdb to answer user's question. Please note:\n1. This tool is NOT for filtering the user dataset.\n2. This tool does NOT support geometry column and geometric operations.\n3. The variableNames should not be empty. If it is not provided, then pick a variable name from the dataset.\n4. There is no need to add a sub-query to add an auto-increment column 'row_index' to the original dataset.\n",
    context: _objectSpread(_objectSpread({}, _duckdb.localQuery.context), {}, {
      getValues: getValues
    })
  });
  return {
    filterDataset: filterDataset,
    genericQuery: genericQuery
  };
}
function FilterDatasetComponent(_ref2) {
  var columnData = _ref2.columnData,
    datasetName = _ref2.datasetName,
    sql = _ref2.sql,
    dbTableName = _ref2.dbTableName,
    filteredDatasetName = _ref2.filteredDatasetName;
  var datasets = (0, _reactRedux.useSelector)(function (state) {
    return state.demo.keplerGl.map.visState.datasets;
  });
  var layers = (0, _reactRedux.useSelector)(function (state) {
    return state.demo.keplerGl.map.visState.layers;
  });
  var queryInProgress = (0, _react.useRef)(null);
  var dispatch = (0, _reactRedux.useDispatch)();
  var _useState = (0, _react.useState)(null),
    _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
    error = _useState2[0],
    setError = _useState2[1];
  (0, _react.useEffect)(function () {
    // check if the filteredDatasetName is already in the datasets
    var newDatasetId = Object.keys(datasets).find(function (dataId) {
      return datasets[dataId].label === filteredDatasetName;
    });
    // if the filteredDatasetName is already in the datasets, return
    if (newDatasetId) return;
    var query = /*#__PURE__*/function () {
      var _ref3 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if (!queryInProgress.current) {
                _context3.next = 3;
                break;
              }
              _context3.next = 3;
              return queryInProgress.current;
            case 3:
              // Create a new promise for this query
              queryInProgress.current = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
                var duckDB, safeDbTableName, conn, arrowResult, result, filteredDataset;
                return _regenerator["default"].wrap(function _callee2$(_context2) {
                  while (1) switch (_context2.prev = _context2.next) {
                    case 0:
                      _context2.prev = 0;
                      _context2.next = 3;
                      return (0, _duckdb.getDuckDB)();
                    case 3:
                      duckDB = _context2.sent;
                      if (duckDB) {
                        _context2.next = 6;
                        break;
                      }
                      throw new Error('DuckDB instance is not initialized');
                    case 6:
                      if (!(columnData && dbTableName && sql)) {
                        _context2.next = 21;
                        break;
                      }
                      // use double quotes for the table name
                      safeDbTableName = "".concat(dbTableName); // connect to the database
                      _context2.next = 10;
                      return duckDB.connect();
                    case 10:
                      conn = _context2.sent;
                      _context2.next = 13;
                      return conn.query(sql);
                    case 13:
                      arrowResult = _context2.sent;
                      // convert the arrow result to a json array
                      result = arrowResult.toArray().map(function (row) {
                        return row.toJSON();
                      }); // delete the table from the database
                      _context2.next = 17;
                      return conn.query("DROP TABLE ".concat(safeDbTableName));
                    case 17:
                      _context2.next = 19;
                      return conn.close();
                    case 19:
                      // filter the dataset with the query result
                      filteredDataset = filterDataset(datasets, layers, datasetName, result, filteredDatasetName);
                      if (filteredDataset) {
                        // add the new dataset to the map
                        dispatch((0, _actions.addDataToMap)({
                          datasets: [filteredDataset],
                          options: {
                            autoCreateLayers: true,
                            centerMap: false
                          }
                        }));
                      }
                    case 21:
                      _context2.next = 27;
                      break;
                    case 23:
                      _context2.prev = 23;
                      _context2.t0 = _context2["catch"](0);
                      console.error(_context2.t0);
                      setError(_context2.t0 instanceof Error ? _context2.t0.message : 'Unknown error occurred');
                    case 27:
                      _context2.prev = 27;
                      queryInProgress.current = null;
                      return _context2.finish(27);
                    case 30:
                    case "end":
                      return _context2.stop();
                  }
                }, _callee2, null, [[0, 23, 27, 30]]);
              }))();

              // Wait for the query to complete
              _context3.next = 6;
              return queryInProgress.current;
            case 6:
            case "end":
              return _context3.stop();
          }
        }, _callee3);
      }));
      return function query() {
        return _ref3.apply(this, arguments);
      };
    }();
    query();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  return error ? /*#__PURE__*/_react["default"].createElement("div", {
    style: {
      color: 'red',
      fontSize: '8px'
    }
  }, error) : null;
}
function filterDataset(datasets, layers, datasetName, filteredRows, filteredDatasetName) {
  // find datasetId from datasets
  var datasetId = Object.keys(datasets).find(function (dataId) {
    return datasets[dataId].label === datasetName;
  });
  if (!datasetId) return;

  // filter the original dataset
  var originalDataset = datasets[datasetId];
  var fields = originalDataset.fields;
  var rows;
  if (originalDataset.type === 'vector-tile') {
    var columnData = [];
    var _iterator = _createForOfIteratorHelper(fields),
      _step;
    try {
      for (_iterator.s(); !(_step = _iterator.n()).done;) {
        var field = _step.value;
        // get the values from the vector tile layer
        var values = (0, _utils.getValuesFromVectorTileLayer)(datasetId, layers, field);
        columnData.push(values);
      }
    } catch (err) {
      _iterator.e(err);
    } finally {
      _iterator.f();
    }
    rows = filteredRows.map(function (rowIndex) {
      return columnData.map(function (column) {
        return column[Number(rowIndex['row_index']) - 1];
      });
    });
  } else {
    rows = filteredRows.map(function (rowIndex) {
      return fields.map(function (field) {
        return originalDataset.getValue(field.name, Number(rowIndex['row_index']) - 1);
      });
    });
  }

  // create a new dataset with the filtered data
  var newDataset = {
    info: {
      id: filteredDatasetName,
      label: filteredDatasetName
    },
    data: {
      fields: fields,
      rows: rows
    }
  };
  return newDataset;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfcmVhY3RSZWR1eCIsIl9hY3Rpb25zIiwiX2R1Y2tkYiIsIl91dGlscyIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsImUiLCJXZWFrTWFwIiwiciIsInQiLCJfX2VzTW9kdWxlIiwiX3R5cGVvZiIsImhhcyIsImdldCIsIm4iLCJfX3Byb3RvX18iLCJhIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJ1IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaSIsInNldCIsIl9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJBcnJheSIsImlzQXJyYXkiLCJfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkiLCJsZW5ndGgiLCJfbiIsIkYiLCJzIiwiZG9uZSIsInZhbHVlIiwiZiIsIlR5cGVFcnJvciIsIm8iLCJuZXh0IiwiX2FycmF5TGlrZVRvQXJyYXkiLCJ0b1N0cmluZyIsInNsaWNlIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiZnJvbSIsInRlc3QiLCJvd25LZXlzIiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsImZpbHRlciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eTIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImdldFF1ZXJ5VG9vbCIsImRhdGFzZXRzIiwibGF5ZXJzIiwiZ2V0VmFsdWVzIiwiX3JlZiIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl9yZWdlbmVyYXRvciIsIm1hcmsiLCJfY2FsbGVlIiwiZGF0YXNldE5hbWUiLCJ2YXJpYWJsZU5hbWUiLCJ2YWx1ZXMiLCJ3cmFwIiwiX2NhbGxlZSQiLCJfY29udGV4dCIsInByZXYiLCJnZXRWYWx1ZXNGcm9tRGF0YXNldCIsImFicnVwdCIsInN0b3AiLCJfeCIsIl94MiIsImZpbHRlckRhdGFzZXQiLCJsb2NhbFF1ZXJ5IiwiZGVzY3JpcHRpb24iLCJjb250ZXh0IiwiY29tcG9uZW50IiwiRmlsdGVyRGF0YXNldENvbXBvbmVudCIsImdlbmVyaWNRdWVyeSIsIl9yZWYyIiwiY29sdW1uRGF0YSIsInNxbCIsImRiVGFibGVOYW1lIiwiZmlsdGVyZWREYXRhc2V0TmFtZSIsInVzZVNlbGVjdG9yIiwic3RhdGUiLCJkZW1vIiwia2VwbGVyR2wiLCJtYXAiLCJ2aXNTdGF0ZSIsInF1ZXJ5SW5Qcm9ncmVzcyIsInVzZVJlZiIsImRpc3BhdGNoIiwidXNlRGlzcGF0Y2giLCJfdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJlcnJvciIsInNldEVycm9yIiwidXNlRWZmZWN0IiwibmV3RGF0YXNldElkIiwiZmluZCIsImRhdGFJZCIsImxhYmVsIiwicXVlcnkiLCJfcmVmMyIsIl9jYWxsZWUzIiwiX2NhbGxlZTMkIiwiX2NvbnRleHQzIiwiY3VycmVudCIsIl9jYWxsZWUyIiwiZHVja0RCIiwic2FmZURiVGFibGVOYW1lIiwiY29ubiIsImFycm93UmVzdWx0IiwicmVzdWx0IiwiZmlsdGVyZWREYXRhc2V0IiwiX2NhbGxlZTIkIiwiX2NvbnRleHQyIiwiZ2V0RHVja0RCIiwic2VudCIsIkVycm9yIiwiY29uY2F0IiwiY29ubmVjdCIsInRvQXJyYXkiLCJyb3ciLCJ0b0pTT04iLCJjbG9zZSIsImFkZERhdGFUb01hcCIsIm9wdGlvbnMiLCJhdXRvQ3JlYXRlTGF5ZXJzIiwiY2VudGVyTWFwIiwidDAiLCJjb25zb2xlIiwibWVzc2FnZSIsImZpbmlzaCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImNvbG9yIiwiZm9udFNpemUiLCJmaWx0ZXJlZFJvd3MiLCJkYXRhc2V0SWQiLCJvcmlnaW5hbERhdGFzZXQiLCJmaWVsZHMiLCJyb3dzIiwidHlwZSIsIl9pdGVyYXRvciIsIl9zdGVwIiwiZmllbGQiLCJnZXRWYWx1ZXNGcm9tVmVjdG9yVGlsZUxheWVyIiwiZXJyIiwicm93SW5kZXgiLCJjb2x1bW4iLCJOdW1iZXIiLCJnZXRWYWx1ZSIsIm5ld0RhdGFzZXQiLCJpbmZvIiwiaWQiLCJkYXRhIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3Rvb2xzL3F1ZXJ5LXRvb2wudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZX0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHt1c2VEaXNwYXRjaCwgdXNlU2VsZWN0b3J9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuaW1wb3J0IHtMYXllcn0gZnJvbSAnQGtlcGxlci5nbC9sYXllcnMnO1xuaW1wb3J0IHtQcm90b0RhdGFzZXR9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuaW1wb3J0IHthZGREYXRhVG9NYXB9IGZyb20gJ0BrZXBsZXIuZ2wvYWN0aW9ucyc7XG5pbXBvcnQge2dldER1Y2tEQiwgbG9jYWxRdWVyeSwgTG9jYWxRdWVyeVRvb2x9IGZyb20gJ0BvcGVuYXNzaXN0YW50L2R1Y2tkYic7XG5cbmltcG9ydCB7Z2V0VmFsdWVzRnJvbURhdGFzZXQsIGdldFZhbHVlc0Zyb21WZWN0b3JUaWxlTGF5ZXJ9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHtTdGF0ZX0gZnJvbSAnLi4vY29tcG9uZW50cy9haS1hc3Npc3RhbnQtbWFuYWdlcic7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRRdWVyeVRvb2woZGF0YXNldHM6IERhdGFzZXRzLCBsYXllcnM6IExheWVyW10pIHtcbiAgLy8gY29udGV4dCBmb3IgcXVlcnkgdG9vbHNcbiAgY29uc3QgZ2V0VmFsdWVzID0gYXN5bmMgKGRhdGFzZXROYW1lOiBzdHJpbmcsIHZhcmlhYmxlTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgdmFsdWVzID0gZ2V0VmFsdWVzRnJvbURhdGFzZXQoZGF0YXNldHMsIGxheWVycywgZGF0YXNldE5hbWUsIHZhcmlhYmxlTmFtZSk7XG4gICAgcmV0dXJuIHZhbHVlcztcbiAgfTtcblxuICAvLyBjdXN0b21pemUgYSBmaWx0ZXJEYXRhc2V0IHRvb2wgZnJvbSBsb2NhbFF1ZXJ5IHRvb2xcbiAgY29uc3QgZmlsdGVyRGF0YXNldDogTG9jYWxRdWVyeVRvb2wgPSB7XG4gICAgLi4ubG9jYWxRdWVyeSxcbiAgICBkZXNjcmlwdGlvbjogYGZpbHRlciB0aGUgdXNlciBkYXRhc2V0IGJ5IHVzaW5nIGEgc2VsZWN0IFNRTCBxdWVyeSBpbiBkdWNrZGIgYW5kIHNhdmUgdGhlIHJlc3VsdCBhcyBhIG5ldyBkYXRhc2V0LiBQbGVhc2Ugbm90ZTpcbjEuIFJFUVVJUkVEOiBJbiB0aGUgU1FMIHF1ZXJ5LCBwbGVhc2UgdXNlIGEgc3ViLXF1ZXJ5IHRvIGFkZCBhbiBhdXRvLWluY3JlbWVudCBjb2x1bW4gJ3Jvd19pbmRleCcgdG8gdGhlIG9yaWdpbmFsIGRhdGFzZXQuXG4yLiBUaGUgU1FMIHF1ZXJ5IHNob3VsZCByZXR1cm4gdGhlIHNlbGVjdGVkIHJvd19pbmRleCB2YWx1ZXMuXG4zLiBQbGVhc2Ugb25seSB1c2UgdGhlIHZhcmlhYmxlIHVzZXIgbWVudGlvbmVkIGZvciB2YXJpYWJsZU5hbWVzLlxuRm9yIGV4YW1wbGU6ICdTRUxFQ1Qgcm93X2luZGV4ICBGUk9NIChTRUxFQ1Qgcm93X251bWJlcigpIE9WRVIgKCkgQVMgcm93X2luZGV4LCAqIEZST00gZGF0YXNldF9uYW1lKSBXSEVSRSBDb3VudCA+IDAnXG5gLFxuICAgIGNvbnRleHQ6IHtcbiAgICAgIC4uLmxvY2FsUXVlcnkuY29udGV4dCxcbiAgICAgIGdldFZhbHVlc1xuICAgIH0sXG4gICAgY29tcG9uZW50OiBGaWx0ZXJEYXRhc2V0Q29tcG9uZW50XG4gIH07XG5cbiAgLy8gY3VzdG9taXplIGEgZ2VuZXJpYyBxdWVyeSB0b29sIGZyb20gbG9jYWxRdWVyeSB0b29sXG4gIGNvbnN0IGdlbmVyaWNRdWVyeTogTG9jYWxRdWVyeVRvb2wgPSB7XG4gICAgLi4ubG9jYWxRdWVyeSxcbiAgICBkZXNjcmlwdGlvbjogYGV4ZWN1dGUgYSBnZW5lcmljIHNlbGVjdCBTUUwgcXVlcnkgaW4gZHVja2RiIHRvIGFuc3dlciB1c2VyJ3MgcXVlc3Rpb24uIFBsZWFzZSBub3RlOlxuMS4gVGhpcyB0b29sIGlzIE5PVCBmb3IgZmlsdGVyaW5nIHRoZSB1c2VyIGRhdGFzZXQuXG4yLiBUaGlzIHRvb2wgZG9lcyBOT1Qgc3VwcG9ydCBnZW9tZXRyeSBjb2x1bW4gYW5kIGdlb21ldHJpYyBvcGVyYXRpb25zLlxuMy4gVGhlIHZhcmlhYmxlTmFtZXMgc2hvdWxkIG5vdCBiZSBlbXB0eS4gSWYgaXQgaXMgbm90IHByb3ZpZGVkLCB0aGVuIHBpY2sgYSB2YXJpYWJsZSBuYW1lIGZyb20gdGhlIGRhdGFzZXQuXG40LiBUaGVyZSBpcyBubyBuZWVkIHRvIGFkZCBhIHN1Yi1xdWVyeSB0byBhZGQgYW4gYXV0by1pbmNyZW1lbnQgY29sdW1uICdyb3dfaW5kZXgnIHRvIHRoZSBvcmlnaW5hbCBkYXRhc2V0LlxuYCxcbiAgICBjb250ZXh0OiB7XG4gICAgICAuLi5sb2NhbFF1ZXJ5LmNvbnRleHQsXG4gICAgICBnZXRWYWx1ZXNcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBmaWx0ZXJEYXRhc2V0LFxuICAgIGdlbmVyaWNRdWVyeVxuICB9O1xufVxuXG5mdW5jdGlvbiBGaWx0ZXJEYXRhc2V0Q29tcG9uZW50KHtjb2x1bW5EYXRhLCBkYXRhc2V0TmFtZSwgc3FsLCBkYlRhYmxlTmFtZSwgZmlsdGVyZWREYXRhc2V0TmFtZX0pIHtcbiAgY29uc3QgZGF0YXNldHMgPSB1c2VTZWxlY3Rvcigoc3RhdGU6IFN0YXRlKSA9PiBzdGF0ZS5kZW1vLmtlcGxlckdsLm1hcC52aXNTdGF0ZS5kYXRhc2V0cyk7XG4gIGNvbnN0IGxheWVycyA9IHVzZVNlbGVjdG9yKChzdGF0ZTogU3RhdGUpID0+IHN0YXRlLmRlbW8ua2VwbGVyR2wubWFwLnZpc1N0YXRlLmxheWVycyk7XG4gIGNvbnN0IHF1ZXJ5SW5Qcm9ncmVzcyA9IHVzZVJlZjxQcm9taXNlPHZvaWQ+IHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcblxuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gY2hlY2sgaWYgdGhlIGZpbHRlcmVkRGF0YXNldE5hbWUgaXMgYWxyZWFkeSBpbiB0aGUgZGF0YXNldHNcbiAgICBjb25zdCBuZXdEYXRhc2V0SWQgPSBPYmplY3Qua2V5cyhkYXRhc2V0cykuZmluZChcbiAgICAgIGRhdGFJZCA9PiBkYXRhc2V0c1tkYXRhSWRdLmxhYmVsID09PSBmaWx0ZXJlZERhdGFzZXROYW1lXG4gICAgKTtcbiAgICAvLyBpZiB0aGUgZmlsdGVyZWREYXRhc2V0TmFtZSBpcyBhbHJlYWR5IGluIHRoZSBkYXRhc2V0cywgcmV0dXJuXG4gICAgaWYgKG5ld0RhdGFzZXRJZCkgcmV0dXJuO1xuXG4gICAgY29uc3QgcXVlcnkgPSBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBJZiBhIHF1ZXJ5IGlzIGFscmVhZHkgaW4gcHJvZ3Jlc3MsIHdhaXQgZm9yIGl0IHRvIGNvbXBsZXRlXG4gICAgICBpZiAocXVlcnlJblByb2dyZXNzLmN1cnJlbnQpIHtcbiAgICAgICAgYXdhaXQgcXVlcnlJblByb2dyZXNzLmN1cnJlbnQ7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBhIG5ldyBwcm9taXNlIGZvciB0aGlzIHF1ZXJ5XG4gICAgICBxdWVyeUluUHJvZ3Jlc3MuY3VycmVudCA9IChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZHVja0RCID0gYXdhaXQgZ2V0RHVja0RCKCk7XG4gICAgICAgICAgaWYgKCFkdWNrREIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRHVja0RCIGluc3RhbmNlIGlzIG5vdCBpbml0aWFsaXplZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY29sdW1uRGF0YSAmJiBkYlRhYmxlTmFtZSAmJiBzcWwpIHtcbiAgICAgICAgICAgIC8vIHVzZSBkb3VibGUgcXVvdGVzIGZvciB0aGUgdGFibGUgbmFtZVxuICAgICAgICAgICAgY29uc3Qgc2FmZURiVGFibGVOYW1lID0gYCR7ZGJUYWJsZU5hbWV9YDtcblxuICAgICAgICAgICAgLy8gY29ubmVjdCB0byB0aGUgZGF0YWJhc2VcbiAgICAgICAgICAgIGNvbnN0IGNvbm4gPSBhd2FpdCBkdWNrREIuY29ubmVjdCgpO1xuXG4gICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBwcm92aWRlZCBTUUwgcXVlcnlcbiAgICAgICAgICAgIGNvbnN0IGFycm93UmVzdWx0ID0gYXdhaXQgY29ubi5xdWVyeShzcWwpO1xuXG4gICAgICAgICAgICAvLyBjb252ZXJ0IHRoZSBhcnJvdyByZXN1bHQgdG8gYSBqc29uIGFycmF5XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhcnJvd1Jlc3VsdC50b0FycmF5KCkubWFwKHJvdyA9PiByb3cudG9KU09OKCkpO1xuXG4gICAgICAgICAgICAvLyBkZWxldGUgdGhlIHRhYmxlIGZyb20gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgICBhd2FpdCBjb25uLnF1ZXJ5KGBEUk9QIFRBQkxFICR7c2FmZURiVGFibGVOYW1lfWApO1xuXG4gICAgICAgICAgICAvLyBjbG9zZSB0aGUgY29ubmVjdGlvblxuICAgICAgICAgICAgYXdhaXQgY29ubi5jbG9zZSgpO1xuXG4gICAgICAgICAgICAvLyBmaWx0ZXIgdGhlIGRhdGFzZXQgd2l0aCB0aGUgcXVlcnkgcmVzdWx0XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZERhdGFzZXQgPSBmaWx0ZXJEYXRhc2V0KFxuICAgICAgICAgICAgICBkYXRhc2V0cyxcbiAgICAgICAgICAgICAgbGF5ZXJzLFxuICAgICAgICAgICAgICBkYXRhc2V0TmFtZSxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBmaWx0ZXJlZERhdGFzZXROYW1lXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAoZmlsdGVyZWREYXRhc2V0KSB7XG4gICAgICAgICAgICAgIC8vIGFkZCB0aGUgbmV3IGRhdGFzZXQgdG8gdGhlIG1hcFxuICAgICAgICAgICAgICBkaXNwYXRjaChcbiAgICAgICAgICAgICAgICBhZGREYXRhVG9NYXAoe1xuICAgICAgICAgICAgICAgICAgZGF0YXNldHM6IFtmaWx0ZXJlZERhdGFzZXRdLFxuICAgICAgICAgICAgICAgICAgb3B0aW9uczoge2F1dG9DcmVhdGVMYXllcnM6IHRydWUsIGNlbnRlck1hcDogZmFsc2V9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgc2V0RXJyb3IoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvciBvY2N1cnJlZCcpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIHF1ZXJ5SW5Qcm9ncmVzcy5jdXJyZW50ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcblxuICAgICAgLy8gV2FpdCBmb3IgdGhlIHF1ZXJ5IHRvIGNvbXBsZXRlXG4gICAgICBhd2FpdCBxdWVyeUluUHJvZ3Jlc3MuY3VycmVudDtcbiAgICB9O1xuXG4gICAgcXVlcnkoKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtdKTtcblxuICByZXR1cm4gZXJyb3IgPyA8ZGl2IHN0eWxlPXt7Y29sb3I6ICdyZWQnLCBmb250U2l6ZTogJzhweCd9fT57ZXJyb3J9PC9kaXY+IDogbnVsbDtcbn1cblxuZnVuY3Rpb24gZmlsdGVyRGF0YXNldChcbiAgZGF0YXNldHM6IERhdGFzZXRzLFxuICBsYXllcnM6IExheWVyW10sXG4gIGRhdGFzZXROYW1lOiBzdHJpbmcsXG4gIGZpbHRlcmVkUm93czogUmVjb3JkPHN0cmluZywgbnVtYmVyPltdLFxuICBmaWx0ZXJlZERhdGFzZXROYW1lOiBzdHJpbmdcbikge1xuICAvLyBmaW5kIGRhdGFzZXRJZCBmcm9tIGRhdGFzZXRzXG4gIGNvbnN0IGRhdGFzZXRJZCA9IE9iamVjdC5rZXlzKGRhdGFzZXRzKS5maW5kKGRhdGFJZCA9PiBkYXRhc2V0c1tkYXRhSWRdLmxhYmVsID09PSBkYXRhc2V0TmFtZSk7XG4gIGlmICghZGF0YXNldElkKSByZXR1cm47XG5cbiAgLy8gZmlsdGVyIHRoZSBvcmlnaW5hbCBkYXRhc2V0XG4gIGNvbnN0IG9yaWdpbmFsRGF0YXNldCA9IGRhdGFzZXRzW2RhdGFzZXRJZF07XG5cbiAgY29uc3QgZmllbGRzID0gb3JpZ2luYWxEYXRhc2V0LmZpZWxkcztcblxuICBsZXQgcm93czogdW5rbm93bltdW107XG5cbiAgaWYgKG9yaWdpbmFsRGF0YXNldC50eXBlID09PSAndmVjdG9yLXRpbGUnKSB7XG4gICAgY29uc3QgY29sdW1uRGF0YTogdW5rbm93bltdW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkcykge1xuICAgICAgLy8gZ2V0IHRoZSB2YWx1ZXMgZnJvbSB0aGUgdmVjdG9yIHRpbGUgbGF5ZXJcbiAgICAgIGNvbnN0IHZhbHVlcyA9IGdldFZhbHVlc0Zyb21WZWN0b3JUaWxlTGF5ZXIoZGF0YXNldElkLCBsYXllcnMsIGZpZWxkKTtcbiAgICAgIGNvbHVtbkRhdGEucHVzaCh2YWx1ZXMpO1xuICAgIH1cbiAgICByb3dzID0gZmlsdGVyZWRSb3dzLm1hcChyb3dJbmRleCA9PlxuICAgICAgY29sdW1uRGF0YS5tYXAoY29sdW1uID0+IGNvbHVtbltOdW1iZXIocm93SW5kZXhbJ3Jvd19pbmRleCddKSAtIDFdKVxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgcm93cyA9IGZpbHRlcmVkUm93cy5tYXAocm93SW5kZXggPT5cbiAgICAgIGZpZWxkcy5tYXAoZmllbGQgPT4gb3JpZ2luYWxEYXRhc2V0LmdldFZhbHVlKGZpZWxkLm5hbWUsIE51bWJlcihyb3dJbmRleFsncm93X2luZGV4J10pIC0gMSkpXG4gICAgKTtcbiAgfVxuXG4gIC8vIGNyZWF0ZSBhIG5ldyBkYXRhc2V0IHdpdGggdGhlIGZpbHRlcmVkIGRhdGFcbiAgY29uc3QgbmV3RGF0YXNldDogUHJvdG9EYXRhc2V0ID0ge1xuICAgIGluZm86IHtcbiAgICAgIGlkOiBmaWx0ZXJlZERhdGFzZXROYW1lLFxuICAgICAgbGFiZWw6IGZpbHRlcmVkRGF0YXNldE5hbWVcbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIGZpZWxkcyxcbiAgICAgIHJvd3NcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIG5ld0RhdGFzZXQ7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUdBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFdBQUEsR0FBQUQsT0FBQTtBQUlBLElBQUFFLFFBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLE9BQUEsR0FBQUgsT0FBQTtBQUVBLElBQUFJLE1BQUEsR0FBQUosT0FBQTtBQUEyRSxTQUFBSyx5QkFBQUMsQ0FBQTtFQUFBLHlCQUFBQyxPQUFBO0VBQUEsSUFBQUMsQ0FBQSxPQUFBRCxPQUFBO0lBQUFFLENBQUEsT0FBQUYsT0FBQTtFQUFBLFFBQUFGLHdCQUFBLFlBQUFBLHlCQUFBQyxDQUFBO0lBQUEsT0FBQUEsQ0FBQSxH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