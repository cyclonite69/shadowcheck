"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AddLayerToolComponent = AddLayerToolComponent;
exports.addLayer = void 0;
exports.guessDefaultLayer = guessDefaultLayer;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));
var _reactRedux = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react-redux/lib");
var _layers = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/src/layers/src");
var _reducers = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/src/reducers/src");
var _actions = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/src/actions/src");
var _utils = require("../utils");
var _utils2 = require("@openassistant/utils");
var _zod = require("zod");
var _react = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react");
function ownKeys(e, r) {
  var t = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var o = Object.getOwnPropertySymbols(e);
    r && (o = o.filter(function (r) {
      return Object.getOwnPropertyDescriptor(e, r).enumerable;
    })), t.push.apply(t, o);
  }
  return t;
}
function _objectSpread(e) {
  for (var r = 1; r < arguments.length; r++) {
    var t = null != arguments[r] ? arguments[r] : {};
    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {
      (0, _defineProperty2["default"])(e, r, t[r]);
    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {
      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));
    });
  }
  return e;
} // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
var addLayer = exports.addLayer = (0, _utils2.tool)({
  description: 'add a kepler.gl map layer',
  parameters: _zod.z.object({
    datasetName: _zod.z.string().describe('The name of the dataset. Note: please do NOT use the datasetId.'),
    fieldName: _zod.z.string(),
    layerType: _zod.z["enum"](['point', 'arc', 'line', 'grid', 'hexagon', 'geojson', 'cluster', 'heatmap', 'h3', 'trip', 's2']),
    colorScale: _zod.z["enum"](['quantile', 'quantize', 'ordinal', 'custom']).optional(),
    customColorScale: _zod.z.array(_zod.z.number()).optional().describe('An array of numeric breakpoints used to define custom color intervals. Only applicable when colorScale is set to "custom"')
  }),
  execute: executeAddLayer,
  component: AddLayerToolComponent
});
function isAddLayerArgs(args) {
  return (0, _typeof2["default"])(args) === 'object' && args !== null && 'datasetName' in args && 'fieldName' in args && 'layerType' in args;
}
function isAddLayerFunctionContext(context) {
  return context && typeof context.getDatasets === 'function';
}
function executeAddLayer(_x, _x2) {
  return _executeAddLayer.apply(this, arguments);
}
function _executeAddLayer() {
  _executeAddLayer = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(args, options) {
    var datasetName, fieldName, layerType, _args$colorScale, colorScale, customColorScale, datasets, datasetId, dataset, field, layer, colorField, customColorRange, newColors, newLayer;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          _context.prev = 0;
          if (isAddLayerArgs(args)) {
            _context.next = 3;
            break;
          }
          throw new Error('Invalid addLayer arguments');
        case 3:
          if (isAddLayerFunctionContext(options.context)) {
            _context.next = 5;
            break;
          }
          throw new Error('Invalid addLayer context');
        case 5:
          datasetName = args.datasetName, fieldName = args.fieldName, layerType = args.layerType, _args$colorScale = args.colorScale, colorScale = _args$colorScale === void 0 ? 'quantile' : _args$colorScale, customColorScale = args.customColorScale;
          datasets = options.context.getDatasets(); // check if dataset exists in kepler.gl
          datasetId = Object.keys(datasets).find(function (dataId) {
            return datasets[dataId].label === datasetName;
          });
          if (datasetId) {
            _context.next = 10;
            break;
          }
          throw new Error("Dataset ".concat(datasetName, " not found."));
        case 10:
          // check if field exists in the dataset
          dataset = datasets[datasetId];
          field = dataset.fields.find(function (f) {
            return f.name === fieldName;
          });
          if (field) {
            _context.next = 14;
            break;
          }
          throw new Error("Field ".concat(fieldName, " not found."));
        case 14:
          if (['quantile', 'quantize', 'ordinal', 'custom'].includes(colorScale)) {
            _context.next = 16;
            break;
          }
          throw new Error("Invalid color scale: ".concat(colorScale, "."));
        case 16:
          if (!(colorScale === 'custom' && !customColorScale)) {
            _context.next = 18;
            break;
          }
          throw new Error('Custom color scale or breaks is required when colorScale is "custom".');
        case 18:
          // check if layerType is valid
          layer = guessDefaultLayer(dataset, layerType);
          if (layer) {
            _context.next = 21;
            break;
          }
          throw new Error("Invalid layer type: ".concat(layerType, "."));
        case 21:
          colorField = {
            name: field.name,
            type: field.type
          }; // create custom colorRange if needed
          customColorRange = layer.config.visConfig.colorRange;
          if (colorScale === 'custom') {
            newColors = (0, _utils.interpolateColor)(customColorRange.colors, customColorScale.length + 1);
            customColorRange = _objectSpread(_objectSpread({}, customColorRange), {}, {
              colors: newColors,
              colorMap: newColors.map(function (color, index) {
                return [customColorScale[index] || null, color];
              })
            });
          }

          // construct new layer config for addLayer() action
          newLayer = {
            id: layer.id,
            type: layer.type,
            config: _objectSpread(_objectSpread({}, layer.config), {}, {
              dataId: datasetId,
              label: "".concat(field.name, "-").concat(colorScale),
              columns: Object.keys(layer.config.columns).reduce(function (acc, key) {
                acc[key] = layer.config.columns[key].value;
                return acc;
              }, {}),
              colorScale: colorScale,
              colorField: colorField,
              strokeColorScale: colorScale,
              strokeColorField: colorField,
              visConfig: _objectSpread(_objectSpread({}, layer.config.visConfig), {}, {
                colorRange: customColorRange,
                strokeColorRange: customColorRange
              }, customColorScale ? {
                colorDomain: customColorScale,
                strokeColorDomain: customColorScale
              } : {})
            })
          };
          return _context.abrupt("return", {
            llmResult: {
              success: true,
              layer: JSON.stringify(newLayer),
              details: "map layer with ".concat(field.name, " and ").concat(colorScale, " color scale will be added to the map.")
            },
            additionalData: {
              layer: newLayer,
              datasetId: datasetId
            }
          });
        case 28:
          _context.prev = 28;
          _context.t0 = _context["catch"](0);
          return _context.abrupt("return", {
            llmResult: {
              success: false,
              error: _context.t0 instanceof Error ? _context.t0.message : 'Unknown error',
              instruction: 'Try to fix the error. If the error persists, pause the execution and ask the user to try with different prompt and context.'
            }
          });
        case 31:
        case "end":
          return _context.stop();
      }
    }, _callee, null, [[0, 28]]);
  }));
  return _executeAddLayer.apply(this, arguments);
}
function guessDefaultLayer(dataset, layerType) {
  // special case for hexagon layer, which could be implemented as findDefaultLayerProps() in hexagon-layer.tsx
  if (layerType === 'hexagon') {
    if (dataset.fieldPairs && dataset.fieldPairs.length > 0) {
      var props = dataset.fieldPairs.map(function (fieldPair) {
        return {
          isVisible: true,
          label: 'Hexbin',
          columns: fieldPair.pair
        };
      });
      var _layer = new _layers.LayerClasses.hexagon(props[0]);
      return _layer;
    }
  }
  var defaultLayers = (0, _reducers.findDefaultLayer)(dataset, _layers.LayerClasses);
  var layer = defaultLayers.find(function (l) {
    return l.type === layerType;
  });
  return layer || defaultLayers.length > 0 ? defaultLayers[0] : null;
}
function AddLayerToolComponent(_ref) {
  var layer = _ref.layer,
    datasetId = _ref.datasetId;
  var dispatch = (0, _reactRedux.useDispatch)();
  (0, _react.useEffect)(function () {
    dispatch((0, _actions.addLayer)(layer, datasetId));
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  return null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3RSZWR1eCIsInJlcXVpcmUiLCJfbGF5ZXJzIiwiX3JlZHVjZXJzIiwiX2FjdGlvbnMiLCJfdXRpbHMiLCJfdXRpbHMyIiwiX3pvZCIsIl9yZWFjdCIsIm93bktleXMiLCJlIiwiciIsInQiLCJPYmplY3QiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwibyIsImZpbHRlciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eTIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwiYWRkTGF5ZXIiLCJleHBvcnRzIiwidG9vbCIsImRlc2NyaXB0aW9uIiwicGFyYW1ldGVycyIsInoiLCJvYmplY3QiLCJkYXRhc2V0TmFtZSIsInN0cmluZyIsImRlc2NyaWJlIiwiZmllbGROYW1lIiwibGF5ZXJUeXBlIiwiY29sb3JTY2FsZSIsIm9wdGlvbmFsIiwiY3VzdG9tQ29sb3JTY2FsZSIsImFycmF5IiwibnVtYmVyIiwiZXhlY3V0ZSIsImV4ZWN1dGVBZGRMYXllciIsImNvbXBvbmVudCIsIkFkZExheWVyVG9vbENvbXBvbmVudCIsImlzQWRkTGF5ZXJBcmdzIiwiYXJncyIsIl90eXBlb2YyIiwiaXNBZGRMYXllckZ1bmN0aW9uQ29udGV4dCIsImNvbnRleHQiLCJnZXREYXRhc2V0cyIsIl94IiwiX3gyIiwiX2V4ZWN1dGVBZGRMYXllciIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl9yZWdlbmVyYXRvciIsIm1hcmsiLCJfY2FsbGVlIiwib3B0aW9ucyIsIl9hcmdzJGNvbG9yU2NhbGUiLCJkYXRhc2V0cyIsImRhdGFzZXRJZCIsImRhdGFzZXQiLCJmaWVsZCIsImxheWVyIiwiY29sb3JGaWVsZCIsImN1c3RvbUNvbG9yUmFuZ2UiLCJuZXdDb2xvcnMiLCJuZXdMYXllciIsIndyYXAiLCJfY2FsbGVlJCIsIl9jb250ZXh0IiwicHJldiIsIm5leHQiLCJFcnJvciIsImZpbmQiLCJkYXRhSWQiLCJsYWJlbCIsImNvbmNhdCIsImZpZWxkcyIsImYiLCJuYW1lIiwiaW5jbHVkZXMiLCJndWVzc0RlZmF1bHRMYXllciIsInR5cGUiLCJjb25maWciLCJ2aXNDb25maWciLCJjb2xvclJhbmdlIiwiaW50ZXJwb2xhdGVDb2xvciIsImNvbG9ycyIsImNvbG9yTWFwIiwibWFwIiwiY29sb3IiLCJpbmRleCIsImlkIiwiY29sdW1ucyIsInJlZHVjZSIsImFjYyIsImtleSIsInZhbHVlIiwic3Ryb2tlQ29sb3JTY2FsZSIsInN0cm9rZUNvbG9yRmllbGQiLCJzdHJva2VDb2xvclJhbmdlIiwiY29sb3JEb21haW4iLCJzdHJva2VDb2xvckRvbWFpbiIsImFicnVwdCIsImxsbVJlc3VsdCIsInN1Y2Nlc3MiLCJKU09OIiwic3RyaW5naWZ5IiwiZGV0YWlscyIsImFkZGl0aW9uYWxEYXRhIiwidDAiLCJlcnJvciIsIm1lc3NhZ2UiLCJpbnN0cnVjdGlvbiIsInN0b3AiLCJmaWVsZFBhaXJzIiwicHJvcHMiLCJmaWVsZFBhaXIiLCJpc1Zpc2libGUiLCJwYWlyIiwiX2xheWVyIiwiTGF5ZXJDbGFzc2VzIiwiaGV4YWdvbiIsImRlZmF1bHRMYXllcnMiLCJmaW5kRGVmYXVsdExheWVyIiwibCIsIl9yZWYiLCJkaXNwYXRjaCIsInVzZURpc3BhdGNoIiwidXNlRWZmZWN0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Rvb2xzL2tlcGxlci10b29scy9sYXllci1jcmVhdGlvbi10b29sLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQge3VzZURpc3BhdGNofSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQge0xheWVyQ2xhc3Nlc30gZnJvbSAnQGtlcGxlci5nbC9sYXllcnMnO1xuaW1wb3J0IEtlcGxlclRhYmxlLCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuaW1wb3J0IHtmaW5kRGVmYXVsdExheWVyfSBmcm9tICdAa2VwbGVyLmdsL3JlZHVjZXJzJztcbmltcG9ydCB7YWRkTGF5ZXIgYXMgYWRkTGF5ZXJBY3Rpb259IGZyb20gJ0BrZXBsZXIuZ2wvYWN0aW9ucyc7XG5pbXBvcnQge2ludGVycG9sYXRlQ29sb3J9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7dG9vbH0gZnJvbSAnQG9wZW5hc3Npc3RhbnQvdXRpbHMnO1xuaW1wb3J0IHt6fSBmcm9tICd6b2QnO1xuaW1wb3J0IHt1c2VFZmZlY3R9IGZyb20gJ3JlYWN0JztcblxuZXhwb3J0IGNvbnN0IGFkZExheWVyID0gdG9vbDxcbiAgLy8gcGFyYW1ldGVyc1xuICB6LlpvZE9iamVjdDx7XG4gICAgZGF0YXNldE5hbWU6IHouWm9kU3RyaW5nO1xuICAgIGZpZWxkTmFtZTogei5ab2RTdHJpbmc7XG4gICAgbGF5ZXJUeXBlOiB6LlpvZEVudW08XG4gICAgICBbXG4gICAgICAgICdwb2ludCcsXG4gICAgICAgICdhcmMnLFxuICAgICAgICAnbGluZScsXG4gICAgICAgICdncmlkJyxcbiAgICAgICAgJ2hleGFnb24nLFxuICAgICAgICAnZ2VvanNvbicsXG4gICAgICAgICdjbHVzdGVyJyxcbiAgICAgICAgJ2hlYXRtYXAnLFxuICAgICAgICAnaDMnLFxuICAgICAgICAndHJpcCcsXG4gICAgICAgICdzMidcbiAgICAgIF1cbiAgICA+O1xuICAgIGNvbG9yU2NhbGU6IHouWm9kT3B0aW9uYWw8ei5ab2RFbnVtPFsncXVhbnRpbGUnLCAncXVhbnRpemUnLCAnb3JkaW5hbCcsICdjdXN0b20nXT4+O1xuICAgIGN1c3RvbUNvbG9yU2NhbGU6IHouWm9kT3B0aW9uYWw8ei5ab2RBcnJheTx6LlpvZE51bWJlcj4+O1xuICB9PixcbiAgLy8gcmV0dXJuIHR5cGVcbiAgRXhlY3V0ZUFkZExheWVyUmVzdWx0WydsbG1SZXN1bHQnXSxcbiAgLy8gYWRkaXRpb25hbCBkYXRhXG4gIEV4ZWN1dGVBZGRMYXllclJlc3VsdFsnYWRkaXRpb25hbERhdGEnXSxcbiAgLy8gY29udGV4dFxuICBBZGRMYXllckZ1bmN0aW9uQ29udGV4dFxuPih7XG4gIGRlc2NyaXB0aW9uOiAnYWRkIGEga2VwbGVyLmdsIG1hcCBsYXllcicsXG4gIHBhcmFtZXRlcnM6IHoub2JqZWN0KHtcbiAgICBkYXRhc2V0TmFtZTogelxuICAgICAgLnN0cmluZygpXG4gICAgICAuZGVzY3JpYmUoJ1RoZSBuYW1lIG9mIHRoZSBkYXRhc2V0LiBOb3RlOiBwbGVhc2UgZG8gTk9UIHVzZSB0aGUgZGF0YXNldElkLicpLFxuICAgIGZpZWxkTmFtZTogei5zdHJpbmcoKSxcbiAgICBsYXllclR5cGU6IHouZW51bShbXG4gICAgICAncG9pbnQnLFxuICAgICAgJ2FyYycsXG4gICAgICAnbGluZScsXG4gICAgICAnZ3JpZCcsXG4gICAgICAnaGV4YWdvbicsXG4gICAgICAnZ2VvanNvbicsXG4gICAgICAnY2x1c3RlcicsXG4gICAgICAnaGVhdG1hcCcsXG4gICAgICAnaDMnLFxuICAgICAgJ3RyaXAnLFxuICAgICAgJ3MyJ1xuICAgIF0pLFxuICAgIGNvbG9yU2NhbGU6IHouZW51bShbJ3F1YW50aWxlJywgJ3F1YW50aXplJywgJ29yZGluYWwnLCAnY3VzdG9tJ10pLm9wdGlvbmFsKCksXG4gICAgY3VzdG9tQ29sb3JTY2FsZTogelxuICAgICAgLmFycmF5KHoubnVtYmVyKCkpXG4gICAgICAub3B0aW9uYWwoKVxuICAgICAgLmRlc2NyaWJlKFxuICAgICAgICAnQW4gYXJyYXkgb2YgbnVtZXJpYyBicmVha3BvaW50cyB1c2VkIHRvIGRlZmluZSBjdXN0b20gY29sb3IgaW50ZXJ2YWxzLiBPbmx5IGFwcGxpY2FibGUgd2hlbiBjb2xvclNjYWxlIGlzIHNldCB0byBcImN1c3RvbVwiJ1xuICAgICAgKVxuICB9KSxcbiAgZXhlY3V0ZTogZXhlY3V0ZUFkZExheWVyLFxuICBjb21wb25lbnQ6IEFkZExheWVyVG9vbENvbXBvbmVudFxufSk7XG5cbmV4cG9ydCB0eXBlIEFkZExheWVyVG9vbCA9IHR5cGVvZiBhZGRMYXllcjtcblxudHlwZSBBZGRMYXllckFyZ3MgPSB7XG4gIGRhdGFzZXROYW1lOiBzdHJpbmc7XG4gIGxheWVyVHlwZTogc3RyaW5nO1xuICBmaWVsZE5hbWU6IHN0cmluZztcbiAgY29sb3JTY2FsZTogc3RyaW5nO1xuICBjdXN0b21Db2xvclNjYWxlOiBBcnJheTxudW1iZXI+O1xufTtcblxuZnVuY3Rpb24gaXNBZGRMYXllckFyZ3MoYXJnczogYW55KTogYXJncyBpcyBBZGRMYXllckFyZ3Mge1xuICByZXR1cm4gKFxuICAgIHR5cGVvZiBhcmdzID09PSAnb2JqZWN0JyAmJlxuICAgIGFyZ3MgIT09IG51bGwgJiZcbiAgICAnZGF0YXNldE5hbWUnIGluIGFyZ3MgJiZcbiAgICAnZmllbGROYW1lJyBpbiBhcmdzICYmXG4gICAgJ2xheWVyVHlwZScgaW4gYXJnc1xuICApO1xufVxuXG50eXBlIEFkZExheWVyRnVuY3Rpb25Db250ZXh0ID0ge1xuICBnZXREYXRhc2V0czogKCkgPT4gRGF0YXNldHM7XG59O1xuXG5mdW5jdGlvbiBpc0FkZExheWVyRnVuY3Rpb25Db250ZXh0KGNvbnRleHQ6IGFueSk6IGNvbnRleHQgaXMgQWRkTGF5ZXJGdW5jdGlvbkNvbnRleHQge1xuICByZXR1cm4gY29udGV4dCAmJiB0eXBlb2YgY29udGV4dC5nZXREYXRhc2V0cyA9PT0gJ2Z1bmN0aW9uJztcbn1cblxudHlwZSBFeGVjdXRlQWRkTGF5ZXJSZXN1bHQgPSB7XG4gIGxsbVJlc3VsdDoge1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgbGF5ZXI/OiBzdHJpbmc7XG4gICAgZGV0YWlscz86IHN0cmluZztcbiAgICBlcnJvcj86IHN0cmluZztcbiAgICBpbnN0cnVjdGlvbj86IHN0cmluZztcbiAgfTtcbiAgYWRkaXRpb25hbERhdGE/OiB7XG4gICAgbGF5ZXI6IG9iamVjdDtcbiAgICBkYXRhc2V0SWQ6IHN0cmluZztcbiAgfTtcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVBZGRMYXllcihhcmdzLCBvcHRpb25zKTogUHJvbWlzZTxFeGVjdXRlQWRkTGF5ZXJSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBpZiAoIWlzQWRkTGF5ZXJBcmdzKGFyZ3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYWRkTGF5ZXIgYXJndW1lbnRzJyk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0FkZExheWVyRnVuY3Rpb25Db250ZXh0KG9wdGlvbnMuY29udGV4dCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhZGRMYXllciBjb250ZXh0Jyk7XG4gICAgfVxuXG4gICAgY29uc3Qge2RhdGFzZXROYW1lLCBmaWVsZE5hbWUsIGxheWVyVHlwZSwgY29sb3JTY2FsZSA9ICdxdWFudGlsZScsIGN1c3RvbUNvbG9yU2NhbGV9ID0gYXJncztcblxuICAgIGNvbnN0IGRhdGFzZXRzID0gb3B0aW9ucy5jb250ZXh0LmdldERhdGFzZXRzKCk7XG5cbiAgICAvLyBjaGVjayBpZiBkYXRhc2V0IGV4aXN0cyBpbiBrZXBsZXIuZ2xcbiAgICBjb25zdCBkYXRhc2V0SWQgPSBPYmplY3Qua2V5cyhkYXRhc2V0cykuZmluZChkYXRhSWQgPT4gZGF0YXNldHNbZGF0YUlkXS5sYWJlbCA9PT0gZGF0YXNldE5hbWUpO1xuICAgIGlmICghZGF0YXNldElkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERhdGFzZXQgJHtkYXRhc2V0TmFtZX0gbm90IGZvdW5kLmApO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGlmIGZpZWxkIGV4aXN0cyBpbiB0aGUgZGF0YXNldFxuICAgIGNvbnN0IGRhdGFzZXQgPSBkYXRhc2V0c1tkYXRhc2V0SWRdO1xuICAgIGNvbnN0IGZpZWxkID0gZGF0YXNldC5maWVsZHMuZmluZChmID0+IGYubmFtZSA9PT0gZmllbGROYW1lKTtcbiAgICBpZiAoIWZpZWxkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpZWxkICR7ZmllbGROYW1lfSBub3QgZm91bmQuYCk7XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgY29sb3JTY2FsZSBpcyB2YWxpZFxuICAgIGlmICghWydxdWFudGlsZScsICdxdWFudGl6ZScsICdvcmRpbmFsJywgJ2N1c3RvbSddLmluY2x1ZGVzKGNvbG9yU2NhbGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY29sb3Igc2NhbGU6ICR7Y29sb3JTY2FsZX0uYCk7XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgaWYgY3VzdG9tQ29sb3JTY2FsZSBpcyBhdmFpbGFibGVcbiAgICBpZiAoY29sb3JTY2FsZSA9PT0gJ2N1c3RvbScgJiYgIWN1c3RvbUNvbG9yU2NhbGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ3VzdG9tIGNvbG9yIHNjYWxlIG9yIGJyZWFrcyBpcyByZXF1aXJlZCB3aGVuIGNvbG9yU2NhbGUgaXMgXCJjdXN0b21cIi4nKTtcbiAgICB9XG5cbiAgICAvLyBjaGVjayBpZiBsYXllclR5cGUgaXMgdmFsaWRcbiAgICBjb25zdCBsYXllciA9IGd1ZXNzRGVmYXVsdExheWVyKGRhdGFzZXQsIGxheWVyVHlwZSk7XG5cbiAgICBpZiAoIWxheWVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbGF5ZXIgdHlwZTogJHtsYXllclR5cGV9LmApO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbG9yRmllbGQgPSB7XG4gICAgICBuYW1lOiBmaWVsZC5uYW1lLFxuICAgICAgdHlwZTogZmllbGQudHlwZVxuICAgIH07XG5cbiAgICAvLyBjcmVhdGUgY3VzdG9tIGNvbG9yUmFuZ2UgaWYgbmVlZGVkXG4gICAgbGV0IGN1c3RvbUNvbG9yUmFuZ2UgPSBsYXllci5jb25maWcudmlzQ29uZmlnLmNvbG9yUmFuZ2U7XG4gICAgaWYgKGNvbG9yU2NhbGUgPT09ICdjdXN0b20nKSB7XG4gICAgICBjb25zdCBuZXdDb2xvcnMgPSBpbnRlcnBvbGF0ZUNvbG9yKGN1c3RvbUNvbG9yUmFuZ2UuY29sb3JzLCBjdXN0b21Db2xvclNjYWxlLmxlbmd0aCArIDEpO1xuICAgICAgY3VzdG9tQ29sb3JSYW5nZSA9IHtcbiAgICAgICAgLi4uY3VzdG9tQ29sb3JSYW5nZSxcbiAgICAgICAgY29sb3JzOiBuZXdDb2xvcnMsXG4gICAgICAgIGNvbG9yTWFwOiBuZXdDb2xvcnMubWFwKChjb2xvciwgaW5kZXgpID0+IFtjdXN0b21Db2xvclNjYWxlW2luZGV4XSB8fCBudWxsLCBjb2xvcl0pXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIGNvbnN0cnVjdCBuZXcgbGF5ZXIgY29uZmlnIGZvciBhZGRMYXllcigpIGFjdGlvblxuICAgIGNvbnN0IG5ld0xheWVyID0ge1xuICAgICAgaWQ6IGxheWVyLmlkLFxuICAgICAgdHlwZTogbGF5ZXIudHlwZSxcbiAgICAgIGNvbmZpZzoge1xuICAgICAgICAuLi5sYXllci5jb25maWcsXG4gICAgICAgIGRhdGFJZDogZGF0YXNldElkLFxuICAgICAgICBsYWJlbDogYCR7ZmllbGQubmFtZX0tJHtjb2xvclNjYWxlfWAsXG4gICAgICAgIGNvbHVtbnM6IE9iamVjdC5rZXlzKGxheWVyLmNvbmZpZy5jb2x1bW5zKS5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG4gICAgICAgICAgYWNjW2tleV0gPSBsYXllci5jb25maWcuY29sdW1uc1trZXldLnZhbHVlO1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9KSxcbiAgICAgICAgY29sb3JTY2FsZSxcbiAgICAgICAgY29sb3JGaWVsZCxcbiAgICAgICAgc3Ryb2tlQ29sb3JTY2FsZTogY29sb3JTY2FsZSxcbiAgICAgICAgc3Ryb2tlQ29sb3JGaWVsZDogY29sb3JGaWVsZCxcbiAgICAgICAgdmlzQ29uZmlnOiB7XG4gICAgICAgICAgLi4ubGF5ZXIuY29uZmlnLnZpc0NvbmZpZyxcbiAgICAgICAgICBjb2xvclJhbmdlOiBjdXN0b21Db2xvclJhbmdlLFxuICAgICAgICAgIHN0cm9rZUNvbG9yUmFuZ2U6IGN1c3RvbUNvbG9yUmFuZ2UsXG4gICAgICAgICAgLi4uKGN1c3RvbUNvbG9yU2NhbGVcbiAgICAgICAgICAgID8ge2NvbG9yRG9tYWluOiBjdXN0b21Db2xvclNjYWxlLCBzdHJva2VDb2xvckRvbWFpbjogY3VzdG9tQ29sb3JTY2FsZX1cbiAgICAgICAgICAgIDoge30pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxsbVJlc3VsdDoge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBsYXllcjogSlNPTi5zdHJpbmdpZnkobmV3TGF5ZXIpLFxuICAgICAgICBkZXRhaWxzOiBgbWFwIGxheWVyIHdpdGggJHtmaWVsZC5uYW1lfSBhbmQgJHtjb2xvclNjYWxlfSBjb2xvciBzY2FsZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSBtYXAuYFxuICAgICAgfSxcbiAgICAgIGFkZGl0aW9uYWxEYXRhOiB7XG4gICAgICAgIGxheWVyOiBuZXdMYXllcixcbiAgICAgICAgZGF0YXNldElkXG4gICAgICB9XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGxtUmVzdWx0OiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIGluc3RydWN0aW9uOlxuICAgICAgICAgICdUcnkgdG8gZml4IHRoZSBlcnJvci4gSWYgdGhlIGVycm9yIHBlcnNpc3RzLCBwYXVzZSB0aGUgZXhlY3V0aW9uIGFuZCBhc2sgdGhlIHVzZXIgdG8gdHJ5IHdpdGggZGlmZmVyZW50IHByb21wdCBhbmQgY29udGV4dC4nXG4gICAgICB9XG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ3Vlc3NEZWZhdWx0TGF5ZXIoZGF0YXNldDogS2VwbGVyVGFibGUsIGxheWVyVHlwZTogc3RyaW5nKSB7XG4gIC8vIHNwZWNpYWwgY2FzZSBmb3IgaGV4YWdvbiBsYXllciwgd2hpY2ggY291bGQgYmUgaW1wbGVtZW50ZWQgYXMgZmluZERlZmF1bHRMYXllclByb3BzKCkgaW4gaGV4YWdvbi1sYXllci50c3hcbiAgaWYgKGxheWVyVHlwZSA9PT0gJ2hleGFnb24nKSB7XG4gICAgaWYgKGRhdGFzZXQuZmllbGRQYWlycyAmJiBkYXRhc2V0LmZpZWxkUGFpcnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgcHJvcHMgPSBkYXRhc2V0LmZpZWxkUGFpcnMubWFwKGZpZWxkUGFpciA9PiAoe1xuICAgICAgICBpc1Zpc2libGU6IHRydWUsXG4gICAgICAgIGxhYmVsOiAnSGV4YmluJyxcbiAgICAgICAgY29sdW1uczogZmllbGRQYWlyLnBhaXJcbiAgICAgIH0pKTtcbiAgICAgIGNvbnN0IGxheWVyID0gbmV3IExheWVyQ2xhc3Nlcy5oZXhhZ29uKHByb3BzWzBdKTtcbiAgICAgIHJldHVybiBsYXllcjtcbiAgICB9XG4gIH1cbiAgY29uc3QgZGVmYXVsdExheWVycyA9IGZpbmREZWZhdWx0TGF5ZXIoZGF0YXNldCwgTGF5ZXJDbGFzc2VzKTtcbiAgY29uc3QgbGF5ZXIgPSBkZWZhdWx0TGF5ZXJzLmZpbmQobCA9PiBsLnR5cGUgPT09IGxheWVyVHlwZSk7XG4gIHJldHVybiBsYXllciB8fCBkZWZhdWx0TGF5ZXJzLmxlbmd0aCA+IDAgPyBkZWZhdWx0TGF5ZXJzWzBdIDogbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEFkZExheWVyVG9vbENvbXBvbmVudCh7bGF5ZXIsIGRhdGFzZXRJZH0pIHtcbiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZGlzcGF0Y2goYWRkTGF5ZXJBY3Rpb24obGF5ZXIsIGRhdGFzZXRJZCkpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW10pO1xuXG4gIHJldHVybiBudWxsO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBR0EsSUFBQUEsV0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBRCxPQUFBO0FBRUEsSUFBQUUsU0FBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsUUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksTUFBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssT0FBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0sSUFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sTUFBQSxHQUFBUCxPQUFBO0FBQWdDLFNBQUFRLFFBQUFDLENBQUEsRUFBQUMsQ0FBQTtFQUFBLElBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFKLENBQUE7RUFBQSxJQUFBRyxNQUFBLENBQUFFLHFCQUFBO0lBQUEsSUFBQUMsQ0FBQSxHQUFBSCxNQUFBLENBQUFFLHFCQUFBLENBQUFMLENBQUE7SUFBQUMsQ0FBQSxLQUFBSyxDQUFBLEdBQUFBLENBQUEsQ0FBQUMsTUFBQSxXQUFBTixDQUFBO01BQUEsT0FBQUUsTUFBQSxDQUFBSyx3QkFBQSxDQUFBUixDQUFBLEVBQUFDLENBQUEsRUFBQVEsVUFBQTtJQUFBLEtBQUFQLENBQUEsQ0FBQVEsSUFBQSxDQUFBQyxLQUFBLENBQUFULENBQUEsRUFBQUksQ0FBQTtFQUFBO0VBQUEsT0FBQUosQ0FBQTtBQUFBO0FBQUEsU0FBQVUsY0FBQVosQ0FBQTtFQUFBLFNBQUFDLENBQUEsTUFBQUEsQ0FBQSxHQUFBWSxTQUFBLENBQUFDLE1BQUEsRUFBQWIsQ0FBQTtJQUFBLElBQUFDLENBQUEsV0FBQVcsU0FBQSxDQUFBWixDQUFBLElBQUFZLFNBQUEsQ0FBQVosQ0FBQTtJQUFBQSxDQUFBLE9B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