"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ERROR_MSG = void 0;
exports.flattenDeps = flattenDeps;
exports.injector = injector;
exports.provideRecipesToInjector = provideRecipesToInjector;
exports.typeCheckRecipe = typeCheckRecipe;
exports.withState = withState;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _react = _interopRequireDefault(require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react"));
var _reactRedux = require("/Users/ihordykhta/Desktop/unfolded/kepler.gl/node_modules/react-redux/lib");
var _redux = require("redux");
var _window = require("global/window");
var _context = _interopRequireDefault(require("./context"));
var _excluded = ["state"]; // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
function ownKeys(e, r) {
  var t = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var o = Object.getOwnPropertySymbols(e);
    r && (o = o.filter(function (r) {
      return Object.getOwnPropertyDescriptor(e, r).enumerable;
    })), t.push.apply(t, o);
  }
  return t;
}
function _objectSpread(e) {
  for (var r = 1; r < arguments.length; r++) {
    var t = null != arguments[r] ? arguments[r] : {};
    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {
      (0, _defineProperty2["default"])(e, r, t[r]);
    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {
      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));
    });
  }
  return e;
}
var MissingComp = function MissingComp() {
  return /*#__PURE__*/_react["default"].createElement("div", null);
};
var ERROR_MSG = exports.ERROR_MSG = {
  wrongRecipeType: "injectComponents takes an array of factories replacement pairs as input, " + "each pair be a array as [originalFactory, replacement].",
  noDep: function noDep(fac, parent) {
    return "".concat(fac.name, " is required as a dependency of ").concat(parent.name, ", ") + "but is not provided to injectComponents. It will not be rendered.";
  },
  notFunc: 'factory and its replacement should be a function'
};
function injector() {
  var map = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Map();
  var cache = new Map(); // map<factory, factory -> ?>
  var _get = function get(fac, parent) {
    var factory = map.get(fac);
    // factory is not injected
    if (!factory) {
      _window.console.error(ERROR_MSG.noDep(fac, parent));
      return MissingComp;
    }

    // check if custom factory deps is declared
    var instances = cache.get(factory) || factory.apply(void 0, (0, _toConsumableArray2["default"])(factory.deps ? factory.deps.map(function (dep) {
      return _get(dep, factory);
    }) : []));
    cache.set(fac, instances);
    return instances;
  };

  // if you have two functions that happen to have the exactly same text
  // it will be override: 2018-02-05
  return {
    provide: function provide(factory, replacement) {
      if (!typeCheckRecipe([factory, replacement])) {
        return injector(map);
      }
      return injector(new Map(map).set(factory, replacement));
    },
    get: _get
  };
}

// entryPoint
function flattenDeps(allDeps, factory) {
  var addToDeps = allDeps.includes(factory) ? allDeps : allDeps.concat([factory]);
  return Array.isArray(factory.deps) && factory.deps.length ? factory.deps.reduce(function (accu, dep) {
    return flattenDeps(accu, dep);
  }, addToDeps) : addToDeps;
}
function provideRecipesToInjector(recipes, appInjector) {
  var provided = new Map();
  var injector = recipes.reduce(function (inj, recipe) {
    var _inj;
    if (!typeCheckRecipe(recipe)) {
      return inj;
    }

    // collect dependencies of custom factories, if there is any.
    // Add them to the appInjector
    var customDependencies = flattenDeps([], recipe[1]);
    inj = customDependencies.reduce(function (ij, factory) {
      if (provided.get(factory)) {
        _window.console.warn("".concat(factory.name, " already injected from ").concat(provided.get(factory).name, ", injecting ").concat(recipe[0].name, " after ").concat(provided.get(factory).name, " will override it"));
      }
      return ij.provide(factory, factory);
    }, inj);
    provided.set(recipe[0], recipe[1]);
    return (_inj = inj).provide.apply(_inj, (0, _toConsumableArray2["default"])(recipe));
  }, appInjector);

  // make sure all component instance are cached
  provided.forEach(function (v) {
    injector.get(v);
  });
  return injector;
}
function typeCheckRecipe(recipe) {
  if (!Array.isArray(recipe) || recipe.length < 2) {
    _window.console.error('Error injecting [factory, replacement]', recipe);
    _window.console.error(ERROR_MSG.wrongRecipeType);
    return false;
  }
  var _recipe = (0, _slicedToArray2["default"])(recipe, 2),
    factory = _recipe[0],
    replacement = _recipe[1];
  if (typeof factory !== 'function') {
    _window.console.error('Error injecting factory: ', factory);
    _window.console.error(ERROR_MSG.notFunc);
    return false;
  } else if (typeof replacement !== 'function') {
    _window.console.error('Error injecting replacement for: ', factory);
    _window.console.error(ERROR_MSG.notFunc);
    return false;
  }
  return true;
}
var identity = function identity(state) {
  return state;
};
// Helper to add reducer state to custom component
function withState() {
  var lenses = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
  var mapStateToProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : identity;
  var actions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  return function (Component) {
    var WrappedComponent = function WrappedComponent(_ref) {
      var state = _ref.state,
        props = (0, _objectWithoutProperties2["default"])(_ref, _excluded);
      return /*#__PURE__*/_react["default"].createElement(_context["default"].Consumer, null, function (context) {
        return /*#__PURE__*/_react["default"].createElement(Component, lenses.reduce(function (totalState, lens) {
          return _objectSpread(_objectSpread({}, totalState), lens(context.selector(state)));
        }, props));
      });
    };
    return (0, _reactRedux.connect)(function (state) {
      return _objectSpread(_objectSpread({}, mapStateToProps(state)), {}, {
        state: state
      });
    }, function (dispatch) {
      return Object.keys(actions).reduce(function (accu, key) {
        return _objectSpread(_objectSpread({}, accu), {}, (0, _defineProperty2["default"])({}, key, (0, _redux.bindActionCreators)(actions[key], dispatch)));
      }, {});
    })(WrappedComponent);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9yZWFjdFJlZHV4IiwiX3JlZHV4IiwiX3dpbmRvdyIsIl9jb250ZXh0IiwiX2V4Y2x1ZGVkIiwib3duS2V5cyIsImUiLCJyIiwidCIsIk9iamVjdCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJNaXNzaW5nQ29tcCIsImNyZWF0ZUVsZW1lbnQiLCJFUlJPUl9NU0ciLCJleHBvcnRzIiwid3JvbmdSZWNpcGVUeXBlIiwibm9EZXAiLCJmYWMiLCJwYXJlbnQiLCJjb25jYXQiLCJuYW1lIiwibm90RnVuYyIsImluamVjdG9yIiwibWFwIiwidW5kZWZpbmVkIiwiTWFwIiwiY2FjaGUiLCJfZ2V0IiwiZ2V0IiwiZmFjdG9yeSIsImNvbnNvbGUiLCJlcnJvciIsImluc3RhbmNlcyIsIl90b0NvbnN1bWFibGVBcnJheTIiLCJkZXBzIiwiZGVwIiwic2V0IiwicHJvdmlkZSIsInJlcGxhY2VtZW50IiwidHlwZUNoZWNrUmVjaXBlIiwiZmxhdHRlbkRlcHMiLCJhbGxEZXBzIiwiYWRkVG9EZXBzIiwiaW5jbHVkZXMiLCJBcnJheSIsImlzQXJyYXkiLCJyZWR1Y2UiLCJhY2N1IiwicHJvdmlkZVJlY2lwZXNUb0luamVjdG9yIiwicmVjaXBlcyIsImFwcEluamVjdG9yIiwicHJvdmlkZWQiLCJpbmoiLCJyZWNpcGUiLCJfaW5qIiwiY3VzdG9tRGVwZW5kZW5jaWVzIiwiaWoiLCJ3YXJuIiwidiIsIl9yZWNpcGUiLCJfc2xpY2VkVG9BcnJheTIiLCJpZGVudGl0eSIsInN0YXRlIiwid2l0aFN0YXRlIiwibGVuc2VzIiwibWFwU3RhdGVUb1Byb3BzIiwiYWN0aW9ucyIsIkNvbXBvbmVudCIsIldyYXBwZWRDb21wb25lbnQiLCJfcmVmIiwicHJvcHMiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMyIiwiQ29uc3VtZXIiLCJjb250ZXh0IiwidG90YWxTdGF0ZSIsImxlbnMiLCJzZWxlY3RvciIsImNvbm5lY3QiLCJkaXNwYXRjaCIsImtleSIsImJpbmRBY3Rpb25DcmVhdG9ycyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmplY3Rvci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7Y29ubmVjdH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHtiaW5kQWN0aW9uQ3JlYXRvcnN9IGZyb20gJ3JlZHV4JztcbmltcG9ydCB7XG4gIE1hcFN0YXRlVG9Qcm9wc1BhcmFtLFxuICBNYXBEaXNwYXRjaFRvUHJvcHNQYXJhbSxcbiAgSW5mZXJhYmxlQ29tcG9uZW50RW5oYW5jZXJXaXRoUHJvcHNcbn0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHtjb25zb2xlIGFzIENvbnNvbGV9IGZyb20gJ2dsb2JhbC93aW5kb3cnO1xuaW1wb3J0IEtlcGxlckdsQ29udGV4dCBmcm9tICcuL2NvbnRleHQnO1xuXG5leHBvcnQgdHlwZSBGYWN0b3J5RWxlbWVudCA9ICguLi5hcmdzKSA9PiBSZWFjdC5Db21wb25lbnRUeXBlO1xuZXhwb3J0IHR5cGUgRmFjdG9yeSA9IEZhY3RvcnlFbGVtZW50ICYge1xuICBkZXBzOiBGYWN0b3J5RWxlbWVudFtdO1xufTtcblxuZXhwb3J0IHR5cGUgSW5qZWN0b3JUeXBlID0ge1xuICBwcm92aWRlOiAoZmFjdG9yeTogYW55LCByZXBsYWNlbWVudDogYW55KSA9PiBJbmplY3RvclR5cGU7XG4gIGdldDogKGZhYzogYW55LCBwYXJlbnQ/OiBhbnkpID0+IGFueTtcbn07XG5cbmNvbnN0IE1pc3NpbmdDb21wID0gKCkgPT4gPGRpdiAvPjtcblxuZXhwb3J0IGNvbnN0IEVSUk9SX01TRyA9IHtcbiAgd3JvbmdSZWNpcGVUeXBlOlxuICAgIGBpbmplY3RDb21wb25lbnRzIHRha2VzIGFuIGFycmF5IG9mIGZhY3RvcmllcyByZXBsYWNlbWVudCBwYWlycyBhcyBpbnB1dCwgYCArXG4gICAgYGVhY2ggcGFpciBiZSBhIGFycmF5IGFzIFtvcmlnaW5hbEZhY3RvcnksIHJlcGxhY2VtZW50XS5gLFxuXG4gIG5vRGVwOiAoZmFjLCBwYXJlbnQpID0+XG4gICAgYCR7ZmFjLm5hbWV9IGlzIHJlcXVpcmVkIGFzIGEgZGVwZW5kZW5jeSBvZiAke3BhcmVudC5uYW1lfSwgYCArXG4gICAgYGJ1dCBpcyBub3QgcHJvdmlkZWQgdG8gaW5qZWN0Q29tcG9uZW50cy4gSXQgd2lsbCBub3QgYmUgcmVuZGVyZWQuYCxcblxuICBub3RGdW5jOiAnZmFjdG9yeSBhbmQgaXRzIHJlcGxhY2VtZW50IHNob3VsZCBiZSBhIGZ1bmN0aW9uJ1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluamVjdG9yKG1hcCA9IG5ldyBNYXAoKSk6IEluamVjdG9yVHlwZSB7XG4gIGNvbnN0IGNhY2hlID0gbmV3IE1hcCgpOyAvLyBtYXA8ZmFjdG9yeSwgZmFjdG9yeSAtPiA/PlxuICBjb25zdCBnZXQgPSAoZmFjLCBwYXJlbnQpID0+IHtcbiAgICBjb25zdCBmYWN0b3J5ID0gbWFwLmdldChmYWMpO1xuICAgIC8vIGZhY3RvcnkgaXMgbm90IGluamVjdGVkXG4gICAgaWYgKCFmYWN0b3J5KSB7XG4gICAgICBDb25zb2xlLmVycm9yKEVSUk9SX01TRy5ub0RlcChmYWMsIHBhcmVudCkpO1xuICAgICAgcmV0dXJuIE1pc3NpbmdDb21wO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGlmIGN1c3RvbSBmYWN0b3J5IGRlcHMgaXMgZGVjbGFyZWRcbiAgICBjb25zdCBpbnN0YW5jZXMgPVxuICAgICAgY2FjaGUuZ2V0KGZhY3RvcnkpIHx8XG4gICAgICBmYWN0b3J5KC4uLihmYWN0b3J5LmRlcHMgPyBmYWN0b3J5LmRlcHMubWFwKGRlcCA9PiBnZXQoZGVwLCBmYWN0b3J5KSkgOiBbXSkpO1xuXG4gICAgY2FjaGUuc2V0KGZhYywgaW5zdGFuY2VzKTtcbiAgICByZXR1cm4gaW5zdGFuY2VzO1xuICB9O1xuXG4gIC8vIGlmIHlvdSBoYXZlIHR3byBmdW5jdGlvbnMgdGhhdCBoYXBwZW4gdG8gaGF2ZSB0aGUgZXhhY3RseSBzYW1lIHRleHRcbiAgLy8gaXQgd2lsbCBiZSBvdmVycmlkZTogMjAxOC0wMi0wNVxuICByZXR1cm4ge1xuICAgIHByb3ZpZGU6IChmYWN0b3J5LCByZXBsYWNlbWVudCkgPT4ge1xuICAgICAgaWYgKCF0eXBlQ2hlY2tSZWNpcGUoW2ZhY3RvcnksIHJlcGxhY2VtZW50XSkpIHtcbiAgICAgICAgcmV0dXJuIGluamVjdG9yKG1hcCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gaW5qZWN0b3IobmV3IE1hcChtYXApLnNldChmYWN0b3J5LCByZXBsYWNlbWVudCkpO1xuICAgIH0sXG4gICAgZ2V0XG4gIH07XG59XG5cbi8vIGVudHJ5UG9pbnRcbmV4cG9ydCBmdW5jdGlvbiBmbGF0dGVuRGVwcyhhbGxEZXBzOiBGYWN0b3J5W10sIGZhY3Rvcnk6IGFueSk6IEZhY3RvcnlbXSB7XG4gIGNvbnN0IGFkZFRvRGVwcyA9IGFsbERlcHMuaW5jbHVkZXMoZmFjdG9yeSkgPyBhbGxEZXBzIDogYWxsRGVwcy5jb25jYXQoW2ZhY3RvcnldKTtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZmFjdG9yeS5kZXBzKSAmJiBmYWN0b3J5LmRlcHMubGVuZ3RoXG4gICAgPyBmYWN0b3J5LmRlcHMucmVkdWNlKChhY2N1LCBkZXApID0+IGZsYXR0ZW5EZXBzKGFjY3UsIGRlcCksIGFkZFRvRGVwcylcbiAgICA6IGFkZFRvRGVwcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVSZWNpcGVzVG9JbmplY3RvcihyZWNpcGVzOiBbRmFjdG9yeSwgRmFjdG9yeV1bXSwgYXBwSW5qZWN0b3I6IEluamVjdG9yVHlwZSkge1xuICBjb25zdCBwcm92aWRlZCA9IG5ldyBNYXAoKTtcblxuICBjb25zdCBpbmplY3RvciA9IHJlY2lwZXMucmVkdWNlKChpbmosIHJlY2lwZSkgPT4ge1xuICAgIGlmICghdHlwZUNoZWNrUmVjaXBlKHJlY2lwZSkpIHtcbiAgICAgIHJldHVybiBpbmo7XG4gICAgfVxuXG4gICAgLy8gY29sbGVjdCBkZXBlbmRlbmNpZXMgb2YgY3VzdG9tIGZhY3RvcmllcywgaWYgdGhlcmUgaXMgYW55LlxuICAgIC8vIEFkZCB0aGVtIHRvIHRoZSBhcHBJbmplY3RvclxuICAgIGNvbnN0IGN1c3RvbURlcGVuZGVuY2llcyA9IGZsYXR0ZW5EZXBzKFtdLCByZWNpcGVbMV0pO1xuICAgIGluaiA9IGN1c3RvbURlcGVuZGVuY2llcy5yZWR1Y2UoKGlqLCBmYWN0b3J5KSA9PiB7XG4gICAgICBpZiAocHJvdmlkZWQuZ2V0KGZhY3RvcnkpKSB7XG4gICAgICAgIENvbnNvbGUud2FybihcbiAgICAgICAgICBgJHtmYWN0b3J5Lm5hbWV9IGFscmVhZHkgaW5qZWN0ZWQgZnJvbSAke3Byb3ZpZGVkLmdldChmYWN0b3J5KS5uYW1lfSwgaW5qZWN0aW5nICR7XG4gICAgICAgICAgICByZWNpcGVbMF0ubmFtZVxuICAgICAgICAgIH0gYWZ0ZXIgJHtwcm92aWRlZC5nZXQoZmFjdG9yeSkubmFtZX0gd2lsbCBvdmVycmlkZSBpdGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBpai5wcm92aWRlKGZhY3RvcnksIGZhY3RvcnkpO1xuICAgIH0sIGluaik7XG5cbiAgICBwcm92aWRlZC5zZXQocmVjaXBlWzBdLCByZWNpcGVbMV0pO1xuICAgIHJldHVybiBpbmoucHJvdmlkZSguLi5yZWNpcGUpO1xuICB9LCBhcHBJbmplY3Rvcik7XG5cbiAgLy8gbWFrZSBzdXJlIGFsbCBjb21wb25lbnQgaW5zdGFuY2UgYXJlIGNhY2hlZFxuICBwcm92aWRlZC5mb3JFYWNoKHYgPT4ge1xuICAgIGluamVjdG9yLmdldCh2KTtcbiAgfSk7XG5cbiAgcmV0dXJuIGluamVjdG9yO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHlwZUNoZWNrUmVjaXBlKHJlY2lwZSkge1xuICBpZiAoIUFycmF5LmlzQXJyYXkocmVjaXBlKSB8fCByZWNpcGUubGVuZ3RoIDwgMikge1xuICAgIENvbnNvbGUuZXJyb3IoJ0Vycm9yIGluamVjdGluZyBbZmFjdG9yeSwgcmVwbGFjZW1lbnRdJywgcmVjaXBlKTtcbiAgICBDb25zb2xlLmVycm9yKEVSUk9SX01TRy53cm9uZ1JlY2lwZVR5cGUpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IFtmYWN0b3J5LCByZXBsYWNlbWVudF0gPSByZWNpcGU7XG4gIGlmICh0eXBlb2YgZmFjdG9yeSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIENvbnNvbGUuZXJyb3IoJ0Vycm9yIGluamVjdGluZyBmYWN0b3J5OiAnLCBmYWN0b3J5KTtcbiAgICBDb25zb2xlLmVycm9yKEVSUk9SX01TRy5ub3RGdW5jKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHJlcGxhY2VtZW50ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgQ29uc29sZS5lcnJvcignRXJyb3IgaW5qZWN0aW5nIHJlcGxhY2VtZW50IGZvcjogJywgZmFjdG9yeSk7XG4gICAgQ29uc29sZS5lcnJvcihFUlJPUl9NU0cubm90RnVuYyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2l0aFN0YXRlPFJvb3RTdGF0ZT4ge1xuICA8VFN0YXRlUHJvcHMgPSBvYmplY3QsIFREaXNwYXRjaFByb3BzID0gb2JqZWN0LCBUT3duUHJvcHMgPSBvYmplY3QsIFN0YXRlID0gUm9vdFN0YXRlPihcbiAgICBsZW5zZXM6IGFueVtdLFxuICAgIG1hcFN0YXRlVG9Qcm9wczogTWFwU3RhdGVUb1Byb3BzUGFyYW08VFN0YXRlUHJvcHMsIFRPd25Qcm9wcywgU3RhdGU+LFxuICAgIG1hcERpc3BhdGNoVG9Qcm9wcz86IE1hcERpc3BhdGNoVG9Qcm9wc1BhcmFtPFREaXNwYXRjaFByb3BzLCBUT3duUHJvcHM+XG4gICk6IEluZmVyYWJsZUNvbXBvbmVudEVuaGFuY2VyV2l0aFByb3BzPFRTdGF0ZVByb3BzICYgVERpc3BhdGNoUHJvcHMsIFRPd25Qcm9wcz47XG59XG5cbmNvbnN0IGlkZW50aXR5ID0gc3RhdGUgPT4gc3RhdGU7XG4vLyBIZWxwZXIgdG8gYWRkIHJlZHVjZXIgc3RhdGUgdG8gY3VzdG9tIGNvbXBvbmVudFxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhTdGF0ZShsZW5zZXM6IGFueVtdID0gW10sIG1hcFN0YXRlVG9Qcm9wcyA9IGlkZW50aXR5LCBhY3Rpb25zID0ge30pIHtcbiAgcmV0dXJuIENvbXBvbmVudCA9PiB7XG4gICAgY29uc3QgV3JhcHBlZENvbXBvbmVudCA9ICh7c3RhdGUsIC4uLnByb3BzfSkgPT4gKFxuICAgICAgPEtlcGxlckdsQ29udGV4dC5Db25zdW1lcj5cbiAgICAgICAge2NvbnRleHQgPT4gKFxuICAgICAgICAgIDxDb21wb25lbnRcbiAgICAgICAgICAgIHsuLi5sZW5zZXMucmVkdWNlKFxuICAgICAgICAgICAgICAodG90YWxTdGF0ZSwgbGVucykgPT4gKHtcbiAgICAgICAgICAgICAgICAuLi50b3RhbFN0YXRlLFxuICAgICAgICAgICAgICAgIC4uLmxlbnMoY29udGV4dC5zZWxlY3RvcihzdGF0ZSkpXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBwcm9wc1xuICAgICAgICAgICAgKX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgPC9LZXBsZXJHbENvbnRleHQuQ29uc3VtZXI+XG4gICAgKTtcblxuICAgIHJldHVybiBjb25uZWN0KFxuICAgICAgc3RhdGUgPT4gKHsuLi5tYXBTdGF0ZVRvUHJvcHMoc3RhdGUpLCBzdGF0ZX0pLFxuICAgICAgZGlzcGF0Y2ggPT5cbiAgICAgICAgT2JqZWN0LmtleXMoYWN0aW9ucykucmVkdWNlKFxuICAgICAgICAgIChhY2N1LCBrZXkpID0+ICh7XG4gICAgICAgICAgICAuLi5hY2N1LFxuICAgICAgICAgICAgW2tleV06IGJpbmRBY3Rpb25DcmVhdG9ycyhhY3Rpb25zW2tleV0sIGRpc3BhdGNoKVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHt9XG4gICAgICAgIClcbiAgICApKFdyYXBwZWRDb21wb25lbnQpO1xuICB9O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBR0EsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsTUFBQSxHQUFBRixPQUFBO0FBTUEsSUFBQUcsT0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksUUFBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQXdDLElBQUFLLFNBQUEsY0FaeEM7QUFDQTtBQUFBLFNBQUFDLFFBQUFDLENBQUEsRUFBQUMsQ0FBQTtFQUFBLElBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFKLENBQUE7RUFBQSxJQUFBRyxNQUFBLENBQUFFLHFCQUFBO0lBQUEsSUFBQUMsQ0FBQSxHQUFBSCxNQUFBLENBQUFFLHFCQUFBLENBQUFMLENBQUE7SUFBQUMsQ0FBQSxLQUFBSyxDQUFBLEdBQUFBLENBQUEsQ0FBQUMsTUFBQSxXQUFBTixDQUFBO01BQUEsT0FBQUUsTUFBQSxDQUFBSyx3QkFBQSxDQUFBUixDQUFBLEVBQUFDLENBQUEsRUFBQVEsVUFBQTtJQUFBLEtBQUFQLENBQUEsQ0FBQVEsSUFBQSxDQUFBQyxLQUFBLENBQUFULENBQUEsRUFBQUks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UUFBQW9CLFNBQUEsR0FBQXBCLFNBQUEsTUFBR3lELFFBQVE7RUFBQSxJQUFFSyxPQUFPLEdBQUE5RCxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBb0IsU0FBQSxHQUFBcEIsU0FBQSxNQUFHLENBQUMsQ0FBQztFQUNwRixPQUFPLFVBQUErRCxTQUFTLEVBQUk7SUFDbEIsSUFBTUMsZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFnQkEsQ0FBQUMsSUFBQTtNQUFBLElBQUtQLEtBQUssR0FBQU8sSUFBQSxDQUFMUCxLQUFLO1FBQUtRLEtBQUssT0FBQUMseUJBQUEsYUFBQUYsSUFBQSxFQUFBaEYsU0FBQTtNQUFBLG9CQUN4Q1AsTUFBQSxZQUFBOEIsYUFBQSxDQUFDeEIsUUFBQSxXQUFlLENBQUNvRixRQUFRLFFBQ3RCLFVBQUFDLE9BQU87UUFBQSxvQkFDTjNGLE1BQUEsWUFBQThCLGFBQUEsQ0FBQ3VELFNBQVMsRUFDSkgsTUFBTSxDQUFDbEIsTUFBTSxDQUNmLFVBQUM0QixVQUFVLEVBQUVDLElBQUk7VUFBQSxPQUFBeEUsYUFBQSxDQUFBQSxhQUFBLEtBQ1p1RSxVQUFVLEdBQ1ZDLElBQUksQ0FBQ0YsT0FBTyxDQUFDRyxRQUFRLENBQUNkLEtBQUssQ0FBQyxDQUFDO1FBQUEsQ0FDaEMsRUFDRlEsS0FDRixDQUNELENBQUM7TUFBQSxDQUVvQixDQUFDO0lBQUEsQ0FDNUI7SUFFRCxPQUFPLElBQUFyRixXQUFBLENBQUE0RixPQUFPLEVBQ1osVUFBQWYsS0FBSztNQUFBLE9BQUEzRCxhQUFBLENBQUFBLGFBQUEsS0FBUzhELGVBQWUsQ0FBQ0gsS0FBSyxDQUFDO1FBQUVBLEtBQUssRUFBTEE7TUFBSztJQUFBLENBQUUsRUFDN0MsVUFBQWdCLFFBQVE7TUFBQSxPQUNOcEYsTUFBTSxDQUFDQyxJQUFJLENBQUN1RSxPQUFPLENBQUMsQ0FBQ3BCLE1BQU0sQ0FDekIsVUFBQ0MsSUFBSSxFQUFFZ0MsR0FBRztRQUFBLE9BQUE1RSxhQUFBLENBQUFBLGFBQUEsS0FDTDRDLElBQUksV0FBQXhDLGdCQUFBLGlCQUNOd0UsR0FBRyxFQUFHLElBQUE3RixNQUFBLENBQUE4RixrQkFBa0IsRUFBQ2QsT0FBTyxDQUFDYSxHQUFHLENBQUMsRUFBRUQsUUFBUSxDQUFDO01BQUEsQ0FDakQsRUFDRixDQUFDLENBQ0gsQ0FBQztJQUFBLENBQ0wsQ0FBQyxDQUFDVixnQkFBZ0IsQ0FBQztFQUNyQixDQUFDO0FBQ0giLCJpZ25vcmVMaXN0IjpbXX0=